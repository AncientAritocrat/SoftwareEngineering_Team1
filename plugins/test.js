var rx=Math.pow;var lt=(ba,Le,P)=>new Promise((ne,Up)=>{var Vp=wa=>{try{Qa(P.next(wa))}catch(rh){Up(rh)}},ec=wa=>{try{Qa(P.throw(wa))}catch(rh){Up(rh)}},Qa=wa=>wa.done?ne(wa.value):Promise.resolve(wa.value).then(Vp,ec);Qa((P=P.apply(ba,Le)).next())});var test=function(ba,Le,P,ne,Up){var Vp=document.createElement("style");Vp.textContent=`.heading[data-v-94f556e8]{font-size:1.5em;margin-bottom:12px}.card[data-v-94f556e8]{background:#fff;color:#000;background-image:linear-gradient(48deg,#fff 0%,#e5efe9 100%);border-top-right-radius:16px;border-bottom-left-radius:16px;box-shadow:-20px 20px 35px 1px #0a31562e;display:flex;flex-direction:column;padding:32px;margin:40px;max-width:400px;width:100%}.content-wrapper[data-v-94f556e8]{font-size:1.1em;margin-bottom:44px}.content-wrapper[data-v-94f556e8]:last-child{margin-bottom:0}.button[data-v-94f556e8]{align-items:center;background:#e5efe9;border:1px solid #5a72b5;border-radius:4px;color:#121943;cursor:pointer;display:flex;font-size:1em;font-weight:700;height:40px;justify-content:center;width:180px}.button[data-v-94f556e8]:focus{border:2px solid transparent;box-shadow:0 0 0 2px #121943;outline:solid 4px transparent}.link[data-v-94f556e8]{color:#121943}.link[data-v-94f556e8]:focus{box-shadow:0 0 0 2px #121943}.input-wrapper[data-v-94f556e8]{display:flex;flex-direction:column}.input-wrapper .label[data-v-94f556e8]{align-items:baseline;display:flex;font-weight:700;justify-content:space-between;margin-bottom:8px}.input-wrapper .optional[data-v-94f556e8]{color:#5a72b5;font-size:.9em}.input-wrapper .input[data-v-94f556e8]{border:1px solid #5a72b5;border-radius:4px;height:40px;padding:8px}code[data-v-94f556e8]{background:#e5efe9;border:1px solid #5a72b5;border-radius:4px;padding:2px 4px}.modal-header[data-v-94f556e8]{align-items:baseline;display:flex;justify-content:space-between}.close[data-v-94f556e8]{background:none;border:none;cursor:pointer;display:flex;height:16px;text-decoration:none;width:16px}.close svg[data-v-94f556e8]{width:16px}.modal-wrapper[data-v-94f556e8]{align-items:center;background:rgba(0,0,0,.7);display:flex;justify-content:center;inset:0;position:fixed}#modal[data-v-94f556e8]{transition:opacity .25s ease-in-out}#modal .modal-body[data-v-94f556e8]{max-width:830px;opacity:1;transform:translateY(-100px);transition:opacity .25s ease-in-out;width:100%;z-index:1}.outside-trigger[data-v-94f556e8]{cursor:default;inset:0;position:fixed}.button__link[data-v-94f556e8]{text-decoration:none}.button[data-v-94f556e8]{background-color:#4caf50;border:none;color:#fff;text-align:center;text-decoration:none;display:inline-block;font-size:16px;margin:4px 2px;-webkit-transition-duration:.4s;transition-duration:.4s;cursor:pointer}.button1[data-v-94f556e8]{background-color:#fff;color:#000;border:2px solid #4CAF50}.button1[data-v-94f556e8]:hover{background-color:#4caf50;color:#fff}.button2[data-v-94f556e8]{background-color:#fff;color:#000;border:2px solid #008CBA}.button2[data-v-94f556e8]:hover{background-color:#008cba;color:#fff}.btn_box[data-v-94f556e8]{width:100%;display:flex;justify-items:center;justify-content:start;align-items:start}.heading[data-v-34d7bb8c]{font-size:1.5em;margin-bottom:12px}.btn[data-v-34d7bb8c]{height:40px;width:100px;text-align:center;line-height:40px;font-size:16px;font-weight:700}.btn2[data-v-34d7bb8c]{background-color:#008cba;color:#fff;border-top-right-radius:4px;border-top-left-radius:4px}.card[data-v-34d7bb8c]{background:#fff;color:#000;background-image:linear-gradient(48deg,#fff 0%,#e5efe9 100%);border-top-right-radius:16px;border-bottom-left-radius:16px;box-shadow:-20px 20px 35px 1px #0a31562e;display:flex;flex-direction:column;padding:32px;margin:40px;max-width:400px;width:100%;height:600px}.content-wrapper[data-v-34d7bb8c]{font-size:1.1em;margin-bottom:44px}.content-wrapper[data-v-34d7bb8c]:last-child{margin-bottom:0}.button[data-v-34d7bb8c]{align-items:center;background:#e5efe9;border:1px solid #5a72b5;border-radius:4px;color:#121943;cursor:pointer;display:flex;font-size:1em;font-weight:700;height:40px;justify-content:center;width:180px}.button[data-v-34d7bb8c]:focus{border:2px solid transparent;box-shadow:0 0 0 2px #121943;outline:solid 4px transparent}.link[data-v-34d7bb8c]{color:#121943}.link[data-v-34d7bb8c]:focus{box-shadow:0 0 0 2px #121943}.input-wrapper[data-v-34d7bb8c]{display:flex;flex-direction:column}.input-wrapper .label[data-v-34d7bb8c]{align-items:baseline;display:flex;font-weight:700;justify-content:space-between;margin-bottom:8px}.input-wrapper .optional[data-v-34d7bb8c]{color:#5a72b5;font-size:.9em}.input-wrapper .input[data-v-34d7bb8c]{border:1px solid #5a72b5;border-radius:4px;height:40px;padding:8px}code[data-v-34d7bb8c]{background:#e5efe9;border:1px solid #5a72b5;border-radius:4px;padding:2px 4px}.modal-header[data-v-34d7bb8c]{align-items:baseline;display:flex;justify-content:space-between}.close[data-v-34d7bb8c]{background:none;border:none;cursor:pointer;display:flex;height:16px;text-decoration:none;width:16px}.close svg[data-v-34d7bb8c]{width:16px}.modal-wrapper[data-v-34d7bb8c]{align-items:center;background:rgba(0,0,0,.7);display:flex;justify-content:center;inset:0;position:fixed}#modal[data-v-34d7bb8c]{transition:opacity .25s ease-in-out}#modal .modal-body[data-v-34d7bb8c]{max-width:830px;opacity:1;transform:translateY(-100px);transition:opacity .25s ease-in-out;width:100%;z-index:1}.outside-trigger[data-v-34d7bb8c]{cursor:default;inset:0;position:fixed}.button__link[data-v-34d7bb8c]{text-decoration:none}.button[data-v-34d7bb8c]{background-color:#4caf50;border:none;color:#fff;text-align:center;text-decoration:none;display:inline-block;font-size:16px;margin:4px 2px;-webkit-transition-duration:.4s;transition-duration:.4s;cursor:pointer}.button1[data-v-34d7bb8c]{background-color:#fff;color:#000;border:2px solid #4CAF50}.button1[data-v-34d7bb8c]:hover{background-color:#4caf50;color:#fff}.button2[data-v-34d7bb8c]{background-color:#fff;color:#000;border:2px solid #008CBA}.button2[data-v-34d7bb8c]:hover{background-color:#008cba;color:#fff}.btn_box[data-v-34d7bb8c]{width:100%;display:flex;justify-items:center;justify-content:start;align-items:start}
`,document.head.appendChild(Vp);const ec=ne.ref(!1),Qa=ne.ref(!1),wa=e=>{ec.value=!0,Qa.value=!1,ah.value=Object.assign(ah.value,e||{})},rh=e=>{Qa.value=!0,ec.value=!1,ah.value=Object.assign(ah.value,e||{})},oh=()=>{ec.value=!1,Qa.value=!1},aM={title:"Modal",text:"",oncancel:oh,onsubmit:oh,ongetallentity:oh,ondrawline:oh,docommand:e=>{}},ah=ne.ref(aM),Gg=()=>({isModalVisible:ec,isToolsVisible:Qa,showModal:wa,showTools:rh,hideModal:oh,modalOptions:ah}),sM=e=>(ne.pushScopeId("data-v-94f556e8"),e=e(),ne.popScopeId(),e),lM={key:0,class:"modal-wrapper",id:"modal"},cM={class:"modal-body card"},uM={class:"modal-header"},hM={class:"heading"},dM=[sM(()=>ne.createElementVNode("svg",{viewBox:"0 0 24 24"},[ne.createElementVNode("path",{d:"M24 20.188l-8.315-8.209 8.2-8.282-3.697-3.697-8.212 8.318-8.31-8.203-3.666 3.666 8.321 8.24-8.206 8.313 3.666 3.666 8.237-8.318 8.285 8.203z"})],-1))],pM={style:{"overflow-y":"auto",height:"500px"}},fM={class:"btn_box"},mM={class:"btn_box"},gM={class:"btn_box"},yM={class:"btn_box"},_M={class:"btn_box"},vM={class:"btn_box"},xM={class:"btn_box"},bM={class:"btn_box"},wM={class:"btn_box"},MM={class:"btn_box"},TM={class:"btn_box"},EM={class:"btn_box"},CM={class:"btn_box"},AM={class:"btn_box"},SM={class:"btn_box"},DM=ne.defineComponent({__name:"Modal",setup(e){const{isModalVisible:t,hideModal:i,modalOptions:l}=Gg();return(u,h)=>(ne.openBlock(),ne.createBlock(ne.Teleport,{to:"body"},[ne.unref(t)?(ne.openBlock(),ne.createElementBlock("div",lM,[ne.createElementVNode("div",cM,[ne.createElementVNode("div",uM,[ne.createElementVNode("h2",hM,ne.toDisplayString(ne.unref(l).title),1),ne.createElementVNode("a",{href:"#!",onClick:h[0]||(h[0]=(...f)=>ne.unref(i)&&ne.unref(i)(...f)),role:"button",class:"close","aria-label":"close this modal"},dM)]),ne.createElementVNode("div",pM,[ne.createElementVNode("div",fM,[ne.createElementVNode("button",{class:"button button2",onClick:h[1]||(h[1]=f=>ne.unref(l).docommand("Mx_Open_DemoCode"))},"下载开Demo代码"),ne.createElementVNode("button",{class:"button button2",onClick:h[2]||(h[2]=f=>ne.unref(l).docommand("Mx_Open_DevInstall"))},"下载开发包"),ne.createElementVNode("button",{class:"button button2",onClick:h[3]||(h[3]=(...f)=>ne.unref(l).ondrawline&&ne.unref(l).ondrawline(...f))},"调用画圆线命令"),ne.createElementVNode("button",{class:"button button2",onClick:h[4]||(h[4]=f=>ne.unref(l).docommand("MxTest_DrawLine"))},"交互画直线")]),ne.createElementVNode("div",mM,[ne.createElementVNode("button",{class:"button button2",onClick:h[5]||(h[5]=f=>ne.unref(l).docommand("MxTest_AddLayer"))},"添加图层"),ne.createElementVNode("button",{class:"button button2",onClick:h[6]||(h[6]=f=>ne.unref(l).docommand("MxTest_GetAllLayer"))},"得到所有图层"),ne.createElementVNode("button",{class:"button button2",onClick:h[7]||(h[7]=f=>ne.unref(l).docommand("MxTest_GetAllTextStyle"))},"得到所有文字样式"),ne.createElementVNode("button",{class:"button button2",onClick:h[8]||(h[8]=f=>ne.unref(l).docommand("MxTest_GetAllBlock"))},"得到所有图块")]),ne.createElementVNode("div",gM,[ne.createElementVNode("button",{class:"button button2",onClick:h[9]||(h[9]=f=>ne.unref(l).docommand("MxTest_GetAllLinetype"))},"得到所有线型"),ne.createElementVNode("button",{class:"button button2",onClick:h[10]||(h[10]=f=>ne.unref(l).docommand("MxTest_WritexData"))},"写扩展数据"),ne.createElementVNode("button",{class:"button button2",onClick:h[11]||(h[11]=f=>ne.unref(l).docommand("MxTest_ReadxData"))},"读扩展数据"),ne.createElementVNode("button",{class:"button button2",onClick:h[12]||(h[12]=f=>ne.unref(l).docommand("MxTest_InsertBlock"))},"测试插入一个图块")]),ne.createElementVNode("div",yM,[ne.createElementVNode("button",{class:"button button2",onClick:h[13]||(h[13]=f=>ne.unref(l).docommand("Mx_Test_DrawLine"))},"绘直线"),ne.createElementVNode("button",{class:"button button2",onClick:h[14]||(h[14]=f=>ne.unref(l).docommand("Mx_Test_DrawArc"))},"绘圆弧"),ne.createElementVNode("button",{class:"button button2",onClick:h[15]||(h[15]=f=>ne.unref(l).docommand("Mx_Test_DrawCircle"))},"绘圆"),ne.createElementVNode("button",{class:"button button2",onClick:h[16]||(h[16]=f=>ne.unref(l).docommand("Mx_Test_DrawPolyline"))},"绘PL线")]),ne.createElementVNode("div",_M,[ne.createElementVNode("button",{class:"button button2",onClick:h[17]||(h[17]=f=>ne.unref(l).docommand("Mx_Test_DrawHatch"))},"绘填充"),ne.createElementVNode("button",{class:"button button2",onClick:h[18]||(h[18]=f=>ne.unref(l).docommand("Mx_Test_DrawText"))},"绘文字"),ne.createElementVNode("button",{class:"button button2",onClick:h[19]||(h[19]=f=>ne.unref(l).docommand("Mx_Test_Ellipse"))},"绘椭圆"),ne.createElementVNode("button",{class:"button button2",onClick:h[20]||(h[20]=f=>ne.unref(l).docommand("Mx_Test_EllipseArc"))},"绘椭圆弧")]),ne.createElementVNode("div",vM,[ne.createElementVNode("button",{class:"button button2",onClick:h[21]||(h[21]=f=>ne.unref(l).docommand("Mx_Test_MText"))},"绘制多行文字"),ne.createElementVNode("button",{class:"button button2",onClick:h[22]||(h[22]=f=>ne.unref(l).docommand("Mx_Test_DrawTable"))},"绘制表格"),ne.createElementVNode("button",{class:"button button2",onClick:h[23]||(h[23]=f=>ne.unref(l).docommand("Mx_Test_QRCode"))},"绘制二维码"),ne.createElementVNode("button",{class:"button button2",onClick:h[24]||(h[24]=f=>ne.unref(l).docommand("MxTest_InsertStamp"))},"插入图章")]),ne.createElementVNode("div",xM,[ne.createElementVNode("button",{class:"button button2",onClick:h[25]||(h[25]=(...f)=>ne.unref(l).ongetallentity&&ne.unref(l).ongetallentity(...f))},"得到所有对象"),ne.createElementVNode("button",{class:"button button2",onClick:h[26]||(h[26]=f=>ne.unref(l).docommand("MxTest_SelectEntity"))},"交互选择对象"),ne.createElementVNode("button",{class:"button button2",onClick:h[27]||(h[27]=f=>ne.unref(l).docommand("Mx_Export_MxWeb"))},"保存mxweb到服务器"),ne.createElementVNode("button",{class:"button button2",onClick:h[28]||(h[28]=f=>ne.unref(l).docommand("MxTest_GetSysVars"))},"得到系统变量")]),ne.createElementVNode("div",bM,[ne.createElementVNode("button",{class:"button button2",onClick:h[29]||(h[29]=f=>ne.unref(l).docommand("MxTest_NewFile"))},"新建图纸"),ne.createElementVNode("button",{class:"button button2",onClick:h[30]||(h[30]=f=>ne.unref(l).docommand("Mx_ViewBackgroundColor"))},"白色背景色"),ne.createElementVNode("button",{class:"button button2",onClick:h[31]||(h[31]=f=>ne.unref(l).docommand("MxTest_FindText"))},"文字查找定位"),ne.createElementVNode("button",{class:"button button2",onClick:h[32]||(h[32]=f=>ne.unref(l).docommand("MxTest_SelectEntitysToBlock"))},"选择实体做块")]),ne.createElementVNode("div",wM,[ne.createElementVNode("button",{class:"button button2",onClick:h[33]||(h[33]=f=>ne.unref(l).docommand("Mx_Test_Text"))},"绘制单行文字"),ne.createElementVNode("button",{class:"button button2",onClick:h[34]||(h[34]=f=>ne.unref(l).docommand("MxTest_DrawHatchFormPoint"))},"选点填充"),ne.createElementVNode("button",{class:"button button2",onClick:h[35]||(h[35]=f=>ne.unref(l).docommand("Mx_TestExProp"))},"设置扩展属性"),ne.createElementVNode("button",{class:"button button2",onClick:h[36]||(h[36]=f=>ne.unref(l).docommand("Mx_Test_DimAligned"))},"绘制对齐标注")]),ne.createElementVNode("div",MM,[ne.createElementVNode("button",{class:"button button2",onClick:h[37]||(h[37]=f=>ne.unref(l).docommand("Mx_Test_DrawDimRotated"))},"绘性线标注"),ne.createElementVNode("button",{class:"button button2",onClick:h[38]||(h[38]=f=>ne.unref(l).docommand("Mx_Test_DrawDimAngular"))},"角度标注"),ne.createElementVNode("button",{class:"button button2",onClick:h[39]||(h[39]=f=>ne.unref(l).docommand("MxTest_LineTypeTest"))},"修改对象线型"),ne.createElementVNode("button",{class:"button button2",onClick:h[40]||(h[40]=f=>ne.unref(l).docommand("Mx_SelectEntitHideLayer"))},"选择隐藏对象层")]),ne.createElementVNode("div",TM,[ne.createElementVNode("button",{class:"button button2",onClick:h[41]||(h[41]=f=>ne.unref(l).docommand("MxTest_TestAddCurrentSelect"))},"添加到当前选择"),ne.createElementVNode("button",{class:"button button2",onClick:h[42]||(h[42]=f=>ne.unref(l).docommand("MxTest_TestSetViewAngle"))},"视区旋转"),ne.createElementVNode("button",{class:"button button2",onClick:h[43]||(h[43]=f=>ne.unref(l).docommand("MxTest_WriteXRecord"))},"写扩展记录"),ne.createElementVNode("button",{class:"button button2",onClick:h[44]||(h[44]=f=>ne.unref(l).docommand("MxTest_GetNamedObjectsDictionary"))},"得到命名字典")]),ne.createElementVNode("div",EM,[ne.createElementVNode("button",{class:"button button2",onClick:h[45]||(h[45]=f=>ne.unref(l).docommand("MxTest_AddTextStyleTable"))},"添加文字样式"),ne.createElementVNode("button",{class:"button button2",onClick:h[46]||(h[46]=f=>ne.unref(l).docommand("MxTest_DrawCustomEntity"))},"绘自定义实体"),ne.createElementVNode("button",{class:"button button2",onClick:h[47]||(h[47]=f=>ne.unref(l).docommand("Mx_Test_ChangeColor"))},"修改对象颜色"),ne.createElementVNode("button",{class:"button button2",onClick:h[48]||(h[48]=f=>ne.unref(l).docommand("Mx_Test_ChangeVisible"))},"修改对象不可见")]),ne.createElementVNode("div",CM,[ne.createElementVNode("button",{class:"button button2",onClick:h[49]||(h[49]=f=>ne.unref(l).docommand("Mx_Test_ChangeEntityLayer"))},"修改对象层"),ne.createElementVNode("button",{class:"button button2",onClick:h[50]||(h[50]=f=>ne.unref(l).docommand("Mx_ChaneEntityDrawOrder"))},"修改对象显示顺序"),ne.createElementVNode("button",{class:"button button2",onClick:h[51]||(h[51]=f=>ne.unref(l).docommand("Mx_Export_Pdf"))},"指定范围输出pdf"),ne.createElementVNode("button",{class:"button button2",onClick:h[52]||(h[52]=f=>ne.unref(l).docommand("Mx_Test_DrawImage"))},"绘制image")]),ne.createElementVNode("div",AM,[ne.createElementVNode("button",{class:"button button2",onClick:h[53]||(h[53]=f=>ne.unref(l).docommand("MxTest_GetObjectExDictionaryData"))},"读取对象扩展字典"),ne.createElementVNode("button",{class:"button button2",onClick:h[54]||(h[54]=f=>ne.unref(l).docommand("Mx_Test_Draw3DPolyline"))},"绘制3DPolyline"),ne.createElementVNode("button",{class:"button button2",onClick:h[55]||(h[55]=f=>ne.unref(l).docommand("MxTest_LineText"))},"绘线文本自定义实体"),ne.createElementVNode("button",{class:"button button2",onClick:h[56]||(h[56]=f=>ne.unref(l).docommand("Mx_Test_IntersectWith"))},"计算交点")]),ne.createElementVNode("div",SM,[ne.createElementVNode("button",{class:"button button2",onClick:h[57]||(h[57]=f=>ne.unref(l).docommand("Mx_Test_TrueText"))},"修改文字样式")])])])])):ne.createCommentVNode("",!0)]))}}),Ek="",Hg=(e,t)=>{const i=e.__vccOpts||e;for(const[l,u]of t)i[l]=u;return i},PM=Hg(DM,[["__scopeId","data-v-94f556e8"],["__file","Modal.vue"]]),LM=e=>(ne.pushScopeId("data-v-34d7bb8c"),e=e(),ne.popScopeId(),e),IM={key:0,class:"modal-wrapper",id:"modal"},RM={class:"modal-body card"},zM={class:"modal-header"},kM={class:"heading"},BM=[LM(()=>ne.createElementVNode("svg",{viewBox:"0 0 24 24"},[ne.createElementVNode("path",{d:"M24 20.188l-8.315-8.209 8.2-8.282-3.697-3.697-8.212 8.318-8.31-8.203-3.666 3.666 8.321 8.24-8.206 8.313 3.666 3.666 8.237-8.318 8.285 8.203z"})],-1))],FM={style:{"border-bottom":"2px solid #008CBA","margin-bottom":"8px"}},OM=["onClick"],NM={style:{"overflow-y":"auto",height:"500px"}},UM={class:"btn_box"},VM={class:"btn_box"},GM={class:"btn_box"},HM={class:"btn_box"},WM={class:"btn_box"},jM={style:{"overflow-y":"auto",height:"500px"}},$M={class:"btn_box"},qM={class:"btn_box"},ZM={class:"btn_box"},XM={class:"btn_box"},YM={class:"btn_box"},JM={style:{"overflow-y":"auto",height:"500px"}},KM={class:"btn_box"},QM={class:"btn_box"},e2={class:"btn_box"},t2={class:"btn_box"},n2={class:"btn_box"},i2={style:{"overflow-y":"auto",height:"500px"}},r2={class:"btn_box"},o2={class:"btn_box"},a2={class:"btn_box"},s2={class:"btn_box"},l2={style:{"overflow-y":"auto",height:"500px"}},c2={class:"btn_box"},u2={class:"btn_box"},h2=ne.defineComponent({__name:"Tools",setup(e){const{isToolsVisible:t,hideModal:i,modalOptions:l}=Gg(),u=ne.reactive([{name:"修改工具",id:"fit"},{name:"文字工具",id:"text"},{name:"绘图工具",id:"draw"},{name:"块工具",id:"block"},{name:"测量工具",id:"count"}]),h=ne.ref("fit");return(f,r)=>(ne.openBlock(),ne.createBlock(ne.Teleport,{to:"body"},[ne.unref(t)?(ne.openBlock(),ne.createElementBlock("div",IM,[ne.createElementVNode("div",RM,[ne.createElementVNode("div",zM,[ne.createElementVNode("h2",kM,ne.toDisplayString(ne.unref(l).title),1),ne.createElementVNode("a",{href:"#!",onClick:r[0]||(r[0]=(...v)=>ne.unref(i)&&ne.unref(i)(...v)),role:"button",class:"close","aria-label":"close this modal"},BM)]),ne.createElementVNode("div",FM,[(ne.openBlock(!0),ne.createElementBlock(ne.Fragment,null,ne.renderList(u,v=>(ne.openBlock(),ne.createElementBlock("button",{key:v.id,onClick:()=>{h.value=v.id},class:ne.normalizeClass(h.value===v.id?"btn btn2":"btn")},ne.toDisplayString(v.name),11,OM))),128))]),ne.withDirectives(ne.createElementVNode("div",NM,[ne.createElementVNode("div",UM,[ne.createElementVNode("button",{class:"button button2",onClick:r[1]||(r[1]=v=>ne.unref(l).docommand("Mx_Multicopy"))},"多重复制"),ne.createElementVNode("button",{class:"button button2",onClick:r[2]||(r[2]=v=>ne.unref(l).docommand("Mx_ArcToCircle"))},"弧转圆"),ne.createElementVNode("button",{class:"button button2",onClick:r[3]||(r[3]=v=>ne.unref(l).docommand("Mx_CopyRotation"))},"复制旋转"),ne.createElementVNode("button",{class:"button button2",onClick:r[4]||(r[4]=v=>ne.unref(l).docommand("Mx_CricleTotoll"))},"圆转多边")]),ne.createElementVNode("div",VM,[ne.createElementVNode("button",{class:"button button2",onClick:r[5]||(r[5]=v=>ne.unref(l).docommand("Mx_ChangeColor"))},"修改颜色"),ne.createElementVNode("button",{class:"button button2",onClick:r[6]||(r[6]=v=>ne.unref(l).docommand("Mx_ArcToAngle"))},"圆弧切角"),ne.createElementVNode("button",{class:"button button2",onClick:r[7]||(r[7]=v=>ne.unref(l).docommand("Mx_TemHiding"))},"临时隐藏"),ne.createElementVNode("button",{class:"button button2",onClick:r[8]||(r[8]=v=>ne.unref(l).docommand("Mx_BoxDel"))},"方框删除")]),ne.createElementVNode("div",GM,[ne.createElementVNode("button",{class:"button button2",onClick:r[9]||(r[9]=v=>ne.unref(l).docommand("Mx_AngleCopy"))},"角度复制"),ne.createElementVNode("button",{class:"button button2",onClick:r[10]||(r[10]=v=>ne.unref(l).docommand("Mx_VertexRep"))},"顶点复制"),ne.createElementVNode("button",{class:"button button2",onClick:r[11]||(r[11]=v=>ne.unref(l).docommand("Mx_IntersectBreak"))},"交点打断"),ne.createElementVNode("button",{class:"button button2",onClick:r[12]||(r[12]=v=>ne.unref(l).docommand("Mx_DoubleOff"))},"双向偏移")]),ne.createElementVNode("div",HM,[ne.createElementVNode("button",{class:"button button2",onClick:r[13]||(r[13]=v=>ne.unref(l).docommand("Mx_EitCircle"))},"改圆大小"),ne.createElementVNode("button",{class:"button button2",onClick:r[14]||(r[14]=v=>ne.unref(l).docommand("Mx_LayerTypeScale"))},"线型比例"),ne.createElementVNode("button",{class:"button button2",onClick:r[15]||(r[15]=v=>ne.unref(l).docommand("Mx_Telescoping"))},"伸缩"),ne.createElementVNode("button",{class:"button button2",onClick:r[16]||(r[16]=v=>ne.unref(l).docommand("Mx_ArcOrder"))},"按弧阵列")]),ne.createElementVNode("div",WM,[ne.createElementVNode("button",{class:"button button2",onClick:r[17]||(r[17]=v=>ne.unref(l).docommand("Mx_PlRoundCorners"))},"pl圆角"),ne.createElementVNode("button",{class:"button button2",onClick:r[18]||(r[18]=v=>ne.unref(l).docommand("Mx_PlReverse"))},"pl线反向")])],512),[[ne.vShow,h.value==="fit"]]),ne.withDirectives(ne.createElementVNode("div",jM,[ne.createElementVNode("div",$M,[ne.createElementVNode("button",{class:"button button2",onClick:r[19]||(r[19]=v=>ne.unref(l).docommand("Mx_DrawStart"))},"星形"),ne.createElementVNode("button",{class:"button button2",onClick:r[20]||(r[20]=v=>ne.unref(l).docommand("Mx_ConcavoVex"))},"凹凸线"),ne.createElementVNode("button",{class:"button button2",onClick:r[21]||(r[21]=v=>ne.unref(l).docommand("Mx_ZigzagLine"))},"锯齿线"),ne.createElementVNode("button",{class:"button button2",onClick:r[22]||(r[22]=v=>ne.unref(l).docommand("Mx_CenterRect"))},"中心矩形")]),ne.createElementVNode("div",qM,[ne.createElementVNode("button",{class:"button button2",onClick:r[23]||(r[23]=v=>ne.unref(l).docommand("Mx_BreakLine"))},"折断线"),ne.createElementVNode("button",{class:"button button2",onClick:r[24]||(r[24]=v=>ne.unref(l).docommand("Mx_CCLine"))},"圆中心线"),ne.createElementVNode("button",{class:"button button2",onClick:r[25]||(r[25]=v=>ne.unref(l).docommand("Mx_Piping"))},"管道"),ne.createElementVNode("button",{class:"button button2",onClick:r[26]||(r[26]=v=>ne.unref(l).docommand("Mx_CutPipeline"))},"剖管符")]),ne.createElementVNode("div",ZM,[ne.createElementVNode("button",{class:"button button2",onClick:r[27]||(r[27]=v=>ne.unref(l).docommand("Mx_PerpLine"))},"中垂线"),ne.createElementVNode("button",{class:"button button2",onClick:r[28]||(r[28]=v=>ne.unref(l).docommand("Mx_StairLine"))},"楼梯"),ne.createElementVNode("button",{class:"button button2",onClick:r[29]||(r[29]=v=>ne.unref(l).docommand("Mx_SolidCircle"))},"实心圆"),ne.createElementVNode("button",{class:"button button2",onClick:r[30]||(r[30]=v=>ne.unref(l).docommand("Mx_CottonInsulation"))},"保温棉")]),ne.createElementVNode("div",XM,[ne.createElementVNode("button",{class:"button button2",onClick:r[31]||(r[31]=v=>ne.unref(l).docommand("Mx_CenterLine"))},"中心线"),ne.createElementVNode("button",{class:"button button2",onClick:r[32]||(r[32]=v=>ne.unref(l).docommand("Mx_DoHole"))},"开洞"),ne.createElementVNode("button",{class:"button button2",onClick:r[33]||(r[33]=v=>ne.unref(l).docommand("Mx_Compass"))},"指北针"),ne.createElementVNode("button",{class:"button button2",onClick:r[34]||(r[34]=v=>ne.unref(l).docommand("Mx_MassegeBox"))},"消息框")]),ne.createElementVNode("div",YM,[ne.createElementVNode("button",{class:"button button2",onClick:r[35]||(r[35]=v=>ne.unref(l).docommand("Mx_DatumSymbol"))},"基准符"),ne.createElementVNode("button",{class:"button button2",onClick:r[36]||(r[36]=v=>ne.unref(l).docommand("Mx_WelLine"))},"焊缝线")])],512),[[ne.vShow,h.value==="draw"]]),ne.withDirectives(ne.createElementVNode("div",JM,[ne.createElementVNode("div",KM,[ne.createElementVNode("button",{class:"button button2",onClick:r[37]||(r[37]=v=>ne.unref(l).docommand("Mx_AlignByLine"))},"按线对齐"),ne.createElementVNode("button",{class:"button button2",onClick:r[38]||(r[38]=v=>ne.unref(l).docommand("Mx_TextHeight"))},"改字高"),ne.createElementVNode("button",{class:"button button2",onClick:r[39]||(r[39]=v=>ne.unref(l).docommand("Mx_TextWidth"))},"改字宽"),ne.createElementVNode("button",{class:"button button2",onClick:r[40]||(r[40]=v=>ne.unref(l).docommand("Mx_BrushCon"))},"刷内容")]),ne.createElementVNode("div",QM,[ne.createElementVNode("button",{class:"button button2",onClick:r[41]||(r[41]=v=>ne.unref(l).docommand("Mx_ReplaceCon"))},"换内容"),ne.createElementVNode("button",{class:"button button2",onClick:r[42]||(r[42]=v=>ne.unref(l).docommand("Mx_AlignLeft"))},"左右对齐"),ne.createElementVNode("button",{class:"button button2",onClick:r[43]||(r[43]=v=>ne.unref(l).docommand("Mx_AlignUp"))},"上下对齐"),ne.createElementVNode("button",{class:"button button2",onClick:r[44]||(r[44]=v=>ne.unref(l).docommand("Mx_TextReversal"))},"文字反转")]),ne.createElementVNode("div",e2,[ne.createElementVNode("button",{class:"button button2",onClick:r[45]||(r[45]=v=>ne.unref(l).docommand("Mx_TextTraming"))},"文字加框"),ne.createElementVNode("button",{class:"button button2",onClick:r[46]||(r[46]=v=>ne.unref(l).docommand("Mx_Underline"))},"下划线"),ne.createElementVNode("button",{class:"button button2",onClick:r[47]||(r[47]=v=>ne.unref(l).docommand("Mx_TitleLine"))},"图名线"),ne.createElementVNode("button",{class:"button button2",onClick:r[48]||(r[48]=v=>ne.unref(l).docommand("Mx_Case"))},"大小写")]),ne.createElementVNode("div",t2,[ne.createElementVNode("button",{class:"button button2",onClick:r[49]||(r[49]=v=>ne.unref(l).docommand("Mx_NumSum"))},"数字求和"),ne.createElementVNode("button",{class:"button button2",onClick:r[50]||(r[50]=v=>ne.unref(l).docommand("Mx_SSWords"))},"选特定字"),ne.createElementVNode("button",{class:"button button2",onClick:r[51]||(r[51]=v=>ne.unref(l).docommand("Mx_Prefix"))},"前后缀"),ne.createElementVNode("button",{class:"button button2",onClick:r[52]||(r[52]=v=>ne.unref(l).docommand("Mx_ConnectText"))},"连接文字")]),ne.createElementVNode("div",n2,[ne.createElementVNode("button",{class:"button button2",onClick:r[53]||(r[53]=v=>ne.unref(l).docommand("Mx_TextTrim"))},"去空格"),ne.createElementVNode("button",{class:"button button2",onClick:r[54]||(r[54]=v=>ne.unref(l).docommand("Mx_VerticalText"))},"文字竖向"),ne.createElementVNode("button",{class:"button button2",onClick:r[55]||(r[55]=v=>ne.unref(l).docommand("Mx_AlignByArc"))},"按弧对齐")])],512),[[ne.vShow,h.value==="text"]]),ne.withDirectives(ne.createElementVNode("div",i2,[ne.createElementVNode("div",r2,[ne.createElementVNode("button",{class:"button button2",onClick:r[56]||(r[56]=v=>ne.unref(l).docommand("Mx_ChangeBN"))},"改块名"),ne.createElementVNode("button",{class:"button button2",onClick:r[57]||(r[57]=v=>ne.unref(l).docommand("Mx_BushBlk"))},"刷块"),ne.createElementVNode("button",{class:"button button2",onClick:r[58]||(r[58]=v=>ne.unref(l).docommand("Mx_ConBlk"))},"块连线"),ne.createElementVNode("button",{class:"button button2",onClick:r[59]||(r[59]=v=>ne.unref(l).docommand("Mx_BlkCenterLine"))},"块中心线")]),ne.createElementVNode("div",o2,[ne.createElementVNode("button",{class:"button button2",onClick:r[60]||(r[60]=v=>ne.unref(l).docommand("Mx_BlkPt"))},"改块基点"),ne.createElementVNode("button",{class:"button button2",onClick:r[61]||(r[61]=v=>ne.unref(l).docommand("Mx_BlkColor"))},"改块颜色"),ne.createElementVNode("button",{class:"button button2",onClick:r[62]||(r[62]=v=>ne.unref(l).docommand("Mx_BlkRotate"))},"多块旋转"),ne.createElementVNode("button",{class:"button button2",onClick:r[63]||(r[63]=v=>ne.unref(l).docommand("Mx_BlkScale"))},"多块缩放")]),ne.createElementVNode("div",a2,[ne.createElementVNode("button",{class:"button button2",onClick:r[64]||(r[64]=v=>ne.unref(l).docommand("Mx_BlkAngle"))},"刷块角度"),ne.createElementVNode("button",{class:"button button2",onClick:r[65]||(r[65]=v=>ne.unref(l).docommand("Mx_BlkSelect"))},"按块选择"),ne.createElementVNode("button",{class:"button button2",onClick:r[66]||(r[66]=v=>ne.unref(l).docommand("Mx_BlkAllSelect"))},"按块全选"),ne.createElementVNode("button",{class:"button button2",onClick:r[67]||(r[67]=v=>ne.unref(l).docommand("Mx_SSBlk"))},"统计单块")]),ne.createElementVNode("div",s2,[ne.createElementVNode("button",{class:"button button2",onClick:r[68]||(r[68]=v=>ne.unref(l).docommand("Mx_SMBlk"))},"统计多块")])],512),[[ne.vShow,h.value==="block"]]),ne.withDirectives(ne.createElementVNode("div",l2,[ne.createElementVNode("div",c2,[ne.createElementVNode("button",{class:"button button2",onClick:r[69]||(r[69]=v=>ne.unref(l).docommand("Mx_StaLength"))},"长度"),ne.createElementVNode("button",{class:"button button2",onClick:r[70]||(r[70]=v=>ne.unref(l).docommand("Mx_StaArea"))},"面积"),ne.createElementVNode("button",{class:"button button2",onClick:r[71]||(r[71]=v=>ne.unref(l).docommand("Mx_StandardSlope"))},"标斜率"),ne.createElementVNode("button",{class:"button button2",onClick:r[72]||(r[72]=v=>ne.unref(l).docommand("Mx_CoordAnnotation"))},"坐标标注")]),ne.createElementVNode("div",u2,[ne.createElementVNode("button",{class:"button button2",onClick:r[73]||(r[73]=v=>ne.unref(l).docommand("Mx_Elevation"))},"智能标高"),ne.createElementVNode("button",{class:"button button2",onClick:r[74]||(r[74]=v=>ne.unref(l).docommand("Mx_Roughness"))},"粗糙度")])],512),[[ne.vShow,h.value==="count"]])])])):ne.createCommentVNode("",!0)]))}}),Ak="",d2=Hg(h2,[["__scopeId","data-v-34d7bb8c"],["__file","Tools.vue"]]),p2=Hg(ne.defineComponent({__name:"Test",setup(e){return(t,i)=>(ne.openBlock(),ne.createElementBlock("div",null,[ne.createVNode(PM),ne.createVNode(d2)]))}}),[["__file","Test.vue"]]),f2={init(){Le.MxFun.setPostMessageToParentFrameFunction(function(e){top.postMessage(e,"*")}),window.addEventListener("message",function(e){e.data.type==="sendStringToExecute"?Le.MxFun.sendStringToExecute(e.data.cmd,e.data):(console.log("mx:unprocessed message:"),console.log(e.data))},!1)}};function m2(){f2.init()}function g2(){return lt(this,null,function*(){const e=new Le.MrxDbgUiPrPoint;e.setMessage(`
指定第一点:`),e.go(t=>{if(t!=0)return;const i=e.value();let l=new Le.MxDbLeadComment;l.point1=i.clone(),l.textHeight=Le.MxFun.screenCoordLong2Doc(50),l.text="测试Test1",l.textWidth=Le.MxFun.screenCoordLong2Doc(300),l.fixedSize=!0,l.fixedSize&&(l.textHeight=50,l.textWidth=250),l.color=P.MxCpp.getCurrentMxCAD().getCurrentDatabaseDrawColor();const u=new Le.McEdGetPointWorldDrawObject;u.setDraw((h,f)=>{l.point2=h,f.drawCustomEntity(l)}),e.setBasePt(i),e.setUseBasePt(!0),e.setUserDraw(u),e.setMessage(`
指定第二点:`),e.go(h=>{if(h!=0){console.log(h);return}const f=e.value();l.point2=f,Le.MxFun.addToCurrentSpace(l)})})})}function y2(){Le.MxFun.getCurrentDraw().createCanvasImageData(e=>{const t=window.open();t!=null&&(t.document.write('<img src="'+e+'"/>'),setTimeout(()=>{t.print()},300))},{width:349,height:536})}function _2(){return lt(this,null,function*(){let e=P.MxCpp.getCurrentMxCAD().getCurrentDatabaseDrawColor();const t=new Le.MrxDbgUiPrPoint,i=Le.MxFun.getCurrentDraw(),l=new Le.McEdGetPointWorldDrawObject,u=new Le.MxDbRectBoxLeadComment;u.color=e.getHex(),u.color==0&&(u.color=65793),u.radius=Le.MxFun.screenCoordLong2Doc(8),u.setLineWidth(3),u.setLineWidthByPixels(!0),t.setMessage(`
云线框起始点:`),t.go(h=>{h==Le.MrxDbgUiPrBaseReturn.kOk&&(u.point1=t.value(),l.setDraw(f=>{u.point2=f,l.drawCustomEntity(u)}),t.setUserDraw(l),t.setMessage(`
云线框结束点:`),t.go(f=>{f==Le.MrxDbgUiPrBaseReturn.kOk&&(u.point2=t.value(),l.setDraw(r=>{u.point3=r,l.drawCustomEntity(u)}),u.text="审图批注XXXXXXXXXX",u.textWidth=Le.MxFun.screenCoordLong2Doc(200),u.textHeight=Le.MxFun.screenCoordLong2Doc(50),u.fixedSize=!0,u.fixedSize&&(u.textHeight=20,u.textWidth=230),t.setMessage(`
审图标注点:`),t.go(r=>{r==Le.MrxDbgUiPrBaseReturn.kOk&&(u.point3=t.value(),i.addMxEntity(u))}))}))})})}function Wg(e,t){let i=Le.MxFun.screenCoordLong2World(t?e:e-e/3);return i=Le.MxFun.worldCoordLong2Doc(i),i}function v2(){const e=new Le.McEdGetPointWorldDrawObject,t=new Le.MxDbArrow,i=Le.MxFun.getCurrentDraw(),l=new Le.MrxDbgUiPrPoint;l.setUserDraw(e),t.setLineWidth(10),t.innerOffset=Wg(10),t.outerOffset=Wg(22),t.topOffset=Wg(36),t.color=P.MxCpp.getCurrentMxCAD().getCurrentDatabaseDrawColor(),l.go(()=>{t.startPoint=l.value(),e.setDraw(u=>{t.endPoint=u,e.drawCustomEntity(t)}),l.go(u=>lt(this,null,function*(){t.endPoint=l.value(),i.addMxEntity(t)}))})}function x2(){const e=new Le.MrxDbgUiPrPoint,t=Le.MxFun.getCurrentDraw(),i=new Le.McEdGetPointWorldDrawObject,l=Le.MxFun.screenCoordLong2Doc(16);e.setMessage(`
点击开启绘制云线:`),e.go(()=>{let u=e.value();const h=new Le.MxDbCloudLine;h.setRadius(l),h.addPoint(u),h.color=P.MxCpp.getCurrentMxCAD().getCurrentDatabaseDrawColor(),i.setDraw(f=>{u.distanceTo(f)>l&&(u=f.clone(),h.addPoint(f,!0)),i.drawCustomEntity(h)}),e.setUserDraw(i),e.setMessage(`
再次点击结束绘制云线:`),e.go(()=>{t.addMxEntity(h)})})}let Gp="";function b2(){Gp=Le.MxFun.getCurrentDraw().saveMxEntityToJson(),console.log(Gp)}function w2(){return lt(this,null,function*(){if(Gp.length==0)return;let e=Le.MxFun.getCurrentDraw();yield e.loadMxEntityFromJson(Gp,["models/svg/mark.svg"]),e.updateDisplay()})}function M2(){const e=new Le.MrxDbgUiPrPoint;e.setMessage(`
指定第一点:`),e.go(t=>{if(t!=0)return;const i=e.value();let l=new Le.MxDbArea;l.addPoint(i),l.color=P.MxCpp.getCurrentMxCAD().getCurrentDatabaseDrawColor();const u=new Le.McEdGetPointWorldDrawObject;u.setDraw((h,f)=>{let r=l.clone();r.addPoint(h),u.drawCustomEntity(r)}),e.setUserDraw(u),e.setMessage(`
指定下一点:`),e.goWhile(h=>{if(h==0){const f=e.value();l.addPoint(f)}},h=>{l.isFill=!0,l.fillOpacity=.7,l.fillColor=6697540,Le.MxFun.getCurrentDraw().addMxEntity(l)})})}function T2(){Le.MxFun.addCommand("BR_Comment",g2),Le.MxFun.addCommand("BR_CheckDraw",_2),Le.MxFun.addCommand("BR_Arrow",v2),Le.MxFun.addCommand("BR_CloudLine",x2),Le.MxFun.addCommand("BR_Print",y2),Le.MxFun.addCommand("BR_SaveAllMxEntity",b2),Le.MxFun.addCommand("BR_LoadAllMxEntity",w2),Le.MxFun.addCommand("BR_Area",M2)}function E2(){let e=P.MxCpp.getCurrentMxCAD();e.newFile(),e.drawColorIndex=0,e.drawLinetype="",e.drawLineWidth=0,e.addLayer("LineLayer"),e.drawLayer="LineLayer",e.drawLine(0,0,100,0),e.drawLine(200,0,300,100),e.addLinetype("MyLineType","6,-10"),e.drawLinetype="MyLineType",e.drawLine(0,30,100,30),e.drawLine(200,30,300,130),e.drawColor=new P.McCmColor(0,0,255),e.drawLine(0,60,100,60),e.drawLine(200,60,300,160),e.drawColorIndex=0,e.drawLinetype="",e.drawLineWidth=4,e.drawLine(0,90,100,90),e.drawLine(200,90,300,190),e.addLinetype("MyLineType2","10,-2,3,-2"),e.drawLinetype="MyLineType2",e.drawColor=new P.McCmColor(255,0,0),e.drawLine(0,120,100,120),e.drawLine(200,120,300,220),e.addTextStyle("MyLineTypeTextStyle","txt.shx","hztxt.shx",1),e.addLinetypeEx("MyLineType3",'(12.7,("T=MxDraw","S=2.54","L=-5.08","R=0.0","X=-2.54","Y=-1.27"),-10.08)',"MyLineTypeTextStyle"),e.drawLinetype="MyLineType3",e.drawLineWidth=0,e.drawLine(350,120,600,120),e.drawColorIndex=0,e.drawLineWidth=4,e.drawLine(350,220,600,220),e.zoomAll(),e.updateDisplay()}function C2(){let e=P.MxCpp.getCurrentMxCAD();e.newFile(),e.drawColorIndex=0,e.drawLinetype="",e.drawLineWidth=0,e.addLayer("ArcLayer"),e.drawLayer="ArcLayer",e.drawArc(0,1e3,100,30,200),e.addLinetype("ArcLineType","30,-5,7,-7"),e.drawLinetype="ArcLineType",e.drawColor=new P.McCmColor(255,25,0),e.drawArc(300,1e3,100,30,200),e.drawLineWidth=15,e.drawColorIndex=255,e.drawArc(600,1e3,100,30,200),e.drawArc2(800,1e3,900,1200,1e3,900),e.drawLinetype="",e.drawLineWidth=40,e.drawArc3(1200,1e3,1400,1e3,.6),e.zoomAll(),e.regen(),e.updateDisplay()}function A2(){let e=P.MxCpp.getCurrentMxCAD();e.newFile(),e.drawColorIndex=0,e.drawLinetype="",e.drawLineWidth=0,e.addLayer("CircleLayer"),e.drawLayer="CircleLayer",e.drawCircle(0,800,120),e.addLinetype("CircleLineType","30,-5,7,-7"),e.drawLinetype="CircleLineType",e.drawColor=new P.McCmColor(0,25,255),e.drawCircle(300,800,120),e.addLinetype("CircleLineType","30,-5,7,-7"),e.drawLinetype="CircleLineType",e.drawLineWidth=40,e.drawCircle(600,800,120),e.zoomAll(),e.regen(),e.updateDisplay()}function S2(){let e=P.MxCpp.getCurrentMxCAD();e.newFile(),e.drawColorIndex=0,e.drawLinetype="",e.drawLineWidth=0,e.addLayer("PolylineLayer"),e.drawLayer="PolylineLayer",e.pathMoveTo(0,300),e.pathLineTo(100,300),e.pathLineTo(100,400),e.pathLineTo(0,400),e.pathMakeClosed(),e.drawPathToPolyline(),e.pathMoveTo(200,300),e.pathLineTo(300,300),e.pathLineTo(300,400),e.pathLineTo(200,400),e.pathMakeClosed(),e.addLinetype("MyLineType3","30,-10"),e.drawLinetype="MyLineType3",e.drawColorIndex=255,e.drawLineWidth=5,e.drawPathToPolyline(),e.pathMoveTo(400,300),e.pathLineTo(500,300),e.pathLineTo(500,400),e.pathLineTo(400,400),e.pathMakeClosed(),e.drawLinetype="",e.drawColor=new P.McCmColor(0,25,255),e.drawLineWidth=10,e.drawPathToPolyline(),e.pathMoveTo(400,300),e.pathLineTo(500,300),e.pathLineTo(500,400),e.pathLineTo(400,400),e.pathMakeClosed(),e.drawLinetype="",e.drawColor=new P.McCmColor(255,25,0),e.drawLineWidth=10,e.drawPathToPolyline(),e.pathMoveTo(600,300),e.pathLineTo(700,300),e.pathLineTo(700,400),e.pathLineTo(600,400),e.drawLinetype="",e.drawColor=new P.McCmColor(0,255,0),e.drawLineWidth=10,e.drawPathToPolyline(),e.pathMoveTo(800,300),e.pathLineTo(900,300),e.pathLineTo(900,400),e.pathMakeClosed(),e.drawLinetype="",e.drawColor=new P.McCmColor(25,255,0),e.drawLineWidth=10,e.drawPathToPolyline(),e.pathMoveToEx(1e3,300,10,10,0),e.pathLineToEx(1e3,500,30,0,0),e.pathLineTo(1e3,580),e.drawPathToPolyline(),e.pathMoveToEx(1200,300,10,10,0),e.pathLineToEx(1200,500,30,0,0),e.pathLineTo(1200,580),e.drawColor=new P.McCmColor(25,255,0),e.drawLinetype="MyLineType3",e.drawPathToPolyline(),e.pathMoveToEx(1400,300,10,10,-.34),e.pathLineToEx(1400,500,30,0,.34),e.pathLineTo(1400,600),e.drawColor=new P.McCmColor(255,255,25),e.drawLinetype="MyLineType3",e.drawPathToPolyline(),e.zoomAll(),e.regen(),e.updateDisplay()}function D2(){let e=P.MxCpp.getCurrentMxCAD();e.newFile(),e.drawColorIndex=0,e.drawLinetype="",e.drawLineWidth=0,e.addLayer("HatchLayer"),e.drawLayer="HatchLayer",e.pathMoveToEx(200,3300,0,0,.3),e.pathLineTo(300,3300),e.pathLineTo(300,3400),e.pathLineTo(200,3300),e.drawColor=new P.McCmColor(25,255,0),e.drawPathToHatch(1),e.pathMoveTo(150,3300),e.pathLineTo(250,3300),e.pathLineTo(250,3400),e.pathLineTo(150,3300),e.drawColor=new P.McCmColor(255,0,0),e.drawPathToHatch(1),e.pathMoveToEx(440,3310,0,0,0),e.pathLineTo(480,3310),e.pathLineTo(480,3360),e.pathLineTo(450,3340),e.pathMakeExclude(!0),e.pathMoveToEx(400,3300,0,0,.3),e.pathLineTo(500,3300),e.pathLineTo(500,3400),e.pathLineTo(400,3300),e.drawColor=new P.McCmColor(255,25,0),e.drawPathToHatch(1),e.addPatternDefinition("MyHatchPattern1","((45, 0,0, 0,0.125))"),e.drawPatternDefinition="MyHatchPattern1",e.pathMoveToEx(600,3300,0,0,.3),e.pathLineTo(700,3300),e.pathLineTo(700,3400),e.pathLineTo(600,3300),e.drawPathToHatch(100),e.addPatternDefinition("MyHatchPattern2","((45, 0,0, 0,0.25) (45, 0.176776695,0, 0,0.25, 0.125,-0.0625))"),e.drawPatternDefinition="MyHatchPattern2",e.pathMoveToEx(800,3300,0,0,.3),e.pathLineTo(900,3300),e.pathLineTo(900,3400),e.pathLineTo(800,3300),e.drawPathToHatch(100),e.zoomAll(),e.regen(),e.updateDisplay()}function P2(){let e=P.MxCpp.getCurrentMxCAD();e.newFile(),e.drawColorIndex=0,e.addLayer("TextLayer"),e.drawLayer="TextLayer",e.drawText(0,1900,"绘图控件文字测试",100,0,0,1),e.drawColor=new P.McCmColor(255,25,0),e.drawText(3e3,2100,"绘图控件文字测试",100,-20,2,1),e.addTextStyle("MyTextStyle","italicc.shx","gbcbig.shx",.7),e.drawTextStyle="MyTextStyle",e.drawColor=new P.McCmColor(255,0,0),e.drawText(0,3e3,"绘图控件文字测试",100,0,0,1),e.AddTureTypeTextStyle("MyTrueTypeTextStyle"),e.drawTextStyle="MyTrueTypeTextStyle",e.drawColor=new P.McCmColor(200,255,50),e.drawText(0,3500,"绘图控件TrueType文字测试",100,0,0,1),e.zoomAll(),e.regen(),e.updateDisplay()}function L2(){let e=P.MxCpp.getCurrentMxCAD();e.newFile(),P.MxCpp.App.loadFonts([],[],["syadobe","simsun"],()=>{e.AddTureTypeTextStyle("ht_style","syadobe"),e.AddTureTypeTextStyle("st_style","simsun"),e.drawTextStyle="ht_style",e.drawColor=new P.McCmColor(200,255,50);let i=e.drawText(0,3500,"绘图控件TrueType文字测试",100,0,0,1).getMcDbEntity();i&&(i.textStyle="st_style"),e.zoomAll(),e.regen(),e.updateDisplay()})}function I2(){let e=P.MxCpp.getCurrentMxCAD();e.newFile(),e.drawColorIndex=0,e.drawLinetype="",e.drawLineWidth=0,e.addLayer("LineLayer"),e.drawLayer="LineLayer",e.drawEllipse(0,1400,100,0,.7),e.addLinetype("MyEllipseType","6,-10"),e.drawLinetype="MyEllipseType",e.drawColor=new P.McCmColor(200,0,0),e.drawEllipse(200,1400,80,30,.5),e.zoomAll(),e.regen(),e.updateDisplay()}function R2(){let e=P.MxCpp.getCurrentMxCAD();e.newFile(),e.drawColorIndex=0,e.drawLineWidth=0,e.addLayer("EllipseArcLayer"),e.drawLayer="EllipseArcLayer",e.drawEllipseArc(0,1600,80,30,.4,30,200),e.addLinetype("MyEllipseArcType","6,-10"),e.drawLinetype="MyEllipseArcType",e.drawColor=new P.McCmColor(200,200,0),e.drawEllipseArc(200,1600,-80,30,.5,60,300),e.drawLinetype="",e.zoomAll(),e.regen(),e.updateDisplay()}function z2(){let e=P.MxCpp.getCurrentMxCAD();e.newFile(),e.drawColorIndex=0,e.addLayer("MtextLayer"),e.drawLayer="MtextLayer",e.drawTextStyle="",e.drawMText(0,-100,"控件:\\P多行文字测试",50,400,0,1),e.zoomAll(),e.regen(),e.updateDisplay()}function k2(e){if(!e||!e.param)return;let t=P.MxCpp.getCurrentMxCAD();t.newFile(),t.drawColorIndex=0,t.drawLinetype="",t.drawLineWidth=0,t.addLayer("LineLayer"),t.drawLayer="LineLayer",t.drawLine(e.param.x1,e.param.y1,e.param.x2,e.param.y2),t.zoomAll(),t.updateDisplay(),Le.MxFun.postMessageToParentFrame({cmd:"Mx_ParamDrawLine",message:"ok"})}function B2(){let e=P.MxCpp.getCurrentMxCAD();e.newFile(),e.drawText(350831.77,1940511845e-2,"1.034",10,0,P.McDb.TextHorzMode.kTextLeft,P.McDb.TextVertMode.kTextVertMid),e.zoomAll(),e.regen(100)}function F2(){let e=P.MxCpp.getCurrentMxCAD();e.newFile(),e.addDimStyle("MyDimStyle","41,0.18,141,0.09,40,200","77,1,271,3","",""),e.drawDimStyle="MyDimStyle",e.drawColorIndex=0,e.drawLinetype="",e.drawLineWidth=0,e.drawDimAligned(0,4e3,300,4500,150,4600),e.zoomAll(),e.updateDisplay()}function O2(){let e=P.MxCpp.getCurrentMxCAD();e.newFile(),e.addDimStyle("MyDimStyle","41,0.18,141,0.09,40,200","77,1,271,3","",""),e.drawDimStyle="MyDimStyle",e.drawColorIndex=0,e.drawLinetype="",e.drawLineWidth=0,e.drawDimRotated(0,7e3,600,7e3,250,7050,0),e.drawDimRotated(0,7200,0,7600,150,7300,.771),e.zoomAll(),e.updateDisplay()}function N2(){let e=P.MxCpp.getCurrentMxCAD();e.newFile(),e.addDimStyle("MyDimStyle2","41,0.18,141,0.09,40,200","77,1,271,3","",""),e.drawDimStyle="MyDimStyle2",e.drawColorIndex=0,e.drawLinetype="",e.drawLineWidth=0,e.drawDimAngular(500,5e3,0,5500,1e3,5500,500,5500),e.zoomAll(),e.updateDisplay()}function U2(){Le.MxFun.addCommand("Mx_Test_DrawLine",E2),Le.MxFun.addCommand("Mx_Test_DrawArc",C2),Le.MxFun.addCommand("Mx_Test_DrawCircle",A2),Le.MxFun.addCommand("Mx_Test_DrawPolyline",S2),Le.MxFun.addCommand("Mx_Test_DrawHatch",D2),Le.MxFun.addCommand("Mx_Test_DrawText",P2),Le.MxFun.addCommand("Mx_Test_Ellipse",I2),Le.MxFun.addCommand("Mx_Test_EllipseArc",R2),Le.MxFun.addCommand("Mx_Test_MText",z2),Le.MxFun.addCommand("Mx_Test_Text",B2),Le.MxFun.addCommand("Mx_ParamDrawLine",k2),Le.MxFun.addCommand("Mx_Test_DimAligned",F2),Le.MxFun.addCommand("Mx_Test_DrawDimRotated",O2),Le.MxFun.addCommand("Mx_Test_DrawDimAngular",N2),Le.MxFun.addCommand("Mx_Test_TrueText",L2)}Number.EPSILON===void 0&&(Number.EPSILON=Math.pow(2,-52)),Number.isInteger===void 0&&(Number.isInteger=function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e}),Math.sign===void 0&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype||Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),Object.assign===void 0&&(Object.assign=function(e){if(e==null)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var l=arguments[i];if(l!=null)for(var u in l)Object.prototype.hasOwnProperty.call(l,u)&&(t[u]=l[u])}return t});var V2="113",G2=0,ox=1,H2=2,ax=1,W2=2,sh=3,tc=0,tr=1,lh=2,sx=1,lx=0,j2=1,nc=2,es=0,ch=1,cx=2,ux=3,hx=4,$2=5,ic=100,q2=101,Z2=102,dx=103,px=104,X2=200,Y2=201,J2=202,K2=203,fx=204,mx=205,Q2=206,eT=207,tT=208,nT=209,iT=210,rT=0,oT=1,aT=2,jg=3,sT=4,lT=5,cT=6,uT=7,Hp=0,hT=1,dT=2,Wp=0,$g=1,pT=2,fT=3,mT=4,gT=5,qg=300,Zg=301,Xg=302,gx=303,Yg=304,yx=305,uh=306,Jg=307,Xs=1e3,wr=1001,hh=1002,Ui=1003,jp=1004,$p=1005,$i=1006,Kg=1007,rc=1008,qp=1009,yT=1010,_T=1011,Zp=1012,vT=1013,_x=1014,dh=1015,Qg=1016,xT=1017,bT=1018,wT=1019,Xp=1020,MT=1021,Ma=1022,Ao=1023,TT=1024,ET=1025,CT=Ao,oc=1026,ph=1027,AT=1028,ST=1029,DT=1030,PT=1031,LT=1032,IT=1033,vx=33776,xx=33777,bx=33778,wx=33779,Tx=35840,Ex=35841,Cx=35842,Ax=35843,RT=36196,zT=37808,kT=37809,BT=37810,FT=37811,OT=37812,NT=37813,UT=37814,VT=37815,GT=37816,HT=37817,WT=37818,jT=37819,$T=37820,qT=37821,ZT=2200,XT=2201,YT=2202,fh=2300,ac=2301,ey=2302,sc=2400,lc=2401,Yp=2402,JT=0,KT=1,Sx=2,no=3e3,mh=3001,Dx=3007,ty=3002,QT=3003,Px=3004,Lx=3005,Ix=3006,eE=3200,tE=3201,Ys=0,nE=1,ny=7680,iE=519,Jp=35044,gh=35048;function Ta(){}Object.assign(Ta.prototype,{addEventListener:function(e,t){this._listeners===void 0&&(this._listeners={});var i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)},hasEventListener:function(e,t){if(this._listeners===void 0)return!1;var i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1},removeEventListener:function(e,t){if(this._listeners!==void 0){var i=this._listeners,l=i[e];if(l!==void 0){var u=l.indexOf(t);u!==-1&&l.splice(u,1)}}},dispatchEvent:function(e){if(this._listeners!==void 0){var t=this._listeners,i=t[e.type];if(i!==void 0){e.target=this;for(var l=i.slice(0),u=0,h=l.length;u<h;u++)l[u].call(this,e)}}}});for(var ar=[],yh=0;yh<256;yh++)ar[yh]=(yh<16?"0":"")+yh.toString(16);var Wn={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0,l=Math.random()*4294967295|0,u=ar[e&255]+ar[e>>8&255]+ar[e>>16&255]+ar[e>>24&255]+"-"+ar[t&255]+ar[t>>8&255]+"-"+ar[t>>16&15|64]+ar[t>>24&255]+"-"+ar[i&63|128]+ar[i>>8&255]+"-"+ar[i>>16&255]+ar[i>>24&255]+ar[l&255]+ar[l>>8&255]+ar[l>>16&255]+ar[l>>24&255];return u.toUpperCase()},clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,l,u){return l+(e-t)*(u-l)/(i-t)},lerp:function(e,t,i){return(1-i)*e+i*t},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*(3-2*e))},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t),e*e*e*(e*(e*6-15)+10))},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*Wn.DEG2RAD},radToDeg:function(e){return e*Wn.RAD2DEG},isPowerOfTwo:function(e){return(e&e-1)===0&&e!==0},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,i,l,u){var h=Math.cos,f=Math.sin,r=h(i/2),v=f(i/2),b=h((t+l)/2),E=f((t+l)/2),M=h((t-l)/2),D=f((t-l)/2),L=h((l-t)/2),z=f((l-t)/2);u==="XYX"?e.set(r*E,v*M,v*D,r*b):u==="YZY"?e.set(v*D,r*E,v*M,r*b):u==="ZXZ"?e.set(v*M,v*D,r*E,r*b):u==="XZX"?e.set(r*E,v*z,v*L,r*b):u==="YXY"?e.set(v*L,r*E,v*z,r*b):u==="ZYZ"?e.set(v*z,v*L,r*E,r*b):console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order.")}};function Lt(e,t){this.x=e||0,this.y=t||0}Object.defineProperties(Lt.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(Lt.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return t!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return t!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,i=this.y,l=e.elements;return this.x=l[0]*t+l[3]*i+l[6],this.y=l[1]*t+l[4]*i+l[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this},clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return t===void 0&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,i){return i!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var i=Math.cos(t),l=Math.sin(t),u=this.x-e.x,h=this.y-e.y;return this.x=u*i-h*l+e.x,this.y=u*l+h*i+e.y,this}});function dr(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.assign(dr.prototype,{isMatrix3:!0,set:function(e,t,i,l,u,h,f,r,v){var b=this.elements;return b[0]=e,b[1]=l,b[2]=f,b[3]=t,b[4]=u,b[5]=r,b[6]=i,b[7]=h,b[8]=v,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return new this.constructor().fromArray(this.elements)},copy:function(e){var t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements,l=t.elements,u=this.elements,h=i[0],f=i[3],r=i[6],v=i[1],b=i[4],E=i[7],M=i[2],D=i[5],L=i[8],z=l[0],k=l[3],F=l[6],G=l[1],X=l[4],re=l[7],ue=l[2],$=l[5],te=l[8];return u[0]=h*z+f*G+r*ue,u[3]=h*k+f*X+r*$,u[6]=h*F+f*re+r*te,u[1]=v*z+b*G+E*ue,u[4]=v*k+b*X+E*$,u[7]=v*F+b*re+E*te,u[2]=M*z+D*G+L*ue,u[5]=M*k+D*X+L*$,u[8]=M*F+D*re+L*te,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[1],l=e[2],u=e[3],h=e[4],f=e[5],r=e[6],v=e[7],b=e[8];return t*h*b-t*f*v-i*u*b+i*f*r+l*u*v-l*h*r},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var i=e.elements,l=this.elements,u=i[0],h=i[1],f=i[2],r=i[3],v=i[4],b=i[5],E=i[6],M=i[7],D=i[8],L=D*v-b*M,z=b*E-D*r,k=M*r-v*E,F=u*L+h*z+f*k;if(F===0){var G="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(t===!0)throw new Error(G);return console.warn(G),this.identity()}var X=1/F;return l[0]=L*X,l[1]=(f*M-D*h)*X,l[2]=(b*h-f*v)*X,l[3]=z*X,l[4]=(D*u-f*E)*X,l[5]=(f*r-b*u)*X,l[6]=k*X,l[7]=(h*E-M*u)*X,l[8]=(v*u-h*r)*X,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,i,l,u,h,f){var r=Math.cos(u),v=Math.sin(u);this.set(i*r,i*v,-i*(r*h+v*f)+h+e,-l*v,l*r,-l*(-v*h+r*f)+f+t,0,0,1)},scale:function(e,t){var i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this},rotate:function(e){var t=Math.cos(e),i=Math.sin(e),l=this.elements,u=l[0],h=l[3],f=l[6],r=l[1],v=l[4],b=l[7];return l[0]=t*u+i*r,l[3]=t*h+i*v,l[6]=t*f+i*b,l[1]=-i*u+t*r,l[4]=-i*h+t*v,l[7]=-i*f+t*b,this},translate:function(e,t){var i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this},equals:function(e){for(var t=this.elements,i=e.elements,l=0;l<9;l++)if(t[l]!==i[l])return!1;return!0},fromArray:function(e,t){t===void 0&&(t=0);for(var i=0;i<9;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){e===void 0&&(e=[]),t===void 0&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}});var cc,Js={getDataURL:function(e){var t;if(typeof HTMLCanvasElement=="undefined")return e.src;if(e instanceof HTMLCanvasElement)t=e;else{cc===void 0&&(cc=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),cc.width=e.width,cc.height=e.height;var i=cc.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=cc}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},rE=0;function mi(e,t,i,l,u,h,f,r,v,b){Object.defineProperty(this,"id",{value:rE++}),this.uuid=Wn.generateUUID(),this.name="",this.image=e!==void 0?e:mi.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=t!==void 0?t:mi.DEFAULT_MAPPING,this.wrapS=i!==void 0?i:wr,this.wrapT=l!==void 0?l:wr,this.magFilter=u!==void 0?u:$i,this.minFilter=h!==void 0?h:rc,this.anisotropy=v!==void 0?v:1,this.format=f!==void 0?f:Ao,this.internalFormat=null,this.type=r!==void 0?r:qp,this.offset=new Lt(0,0),this.repeat=new Lt(1,1),this.center=new Lt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new dr,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=b!==void 0?b:no,this.version=0,this.onUpdate=null}mi.DEFAULT_IMAGE=void 0,mi.DEFAULT_MAPPING=qg,mi.prototype=Object.assign(Object.create(Ta.prototype),{constructor:mi,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];var i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){var l=this.image;if(l.uuid===void 0&&(l.uuid=Wn.generateUUID()),!t&&e.images[l.uuid]===void 0){var u;if(Array.isArray(l)){u=[];for(var h=0,f=l.length;h<f;h++)u.push(Js.getDataURL(l[h]))}else u=Js.getDataURL(l);e.images[l.uuid]={uuid:l.uuid,url:u}}i.image=l.uuid}return t||(e.textures[this.uuid]=i),i},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping!==qg)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Xs:e.x=e.x-Math.floor(e.x);break;case wr:e.x=e.x<0?0:1;break;case hh:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Xs:e.y=e.y-Math.floor(e.y);break;case wr:e.y=e.y<0?0:1;break;case hh:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(mi.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}});function gi(e,t,i,l){this.x=e||0,this.y=t||0,this.z=i||0,this.w=l!==void 0?l:1}Object.defineProperties(gi.prototype,{width:{get:function(){return this.z},set:function(e){this.z=e}},height:{get:function(){return this.w},set:function(e){this.w=e}}}),Object.assign(gi.prototype,{isVector4:!0,set:function(e,t,i,l){return this.x=e,this.y=t,this.z=i,this.w=l,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this},add:function(e,t){return t!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return t!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,i=this.y,l=this.z,u=this.w,h=e.elements;return this.x=h[0]*t+h[4]*i+h[8]*l+h[12]*u,this.y=h[1]*t+h[5]*i+h[9]*l+h[13]*u,this.z=h[2]*t+h[6]*i+h[10]*l+h[14]*u,this.w=h[3]*t+h[7]*i+h[11]*l+h[15]*u,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,i,l,u,h=.01,f=.1,r=e.elements,v=r[0],b=r[4],E=r[8],M=r[1],D=r[5],L=r[9],z=r[2],k=r[6],F=r[10];if(Math.abs(b-M)<h&&Math.abs(E-z)<h&&Math.abs(L-k)<h){if(Math.abs(b+M)<f&&Math.abs(E+z)<f&&Math.abs(L+k)<f&&Math.abs(v+D+F-3)<f)return this.set(1,0,0,0),this;t=Math.PI;var G=(v+1)/2,X=(D+1)/2,re=(F+1)/2,ue=(b+M)/4,$=(E+z)/4,te=(L+k)/4;return G>X&&G>re?G<h?(i=0,l=.707106781,u=.707106781):(i=Math.sqrt(G),l=ue/i,u=$/i):X>re?X<h?(i=.707106781,l=0,u=.707106781):(l=Math.sqrt(X),i=ue/l,u=te/l):re<h?(i=.707106781,l=.707106781,u=0):(u=Math.sqrt(re),i=$/u,l=te/u),this.set(i,l,u,t),this}var oe=Math.sqrt((k-L)*(k-L)+(E-z)*(E-z)+(M-b)*(M-b));return Math.abs(oe)<.001&&(oe=1),this.x=(k-L)/oe,this.y=(E-z)/oe,this.z=(M-b)/oe,this.w=Math.acos((v+D+F-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this},clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return t===void 0&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,i){return i!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}});function Mr(e,t,i){this.width=e,this.height=t,this.scissor=new gi(0,0,e,t),this.scissorTest=!1,this.viewport=new gi(0,0,e,t),i=i||{},this.texture=new mi(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=i.generateMipmaps!==void 0?i.generateMipmaps:!1,this.texture.minFilter=i.minFilter!==void 0?i.minFilter:$i,this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:!0,this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:!0,this.depthTexture=i.depthTexture!==void 0?i.depthTexture:null}Mr.prototype=Object.assign(Object.create(Ta.prototype),{constructor:Mr,isWebGLRenderTarget:!0,setSize:function(e,t){(this.width!==e||this.height!==t)&&(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});function Rx(e,t,i){Mr.call(this,e,t,i),this.samples=4}Rx.prototype=Object.assign(Object.create(Mr.prototype),{constructor:Rx,isWebGLMultisampleRenderTarget:!0,copy:function(e){return Mr.prototype.copy.call(this,e),this.samples=e.samples,this}});function Or(e,t,i,l){this._x=e||0,this._y=t||0,this._z=i||0,this._w=l!==void 0?l:1}Object.assign(Or,{slerp:function(e,t,i,l){return i.copy(e).slerp(t,l)},slerpFlat:function(e,t,i,l,u,h,f){var r=i[l+0],v=i[l+1],b=i[l+2],E=i[l+3],M=u[h+0],D=u[h+1],L=u[h+2],z=u[h+3];if(E!==z||r!==M||v!==D||b!==L){var k=1-f,F=r*M+v*D+b*L+E*z,G=F>=0?1:-1,X=1-F*F;if(X>Number.EPSILON){var re=Math.sqrt(X),ue=Math.atan2(re,F*G);k=Math.sin(k*ue)/re,f=Math.sin(f*ue)/re}var $=f*G;if(r=r*k+M*$,v=v*k+D*$,b=b*k+L*$,E=E*k+z*$,k===1-f){var te=1/Math.sqrt(r*r+v*v+b*b+E*E);r*=te,v*=te,b*=te,E*=te}}e[t]=r,e[t+1]=v,e[t+2]=b,e[t+3]=E}}),Object.defineProperties(Or.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}}),Object.assign(Or.prototype,{isQuaternion:!0,set:function(e,t,i,l){return this._x=e,this._y=t,this._z=i,this._w=l,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this},setFromEuler:function(e,t){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=e._x,l=e._y,u=e._z,h=e.order,f=Math.cos,r=Math.sin,v=f(i/2),b=f(l/2),E=f(u/2),M=r(i/2),D=r(l/2),L=r(u/2);return h==="XYZ"?(this._x=M*b*E+v*D*L,this._y=v*D*E-M*b*L,this._z=v*b*L+M*D*E,this._w=v*b*E-M*D*L):h==="YXZ"?(this._x=M*b*E+v*D*L,this._y=v*D*E-M*b*L,this._z=v*b*L-M*D*E,this._w=v*b*E+M*D*L):h==="ZXY"?(this._x=M*b*E-v*D*L,this._y=v*D*E+M*b*L,this._z=v*b*L+M*D*E,this._w=v*b*E-M*D*L):h==="ZYX"?(this._x=M*b*E-v*D*L,this._y=v*D*E+M*b*L,this._z=v*b*L-M*D*E,this._w=v*b*E+M*D*L):h==="YZX"?(this._x=M*b*E+v*D*L,this._y=v*D*E+M*b*L,this._z=v*b*L-M*D*E,this._w=v*b*E-M*D*L):h==="XZY"&&(this._x=M*b*E-v*D*L,this._y=v*D*E-M*b*L,this._z=v*b*L+M*D*E,this._w=v*b*E+M*D*L),t!==!1&&this._onChangeCallback(),this},setFromAxisAngle:function(e,t){var i=t/2,l=Math.sin(i);return this._x=e.x*l,this._y=e.y*l,this._z=e.z*l,this._w=Math.cos(i),this._onChangeCallback(),this},setFromRotationMatrix:function(e){var t=e.elements,i=t[0],l=t[4],u=t[8],h=t[1],f=t[5],r=t[9],v=t[2],b=t[6],E=t[10],M=i+f+E,D;return M>0?(D=.5/Math.sqrt(M+1),this._w=.25/D,this._x=(b-r)*D,this._y=(u-v)*D,this._z=(h-l)*D):i>f&&i>E?(D=2*Math.sqrt(1+i-f-E),this._w=(b-r)/D,this._x=.25*D,this._y=(l+h)/D,this._z=(u+v)/D):f>E?(D=2*Math.sqrt(1+f-i-E),this._w=(u-v)/D,this._x=(l+h)/D,this._y=.25*D,this._z=(r+b)/D):(D=2*Math.sqrt(1+E-i-f),this._w=(h-l)/D,this._x=(u+v)/D,this._y=(r+b)/D,this._z=.25*D),this._onChangeCallback(),this},setFromUnitVectors:function(e,t){var i=1e-6,l=e.dot(t)+1;return l<i?(l=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=l):(this._x=0,this._y=-e.z,this._z=e.y,this._w=l)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=l),this.normalize()},angleTo:function(e){return 2*Math.acos(Math.abs(Wn.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var i=this.angleTo(e);if(i===0)return this;var l=Math.min(1,t/i);return this.slerp(e,l),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this},multiply:function(e,t){return t!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var i=e._x,l=e._y,u=e._z,h=e._w,f=t._x,r=t._y,v=t._z,b=t._w;return this._x=i*b+h*f+l*v-u*r,this._y=l*b+h*r+u*f-i*v,this._z=u*b+h*v+i*r-l*f,this._w=h*b-i*f-l*r-u*v,this._onChangeCallback(),this},slerp:function(e,t){if(t===0)return this;if(t===1)return this.copy(e);var i=this._x,l=this._y,u=this._z,h=this._w,f=h*e._w+i*e._x+l*e._y+u*e._z;if(f<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,f=-f):this.copy(e),f>=1)return this._w=h,this._x=i,this._y=l,this._z=u,this;var r=1-f*f;if(r<=Number.EPSILON){var v=1-t;return this._w=v*h+t*this._w,this._x=v*i+t*this._x,this._y=v*l+t*this._y,this._z=v*u+t*this._z,this.normalize(),this._onChangeCallback(),this}var b=Math.sqrt(r),E=Math.atan2(b,f),M=Math.sin((1-t)*E)/b,D=Math.sin(t*E)/b;return this._w=h*M+this._w*D,this._x=i*M+this._x*D,this._y=l*M+this._y*D,this._z=u*M+this._z*D,this._onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return t===void 0&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}});var iy=new Se,zx=new Or;function Se(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0}Object.assign(Se.prototype,{isVector3:!0,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(zx.setFromEuler(e))},applyAxisAngle:function(e,t){return this.applyQuaternion(zx.setFromAxisAngle(e,t))},applyMatrix3:function(e){var t=this.x,i=this.y,l=this.z,u=e.elements;return this.x=u[0]*t+u[3]*i+u[6]*l,this.y=u[1]*t+u[4]*i+u[7]*l,this.z=u[2]*t+u[5]*i+u[8]*l,this},applyNormalMatrix:function(e){return this.applyMatrix3(e).normalize()},applyMatrix4:function(e){var t=this.x,i=this.y,l=this.z,u=e.elements,h=1/(u[3]*t+u[7]*i+u[11]*l+u[15]);return this.x=(u[0]*t+u[4]*i+u[8]*l+u[12])*h,this.y=(u[1]*t+u[5]*i+u[9]*l+u[13])*h,this.z=(u[2]*t+u[6]*i+u[10]*l+u[14])*h,this},applyQuaternion:function(e){var t=this.x,i=this.y,l=this.z,u=e.x,h=e.y,f=e.z,r=e.w,v=r*t+h*l-f*i,b=r*i+f*t-u*l,E=r*l+u*i-h*t,M=-u*t-h*i-f*l;return this.x=v*r+M*-u+b*-f-E*-h,this.y=b*r+M*-h+E*-u-v*-f,this.z=E*r+M*-f+v*-h-b*-u,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)},transformDirection:function(e){var t=this.x,i=this.y,l=this.z,u=e.elements;return this.x=u[0]*t+u[4]*i+u[8]*l,this.y=u[1]*t+u[5]*i+u[9]*l,this.z=u[2]*t+u[6]*i+u[10]*l,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this},clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},cross:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var i=e.x,l=e.y,u=e.z,h=t.x,f=t.y,r=t.z;return this.x=l*r-u*f,this.y=u*h-i*r,this.z=i*f-l*h,this},projectOnVector:function(e){var t=e.lengthSq();if(t===0)return this.set(0,0,0);var i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)},projectOnPlane:function(e){return iy.copy(this).projectOnVector(e),this.sub(iy)},reflect:function(e){return this.sub(iy.copy(e).multiplyScalar(2*this.dot(e)))},angleTo:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;var i=this.dot(e)/t;return Math.acos(Wn.clamp(i,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y,l=this.z-e.z;return t*t+i*i+l*l},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,i){var l=Math.sin(t)*e;return this.x=l*Math.sin(i),this.y=Math.cos(t)*e,this.z=l*Math.cos(i),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),l=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=l,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,t*4)},setFromMatrix3Column:function(e,t){return this.fromArray(e.elements,t*3)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return t===void 0&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,i){return i!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}});var uc=new Se,So=new jn,oE=new Se(0,0,0),aE=new Se(1,1,1),ts=new Se,Kp=new Se,io=new Se;function jn(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(jn.prototype,{isMatrix4:!0,set:function(e,t,i,l,u,h,f,r,v,b,E,M,D,L,z,k){var F=this.elements;return F[0]=e,F[4]=t,F[8]=i,F[12]=l,F[1]=u,F[5]=h,F[9]=f,F[13]=r,F[2]=v,F[6]=b,F[10]=E,F[14]=M,F[3]=D,F[7]=L,F[11]=z,F[15]=k,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return new jn().fromArray(this.elements)},copy:function(e){var t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this},copyPosition:function(e){var t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this},extractBasis:function(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this},extractRotation:function(e){var t=this.elements,i=e.elements,l=1/uc.setFromMatrixColumn(e,0).length(),u=1/uc.setFromMatrixColumn(e,1).length(),h=1/uc.setFromMatrixColumn(e,2).length();return t[0]=i[0]*l,t[1]=i[1]*l,t[2]=i[2]*l,t[3]=0,t[4]=i[4]*u,t[5]=i[5]*u,t[6]=i[6]*u,t[7]=0,t[8]=i[8]*h,t[9]=i[9]*h,t[10]=i[10]*h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,i=e.x,l=e.y,u=e.z,h=Math.cos(i),f=Math.sin(i),r=Math.cos(l),v=Math.sin(l),b=Math.cos(u),E=Math.sin(u);if(e.order==="XYZ"){var M=h*b,D=h*E,L=f*b,z=f*E;t[0]=r*b,t[4]=-r*E,t[8]=v,t[1]=D+L*v,t[5]=M-z*v,t[9]=-f*r,t[2]=z-M*v,t[6]=L+D*v,t[10]=h*r}else if(e.order==="YXZ"){var k=r*b,F=r*E,G=v*b,X=v*E;t[0]=k+X*f,t[4]=G*f-F,t[8]=h*v,t[1]=h*E,t[5]=h*b,t[9]=-f,t[2]=F*f-G,t[6]=X+k*f,t[10]=h*r}else if(e.order==="ZXY"){var k=r*b,F=r*E,G=v*b,X=v*E;t[0]=k-X*f,t[4]=-h*E,t[8]=G+F*f,t[1]=F+G*f,t[5]=h*b,t[9]=X-k*f,t[2]=-h*v,t[6]=f,t[10]=h*r}else if(e.order==="ZYX"){var M=h*b,D=h*E,L=f*b,z=f*E;t[0]=r*b,t[4]=L*v-D,t[8]=M*v+z,t[1]=r*E,t[5]=z*v+M,t[9]=D*v-L,t[2]=-v,t[6]=f*r,t[10]=h*r}else if(e.order==="YZX"){var re=h*r,ue=h*v,$=f*r,te=f*v;t[0]=r*b,t[4]=te-re*E,t[8]=$*E+ue,t[1]=E,t[5]=h*b,t[9]=-f*b,t[2]=-v*b,t[6]=ue*E+$,t[10]=re-te*E}else if(e.order==="XZY"){var re=h*r,ue=h*v,$=f*r,te=f*v;t[0]=r*b,t[4]=-E,t[8]=v*b,t[1]=re*E+te,t[5]=h*b,t[9]=ue*E-$,t[2]=$*E-ue,t[6]=f*b,t[10]=te*E+re}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){return this.compose(oE,e,aE)},lookAt:function(e,t,i){var l=this.elements;return io.subVectors(e,t),io.lengthSq()===0&&(io.z=1),io.normalize(),ts.crossVectors(i,io),ts.lengthSq()===0&&(Math.abs(i.z)===1?io.x+=1e-4:io.z+=1e-4,io.normalize(),ts.crossVectors(i,io)),ts.normalize(),Kp.crossVectors(io,ts),l[0]=ts.x,l[4]=Kp.x,l[8]=io.x,l[1]=ts.y,l[5]=Kp.y,l[9]=io.y,l[2]=ts.z,l[6]=Kp.z,l[10]=io.z,this},multiply:function(e,t){return t!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements,l=t.elements,u=this.elements,h=i[0],f=i[4],r=i[8],v=i[12],b=i[1],E=i[5],M=i[9],D=i[13],L=i[2],z=i[6],k=i[10],F=i[14],G=i[3],X=i[7],re=i[11],ue=i[15],$=l[0],te=l[4],oe=l[8],ie=l[12],se=l[1],pe=l[5],me=l[9],he=l[13],Ue=l[2],Ve=l[6],$e=l[10],ct=l[14],At=l[3],yt=l[7],St=l[11],It=l[15];return u[0]=h*$+f*se+r*Ue+v*At,u[4]=h*te+f*pe+r*Ve+v*yt,u[8]=h*oe+f*me+r*$e+v*St,u[12]=h*ie+f*he+r*ct+v*It,u[1]=b*$+E*se+M*Ue+D*At,u[5]=b*te+E*pe+M*Ve+D*yt,u[9]=b*oe+E*me+M*$e+D*St,u[13]=b*ie+E*he+M*ct+D*It,u[2]=L*$+z*se+k*Ue+F*At,u[6]=L*te+z*pe+k*Ve+F*yt,u[10]=L*oe+z*me+k*$e+F*St,u[14]=L*ie+z*he+k*ct+F*It,u[3]=G*$+X*se+re*Ue+ue*At,u[7]=G*te+X*pe+re*Ve+ue*yt,u[11]=G*oe+X*me+re*$e+ue*St,u[15]=G*ie+X*he+re*ct+ue*It,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[4],l=e[8],u=e[12],h=e[1],f=e[5],r=e[9],v=e[13],b=e[2],E=e[6],M=e[10],D=e[14],L=e[3],z=e[7],k=e[11],F=e[15];return L*(+u*r*E-l*v*E-u*f*M+i*v*M+l*f*D-i*r*D)+z*(+t*r*D-t*v*M+u*h*M-l*h*D+l*v*b-u*r*b)+k*(+t*v*E-t*f*D-u*h*E+i*h*D+u*f*b-i*v*b)+F*(-l*f*b-t*r*E+t*f*M+l*h*E-i*h*M+i*r*b)},transpose:function(){var e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},setPosition:function(e,t,i){var l=this.elements;return e.isVector3?(l[12]=e.x,l[13]=e.y,l[14]=e.z):(l[12]=e,l[13]=t,l[14]=i),this},getInverse:function(e,t){var i=this.elements,l=e.elements,u=l[0],h=l[1],f=l[2],r=l[3],v=l[4],b=l[5],E=l[6],M=l[7],D=l[8],L=l[9],z=l[10],k=l[11],F=l[12],G=l[13],X=l[14],re=l[15],ue=L*X*M-G*z*M+G*E*k-b*X*k-L*E*re+b*z*re,$=F*z*M-D*X*M-F*E*k+v*X*k+D*E*re-v*z*re,te=D*G*M-F*L*M+F*b*k-v*G*k-D*b*re+v*L*re,oe=F*L*E-D*G*E-F*b*z+v*G*z+D*b*X-v*L*X,ie=u*ue+h*$+f*te+r*oe;if(ie===0){var se="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(t===!0)throw new Error(se);return console.warn(se),this.identity()}var pe=1/ie;return i[0]=ue*pe,i[1]=(G*z*r-L*X*r-G*f*k+h*X*k+L*f*re-h*z*re)*pe,i[2]=(b*X*r-G*E*r+G*f*M-h*X*M-b*f*re+h*E*re)*pe,i[3]=(L*E*r-b*z*r-L*f*M+h*z*M+b*f*k-h*E*k)*pe,i[4]=$*pe,i[5]=(D*X*r-F*z*r+F*f*k-u*X*k-D*f*re+u*z*re)*pe,i[6]=(F*E*r-v*X*r-F*f*M+u*X*M+v*f*re-u*E*re)*pe,i[7]=(v*z*r-D*E*r+D*f*M-u*z*M-v*f*k+u*E*k)*pe,i[8]=te*pe,i[9]=(F*L*r-D*G*r-F*h*k+u*G*k+D*h*re-u*L*re)*pe,i[10]=(v*G*r-F*b*r+F*h*M-u*G*M-v*h*re+u*b*re)*pe,i[11]=(D*b*r-v*L*r-D*h*M+u*L*M+v*h*k-u*b*k)*pe,i[12]=oe*pe,i[13]=(D*G*f-F*L*f+F*h*z-u*G*z-D*h*X+u*L*X)*pe,i[14]=(F*b*f-v*G*f-F*h*E+u*G*E+v*h*X-u*b*X)*pe,i[15]=(v*L*f-D*b*f+D*h*E-u*L*E-v*h*z+u*b*z)*pe,this},scale:function(e){var t=this.elements,i=e.x,l=e.y,u=e.z;return t[0]*=i,t[4]*=l,t[8]*=u,t[1]*=i,t[5]*=l,t[9]*=u,t[2]*=i,t[6]*=l,t[10]*=u,t[3]*=i,t[7]*=l,t[11]*=u,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],l=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,l))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),l=Math.sin(t),u=1-i,h=e.x,f=e.y,r=e.z,v=u*h,b=u*f;return this.set(v*h+i,v*f-l*r,v*r+l*f,0,v*f+l*r,b*f+i,b*r-l*h,0,v*r-l*f,b*r+l*h,u*r*r+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},makeShear:function(e,t,i){return this.set(1,t,i,0,e,1,i,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,i){var l=this.elements,u=t._x,h=t._y,f=t._z,r=t._w,v=u+u,b=h+h,E=f+f,M=u*v,D=u*b,L=u*E,z=h*b,k=h*E,F=f*E,G=r*v,X=r*b,re=r*E,ue=i.x,$=i.y,te=i.z;return l[0]=(1-(z+F))*ue,l[1]=(D+re)*ue,l[2]=(L-X)*ue,l[3]=0,l[4]=(D-re)*$,l[5]=(1-(M+F))*$,l[6]=(k+G)*$,l[7]=0,l[8]=(L+X)*te,l[9]=(k-G)*te,l[10]=(1-(M+z))*te,l[11]=0,l[12]=e.x,l[13]=e.y,l[14]=e.z,l[15]=1,this},decompose:function(e,t,i){var l=this.elements,u=uc.set(l[0],l[1],l[2]).length(),h=uc.set(l[4],l[5],l[6]).length(),f=uc.set(l[8],l[9],l[10]).length(),r=this.determinant();r<0&&(u=-u),e.x=l[12],e.y=l[13],e.z=l[14],So.copy(this);var v=1/u,b=1/h,E=1/f;return So.elements[0]*=v,So.elements[1]*=v,So.elements[2]*=v,So.elements[4]*=b,So.elements[5]*=b,So.elements[6]*=b,So.elements[8]*=E,So.elements[9]*=E,So.elements[10]*=E,t.setFromRotationMatrix(So),i.x=u,i.y=h,i.z=f,this},makePerspective:function(e,t,i,l,u,h){h===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var f=this.elements,r=2*u/(t-e),v=2*u/(i-l),b=(t+e)/(t-e),E=(i+l)/(i-l),M=-(h+u)/(h-u),D=-2*h*u/(h-u);return f[0]=r,f[4]=0,f[8]=b,f[12]=0,f[1]=0,f[5]=v,f[9]=E,f[13]=0,f[2]=0,f[6]=0,f[10]=M,f[14]=D,f[3]=0,f[7]=0,f[11]=-1,f[15]=0,this},makeOrthographic:function(e,t,i,l,u,h){var f=this.elements,r=1/(t-e),v=1/(i-l),b=1/(h-u),E=(t+e)*r,M=(i+l)*v,D=(h+u)*b;return f[0]=2*r,f[4]=0,f[8]=0,f[12]=-E,f[1]=0,f[5]=2*v,f[9]=0,f[13]=-M,f[2]=0,f[6]=0,f[10]=-2*b,f[14]=-D,f[3]=0,f[7]=0,f[11]=0,f[15]=1,this},equals:function(e){for(var t=this.elements,i=e.elements,l=0;l<16;l++)if(t[l]!==i[l])return!1;return!0},fromArray:function(e,t){t===void 0&&(t=0);for(var i=0;i<16;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){e===void 0&&(e=[]),t===void 0&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}});var kx=new jn,Bx=new Or;function hc(e,t,i,l){this._x=e||0,this._y=t||0,this._z=i||0,this._order=l||hc.DefaultOrder}hc.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],hc.DefaultOrder="XYZ",Object.defineProperties(hc.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}}),Object.assign(hc.prototype,{isEuler:!0,set:function(e,t,i,l){return this._x=e,this._y=t,this._z=i,this._order=l||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this},setFromRotationMatrix:function(e,t,i){var l=Wn.clamp,u=e.elements,h=u[0],f=u[4],r=u[8],v=u[1],b=u[5],E=u[9],M=u[2],D=u[6],L=u[10];return t=t||this._order,t==="XYZ"?(this._y=Math.asin(l(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(-E,L),this._z=Math.atan2(-f,h)):(this._x=Math.atan2(D,b),this._z=0)):t==="YXZ"?(this._x=Math.asin(-l(E,-1,1)),Math.abs(E)<.9999999?(this._y=Math.atan2(r,L),this._z=Math.atan2(v,b)):(this._y=Math.atan2(-M,h),this._z=0)):t==="ZXY"?(this._x=Math.asin(l(D,-1,1)),Math.abs(D)<.9999999?(this._y=Math.atan2(-M,L),this._z=Math.atan2(-f,b)):(this._y=0,this._z=Math.atan2(v,h))):t==="ZYX"?(this._y=Math.asin(-l(M,-1,1)),Math.abs(M)<.9999999?(this._x=Math.atan2(D,L),this._z=Math.atan2(v,h)):(this._x=0,this._z=Math.atan2(-f,b))):t==="YZX"?(this._z=Math.asin(l(v,-1,1)),Math.abs(v)<.9999999?(this._x=Math.atan2(-E,b),this._y=Math.atan2(-M,h)):(this._x=0,this._y=Math.atan2(r,L))):t==="XZY"?(this._z=Math.asin(-l(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(D,b),this._y=Math.atan2(r,h)):(this._x=Math.atan2(-E,L),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,i!==!1&&this._onChangeCallback(),this},setFromQuaternion:function(e,t,i){return kx.makeRotationFromQuaternion(e),this.setFromRotationMatrix(kx,t,i)},setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(e){return Bx.setFromEuler(this),this.setFromQuaternion(Bx,e)},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new Se(this._x,this._y,this._z)},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}});function Fx(){this.mask=1}Object.assign(Fx.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},enableAll:function(){this.mask=-1},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},disableAll:function(){this.mask=0},test:function(e){return(this.mask&e.mask)!==0}});var sE=0,Ox=new Se,dc=new Or,Ea=new jn,Qp=new Se,_h=new Se,lE=new Se,cE=new Or,Nx=new Se(1,0,0),Ux=new Se(0,1,0),Vx=new Se(0,0,1),uE={type:"added"},hE={type:"removed"};function on(){Object.defineProperty(this,"id",{value:sE++}),this.uuid=Wn.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=on.DefaultUp.clone();var e=new Se,t=new hc,i=new Or,l=new Se(1,1,1);function u(){i.setFromEuler(t,!1)}function h(){t.setFromQuaternion(i,void 0,!1)}t._onChange(u),i._onChange(h),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:l},modelViewMatrix:{value:new jn},normalMatrix:{value:new dr}}),this.matrix=new jn,this.matrixWorld=new jn,this.matrixAutoUpdate=on.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Fx,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}on.DefaultUp=new Se(0,1,0),on.DefaultMatrixAutoUpdate=!0,on.prototype=Object.assign(Object.create(Ta.prototype),{constructor:on,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return dc.setFromAxisAngle(e,t),this.quaternion.multiply(dc),this},rotateOnWorldAxis:function(e,t){return dc.setFromAxisAngle(e,t),this.quaternion.premultiply(dc),this},rotateX:function(e){return this.rotateOnAxis(Nx,e)},rotateY:function(e){return this.rotateOnAxis(Ux,e)},rotateZ:function(e){return this.rotateOnAxis(Vx,e)},translateOnAxis:function(e,t){return Ox.copy(e).applyQuaternion(this.quaternion),this.position.add(Ox.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(Nx,e)},translateY:function(e){return this.translateOnAxis(Ux,e)},translateZ:function(e){return this.translateOnAxis(Vx,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(Ea.getInverse(this.matrixWorld))},lookAt:function(e,t,i){e.isVector3?Qp.copy(e):Qp.set(e,t,i);var l=this.parent;this.updateWorldMatrix(!0,!1),_h.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Ea.lookAt(_h,Qp,this.up):Ea.lookAt(Qp,_h,this.up),this.quaternion.setFromRotationMatrix(Ea),l&&(Ea.extractRotation(l.matrixWorld),dc.setFromRotationMatrix(Ea),this.quaternion.premultiply(dc.inverse()))},add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(uE)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var i=this.children.indexOf(e);return i!==-1&&(e.parent=null,this.children.splice(i,1),e.dispatchEvent(hE)),this},attach:function(e){return this.updateWorldMatrix(!0,!1),Ea.getInverse(this.matrixWorld),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Ea.multiply(e.parent.matrixWorld)),e.applyMatrix4(Ea),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var i=0,l=this.children.length;i<l;i++){var u=this.children[i],h=u.getObjectByProperty(e,t);if(h!==void 0)return h}},getWorldPosition:function(e){return e===void 0&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new Se),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return e===void 0&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new Or),this.updateMatrixWorld(!0),this.matrixWorld.decompose(_h,e,lE),e},getWorldScale:function(e){return e===void 0&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new Se),this.updateMatrixWorld(!0),this.matrixWorld.decompose(_h,cE,e),e},getWorldDirection:function(e){e===void 0&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new Se),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,i=0,l=t.length;i<l;i++)t[i].traverse(e)},traverseVisible:function(e){if(this.visible!==!1){e(this);for(var t=this.children,i=0,l=t.length;i<l;i++)t[i].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,i=0,l=t.length;i<l;i++)t[i].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var i=this.parent;if(e===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0)for(var l=this.children,u=0,h=l.length;u<h;u++)l[u].updateWorldMatrix(!1,!0)},toJSON:function(e){var t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var l={};l.uuid=this.uuid,l.type=this.type,this.name!==""&&(l.name=this.name),this.castShadow===!0&&(l.castShadow=!0),this.receiveShadow===!0&&(l.receiveShadow=!0),this.visible===!1&&(l.visible=!1),this.frustumCulled===!1&&(l.frustumCulled=!1),this.renderOrder!==0&&(l.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(l.userData=this.userData),l.layers=this.layers.mask,l.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(l.matrixAutoUpdate=!1),this.isInstancedMesh&&(l.type="InstancedMesh",l.count=this.count,l.instanceMatrix=this.instanceMatrix.toJSON());function u(F,G){return F[G.uuid]===void 0&&(F[G.uuid]=G.toJSON(e)),G.uuid}if(this.isMesh||this.isLine||this.isPoints){l.geometry=u(e.geometries,this.geometry);var h=this.geometry.parameters;if(h!==void 0&&h.shapes!==void 0){var f=h.shapes;if(Array.isArray(f))for(var r=0,v=f.length;r<v;r++){var b=f[r];u(e.shapes,b)}else u(e.shapes,f)}}if(this.material!==void 0)if(Array.isArray(this.material)){for(var E=[],r=0,v=this.material.length;r<v;r++)E.push(u(e.materials,this.material[r]));l.material=E}else l.material=u(e.materials,this.material);if(this.children.length>0){l.children=[];for(var r=0;r<this.children.length;r++)l.children.push(this.children[r].toJSON(e).object)}if(t){var M=k(e.geometries),D=k(e.materials),L=k(e.textures),z=k(e.images),f=k(e.shapes);M.length>0&&(i.geometries=M),D.length>0&&(i.materials=D),L.length>0&&(i.textures=L),z.length>0&&(i.images=z),f.length>0&&(i.shapes=f)}return i.object=l,i;function k(F){var G=[];for(var X in F){var re=F[X];delete re.metadata,G.push(re)}return G}},clone:function(e){return new this.constructor().copy(this,e)},copy:function(e,t){if(t===void 0&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(var i=0;i<e.children.length;i++){var l=e.children[i];this.add(l.clone())}return this}});function Ca(){on.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Ca.prototype=Object.assign(Object.create(on.prototype),{constructor:Ca,isScene:!0,copy:function(e,t){return on.prototype.copy.call(this,e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=on.prototype.toJSON.call(this,e);return this.background!==null&&(t.object.background=this.background.toJSON(e)),this.environment!==null&&(t.object.environment=this.environment.toJSON(e)),this.fog!==null&&(t.object.fog=this.fog.toJSON()),t},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Aa=[new Se,new Se,new Se,new Se,new Se,new Se,new Se,new Se],vh=new Se,ef=new Do,pc=new Se,fc=new Se,mc=new Se,ns=new Se,is=new Se,Ks=new Se,xh=new Se,tf=new Se,nf=new Se,Qs=new Se;function Do(e,t){this.min=e!==void 0?e:new Se(1/0,1/0,1/0),this.max=t!==void 0?t:new Se(-1/0,-1/0,-1/0)}Object.assign(Do.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,i=1/0,l=1/0,u=-1/0,h=-1/0,f=-1/0,r=0,v=e.length;r<v;r+=3){var b=e[r],E=e[r+1],M=e[r+2];b<t&&(t=b),E<i&&(i=E),M<l&&(l=M),b>u&&(u=b),E>h&&(h=E),M>f&&(f=M)}return this.min.set(t,i,l),this.max.set(u,h,f),this},setFromBufferAttribute:function(e){for(var t=1/0,i=1/0,l=1/0,u=-1/0,h=-1/0,f=-1/0,r=0,v=e.count;r<v;r++){var b=e.getX(r),E=e.getY(r),M=e.getZ(r);b<t&&(t=b),E<i&&(i=E),M<l&&(l=M),b>u&&(u=b),E>h&&(h=E),M>f&&(f=M)}return this.min.set(t,i,l),this.max.set(u,h,f),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var i=vh.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this},setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return e===void 0&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new Se),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return e===void 0&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new Se),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(e){e.updateWorldMatrix(!1,!1);var t=e.geometry;t!==void 0&&(t.boundingBox===null&&t.computeBoundingBox(),ef.copy(t.boundingBox),ef.applyMatrix4(e.matrixWorld),this.expandByPoint(ef.min),this.expandByPoint(ef.max));for(var i=e.children,l=0,u=i.length;l<u;l++)this.expandByObject(i[l]);return this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return t===void 0&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new Se),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(e){return this.clampPoint(e.center,vh),vh.distanceToSquared(e.center)<=e.radius*e.radius},intersectsPlane:function(e){var t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant},intersectsTriangle:function(e){if(this.isEmpty())return!1;this.getCenter(xh),tf.subVectors(this.max,xh),pc.subVectors(e.a,xh),fc.subVectors(e.b,xh),mc.subVectors(e.c,xh),ns.subVectors(fc,pc),is.subVectors(mc,fc),Ks.subVectors(pc,mc);var t=[0,-ns.z,ns.y,0,-is.z,is.y,0,-Ks.z,Ks.y,ns.z,0,-ns.x,is.z,0,-is.x,Ks.z,0,-Ks.x,-ns.y,ns.x,0,-is.y,is.x,0,-Ks.y,Ks.x,0];return!ry(t,pc,fc,mc,tf)||(t=[1,0,0,0,1,0,0,0,1],!ry(t,pc,fc,mc,tf))?!1:(nf.crossVectors(ns,is),t=[nf.x,nf.y,nf.z],ry(t,pc,fc,mc,tf))},clampPoint:function(e,t){return t===void 0&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new Se),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){var t=vh.copy(e).clamp(this.min,this.max);return t.sub(e).length()},getBoundingSphere:function(e){return e===void 0&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=this.getSize(vh).length()*.5,e},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(e){return this.isEmpty()?this:(Aa[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Aa[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Aa[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Aa[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Aa[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Aa[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Aa[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Aa[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Aa),this)},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});function ry(e,t,i,l,u){var h,f;for(h=0,f=e.length-3;h<=f;h+=3){Qs.fromArray(e,h);var r=u.x*Math.abs(Qs.x)+u.y*Math.abs(Qs.y)+u.z*Math.abs(Qs.z),v=t.dot(Qs),b=i.dot(Qs),E=l.dot(Qs);if(Math.max(-Math.max(v,b,E),Math.min(v,b,E))>r)return!1}return!0}var dE=new Do;function Sa(e,t){this.center=e!==void 0?e:new Se,this.radius=t!==void 0?t:0}Object.assign(Sa.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(e,t){var i=this.center;t!==void 0?i.copy(t):dE.setFromPoints(e).getCenter(i);for(var l=0,u=0,h=e.length;u<h;u++)l=Math.max(l,i.distanceToSquared(e[u]));return this.radius=Math.sqrt(l),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var i=this.center.distanceToSquared(e);return t===void 0&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new Se),t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return e===void 0&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Do),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}});var Da=new Se,oy=new Se,rf=new Se,rs=new Se,ay=new Se,of=new Se,sy=new Se;function gc(e,t){this.origin=e!==void 0?e:new Se,this.direction=t!==void 0?t:new Se(0,0,-1)}Object.assign(gc.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return t===void 0&&(console.warn("THREE.Ray: .at() target is now required"),t=new Se),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(e){return this.origin.copy(this.at(e,Da)),this},closestPointToPoint:function(e,t){t===void 0&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new Se),t.subVectors(e,this.origin);var i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(e){var t=Da.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Da.copy(this.direction).multiplyScalar(t).add(this.origin),Da.distanceToSquared(e))},distanceSqToSegment:function(e,t,i,l){oy.copy(e).add(t).multiplyScalar(.5),rf.copy(t).sub(e).normalize(),rs.copy(this.origin).sub(oy);var u=e.distanceTo(t)*.5,h=-this.direction.dot(rf),f=rs.dot(this.direction),r=-rs.dot(rf),v=rs.lengthSq(),b=Math.abs(1-h*h),E,M,D,L;if(b>0)if(E=h*r-f,M=h*f-r,L=u*b,E>=0)if(M>=-L)if(M<=L){var z=1/b;E*=z,M*=z,D=E*(E+h*M+2*f)+M*(h*E+M+2*r)+v}else M=u,E=Math.max(0,-(h*M+f)),D=-E*E+M*(M+2*r)+v;else M=-u,E=Math.max(0,-(h*M+f)),D=-E*E+M*(M+2*r)+v;else M<=-L?(E=Math.max(0,-(-h*u+f)),M=E>0?-u:Math.min(Math.max(-u,-r),u),D=-E*E+M*(M+2*r)+v):M<=L?(E=0,M=Math.min(Math.max(-u,-r),u),D=M*(M+2*r)+v):(E=Math.max(0,-(h*u+f)),M=E>0?u:Math.min(Math.max(-u,-r),u),D=-E*E+M*(M+2*r)+v);else M=h>0?-u:u,E=Math.max(0,-(h*M+f)),D=-E*E+M*(M+2*r)+v;return i&&i.copy(this.direction).multiplyScalar(E).add(this.origin),l&&l.copy(rf).multiplyScalar(M).add(oy),D},intersectSphere:function(e,t){Da.subVectors(e.center,this.origin);var i=Da.dot(this.direction),l=Da.dot(Da)-i*i,u=e.radius*e.radius;if(l>u)return null;var h=Math.sqrt(u-l),f=i-h,r=i+h;return f<0&&r<0?null:f<0?this.at(r,t):this.at(f,t)},intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;var i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null},intersectPlane:function(e,t){var i=this.distanceToPlane(e);return i===null?null:this.at(i,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);if(t===0)return!0;var i=e.normal.dot(this.direction);return i*t<0},intersectBox:function(e,t){var i,l,u,h,f,r,v=1/this.direction.x,b=1/this.direction.y,E=1/this.direction.z,M=this.origin;return v>=0?(i=(e.min.x-M.x)*v,l=(e.max.x-M.x)*v):(i=(e.max.x-M.x)*v,l=(e.min.x-M.x)*v),b>=0?(u=(e.min.y-M.y)*b,h=(e.max.y-M.y)*b):(u=(e.max.y-M.y)*b,h=(e.min.y-M.y)*b),i>h||u>l||((u>i||i!==i)&&(i=u),(h<l||l!==l)&&(l=h),E>=0?(f=(e.min.z-M.z)*E,r=(e.max.z-M.z)*E):(f=(e.max.z-M.z)*E,r=(e.min.z-M.z)*E),i>r||f>l)||((f>i||i!==i)&&(i=f),(r<l||l!==l)&&(l=r),l<0)?null:this.at(i>=0?i:l,t)},intersectsBox:function(e){return this.intersectBox(e,Da)!==null},intersectTriangle:function(e,t,i,l,u){ay.subVectors(t,e),of.subVectors(i,e),sy.crossVectors(ay,of);var h=this.direction.dot(sy),f;if(h>0){if(l)return null;f=1}else if(h<0)f=-1,h=-h;else return null;rs.subVectors(this.origin,e);var r=f*this.direction.dot(of.crossVectors(rs,of));if(r<0)return null;var v=f*this.direction.dot(ay.cross(rs));if(v<0||r+v>h)return null;var b=-f*rs.dot(sy);return b<0?null:this.at(b/h,u)},applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}});var ly=new Se,pE=new Se,fE=new dr;function jo(e,t){this.normal=e!==void 0?e:new Se(1,0,0),this.constant=t!==void 0?t:0}Object.assign(jo.prototype,{isPlane:!0,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,i,l){return this.normal.set(e,t,i),this.constant=l,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(e,t,i){var l=ly.subVectors(i,t).cross(pE.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(l,e),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return t===void 0&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new Se),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(e,t){t===void 0&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new Se);var i=e.delta(ly),l=this.normal.dot(i);if(l===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):void 0;var u=-(e.start.dot(this.normal)+this.constant)/l;if(!(u<0||u>1))return t.copy(i).multiplyScalar(u).add(e.start)},intersectsLine:function(e){var t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return e===void 0&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new Se),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(e,t){var i=t||fE.getNormalMatrix(e),l=this.coplanarPoint(ly).applyMatrix4(e),u=this.normal.applyMatrix3(i).normalize();return this.constant=-l.dot(u),this},translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}});var Po=new Se,Pa=new Se,cy=new Se,La=new Se,yc=new Se,_c=new Se,Gx=new Se,uy=new Se,hy=new Se,dy=new Se;function sr(e,t,i){this.a=e!==void 0?e:new Se,this.b=t!==void 0?t:new Se,this.c=i!==void 0?i:new Se}Object.assign(sr,{getNormal:function(e,t,i,l){l===void 0&&(console.warn("THREE.Triangle: .getNormal() target is now required"),l=new Se),l.subVectors(i,t),Po.subVectors(e,t),l.cross(Po);var u=l.lengthSq();return u>0?l.multiplyScalar(1/Math.sqrt(u)):l.set(0,0,0)},getBarycoord:function(e,t,i,l,u){Po.subVectors(l,t),Pa.subVectors(i,t),cy.subVectors(e,t);var h=Po.dot(Po),f=Po.dot(Pa),r=Po.dot(cy),v=Pa.dot(Pa),b=Pa.dot(cy),E=h*v-f*f;if(u===void 0&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),u=new Se),E===0)return u.set(-2,-1,-1);var M=1/E,D=(v*r-f*b)*M,L=(h*b-f*r)*M;return u.set(1-D-L,L,D)},containsPoint:function(e,t,i,l){return sr.getBarycoord(e,t,i,l,La),La.x>=0&&La.y>=0&&La.x+La.y<=1},getUV:function(e,t,i,l,u,h,f,r){return this.getBarycoord(e,t,i,l,La),r.set(0,0),r.addScaledVector(u,La.x),r.addScaledVector(h,La.y),r.addScaledVector(f,La.z),r},isFrontFacing:function(e,t,i,l){return Po.subVectors(i,t),Pa.subVectors(e,t),Po.cross(Pa).dot(l)<0}}),Object.assign(sr.prototype,{set:function(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this},setFromPointsAndIndices:function(e,t,i,l){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[l]),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){return Po.subVectors(this.c,this.b),Pa.subVectors(this.a,this.b),Po.cross(Pa).length()*.5},getMidpoint:function(e){return e===void 0&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new Se),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(.3333333333333333)},getNormal:function(e){return sr.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return e===void 0&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new jo),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return sr.getBarycoord(e,this.a,this.b,this.c,t)},getUV:function(e,t,i,l,u){return sr.getUV(e,this.a,this.b,this.c,t,i,l,u)},containsPoint:function(e){return sr.containsPoint(e,this.a,this.b,this.c)},isFrontFacing:function(e){return sr.isFrontFacing(this.a,this.b,this.c,e)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(e,t){t===void 0&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new Se);var i=this.a,l=this.b,u=this.c,h,f;yc.subVectors(l,i),_c.subVectors(u,i),uy.subVectors(e,i);var r=yc.dot(uy),v=_c.dot(uy);if(r<=0&&v<=0)return t.copy(i);hy.subVectors(e,l);var b=yc.dot(hy),E=_c.dot(hy);if(b>=0&&E<=b)return t.copy(l);var M=r*E-b*v;if(M<=0&&r>=0&&b<=0)return h=r/(r-b),t.copy(i).addScaledVector(yc,h);dy.subVectors(e,u);var D=yc.dot(dy),L=_c.dot(dy);if(L>=0&&D<=L)return t.copy(u);var z=D*v-r*L;if(z<=0&&v>=0&&L<=0)return f=v/(v-L),t.copy(i).addScaledVector(_c,f);var k=b*L-D*E;if(k<=0&&E-b>=0&&D-L>=0)return Gx.subVectors(u,l),f=(E-b)/(E-b+(D-L)),t.copy(l).addScaledVector(Gx,f);var F=1/(k+z+M);return h=z*F,f=M*F,t.copy(i).addScaledVector(yc,h).addScaledVector(_c,f)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}});var Hx={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Lo={h:0,s:0,l:0},af={h:0,s:0,l:0};function tn(e,t,i){return t===void 0&&i===void 0?this.set(e):this.setRGB(e,t,i)}function py(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<.16666666666666666?e+(t-e)*6*i:i<.5?t:i<.6666666666666666?e+(t-e)*6*(.6666666666666666-i):e}function fy(e){return e<.04045?e*.0773993808:Math.pow(e*.9478672986+.0521327014,2.4)}function my(e){return e<.0031308?e*12.92:1.055*Math.pow(e,.41666)-.055}Object.assign(tn.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this},setRGB:function(e,t,i){return this.r=e,this.g=t,this.b=i,this},setHSL:function(e,t,i){if(e=Wn.euclideanModulo(e,1),t=Wn.clamp(t,0,1),i=Wn.clamp(i,0,1),t===0)this.r=this.g=this.b=i;else{var l=i<=.5?i*(1+t):i+t-i*t,u=2*i-l;this.r=py(u,l,e+.3333333333333333),this.g=py(u,l,e),this.b=py(u,l,e-.3333333333333333)}return this},setStyle:function(e){function t(M){M!==void 0&&parseFloat(M)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var i;if(i=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var l,u=i[1],h=i[2];switch(u){case"rgb":case"rgba":if(l=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(h))return this.r=Math.min(255,parseInt(l[1],10))/255,this.g=Math.min(255,parseInt(l[2],10))/255,this.b=Math.min(255,parseInt(l[3],10))/255,t(l[5]),this;if(l=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(h))return this.r=Math.min(100,parseInt(l[1],10))/100,this.g=Math.min(100,parseInt(l[2],10))/100,this.b=Math.min(100,parseInt(l[3],10))/100,t(l[5]),this;break;case"hsl":case"hsla":if(l=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(h)){var f=parseFloat(l[1])/360,r=parseInt(l[2],10)/100,v=parseInt(l[3],10)/100;return t(l[5]),this.setHSL(f,r,v)}break}}else if(i=/^\#([A-Fa-f0-9]+)$/.exec(e)){var b=i[1],E=b.length;if(E===3)return this.r=parseInt(b.charAt(0)+b.charAt(0),16)/255,this.g=parseInt(b.charAt(1)+b.charAt(1),16)/255,this.b=parseInt(b.charAt(2)+b.charAt(2),16)/255,this;if(E===6)return this.r=parseInt(b.charAt(0)+b.charAt(1),16)/255,this.g=parseInt(b.charAt(2)+b.charAt(3),16)/255,this.b=parseInt(b.charAt(4)+b.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this},setColorName:function(e){var t=Hx[e];return t!==void 0?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return t===void 0&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){t===void 0&&(t=2);var i=t>0?1/t:1;return this.r=Math.pow(e.r,i),this.g=Math.pow(e.g,i),this.b=Math.pow(e.b,i),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(e){return this.r=fy(e.r),this.g=fy(e.g),this.b=fy(e.b),this},copyLinearToSRGB:function(e){return this.r=my(e.r),this.g=my(e.g),this.b=my(e.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return this.r*255<<16^this.g*255<<8^this.b*255<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){e===void 0&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t=this.r,i=this.g,l=this.b,u=Math.max(t,i,l),h=Math.min(t,i,l),f,r,v=(h+u)/2;if(h===u)f=0,r=0;else{var b=u-h;switch(r=v<=.5?b/(u+h):b/(2-u-h),u){case t:f=(i-l)/b+(i<l?6:0);break;case i:f=(l-t)/b+2;break;case l:f=(t-i)/b+4;break}f/=6}return e.h=f,e.s=r,e.l=v,e},getStyle:function(){return"rgb("+(this.r*255|0)+","+(this.g*255|0)+","+(this.b*255|0)+")"},offsetHSL:function(e,t,i){return this.getHSL(Lo),Lo.h+=e,Lo.s+=t,Lo.l+=i,this.setHSL(Lo.h,Lo.s,Lo.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:function(e,t){this.getHSL(Lo),e.getHSL(af);var i=Wn.lerp(Lo.h,af.h,t),l=Wn.lerp(Lo.s,af.s,t),u=Wn.lerp(Lo.l,af.l,t);return this.setHSL(i,l,u),this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return t===void 0&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}}),tn.NAMES=Hx;function sf(e,t,i,l,u,h){this.a=e,this.b=t,this.c=i,this.normal=l&&l.isVector3?l:new Se,this.vertexNormals=Array.isArray(l)?l:[],this.color=u&&u.isColor?u:new tn,this.vertexColors=Array.isArray(u)?u:[],this.materialIndex=h!==void 0?h:0}Object.assign(sf.prototype,{clone:function(){return new this.constructor().copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(var t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var mE=0;function Rn(){Object.defineProperty(this,"id",{value:mE++}),this.uuid=Wn.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=ch,this.side=tc,this.flatShading=!1,this.vertexTangents=!1,this.vertexColors=lx,this.opacity=1,this.transparent=!1,this.blendSrc=fx,this.blendDst=mx,this.blendEquation=ic,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=jg,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=iE,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ny,this.stencilZFail=ny,this.stencilZPass=ny,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}Rn.prototype=Object.assign(Object.create(Ta.prototype),{constructor:Rn,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(e!==void 0)for(var t in e){var i=e[t];if(i===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if(t==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===sx;continue}var l=this[t];if(l===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}l&&l.isColor?l.set(i):l&&l.isVector3&&i&&i.isVector3?l.copy(i):this[t]=i}},toJSON:function(e){var t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});var i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(i.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,i.reflectivity=this.reflectivity,i.refractionRatio=this.refractionRatio,this.combine!==void 0&&(i.combine=this.combine),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.size!==void 0&&(i.size=this.size),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==ch&&(i.blending=this.blending),this.flatShading===!0&&(i.flatShading=this.flatShading),this.side!==tc&&(i.side=this.side),this.vertexColors!==lx&&(i.vertexColors=this.vertexColors),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.morphTargets===!0&&(i.morphTargets=!0),this.morphNormals===!0&&(i.morphNormals=!0),this.skinning===!0&&(i.skinning=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData);function l(f){var r=[];for(var v in f){var b=f[v];delete b.metadata,r.push(b)}return r}if(t){var u=l(e.textures),h=l(e.images);u.length>0&&(i.textures=u),h.length>0&&(i.images=h)}return i},clone:function(){return new this.constructor().copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexTangents=e.vertexTangents,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,i=null;if(t!==null){var l=t.length;i=new Array(l);for(var u=0;u!==l;++u)i[u]=t[u].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Rn.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}});function lr(e){Rn.call(this),this.type="MeshBasicMaterial",this.color=new tn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Hp,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}lr.prototype=Object.create(Rn.prototype),lr.prototype.constructor=lr,lr.prototype.isMeshBasicMaterial=!0,lr.prototype.copy=function(e){return Rn.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this};var pi=new Se;function zn(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i===!0,this.usage=Jp,this.updateRange={offset:0,count:-1},this.version=0}Object.defineProperty(zn.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}}),Object.assign(zn.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,i){e*=this.itemSize,i*=t.itemSize;for(var l=0,u=this.itemSize;l<u;l++)this.array[e+l]=t.array[i+l];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,i=0,l=0,u=e.length;l<u;l++){var h=e[l];h===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",l),h=new tn),t[i++]=h.r,t[i++]=h.g,t[i++]=h.b}return this},copyVector2sArray:function(e){for(var t=this.array,i=0,l=0,u=e.length;l<u;l++){var h=e[l];h===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",l),h=new Lt),t[i++]=h.x,t[i++]=h.y}return this},copyVector3sArray:function(e){for(var t=this.array,i=0,l=0,u=e.length;l<u;l++){var h=e[l];h===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",l),h=new Se),t[i++]=h.x,t[i++]=h.y,t[i++]=h.z}return this},copyVector4sArray:function(e){for(var t=this.array,i=0,l=0,u=e.length;l<u;l++){var h=e[l];h===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",l),h=new gi),t[i++]=h.x,t[i++]=h.y,t[i++]=h.z,t[i++]=h.w}return this},applyMatrix3:function(e){for(var t=0,i=this.count;t<i;t++)pi.x=this.getX(t),pi.y=this.getY(t),pi.z=this.getZ(t),pi.applyMatrix3(e),this.setXYZ(t,pi.x,pi.y,pi.z);return this},applyMatrix4:function(e){for(var t=0,i=this.count;t<i;t++)pi.x=this.getX(t),pi.y=this.getY(t),pi.z=this.getZ(t),pi.applyMatrix4(e),this.setXYZ(t,pi.x,pi.y,pi.z);return this},applyNormalMatrix:function(e){for(var t=0,i=this.count;t<i;t++)pi.x=this.getX(t),pi.y=this.getY(t),pi.z=this.getZ(t),pi.applyNormalMatrix(e),this.setXYZ(t,pi.x,pi.y,pi.z);return this},transformDirection:function(e){for(var t=0,i=this.count;t<i;t++)pi.x=this.getX(t),pi.y=this.getY(t),pi.z=this.getZ(t),pi.transformDirection(e),this.setXYZ(t,pi.x,pi.y,pi.z);return this},set:function(e,t){return t===void 0&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this},setXYZ:function(e,t,i,l){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=l,this},setXYZW:function(e,t,i,l,u){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=l,this.array[e+3]=u,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}});function gy(e,t,i){zn.call(this,new Int8Array(e),t,i)}gy.prototype=Object.create(zn.prototype),gy.prototype.constructor=gy;function yy(e,t,i){zn.call(this,new Uint8Array(e),t,i)}yy.prototype=Object.create(zn.prototype),yy.prototype.constructor=yy;function _y(e,t,i){zn.call(this,new Uint8ClampedArray(e),t,i)}_y.prototype=Object.create(zn.prototype),_y.prototype.constructor=_y;function vy(e,t,i){zn.call(this,new Int16Array(e),t,i)}vy.prototype=Object.create(zn.prototype),vy.prototype.constructor=vy;function bh(e,t,i){zn.call(this,new Uint16Array(e),t,i)}bh.prototype=Object.create(zn.prototype),bh.prototype.constructor=bh;function xy(e,t,i){zn.call(this,new Int32Array(e),t,i)}xy.prototype=Object.create(zn.prototype),xy.prototype.constructor=xy;function wh(e,t,i){zn.call(this,new Uint32Array(e),t,i)}wh.prototype=Object.create(zn.prototype),wh.prototype.constructor=wh;function ln(e,t,i){zn.call(this,new Float32Array(e),t,i)}ln.prototype=Object.create(zn.prototype),ln.prototype.constructor=ln;function by(e,t,i){zn.call(this,new Float64Array(e),t,i)}by.prototype=Object.create(zn.prototype),by.prototype.constructor=by;function Wx(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}Object.assign(Wx.prototype,{computeGroups:function(e){for(var t,i=[],l=void 0,u=e.faces,h=0;h<u.length;h++){var f=u[h];f.materialIndex!==l&&(l=f.materialIndex,t!==void 0&&(t.count=h*3-t.start,i.push(t)),t={start:h*3,materialIndex:l})}t!==void 0&&(t.count=h*3-t.start,i.push(t)),this.groups=i},fromGeometry:function(e){var t=e.faces,i=e.vertices,l=e.faceVertexUvs,u=l[0]&&l[0].length>0,h=l[1]&&l[1].length>0,f=e.morphTargets,r=f.length,v;if(r>0){v=[];for(var b=0;b<r;b++)v[b]={name:f[b].name,data:[]};this.morphTargets.position=v}var E=e.morphNormals,M=E.length,D;if(M>0){D=[];for(var b=0;b<M;b++)D[b]={name:E[b].name,data:[]};this.morphTargets.normal=D}var L=e.skinIndices,z=e.skinWeights,k=L.length===i.length,F=z.length===i.length;i.length>0&&t.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(var b=0;b<t.length;b++){var G=t[b];this.vertices.push(i[G.a],i[G.b],i[G.c]);var X=G.vertexNormals;if(X.length===3)this.normals.push(X[0],X[1],X[2]);else{var re=G.normal;this.normals.push(re,re,re)}var ue=G.vertexColors;if(ue.length===3)this.colors.push(ue[0],ue[1],ue[2]);else{var $=G.color;this.colors.push($,$,$)}if(u===!0){var te=l[0][b];te!==void 0?this.uvs.push(te[0],te[1],te[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",b),this.uvs.push(new Lt,new Lt,new Lt))}if(h===!0){var te=l[1][b];te!==void 0?this.uvs2.push(te[0],te[1],te[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",b),this.uvs2.push(new Lt,new Lt,new Lt))}for(var oe=0;oe<r;oe++){var ie=f[oe].vertices;v[oe].data.push(ie[G.a],ie[G.b],ie[G.c])}for(var oe=0;oe<M;oe++){var se=E[oe].vertexNormals[b];D[oe].data.push(se.a,se.b,se.c)}k&&this.skinIndices.push(L[G.a],L[G.b],L[G.c]),F&&this.skinWeights.push(z[G.a],z[G.b],z[G.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this}});function jx(e){if(e.length===0)return-1/0;for(var t=e[0],i=1,l=e.length;i<l;++i)e[i]>t&&(t=e[i]);return t}var gE=1,$o=new jn,wy=new on,vc=new Se,ro=new Do,Mh=new Do,qi=new Se;function vn(){Object.defineProperty(this,"id",{value:gE+=2}),this.uuid=Wn.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}vn.prototype=Object.assign(Object.create(Ta.prototype),{constructor:vn,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(jx(e)>65535?wh:bh)(e,1):this.index=e},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,i){this.groups.push({start:e,count:t,materialIndex:i!==void 0?i:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix4:function(e){var t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);var i=this.attributes.normal;if(i!==void 0){var l=new dr().getNormalMatrix(e);i.applyNormalMatrix(l),i.needsUpdate=!0}var u=this.attributes.tangent;return u!==void 0&&(u.transformDirection(e),u.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this},rotateX:function(e){return $o.makeRotationX(e),this.applyMatrix4($o),this},rotateY:function(e){return $o.makeRotationY(e),this.applyMatrix4($o),this},rotateZ:function(e){return $o.makeRotationZ(e),this.applyMatrix4($o),this},translate:function(e,t,i){return $o.makeTranslation(e,t,i),this.applyMatrix4($o),this},scale:function(e,t,i){return $o.makeScale(e,t,i),this.applyMatrix4($o),this},lookAt:function(e){return wy.lookAt(e),wy.updateMatrix(),this.applyMatrix4(wy.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(vc).negate(),this.translate(vc.x,vc.y,vc.z),this},setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var i=new ln(t.vertices.length*3,3),l=new ln(t.colors.length*3,3);if(this.setAttribute("position",i.copyVector3sArray(t.vertices)),this.setAttribute("color",l.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var u=new ln(t.lineDistances.length,1);this.setAttribute("lineDistance",u.copyArray(t.lineDistances))}t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],i=0,l=e.length;i<l;i++){var u=e[i];t.push(u.x,u.y,u.z||0)}return this.setAttribute("position",new ln(t,3)),this},updateFromObject:function(e){var t=e.geometry;if(e.isMesh){var i=t.__directGeometry;if(t.elementsNeedUpdate===!0&&(i=void 0,t.elementsNeedUpdate=!1),i===void 0)return this.fromGeometry(t);i.verticesNeedUpdate=t.verticesNeedUpdate,i.normalsNeedUpdate=t.normalsNeedUpdate,i.colorsNeedUpdate=t.colorsNeedUpdate,i.uvsNeedUpdate=t.uvsNeedUpdate,i.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=i}var l;return t.verticesNeedUpdate===!0&&(l=this.attributes.position,l!==void 0&&(l.copyVector3sArray(t.vertices),l.needsUpdate=!0),t.verticesNeedUpdate=!1),t.normalsNeedUpdate===!0&&(l=this.attributes.normal,l!==void 0&&(l.copyVector3sArray(t.normals),l.needsUpdate=!0),t.normalsNeedUpdate=!1),t.colorsNeedUpdate===!0&&(l=this.attributes.color,l!==void 0&&(l.copyColorsArray(t.colors),l.needsUpdate=!0),t.colorsNeedUpdate=!1),t.uvsNeedUpdate&&(l=this.attributes.uv,l!==void 0&&(l.copyVector2sArray(t.uvs),l.needsUpdate=!0),t.uvsNeedUpdate=!1),t.lineDistancesNeedUpdate&&(l=this.attributes.lineDistance,l!==void 0&&(l.copyArray(t.lineDistances),l.needsUpdate=!0),t.lineDistancesNeedUpdate=!1),t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=new Wx().fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(e.vertices.length*3);if(this.setAttribute("position",new zn(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var i=new Float32Array(e.normals.length*3);this.setAttribute("normal",new zn(i,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var l=new Float32Array(e.colors.length*3);this.setAttribute("color",new zn(l,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var u=new Float32Array(e.uvs.length*2);this.setAttribute("uv",new zn(u,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var h=new Float32Array(e.uvs2.length*2);this.setAttribute("uv2",new zn(h,2).copyVector2sArray(e.uvs2))}this.groups=e.groups;for(var f in e.morphTargets){for(var r=[],v=e.morphTargets[f],b=0,E=v.length;b<E;b++){var M=v[b],D=new ln(M.data.length*3,3);D.name=M.name,r.push(D.copyVector3sArray(M.data))}this.morphAttributes[f]=r}if(e.skinIndices.length>0){var L=new ln(e.skinIndices.length*4,4);this.setAttribute("skinIndex",L.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var z=new ln(e.skinWeights.length*4,4);this.setAttribute("skinWeight",z.copyVector4sArray(e.skinWeights))}return e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new Do);var e=this.attributes.position,t=this.morphAttributes.position;if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(var i=0,l=t.length;i<l;i++){var u=t[i];ro.setFromBufferAttribute(u),this.morphTargetsRelative?(qi.addVectors(this.boundingBox.min,ro.min),this.boundingBox.expandByPoint(qi),qi.addVectors(this.boundingBox.max,ro.max),this.boundingBox.expandByPoint(qi)):(this.boundingBox.expandByPoint(ro.min),this.boundingBox.expandByPoint(ro.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new Sa);var e=this.attributes.position,t=this.morphAttributes.position;if(e){var i=this.boundingSphere.center;if(ro.setFromBufferAttribute(e),t)for(var l=0,u=t.length;l<u;l++){var h=t[l];Mh.setFromBufferAttribute(h),this.morphTargetsRelative?(qi.addVectors(ro.min,Mh.min),ro.expandByPoint(qi),qi.addVectors(ro.max,Mh.max),ro.expandByPoint(qi)):(ro.expandByPoint(Mh.min),ro.expandByPoint(Mh.max))}ro.getCenter(i);for(var f=0,l=0,u=e.count;l<u;l++)qi.fromBufferAttribute(e,l),f=Math.max(f,i.distanceToSquared(qi));if(t)for(var l=0,u=t.length;l<u;l++)for(var h=t[l],r=this.morphTargetsRelative,v=0,b=h.count;v<b;v++)qi.fromBufferAttribute(h,v),r&&(vc.fromBufferAttribute(e,v),qi.add(vc)),f=Math.max(f,i.distanceToSquared(qi));this.boundingSphere.radius=Math.sqrt(f),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var i=t.position.array;if(t.normal===void 0)this.setAttribute("normal",new zn(new Float32Array(i.length),3));else for(var l=t.normal.array,u=0,h=l.length;u<h;u++)l[u]=0;var f=t.normal.array,r,v,b,E=new Se,M=new Se,D=new Se,L=new Se,z=new Se;if(e)for(var k=e.array,u=0,h=e.count;u<h;u+=3)r=k[u+0]*3,v=k[u+1]*3,b=k[u+2]*3,E.fromArray(i,r),M.fromArray(i,v),D.fromArray(i,b),L.subVectors(D,M),z.subVectors(E,M),L.cross(z),f[r]+=L.x,f[r+1]+=L.y,f[r+2]+=L.z,f[v]+=L.x,f[v+1]+=L.y,f[v+2]+=L.z,f[b]+=L.x,f[b+1]+=L.y,f[b+2]+=L.z;else for(var u=0,h=i.length;u<h;u+=9)E.fromArray(i,u),M.fromArray(i,u+3),D.fromArray(i,u+6),L.subVectors(D,M),z.subVectors(E,M),L.cross(z),f[u]=L.x,f[u+1]=L.y,f[u+2]=L.z,f[u+3]=L.x,f[u+4]=L.y,f[u+5]=L.z,f[u+6]=L.x,f[u+7]=L.y,f[u+8]=L.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var i=this.attributes;for(var l in i)if(e.attributes[l]!==void 0)for(var u=i[l],h=u.array,f=e.attributes[l],r=f.array,v=f.itemSize*t,b=Math.min(r.length,h.length-v),E=0,M=v;E<b;E++,M++)h[M]=r[E];return this},normalizeNormals:function(){for(var e=this.attributes.normal,t=0,i=e.count;t<i;t++)qi.x=e.getX(t),qi.y=e.getY(t),qi.z=e.getZ(t),qi.normalize(),e.setXYZ(t,qi.x,qi.y,qi.z)},toNonIndexed:function(){function e(k,F){for(var G=k.array,X=k.itemSize,re=new G.constructor(F.length*X),ue=0,$=0,te=0,oe=F.length;te<oe;te++){ue=F[te]*X;for(var ie=0;ie<X;ie++)re[$++]=G[ue++]}return new zn(re,X)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new vn,i=this.index.array,l=this.attributes;for(var u in l){var h=l[u],f=e(h,i);t.setAttribute(u,f)}var r=this.morphAttributes;for(u in r){for(var v=[],b=r[u],E=0,M=b.length;E<M;E++){var h=b[E],f=e(h,i);v.push(f)}t.morphAttributes[u]=v}t.morphTargetsRelative=this.morphTargetsRelative;for(var D=this.groups,E=0,L=D.length;E<L;E++){var z=D[E];t.addGroup(z.start,z.count,z.materialIndex)}return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){var t=this.parameters;for(var i in t)t[i]!==void 0&&(e[i]=t[i]);return e}e.data={attributes:{}};var l=this.index;l!==null&&(e.data.index={type:l.array.constructor.name,array:Array.prototype.slice.call(l.array)});var u=this.attributes;for(var i in u){var h=u[i],f=h.toJSON();h.name!==""&&(f.name=h.name),e.data.attributes[i]=f}var r={},v=!1;for(var i in this.morphAttributes){for(var b=this.morphAttributes[i],E=[],M=0,D=b.length;M<D;M++){var h=b[M],f=h.toJSON();h.name!==""&&(f.name=h.name),E.push(f)}E.length>0&&(r[i]=E,v=!0)}v&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);var L=this.groups;L.length>0&&(e.data.groups=JSON.parse(JSON.stringify(L)));var z=this.boundingSphere;return z!==null&&(e.data.boundingSphere={center:z.center.toArray(),radius:z.radius}),e},clone:function(){return new vn().copy(this)},copy:function(e){var t,i,l;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var u=e.index;u!==null&&this.setIndex(u.clone());var h=e.attributes;for(t in h){var f=h[t];this.setAttribute(t,f.clone())}var r=e.morphAttributes;for(t in r){var v=[],b=r[t];for(i=0,l=b.length;i<l;i++)v.push(b[i].clone());this.morphAttributes[t]=v}this.morphTargetsRelative=e.morphTargetsRelative;var E=e.groups;for(i=0,l=E.length;i<l;i++){var M=E[i];this.addGroup(M.start,M.count,M.materialIndex)}var D=e.boundingBox;D!==null&&(this.boundingBox=D.clone());var L=e.boundingSphere;return L!==null&&(this.boundingSphere=L.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var $x=new jn,el=new gc,My=new Sa,tl=new Se,nl=new Se,il=new Se,Ty=new Se,Ey=new Se,Cy=new Se,lf=new Se,cf=new Se,uf=new Se,xc=new Lt,bc=new Lt,wc=new Lt,Th=new Se,hf=new Se;function Ai(e,t){on.call(this),this.type="Mesh",this.geometry=e!==void 0?e:new vn,this.material=t!==void 0?t:new lr,this.updateMorphTargets()}Ai.prototype=Object.assign(Object.create(on.prototype),{constructor:Ai,isMesh:!0,copy:function(e){return on.prototype.copy.call(this,e),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e=this.geometry,t,i,l;if(e.isBufferGeometry){var u=e.morphAttributes,h=Object.keys(u);if(h.length>0){var f=u[h[0]];if(f!==void 0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,i=f.length;t<i;t++)l=f[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=t}}else{var r=e.morphTargets;r!==void 0&&r.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){var i=this.geometry,l=this.material,u=this.matrixWorld;if(l!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),My.copy(i.boundingSphere),My.applyMatrix4(u),e.ray.intersectsSphere(My)!==!1&&($x.getInverse(u),el.copy(e.ray).applyMatrix4($x),!(i.boundingBox!==null&&el.intersectsBox(i.boundingBox)===!1)))){var h;if(i.isBufferGeometry){var f,r,v,b=i.index,E=i.attributes.position,M=i.morphAttributes.position,D=i.morphTargetsRelative,L=i.attributes.uv,z=i.attributes.uv2,k=i.groups,F=i.drawRange,G,X,re,ue,$,te,oe,ie;if(b!==null)if(Array.isArray(l))for(G=0,re=k.length;G<re;G++)for($=k[G],te=l[$.materialIndex],oe=Math.max($.start,F.start),ie=Math.min($.start+$.count,F.start+F.count),X=oe,ue=ie;X<ue;X+=3)f=b.getX(X),r=b.getX(X+1),v=b.getX(X+2),h=df(this,te,e,el,E,M,D,L,z,f,r,v),h&&(h.faceIndex=Math.floor(X/3),h.face.materialIndex=$.materialIndex,t.push(h));else for(oe=Math.max(0,F.start),ie=Math.min(b.count,F.start+F.count),G=oe,re=ie;G<re;G+=3)f=b.getX(G),r=b.getX(G+1),v=b.getX(G+2),h=df(this,l,e,el,E,M,D,L,z,f,r,v),h&&(h.faceIndex=Math.floor(G/3),t.push(h));else if(E!==void 0)if(Array.isArray(l))for(G=0,re=k.length;G<re;G++)for($=k[G],te=l[$.materialIndex],oe=Math.max($.start,F.start),ie=Math.min($.start+$.count,F.start+F.count),X=oe,ue=ie;X<ue;X+=3)f=X,r=X+1,v=X+2,h=df(this,te,e,el,E,M,D,L,z,f,r,v),h&&(h.faceIndex=Math.floor(X/3),h.face.materialIndex=$.materialIndex,t.push(h));else for(oe=Math.max(0,F.start),ie=Math.min(E.count,F.start+F.count),G=oe,re=ie;G<re;G+=3)f=G,r=G+1,v=G+2,h=df(this,l,e,el,E,M,D,L,z,f,r,v),h&&(h.faceIndex=Math.floor(G/3),t.push(h))}else if(i.isGeometry){var se,pe,me,he=Array.isArray(l),Ue=i.vertices,Ve=i.faces,$e,ct=i.faceVertexUvs[0];ct.length>0&&($e=ct);for(var At=0,yt=Ve.length;At<yt;At++){var St=Ve[At],It=he?l[St.materialIndex]:l;if(It!==void 0&&(se=Ue[St.a],pe=Ue[St.b],me=Ue[St.c],h=qx(this,It,e,el,se,pe,me,Th),h)){if($e&&$e[At]){var Nt=$e[At];xc.copy(Nt[0]),bc.copy(Nt[1]),wc.copy(Nt[2]),h.uv=sr.getUV(Th,se,pe,me,xc,bc,wc,new Lt)}h.face=St,h.faceIndex=At,t.push(h)}}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});function qx(e,t,i,l,u,h,f,r){var v;if(t.side===tr?v=l.intersectTriangle(f,h,u,!0,r):v=l.intersectTriangle(u,h,f,t.side!==lh,r),v===null)return null;hf.copy(r),hf.applyMatrix4(e.matrixWorld);var b=i.ray.origin.distanceTo(hf);return b<i.near||b>i.far?null:{distance:b,point:hf.clone(),object:e}}function df(e,t,i,l,u,h,f,r,v,b,E,M){tl.fromBufferAttribute(u,b),nl.fromBufferAttribute(u,E),il.fromBufferAttribute(u,M);var D=e.morphTargetInfluences;if(t.morphTargets&&h&&D){lf.set(0,0,0),cf.set(0,0,0),uf.set(0,0,0);for(var L=0,z=h.length;L<z;L++){var k=D[L],F=h[L];k!==0&&(Ty.fromBufferAttribute(F,b),Ey.fromBufferAttribute(F,E),Cy.fromBufferAttribute(F,M),f?(lf.addScaledVector(Ty,k),cf.addScaledVector(Ey,k),uf.addScaledVector(Cy,k)):(lf.addScaledVector(Ty.sub(tl),k),cf.addScaledVector(Ey.sub(nl),k),uf.addScaledVector(Cy.sub(il),k)))}tl.add(lf),nl.add(cf),il.add(uf)}var G=qx(e,t,i,l,tl,nl,il,Th);if(G){r&&(xc.fromBufferAttribute(r,b),bc.fromBufferAttribute(r,E),wc.fromBufferAttribute(r,M),G.uv=sr.getUV(Th,tl,nl,il,xc,bc,wc,new Lt)),v&&(xc.fromBufferAttribute(v,b),bc.fromBufferAttribute(v,E),wc.fromBufferAttribute(v,M),G.uv2=sr.getUV(Th,tl,nl,il,xc,bc,wc,new Lt));var X=new sf(b,E,M);sr.getNormal(tl,nl,il,X.normal),G.face=X}return G}var yE=0,qo=new jn,Ay=new on,pf=new Se;function Fn(){Object.defineProperty(this,"id",{value:yE+=2}),this.uuid=Wn.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}Fn.prototype=Object.assign(Object.create(Ta.prototype),{constructor:Fn,isGeometry:!0,applyMatrix4:function(e){for(var t=new dr().getNormalMatrix(e),i=0,l=this.vertices.length;i<l;i++){var u=this.vertices[i];u.applyMatrix4(e)}for(var i=0,l=this.faces.length;i<l;i++){var h=this.faces[i];h.normal.applyMatrix3(t).normalize();for(var f=0,r=h.vertexNormals.length;f<r;f++)h.vertexNormals[f].applyMatrix3(t).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(e){return qo.makeRotationX(e),this.applyMatrix4(qo),this},rotateY:function(e){return qo.makeRotationY(e),this.applyMatrix4(qo),this},rotateZ:function(e){return qo.makeRotationZ(e),this.applyMatrix4(qo),this},translate:function(e,t,i){return qo.makeTranslation(e,t,i),this.applyMatrix4(qo),this},scale:function(e,t,i){return qo.makeScale(e,t,i),this.applyMatrix4(qo),this},lookAt:function(e){return Ay.lookAt(e),Ay.updateMatrix(),this.applyMatrix4(Ay.matrix),this},fromBufferGeometry:function(e){var t=this,i=e.index!==null?e.index.array:void 0,l=e.attributes;if(l.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var u=l.position.array,h=l.normal!==void 0?l.normal.array:void 0,f=l.color!==void 0?l.color.array:void 0,r=l.uv!==void 0?l.uv.array:void 0,v=l.uv2!==void 0?l.uv2.array:void 0;v!==void 0&&(this.faceVertexUvs[1]=[]);for(var b=0;b<u.length;b+=3)t.vertices.push(new Se().fromArray(u,b)),f!==void 0&&t.colors.push(new tn().fromArray(f,b));function E(G,X,re,ue){var $=f===void 0?[]:[t.colors[G].clone(),t.colors[X].clone(),t.colors[re].clone()],te=h===void 0?[]:[new Se().fromArray(h,G*3),new Se().fromArray(h,X*3),new Se().fromArray(h,re*3)],oe=new sf(G,X,re,te,$,ue);t.faces.push(oe),r!==void 0&&t.faceVertexUvs[0].push([new Lt().fromArray(r,G*2),new Lt().fromArray(r,X*2),new Lt().fromArray(r,re*2)]),v!==void 0&&t.faceVertexUvs[1].push([new Lt().fromArray(v,G*2),new Lt().fromArray(v,X*2),new Lt().fromArray(v,re*2)])}var M=e.groups;if(M.length>0)for(var b=0;b<M.length;b++)for(var D=M[b],L=D.start,z=D.count,k=L,F=L+z;k<F;k+=3)i!==void 0?E(i[k],i[k+1],i[k+2],D.materialIndex):E(k,k+1,k+2,D.materialIndex);else if(i!==void 0)for(var b=0;b<i.length;b+=3)E(i[b],i[b+1],i[b+2]);else for(var b=0;b<u.length/3;b+=3)E(b,b+1,b+2);return this.computeFaceNormals(),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(pf).negate(),this.translate(pf.x,pf.y,pf.z),this},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,i=t===0?1:1/t,l=new jn;return l.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix4(l),this},computeFaceNormals:function(){for(var e=new Se,t=new Se,i=0,l=this.faces.length;i<l;i++){var u=this.faces[i],h=this.vertices[u.a],f=this.vertices[u.b],r=this.vertices[u.c];e.subVectors(r,f),t.subVectors(h,f),e.cross(t),e.normalize(),u.normal.copy(e)}},computeVertexNormals:function(e){e===void 0&&(e=!0);var t,i,l,u,h,f;for(f=new Array(this.vertices.length),t=0,i=this.vertices.length;t<i;t++)f[t]=new Se;if(e){var r,v,b,E=new Se,M=new Se;for(l=0,u=this.faces.length;l<u;l++)h=this.faces[l],r=this.vertices[h.a],v=this.vertices[h.b],b=this.vertices[h.c],E.subVectors(b,v),M.subVectors(r,v),E.cross(M),f[h.a].add(E),f[h.b].add(E),f[h.c].add(E)}else for(this.computeFaceNormals(),l=0,u=this.faces.length;l<u;l++)h=this.faces[l],f[h.a].add(h.normal),f[h.b].add(h.normal),f[h.c].add(h.normal);for(t=0,i=this.vertices.length;t<i;t++)f[t].normalize();for(l=0,u=this.faces.length;l<u;l++){h=this.faces[l];var D=h.vertexNormals;D.length===3?(D[0].copy(f[h.a]),D[1].copy(f[h.b]),D[2].copy(f[h.c])):(D[0]=f[h.a].clone(),D[1]=f[h.b].clone(),D[2]=f[h.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,i;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){i=this.faces[e];var l=i.vertexNormals;l.length===3?(l[0].copy(i.normal),l[1].copy(i.normal),l[2].copy(i.normal)):(l[0]=i.normal.clone(),l[1]=i.normal.clone(),l[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,i,l,u;for(i=0,l=this.faces.length;i<l;i++)for(u=this.faces[i],u.__originalFaceNormal?u.__originalFaceNormal.copy(u.normal):u.__originalFaceNormal=u.normal.clone(),u.__originalVertexNormals||(u.__originalVertexNormals=[]),e=0,t=u.vertexNormals.length;e<t;e++)u.__originalVertexNormals[e]?u.__originalVertexNormals[e].copy(u.vertexNormals[e]):u.__originalVertexNormals[e]=u.vertexNormals[e].clone();var h=new Fn;for(h.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var f=this.morphNormals[e].faceNormals,r=this.morphNormals[e].vertexNormals,b,E;for(i=0,l=this.faces.length;i<l;i++)b=new Se,E={a:new Se,b:new Se,c:new Se},f.push(b),r.push(E)}var v=this.morphNormals[e];h.vertices=this.morphTargets[e].vertices,h.computeFaceNormals(),h.computeVertexNormals();var b,E;for(i=0,l=this.faces.length;i<l;i++)u=this.faces[i],b=v.faceNormals[i],E=v.vertexNormals[i],b.copy(u.normal),E.a.copy(u.vertexNormals[0]),E.b.copy(u.vertexNormals[1]),E.c.copy(u.vertexNormals[2])}for(i=0,l=this.faces.length;i<l;i++)u=this.faces[i],u.normal=u.__originalFaceNormal,u.vertexNormals=u.__originalVertexNormals},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new Do),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new Sa),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,i){if(!(e&&e.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);return}var l,u=this.vertices.length,h=this.vertices,f=e.vertices,r=this.faces,v=e.faces,b=this.colors,E=e.colors;i===void 0&&(i=0),t!==void 0&&(l=new dr().getNormalMatrix(t));for(var M=0,D=f.length;M<D;M++){var L=f[M],z=L.clone();t!==void 0&&z.applyMatrix4(t),h.push(z)}for(var M=0,D=E.length;M<D;M++)b.push(E[M].clone());for(M=0,D=v.length;M<D;M++){var k=v[M],F,G,X,re=k.vertexNormals,ue=k.vertexColors;F=new sf(k.a+u,k.b+u,k.c+u),F.normal.copy(k.normal),l!==void 0&&F.normal.applyMatrix3(l).normalize();for(var $=0,te=re.length;$<te;$++)G=re[$].clone(),l!==void 0&&G.applyMatrix3(l).normalize(),F.vertexNormals.push(G);F.color.copy(k.color);for(var $=0,te=ue.length;$<te;$++)X=ue[$],F.vertexColors.push(X.clone());F.materialIndex=k.materialIndex+i,r.push(F)}for(var M=0,D=e.faceVertexUvs.length;M<D;M++){var oe=e.faceVertexUvs[M];this.faceVertexUvs[M]===void 0&&(this.faceVertexUvs[M]=[]);for(var $=0,te=oe.length;$<te;$++){for(var ie=oe[$],se=[],pe=0,me=ie.length;pe<me;pe++)se.push(ie[pe].clone());this.faceVertexUvs[M].push(se)}}},mergeMesh:function(e){if(!(e&&e.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e);return}e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)},mergeVertices:function(){var e={},t=[],i=[],l,u,h=4,f=Math.pow(10,h),r,v,b,E,M,D;for(r=0,v=this.vertices.length;r<v;r++)l=this.vertices[r],u=Math.round(l.x*f)+"_"+Math.round(l.y*f)+"_"+Math.round(l.z*f),e[u]===void 0?(e[u]=r,t.push(this.vertices[r]),i[r]=t.length-1):i[r]=i[e[u]];var L=[];for(r=0,v=this.faces.length;r<v;r++){b=this.faces[r],b.a=i[b.a],b.b=i[b.b],b.c=i[b.c],E=[b.a,b.b,b.c];for(var z=0;z<3;z++)if(E[z]===E[(z+1)%3]){L.push(r);break}}for(r=L.length-1;r>=0;r--){var k=L[r];for(this.faces.splice(k,1),M=0,D=this.faceVertexUvs.length;M<D;M++)this.faceVertexUvs[M].splice(k,1)}var F=this.vertices.length-t.length;return this.vertices=t,F},setFromPoints:function(e){this.vertices=[];for(var t=0,i=e.length;t<i;t++){var l=e[t];this.vertices.push(new Se(l.x,l.y,l.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,i=0;i<t;i++)e[i]._id=i;function l(b,E){return b.materialIndex-E.materialIndex}e.sort(l);var u=this.faceVertexUvs[0],h=this.faceVertexUvs[1],f,r;u&&u.length===t&&(f=[]),h&&h.length===t&&(r=[]);for(var i=0;i<t;i++){var v=e[i]._id;f&&f.push(u[v]),r&&r.push(h[v])}f&&(this.faceVertexUvs[0]=f),r&&(this.faceVertexUvs[1]=r)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.parameters!==void 0){var t=this.parameters;for(var i in t)t[i]!==void 0&&(e[i]=t[i]);return e}for(var l=[],u=0;u<this.vertices.length;u++){var h=this.vertices[u];l.push(h.x,h.y,h.z)}for(var f=[],r=[],v={},b=[],E={},M=[],D={},u=0;u<this.faces.length;u++){var L=this.faces[u],z=!0,k=!1,F=this.faceVertexUvs[0][u]!==void 0,G=L.normal.length()>0,X=L.vertexNormals.length>0,re=L.color.r!==1||L.color.g!==1||L.color.b!==1,ue=L.vertexColors.length>0,$=0;if($=se($,0,0),$=se($,1,z),$=se($,2,k),$=se($,3,F),$=se($,4,G),$=se($,5,X),$=se($,6,re),$=se($,7,ue),f.push($),f.push(L.a,L.b,L.c),f.push(L.materialIndex),F){var te=this.faceVertexUvs[0][u];f.push(he(te[0]),he(te[1]),he(te[2]))}if(G&&f.push(pe(L.normal)),X){var oe=L.vertexNormals;f.push(pe(oe[0]),pe(oe[1]),pe(oe[2]))}if(re&&f.push(me(L.color)),ue){var ie=L.vertexColors;f.push(me(ie[0]),me(ie[1]),me(ie[2]))}}function se(Ue,Ve,$e){return $e?Ue|1<<Ve:Ue&~(1<<Ve)}function pe(Ue){var Ve=Ue.x.toString()+Ue.y.toString()+Ue.z.toString();return v[Ve]!==void 0||(v[Ve]=r.length/3,r.push(Ue.x,Ue.y,Ue.z)),v[Ve]}function me(Ue){var Ve=Ue.r.toString()+Ue.g.toString()+Ue.b.toString();return E[Ve]!==void 0||(E[Ve]=b.length,b.push(Ue.getHex())),E[Ve]}function he(Ue){var Ve=Ue.x.toString()+Ue.y.toString();return D[Ve]!==void 0||(D[Ve]=M.length/2,M.push(Ue.x,Ue.y)),D[Ve]}return e.data={},e.data.vertices=l,e.data.normals=r,b.length>0&&(e.data.colors=b),M.length>0&&(e.data.uvs=[M]),e.data.faces=f,e},clone:function(){return new Fn().copy(this)},copy:function(e){var t,i,l,u,h,f;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var r=e.vertices;for(t=0,i=r.length;t<i;t++)this.vertices.push(r[t].clone());var v=e.colors;for(t=0,i=v.length;t<i;t++)this.colors.push(v[t].clone());var b=e.faces;for(t=0,i=b.length;t<i;t++)this.faces.push(b[t].clone());for(t=0,i=e.faceVertexUvs.length;t<i;t++){var E=e.faceVertexUvs[t];for(this.faceVertexUvs[t]===void 0&&(this.faceVertexUvs[t]=[]),l=0,u=E.length;l<u;l++){var M=E[l],D=[];for(h=0,f=M.length;h<f;h++){var L=M[h];D.push(L.clone())}this.faceVertexUvs[t].push(D)}}var z=e.morphTargets;for(t=0,i=z.length;t<i;t++){var k={};if(k.name=z[t].name,z[t].vertices!==void 0)for(k.vertices=[],l=0,u=z[t].vertices.length;l<u;l++)k.vertices.push(z[t].vertices[l].clone());if(z[t].normals!==void 0)for(k.normals=[],l=0,u=z[t].normals.length;l<u;l++)k.normals.push(z[t].normals[l].clone());this.morphTargets.push(k)}var F=e.morphNormals;for(t=0,i=F.length;t<i;t++){var G={};if(F[t].vertexNormals!==void 0)for(G.vertexNormals=[],l=0,u=F[t].vertexNormals.length;l<u;l++){var X=F[t].vertexNormals[l],re={};re.a=X.a.clone(),re.b=X.b.clone(),re.c=X.c.clone(),G.vertexNormals.push(re)}if(F[t].faceNormals!==void 0)for(G.faceNormals=[],l=0,u=F[t].faceNormals.length;l<u;l++)G.faceNormals.push(F[t].faceNormals[l].clone());this.morphNormals.push(G)}var ue=e.skinWeights;for(t=0,i=ue.length;t<i;t++)this.skinWeights.push(ue[t].clone());var $=e.skinIndices;for(t=0,i=$.length;t<i;t++)this.skinIndices.push($[t].clone());var te=e.lineDistances;for(t=0,i=te.length;t<i;t++)this.lineDistances.push(te[t]);var oe=e.boundingBox;oe!==null&&(this.boundingBox=oe.clone());var ie=e.boundingSphere;return ie!==null&&(this.boundingSphere=ie.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class _E extends Fn{constructor(t,i,l,u,h,f){super(),this.type="BoxGeometry",this.parameters={width:t,height:i,depth:l,widthSegments:u,heightSegments:h,depthSegments:f},this.fromBufferGeometry(new ff(t,i,l,u,h,f)),this.mergeVertices()}}class ff extends vn{constructor(t,i,l,u,h,f){super(),this.type="BoxBufferGeometry",this.parameters={width:t,height:i,depth:l,widthSegments:u,heightSegments:h,depthSegments:f};var r=this;t=t||1,i=i||1,l=l||1,u=Math.floor(u)||1,h=Math.floor(h)||1,f=Math.floor(f)||1;var v=[],b=[],E=[],M=[],D=0,L=0;z("z","y","x",-1,-1,l,i,t,f,h,0),z("z","y","x",1,-1,l,i,-t,f,h,1),z("x","z","y",1,1,t,l,i,u,f,2),z("x","z","y",1,-1,t,l,-i,u,f,3),z("x","y","z",1,-1,t,i,l,u,h,4),z("x","y","z",-1,-1,t,i,-l,u,h,5),this.setIndex(v),this.setAttribute("position",new ln(b,3)),this.setAttribute("normal",new ln(E,3)),this.setAttribute("uv",new ln(M,2));function z(k,F,G,X,re,ue,$,te,oe,ie,se){var pe=ue/oe,me=$/ie,he=ue/2,Ue=$/2,Ve=te/2,$e=oe+1,ct=ie+1,At=0,yt=0,St,It,Nt=new Se;for(It=0;It<ct;It++){var Ie=It*me-Ue;for(St=0;St<$e;St++){var xe=St*pe-he;Nt[k]=xe*X,Nt[F]=Ie*re,Nt[G]=Ve,b.push(Nt.x,Nt.y,Nt.z),Nt[k]=0,Nt[F]=0,Nt[G]=te>0?1:-1,E.push(Nt.x,Nt.y,Nt.z),M.push(St/oe),M.push(1-It/ie),At+=1}}for(It=0;It<ie;It++)for(St=0;St<oe;St++){var He=D+St+$e*It,Ge=D+St+$e*(It+1),ze=D+(St+1)+$e*(It+1),rt=D+(St+1)+$e*It;v.push(He,Ge,rt),v.push(Ge,ze,rt),yt+=6}r.addGroup(L,yt,se),L+=yt,D+=At}}}function Mc(e){var t={};for(var i in e){t[i]={};for(var l in e[i]){var u=e[i][l];u&&(u.isColor||u.isMatrix3||u.isMatrix4||u.isVector2||u.isVector3||u.isVector4||u.isTexture)?t[i][l]=u.clone():Array.isArray(u)?t[i][l]=u.slice():t[i][l]=u}}return t}function pr(e){for(var t={},i=0;i<e.length;i++){var l=Mc(e[i]);for(var u in l)t[u]=l[u]}return t}var vE={clone:Mc,merge:pr},xE=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,bE=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;function Nr(e){Rn.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=xE,this.fragmentShader=bE,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}Nr.prototype=Object.create(Rn.prototype),Nr.prototype.constructor=Nr,Nr.prototype.isShaderMaterial=!0,Nr.prototype.copy=function(e){return Rn.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Mc(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},Nr.prototype.toJSON=function(e){var t=Rn.prototype.toJSON.call(this,e);t.uniforms={};for(var i in this.uniforms){var l=this.uniforms[i],u=l.value;u&&u.isTexture?t.uniforms[i]={type:"t",value:u.toJSON(e).uuid}:u&&u.isColor?t.uniforms[i]={type:"c",value:u.getHex()}:u&&u.isVector2?t.uniforms[i]={type:"v2",value:u.toArray()}:u&&u.isVector3?t.uniforms[i]={type:"v3",value:u.toArray()}:u&&u.isVector4?t.uniforms[i]={type:"v4",value:u.toArray()}:u&&u.isMatrix3?t.uniforms[i]={type:"m3",value:u.toArray()}:u&&u.isMatrix4?t.uniforms[i]={type:"m4",value:u.toArray()}:t.uniforms[i]={value:u}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var h={};for(var f in this.extensions)this.extensions[f]===!0&&(h[f]=!0);return Object.keys(h).length>0&&(t.extensions=h),t};function Ia(){on.call(this),this.type="Camera",this.matrixWorldInverse=new jn,this.projectionMatrix=new jn,this.projectionMatrixInverse=new jn}Ia.prototype=Object.assign(Object.create(on.prototype),{constructor:Ia,isCamera:!0,copy:function(e,t){return on.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){e===void 0&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new Se),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){on.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(e,t){on.prototype.updateWorldMatrix.call(this,e,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return new this.constructor().copy(this)}});function Zi(e,t,i,l){Ia.call(this),this.type="PerspectiveCamera",this.fov=e!==void 0?e:50,this.zoom=1,this.near=i!==void 0?i:.1,this.far=l!==void 0?l:2e3,this.focus=10,this.aspect=t!==void 0?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}Zi.prototype=Object.assign(Object.create(Ia.prototype),{constructor:Zi,isPerspectiveCamera:!0,copy:function(e,t){return Ia.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=Wn.RAD2DEG*2*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(Wn.DEG2RAD*.5*this.fov);return .5*this.getFilmHeight()/e},getEffectiveFOV:function(){return Wn.RAD2DEG*2*Math.atan(Math.tan(Wn.DEG2RAD*.5*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,i,l,u,h){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=l,this.view.width=u,this.view.height=h,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(Wn.DEG2RAD*.5*this.fov)/this.zoom,i=2*t,l=this.aspect*i,u=-.5*l,h=this.view;if(this.view!==null&&this.view.enabled){var f=h.fullWidth,r=h.fullHeight;u+=h.offsetX*l/f,t-=h.offsetY*i/r,l*=h.width/f,i*=h.height/r}var v=this.filmOffset;v!==0&&(u+=e*v/this.getFilmWidth()),this.projectionMatrix.makePerspective(u,u+l,t,t-i,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=on.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});var Tc=90,Ec=1;function Eh(e,t,i,l){on.call(this),this.type="CubeCamera";var u=new Zi(Tc,Ec,e,t);u.up.set(0,-1,0),u.lookAt(new Se(1,0,0)),this.add(u);var h=new Zi(Tc,Ec,e,t);h.up.set(0,-1,0),h.lookAt(new Se(-1,0,0)),this.add(h);var f=new Zi(Tc,Ec,e,t);f.up.set(0,0,1),f.lookAt(new Se(0,1,0)),this.add(f);var r=new Zi(Tc,Ec,e,t);r.up.set(0,0,-1),r.lookAt(new Se(0,-1,0)),this.add(r);var v=new Zi(Tc,Ec,e,t);v.up.set(0,-1,0),v.lookAt(new Se(0,0,1)),this.add(v);var b=new Zi(Tc,Ec,e,t);b.up.set(0,-1,0),b.lookAt(new Se(0,0,-1)),this.add(b),l=l||{format:Ma,magFilter:$i,minFilter:$i},this.renderTarget=new Cc(i,l),this.renderTarget.texture.name="CubeCamera",this.update=function(E,M){this.parent===null&&this.updateMatrixWorld();var D=E.getRenderTarget(),L=this.renderTarget,z=L.texture.generateMipmaps;L.texture.generateMipmaps=!1,E.setRenderTarget(L,0),E.render(M,u),E.setRenderTarget(L,1),E.render(M,h),E.setRenderTarget(L,2),E.render(M,f),E.setRenderTarget(L,3),E.render(M,r),E.setRenderTarget(L,4),E.render(M,v),L.texture.generateMipmaps=z,E.setRenderTarget(L,5),E.render(M,b),E.setRenderTarget(D)},this.clear=function(E,M,D,L){for(var z=E.getRenderTarget(),k=this.renderTarget,F=0;F<6;F++)E.setRenderTarget(k,F),E.clear(M,D,L);E.setRenderTarget(z)}}Eh.prototype=Object.create(on.prototype),Eh.prototype.constructor=Eh;function Cc(e,t,i){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=i),Mr.call(this,e,e,t)}Cc.prototype=Object.create(Mr.prototype),Cc.prototype.constructor=Cc,Cc.prototype.isWebGLCubeRenderTarget=!0,Cc.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=t.format,this.texture.encoding=t.encoding;var i=new Ca,l={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","	vWorldDirection = transformDirection( position, modelMatrix );","	#include <begin_vertex>","	#include <project_vertex>","}"].join(`
`),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#define RECIPROCAL_PI 0.31830988618","#define RECIPROCAL_PI2 0.15915494","void main() {","	vec3 direction = normalize( vWorldDirection );","	vec2 sampleUV;","	sampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;","	sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","	gl_FragColor = texture2D( tEquirect, sampleUV );","}"].join(`
`)},u=new Nr({type:"CubemapFromEquirect",uniforms:Mc(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,side:tr,blending:es});u.uniforms.tEquirect.value=t;var h=new Ai(new ff(5,5,5),u);i.add(h);var f=new Eh(1,10,1);return f.renderTarget=this,f.renderTarget.texture.name="CubeCameraTexture",f.update(e,i),h.geometry.dispose(),h.material.dispose(),this};function Ac(e,t,i,l,u,h,f,r,v,b,E,M){mi.call(this,null,h,f,r,v,b,l,u,E,M),this.image={data:e||null,width:t||1,height:i||1},this.magFilter=v!==void 0?v:Ui,this.minFilter=b!==void 0?b:Ui,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}Ac.prototype=Object.create(mi.prototype),Ac.prototype.constructor=Ac,Ac.prototype.isDataTexture=!0;var Sc=new Sa,mf=new Se;function Ch(e,t,i,l,u,h){this.planes=[e!==void 0?e:new jo,t!==void 0?t:new jo,i!==void 0?i:new jo,l!==void 0?l:new jo,u!==void 0?u:new jo,h!==void 0?h:new jo]}Object.assign(Ch.prototype,{set:function(e,t,i,l,u,h){var f=this.planes;return f[0].copy(e),f[1].copy(t),f[2].copy(i),f[3].copy(l),f[4].copy(u),f[5].copy(h),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){for(var t=this.planes,i=0;i<6;i++)t[i].copy(e.planes[i]);return this},setFromProjectionMatrix:function(e){var t=this.planes,i=e.elements,l=i[0],u=i[1],h=i[2],f=i[3],r=i[4],v=i[5],b=i[6],E=i[7],M=i[8],D=i[9],L=i[10],z=i[11],k=i[12],F=i[13],G=i[14],X=i[15];return t[0].setComponents(f-l,E-r,z-M,X-k).normalize(),t[1].setComponents(f+l,E+r,z+M,X+k).normalize(),t[2].setComponents(f+u,E+v,z+D,X+F).normalize(),t[3].setComponents(f-u,E-v,z-D,X-F).normalize(),t[4].setComponents(f-h,E-b,z-L,X-G).normalize(),t[5].setComponents(f+h,E+b,z+L,X+G).normalize(),this},intersectsObject:function(e){var t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),Sc.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Sc)},intersectsSprite:function(e){return Sc.center.set(0,0,0),Sc.radius=.7071067811865476,Sc.applyMatrix4(e.matrixWorld),this.intersectsSphere(Sc)},intersectsSphere:function(e){for(var t=this.planes,i=e.center,l=-e.radius,u=0;u<6;u++){var h=t[u].distanceToPoint(i);if(h<l)return!1}return!0},intersectsBox:function(e){for(var t=this.planes,i=0;i<6;i++){var l=t[i];if(mf.x=l.normal.x>0?e.max.x:e.min.x,mf.y=l.normal.y>0?e.max.y:e.min.y,mf.z=l.normal.z>0?e.max.z:e.min.z,l.distanceToPoint(mf)<0)return!1}return!0},containsPoint:function(e){for(var t=this.planes,i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}});var an={common:{diffuse:{value:new tn(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new dr},uv2Transform:{value:new dr},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Lt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new tn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new tn(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new dr}},sprite:{diffuse:{value:new tn(15658734)},opacity:{value:1},center:{value:new Lt(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new dr}}};function Zx(){var e=null,t=!1,i=null;function l(u,h){t!==!1&&(i(u,h),e.requestAnimationFrame(l))}return{start:function(){t!==!0&&i!==null&&(e.requestAnimationFrame(l),t=!0)},stop:function(){t=!1},setAnimationLoop:function(u){i=u},setContext:function(u){e=u}}}function wE(e,t){var i=t.isWebGL2,l=new WeakMap;function u(b,E){var M=b.array,D=b.usage,L=e.createBuffer();e.bindBuffer(E,L),e.bufferData(E,M,D),b.onUploadCallback();var z=5126;return M instanceof Float32Array?z=5126:M instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):M instanceof Uint16Array?z=5123:M instanceof Int16Array?z=5122:M instanceof Uint32Array?z=5125:M instanceof Int32Array?z=5124:M instanceof Int8Array?z=5120:M instanceof Uint8Array&&(z=5121),{buffer:L,type:z,bytesPerElement:M.BYTES_PER_ELEMENT,version:b.version}}function h(b,E,M){var D=E.array,L=E.updateRange;e.bindBuffer(M,b),L.count===-1?e.bufferSubData(M,0,D):(i?e.bufferSubData(M,L.offset*D.BYTES_PER_ELEMENT,D,L.offset,L.count):e.bufferSubData(M,L.offset*D.BYTES_PER_ELEMENT,D.subarray(L.offset,L.offset+L.count)),L.count=-1)}function f(b){return b.isInterleavedBufferAttribute&&(b=b.data),l.get(b)}function r(b){b.isInterleavedBufferAttribute&&(b=b.data);var E=l.get(b);E&&(e.deleteBuffer(E.buffer),l.delete(b))}function v(b,E){b.isInterleavedBufferAttribute&&(b=b.data);var M=l.get(b);M===void 0?l.set(b,u(b,E)):M.version<b.version&&(h(M.buffer,b,E),M.version=b.version)}return{get:f,remove:r,update:v}}function gf(e,t,i,l){Fn.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:l},this.fromBufferGeometry(new Dc(e,t,i,l)),this.mergeVertices()}gf.prototype=Object.create(Fn.prototype),gf.prototype.constructor=gf;function Dc(e,t,i,l){vn.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:l},e=e||1,t=t||1;var u=e/2,h=t/2,f=Math.floor(i)||1,r=Math.floor(l)||1,v=f+1,b=r+1,E=e/f,M=t/r,D,L,z=[],k=[],F=[],G=[];for(L=0;L<b;L++){var X=L*M-h;for(D=0;D<v;D++){var re=D*E-u;k.push(re,-X,0),F.push(0,0,1),G.push(D/f),G.push(1-L/r)}}for(L=0;L<r;L++)for(D=0;D<f;D++){var ue=D+v*L,$=D+v*(L+1),te=D+1+v*(L+1),oe=D+1+v*L;z.push(ue,$,oe),z.push($,te,oe)}this.setIndex(z),this.setAttribute("position",new ln(k,3)),this.setAttribute("normal",new ln(F,3)),this.setAttribute("uv",new ln(G,2))}Dc.prototype=Object.create(vn.prototype),Dc.prototype.constructor=Dc;var ME=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,TE=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,EE=`#ifdef ALPHATEST
	if ( diffuseColor.a < ALPHATEST ) discard;
#endif`,CE=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );
	#endif
#endif`,AE=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,SE="vec3 transformed = vec3( position );",DE=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,PE=`vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	return vec2( -1.04, 1.04 ) * a004 + r.zw;
}
float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
#if defined ( PHYSICALLY_CORRECT_LIGHTS )
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
#else
	if( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
		return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );
	}
	return 1.0;
#endif
}
vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {
	float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );
	return ( 1.0 - specularColor ) * fresnel + specularColor;
}
vec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {
	float fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );
	vec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;
	return Fr * fresnel + F0;
}
float G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	return 1.0 / ( gl * gv );
}
float G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + viewDir );
	float dotNL = saturate( dot( normal, incidentLight.direction ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( G * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE  = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS  = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
vec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	return specularColor * brdf.x + brdf.y;
}
void BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	vec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	vec3 FssEss = F * brdf.x + brdf.y;
	float Ess = brdf.x + brdf.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
float GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {
	return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );
}
float BlinnExponentToGGXRoughness( const in float blinnExponent ) {
	return sqrt( 2.0 / ( blinnExponent + 2.0 ) );
}
#if defined( USE_SHEEN )
float D_Charlie(float roughness, float NoH) {
	float invAlpha  = 1.0 / roughness;
	float cos2h = NoH * NoH;
	float sin2h = max(1.0 - cos2h, 0.0078125);	return (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);
}
float V_Neubelt(float NoV, float NoL) {
	return saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));
}
vec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {
	vec3 N = geometry.normal;
	vec3 V = geometry.viewDir;
	vec3 H = normalize( V + L );
	float dotNH = saturate( dot( N, H ) );
	return specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );
}
#endif`,LE=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 );
		fDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,IE=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;
	}
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;
		}
		if ( clipped ) discard;
	#endif
#endif`,RE=`#if NUM_CLIPPING_PLANES > 0
	#if ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )
		varying vec3 vViewPosition;
	#endif
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,zE=`#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )
	varying vec3 vViewPosition;
#endif`,kE=`#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )
	vViewPosition = - mvPosition.xyz;
#endif`,BE=`#ifdef USE_COLOR
	diffuseColor.rgb *= vColor;
#endif`,FE=`#ifdef USE_COLOR
	varying vec3 vColor;
#endif`,OE=`#ifdef USE_COLOR
	varying vec3 vColor;
#endif`,NE=`#ifdef USE_COLOR
	vColor.xyz = color.xyz;
#endif`,UE=`#define PI 3.14159265359
#define PI2 6.28318530718
#define PI_HALF 1.5707963267949
#define RECIPROCAL_PI 0.31830988618
#define RECIPROCAL_PI2 0.15915494
#define LOG2 1.442695
#define EPSILON 1e-6
#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement(a) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract(sin(sn) * c);
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
vec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	float distance = dot( planeNormal, point - pointOnPlane );
	return - distance * planeNormal + point;
}
float sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return sign( dot( point - pointOnPlane, planeNormal ) );
}
vec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
  return m[ 2 ][ 3 ] == - 1.0;
}`,VE=`#ifdef ENVMAP_TYPE_CUBE_UV
#define cubeUV_maxMipLevel 8.0
#define cubeUV_minMipLevel 4.0
#define cubeUV_maxTileSize 256.0
#define cubeUV_minTileSize 16.0
float getFace(vec3 direction) {
    vec3 absDirection = abs(direction);
    float face = -1.0;
    if (absDirection.x > absDirection.z) {
      if (absDirection.x > absDirection.y)
        face = direction.x > 0.0 ? 0.0 : 3.0;
      else
        face = direction.y > 0.0 ? 1.0 : 4.0;
    } else {
      if (absDirection.z > absDirection.y)
        face = direction.z > 0.0 ? 2.0 : 5.0;
      else
        face = direction.y > 0.0 ? 1.0 : 4.0;
    }
    return face;
}
vec2 getUV(vec3 direction, float face) {
    vec2 uv;
    if (face == 0.0) {
      uv = vec2(-direction.z, direction.y) / abs(direction.x);
    } else if (face == 1.0) {
      uv = vec2(direction.x, -direction.z) / abs(direction.y);
    } else if (face == 2.0) {
      uv = direction.xy / abs(direction.z);
    } else if (face == 3.0) {
      uv = vec2(direction.z, direction.y) / abs(direction.x);
    } else if (face == 4.0) {
      uv = direction.xz / abs(direction.y);
    } else {
      uv = vec2(-direction.x, direction.y) / abs(direction.z);
    }
    return 0.5 * (uv + 1.0);
}
vec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
  float face = getFace(direction);
  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
  mipInt = max(mipInt, cubeUV_minMipLevel);
  float faceSize = exp2(mipInt);
  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
  vec2 uv = getUV(direction, face) * (faceSize - 1.0);
  vec2 f = fract(uv);
  uv += 0.5 - f;
  if (face > 2.0) {
    uv.y += faceSize;
    face -= 3.0;
  }
  uv.x += face * faceSize;
  if(mipInt < cubeUV_maxMipLevel){
    uv.y += 2.0 * cubeUV_maxTileSize;
  }
  uv.y += filterInt * 2.0 * cubeUV_minTileSize;
  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
  uv *= texelSize;
  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  uv.x += texelSize;
  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  uv.y += texelSize;
  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  uv.x -= texelSize;
  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  vec3 tm = mix(tl, tr, f.x);
  vec3 bm = mix(bl, br, f.x);
  return mix(tm, bm, f.y);
}
#define r0 1.0
#define v0 0.339
#define m0 -2.0
#define r1 0.8
#define v1 0.276
#define m1 -1.0
#define r4 0.4
#define v4 0.046
#define m4 2.0
#define r5 0.305
#define v5 0.016
#define m5 3.0
#define r6 0.21
#define v6 0.0038
#define m6 4.0
float roughnessToMip(float roughness) {
  float mip = 0.0;
  if (roughness >= r1) {
    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
  } else if (roughness >= r4) {
    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
  } else if (roughness >= r5) {
    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
  } else if (roughness >= r6) {
    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
  } else {
    mip = -2.0 * log2(1.16 * roughness);  }
  return mip;
}
vec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {
  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);
  float mipF = fract(mip);
  float mipInt = floor(mip);
  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);
  if (mipF == 0.0) {
    return vec4(color0, 1.0);
  } else {
    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);
    return vec4(mix(color0, color1, mipF), 1.0);
  }
}
#endif`,GE=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	transformedNormal = mat3( instanceMatrix ) * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,HE=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,WE=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,jE=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,$E=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,qE="gl_FragColor = linearToOutputTexel( gl_FragColor );",ZE=`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value )  {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,XE=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		}  else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#elif defined( ENVMAP_TYPE_EQUIREC )
		vec2 sampleUV;
		reflectVec = normalize( reflectVec );
		sampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
		sampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;
		vec4 envColor = texture2D( envMap, sampleUV );
	#elif defined( ENVMAP_TYPE_SPHERE )
		reflectVec = normalize( reflectVec );
		vec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );
		vec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifndef ENVMAP_TYPE_CUBE_UV
		envColor = envMapTexelToLinear( envColor );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,YE=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,JE=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,KE=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,QE=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) { 
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,eC=`#ifdef USE_FOG
	fogDepth = -mvPosition.z;
#endif`,tC=`#ifdef USE_FOG
	varying float fogDepth;
#endif`,nC=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, fogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,iC=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float fogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,rC=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,oC=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel= texture2D( lightMap, vUv2 );
	reflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
#endif`,aC=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,sC=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
#endif`,lC=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {
	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	return irradiance;
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
		int shadow;
		float shadowBias;
		float shadowRadius;
		vec2 shadowMapSize;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		directLight.color = directionalLight.color;
		directLight.direction = directionalLight.direction;
		directLight.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
		int shadow;
		float shadowBias;
		float shadowRadius;
		vec2 shadowMapSize;
		float shadowCameraNear;
		float shadowCameraFar;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = pointLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		directLight.color = pointLight.color;
		directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );
		directLight.visible = ( directLight.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
		int shadow;
		float shadowBias;
		float shadowRadius;
		vec2 shadowMapSize;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {
		vec3 lVector = spotLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		float angleCos = dot( directLight.direction, spotLight.direction );
		if ( angleCos > spotLight.coneCos ) {
			float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );
			directLight.color = spotLight.color;
			directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );
			directLight.visible = true;
		} else {
			directLight.color = vec3( 0.0 );
			directLight.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			irradiance *= PI;
		#endif
		return irradiance;
	}
#endif`,cC=`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {
		vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );
			#else
				vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
		#else
			vec4 envMapColor = vec4( 0.0 );
		#endif
		return PI * envMapColor.rgb * envMapIntensity;
	}
	float getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {
		float maxMIPLevelScalar = float( maxMIPLevel );
		float sigma = PI * roughness * roughness / ( 1.0 + roughness );
		float desiredMIPLevel = maxMIPLevelScalar + log2( sigma );
		return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );
	}
	vec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {
		#ifdef ENVMAP_MODE_REFLECTION
		  vec3 reflectVec = reflect( -viewDir, normal );
		  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
		#else
		  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );
		#endif
		reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
		float specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );
			#else
				vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
		#elif defined( ENVMAP_TYPE_EQUIREC )
			vec2 sampleUV;
			sampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
			sampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );
			#else
				vec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_SPHERE )
			vec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );
			#else
				vec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#endif
		return envMapColor.rgb * envMapIntensity;
	}
#endif`,uC=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,hC=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct ToonMaterial {
	vec3	diffuseColor;
	vec3	specularColor;
	float	specularShininess;
	float	specularStrength;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,dC=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,pC=`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct BlinnPhongMaterial {
	vec3	diffuseColor;
	vec3	specularColor;
	float	specularShininess;
	float	specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,fC=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;
material.specularRoughness = min( material.specularRoughness, 1.0 );
#ifdef REFLECTIVITY
	material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );
#endif
#ifdef CLEARCOAT
	material.clearcoat = saturate( clearcoat );	material.clearcoatRoughness = max( clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheen;
#endif`,mC=`struct PhysicalMaterial {
	vec3	diffuseColor;
	float	specularRoughness;
	vec3	specularColor;
#ifdef CLEARCOAT
	float clearcoat;
	float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	vec3 sheenColor;
#endif
};
#define MAXIMUM_SPECULAR_COEFFICIENT 0.16
#define DEFAULT_SPECULAR_COEFFICIENT 0.04
float clearcoatDHRApprox( const in float roughness, const in float dotNL ) {
	return DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.specularRoughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	#ifdef CLEARCOAT
		float ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = ccDotNL * directLight.color;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			ccIrradiance *= PI;
		#endif
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
		reflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
	#else
		float clearcoatDHR = 0.0;
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(
			material.specularRoughness,
			directLight.direction,
			geometry,
			material.sheenColor
		);
	#else
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);
	#endif
	reflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef CLEARCOAT
		float ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		reflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
		float ccDotNL = ccDotNV;
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
	#else
		float clearcoatDHR = 0.0;
	#endif
	float clearcoatInv = 1.0 - clearcoatDHR;
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	BRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,gC=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointDirectLightIrradiance( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		directLight.color *= all( bvec3( pointLight.shadow, directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotDirectLightIrradiance( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		directLight.color *= all( bvec3( spotLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directLight.color *= all( bvec3( directionalLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,yC=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );
	#ifdef CLEARCOAT
		clearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );
	#endif
#endif`,_C=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,vC=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,xC=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,bC=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,wC=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,MC=`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,TC=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,EC=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,CC=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,AC=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,SC=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,DC=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
	objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
	objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
	objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
#endif`,PC=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifndef USE_MORPHNORMALS
	uniform float morphTargetInfluences[ 8 ];
	#else
	uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,LC=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	transformed += morphTarget0 * morphTargetInfluences[ 0 ];
	transformed += morphTarget1 * morphTargetInfluences[ 1 ];
	transformed += morphTarget2 * morphTargetInfluences[ 2 ];
	transformed += morphTarget3 * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
	transformed += morphTarget4 * morphTargetInfluences[ 4 ];
	transformed += morphTarget5 * morphTargetInfluences[ 5 ];
	transformed += morphTarget6 * morphTargetInfluences[ 6 ];
	transformed += morphTarget7 * morphTargetInfluences[ 7 ];
	#endif
#endif`,IC=`#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
			bitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,RC=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( -vViewPosition, normal, mapN );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );
#endif`,zC=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		float scale = sign( st1.t * st0.s - st0.t * st1.s );
		vec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );
		vec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );
		vec3 N = normalize( surf_norm );
		mat3 tsn = mat3( S, T, N );
		mapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		return normalize( tsn * mapN );
	}
#endif`,kC=`#ifdef CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,BC=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );
	#endif
#endif`,FC=`#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,OC=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return (( near + viewZ ) * far ) / (( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,NC=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,UC=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,VC=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,GC=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,HC=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,WC=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,jC=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,$C=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,qC=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;
	}
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;
	}
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;
	}
	#endif
#endif`,ZC=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLight directionalLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLights[ i ];
		shadow *= all( bvec2( directionalLight.shadow, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLight spotLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLights[ i ];
		shadow *= all( bvec2( spotLight.shadow, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLight pointLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLights[ i ];
		shadow *= all( bvec2( pointLight.shadow, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#endif
	#endif
	return shadow;
}`,XC=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,YC=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,JC=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,KC=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,QC=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,eA=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tA=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,nA=`#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
uniform float toneMappingWhitePoint;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )
vec3 Uncharted2ToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );
}`,iA=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,rA=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,oA=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,aA=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,sA=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,lA=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,cA=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,uA=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,hA=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,dA=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,pA=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,fA=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( gl_FragCoord.z );
	#endif
}`,mA=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
}`,gA=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,yA=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,_A=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV;
	sampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,vA=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,xA=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,bA=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	vLineDistance = scale * lineDistance;
	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,wA=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
	
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,MA=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <skinbase_vertex>
	#ifdef USE_ENVMAP
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,TA=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	reflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,EA=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,CA=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,AA=`#define MATCAP
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#ifndef FLAT_SHADED
		vNormal = normalize( transformedNormal );
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,SA=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,DA=`#define TOON
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,PA=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,LA=`#define PHONG
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,IA=`#define STANDARD
#ifdef PHYSICAL
	#define REFLECTIVITY
	#define CLEARCOAT
	#define TRANSPARENCY
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef TRANSPARENCY
	uniform float transparency;
#endif
#ifdef REFLECTIVITY
	uniform float reflectivity;
#endif
#ifdef CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheen;
#endif
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <lights_physical_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_normalmap_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#ifdef TRANSPARENCY
		diffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );
	#endif
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,RA=`#define STANDARD
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,zA=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <packing>
#include <uv_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,kA=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,BA=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,FA=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,OA=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,NA=`#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,UA=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,VA=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Xn={alphamap_fragment:ME,alphamap_pars_fragment:TE,alphatest_fragment:EE,aomap_fragment:CE,aomap_pars_fragment:AE,begin_vertex:SE,beginnormal_vertex:DE,bsdfs:PE,bumpmap_pars_fragment:LE,clipping_planes_fragment:IE,clipping_planes_pars_fragment:RE,clipping_planes_pars_vertex:zE,clipping_planes_vertex:kE,color_fragment:BE,color_pars_fragment:FE,color_pars_vertex:OE,color_vertex:NE,common:UE,cube_uv_reflection_fragment:VE,defaultnormal_vertex:GE,displacementmap_pars_vertex:HE,displacementmap_vertex:WE,emissivemap_fragment:jE,emissivemap_pars_fragment:$E,encodings_fragment:qE,encodings_pars_fragment:ZE,envmap_fragment:XE,envmap_common_pars_fragment:YE,envmap_pars_fragment:JE,envmap_pars_vertex:KE,envmap_physical_pars_fragment:cC,envmap_vertex:QE,fog_vertex:eC,fog_pars_vertex:tC,fog_fragment:nC,fog_pars_fragment:iC,gradientmap_pars_fragment:rC,lightmap_fragment:oC,lightmap_pars_fragment:aC,lights_lambert_vertex:sC,lights_pars_begin:lC,lights_toon_fragment:uC,lights_toon_pars_fragment:hC,lights_phong_fragment:dC,lights_phong_pars_fragment:pC,lights_physical_fragment:fC,lights_physical_pars_fragment:mC,lights_fragment_begin:gC,lights_fragment_maps:yC,lights_fragment_end:_C,logdepthbuf_fragment:vC,logdepthbuf_pars_fragment:xC,logdepthbuf_pars_vertex:bC,logdepthbuf_vertex:wC,map_fragment:MC,map_pars_fragment:TC,map_particle_fragment:EC,map_particle_pars_fragment:CC,metalnessmap_fragment:AC,metalnessmap_pars_fragment:SC,morphnormal_vertex:DC,morphtarget_pars_vertex:PC,morphtarget_vertex:LC,normal_fragment_begin:IC,normal_fragment_maps:RC,normalmap_pars_fragment:zC,clearcoat_normal_fragment_begin:kC,clearcoat_normal_fragment_maps:BC,clearcoat_normalmap_pars_fragment:FC,packing:OC,premultiplied_alpha_fragment:NC,project_vertex:UC,dithering_fragment:VC,dithering_pars_fragment:GC,roughnessmap_fragment:HC,roughnessmap_pars_fragment:WC,shadowmap_pars_fragment:jC,shadowmap_pars_vertex:$C,shadowmap_vertex:qC,shadowmask_pars_fragment:ZC,skinbase_vertex:XC,skinning_pars_vertex:YC,skinning_vertex:JC,skinnormal_vertex:KC,specularmap_fragment:QC,specularmap_pars_fragment:eA,tonemapping_fragment:tA,tonemapping_pars_fragment:nA,uv_pars_fragment:iA,uv_pars_vertex:rA,uv_vertex:oA,uv2_pars_fragment:aA,uv2_pars_vertex:sA,uv2_vertex:lA,worldpos_vertex:cA,background_frag:uA,background_vert:hA,cube_frag:dA,cube_vert:pA,depth_frag:fA,depth_vert:mA,distanceRGBA_frag:gA,distanceRGBA_vert:yA,equirect_frag:_A,equirect_vert:vA,linedashed_frag:xA,linedashed_vert:bA,meshbasic_frag:wA,meshbasic_vert:MA,meshlambert_frag:TA,meshlambert_vert:EA,meshmatcap_frag:CA,meshmatcap_vert:AA,meshtoon_frag:SA,meshtoon_vert:DA,meshphong_frag:PA,meshphong_vert:LA,meshphysical_frag:IA,meshphysical_vert:RA,normal_frag:zA,normal_vert:kA,points_frag:BA,points_vert:FA,shadow_frag:OA,shadow_vert:NA,sprite_frag:UA,sprite_vert:VA},Ra={basic:{uniforms:pr([an.common,an.specularmap,an.envmap,an.aomap,an.lightmap,an.fog]),vertexShader:Xn.meshbasic_vert,fragmentShader:Xn.meshbasic_frag},lambert:{uniforms:pr([an.common,an.specularmap,an.envmap,an.aomap,an.lightmap,an.emissivemap,an.fog,an.lights,{emissive:{value:new tn(0)}}]),vertexShader:Xn.meshlambert_vert,fragmentShader:Xn.meshlambert_frag},phong:{uniforms:pr([an.common,an.specularmap,an.envmap,an.aomap,an.lightmap,an.emissivemap,an.bumpmap,an.normalmap,an.displacementmap,an.fog,an.lights,{emissive:{value:new tn(0)},specular:{value:new tn(1118481)},shininess:{value:30}}]),vertexShader:Xn.meshphong_vert,fragmentShader:Xn.meshphong_frag},standard:{uniforms:pr([an.common,an.envmap,an.aomap,an.lightmap,an.emissivemap,an.bumpmap,an.normalmap,an.displacementmap,an.roughnessmap,an.metalnessmap,an.fog,an.lights,{emissive:{value:new tn(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:Xn.meshphysical_vert,fragmentShader:Xn.meshphysical_frag},toon:{uniforms:pr([an.common,an.specularmap,an.aomap,an.lightmap,an.emissivemap,an.bumpmap,an.normalmap,an.displacementmap,an.gradientmap,an.fog,an.lights,{emissive:{value:new tn(0)},specular:{value:new tn(1118481)},shininess:{value:30}}]),vertexShader:Xn.meshtoon_vert,fragmentShader:Xn.meshtoon_frag},matcap:{uniforms:pr([an.common,an.bumpmap,an.normalmap,an.displacementmap,an.fog,{matcap:{value:null}}]),vertexShader:Xn.meshmatcap_vert,fragmentShader:Xn.meshmatcap_frag},points:{uniforms:pr([an.points,an.fog]),vertexShader:Xn.points_vert,fragmentShader:Xn.points_frag},dashed:{uniforms:pr([an.common,an.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Xn.linedashed_vert,fragmentShader:Xn.linedashed_frag},depth:{uniforms:pr([an.common,an.displacementmap]),vertexShader:Xn.depth_vert,fragmentShader:Xn.depth_frag},normal:{uniforms:pr([an.common,an.bumpmap,an.normalmap,an.displacementmap,{opacity:{value:1}}]),vertexShader:Xn.normal_vert,fragmentShader:Xn.normal_frag},sprite:{uniforms:pr([an.sprite,an.fog]),vertexShader:Xn.sprite_vert,fragmentShader:Xn.sprite_frag},background:{uniforms:{uvTransform:{value:new dr},t2D:{value:null}},vertexShader:Xn.background_vert,fragmentShader:Xn.background_frag},cube:{uniforms:pr([an.envmap,{opacity:{value:1}}]),vertexShader:Xn.cube_vert,fragmentShader:Xn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Xn.equirect_vert,fragmentShader:Xn.equirect_frag},distanceRGBA:{uniforms:pr([an.common,an.displacementmap,{referencePosition:{value:new Se},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Xn.distanceRGBA_vert,fragmentShader:Xn.distanceRGBA_frag},shadow:{uniforms:pr([an.lights,an.fog,{color:{value:new tn(0)},opacity:{value:1}}]),vertexShader:Xn.shadow_vert,fragmentShader:Xn.shadow_frag}};Ra.physical={uniforms:pr([Ra.standard.uniforms,{transparency:{value:0},clearcoat:{value:0},clearcoatRoughness:{value:0},sheen:{value:new tn(0)},clearcoatNormalScale:{value:new Lt(1,1)},clearcoatNormalMap:{value:null}}]),vertexShader:Xn.meshphysical_vert,fragmentShader:Xn.meshphysical_frag};function GA(e,t,i,l){var u=new tn(0),h=0,f,r,v=null,b=0,E=null;function M(L,z,k,F){var G=z.background,X=e.xr,re=X.getSession&&X.getSession();if(re&&re.environmentBlendMode==="additive"&&(G=null),G===null?D(u,h):G&&G.isColor&&(D(G,1),F=!0),(e.autoClear||F)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),G&&(G.isCubeTexture||G.isWebGLCubeRenderTarget||G.mapping===uh)){r===void 0&&(r=new Ai(new ff(1,1,1),new Nr({type:"BackgroundCubeMaterial",uniforms:Mc(Ra.cube.uniforms),vertexShader:Ra.cube.vertexShader,fragmentShader:Ra.cube.fragmentShader,side:tr,depthTest:!1,depthWrite:!1,fog:!1})),r.geometry.deleteAttribute("normal"),r.geometry.deleteAttribute("uv"),r.onBeforeRender=function($,te,oe){this.matrixWorld.copyPosition(oe.matrixWorld)},Object.defineProperty(r.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(r));var ue=G.isWebGLCubeRenderTarget?G.texture:G;r.material.uniforms.envMap.value=ue,r.material.uniforms.flipEnvMap.value=ue.isCubeTexture?-1:1,(v!==G||b!==ue.version||E!==e.toneMapping)&&(r.material.needsUpdate=!0,v=G,b=ue.version,E=e.toneMapping),L.unshift(r,r.geometry,r.material,0,0,null)}else G&&G.isTexture&&(f===void 0&&(f=new Ai(new Dc(2,2),new Nr({type:"BackgroundMaterial",uniforms:Mc(Ra.background.uniforms),vertexShader:Ra.background.vertexShader,fragmentShader:Ra.background.fragmentShader,side:tc,depthTest:!1,depthWrite:!1,fog:!1})),f.geometry.deleteAttribute("normal"),Object.defineProperty(f.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(f)),f.material.uniforms.t2D.value=G,G.matrixAutoUpdate===!0&&G.updateMatrix(),f.material.uniforms.uvTransform.value.copy(G.matrix),(v!==G||b!==G.version||E!==e.toneMapping)&&(f.material.needsUpdate=!0,v=G,b=G.version,E=e.toneMapping),L.unshift(f,f.geometry,f.material,0,0,null))}function D(L,z){t.buffers.color.setClear(L.r,L.g,L.b,z,l)}return{getClearColor:function(){return u},setClearColor:function(L,z){u.set(L),h=z!==void 0?z:1,D(u,h)},getClearAlpha:function(){return h},setClearAlpha:function(L){h=L,D(u,h)},render:M}}function HA(e,t,i,l){var u=l.isWebGL2,h;function f(b){h=b}function r(b,E){e.drawArrays(h,b,E),i.update(E,h)}function v(b,E,M,D){if(D!==0){var L,z;if(u)L=e,z="drawArraysInstanced";else if(L=t.get("ANGLE_instanced_arrays"),z="drawArraysInstancedANGLE",L===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}L[z](h,E,M,D),i.update(M,h,D)}}this.setMode=f,this.render=r,this.renderInstances=v}function WA(e,t,i){var l;function u(){if(l!==void 0)return l;var te=t.get("EXT_texture_filter_anisotropic");return te!==null?l=e.getParameter(te.MAX_TEXTURE_MAX_ANISOTROPY_EXT):l=0,l}function h(te){if(te==="highp"){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";te="mediump"}return te==="mediump"&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var f=typeof WebGL2RenderingContext!="undefined"&&e instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext!="undefined"&&e instanceof WebGL2ComputeRenderingContext,r=i.precision!==void 0?i.precision:"highp",v=h(r);v!==r&&(console.warn("THREE.WebGLRenderer:",r,"not supported, using",v,"instead."),r=v);var b=i.logarithmicDepthBuffer===!0,E=e.getParameter(34930),M=e.getParameter(35660),D=e.getParameter(3379),L=e.getParameter(34076),z=e.getParameter(34921),k=e.getParameter(36347),F=e.getParameter(36348),G=e.getParameter(36349),X=M>0,re=f||!!t.get("OES_texture_float"),ue=X&&re,$=f?e.getParameter(36183):0;return{isWebGL2:f,getMaxAnisotropy:u,getMaxPrecision:h,precision:r,logarithmicDepthBuffer:b,maxTextures:E,maxVertexTextures:M,maxTextureSize:D,maxCubemapSize:L,maxAttributes:z,maxVertexUniforms:k,maxVaryings:F,maxFragmentUniforms:G,vertexTextures:X,floatFragmentTextures:re,floatVertexTextures:ue,maxSamples:$}}function jA(){var e=this,t=null,i=0,l=!1,u=!1,h=new jo,f=new dr,r={value:null,needsUpdate:!1};this.uniform=r,this.numPlanes=0,this.numIntersection=0,this.init=function(E,M,D){var L=E.length!==0||M||i!==0||l;return l=M,t=b(E,D,0),i=E.length,L},this.beginShadows=function(){u=!0,b(null)},this.endShadows=function(){u=!1,v()},this.setState=function(E,M,D,L,z,k){if(!l||E===null||E.length===0||u&&!D)u?b(null):v();else{var F=u?0:i,G=F*4,X=z.clippingState||null;r.value=X,X=b(E,L,G,k);for(var re=0;re!==G;++re)X[re]=t[re];z.clippingState=X,this.numIntersection=M?this.numPlanes:0,this.numPlanes+=F}};function v(){r.value!==t&&(r.value=t,r.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function b(E,M,D,L){var z=E!==null?E.length:0,k=null;if(z!==0){if(k=r.value,L!==!0||k===null){var F=D+z*4,G=M.matrixWorldInverse;f.getNormalMatrix(G),(k===null||k.length<F)&&(k=new Float32Array(F));for(var X=0,re=D;X!==z;++X,re+=4)h.copy(E[X]).applyMatrix4(G,f),h.normal.toArray(k,re),k[re+3]=h.constant}r.value=k,r.needsUpdate=!0}return e.numPlanes=z,k}}function $A(e){var t={};return{get:function(i){if(t[i]!==void 0)return t[i];var l;switch(i){case"WEBGL_depth_texture":l=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":l=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":l=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":l=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:l=e.getExtension(i)}return l===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),t[i]=l,l}}}function qA(e,t,i){var l=new WeakMap,u=new WeakMap;function h(E){var M=E.target,D=l.get(M);D.index!==null&&t.remove(D.index);for(var L in D.attributes)t.remove(D.attributes[L]);M.removeEventListener("dispose",h),l.delete(M);var z=u.get(D);z&&(t.remove(z),u.delete(D)),i.memory.geometries--}function f(E,M){var D=l.get(M);return D||(M.addEventListener("dispose",h),M.isBufferGeometry?D=M:M.isGeometry&&(M._bufferGeometry===void 0&&(M._bufferGeometry=new vn().setFromObject(E)),D=M._bufferGeometry),l.set(M,D),i.memory.geometries++,D)}function r(E){var M=E.index,D=E.attributes;M!==null&&t.update(M,34963);for(var L in D)t.update(D[L],34962);var z=E.morphAttributes;for(var L in z)for(var k=z[L],F=0,G=k.length;F<G;F++)t.update(k[F],34962)}function v(E){var M=[],D=E.index,L=E.attributes.position,z=0;if(D!==null){var k=D.array;z=D.version;for(var F=0,G=k.length;F<G;F+=3){var X=k[F+0],re=k[F+1],ue=k[F+2];M.push(X,re,re,ue,ue,X)}}else{var k=L.array;z=L.version;for(var F=0,G=k.length/3-1;F<G;F+=3){var X=F+0,re=F+1,ue=F+2;M.push(X,re,re,ue,ue,X)}}var $=new(jx(M)>65535?wh:bh)(M,1);$.version=z,t.update($,34963);var te=u.get(E);te&&t.remove(te),u.set(E,$)}function b(E){var M=u.get(E);if(M){var D=E.index;D!==null&&M.version<D.version&&v(E)}else v(E);return u.get(E)}return{get:f,update:r,getWireframeAttribute:b}}function ZA(e,t,i,l){var u=l.isWebGL2,h;function f(D){h=D}var r,v;function b(D){r=D.type,v=D.bytesPerElement}function E(D,L){e.drawElements(h,L,r,D*v),i.update(L,h)}function M(D,L,z,k){if(k!==0){var F,G;if(u)F=e,G="drawElementsInstanced";else if(F=t.get("ANGLE_instanced_arrays"),G="drawElementsInstancedANGLE",F===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}F[G](h,z,r,L*v,k),i.update(z,h,k)}}this.setMode=f,this.setIndex=b,this.render=E,this.renderInstances=M}function XA(e){var t={geometries:0,textures:0},i={frame:0,calls:0,triangles:0,points:0,lines:0};function l(h,f,r){switch(r=r||1,i.calls++,f){case 4:i.triangles+=r*(h/3);break;case 1:i.lines+=r*(h/2);break;case 3:i.lines+=r*(h-1);break;case 2:i.lines+=r*h;break;case 0:i.points+=r*h;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",f);break}}function u(){i.frame++,i.calls=0,i.triangles=0,i.points=0,i.lines=0}return{memory:t,render:i,programs:null,autoReset:!0,reset:u,update:l}}function YA(e,t){return Math.abs(t[1])-Math.abs(e[1])}function JA(e){var t={},i=new Float32Array(8);function l(u,h,f,r){var v=u.morphTargetInfluences,b=v===void 0?0:v.length,E=t[h.id];if(E===void 0){E=[];for(var M=0;M<b;M++)E[M]=[M,0];t[h.id]=E}for(var D=f.morphTargets&&h.morphAttributes.position,L=f.morphNormals&&h.morphAttributes.normal,M=0;M<b;M++){var z=E[M];z[1]!==0&&(D&&h.deleteAttribute("morphTarget"+M),L&&h.deleteAttribute("morphNormal"+M))}for(var M=0;M<b;M++){var z=E[M];z[0]=M,z[1]=v[M]}E.sort(YA);for(var k=0,M=0;M<8;M++){var z=E[M];if(z){var F=z[0],G=z[1];if(G){D&&h.setAttribute("morphTarget"+M,D[F]),L&&h.setAttribute("morphNormal"+M,L[F]),i[M]=G,k+=G;continue}}i[M]=0}var X=h.morphTargetsRelative?1:1-k;r.getUniforms().setValue(e,"morphTargetBaseInfluence",X),r.getUniforms().setValue(e,"morphTargetInfluences",i)}return{update:l}}function KA(e,t,i,l){var u={};function h(r){var v=l.render.frame,b=r.geometry,E=t.get(r,b);return u[E.id]!==v&&(b.isGeometry&&E.updateFromObject(r),t.update(E),u[E.id]=v),r.isInstancedMesh&&i.update(r.instanceMatrix,34962),E}function f(){u={}}return{update:h,dispose:f}}function os(e,t,i,l,u,h,f,r,v,b){e=e!==void 0?e:[],t=t!==void 0?t:Zg,f=f!==void 0?f:Ma,mi.call(this,e,t,i,l,u,h,f,r,v,b),this.flipY=!1}os.prototype=Object.create(mi.prototype),os.prototype.constructor=os,os.prototype.isCubeTexture=!0,Object.defineProperty(os.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}});function Ah(e,t,i,l){mi.call(this,null),this.image={data:e||null,width:t||1,height:i||1,depth:l||1},this.magFilter=Ui,this.minFilter=Ui,this.wrapR=wr,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}Ah.prototype=Object.create(mi.prototype),Ah.prototype.constructor=Ah,Ah.prototype.isDataTexture2DArray=!0;function Sh(e,t,i,l){mi.call(this,null),this.image={data:e||null,width:t||1,height:i||1,depth:l||1},this.magFilter=Ui,this.minFilter=Ui,this.wrapR=wr,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}Sh.prototype=Object.create(mi.prototype),Sh.prototype.constructor=Sh,Sh.prototype.isDataTexture3D=!0;var Xx=new mi,QA=new Ah,eS=new Sh,Yx=new os,Jx=[],Kx=[],Qx=new Float32Array(16),e0=new Float32Array(9),t0=new Float32Array(4);function Pc(e,t,i){var l=e[0];if(l<=0||l>0)return e;var u=t*i,h=Jx[u];if(h===void 0&&(h=new Float32Array(u),Jx[u]=h),t!==0){l.toArray(h,0);for(var f=1,r=0;f!==t;++f)r+=i,e[f].toArray(h,r)}return h}function _o(e,t){if(e.length!==t.length)return!1;for(var i=0,l=e.length;i<l;i++)if(e[i]!==t[i])return!1;return!0}function oo(e,t){for(var i=0,l=t.length;i<l;i++)e[i]=t[i]}function n0(e,t){var i=Kx[t];i===void 0&&(i=new Int32Array(t),Kx[t]=i);for(var l=0;l!==t;++l)i[l]=e.allocateTextureUnit();return i}function tS(e,t){var i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function nS(e,t){var i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y)&&(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if(_o(i,t))return;e.uniform2fv(this.addr,t),oo(i,t)}}function iS(e,t){var i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z)&&(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(t.r!==void 0)(i[0]!==t.r||i[1]!==t.g||i[2]!==t.b)&&(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if(_o(i,t))return;e.uniform3fv(this.addr,t),oo(i,t)}}function rS(e,t){var i=this.cache;if(t.x!==void 0)(i[0]!==t.x||i[1]!==t.y||i[2]!==t.z||i[3]!==t.w)&&(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if(_o(i,t))return;e.uniform4fv(this.addr,t),oo(i,t)}}function oS(e,t){var i=this.cache,l=t.elements;if(l===void 0){if(_o(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),oo(i,t)}else{if(_o(i,l))return;t0.set(l),e.uniformMatrix2fv(this.addr,!1,t0),oo(i,l)}}function aS(e,t){var i=this.cache,l=t.elements;if(l===void 0){if(_o(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),oo(i,t)}else{if(_o(i,l))return;e0.set(l),e.uniformMatrix3fv(this.addr,!1,e0),oo(i,l)}}function sS(e,t){var i=this.cache,l=t.elements;if(l===void 0){if(_o(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),oo(i,t)}else{if(_o(i,l))return;Qx.set(l),e.uniformMatrix4fv(this.addr,!1,Qx),oo(i,l)}}function lS(e,t,i){var l=this.cache,u=i.allocateTextureUnit();l[0]!==u&&(e.uniform1i(this.addr,u),l[0]=u),i.safeSetTexture2D(t||Xx,u)}function cS(e,t,i){var l=this.cache,u=i.allocateTextureUnit();l[0]!==u&&(e.uniform1i(this.addr,u),l[0]=u),i.setTexture2DArray(t||QA,u)}function uS(e,t,i){var l=this.cache,u=i.allocateTextureUnit();l[0]!==u&&(e.uniform1i(this.addr,u),l[0]=u),i.setTexture3D(t||eS,u)}function hS(e,t,i){var l=this.cache,u=i.allocateTextureUnit();l[0]!==u&&(e.uniform1i(this.addr,u),l[0]=u),i.safeSetTextureCube(t||Yx,u)}function dS(e,t){var i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function pS(e,t){var i=this.cache;_o(i,t)||(e.uniform2iv(this.addr,t),oo(i,t))}function fS(e,t){var i=this.cache;_o(i,t)||(e.uniform3iv(this.addr,t),oo(i,t))}function mS(e,t){var i=this.cache;_o(i,t)||(e.uniform4iv(this.addr,t),oo(i,t))}function gS(e,t){var i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function yS(e){switch(e){case 5126:return tS;case 35664:return nS;case 35665:return iS;case 35666:return rS;case 35674:return oS;case 35675:return aS;case 35676:return sS;case 5124:case 35670:return dS;case 35667:case 35671:return pS;case 35668:case 35672:return fS;case 35669:case 35673:return mS;case 5125:return gS;case 35678:case 36198:case 36298:case 36306:case 35682:return lS;case 35679:case 36299:case 36307:return uS;case 35680:case 36300:case 36308:case 36293:return hS;case 36289:case 36303:case 36311:case 36292:return cS}}function _S(e,t){e.uniform1fv(this.addr,t)}function vS(e,t){e.uniform1iv(this.addr,t)}function xS(e,t){e.uniform2iv(this.addr,t)}function bS(e,t){e.uniform3iv(this.addr,t)}function wS(e,t){e.uniform4iv(this.addr,t)}function MS(e,t){var i=Pc(t,this.size,2);e.uniform2fv(this.addr,i)}function TS(e,t){var i=Pc(t,this.size,3);e.uniform3fv(this.addr,i)}function ES(e,t){var i=Pc(t,this.size,4);e.uniform4fv(this.addr,i)}function CS(e,t){var i=Pc(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function AS(e,t){var i=Pc(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function SS(e,t){var i=Pc(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function DS(e,t,i){var l=t.length,u=n0(i,l);e.uniform1iv(this.addr,u);for(var h=0;h!==l;++h)i.safeSetTexture2D(t[h]||Xx,u[h])}function PS(e,t,i){var l=t.length,u=n0(i,l);e.uniform1iv(this.addr,u);for(var h=0;h!==l;++h)i.safeSetTextureCube(t[h]||Yx,u[h])}function LS(e){switch(e){case 5126:return _S;case 35664:return MS;case 35665:return TS;case 35666:return ES;case 35674:return CS;case 35675:return AS;case 35676:return SS;case 5124:case 35670:return vS;case 35667:case 35671:return xS;case 35668:case 35672:return bS;case 35669:case 35673:return wS;case 35678:case 36198:case 36298:case 36306:case 35682:return DS;case 35680:case 36300:case 36308:case 36293:return PS}}function IS(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=yS(t.type)}function i0(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=LS(t.type)}i0.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),oo(t,e)};function r0(e){this.id=e,this.seq=[],this.map={}}r0.prototype.setValue=function(e,t,i){for(var l=this.seq,u=0,h=l.length;u!==h;++u){var f=l[u];f.setValue(e,t[f.id],i)}};var Sy=/([\w\d_]+)(\])?(\[|\.)?/g;function o0(e,t){e.seq.push(t),e.map[t.id]=t}function RS(e,t,i){var l=e.name,u=l.length;for(Sy.lastIndex=0;;){var h=Sy.exec(l),f=Sy.lastIndex,r=h[1],v=h[2]==="]",b=h[3];if(v&&(r=r|0),b===void 0||b==="["&&f+2===u){o0(i,b===void 0?new IS(r,e,t):new i0(r,e,t));break}else{var E=i.map,M=E[r];M===void 0&&(M=new r0(r),o0(i,M)),i=M}}}function as(e,t){this.seq=[],this.map={};for(var i=e.getProgramParameter(t,35718),l=0;l<i;++l){var u=e.getActiveUniform(t,l),h=e.getUniformLocation(t,u.name);RS(u,h,this)}}as.prototype.setValue=function(e,t,i,l){var u=this.map[t];u!==void 0&&u.setValue(e,i,l)},as.prototype.setOptional=function(e,t,i){var l=t[i];l!==void 0&&this.setValue(e,i,l)},as.upload=function(e,t,i,l){for(var u=0,h=t.length;u!==h;++u){var f=t[u],r=i[f.id];r.needsUpdate!==!1&&f.setValue(e,r.value,l)}},as.seqWithValue=function(e,t){for(var i=[],l=0,u=e.length;l!==u;++l){var h=e[l];h.id in t&&i.push(h)}return i};function a0(e,t,i){var l=e.createShader(t);return e.shaderSource(l,i),e.compileShader(l),l}var zS=0;function kS(e){for(var t=e.split(`
`),i=0;i<t.length;i++)t[i]=i+1+": "+t[i];return t.join(`
`)}function s0(e){switch(e){case no:return["Linear","( value )"];case mh:return["sRGB","( value )"];case ty:return["RGBE","( value )"];case Px:return["RGBM","( value, 7.0 )"];case Lx:return["RGBM","( value, 16.0 )"];case Ix:return["RGBD","( value, 256.0 )"];case Dx:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case QT:return["LogLuv","( value )"];default:throw new Error("unsupported encoding: "+e)}}function l0(e,t,i){var l=e.getShaderParameter(t,35713),u=e.getShaderInfoLog(t).trim();if(l&&u==="")return"";var h=e.getShaderSource(t);return"THREE.WebGLShader: gl.getShaderInfoLog() "+i+`
`+u+kS(h)}function Dh(e,t){var i=s0(t);return"vec4 "+e+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function BS(e,t){var i=s0(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function FS(e,t){var i;switch(t){case $g:i="Linear";break;case pT:i="Reinhard";break;case fT:i="Uncharted2";break;case mT:i="OptimizedCineon";break;case gT:i="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function OS(e){var t=[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||e.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""];return t.filter(Ph).join(`
`)}function NS(e){var t=[];for(var i in e){var l=e[i];l!==!1&&t.push("#define "+i+" "+l)}return t.join(`
`)}function US(e,t){for(var i={},l=e.getProgramParameter(t,35721),u=0;u<l;u++){var h=e.getActiveAttrib(t,u),f=h.name;i[f]=e.getAttribLocation(t,f)}return i}function Ph(e){return e!==""}function c0(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function u0(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var VS=/^[ \t]*#include +<([\w\d./]+)>/gm;function Dy(e){return e.replace(VS,GS)}function GS(e,t){var i=Xn[t];if(i===void 0)throw new Error("Can not resolve #include <"+t+">");return Dy(i)}var HS=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;function h0(e){return e.replace(HS,WS)}function WS(e,t,i,l){for(var u="",h=parseInt(t);h<parseInt(i);h++)u+=l.replace(/\[ i \]/g,"[ "+h+" ]").replace(/UNROLLED_LOOP_INDEX/g,h);return u}function d0(e){var t="precision "+e.precision+` float;
precision `+e.precision+" int;";return e.precision==="highp"?t+=`
#define HIGH_PRECISION`:e.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:e.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function jS(e){var t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===ax?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===W2?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===sh&&(t="SHADOWMAP_TYPE_VSM"),t}function $S(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case Zg:case Xg:t="ENVMAP_TYPE_CUBE";break;case uh:case Jg:t="ENVMAP_TYPE_CUBE_UV";break;case gx:case Yg:t="ENVMAP_TYPE_EQUIREC";break;case yx:t="ENVMAP_TYPE_SPHERE";break}return t}function qS(e){var t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case Xg:case Yg:t="ENVMAP_MODE_REFRACTION";break}return t}function ZS(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case Hp:t="ENVMAP_BLENDING_MULTIPLY";break;case hT:t="ENVMAP_BLENDING_MIX";break;case dT:t="ENVMAP_BLENDING_ADD";break}return t}function XS(e,t,i){var l=e.getContext(),u=i.defines,h=i.vertexShader,f=i.fragmentShader,r=jS(i),v=$S(i),b=qS(i),E=ZS(i),M=e.gammaFactor>0?e.gammaFactor:1,D=i.isWebGL2?"":OS(i),L=NS(u),z=l.createProgram(),k,F,G=i.numMultiviewViews;if(i.isRawShaderMaterial?(k=[L].filter(Ph).join(`
`),k.length>0&&(k+=`
`),F=[D,L].filter(Ph).join(`
`),F.length>0&&(F+=`
`)):(k=[d0(i),"#define SHADER_NAME "+i.shaderName,L,i.instancing?"#define USE_INSTANCING":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+M,"#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+b:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&i.flatShading===!1?"#define USE_MORPHNORMALS":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+r:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Ph).join(`
`),F=[D,d0(i),"#define SHADER_NAME "+i.shaderName,L,i.alphaTest?"#define ALPHATEST "+i.alphaTest+(i.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+M,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+v:"",i.envMap?"#define "+b:"",i.envMap?"#define "+E:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.sheen?"#define USE_SHEEN":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+r:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==Wp?"#define TONE_MAPPING":"",i.toneMapping!==Wp?Xn.tonemapping_pars_fragment:"",i.toneMapping!==Wp?FS("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.outputEncoding||i.mapEncoding||i.matcapEncoding||i.envMapEncoding||i.emissiveMapEncoding||i.lightMapEncoding?Xn.encodings_pars_fragment:"",i.mapEncoding?Dh("mapTexelToLinear",i.mapEncoding):"",i.matcapEncoding?Dh("matcapTexelToLinear",i.matcapEncoding):"",i.envMapEncoding?Dh("envMapTexelToLinear",i.envMapEncoding):"",i.emissiveMapEncoding?Dh("emissiveMapTexelToLinear",i.emissiveMapEncoding):"",i.lightMapEncoding?Dh("lightMapTexelToLinear",i.lightMapEncoding):"",i.outputEncoding?BS("linearToOutputTexel",i.outputEncoding):"",i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"",`
`].filter(Ph).join(`
`)),h=Dy(h),h=c0(h,i),h=u0(h,i),f=Dy(f),f=c0(f,i),f=u0(f,i),h=h0(h),f=h0(f),i.isWebGL2&&!i.isRawShaderMaterial){var X=!1,re=/^\s*#version\s+300\s+es\s*\n/;i.isShaderMaterial&&h.match(re)!==null&&f.match(re)!==null&&(X=!0,h=h.replace(re,""),f=f.replace(re,"")),k=[`#version 300 es
`,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+k,F=[`#version 300 es
`,"#define varying in",X?"":"out highp vec4 pc_fragColor;",X?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+F,G>0&&(k=k.replace(`#version 300 es
`,[`#version 300 es
`,"#extension GL_OVR_multiview2 : require","layout(num_views = "+G+") in;","#define VIEW_ID gl_ViewID_OVR"].join(`
`)),k=k.replace(["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;"].join(`
`),["uniform mat4 modelViewMatrices["+G+"];","uniform mat4 projectionMatrices["+G+"];","uniform mat4 viewMatrices["+G+"];","uniform mat3 normalMatrices["+G+"];","#define modelViewMatrix modelViewMatrices[VIEW_ID]","#define projectionMatrix projectionMatrices[VIEW_ID]","#define viewMatrix viewMatrices[VIEW_ID]","#define normalMatrix normalMatrices[VIEW_ID]"].join(`
`)),F=F.replace(`#version 300 es
`,[`#version 300 es
`,"#extension GL_OVR_multiview2 : require","#define VIEW_ID gl_ViewID_OVR"].join(`
`)),F=F.replace("uniform mat4 viewMatrix;",["uniform mat4 viewMatrices["+G+"];","#define viewMatrix viewMatrices[VIEW_ID]"].join(`
`)))}var ue=k+h,$=F+f,te=a0(l,35633,ue),oe=a0(l,35632,$);if(l.attachShader(z,te),l.attachShader(z,oe),i.index0AttributeName!==void 0?l.bindAttribLocation(z,0,i.index0AttributeName):i.morphTargets===!0&&l.bindAttribLocation(z,0,"position"),l.linkProgram(z),e.debug.checkShaderErrors){var ie=l.getProgramInfoLog(z).trim(),se=l.getShaderInfoLog(te).trim(),pe=l.getShaderInfoLog(oe).trim(),me=!0,he=!0;if(l.getProgramParameter(z,35714)===!1){me=!1;var Ue=l0(l,te,"vertex"),Ve=l0(l,oe,"fragment");console.error("THREE.WebGLProgram: shader error: ",l.getError(),"35715",l.getProgramParameter(z,35715),"gl.getProgramInfoLog",ie,Ue,Ve)}else ie!==""?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",ie):(se===""||pe==="")&&(he=!1);he&&(this.diagnostics={runnable:me,programLog:ie,vertexShader:{log:se,prefix:k},fragmentShader:{log:pe,prefix:F}})}l.deleteShader(te),l.deleteShader(oe);var $e;this.getUniforms=function(){return $e===void 0&&($e=new as(l,z)),$e};var ct;return this.getAttributes=function(){return ct===void 0&&(ct=US(l,z)),ct},this.destroy=function(){l.deleteProgram(z),this.program=void 0},this.name=i.shaderName,this.id=zS++,this.cacheKey=t,this.usedTimes=1,this.program=z,this.vertexShader=te,this.fragmentShader=oe,this.numMultiviewViews=G,this}function YS(e,t,i){var l=[],u=i.isWebGL2,h=i.logarithmicDepthBuffer,f=i.floatVertexTextures,r=i.precision,v=i.maxVertexUniforms,b=i.vertexTextures,E={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},M=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","numMultiviewViews","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function D(k,F){var G;if(F){var X=Ra[F];G={name:k.type,uniforms:vE.clone(X.uniforms),vertexShader:X.vertexShader,fragmentShader:X.fragmentShader}}else G={name:k.type,uniforms:k.uniforms,vertexShader:k.vertexShader,fragmentShader:k.fragmentShader};return G}function L(k){var F=k.skeleton,G=F.bones;if(f)return 1024;var X=v,re=Math.floor((X-20)/4),ue=Math.min(re,G.length);return ue<G.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+G.length+" bones. This GPU supports "+ue+"."),0):ue}function z(k){var F;return k?k.isTexture?F=k.encoding:k.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),F=k.texture.encoding):F=no,F}this.getParameters=function(k,F,G,X,re,ue,$){var te=X.fog,oe=k.isMeshStandardMaterial?X.environment:null,ie=k.envMap||oe,se=E[k.type],pe=$.isSkinnedMesh?L($):0;k.precision!==null&&(r=i.getMaxPrecision(k.precision),r!==k.precision&&console.warn("THREE.WebGLProgram.getParameters:",k.precision,"not supported, using",r,"instead."));var me=D(k,se);k.onBeforeCompile(me,e);var he=e.getRenderTarget(),Ue=he&&he.isWebGLMultiviewRenderTarget?he.numViews:0,Ve={isWebGL2:u,shaderID:se,shaderName:me.name,uniforms:me.uniforms,vertexShader:me.vertexShader,fragmentShader:me.fragmentShader,defines:k.defines,isRawShaderMaterial:k.isRawShaderMaterial,isShaderMaterial:k.isShaderMaterial,precision:r,instancing:$.isInstancedMesh===!0,supportsVertexTextures:b,numMultiviewViews:Ue,outputEncoding:he!==null?z(he.texture):e.outputEncoding,map:!!k.map,mapEncoding:z(k.map),matcap:!!k.matcap,matcapEncoding:z(k.matcap),envMap:!!ie,envMapMode:ie&&ie.mapping,envMapEncoding:z(ie),envMapCubeUV:!!ie&&(ie.mapping===uh||ie.mapping===Jg),lightMap:!!k.lightMap,lightMapEncoding:z(k.lightMap),aoMap:!!k.aoMap,emissiveMap:!!k.emissiveMap,emissiveMapEncoding:z(k.emissiveMap),bumpMap:!!k.bumpMap,normalMap:!!k.normalMap,objectSpaceNormalMap:k.normalMapType===nE,tangentSpaceNormalMap:k.normalMapType===Ys,clearcoatNormalMap:!!k.clearcoatNormalMap,displacementMap:!!k.displacementMap,roughnessMap:!!k.roughnessMap,metalnessMap:!!k.metalnessMap,specularMap:!!k.specularMap,alphaMap:!!k.alphaMap,gradientMap:!!k.gradientMap,sheen:!!k.sheen,combine:k.combine,vertexTangents:k.normalMap&&k.vertexTangents,vertexColors:k.vertexColors,vertexUvs:!!k.map||!!k.bumpMap||!!k.normalMap||!!k.specularMap||!!k.alphaMap||!!k.emissiveMap||!!k.roughnessMap||!!k.metalnessMap||!!k.clearcoatNormalMap||!!k.displacementMap,uvsVertexOnly:!(k.map||k.bumpMap||k.normalMap||k.specularMap||k.alphaMap||k.emissiveMap||k.roughnessMap||k.metalnessMap||k.clearcoatNormalMap)&&!!k.displacementMap,fog:!!te,useFog:k.fog,fogExp2:te&&te.isFogExp2,flatShading:k.flatShading,sizeAttenuation:k.sizeAttenuation,logarithmicDepthBuffer:h,skinning:k.skinning&&pe>0,maxBones:pe,useVertexTexture:f,morphTargets:k.morphTargets,morphNormals:k.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:F.directional.length,numPointLights:F.point.length,numSpotLights:F.spot.length,numRectAreaLights:F.rectArea.length,numHemiLights:F.hemi.length,numDirLightShadows:F.directionalShadowMap.length,numPointLightShadows:F.pointShadowMap.length,numSpotLightShadows:F.spotShadowMap.length,numClippingPlanes:re,numClipIntersection:ue,dithering:k.dithering,shadowMapEnabled:e.shadowMap.enabled&&G.length>0,shadowMapType:e.shadowMap.type,toneMapping:k.toneMapped?e.toneMapping:Wp,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:k.premultipliedAlpha,alphaTest:k.alphaTest,doubleSided:k.side===lh,flipSided:k.side===tr,depthPacking:k.depthPacking!==void 0?k.depthPacking:!1,index0AttributeName:k.index0AttributeName,extensionDerivatives:k.extensions&&k.extensions.derivatives,extensionFragDepth:k.extensions&&k.extensions.frawbuffers,extensionDrawbuffers:k.extensions&&k.extensions.drawbuffers,extensionShaderTextureLOD:k.extensions&&k.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||t.get("EXT_frag_depth")!==null,rendererExtensionDrawBuffers:u||t.get("WEBGL_draw_buffers")!==null,rendererExtensionShaderTextureLod:u||t.get("EXT_shader_texture_lod")!==null,onBeforeCompile:k.onBeforeCompile};return Ve},this.getProgramCacheKey=function(k){var F=[];if(k.shaderID?F.push(k.shaderID):(F.push(k.fragmentShader),F.push(k.vertexShader)),k.defines!==void 0)for(var G in k.defines)F.push(G),F.push(k.defines[G]);if(k.isRawShaderMaterial===void 0){for(var X=0;X<M.length;X++)F.push(k[M[X]]);F.push(e.outputEncoding),F.push(e.gammaFactor)}return F.push(k.onBeforeCompile.toString()),F.join()},this.acquireProgram=function(k,F){for(var G,X=0,re=l.length;X<re;X++){var ue=l[X];if(ue.cacheKey===F){G=ue,++G.usedTimes;break}}return G===void 0&&(G=new XS(e,F,k),l.push(G)),G},this.releaseProgram=function(k){if(--k.usedTimes===0){var F=l.indexOf(k);l[F]=l[l.length-1],l.pop(),k.destroy()}},this.programs=l}function JS(){var e=new WeakMap;function t(h){var f=e.get(h);return f===void 0&&(f={},e.set(h,f)),f}function i(h){e.delete(h)}function l(h,f,r){e.get(h)[f]=r}function u(){e=new WeakMap}return{get:t,remove:i,update:l,dispose:u}}function KS(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function QS(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function p0(){var e=[],t=0,i=[],l=[],u={id:-1};function h(){t=0,i.length=0,l.length=0}function f(E,M,D,L,z,k){var F=e[t];return F===void 0?(F={id:E.id,object:E,geometry:M,material:D,program:D.program||u,groupOrder:L,renderOrder:E.renderOrder,z,group:k},e[t]=F):(F.id=E.id,F.object=E,F.geometry=M,F.material=D,F.program=D.program||u,F.groupOrder=L,F.renderOrder=E.renderOrder,F.z=z,F.group=k),t++,F}function r(E,M,D,L,z,k){var F=f(E,M,D,L,z,k);(D.transparent===!0?l:i).push(F)}function v(E,M,D,L,z,k){var F=f(E,M,D,L,z,k);(D.transparent===!0?l:i).unshift(F)}function b(E,M){i.length>1&&i.sort(E||KS),l.length>1&&l.sort(M||QS)}return{opaque:i,transparent:l,init:h,push:r,unshift:v,sort:b}}function eD(){var e=new WeakMap;function t(u){var h=u.target;h.removeEventListener("dispose",t),e.delete(h)}function i(u,h){var f=e.get(u),r;return f===void 0?(r=new p0,e.set(u,new WeakMap),e.get(u).set(h,r),u.addEventListener("dispose",t)):(r=f.get(h),r===void 0&&(r=new p0,f.set(h,r))),r}function l(){e=new WeakMap}return{get:i,dispose:l}}function tD(){var e={};return{get:function(t){if(e[t.id]!==void 0)return e[t.id];var i;switch(t.type){case"DirectionalLight":i={direction:new Se,color:new tn,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Lt};break;case"SpotLight":i={position:new Se,direction:new Se,color:new tn,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Lt};break;case"PointLight":i={position:new Se,color:new tn,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Lt,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":i={direction:new Se,skyColor:new tn,groundColor:new tn};break;case"RectAreaLight":i={color:new tn,position:new Se,halfWidth:new Se,halfHeight:new Se};break}return e[t.id]=i,i}}}var nD=0;function iD(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function rD(){for(var e=new tD,t={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},i=0;i<9;i++)t.probe.push(new Se);var l=new Se,u=new jn,h=new jn;function f(r,v,b){for(var E=0,M=0,D=0,L=0;L<9;L++)t.probe[L].set(0,0,0);var z=0,k=0,F=0,G=0,X=0,re=0,ue=0,$=0,te=b.matrixWorldInverse;r.sort(iD);for(var L=0,oe=r.length;L<oe;L++){var ie=r[L],se=ie.color,pe=ie.intensity,me=ie.distance,he=ie.shadow&&ie.shadow.map?ie.shadow.map.texture:null;if(ie.isAmbientLight)E+=se.r*pe,M+=se.g*pe,D+=se.b*pe;else if(ie.isLightProbe)for(var Ue=0;Ue<9;Ue++)t.probe[Ue].addScaledVector(ie.sh.coefficients[Ue],pe);else if(ie.isDirectionalLight){var Ve=e.get(ie);if(Ve.color.copy(ie.color).multiplyScalar(ie.intensity),Ve.direction.setFromMatrixPosition(ie.matrixWorld),l.setFromMatrixPosition(ie.target.matrixWorld),Ve.direction.sub(l),Ve.direction.transformDirection(te),Ve.shadow=ie.castShadow,ie.castShadow){var $e=ie.shadow;Ve.shadowBias=$e.bias,Ve.shadowRadius=$e.radius,Ve.shadowMapSize=$e.mapSize,t.directionalShadowMap[z]=he,t.directionalShadowMatrix[z]=ie.shadow.matrix,re++}t.directional[z]=Ve,z++}else if(ie.isSpotLight){var Ve=e.get(ie);if(Ve.position.setFromMatrixPosition(ie.matrixWorld),Ve.position.applyMatrix4(te),Ve.color.copy(se).multiplyScalar(pe),Ve.distance=me,Ve.direction.setFromMatrixPosition(ie.matrixWorld),l.setFromMatrixPosition(ie.target.matrixWorld),Ve.direction.sub(l),Ve.direction.transformDirection(te),Ve.coneCos=Math.cos(ie.angle),Ve.penumbraCos=Math.cos(ie.angle*(1-ie.penumbra)),Ve.decay=ie.decay,Ve.shadow=ie.castShadow,ie.castShadow){var $e=ie.shadow;Ve.shadowBias=$e.bias,Ve.shadowRadius=$e.radius,Ve.shadowMapSize=$e.mapSize,t.spotShadowMap[F]=he,t.spotShadowMatrix[F]=ie.shadow.matrix,$++}t.spot[F]=Ve,F++}else if(ie.isRectAreaLight){var Ve=e.get(ie);Ve.color.copy(se).multiplyScalar(pe),Ve.position.setFromMatrixPosition(ie.matrixWorld),Ve.position.applyMatrix4(te),h.identity(),u.copy(ie.matrixWorld),u.premultiply(te),h.extractRotation(u),Ve.halfWidth.set(ie.width*.5,0,0),Ve.halfHeight.set(0,ie.height*.5,0),Ve.halfWidth.applyMatrix4(h),Ve.halfHeight.applyMatrix4(h),t.rectArea[G]=Ve,G++}else if(ie.isPointLight){var Ve=e.get(ie);if(Ve.position.setFromMatrixPosition(ie.matrixWorld),Ve.position.applyMatrix4(te),Ve.color.copy(ie.color).multiplyScalar(ie.intensity),Ve.distance=ie.distance,Ve.decay=ie.decay,Ve.shadow=ie.castShadow,ie.castShadow){var $e=ie.shadow;Ve.shadowBias=$e.bias,Ve.shadowRadius=$e.radius,Ve.shadowMapSize=$e.mapSize,Ve.shadowCameraNear=$e.camera.near,Ve.shadowCameraFar=$e.camera.far,t.pointShadowMap[k]=he,t.pointShadowMatrix[k]=ie.shadow.matrix,ue++}t.point[k]=Ve,k++}else if(ie.isHemisphereLight){var Ve=e.get(ie);Ve.direction.setFromMatrixPosition(ie.matrixWorld),Ve.direction.transformDirection(te),Ve.direction.normalize(),Ve.skyColor.copy(ie.color).multiplyScalar(pe),Ve.groundColor.copy(ie.groundColor).multiplyScalar(pe),t.hemi[X]=Ve,X++}}t.ambient[0]=E,t.ambient[1]=M,t.ambient[2]=D;var ct=t.hash;(ct.directionalLength!==z||ct.pointLength!==k||ct.spotLength!==F||ct.rectAreaLength!==G||ct.hemiLength!==X||ct.numDirectionalShadows!==re||ct.numPointShadows!==ue||ct.numSpotShadows!==$)&&(t.directional.length=z,t.spot.length=F,t.rectArea.length=G,t.point.length=k,t.hemi.length=X,t.directionalShadowMap.length=re,t.pointShadowMap.length=ue,t.spotShadowMap.length=$,t.directionalShadowMatrix.length=re,t.pointShadowMatrix.length=ue,t.spotShadowMatrix.length=$,ct.directionalLength=z,ct.pointLength=k,ct.spotLength=F,ct.rectAreaLength=G,ct.hemiLength=X,ct.numDirectionalShadows=re,ct.numPointShadows=ue,ct.numSpotShadows=$,t.version=nD++)}return{setup:f,state:t}}function f0(){var e=new rD,t=[],i=[];function l(){t.length=0,i.length=0}function u(v){t.push(v)}function h(v){i.push(v)}function f(v){e.setup(t,i,v)}var r={lightsArray:t,shadowsArray:i,lights:e};return{init:l,state:r,setupLights:f,pushLight:u,pushShadow:h}}function oD(){var e=new WeakMap;function t(u){var h=u.target;h.removeEventListener("dispose",t),e.delete(h)}function i(u,h){var f;return e.has(u)===!1?(f=new f0,e.set(u,new WeakMap),e.get(u).set(h,f),u.addEventListener("dispose",t)):e.get(u).has(h)===!1?(f=new f0,e.get(u).set(h,f)):f=e.get(u).get(h),f}function l(){e=new WeakMap}return{get:i,dispose:l}}function rl(e){Rn.call(this),this.type="MeshDepthMaterial",this.depthPacking=eE,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}rl.prototype=Object.create(Rn.prototype),rl.prototype.constructor=rl,rl.prototype.isMeshDepthMaterial=!0,rl.prototype.copy=function(e){return Rn.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this};function ol(e){Rn.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Se,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}ol.prototype=Object.create(Rn.prototype),ol.prototype.constructor=ol,ol.prototype.isMeshDistanceMaterial=!0,ol.prototype.copy=function(e){return Rn.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this};var aD=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
  float mean = 0.0;
  float squared_mean = 0.0;
	float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );
  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {
    #ifdef HORIZONAL_PASS
      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );
      mean += distribution.x;
      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
    #else
      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );
      mean += depth;
      squared_mean += depth * depth;
    #endif
  }
  mean = mean * HALF_SAMPLE_RATE;
  squared_mean = squared_mean * HALF_SAMPLE_RATE;
  float std_dev = sqrt( squared_mean - mean * mean );
  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`,sD=`void main() {
	gl_Position = vec4( position, 1.0 );
}`;function m0(e,t,i){var l=new Ch,u=new Lt,h=new Lt,f=new gi,r=[],v=[],b={},E={0:tr,1:tc,2:lh},M=new Nr({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Lt},radius:{value:4}},vertexShader:sD,fragmentShader:aD}),D=M.clone();D.defines.HORIZONAL_PASS=1;var L=new vn;L.setAttribute("position",new zn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var z=new Ai(L,M),k=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=ax,this.render=function($,te,oe){if(k.enabled!==!1&&!(k.autoUpdate===!1&&k.needsUpdate===!1)&&$.length!==0){var ie=e.getRenderTarget(),se=e.getActiveCubeFace(),pe=e.getActiveMipmapLevel(),me=e.state;me.setBlending(es),me.buffers.color.setClear(1,1,1,1),me.buffers.depth.setTest(!0),me.setScissorTest(!1);for(var he=0,Ue=$.length;he<Ue;he++){var Ve=$[he],$e=Ve.shadow;if($e===void 0){console.warn("THREE.WebGLShadowMap:",Ve,"has no shadow.");continue}u.copy($e.mapSize);var ct=$e.getFrameExtents();if(u.multiply(ct),h.copy($e.mapSize),(u.x>i||u.y>i)&&(console.warn("THREE.WebGLShadowMap:",Ve,"has shadow exceeding max texture size, reducing"),u.x>i&&(h.x=Math.floor(i/ct.x),u.x=h.x*ct.x,$e.mapSize.x=h.x),u.y>i&&(h.y=Math.floor(i/ct.y),u.y=h.y*ct.y,$e.mapSize.y=h.y)),$e.map===null&&!$e.isPointLightShadow&&this.type===sh){var At={minFilter:$i,magFilter:$i,format:Ao};$e.map=new Mr(u.x,u.y,At),$e.map.texture.name=Ve.name+".shadowMap",$e.mapPass=new Mr(u.x,u.y,At),$e.camera.updateProjectionMatrix()}if($e.map===null){var At={minFilter:Ui,magFilter:Ui,format:Ao};$e.map=new Mr(u.x,u.y,At),$e.map.texture.name=Ve.name+".shadowMap",$e.camera.updateProjectionMatrix()}e.setRenderTarget($e.map),e.clear();for(var yt=$e.getViewportCount(),St=0;St<yt;St++){var It=$e.getViewport(St);f.set(h.x*It.x,h.y*It.y,h.x*It.z,h.y*It.w),me.viewport(f),$e.updateMatrices(Ve,St),l=$e.getFrustum(),ue(te,oe,$e.camera,Ve,this.type)}!$e.isPointLightShadow&&this.type===sh&&F($e,oe)}k.needsUpdate=!1,e.setRenderTarget(ie,se,pe)}};function F($,te){var oe=t.update(z);M.uniforms.shadow_pass.value=$.map.texture,M.uniforms.resolution.value=$.mapSize,M.uniforms.radius.value=$.radius,e.setRenderTarget($.mapPass),e.clear(),e.renderBufferDirect(te,null,oe,M,z,null),D.uniforms.shadow_pass.value=$.mapPass.texture,D.uniforms.resolution.value=$.mapSize,D.uniforms.radius.value=$.radius,e.setRenderTarget($.map),e.clear(),e.renderBufferDirect(te,null,oe,D,z,null)}function G($,te,oe){var ie=$<<0|te<<1|oe<<2,se=r[ie];return se===void 0&&(se=new rl({depthPacking:tE,morphTargets:$,skinning:te}),r[ie]=se),se}function X($,te,oe){var ie=$<<0|te<<1|oe<<2,se=v[ie];return se===void 0&&(se=new ol({morphTargets:$,skinning:te}),v[ie]=se),se}function re($,te,oe,ie,se,pe){var me=$.geometry,he=null,Ue=G,Ve=$.customDepthMaterial;if(oe.isPointLight===!0&&(Ue=X,Ve=$.customDistanceMaterial),Ve===void 0){var $e=!1;te.morphTargets===!0&&(me.isBufferGeometry===!0?$e=me.morphAttributes&&me.morphAttributes.position&&me.morphAttributes.position.length>0:me.isGeometry===!0&&($e=me.morphTargets&&me.morphTargets.length>0));var ct=!1;$.isSkinnedMesh===!0&&(te.skinning===!0?ct=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",$));var At=$.isInstancedMesh===!0;he=Ue($e,ct,At)}else he=Ve;if(e.localClippingEnabled&&te.clipShadows===!0&&te.clippingPlanes.length!==0){var yt=he.uuid,St=te.uuid,It=b[yt];It===void 0&&(It={},b[yt]=It);var Nt=It[St];Nt===void 0&&(Nt=he.clone(),It[St]=Nt),he=Nt}return he.visible=te.visible,he.wireframe=te.wireframe,pe===sh?he.side=te.shadowSide!==null?te.shadowSide:te.side:he.side=te.shadowSide!==null?te.shadowSide:E[te.side],he.clipShadows=te.clipShadows,he.clippingPlanes=te.clippingPlanes,he.clipIntersection=te.clipIntersection,he.wireframeLinewidth=te.wireframeLinewidth,he.linewidth=te.linewidth,oe.isPointLight===!0&&he.isMeshDistanceMaterial===!0&&(he.referencePosition.setFromMatrixPosition(oe.matrixWorld),he.nearDistance=ie,he.farDistance=se),he}function ue($,te,oe,ie,se){if($.visible!==!1){var pe=$.layers.test(te.layers);if(pe&&($.isMesh||$.isLine||$.isPoints)&&($.castShadow||$.receiveShadow&&se===sh)&&(!$.frustumCulled||l.intersectsObject($))){$.modelViewMatrix.multiplyMatrices(oe.matrixWorldInverse,$.matrixWorld);var me=t.update($),he=$.material;if(Array.isArray(he))for(var Ue=me.groups,Ve=0,$e=Ue.length;Ve<$e;Ve++){var ct=Ue[Ve],At=he[ct.materialIndex];if(At&&At.visible){var yt=re($,At,ie,oe.near,oe.far,se);e.renderBufferDirect(oe,null,me,yt,$,ct)}}else if(he.visible){var yt=re($,he,ie,oe.near,oe.far,se);e.renderBufferDirect(oe,null,me,yt,$,null)}}for(var St=$.children,It=0,Nt=St.length;It<Nt;It++)ue(St[It],te,oe,ie,se)}}}function lD(e,t,i){var l=i.isWebGL2;function u(){var Ze=!1,Ut=new gi,en=null,Dn=new gi(0,0,0,0);return{setMask:function(fn){en!==fn&&!Ze&&(e.colorMask(fn,fn,fn,fn),en=fn)},setLocked:function(fn){Ze=fn},setClear:function(fn,On,Gn,qn,Wi){Wi===!0&&(fn*=qn,On*=qn,Gn*=qn),Ut.set(fn,On,Gn,qn),Dn.equals(Ut)===!1&&(e.clearColor(fn,On,Gn,qn),Dn.copy(Ut))},reset:function(){Ze=!1,en=null,Dn.set(-1,0,0,0)}}}function h(){var Ze=!1,Ut=null,en=null,Dn=null;return{setTest:function(fn){fn?fe(2929):Ee(2929)},setMask:function(fn){Ut!==fn&&!Ze&&(e.depthMask(fn),Ut=fn)},setFunc:function(fn){if(en!==fn){if(fn)switch(fn){case rT:e.depthFunc(512);break;case oT:e.depthFunc(519);break;case aT:e.depthFunc(513);break;case jg:e.depthFunc(515);break;case sT:e.depthFunc(514);break;case lT:e.depthFunc(518);break;case cT:e.depthFunc(516);break;case uT:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);en=fn}},setLocked:function(fn){Ze=fn},setClear:function(fn){Dn!==fn&&(e.clearDepth(fn),Dn=fn)},reset:function(){Ze=!1,Ut=null,en=null,Dn=null}}}function f(){var Ze=!1,Ut=null,en=null,Dn=null,fn=null,On=null,Gn=null,qn=null,Wi=null;return{setTest:function(Nn){Ze||(Nn?fe(2960):Ee(2960))},setMask:function(Nn){Ut!==Nn&&!Ze&&(e.stencilMask(Nn),Ut=Nn)},setFunc:function(Nn,Si,ei){(en!==Nn||Dn!==Si||fn!==ei)&&(e.stencilFunc(Nn,Si,ei),en=Nn,Dn=Si,fn=ei)},setOp:function(Nn,Si,ei){(On!==Nn||Gn!==Si||qn!==ei)&&(e.stencilOp(Nn,Si,ei),On=Nn,Gn=Si,qn=ei)},setLocked:function(Nn){Ze=Nn},setClear:function(Nn){Wi!==Nn&&(e.clearStencil(Nn),Wi=Nn)},reset:function(){Ze=!1,Ut=null,en=null,Dn=null,fn=null,On=null,Gn=null,qn=null,Wi=null}}}var r=new u,v=new h,b=new f,E=e.getParameter(34921),M=new Uint8Array(E),D=new Uint8Array(E),L=new Uint8Array(E),z={},k=null,F=null,G=null,X=null,re=null,ue=null,$=null,te=null,oe=null,ie=!1,se=null,pe=null,me=null,he=null,Ue=null,Ve=e.getParameter(35661),$e=!1,ct=0,At=e.getParameter(7938);At.indexOf("WebGL")!==-1?(ct=parseFloat(/^WebGL\ ([0-9])/.exec(At)[1]),$e=ct>=1):At.indexOf("OpenGL ES")!==-1&&(ct=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(At)[1]),$e=ct>=2);var yt=null,St={},It=new gi,Nt=new gi;function Ie(Ze,Ut,en){var Dn=new Uint8Array(4),fn=e.createTexture();e.bindTexture(Ze,fn),e.texParameteri(Ze,10241,9728),e.texParameteri(Ze,10240,9728);for(var On=0;On<en;On++)e.texImage2D(Ut+On,0,6408,1,1,0,6408,5121,Dn);return fn}var xe={};xe[3553]=Ie(3553,3553,1),xe[34067]=Ie(34067,34069,6),r.setClear(0,0,0,1),v.setClear(1),b.setClear(0),fe(2929),v.setFunc(jg),Gt(!1),de(ox),fe(2884),st(es);function He(){for(var Ze=0,Ut=M.length;Ze<Ut;Ze++)M[Ze]=0}function Ge(Ze){ze(Ze,0)}function ze(Ze,Ut){if(M[Ze]=1,D[Ze]===0&&(e.enableVertexAttribArray(Ze),D[Ze]=1),L[Ze]!==Ut){var en=l?e:t.get("ANGLE_instanced_arrays");en[l?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](Ze,Ut),L[Ze]=Ut}}function rt(){for(var Ze=0,Ut=D.length;Ze!==Ut;++Ze)D[Ze]!==M[Ze]&&(e.disableVertexAttribArray(Ze),D[Ze]=0)}function fe(Ze){z[Ze]!==!0&&(e.enable(Ze),z[Ze]=!0)}function Ee(Ze){z[Ze]!==!1&&(e.disable(Ze),z[Ze]=!1)}function Ce(Ze){return k!==Ze?(e.useProgram(Ze),k=Ze,!0):!1}var ye={[ic]:32774,[q2]:32778,[Z2]:32779};if(l)ye[dx]=32775,ye[px]=32776;else{var Oe=t.get("EXT_blend_minmax");Oe!==null&&(ye[dx]=Oe.MIN_EXT,ye[px]=Oe.MAX_EXT)}var Ke={[X2]:0,[Y2]:1,[J2]:768,[fx]:770,[iT]:776,[tT]:774,[Q2]:772,[K2]:769,[mx]:771,[nT]:775,[eT]:773};function st(Ze,Ut,en,Dn,fn,On,Gn,qn){if(Ze===es){F&&(Ee(3042),F=!1);return}if(F||(fe(3042),F=!0),Ze!==$2){if(Ze!==G||qn!==ie){if((X!==ic||$!==ic)&&(e.blendEquation(32774),X=ic,$=ic),qn)switch(Ze){case ch:e.blendFuncSeparate(1,771,1,771);break;case cx:e.blendFunc(1,1);break;case ux:e.blendFuncSeparate(0,0,769,771);break;case hx:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",Ze);break}else switch(Ze){case ch:e.blendFuncSeparate(770,771,1,771);break;case cx:e.blendFunc(770,1);break;case ux:e.blendFunc(0,769);break;case hx:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",Ze);break}re=null,ue=null,te=null,oe=null,G=Ze,ie=qn}return}fn=fn||Ut,On=On||en,Gn=Gn||Dn,(Ut!==X||fn!==$)&&(e.blendEquationSeparate(ye[Ut],ye[fn]),X=Ut,$=fn),(en!==re||Dn!==ue||On!==te||Gn!==oe)&&(e.blendFuncSeparate(Ke[en],Ke[Dn],Ke[On],Ke[Gn]),re=en,ue=Dn,te=On,oe=Gn),G=Ze,ie=null}function wt(Ze,Ut){Ze.side===lh?Ee(2884):fe(2884);var en=Ze.side===tr;Ut&&(en=!en),Gt(en),Ze.blending===ch&&Ze.transparent===!1?st(es):st(Ze.blending,Ze.blendEquation,Ze.blendSrc,Ze.blendDst,Ze.blendEquationAlpha,Ze.blendSrcAlpha,Ze.blendDstAlpha,Ze.premultipliedAlpha),v.setFunc(Ze.depthFunc),v.setTest(Ze.depthTest),v.setMask(Ze.depthWrite),r.setMask(Ze.colorWrite);var Dn=Ze.stencilWrite;b.setTest(Dn),Dn&&(b.setMask(Ze.stencilWriteMask),b.setFunc(Ze.stencilFunc,Ze.stencilRef,Ze.stencilFuncMask),b.setOp(Ze.stencilFail,Ze.stencilZFail,Ze.stencilZPass)),bt(Ze.polygonOffset,Ze.polygonOffsetFactor,Ze.polygonOffsetUnits)}function Gt(Ze){se!==Ze&&(Ze?e.frontFace(2304):e.frontFace(2305),se=Ze)}function de(Ze){Ze!==G2?(fe(2884),Ze!==pe&&(Ze===ox?e.cullFace(1029):Ze===H2?e.cullFace(1028):e.cullFace(1032))):Ee(2884),pe=Ze}function we(Ze){Ze!==me&&($e&&e.lineWidth(Ze),me=Ze)}function bt(Ze,Ut,en){Ze?(fe(32823),(he!==Ut||Ue!==en)&&(e.polygonOffset(Ut,en),he=Ut,Ue=en)):Ee(32823)}function gt(Ze){Ze?fe(3089):Ee(3089)}function bn(Ze){Ze===void 0&&(Ze=33984+Ve-1),yt!==Ze&&(e.activeTexture(Ze),yt=Ze)}function hn(Ze,Ut){yt===null&&bn();var en=St[yt];en===void 0&&(en={type:void 0,texture:void 0},St[yt]=en),(en.type!==Ze||en.texture!==Ut)&&(e.bindTexture(Ze,Ut||xe[Ze]),en.type=Ze,en.texture=Ut)}function nn(){var Ze=St[yt];Ze!==void 0&&Ze.type!==void 0&&(e.bindTexture(Ze.type,null),Ze.type=void 0,Ze.texture=void 0)}function pn(){try{e.compressedTexImage2D.apply(e,arguments)}catch(Ze){console.error("THREE.WebGLState:",Ze)}}function wn(){try{e.texImage2D.apply(e,arguments)}catch(Ze){console.error("THREE.WebGLState:",Ze)}}function cn(){try{e.texImage3D.apply(e,arguments)}catch(Ze){console.error("THREE.WebGLState:",Ze)}}function Ht(Ze){It.equals(Ze)===!1&&(e.scissor(Ze.x,Ze.y,Ze.z,Ze.w),It.copy(Ze))}function sn(Ze){Nt.equals(Ze)===!1&&(e.viewport(Ze.x,Ze.y,Ze.z,Ze.w),Nt.copy(Ze))}function Zt(){for(var Ze=0;Ze<D.length;Ze++)D[Ze]===1&&(e.disableVertexAttribArray(Ze),D[Ze]=0);z={},yt=null,St={},k=null,G=null,se=null,pe=null,r.reset(),v.reset(),b.reset()}return{buffers:{color:r,depth:v,stencil:b},initAttributes:He,enableAttribute:Ge,enableAttributeAndDivisor:ze,disableUnusedAttributes:rt,enable:fe,disable:Ee,useProgram:Ce,setBlending:st,setMaterial:wt,setFlipSided:Gt,setCullFace:de,setLineWidth:we,setPolygonOffset:bt,setScissorTest:gt,activeTexture:bn,bindTexture:hn,unbindTexture:nn,compressedTexImage2D:pn,texImage2D:wn,texImage3D:cn,scissor:Ht,viewport:sn,reset:Zt}}function cD(e,t,i,l,u,h,f){var r=u.isWebGL2,v=u.maxTextures,b=u.maxCubemapSize,E=u.maxTextureSize,M=u.maxSamples,D=new WeakMap,L,z=!1;try{z=typeof OffscreenCanvas!="undefined"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch(de){}function k(de,we){return z?new OffscreenCanvas(de,we):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function F(de,we,bt,gt){var bn=1;if((de.width>gt||de.height>gt)&&(bn=gt/Math.max(de.width,de.height)),bn<1||we===!0)if(typeof HTMLImageElement!="undefined"&&de instanceof HTMLImageElement||typeof HTMLCanvasElement!="undefined"&&de instanceof HTMLCanvasElement||typeof ImageBitmap!="undefined"&&de instanceof ImageBitmap){var hn=we?Wn.floorPowerOfTwo:Math.floor,nn=hn(bn*de.width),pn=hn(bn*de.height);L===void 0&&(L=k(nn,pn));var wn=bt?k(nn,pn):L;wn.width=nn,wn.height=pn;var cn=wn.getContext("2d");return cn.drawImage(de,0,0,nn,pn),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+de.width+"x"+de.height+") to ("+nn+"x"+pn+")."),wn}else return"data"in de&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+de.width+"x"+de.height+")."),de;return de}function G(de){return Wn.isPowerOfTwo(de.width)&&Wn.isPowerOfTwo(de.height)}function X(de){return r?!1:de.wrapS!==wr||de.wrapT!==wr||de.minFilter!==Ui&&de.minFilter!==$i}function re(de,we){return de.generateMipmaps&&we&&de.minFilter!==Ui&&de.minFilter!==$i}function ue(de,we,bt,gt){e.generateMipmap(de);var bn=l.get(we);bn.__maxMipLevel=Math.log(Math.max(bt,gt))*Math.LOG2E}function $(de,we,bt){if(r===!1)return we;if(de!==null){if(e[de]!==void 0)return e[de];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+de+"'")}var gt=we;return we===6403&&(bt===5126&&(gt=33326),bt===5131&&(gt=33325),bt===5121&&(gt=33321)),we===6407&&(bt===5126&&(gt=34837),bt===5131&&(gt=34843),bt===5121&&(gt=32849)),we===6408&&(bt===5126&&(gt=34836),bt===5131&&(gt=34842),bt===5121&&(gt=32856)),gt===33325||gt===33326||gt===34842||gt===34836?t.get("EXT_color_buffer_float"):(gt===34843||gt===34837)&&console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),gt}function te(de){return de===Ui||de===jp||de===$p?9728:9729}function oe(de){var we=de.target;we.removeEventListener("dispose",oe),se(we),we.isVideoTexture&&D.delete(we),f.memory.textures--}function ie(de){var we=de.target;we.removeEventListener("dispose",ie),pe(we),f.memory.textures--}function se(de){var we=l.get(de);we.__webglInit!==void 0&&(e.deleteTexture(we.__webglTexture),l.remove(de))}function pe(de){var we=l.get(de),bt=l.get(de.texture);if(de){if(bt.__webglTexture!==void 0&&e.deleteTexture(bt.__webglTexture),de.depthTexture&&de.depthTexture.dispose(),de.isWebGLCubeRenderTarget)for(var gt=0;gt<6;gt++)e.deleteFramebuffer(we.__webglFramebuffer[gt]),we.__webglDepthbuffer&&e.deleteRenderbuffer(we.__webglDepthbuffer[gt]);else e.deleteFramebuffer(we.__webglFramebuffer),we.__webglDepthbuffer&&e.deleteRenderbuffer(we.__webglDepthbuffer);if(de.isWebGLMultiviewRenderTarget){e.deleteTexture(we.__webglColorTexture),e.deleteTexture(we.__webglDepthStencilTexture),f.memory.textures-=2;for(var gt=0,bn=we.__webglViewFramebuffers.length;gt<bn;gt++)e.deleteFramebuffer(we.__webglViewFramebuffers[gt])}l.remove(de.texture),l.remove(de)}}var me=0;function he(){me=0}function Ue(){var de=me;return de>=v&&console.warn("THREE.WebGLTextures: Trying to use "+de+" texture units while this GPU supports only "+v),me+=1,de}function Ve(de,we){var bt=l.get(de);if(de.isVideoTexture&&Oe(de),de.version>0&&bt.__version!==de.version){var gt=de.image;if(gt===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else if(gt.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{xe(bt,de,we);return}}i.activeTexture(33984+we),i.bindTexture(3553,bt.__webglTexture)}function $e(de,we){var bt=l.get(de);if(de.version>0&&bt.__version!==de.version){xe(bt,de,we);return}i.activeTexture(33984+we),i.bindTexture(35866,bt.__webglTexture)}function ct(de,we){var bt=l.get(de);if(de.version>0&&bt.__version!==de.version){xe(bt,de,we);return}i.activeTexture(33984+we),i.bindTexture(32879,bt.__webglTexture)}function At(de,we){if(de.image.length===6){var bt=l.get(de);if(de.version>0&&bt.__version!==de.version){Ie(bt,de),i.activeTexture(33984+we),i.bindTexture(34067,bt.__webglTexture),e.pixelStorei(37440,de.flipY);for(var gt=de&&(de.isCompressedTexture||de.image[0].isCompressedTexture),bn=de.image[0]&&de.image[0].isDataTexture,hn=[],nn=0;nn<6;nn++)!gt&&!bn?hn[nn]=F(de.image[nn],!1,!0,b):hn[nn]=bn?de.image[nn].image:de.image[nn];var pn=hn[0],wn=G(pn)||r,cn=h.convert(de.format),Ht=h.convert(de.type),sn=$(de.internalFormat,cn,Ht);Nt(34067,de,wn);var Zt;if(gt){for(var nn=0;nn<6;nn++){Zt=hn[nn].mipmaps;for(var Ze=0;Ze<Zt.length;Ze++){var Ut=Zt[Ze];de.format!==Ao&&de.format!==Ma?cn!==null?i.compressedTexImage2D(34069+nn,Ze,sn,Ut.width,Ut.height,0,Ut.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(34069+nn,Ze,sn,Ut.width,Ut.height,0,cn,Ht,Ut.data)}}bt.__maxMipLevel=Zt.length-1}else{Zt=de.mipmaps;for(var nn=0;nn<6;nn++)if(bn){i.texImage2D(34069+nn,0,sn,hn[nn].width,hn[nn].height,0,cn,Ht,hn[nn].data);for(var Ze=0;Ze<Zt.length;Ze++){var Ut=Zt[Ze],en=Ut.image[nn].image;i.texImage2D(34069+nn,Ze+1,sn,en.width,en.height,0,cn,Ht,en.data)}}else{i.texImage2D(34069+nn,0,sn,cn,Ht,hn[nn]);for(var Ze=0;Ze<Zt.length;Ze++){var Ut=Zt[Ze];i.texImage2D(34069+nn,Ze+1,sn,cn,Ht,Ut.image[nn])}}bt.__maxMipLevel=Zt.length}re(de,wn)&&ue(34067,de,pn.width,pn.height),bt.__version=de.version,de.onUpdate&&de.onUpdate(de)}else i.activeTexture(33984+we),i.bindTexture(34067,bt.__webglTexture)}}function yt(de,we){i.activeTexture(33984+we),i.bindTexture(34067,l.get(de).__webglTexture)}var St={[Xs]:10497,[wr]:33071,[hh]:33648},It={[Ui]:9728,[jp]:9984,[$p]:9986,[$i]:9729,[Kg]:9985,[rc]:9987};function Nt(de,we,bt){bt?(e.texParameteri(de,10242,St[we.wrapS]),e.texParameteri(de,10243,St[we.wrapT]),(de===32879||de===35866)&&e.texParameteri(de,32882,St[we.wrapR]),e.texParameteri(de,10240,It[we.magFilter]),e.texParameteri(de,10241,It[we.minFilter])):(e.texParameteri(de,10242,33071),e.texParameteri(de,10243,33071),(de===32879||de===35866)&&e.texParameteri(de,32882,33071),(we.wrapS!==wr||we.wrapT!==wr)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(de,10240,te(we.magFilter)),e.texParameteri(de,10241,te(we.minFilter)),we.minFilter!==Ui&&we.minFilter!==$i&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));var gt=t.get("EXT_texture_filter_anisotropic");if(gt){if(we.type===dh&&t.get("OES_texture_float_linear")===null||we.type===Qg&&(r||t.get("OES_texture_half_float_linear"))===null)return;(we.anisotropy>1||l.get(we).__currentAnisotropy)&&(e.texParameterf(de,gt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(we.anisotropy,u.getMaxAnisotropy())),l.get(we).__currentAnisotropy=we.anisotropy)}}function Ie(de,we){de.__webglInit===void 0&&(de.__webglInit=!0,we.addEventListener("dispose",oe),de.__webglTexture=e.createTexture(),f.memory.textures++)}function xe(de,we,bt){var gt=3553;we.isDataTexture2DArray&&(gt=35866),we.isDataTexture3D&&(gt=32879),Ie(de,we),i.activeTexture(33984+bt),i.bindTexture(gt,de.__webglTexture),e.pixelStorei(37440,we.flipY),e.pixelStorei(37441,we.premultiplyAlpha),e.pixelStorei(3317,we.unpackAlignment);var bn=X(we)&&G(we.image)===!1,hn=F(we.image,bn,!1,E),nn=G(hn)||r,pn=h.convert(we.format),wn=h.convert(we.type),cn=$(we.internalFormat,pn,wn);Nt(gt,we,nn);var Ht,sn=we.mipmaps;if(we.isDepthTexture){if(cn=6402,we.type===dh){if(r===!1)throw new Error("Float Depth Texture only supported in WebGL2.0");cn=36012}else r&&(cn=33189);we.format===oc&&cn===6402&&we.type!==Zp&&we.type!==_x&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),we.type=Zp,wn=h.convert(we.type)),we.format===ph&&(cn=34041,we.type!==Xp&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),we.type=Xp,wn=h.convert(we.type))),i.texImage2D(3553,0,cn,hn.width,hn.height,0,pn,wn,null)}else if(we.isDataTexture)if(sn.length>0&&nn){for(var Zt=0,Ze=sn.length;Zt<Ze;Zt++)Ht=sn[Zt],i.texImage2D(3553,Zt,cn,Ht.width,Ht.height,0,pn,wn,Ht.data);we.generateMipmaps=!1,de.__maxMipLevel=sn.length-1}else i.texImage2D(3553,0,cn,hn.width,hn.height,0,pn,wn,hn.data),de.__maxMipLevel=0;else if(we.isCompressedTexture){for(var Zt=0,Ze=sn.length;Zt<Ze;Zt++)Ht=sn[Zt],we.format!==Ao&&we.format!==Ma?pn!==null?i.compressedTexImage2D(3553,Zt,cn,Ht.width,Ht.height,0,Ht.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(3553,Zt,cn,Ht.width,Ht.height,0,pn,wn,Ht.data);de.__maxMipLevel=sn.length-1}else if(we.isDataTexture2DArray)i.texImage3D(35866,0,cn,hn.width,hn.height,hn.depth,0,pn,wn,hn.data),de.__maxMipLevel=0;else if(we.isDataTexture3D)i.texImage3D(32879,0,cn,hn.width,hn.height,hn.depth,0,pn,wn,hn.data),de.__maxMipLevel=0;else if(sn.length>0&&nn){for(var Zt=0,Ze=sn.length;Zt<Ze;Zt++)Ht=sn[Zt],i.texImage2D(3553,Zt,cn,pn,wn,Ht);we.generateMipmaps=!1,de.__maxMipLevel=sn.length-1}else i.texImage2D(3553,0,cn,pn,wn,hn),de.__maxMipLevel=0;re(we,nn)&&ue(gt,we,hn.width,hn.height),de.__version=we.version,we.onUpdate&&we.onUpdate(we)}function He(de,we,bt,gt){var bn=h.convert(we.texture.format),hn=h.convert(we.texture.type),nn=$(we.texture.internalFormat,bn,hn);i.texImage2D(gt,0,nn,we.width,we.height,0,bn,hn,null),e.bindFramebuffer(36160,de),e.framebufferTexture2D(36160,bt,gt,l.get(we.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function Ge(de,we,bt){if(e.bindRenderbuffer(36161,de),we.depthBuffer&&!we.stencilBuffer){if(bt){var gt=ye(we);e.renderbufferStorageMultisample(36161,gt,33189,we.width,we.height)}else e.renderbufferStorage(36161,33189,we.width,we.height);e.framebufferRenderbuffer(36160,36096,36161,de)}else if(we.depthBuffer&&we.stencilBuffer){if(bt){var gt=ye(we);e.renderbufferStorageMultisample(36161,gt,35056,we.width,we.height)}else e.renderbufferStorage(36161,34041,we.width,we.height);e.framebufferRenderbuffer(36160,33306,36161,de)}else{var bn=h.convert(we.texture.format),hn=h.convert(we.texture.type),nn=$(we.texture.internalFormat,bn,hn);if(bt){var gt=ye(we);e.renderbufferStorageMultisample(36161,gt,nn,we.width,we.height)}else e.renderbufferStorage(36161,nn,we.width,we.height)}e.bindRenderbuffer(36161,null)}function ze(de,we){var bt=we&&we.isWebGLCubeRenderTarget;if(bt)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,de),!(we.depthTexture&&we.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!l.get(we.depthTexture).__webglTexture||we.depthTexture.image.width!==we.width||we.depthTexture.image.height!==we.height)&&(we.depthTexture.image.width=we.width,we.depthTexture.image.height=we.height,we.depthTexture.needsUpdate=!0),Ve(we.depthTexture,0);var gt=l.get(we.depthTexture).__webglTexture;if(we.depthTexture.format===oc)e.framebufferTexture2D(36160,36096,3553,gt,0);else if(we.depthTexture.format===ph)e.framebufferTexture2D(36160,33306,3553,gt,0);else throw new Error("Unknown depthTexture format")}function rt(de){var we=l.get(de),bt=de.isWebGLCubeRenderTarget===!0;if(de.depthTexture){if(bt)throw new Error("target.depthTexture not supported in Cube render targets");ze(we.__webglFramebuffer,de)}else if(bt){we.__webglDepthbuffer=[];for(var gt=0;gt<6;gt++)e.bindFramebuffer(36160,we.__webglFramebuffer[gt]),we.__webglDepthbuffer[gt]=e.createRenderbuffer(),Ge(we.__webglDepthbuffer[gt],de)}else e.bindFramebuffer(36160,we.__webglFramebuffer),we.__webglDepthbuffer=e.createRenderbuffer(),Ge(we.__webglDepthbuffer,de);e.bindFramebuffer(36160,null)}function fe(de){var we=l.get(de),bt=l.get(de.texture);de.addEventListener("dispose",ie),bt.__webglTexture=e.createTexture(),f.memory.textures++;var gt=de.isWebGLCubeRenderTarget===!0,bn=de.isWebGLMultisampleRenderTarget===!0,hn=de.isWebGLMultiviewRenderTarget===!0,nn=G(de)||r;if(gt){we.__webglFramebuffer=[];for(var pn=0;pn<6;pn++)we.__webglFramebuffer[pn]=e.createFramebuffer()}else if(we.__webglFramebuffer=e.createFramebuffer(),bn)if(r){we.__webglMultisampledFramebuffer=e.createFramebuffer(),we.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,we.__webglColorRenderbuffer);var wn=h.convert(de.texture.format),cn=h.convert(de.texture.type),Ht=$(de.texture.internalFormat,wn,cn),sn=ye(de);e.renderbufferStorageMultisample(36161,sn,Ht,de.width,de.height),e.bindFramebuffer(36160,we.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,we.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),de.depthBuffer&&(we.__webglDepthRenderbuffer=e.createRenderbuffer(),Ge(we.__webglDepthRenderbuffer,de,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");else if(hn){var Zt=de.width,Ze=de.height,Ut=de.numViews;e.bindFramebuffer(36160,we.__webglFramebuffer);var en=t.get("OVR_multiview2");f.memory.textures+=2;var Dn=e.createTexture();e.bindTexture(35866,Dn),e.texParameteri(35866,10240,9728),e.texParameteri(35866,10241,9728),e.texImage3D(35866,0,32856,Zt,Ze,Ut,0,6408,5121,null),en.framebufferTextureMultiviewOVR(36160,36064,Dn,0,0,Ut);var fn=e.createTexture();e.bindTexture(35866,fn),e.texParameteri(35866,10240,9728),e.texParameteri(35866,10241,9728),e.texImage3D(35866,0,35056,Zt,Ze,Ut,0,34041,34042,null),en.framebufferTextureMultiviewOVR(36160,33306,fn,0,0,Ut);for(var On=new Array(Ut),pn=0;pn<Ut;++pn)On[pn]=e.createFramebuffer(),e.bindFramebuffer(36160,On[pn]),e.framebufferTextureLayer(36160,36064,Dn,0,pn);we.__webglColorTexture=Dn,we.__webglDepthStencilTexture=fn,we.__webglViewFramebuffers=On,e.bindFramebuffer(36160,null),e.bindTexture(35866,null)}if(gt){i.bindTexture(34067,bt.__webglTexture),Nt(34067,de.texture,nn);for(var pn=0;pn<6;pn++)He(we.__webglFramebuffer[pn],de,36064,34069+pn);re(de.texture,nn)&&ue(34067,de.texture,de.width,de.height),i.bindTexture(34067,null)}else hn||(i.bindTexture(3553,bt.__webglTexture),Nt(3553,de.texture,nn),He(we.__webglFramebuffer,de,36064,3553),re(de.texture,nn)&&ue(3553,de.texture,de.width,de.height),i.bindTexture(3553,null));de.depthBuffer&&rt(de)}function Ee(de){var we=de.texture,bt=G(de)||r;if(re(we,bt)){var gt=de.isWebGLCubeRenderTarget?34067:3553,bn=l.get(we).__webglTexture;i.bindTexture(gt,bn),ue(gt,we,de.width,de.height),i.bindTexture(gt,null)}}function Ce(de){if(de.isWebGLMultisampleRenderTarget)if(r){var we=l.get(de);e.bindFramebuffer(36008,we.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,we.__webglFramebuffer);var bt=de.width,gt=de.height,bn=16384;de.depthBuffer&&(bn|=256),de.stencilBuffer&&(bn|=1024),e.blitFramebuffer(0,0,bt,gt,0,0,bt,gt,bn,9728)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")}function ye(de){return r&&de.isWebGLMultisampleRenderTarget?Math.min(M,de.samples):0}function Oe(de){var we=f.render.frame;D.get(de)!==we&&(D.set(de,we),de.update())}var Ke=!1,st=!1;function wt(de,we){de&&de.isWebGLRenderTarget&&(Ke===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),Ke=!0),de=de.texture),Ve(de,we)}function Gt(de,we){de&&de.isWebGLCubeRenderTarget&&(st===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),st=!0),de=de.texture),de&&de.isCubeTexture||Array.isArray(de.image)&&de.image.length===6?At(de,we):yt(de,we)}this.allocateTextureUnit=Ue,this.resetTextureUnits=he,this.setTexture2D=Ve,this.setTexture2DArray=$e,this.setTexture3D=ct,this.setTextureCube=At,this.setTextureCubeDynamic=yt,this.setupRenderTarget=fe,this.updateRenderTargetMipmap=Ee,this.updateMultisampleRenderTarget=Ce,this.safeSetTexture2D=wt,this.safeSetTextureCube=Gt}function uD(e,t,i){var l=i.isWebGL2;function u(h){var f;if(h===qp)return 5121;if(h===xT)return 32819;if(h===bT)return 32820;if(h===wT)return 33635;if(h===yT)return 5120;if(h===_T)return 5122;if(h===Zp)return 5123;if(h===vT)return 5124;if(h===_x)return 5125;if(h===dh)return 5126;if(h===Qg)return l?5131:(f=t.get("OES_texture_half_float"),f!==null?f.HALF_FLOAT_OES:null);if(h===MT)return 6406;if(h===Ma)return 6407;if(h===Ao)return 6408;if(h===TT)return 6409;if(h===ET)return 6410;if(h===oc)return 6402;if(h===ph)return 34041;if(h===AT)return 6403;if(h===ST)return 36244;if(h===DT)return 33319;if(h===PT)return 33320;if(h===LT)return 36248;if(h===IT)return 36249;if(h===vx||h===xx||h===bx||h===wx)if(f=t.get("WEBGL_compressed_texture_s3tc"),f!==null){if(h===vx)return f.COMPRESSED_RGB_S3TC_DXT1_EXT;if(h===xx)return f.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(h===bx)return f.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(h===wx)return f.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(h===Tx||h===Ex||h===Cx||h===Ax)if(f=t.get("WEBGL_compressed_texture_pvrtc"),f!==null){if(h===Tx)return f.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(h===Ex)return f.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(h===Cx)return f.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(h===Ax)return f.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(h===RT)return f=t.get("WEBGL_compressed_texture_etc1"),f!==null?f.COMPRESSED_RGB_ETC1_WEBGL:null;if(h===zT||h===kT||h===BT||h===FT||h===OT||h===NT||h===UT||h===VT||h===GT||h===HT||h===WT||h===jT||h===$T||h===qT)return f=t.get("WEBGL_compressed_texture_astc"),f!==null?h:null;if(h===Xp)return l?34042:(f=t.get("WEBGL_depth_texture"),f!==null?f.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:u}}function Py(e,t,i,l){Mr.call(this,e,t,l),this.depthBuffer=!1,this.stencilBuffer=!1,this.numViews=i}Py.prototype=Object.assign(Object.create(Mr.prototype),{constructor:Py,isWebGLMultiviewRenderTarget:!0,copy:function(e){return Mr.prototype.copy.call(this,e),this.numViews=e.numViews,this},setNumViews:function(e){return this.numViews!==e&&(this.numViews=e,this.dispose()),this}});function hD(e,t){var i=2,l=e.extensions,u=e.properties,h,f,r,v,b,E,M,D=0;function L(){if(M===void 0){var oe=l.get("OVR_multiview2");if(M=oe!==null&&t.getContextAttributes().antialias===!1,M){D=t.getParameter(oe.MAX_VIEWS_OVR),h=new Py(0,0,i),E=new Lt,v=[],r=[],b=[];for(var ie=0;ie<D;ie++)v[ie]=new jn,r[ie]=new dr}}return M}function z(oe){return oe.isArrayCamera?oe.cameras:(b[0]=oe,b)}function k(oe,ie){for(var se=z(oe),pe=0;pe<se.length;pe++)v[pe].copy(se[pe].projectionMatrix);ie.setValue(t,"projectionMatrices",v)}function F(oe,ie){for(var se=z(oe),pe=0;pe<se.length;pe++)v[pe].copy(se[pe].matrixWorldInverse);ie.setValue(t,"viewMatrices",v)}function G(oe,ie,se){for(var pe=z(ie),me=0;me<pe.length;me++)v[me].multiplyMatrices(pe[me].matrixWorldInverse,oe.matrixWorld),r[me].getNormalMatrix(v[me]);se.setValue(t,"modelViewMatrices",v),se.setValue(t,"normalMatrices",r)}function X(oe){if(oe.isArrayCamera===void 0)return!0;var ie=oe.cameras;if(ie.length>D)return!1;for(var se=1,pe=ie.length;se<pe;se++)if(ie[0].viewport.z!==ie[se].viewport.z||ie[0].viewport.w!==ie[se].viewport.w)return!1;return!0}function re(oe){if(f?E.set(f.width,f.height):e.getDrawingBufferSize(E),oe.isArrayCamera){var ie=oe.cameras[0].viewport;h.setSize(ie.z,ie.w),h.setNumViews(oe.cameras.length)}else h.setSize(E.x,E.y),h.setNumViews(i)}function ue(oe){X(oe)!==!1&&(f=e.getRenderTarget(),re(oe),e.setRenderTarget(h))}function $(oe){h===e.getRenderTarget()&&(e.setRenderTarget(f),te(oe))}function te(oe){var ie=h,se=ie.numViews,pe=u.get(ie).__webglViewFramebuffers,me=ie.width,he=ie.height;if(oe.isArrayCamera)for(var Ue=0;Ue<se;Ue++){var Ve=oe.cameras[Ue].viewport,$e=Ve.x,ct=Ve.y,At=$e+Ve.z,yt=ct+Ve.w;t.bindFramebuffer(36008,pe[Ue]),t.blitFramebuffer(0,0,me,he,$e,ct,At,yt,16384,9728)}else t.bindFramebuffer(36008,pe[0]),t.blitFramebuffer(0,0,me,he,0,0,E.x,E.y,16384,9728)}this.isAvailable=L,this.attachCamera=ue,this.detachCamera=$,this.updateCameraProjectionMatricesUniform=k,this.updateCameraViewMatricesUniform=F,this.updateObjectMatricesUniforms=G}function Ly(e){Zi.call(this),this.cameras=e||[]}Ly.prototype=Object.assign(Object.create(Zi.prototype),{constructor:Ly,isArrayCamera:!0});function al(){on.call(this),this.type="Group"}al.prototype=Object.assign(Object.create(on.prototype),{constructor:al,isGroup:!0});function g0(e,t){var i=this,l=null,u=null,h="local-floor",f=null,r=[],v=new Map,b=new Zi;b.layers.enable(1),b.viewport=new gi;var E=new Zi;E.layers.enable(2),E.viewport=new gi;var M=new Ly([b,E]);M.layers.enable(1),M.layers.enable(2);var D=null,L=null;this.enabled=!1,this.isPresenting=!1,this.getController=function(se){var pe=r[se];return pe===void 0&&(pe={},r[se]=pe),pe.targetRay===void 0&&(pe.targetRay=new al,pe.targetRay.matrixAutoUpdate=!1,pe.targetRay.visible=!1),pe.targetRay},this.getControllerGrip=function(se){var pe=r[se];return pe===void 0&&(pe={},r[se]=pe),pe.grip===void 0&&(pe.grip=new al,pe.grip.matrixAutoUpdate=!1,pe.grip.visible=!1),pe.grip};function z(se){var pe=v.get(se.inputSource);pe&&(pe.targetRay&&pe.targetRay.dispatchEvent({type:se.type}),pe.grip&&pe.grip.dispatchEvent({type:se.type}))}function k(){v.forEach(function(se,pe){se.targetRay&&(se.targetRay.dispatchEvent({type:"disconnected",data:pe}),se.targetRay.visible=!1),se.grip&&(se.grip.dispatchEvent({type:"disconnected",data:pe}),se.grip.visible=!1)}),v.clear(),e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),ie.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function F(se){u=se,ie.setContext(l),ie.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}this.setFramebufferScaleFactor=function(){},this.setReferenceSpaceType=function(se){h=se},this.getReferenceSpace=function(){return u},this.getSession=function(){return l},this.setSession=function(se){if(l=se,l!==null){l.addEventListener("select",z),l.addEventListener("selectstart",z),l.addEventListener("selectend",z),l.addEventListener("squeeze",z),l.addEventListener("squeezestart",z),l.addEventListener("squeezeend",z),l.addEventListener("end",k);var pe=t.getContextAttributes(),me={antialias:pe.antialias,alpha:pe.alpha,depth:pe.depth,stencil:pe.stencil},he=new XRWebGLLayer(l,t,me);l.updateRenderState({baseLayer:he}),l.requestReferenceSpace(h).then(F),l.addEventListener("inputsourceschange",G)}};function G(se){for(var pe=l.inputSources,me=0;me<r.length;me++)v.set(pe[me],r[me]);for(var me=0;me<se.removed.length;me++){var he=se.removed[me],Ue=v.get(he);Ue&&(Ue.targetRay&&Ue.targetRay.dispatchEvent({type:"disconnected",data:he}),Ue.grip&&Ue.grip.dispatchEvent({type:"disconnected",data:he}),v.delete(he))}for(var me=0;me<se.added.length;me++){var he=se.added[me],Ue=v.get(he);Ue&&(Ue.targetRay&&Ue.targetRay.dispatchEvent({type:"connected",data:he}),Ue.grip&&Ue.grip.dispatchEvent({type:"connected",data:he}))}}var X=new Se,re=new Se;function ue(se,pe,me){X.setFromMatrixPosition(pe.matrixWorld),re.setFromMatrixPosition(me.matrixWorld);var he=X.distanceTo(re),Ue=pe.projectionMatrix.elements,Ve=me.projectionMatrix.elements,$e=Ue[14]/(Ue[10]-1),ct=Ue[14]/(Ue[10]+1),At=(Ue[9]+1)/Ue[5],yt=(Ue[9]-1)/Ue[5],St=(Ue[8]-1)/Ue[0],It=(Ve[8]+1)/Ve[0],Nt=$e*St,Ie=$e*It,xe=he/(-St+It),He=xe*-St;pe.matrixWorld.decompose(se.position,se.quaternion,se.scale),se.translateX(He),se.translateZ(xe),se.matrixWorld.compose(se.position,se.quaternion,se.scale),se.matrixWorldInverse.getInverse(se.matrixWorld);var Ge=$e+xe,ze=ct+xe,rt=Nt-He,fe=Ie+(he-He),Ee=At*ct/ze*Ge,Ce=yt*ct/ze*Ge;se.projectionMatrix.makePerspective(rt,fe,Ee,Ce,Ge,ze)}function $(se,pe){pe===null?se.matrixWorld.copy(se.matrix):se.matrixWorld.multiplyMatrices(pe.matrixWorld,se.matrix),se.matrixWorldInverse.getInverse(se.matrixWorld)}this.getCamera=function(se){M.near=E.near=b.near=se.near,M.far=E.far=b.far=se.far,(D!==M.near||L!==M.far)&&(l.updateRenderState({depthNear:M.near,depthFar:M.far}),D=M.near,L=M.far);var pe=se.parent,me=M.cameras;$(M,pe);for(var he=0;he<me.length;he++)$(me[he],pe);se.matrixWorld.copy(M.matrixWorld);for(var Ue=se.children,he=0,Ve=Ue.length;he<Ve;he++)Ue[he].updateMatrixWorld(!0);return ue(M,b,E),M};var te=null;function oe(se,pe){if(f=pe.getViewerPose(u),f!==null){var me=f.views,he=l.renderState.baseLayer;e.setFramebuffer(he.framebuffer);for(var Ue=0;Ue<me.length;Ue++){var Ve=me[Ue],$e=he.getViewport(Ve),ct=M.cameras[Ue];ct.matrix.fromArray(Ve.transform.matrix),ct.projectionMatrix.fromArray(Ve.projectionMatrix),ct.viewport.set($e.x,$e.y,$e.width,$e.height),Ue===0&&M.matrix.copy(ct.matrix)}}for(var At=l.inputSources,Ue=0;Ue<r.length;Ue++){var yt=r[Ue],St=At[Ue],It=null,Nt=null;St&&(yt.targetRay&&(It=pe.getPose(St.targetRaySpace,u),It!==null&&(yt.targetRay.matrix.fromArray(It.transform.matrix),yt.targetRay.matrix.decompose(yt.targetRay.position,yt.targetRay.rotation,yt.targetRay.scale))),yt.grip&&St.gripSpace&&(Nt=pe.getPose(St.gripSpace,u),Nt!==null&&(yt.grip.matrix.fromArray(Nt.transform.matrix),yt.grip.matrix.decompose(yt.grip.position,yt.grip.rotation,yt.grip.scale)))),yt.targetRay&&(yt.targetRay.visible=It!==null),yt.grip&&(yt.grip.visible=Nt!==null)}te&&te(se,pe)}var ie=new Zx;ie.setAnimationLoop(oe),this.setAnimationLoop=function(se){te=se},this.dispose=function(){}}Object.assign(g0.prototype,Ta.prototype);function y0(e){e=e||{};var t=e.canvas!==void 0?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),i=e.context!==void 0?e.context:null,l=e.alpha!==void 0?e.alpha:!1,u=e.depth!==void 0?e.depth:!0,h=e.stencil!==void 0?e.stencil:!0,f=e.antialias!==void 0?e.antialias:!1,r=e.premultipliedAlpha!==void 0?e.premultipliedAlpha:!0,v=e.preserveDrawingBuffer!==void 0?e.preserveDrawingBuffer:!1,b=e.powerPreference!==void 0?e.powerPreference:"default",E=e.failIfMajorPerformanceCaveat!==void 0?e.failIfMajorPerformanceCaveat:!1,M=null,D=null;this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=no,this.physicallyCorrectLights=!1,this.toneMapping=$g,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var L=this,z=!1,k=null,F=0,G=0,X=null,re=null,ue=-1,$={geometry:null,program:null,wireframe:!1},te=null,oe=null,ie=new gi,se=new gi,pe=null,me=t.width,he=t.height,Ue=1,Ve=null,$e=null,ct=new gi(0,0,me,he),At=new gi(0,0,me,he),yt=!1,St=new Ch,It=new jA,Nt=!1,Ie=!1,xe=new jn,He=new Se;function Ge(){return X===null?Ue:1}var ze;try{var rt={alpha:l,depth:u,stencil:h,antialias:f,premultipliedAlpha:r,preserveDrawingBuffer:v,powerPreference:b,failIfMajorPerformanceCaveat:E,xrCompatible:!0};if(t.addEventListener("webglcontextlost",Zt,!1),t.addEventListener("webglcontextrestored",Ze,!1),ze=i||t.getContext("webgl",rt)||t.getContext("experimental-webgl",rt),ze===null)throw t.getContext("webgl")!==null?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");ze.getShaderPrecisionFormat===void 0&&(ze.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(q){throw console.error("THREE.WebGLRenderer: "+q.message),q}var fe,Ee,Ce,ye,Oe,Ke,st,wt,Gt,de,we,bt,gt,bn,hn,nn,pn;function wn(){fe=new $A(ze),Ee=new WA(ze,fe,e),Ee.isWebGL2===!1&&(fe.get("WEBGL_depth_texture"),fe.get("OES_texture_float"),fe.get("OES_texture_half_float"),fe.get("OES_texture_half_float_linear"),fe.get("OES_standard_derivatives"),fe.get("OES_element_index_uint"),fe.get("ANGLE_instanced_arrays")),fe.get("OES_texture_float_linear"),pn=new uD(ze,fe,Ee),Ce=new lD(ze,fe,Ee),Ce.scissor(se.copy(At).multiplyScalar(Ue).floor()),Ce.viewport(ie.copy(ct).multiplyScalar(Ue).floor()),ye=new XA,Oe=new JS,Ke=new cD(ze,fe,Ce,Oe,Ee,pn,ye),st=new wE(ze,Ee),wt=new qA(ze,st,ye),Gt=new KA(ze,wt,st,ye),bn=new JA(ze),de=new YS(L,fe,Ee),we=new eD,bt=new oD,gt=new GA(L,Ce,Gt,r),hn=new HA(ze,fe,ye,Ee),nn=new ZA(ze,fe,ye,Ee),ye.programs=de.programs,L.capabilities=Ee,L.extensions=fe,L.properties=Oe,L.renderLists=we,L.state=Ce,L.info=ye}wn();var cn=new g0(L,ze);this.xr=cn;var Ht=new hD(L,ze),sn=new m0(L,Gt,Ee.maxTextureSize);this.shadowMap=sn,this.getContext=function(){return ze},this.getContextAttributes=function(){return ze.getContextAttributes()},this.forceContextLoss=function(){var q=fe.get("WEBGL_lose_context");q&&q.loseContext()},this.forceContextRestore=function(){var q=fe.get("WEBGL_lose_context");q&&q.restoreContext()},this.getPixelRatio=function(){return Ue},this.setPixelRatio=function(q){q!==void 0&&(Ue=q,this.setSize(me,he,!1))},this.getSize=function(q){return q===void 0&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),q=new Lt),q.set(me,he)},this.setSize=function(q,K,Be){if(cn.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}me=q,he=K,t.width=Math.floor(q*Ue),t.height=Math.floor(K*Ue),Be!==!1&&(t.style.width=q+"px",t.style.height=K+"px"),this.setViewport(0,0,q,K)},this.getDrawingBufferSize=function(q){return q===void 0&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),q=new Lt),q.set(me*Ue,he*Ue).floor()},this.setDrawingBufferSize=function(q,K,Be){me=q,he=K,Ue=Be,t.width=Math.floor(q*Be),t.height=Math.floor(K*Be),this.setViewport(0,0,q,K)},this.getCurrentViewport=function(q){return q===void 0&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),q=new gi),q.copy(ie)},this.getViewport=function(q){return q.copy(ct)},this.setViewport=function(q,K,Be,Me){q.isVector4?ct.set(q.x,q.y,q.z,q.w):ct.set(q,K,Be,Me),Ce.viewport(ie.copy(ct).multiplyScalar(Ue).floor())},this.getScissor=function(q){return q.copy(At)},this.setScissor=function(q,K,Be,Me){q.isVector4?At.set(q.x,q.y,q.z,q.w):At.set(q,K,Be,Me),Ce.scissor(se.copy(At).multiplyScalar(Ue).floor())},this.getScissorTest=function(){return yt},this.setScissorTest=function(q){Ce.setScissorTest(yt=q)},this.setOpaqueSort=function(q){Ve=q},this.setTransparentSort=function(q){$e=q},this.getClearColor=function(){return gt.getClearColor()},this.setClearColor=function(){gt.setClearColor.apply(gt,arguments)},this.getClearAlpha=function(){return gt.getClearAlpha()},this.setClearAlpha=function(){gt.setClearAlpha.apply(gt,arguments)},this.clear=function(q,K,Be){var Me=0;(q===void 0||q)&&(Me|=16384),(K===void 0||K)&&(Me|=256),(Be===void 0||Be)&&(Me|=1024),ze.clear(Me)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Zt,!1),t.removeEventListener("webglcontextrestored",Ze,!1),we.dispose(),bt.dispose(),Oe.dispose(),Gt.dispose(),cn.dispose(),Nn.stop()};function Zt(q){q.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),z=!0}function Ze(){console.log("THREE.WebGLRenderer: Context Restored."),z=!1,wn()}function Ut(q){var K=q.target;K.removeEventListener("dispose",Ut),en(K)}function en(q){Dn(q),Oe.remove(q)}function Dn(q){var K=Oe.get(q).program;q.program=void 0,K!==void 0&&de.releaseProgram(K)}function fn(q,K){q.render(function(Be){L.renderBufferImmediate(Be,K)})}this.renderBufferImmediate=function(q,K){Ce.initAttributes();var Be=Oe.get(q);q.hasPositions&&!Be.position&&(Be.position=ze.createBuffer()),q.hasNormals&&!Be.normal&&(Be.normal=ze.createBuffer()),q.hasUvs&&!Be.uv&&(Be.uv=ze.createBuffer()),q.hasColors&&!Be.color&&(Be.color=ze.createBuffer());var Me=K.getAttributes();q.hasPositions&&(ze.bindBuffer(34962,Be.position),ze.bufferData(34962,q.positionArray,35048),Ce.enableAttribute(Me.position),ze.vertexAttribPointer(Me.position,3,5126,!1,0,0)),q.hasNormals&&(ze.bindBuffer(34962,Be.normal),ze.bufferData(34962,q.normalArray,35048),Ce.enableAttribute(Me.normal),ze.vertexAttribPointer(Me.normal,3,5126,!1,0,0)),q.hasUvs&&(ze.bindBuffer(34962,Be.uv),ze.bufferData(34962,q.uvArray,35048),Ce.enableAttribute(Me.uv),ze.vertexAttribPointer(Me.uv,2,5126,!1,0,0)),q.hasColors&&(ze.bindBuffer(34962,Be.color),ze.bufferData(34962,q.colorArray,35048),Ce.enableAttribute(Me.color),ze.vertexAttribPointer(Me.color,3,5126,!1,0,0)),Ce.disableUnusedAttributes(),ze.drawArrays(4,0,q.count),q.count=0};var On=new Ca;this.renderBufferDirect=function(q,K,Be,Me,Tt,_t){K===null&&(K=On);var Ot=Tt.isMesh&&Tt.matrixWorld.determinant()<0,rn=Hr(q,K,Me,Tt);Ce.setMaterial(Me,Ot);var Pn=!1;($.geometry!==Be.id||$.program!==rn.id||$.wireframe!==(Me.wireframe===!0))&&($.geometry=Be.id,$.program=rn.id,$.wireframe=Me.wireframe===!0,Pn=!0),(Me.morphTargets||Me.morphNormals)&&(bn.update(Tt,Be,Me,rn),Pn=!0);var Ln=Be.index,Mt=Be.attributes.position;if(Ln===null){if(Mt===void 0||Mt.count===0)return}else if(Ln.count===0)return;var un=1;Me.wireframe===!0&&(Ln=wt.getWireframeAttribute(Be),un=2);var Jt,mn=hn;Ln!==null&&(Jt=st.get(Ln),mn=nn,mn.setIndex(Jt)),Pn&&(Gn(Tt,Be,Me,rn),Ln!==null&&ze.bindBuffer(34963,Jt.buffer));var Tn=Ln!==null?Ln.count:Mt.count,Cn=Be.drawRange.start*un,di=Be.drawRange.count*un,Ar=_t!==null?_t.start*un:0,oi=_t!==null?_t.count*un:1/0,li=Math.max(Cn,Ar),ai=Math.min(Tn,Cn+di,Ar+oi)-1,xs=Math.max(0,ai-li+1);if(xs!==0){if(Tt.isMesh)Me.wireframe===!0?(Ce.setLineWidth(Me.wireframeLinewidth*Ge()),mn.setMode(1)):mn.setMode(4);else if(Tt.isLine){var zo=Me.linewidth;zo===void 0&&(zo=1),Ce.setLineWidth(zo*Ge()),Tt.isLineSegments?mn.setMode(1):Tt.isLineLoop?mn.setMode(2):mn.setMode(3)}else Tt.isPoints?mn.setMode(0):Tt.isSprite&&mn.setMode(4);Tt.isInstancedMesh?mn.renderInstances(Be,li,xs,Tt.count):Be.isInstancedBufferGeometry?mn.renderInstances(Be,li,xs,Be.maxInstancedCount):mn.render(li,xs)}};function Gn(q,K,Be,Me){if(!(Ee.isWebGL2===!1&&(q.isInstancedMesh||K.isInstancedBufferGeometry)&&fe.get("ANGLE_instanced_arrays")===null)){Ce.initAttributes();var Tt=K.attributes,_t=Me.getAttributes(),Ot=Be.defaultAttributeValues;for(var rn in _t){var Pn=_t[rn];if(Pn>=0){var Ln=Tt[rn];if(Ln!==void 0){var Mt=Ln.normalized,un=Ln.itemSize,Jt=st.get(Ln);if(Jt===void 0)continue;var mn=Jt.buffer,Tn=Jt.type,Cn=Jt.bytesPerElement;if(Ln.isInterleavedBufferAttribute){var di=Ln.data,Ar=di.stride,oi=Ln.offset;di&&di.isInstancedInterleavedBuffer?(Ce.enableAttributeAndDivisor(Pn,di.meshPerAttribute),K.maxInstancedCount===void 0&&(K.maxInstancedCount=di.meshPerAttribute*di.count)):Ce.enableAttribute(Pn),ze.bindBuffer(34962,mn),ze.vertexAttribPointer(Pn,un,Tn,Mt,Ar*Cn,oi*Cn)}else Ln.isInstancedBufferAttribute?(Ce.enableAttributeAndDivisor(Pn,Ln.meshPerAttribute),K.maxInstancedCount===void 0&&(K.maxInstancedCount=Ln.meshPerAttribute*Ln.count)):Ce.enableAttribute(Pn),ze.bindBuffer(34962,mn),ze.vertexAttribPointer(Pn,un,Tn,Mt,0,0)}else if(rn==="instanceMatrix"){var Jt=st.get(q.instanceMatrix);if(Jt===void 0)continue;var mn=Jt.buffer,Tn=Jt.type;Ce.enableAttributeAndDivisor(Pn+0,1),Ce.enableAttributeAndDivisor(Pn+1,1),Ce.enableAttributeAndDivisor(Pn+2,1),Ce.enableAttributeAndDivisor(Pn+3,1),ze.bindBuffer(34962,mn),ze.vertexAttribPointer(Pn+0,4,Tn,!1,64,0),ze.vertexAttribPointer(Pn+1,4,Tn,!1,64,16),ze.vertexAttribPointer(Pn+2,4,Tn,!1,64,32),ze.vertexAttribPointer(Pn+3,4,Tn,!1,64,48)}else if(Ot!==void 0){var li=Ot[rn];if(li!==void 0)switch(li.length){case 2:ze.vertexAttrib2fv(Pn,li);break;case 3:ze.vertexAttrib3fv(Pn,li);break;case 4:ze.vertexAttrib4fv(Pn,li);break;default:ze.vertexAttrib1fv(Pn,li)}}}}Ce.disableUnusedAttributes()}}this.compile=function(q,K){D=bt.get(q,K),D.init(),q.traverse(function(Me){Me.isLight&&(D.pushLight(Me),Me.castShadow&&D.pushShadow(Me))}),D.setupLights(K);var Be={};q.traverse(function(Me){if(Me.material)if(Array.isArray(Me.material))for(var Tt=0;Tt<Me.material.length;Tt++)Me.material[Tt].uuid in Be||(_i(Me.material[Tt],q,Me),Be[Me.material[Tt].uuid]=!0);else Me.material.uuid in Be||(_i(Me.material,q,Me),Be[Me.material.uuid]=!0)})};var qn=null;function Wi(q){cn.isPresenting||qn&&qn(q)}var Nn=new Zx;Nn.setAnimationLoop(Wi),typeof window!="undefined"&&Nn.setContext(window),this.setAnimationLoop=function(q){qn=q,cn.setAnimationLoop(q),Nn.start()},this.render=function(q,K){var Be,Me;if(arguments[2]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),Be=arguments[2]),arguments[3]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),Me=arguments[3]),!(K&&K.isCamera)){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(!z){$.geometry=null,$.program=null,$.wireframe=!1,ue=-1,te=null,q.autoUpdate===!0&&q.updateMatrixWorld(),K.parent===null&&K.updateMatrixWorld(),cn.enabled&&cn.isPresenting&&(K=cn.getCamera(K)),D=bt.get(q,K),D.init(),q.onBeforeRender(L,q,K,Be||X),xe.multiplyMatrices(K.projectionMatrix,K.matrixWorldInverse),St.setFromProjectionMatrix(xe),Ie=this.localClippingEnabled,Nt=It.init(this.clippingPlanes,Ie,K),M=we.get(q,K),M.init(),Si(q,K,0,L.sortObjects),L.sortObjects===!0&&M.sort(Ve,$e),Nt&&It.beginShadows();var Tt=D.state.shadowsArray;sn.render(Tt,q,K),D.setupLights(K),Nt&&It.endShadows(),this.info.autoReset&&this.info.reset(),Be!==void 0&&this.setRenderTarget(Be),cn.enabled&&Ht.isAvailable()&&Ht.attachCamera(K),gt.render(M,q,K,Me);var _t=M.opaque,Ot=M.transparent;if(q.overrideMaterial){var rn=q.overrideMaterial;_t.length&&ei(_t,q,K,rn),Ot.length&&ei(Ot,q,K,rn)}else _t.length&&ei(_t,q,K),Ot.length&&ei(Ot,q,K);q.onAfterRender(L,q,K),X!==null&&(Ke.updateRenderTargetMipmap(X),Ke.updateMultisampleRenderTarget(X)),Ce.buffers.depth.setTest(!0),Ce.buffers.depth.setMask(!0),Ce.buffers.color.setMask(!0),Ce.setPolygonOffset(!1),cn.enabled&&Ht.isAvailable()&&Ht.detachCamera(K),M=null,D=null}};function Si(q,K,Be,Me){if(q.visible!==!1){var Tt=q.layers.test(K.layers);if(Tt){if(q.isGroup)Be=q.renderOrder;else if(q.isLOD)q.autoUpdate===!0&&q.update(K);else if(q.isLight)D.pushLight(q),q.castShadow&&D.pushShadow(q);else if(q.isSprite){if(!q.frustumCulled||St.intersectsSprite(q)){Me&&He.setFromMatrixPosition(q.matrixWorld).applyMatrix4(xe);var _t=Gt.update(q),Ot=q.material;Ot.visible&&M.push(q,_t,Ot,Be,He.z,null)}}else if(q.isImmediateRenderObject)Me&&He.setFromMatrixPosition(q.matrixWorld).applyMatrix4(xe),M.push(q,null,q.material,Be,He.z,null);else if((q.isMesh||q.isLine||q.isPoints)&&(q.isSkinnedMesh&&q.skeleton.frame!==ye.render.frame&&(q.skeleton.update(),q.skeleton.frame=ye.render.frame),!q.frustumCulled||St.intersectsObject(q))){Me&&He.setFromMatrixPosition(q.matrixWorld).applyMatrix4(xe);var _t=Gt.update(q),Ot=q.material;if(Array.isArray(Ot))for(var rn=_t.groups,Pn=0,Ln=rn.length;Pn<Ln;Pn++){var Mt=rn[Pn],un=Ot[Mt.materialIndex];un&&un.visible&&M.push(q,_t,un,Be,He.z,Mt)}else Ot.visible&&M.push(q,_t,Ot,Be,He.z,null)}}for(var Jt=q.children,Pn=0,Ln=Jt.length;Pn<Ln;Pn++)Si(Jt[Pn],K,Be,Me)}}function ei(q,K,Be,Me){for(var Tt=0,_t=q.length;Tt<_t;Tt++){var Ot=q[Tt],rn=Ot.object,Pn=Ot.geometry,Ln=Me===void 0?Ot.material:Me,Mt=Ot.group;if(Be.isArrayCamera)if(oe=Be,cn.enabled&&Ht.isAvailable())Ki(rn,K,Be,Pn,Ln,Mt);else for(var un=Be.cameras,Jt=0,mn=un.length;Jt<mn;Jt++){var Tn=un[Jt];rn.layers.test(Tn.layers)&&(Ce.viewport(ie.copy(Tn.viewport)),D.setupLights(Tn),Ki(rn,K,Tn,Pn,Ln,Mt))}else oe=null,Ki(rn,K,Be,Pn,Ln,Mt)}}function Ki(q,K,Be,Me,Tt,_t){if(q.onBeforeRender(L,K,Be,Me,Tt,_t),D=bt.get(K,oe||Be),q.modelViewMatrix.multiplyMatrices(Be.matrixWorldInverse,q.matrixWorld),q.normalMatrix.getNormalMatrix(q.modelViewMatrix),q.isImmediateRenderObject){var Ot=Hr(Be,K,Tt,q);Ce.setMaterial(Tt),$.geometry=null,$.program=null,$.wireframe=!1,fn(q,Ot)}else L.renderBufferDirect(Be,K,Me,Tt,q,_t);q.onAfterRender(L,K,Be,Me,Tt,_t),D=bt.get(K,oe||Be)}function _i(q,K,Be){var Me=Oe.get(q),Tt=D.state.lights,_t=D.state.shadowsArray,Ot=Tt.state.version,rn=de.getParameters(q,Tt.state,_t,K,It.numPlanes,It.numIntersection,Be),Pn=de.getProgramCacheKey(rn),Ln=Me.program,Mt=!0;if(Ln===void 0)q.addEventListener("dispose",Ut);else if(Ln.cacheKey!==Pn)Dn(q);else if(Me.lightsStateVersion!==Ot)Me.lightsStateVersion=Ot,Mt=!1;else{if(rn.shaderID!==void 0)return;Mt=!1}Mt&&(Ln=de.acquireProgram(rn,Pn),Me.program=Ln,Me.uniforms=rn.uniforms,Me.environment=q.isMeshStandardMaterial?K.environment:null,Me.outputEncoding=L.outputEncoding,q.program=Ln);var un=Ln.getAttributes();if(q.morphTargets){q.numSupportedMorphTargets=0;for(var Jt=0;Jt<L.maxMorphTargets;Jt++)un["morphTarget"+Jt]>=0&&q.numSupportedMorphTargets++}if(q.morphNormals){q.numSupportedMorphNormals=0;for(var Jt=0;Jt<L.maxMorphNormals;Jt++)un["morphNormal"+Jt]>=0&&q.numSupportedMorphNormals++}var mn=Me.uniforms;(!q.isShaderMaterial&&!q.isRawShaderMaterial||q.clipping===!0)&&(Me.numClippingPlanes=It.numPlanes,Me.numIntersection=It.numIntersection,mn.clippingPlanes=It.uniform),Me.fog=K.fog,Me.needsLights=_n(q),Me.lightsStateVersion=Ot,Me.needsLights&&(mn.ambientLightColor.value=Tt.state.ambient,mn.lightProbe.value=Tt.state.probe,mn.directionalLights.value=Tt.state.directional,mn.spotLights.value=Tt.state.spot,mn.rectAreaLights.value=Tt.state.rectArea,mn.pointLights.value=Tt.state.point,mn.hemisphereLights.value=Tt.state.hemi,mn.directionalShadowMap.value=Tt.state.directionalShadowMap,mn.directionalShadowMatrix.value=Tt.state.directionalShadowMatrix,mn.spotShadowMap.value=Tt.state.spotShadowMap,mn.spotShadowMatrix.value=Tt.state.spotShadowMatrix,mn.pointShadowMap.value=Tt.state.pointShadowMap,mn.pointShadowMatrix.value=Tt.state.pointShadowMatrix);var Tn=Me.program.getUniforms(),Cn=as.seqWithValue(Tn.seq,mn);Me.uniformsList=Cn}function Hr(q,K,Be,Me){Ke.resetTextureUnits();var Tt=K.fog,_t=Be.isMeshStandardMaterial?K.environment:null,Ot=Oe.get(Be),rn=D.state.lights;if(Nt&&(Ie||q!==te)){var Pn=q===te&&Be.id===ue;It.setState(Be.clippingPlanes,Be.clipIntersection,Be.clipShadows,q,Ot,Pn)}Be.version===Ot.__version?(Ot.program===void 0||Be.fog&&Ot.fog!==Tt||Ot.environment!==_t||Ot.needsLights&&Ot.lightsStateVersion!==rn.state.version||Ot.numClippingPlanes!==void 0&&(Ot.numClippingPlanes!==It.numPlanes||Ot.numIntersection!==It.numIntersection)||Ot.outputEncoding!==L.outputEncoding)&&_i(Be,K,Me):(_i(Be,K,Me),Ot.__version=Be.version);var Ln=!1,Mt=!1,un=!1,Jt=Ot.program,mn=Jt.getUniforms(),Tn=Ot.uniforms;if(Ce.useProgram(Jt.program)&&(Ln=!0,Mt=!0,un=!0),Be.id!==ue&&(ue=Be.id,Mt=!0),Ln||te!==q){if(Jt.numMultiviewViews>0?Ht.updateCameraProjectionMatricesUniform(q,mn):mn.setValue(ze,"projectionMatrix",q.projectionMatrix),Ee.logarithmicDepthBuffer&&mn.setValue(ze,"logDepthBufFC",2/(Math.log(q.far+1)/Math.LN2)),te!==q&&(te=q,Mt=!0,un=!0),Be.isShaderMaterial||Be.isMeshPhongMaterial||Be.isMeshToonMaterial||Be.isMeshStandardMaterial||Be.envMap){var Cn=mn.map.cameraPosition;Cn!==void 0&&Cn.setValue(ze,He.setFromMatrixPosition(q.matrixWorld))}(Be.isMeshPhongMaterial||Be.isMeshToonMaterial||Be.isMeshLambertMaterial||Be.isMeshBasicMaterial||Be.isMeshStandardMaterial||Be.isShaderMaterial)&&mn.setValue(ze,"isOrthographic",q.isOrthographicCamera===!0),(Be.isMeshPhongMaterial||Be.isMeshToonMaterial||Be.isMeshLambertMaterial||Be.isMeshBasicMaterial||Be.isMeshStandardMaterial||Be.isShaderMaterial||Be.skinning)&&(Jt.numMultiviewViews>0?Ht.updateCameraViewMatricesUniform(q,mn):mn.setValue(ze,"viewMatrix",q.matrixWorldInverse))}if(Be.skinning){mn.setOptional(ze,Me,"bindMatrix"),mn.setOptional(ze,Me,"bindMatrixInverse");var di=Me.skeleton;if(di){var Ar=di.bones;if(Ee.floatVertexTextures){if(di.boneTexture===void 0){var oi=Math.sqrt(Ar.length*4);oi=Wn.ceilPowerOfTwo(oi),oi=Math.max(oi,4);var li=new Float32Array(oi*oi*4);li.set(di.boneMatrices);var ai=new Ac(li,oi,oi,Ao,dh);di.boneMatrices=li,di.boneTexture=ai,di.boneTextureSize=oi}mn.setValue(ze,"boneTexture",di.boneTexture,Ke),mn.setValue(ze,"boneTextureSize",di.boneTextureSize)}else mn.setOptional(ze,di,"boneMatrices")}}return(Mt||Ot.receiveShadow!==Me.receiveShadow)&&(Ot.receiveShadow=Me.receiveShadow,mn.setValue(ze,"receiveShadow",Me.receiveShadow)),Mt&&(mn.setValue(ze,"toneMappingExposure",L.toneMappingExposure),mn.setValue(ze,"toneMappingWhitePoint",L.toneMappingWhitePoint),Ot.needsLights&&Ct(Tn,un),Tt&&Be.fog&&Y(Tn,Tt),Be.isMeshBasicMaterial?ki(Tn,Be):Be.isMeshLambertMaterial?(ki(Tn,Be),ge(Tn,Be)):Be.isMeshToonMaterial?(ki(Tn,Be),We(Tn,Be)):Be.isMeshPhongMaterial?(ki(Tn,Be),Re(Tn,Be)):Be.isMeshStandardMaterial?(ki(Tn,Be,_t),Be.isMeshPhysicalMaterial?et(Tn,Be,_t):Qe(Tn,Be,_t)):Be.isMeshMatcapMaterial?(ki(Tn,Be),qe(Tn,Be)):Be.isMeshDepthMaterial?(ki(Tn,Be),it(Tn,Be)):Be.isMeshDistanceMaterial?(ki(Tn,Be),vt(Tn,Be)):Be.isMeshNormalMaterial?(ki(Tn,Be),Vt(Tn,Be)):Be.isLineBasicMaterial?(Wr(Tn,Be),Be.isLineDashedMaterial&&Cr(Tn,Be)):Be.isPointsMaterial?be(Tn,Be):Be.isSpriteMaterial?W(Tn,Be):Be.isShadowMaterial&&(Tn.color.value.copy(Be.color),Tn.opacity.value=Be.opacity),Tn.ltc_1!==void 0&&(Tn.ltc_1.value=an.LTC_1),Tn.ltc_2!==void 0&&(Tn.ltc_2.value=an.LTC_2),as.upload(ze,Ot.uniformsList,Tn,Ke),Be.isShaderMaterial&&(Be.uniformsNeedUpdate=!1)),Be.isShaderMaterial&&Be.uniformsNeedUpdate===!0&&(as.upload(ze,Ot.uniformsList,Tn,Ke),Be.uniformsNeedUpdate=!1),Be.isSpriteMaterial&&mn.setValue(ze,"center",Me.center),Jt.numMultiviewViews>0?Ht.updateObjectMatricesUniforms(Me,q,mn):(mn.setValue(ze,"modelViewMatrix",Me.modelViewMatrix),mn.setValue(ze,"normalMatrix",Me.normalMatrix)),mn.setValue(ze,"modelMatrix",Me.matrixWorld),Jt}function ki(q,K,Be){q.opacity.value=K.opacity,K.color&&q.diffuse.value.copy(K.color),K.emissive&&q.emissive.value.copy(K.emissive).multiplyScalar(K.emissiveIntensity),K.map&&(q.map.value=K.map),K.alphaMap&&(q.alphaMap.value=K.alphaMap),K.specularMap&&(q.specularMap.value=K.specularMap);var Me=K.envMap||Be;Me&&(q.envMap.value=Me,q.flipEnvMap.value=Me.isCubeTexture?-1:1,q.reflectivity.value=K.reflectivity,q.refractionRatio.value=K.refractionRatio,q.maxMipLevel.value=Oe.get(Me).__maxMipLevel),K.lightMap&&(q.lightMap.value=K.lightMap,q.lightMapIntensity.value=K.lightMapIntensity),K.aoMap&&(q.aoMap.value=K.aoMap,q.aoMapIntensity.value=K.aoMapIntensity);var Tt;K.map?Tt=K.map:K.specularMap?Tt=K.specularMap:K.displacementMap?Tt=K.displacementMap:K.normalMap?Tt=K.normalMap:K.bumpMap?Tt=K.bumpMap:K.roughnessMap?Tt=K.roughnessMap:K.metalnessMap?Tt=K.metalnessMap:K.alphaMap?Tt=K.alphaMap:K.emissiveMap&&(Tt=K.emissiveMap),Tt!==void 0&&(Tt.isWebGLRenderTarget&&(Tt=Tt.texture),Tt.matrixAutoUpdate===!0&&Tt.updateMatrix(),q.uvTransform.value.copy(Tt.matrix));var _t;K.aoMap?_t=K.aoMap:K.lightMap&&(_t=K.lightMap),_t!==void 0&&(_t.isWebGLRenderTarget&&(_t=_t.texture),_t.matrixAutoUpdate===!0&&_t.updateMatrix(),q.uv2Transform.value.copy(_t.matrix))}function Wr(q,K){q.diffuse.value.copy(K.color),q.opacity.value=K.opacity}function Cr(q,K){q.dashSize.value=K.dashSize,q.totalSize.value=K.dashSize+K.gapSize,q.scale.value=K.scale}function be(q,K){q.diffuse.value.copy(K.color),q.opacity.value=K.opacity,q.size.value=K.size*Ue,q.scale.value=he*.5,K.map&&(q.map.value=K.map),K.alphaMap&&(q.alphaMap.value=K.alphaMap);var Be;K.map?Be=K.map:K.alphaMap&&(Be=K.alphaMap),Be!==void 0&&(Be.matrixAutoUpdate===!0&&Be.updateMatrix(),q.uvTransform.value.copy(Be.matrix))}function W(q,K){q.diffuse.value.copy(K.color),q.opacity.value=K.opacity,q.rotation.value=K.rotation,K.map&&(q.map.value=K.map),K.alphaMap&&(q.alphaMap.value=K.alphaMap);var Be;K.map?Be=K.map:K.alphaMap&&(Be=K.alphaMap),Be!==void 0&&(Be.matrixAutoUpdate===!0&&Be.updateMatrix(),q.uvTransform.value.copy(Be.matrix))}function Y(q,K){q.fogColor.value.copy(K.color),K.isFog?(q.fogNear.value=K.near,q.fogFar.value=K.far):K.isFogExp2&&(q.fogDensity.value=K.density)}function ge(q,K){K.emissiveMap&&(q.emissiveMap.value=K.emissiveMap)}function Re(q,K){q.specular.value.copy(K.specular),q.shininess.value=Math.max(K.shininess,1e-4),K.emissiveMap&&(q.emissiveMap.value=K.emissiveMap),K.bumpMap&&(q.bumpMap.value=K.bumpMap,q.bumpScale.value=K.bumpScale,K.side===tr&&(q.bumpScale.value*=-1)),K.normalMap&&(q.normalMap.value=K.normalMap,q.normalScale.value.copy(K.normalScale),K.side===tr&&q.normalScale.value.negate()),K.displacementMap&&(q.displacementMap.value=K.displacementMap,q.displacementScale.value=K.displacementScale,q.displacementBias.value=K.displacementBias)}function We(q,K){q.specular.value.copy(K.specular),q.shininess.value=Math.max(K.shininess,1e-4),K.gradientMap&&(q.gradientMap.value=K.gradientMap),K.emissiveMap&&(q.emissiveMap.value=K.emissiveMap),K.bumpMap&&(q.bumpMap.value=K.bumpMap,q.bumpScale.value=K.bumpScale,K.side===tr&&(q.bumpScale.value*=-1)),K.normalMap&&(q.normalMap.value=K.normalMap,q.normalScale.value.copy(K.normalScale),K.side===tr&&q.normalScale.value.negate()),K.displacementMap&&(q.displacementMap.value=K.displacementMap,q.displacementScale.value=K.displacementScale,q.displacementBias.value=K.displacementBias)}function Qe(q,K,Be){q.roughness.value=K.roughness,q.metalness.value=K.metalness,K.roughnessMap&&(q.roughnessMap.value=K.roughnessMap),K.metalnessMap&&(q.metalnessMap.value=K.metalnessMap),K.emissiveMap&&(q.emissiveMap.value=K.emissiveMap),K.bumpMap&&(q.bumpMap.value=K.bumpMap,q.bumpScale.value=K.bumpScale,K.side===tr&&(q.bumpScale.value*=-1)),K.normalMap&&(q.normalMap.value=K.normalMap,q.normalScale.value.copy(K.normalScale),K.side===tr&&q.normalScale.value.negate()),K.displacementMap&&(q.displacementMap.value=K.displacementMap,q.displacementScale.value=K.displacementScale,q.displacementBias.value=K.displacementBias),(K.envMap||Be)&&(q.envMapIntensity.value=K.envMapIntensity)}function et(q,K,Be){Qe(q,K,Be),q.reflectivity.value=K.reflectivity,q.clearcoat.value=K.clearcoat,q.clearcoatRoughness.value=K.clearcoatRoughness,K.sheen&&q.sheen.value.copy(K.sheen),K.clearcoatNormalMap&&(q.clearcoatNormalScale.value.copy(K.clearcoatNormalScale),q.clearcoatNormalMap.value=K.clearcoatNormalMap,K.side===tr&&q.clearcoatNormalScale.value.negate()),q.transparency.value=K.transparency}function qe(q,K){K.matcap&&(q.matcap.value=K.matcap),K.bumpMap&&(q.bumpMap.value=K.bumpMap,q.bumpScale.value=K.bumpScale,K.side===tr&&(q.bumpScale.value*=-1)),K.normalMap&&(q.normalMap.value=K.normalMap,q.normalScale.value.copy(K.normalScale),K.side===tr&&q.normalScale.value.negate()),K.displacementMap&&(q.displacementMap.value=K.displacementMap,q.displacementScale.value=K.displacementScale,q.displacementBias.value=K.displacementBias)}function it(q,K){K.displacementMap&&(q.displacementMap.value=K.displacementMap,q.displacementScale.value=K.displacementScale,q.displacementBias.value=K.displacementBias)}function vt(q,K){K.displacementMap&&(q.displacementMap.value=K.displacementMap,q.displacementScale.value=K.displacementScale,q.displacementBias.value=K.displacementBias),q.referencePosition.value.copy(K.referencePosition),q.nearDistance.value=K.nearDistance,q.farDistance.value=K.farDistance}function Vt(q,K){K.bumpMap&&(q.bumpMap.value=K.bumpMap,q.bumpScale.value=K.bumpScale,K.side===tr&&(q.bumpScale.value*=-1)),K.normalMap&&(q.normalMap.value=K.normalMap,q.normalScale.value.copy(K.normalScale),K.side===tr&&q.normalScale.value.negate()),K.displacementMap&&(q.displacementMap.value=K.displacementMap,q.displacementScale.value=K.displacementScale,q.displacementBias.value=K.displacementBias)}function Ct(q,K){q.ambientLightColor.needsUpdate=K,q.lightProbe.needsUpdate=K,q.directionalLights.needsUpdate=K,q.pointLights.needsUpdate=K,q.spotLights.needsUpdate=K,q.rectAreaLights.needsUpdate=K,q.hemisphereLights.needsUpdate=K}function _n(q){return q.isMeshLambertMaterial||q.isMeshToonMaterial||q.isMeshPhongMaterial||q.isMeshStandardMaterial||q.isShadowMaterial||q.isShaderMaterial&&q.lights===!0}this.setFramebuffer=function(q){k!==q&&X===null&&ze.bindFramebuffer(36160,q),k=q},this.getActiveCubeFace=function(){return F},this.getActiveMipmapLevel=function(){return G},this.getRenderTarget=function(){return X},this.setRenderTarget=function(q,K,Be){X=q,F=K,G=Be,q&&Oe.get(q).__webglFramebuffer===void 0&&Ke.setupRenderTarget(q);var Me=k,Tt=!1;if(q){var _t=Oe.get(q).__webglFramebuffer;q.isWebGLCubeRenderTarget?(Me=_t[K||0],Tt=!0):q.isWebGLMultisampleRenderTarget?Me=Oe.get(q).__webglMultisampledFramebuffer:Me=_t,ie.copy(q.viewport),se.copy(q.scissor),pe=q.scissorTest}else ie.copy(ct).multiplyScalar(Ue).floor(),se.copy(At).multiplyScalar(Ue).floor(),pe=yt;if(re!==Me&&(ze.bindFramebuffer(36160,Me),re=Me),Ce.viewport(ie),Ce.scissor(se),Ce.setScissorTest(pe),Tt){var Ot=Oe.get(q.texture);ze.framebufferTexture2D(36160,36064,34069+(K||0),Ot.__webglTexture,Be||0)}},this.readRenderTargetPixels=function(q,K,Be,Me,Tt,_t,Ot){if(!(q&&q.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}var rn=Oe.get(q).__webglFramebuffer;if(q.isWebGLCubeRenderTarget&&Ot!==void 0&&(rn=rn[Ot]),rn){var Pn=!1;rn!==re&&(ze.bindFramebuffer(36160,rn),Pn=!0);try{var Ln=q.texture,Mt=Ln.format,un=Ln.type;if(Mt!==Ao&&pn.convert(Mt)!==ze.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(un!==qp&&pn.convert(un)!==ze.getParameter(35738)&&!(un===dh&&(Ee.isWebGL2||fe.get("OES_texture_float")||fe.get("WEBGL_color_buffer_float")))&&!(un===Qg&&(Ee.isWebGL2?fe.get("EXT_color_buffer_float"):fe.get("EXT_color_buffer_half_float")))){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ze.checkFramebufferStatus(36160)===36053?K>=0&&K<=q.width-Me&&Be>=0&&Be<=q.height-Tt&&ze.readPixels(K,Be,Me,Tt,pn.convert(Mt),pn.convert(un),_t):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{Pn&&ze.bindFramebuffer(36160,re)}}},this.copyFramebufferToTexture=function(q,K,Be){Be===void 0&&(Be=0);var Me=Math.pow(2,-Be),Tt=Math.floor(K.image.width*Me),_t=Math.floor(K.image.height*Me),Ot=pn.convert(K.format);Ke.setTexture2D(K,0),ze.copyTexImage2D(3553,Be,Ot,q.x,q.y,Tt,_t,0),Ce.unbindTexture()},this.copyTextureToTexture=function(q,K,Be,Me){var Tt=K.image.width,_t=K.image.height,Ot=pn.convert(Be.format),rn=pn.convert(Be.type);Ke.setTexture2D(Be,0),K.isDataTexture?ze.texSubImage2D(3553,Me||0,q.x,q.y,Tt,_t,Ot,rn,K.image.data):ze.texSubImage2D(3553,Me||0,q.x,q.y,Ot,rn,K.image),Ce.unbindTexture()},this.initTexture=function(q){Ke.setTexture2D(q,0),Ce.unbindTexture()},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function Iy(e,t){this.name="",this.color=new tn(e),this.density=t!==void 0?t:25e-5}Object.assign(Iy.prototype,{isFogExp2:!0,clone:function(){return new Iy(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}});function Ry(e,t,i){this.name="",this.color=new tn(e),this.near=t!==void 0?t:1,this.far=i!==void 0?i:1e3}Object.assign(Ry.prototype,{isFog:!0,clone:function(){return new Ry(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}});function za(e,t){this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Jp,this.updateRange={offset:0,count:-1},this.version=0}Object.defineProperty(za.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}}),Object.assign(za.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,i){e*=this.stride,i*=t.stride;for(var l=0,u=this.stride;l<u;l++)this.array[e+l]=t.array[i+l];return this},set:function(e,t){return t===void 0&&(t=0),this.array.set(e,t),this},clone:function(){return new this.constructor().copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}});var sl=new Se;function Lh(e,t,i,l){this.data=e,this.itemSize=t,this.offset=i,this.normalized=l===!0}Object.defineProperties(Lh.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(Lh.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(e){for(var t=0,i=this.data.count;t<i;t++)sl.x=this.getX(t),sl.y=this.getY(t),sl.z=this.getZ(t),sl.applyMatrix4(e),this.setXYZ(t,sl.x,sl.y,sl.z);return this},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this},setXYZ:function(e,t,i,l){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=l,this},setXYZW:function(e,t,i,l,u){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=l,this.data.array[e+3]=u,this}});function ll(e){Rn.call(this),this.type="SpriteMaterial",this.color=new tn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}ll.prototype=Object.create(Rn.prototype),ll.prototype.constructor=ll,ll.prototype.isSpriteMaterial=!0,ll.prototype.copy=function(e){return Rn.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};var Lc,Ih=new Se,Ic=new Se,Rc=new Se,zc=new Lt,Rh=new Lt,_0=new jn,yf=new Se,zh=new Se,_f=new Se,v0=new Lt,zy=new Lt,x0=new Lt;function ky(e){if(on.call(this),this.type="Sprite",Lc===void 0){Lc=new vn;var t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new za(t,5);Lc.setIndex([0,1,2,0,2,3]),Lc.setAttribute("position",new Lh(i,3,0,!1)),Lc.setAttribute("uv",new Lh(i,2,3,!1))}this.geometry=Lc,this.material=e!==void 0?e:new ll,this.center=new Lt(.5,.5)}ky.prototype=Object.assign(Object.create(on.prototype),{constructor:ky,isSprite:!0,raycast:function(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Ic.setFromMatrixScale(this.matrixWorld),_0.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Rc.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Ic.multiplyScalar(-Rc.z);var i=this.material.rotation,l,u;i!==0&&(u=Math.cos(i),l=Math.sin(i));var h=this.center;vf(yf.set(-.5,-.5,0),Rc,h,Ic,l,u),vf(zh.set(.5,-.5,0),Rc,h,Ic,l,u),vf(_f.set(.5,.5,0),Rc,h,Ic,l,u),v0.set(0,0),zy.set(1,0),x0.set(1,1);var f=e.ray.intersectTriangle(yf,zh,_f,!1,Ih);if(!(f===null&&(vf(zh.set(-.5,.5,0),Rc,h,Ic,l,u),zy.set(0,1),f=e.ray.intersectTriangle(yf,_f,zh,!1,Ih),f===null))){var r=e.ray.origin.distanceTo(Ih);r<e.near||r>e.far||t.push({distance:r,point:Ih.clone(),uv:sr.getUV(Ih,yf,zh,_f,v0,zy,x0,new Lt),face:null,object:this})}},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return on.prototype.copy.call(this,e),e.center!==void 0&&this.center.copy(e.center),this}});function vf(e,t,i,l,u,h){zc.subVectors(e,i).addScalar(.5).multiply(l),u!==void 0?(Rh.x=h*zc.x-u*zc.y,Rh.y=u*zc.x+h*zc.y):Rh.copy(zc),e.copy(t),e.x+=Rh.x,e.y+=Rh.y,e.applyMatrix4(_0)}var xf=new Se,b0=new Se;function bf(){on.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}bf.prototype=Object.assign(Object.create(on.prototype),{constructor:bf,isLOD:!0,copy:function(e){on.prototype.copy.call(this,e,!1);for(var t=e.levels,i=0,l=t.length;i<l;i++){var u=t[i];this.addLevel(u.object.clone(),u.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e,t){t===void 0&&(t=0),t=Math.abs(t);for(var i=this.levels,l=0;l<i.length&&!(t<i[l].distance);l++);return i.splice(l,0,{distance:t,object:e}),this.add(e),this},getObjectForDistance:function(e){var t=this.levels;if(t.length>0){for(var i=1,l=t.length;i<l&&!(e<t[i].distance);i++);return t[i-1].object}return null},raycast:function(e,t){var i=this.levels;if(i.length>0){xf.setFromMatrixPosition(this.matrixWorld);var l=e.ray.origin.distanceTo(xf);this.getObjectForDistance(l).raycast(e,t)}},update:function(e){var t=this.levels;if(t.length>1){xf.setFromMatrixPosition(e.matrixWorld),b0.setFromMatrixPosition(this.matrixWorld);var i=xf.distanceTo(b0);t[0].object.visible=!0;for(var l=1,u=t.length;l<u&&i>=t[l].distance;l++)t[l-1].object.visible=!1,t[l].object.visible=!0;for(;l<u;l++)t[l].object.visible=!1}},toJSON:function(e){var t=on.prototype.toJSON.call(this,e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];for(var i=this.levels,l=0,u=i.length;l<u;l++){var h=i[l];t.object.levels.push({object:h.object.uuid,distance:h.distance})}return t}});function kh(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Ai.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new jn,this.bindMatrixInverse=new jn}kh.prototype=Object.assign(Object.create(Ai.prototype),{constructor:kh,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new gi,t=this.geometry.attributes.skinWeight,i=0,l=t.count;i<l;i++){e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.w=t.getW(i);var u=1/e.manhattanLength();u!==1/0?e.multiplyScalar(u):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){Ai.prototype.updateMatrixWorld.call(this,e),this.bindMode==="attached"?this.bindMatrixInverse.getInverse(this.matrixWorld):this.bindMode==="detached"?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var w0=new jn,dD=new jn;function wf(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(this.bones.length*16),this.frame=-1,t===void 0)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var i=0,l=this.bones.length;i<l;i++)this.boneInverses.push(new jn)}}Object.assign(wf.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var i=new jn;this.bones[e]&&i.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(i)}},pose:function(){var e,t,i;for(t=0,i=this.bones.length;t<i;t++)e=this.bones[t],e&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,i=this.bones.length;t<i;t++)e=this.bones[t],e&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){for(var e=this.bones,t=this.boneInverses,i=this.boneMatrices,l=this.boneTexture,u=0,h=e.length;u<h;u++){var f=e[u]?e[u].matrixWorld:dD;w0.multiplyMatrices(f,t[u]),w0.toArray(i,u*16)}l!==void 0&&(l.needsUpdate=!0)},clone:function(){return new wf(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,i=this.bones.length;t<i;t++){var l=this.bones[t];if(l.name===e)return l}}});function By(){on.call(this),this.type="Bone"}By.prototype=Object.assign(Object.create(on.prototype),{constructor:By,isBone:!0});var M0=new jn,T0=new jn,kc=[],Bh=new Ai;function Fy(e,t,i){Ai.call(this,e,t),this.instanceMatrix=new zn(new Float32Array(i*16),16),this.count=i,this.frustumCulled=!1}Fy.prototype=Object.assign(Object.create(Ai.prototype),{constructor:Fy,isInstancedMesh:!0,getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,e*16)},raycast:function(e,t){var i=this.matrixWorld,l=this.count;if(Bh.geometry=this.geometry,Bh.material=this.material,Bh.material!==void 0)for(var u=0;u<l;u++)this.getMatrixAt(u,M0),T0.multiplyMatrices(i,M0),Bh.matrixWorld=T0,Bh.raycast(e,kc),kc.length>0&&(kc[0].instanceId=u,kc[0].object=this,t.push(kc[0]),kc.length=0)},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,e*16)},updateMorphTargets:function(){}});function Ri(e){Rn.call(this),this.type="LineBasicMaterial",this.color=new tn(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}Ri.prototype=Object.create(Rn.prototype),Ri.prototype.constructor=Ri,Ri.prototype.isLineBasicMaterial=!0,Ri.prototype.copy=function(e){return Rn.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this};var E0=new Se,C0=new Se,A0=new jn,Mf=new gc,Tf=new Sa;function ao(e,t,i){i===1&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),on.call(this),this.type="Line",this.geometry=e!==void 0?e:new vn,this.material=t!==void 0?t:new Ri}ao.prototype=Object.assign(Object.create(on.prototype),{constructor:ao,isLine:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(e.index===null){for(var t=e.attributes.position,i=[0],l=1,u=t.count;l<u;l++)E0.fromBufferAttribute(t,l-1),C0.fromBufferAttribute(t,l),i[l]=i[l-1],i[l]+=E0.distanceTo(C0);e.setAttribute("lineDistance",new ln(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var h=e.vertices,i=e.lineDistances;i[0]=0;for(var l=1,u=h.length;l<u;l++)i[l]=i[l-1],i[l]+=h[l-1].distanceTo(h[l])}return this},raycast:function(e,t){var i=e.linePrecision,l=this.geometry,u=this.matrixWorld;if(l.boundingSphere===null&&l.computeBoundingSphere(),Tf.copy(l.boundingSphere),Tf.applyMatrix4(u),Tf.radius+=i,e.ray.intersectsSphere(Tf)!==!1){A0.getInverse(u),Mf.copy(e.ray).applyMatrix4(A0);var h=i/((this.scale.x+this.scale.y+this.scale.z)/3),f=h*h,r=new Se,v=new Se,b=new Se,E=new Se,M=this&&this.isLineSegments?2:1;if(l.isBufferGeometry){var D=l.index,L=l.attributes,z=L.position.array;if(D!==null)for(var k=D.array,F=0,G=k.length-1;F<G;F+=M){var X=k[F],re=k[F+1];r.fromArray(z,X*3),v.fromArray(z,re*3);var ue=Mf.distanceSqToSegment(r,v,E,b);if(!(ue>f)){E.applyMatrix4(this.matrixWorld);var $=e.ray.origin.distanceTo(E);$<e.near||$>e.far||t.push({distance:$,point:b.clone().applyMatrix4(this.matrixWorld),index:F,face:null,faceIndex:null,object:this})}}else for(var F=0,G=z.length/3-1;F<G;F+=M){r.fromArray(z,3*F),v.fromArray(z,3*F+3);var ue=Mf.distanceSqToSegment(r,v,E,b);if(!(ue>f)){E.applyMatrix4(this.matrixWorld);var $=e.ray.origin.distanceTo(E);$<e.near||$>e.far||t.push({distance:$,point:b.clone().applyMatrix4(this.matrixWorld),index:F,face:null,faceIndex:null,object:this})}}}else if(l.isGeometry)for(var te=l.vertices,oe=te.length,F=0;F<oe-1;F+=M){var ue=Mf.distanceSqToSegment(te[F],te[F+1],E,b);if(!(ue>f)){E.applyMatrix4(this.matrixWorld);var $=e.ray.origin.distanceTo(E);$<e.near||$>e.far||t.push({distance:$,point:b.clone().applyMatrix4(this.matrixWorld),index:F,face:null,faceIndex:null,object:this})}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Ef=new Se,Cf=new Se;function Vi(e,t){ao.call(this,e,t),this.type="LineSegments"}Vi.prototype=Object.assign(Object.create(ao.prototype),{constructor:Vi,isLineSegments:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(e.index===null){for(var t=e.attributes.position,i=[],l=0,u=t.count;l<u;l+=2)Ef.fromBufferAttribute(t,l),Cf.fromBufferAttribute(t,l+1),i[l]=l===0?0:i[l-1],i[l+1]=i[l]+Ef.distanceTo(Cf);e.setAttribute("lineDistance",new ln(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry)for(var h=e.vertices,i=e.lineDistances,l=0,u=h.length;l<u;l+=2)Ef.copy(h[l]),Cf.copy(h[l+1]),i[l]=l===0?0:i[l-1],i[l+1]=i[l]+Ef.distanceTo(Cf);return this}});function Af(e,t){ao.call(this,e,t),this.type="LineLoop"}Af.prototype=Object.assign(Object.create(ao.prototype),{constructor:Af,isLineLoop:!0});function ss(e){Rn.call(this),this.type="PointsMaterial",this.color=new tn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}ss.prototype=Object.create(Rn.prototype),ss.prototype.constructor=ss,ss.prototype.isPointsMaterial=!0,ss.prototype.copy=function(e){return Rn.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};var S0=new jn,Oy=new gc,Sf=new Sa,Df=new Se;function Pf(e,t){on.call(this),this.type="Points",this.geometry=e!==void 0?e:new vn,this.material=t!==void 0?t:new ss,this.updateMorphTargets()}Pf.prototype=Object.assign(Object.create(on.prototype),{constructor:Pf,isPoints:!0,raycast:function(e,t){var i=this.geometry,l=this.matrixWorld,u=e.params.Points.threshold;if(i.boundingSphere===null&&i.computeBoundingSphere(),Sf.copy(i.boundingSphere),Sf.applyMatrix4(l),Sf.radius+=u,e.ray.intersectsSphere(Sf)!==!1){S0.getInverse(l),Oy.copy(e.ray).applyMatrix4(S0);var h=u/((this.scale.x+this.scale.y+this.scale.z)/3),f=h*h;if(i.isBufferGeometry){var r=i.index,v=i.attributes,b=v.position.array;if(r!==null)for(var E=r.array,M=0,D=E.length;M<D;M++){var L=E[M];Df.fromArray(b,L*3),Ny(Df,L,f,l,e,t,this)}else for(var M=0,z=b.length/3;M<z;M++)Df.fromArray(b,M*3),Ny(Df,M,f,l,e,t,this)}else for(var k=i.vertices,M=0,z=k.length;M<z;M++)Ny(k[M],M,f,l,e,t,this)}},updateMorphTargets:function(){var e=this.geometry,t,i,l;if(e.isBufferGeometry){var u=e.morphAttributes,h=Object.keys(u);if(h.length>0){var f=u[h[0]];if(f!==void 0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},t=0,i=f.length;t<i;t++)l=f[t].name||String(t),this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=t}}else{var r=e.morphTargets;r!==void 0&&r.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});function Ny(e,t,i,l,u,h,f){var r=Oy.distanceSqToPoint(e);if(r<i){var v=new Se;Oy.closestPointToPoint(e,v),v.applyMatrix4(l);var b=u.ray.origin.distanceTo(v);if(b<u.near||b>u.far)return;h.push({distance:b,distanceToRay:Math.sqrt(r),point:v,index:t,face:null,object:f})}}function D0(e,t,i,l,u,h,f,r,v){mi.call(this,e,t,i,l,u,h,f,r,v),this.format=f!==void 0?f:Ma,this.minFilter=h!==void 0?h:$i,this.magFilter=u!==void 0?u:$i,this.generateMipmaps=!1}D0.prototype=Object.assign(Object.create(mi.prototype),{constructor:D0,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}});function Fh(e,t,i,l,u,h,f,r,v,b,E,M){mi.call(this,null,h,f,r,v,b,l,u,E,M),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}Fh.prototype=Object.create(mi.prototype),Fh.prototype.constructor=Fh,Fh.prototype.isCompressedTexture=!0;function Lf(e,t,i,l,u,h,f,r,v){mi.call(this,e,t,i,l,u,h,f,r,v),this.needsUpdate=!0}Lf.prototype=Object.create(mi.prototype),Lf.prototype.constructor=Lf,Lf.prototype.isCanvasTexture=!0;function If(e,t,i,l,u,h,f,r,v,b){if(b=b!==void 0?b:oc,b!==oc&&b!==ph)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&b===oc&&(i=Zp),i===void 0&&b===ph&&(i=Xp),mi.call(this,null,l,u,h,f,r,b,i,v),this.image={width:e,height:t},this.magFilter=f!==void 0?f:Ui,this.minFilter=r!==void 0?r:Ui,this.flipY=!1,this.generateMipmaps=!1}If.prototype=Object.create(mi.prototype),If.prototype.constructor=If,If.prototype.isDepthTexture=!0;function Rf(e){vn.call(this),this.type="WireframeGeometry";var t=[],i,l,u,h,f,r=[0,0],v={},b,E,M,D,L=["a","b","c"],z;if(e&&e.isGeometry){var k=e.faces;for(i=0,u=k.length;i<u;i++){var F=k[i];for(l=0;l<3;l++)E=F[L[l]],M=F[L[(l+1)%3]],r[0]=Math.min(E,M),r[1]=Math.max(E,M),D=r[0]+","+r[1],v[D]===void 0&&(v[D]={index1:r[0],index2:r[1]})}for(D in v)b=v[D],z=e.vertices[b.index1],t.push(z.x,z.y,z.z),z=e.vertices[b.index2],t.push(z.x,z.y,z.z)}else if(e&&e.isBufferGeometry){var G,X,re,ue,$,te,oe,ie;if(z=new Se,e.index!==null){for(G=e.attributes.position,X=e.index,re=e.groups,re.length===0&&(re=[{start:0,count:X.count,materialIndex:0}]),h=0,f=re.length;h<f;++h)for(ue=re[h],$=ue.start,te=ue.count,i=$,u=$+te;i<u;i+=3)for(l=0;l<3;l++)E=X.getX(i+l),M=X.getX(i+(l+1)%3),r[0]=Math.min(E,M),r[1]=Math.max(E,M),D=r[0]+","+r[1],v[D]===void 0&&(v[D]={index1:r[0],index2:r[1]});for(D in v)b=v[D],z.fromBufferAttribute(G,b.index1),t.push(z.x,z.y,z.z),z.fromBufferAttribute(G,b.index2),t.push(z.x,z.y,z.z)}else for(G=e.attributes.position,i=0,u=G.count/3;i<u;i++)for(l=0;l<3;l++)oe=3*i+l,z.fromBufferAttribute(G,oe),t.push(z.x,z.y,z.z),ie=3*i+(l+1)%3,z.fromBufferAttribute(G,ie),t.push(z.x,z.y,z.z)}this.setAttribute("position",new ln(t,3))}Rf.prototype=Object.create(vn.prototype),Rf.prototype.constructor=Rf;function zf(e,t,i){Fn.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:i},this.fromBufferGeometry(new Oh(e,t,i)),this.mergeVertices()}zf.prototype=Object.create(Fn.prototype),zf.prototype.constructor=zf;function Oh(e,t,i){vn.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:i};var l=[],u=[],h=[],f=[],r=1e-5,v=new Se,b=new Se,E=new Se,M=new Se,D=new Se,L,z;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var k=t+1;for(L=0;L<=i;L++){var F=L/i;for(z=0;z<=t;z++){var G=z/t;e(G,F,b),u.push(b.x,b.y,b.z),G-r>=0?(e(G-r,F,E),M.subVectors(b,E)):(e(G+r,F,E),M.subVectors(E,b)),F-r>=0?(e(G,F-r,E),D.subVectors(b,E)):(e(G,F+r,E),D.subVectors(E,b)),v.crossVectors(M,D).normalize(),h.push(v.x,v.y,v.z),f.push(G,F)}}for(L=0;L<i;L++)for(z=0;z<t;z++){var X=L*k+z,re=L*k+z+1,ue=(L+1)*k+z+1,$=(L+1)*k+z;l.push(X,re,$),l.push(re,ue,$)}this.setIndex(l),this.setAttribute("position",new ln(u,3)),this.setAttribute("normal",new ln(h,3)),this.setAttribute("uv",new ln(f,2))}Oh.prototype=Object.create(vn.prototype),Oh.prototype.constructor=Oh;function kf(e,t,i,l){Fn.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:l},this.fromBufferGeometry(new so(e,t,i,l)),this.mergeVertices()}kf.prototype=Object.create(Fn.prototype),kf.prototype.constructor=kf;function so(e,t,i,l){vn.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:l},i=i||1,l=l||0;var u=[],h=[];f(l),v(i),b(),this.setAttribute("position",new ln(u,3)),this.setAttribute("normal",new ln(u.slice(),3)),this.setAttribute("uv",new ln(h,2)),l===0?this.computeVertexNormals():this.normalizeNormals();function f(G){for(var X=new Se,re=new Se,ue=new Se,$=0;$<t.length;$+=3)D(t[$+0],X),D(t[$+1],re),D(t[$+2],ue),r(X,re,ue,G)}function r(G,X,re,ue){var $=Math.pow(2,ue),te=[],oe,ie;for(oe=0;oe<=$;oe++){te[oe]=[];var se=G.clone().lerp(re,oe/$),pe=X.clone().lerp(re,oe/$),me=$-oe;for(ie=0;ie<=me;ie++)ie===0&&oe===$?te[oe][ie]=se:te[oe][ie]=se.clone().lerp(pe,ie/me)}for(oe=0;oe<$;oe++)for(ie=0;ie<2*($-oe)-1;ie++){var he=Math.floor(ie/2);ie%2===0?(M(te[oe][he+1]),M(te[oe+1][he]),M(te[oe][he])):(M(te[oe][he+1]),M(te[oe+1][he+1]),M(te[oe+1][he]))}}function v(G){for(var X=new Se,re=0;re<u.length;re+=3)X.x=u[re+0],X.y=u[re+1],X.z=u[re+2],X.normalize().multiplyScalar(G),u[re+0]=X.x,u[re+1]=X.y,u[re+2]=X.z}function b(){for(var G=new Se,X=0;X<u.length;X+=3){G.x=u[X+0],G.y=u[X+1],G.z=u[X+2];var re=k(G)/2/Math.PI+.5,ue=F(G)/Math.PI+.5;h.push(re,1-ue)}L(),E()}function E(){for(var G=0;G<h.length;G+=6){var X=h[G+0],re=h[G+2],ue=h[G+4],$=Math.max(X,re,ue),te=Math.min(X,re,ue);$>.9&&te<.1&&(X<.2&&(h[G+0]+=1),re<.2&&(h[G+2]+=1),ue<.2&&(h[G+4]+=1))}}function M(G){u.push(G.x,G.y,G.z)}function D(G,X){var re=G*3;X.x=e[re+0],X.y=e[re+1],X.z=e[re+2]}function L(){for(var G=new Se,X=new Se,re=new Se,ue=new Se,$=new Lt,te=new Lt,oe=new Lt,ie=0,se=0;ie<u.length;ie+=9,se+=6){G.set(u[ie+0],u[ie+1],u[ie+2]),X.set(u[ie+3],u[ie+4],u[ie+5]),re.set(u[ie+6],u[ie+7],u[ie+8]),$.set(h[se+0],h[se+1]),te.set(h[se+2],h[se+3]),oe.set(h[se+4],h[se+5]),ue.copy(G).add(X).add(re).divideScalar(3);var pe=k(ue);z($,se+0,G,pe),z(te,se+2,X,pe),z(oe,se+4,re,pe)}}function z(G,X,re,ue){ue<0&&G.x===1&&(h[X]=G.x-1),re.x===0&&re.z===0&&(h[X]=ue/2/Math.PI+.5)}function k(G){return Math.atan2(G.z,-G.x)}function F(G){return Math.atan2(-G.y,Math.sqrt(G.x*G.x+G.z*G.z))}}so.prototype=Object.create(vn.prototype),so.prototype.constructor=so;function Bf(e,t){Fn.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Nh(e,t)),this.mergeVertices()}Bf.prototype=Object.create(Fn.prototype),Bf.prototype.constructor=Bf;function Nh(e,t){var i=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],l=[2,1,0,0,3,2,1,3,0,2,3,1];so.call(this,i,l,e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}Nh.prototype=Object.create(so.prototype),Nh.prototype.constructor=Nh;function Ff(e,t){Fn.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Bc(e,t)),this.mergeVertices()}Ff.prototype=Object.create(Fn.prototype),Ff.prototype.constructor=Ff;function Bc(e,t){var i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],l=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];so.call(this,i,l,e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}Bc.prototype=Object.create(so.prototype),Bc.prototype.constructor=Bc;function Of(e,t){Fn.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Uh(e,t)),this.mergeVertices()}Of.prototype=Object.create(Fn.prototype),Of.prototype.constructor=Of;function Uh(e,t){var i=(1+Math.sqrt(5))/2,l=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],u=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];so.call(this,l,u,e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}Uh.prototype=Object.create(so.prototype),Uh.prototype.constructor=Uh;function Nf(e,t){Fn.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Vh(e,t)),this.mergeVertices()}Nf.prototype=Object.create(Fn.prototype),Nf.prototype.constructor=Nf;function Vh(e,t){var i=(1+Math.sqrt(5))/2,l=1/i,u=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-l,-i,0,-l,i,0,l,-i,0,l,i,-l,-i,0,-l,i,0,l,-i,0,l,i,0,-i,0,-l,i,0,-l,-i,0,l,i,0,l],h=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];so.call(this,u,h,e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}Vh.prototype=Object.create(so.prototype),Vh.prototype.constructor=Vh;function Uf(e,t,i,l,u,h){Fn.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:l,closed:u},h!==void 0&&console.warn("THREE.TubeGeometry: taper has been removed.");var f=new Fc(e,t,i,l,u);this.tangents=f.tangents,this.normals=f.normals,this.binormals=f.binormals,this.fromBufferGeometry(f),this.mergeVertices()}Uf.prototype=Object.create(Fn.prototype),Uf.prototype.constructor=Uf;function Fc(e,t,i,l,u){vn.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:l,closed:u},t=t||64,i=i||1,l=l||8,u=u||!1;var h=e.computeFrenetFrames(t,u);this.tangents=h.tangents,this.normals=h.normals,this.binormals=h.binormals;var f=new Se,r=new Se,v=new Lt,b=new Se,E,M,D=[],L=[],z=[],k=[];F(),this.setIndex(k),this.setAttribute("position",new ln(D,3)),this.setAttribute("normal",new ln(L,3)),this.setAttribute("uv",new ln(z,2));function F(){for(E=0;E<t;E++)G(E);G(u===!1?t:0),re(),X()}function G(ue){b=e.getPointAt(ue/t,b);var $=h.normals[ue],te=h.binormals[ue];for(M=0;M<=l;M++){var oe=M/l*Math.PI*2,ie=Math.sin(oe),se=-Math.cos(oe);r.x=se*$.x+ie*te.x,r.y=se*$.y+ie*te.y,r.z=se*$.z+ie*te.z,r.normalize(),L.push(r.x,r.y,r.z),f.x=b.x+i*r.x,f.y=b.y+i*r.y,f.z=b.z+i*r.z,D.push(f.x,f.y,f.z)}}function X(){for(M=1;M<=t;M++)for(E=1;E<=l;E++){var ue=(l+1)*(M-1)+(E-1),$=(l+1)*M+(E-1),te=(l+1)*M+E,oe=(l+1)*(M-1)+E;k.push(ue,$,oe),k.push($,te,oe)}}function re(){for(E=0;E<=t;E++)for(M=0;M<=l;M++)v.x=E/t,v.y=M/l,z.push(v.x,v.y)}}Fc.prototype=Object.create(vn.prototype),Fc.prototype.constructor=Fc,Fc.prototype.toJSON=function(){var e=vn.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e};function Vf(e,t,i,l,u,h,f){Fn.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:l,p:u,q:h},f!==void 0&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Gh(e,t,i,l,u,h)),this.mergeVertices()}Vf.prototype=Object.create(Fn.prototype),Vf.prototype.constructor=Vf;function Gh(e,t,i,l,u,h){vn.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:l,p:u,q:h},e=e||1,t=t||.4,i=Math.floor(i)||64,l=Math.floor(l)||8,u=u||2,h=h||3;var f=[],r=[],v=[],b=[],E,M,D=new Se,L=new Se,z=new Se,k=new Se,F=new Se,G=new Se,X=new Se;for(E=0;E<=i;++E){var re=E/i*u*Math.PI*2;for(me(re,u,h,e,z),me(re+.01,u,h,e,k),G.subVectors(k,z),X.addVectors(k,z),F.crossVectors(G,X),X.crossVectors(F,G),F.normalize(),X.normalize(),M=0;M<=l;++M){var ue=M/l*Math.PI*2,$=-t*Math.cos(ue),te=t*Math.sin(ue);D.x=z.x+($*X.x+te*F.x),D.y=z.y+($*X.y+te*F.y),D.z=z.z+($*X.z+te*F.z),r.push(D.x,D.y,D.z),L.subVectors(D,z).normalize(),v.push(L.x,L.y,L.z),b.push(E/i),b.push(M/l)}}for(M=1;M<=i;M++)for(E=1;E<=l;E++){var oe=(l+1)*(M-1)+(E-1),ie=(l+1)*M+(E-1),se=(l+1)*M+E,pe=(l+1)*(M-1)+E;f.push(oe,ie,pe),f.push(ie,se,pe)}this.setIndex(f),this.setAttribute("position",new ln(r,3)),this.setAttribute("normal",new ln(v,3)),this.setAttribute("uv",new ln(b,2));function me(he,Ue,Ve,$e,ct){var At=Math.cos(he),yt=Math.sin(he),St=Ve/Ue*he,It=Math.cos(St);ct.x=$e*(2+It)*.5*At,ct.y=$e*(2+It)*yt*.5,ct.z=$e*Math.sin(St)*.5}}Gh.prototype=Object.create(vn.prototype),Gh.prototype.constructor=Gh;function Gf(e,t,i,l,u){Fn.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:l,arc:u},this.fromBufferGeometry(new Hh(e,t,i,l,u)),this.mergeVertices()}Gf.prototype=Object.create(Fn.prototype),Gf.prototype.constructor=Gf;function Hh(e,t,i,l,u){vn.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:l,arc:u},e=e||1,t=t||.4,i=Math.floor(i)||8,l=Math.floor(l)||6,u=u||Math.PI*2;var h=[],f=[],r=[],v=[],b=new Se,E=new Se,M=new Se,D,L;for(D=0;D<=i;D++)for(L=0;L<=l;L++){var z=L/l*u,k=D/i*Math.PI*2;E.x=(e+t*Math.cos(k))*Math.cos(z),E.y=(e+t*Math.cos(k))*Math.sin(z),E.z=t*Math.sin(k),f.push(E.x,E.y,E.z),b.x=e*Math.cos(z),b.y=e*Math.sin(z),M.subVectors(E,b).normalize(),r.push(M.x,M.y,M.z),v.push(L/l),v.push(D/i)}for(D=1;D<=i;D++)for(L=1;L<=l;L++){var F=(l+1)*D+L-1,G=(l+1)*(D-1)+L-1,X=(l+1)*(D-1)+L,re=(l+1)*D+L;h.push(F,G,re),h.push(G,X,re)}this.setIndex(h),this.setAttribute("position",new ln(f,3)),this.setAttribute("normal",new ln(r,3)),this.setAttribute("uv",new ln(v,2))}Hh.prototype=Object.create(vn.prototype),Hh.prototype.constructor=Hh;var pD={triangulate:function(e,t,i){i=i||2;var l=t&&t.length,u=l?t[0]*i:e.length,h=P0(e,0,u,i,!0),f=[];if(!h||h.next===h.prev)return f;var r,v,b,E,M,D,L;if(l&&(h=_D(e,t,h,i)),e.length>80*i){r=b=e[0],v=E=e[1];for(var z=i;z<u;z+=i)M=e[z],D=e[z+1],M<r&&(r=M),D<v&&(v=D),M>b&&(b=M),D>E&&(E=D);L=Math.max(b-r,E-v),L=L!==0?1/L:0}return jh(h,f,i,r,v,L),f}};function P0(e,t,i,l,u){var h,f;if(u===SD(e,t,i,l)>0)for(h=t;h<i;h+=l)f=R0(h,e[h],e[h+1],f);else for(h=i-l;h>=t;h-=l)f=R0(h,e[h],e[h+1],f);return f&&cl(f,f.next)&&(qh(f),f=f.next),f}function Wh(e,t){if(!e)return e;t||(t=e);var i=e,l;do if(l=!1,!i.steiner&&(cl(i,i.next)||cr(i.prev,i,i.next)===0)){if(qh(i),i=t=i.prev,i===i.next)break;l=!0}else i=i.next;while(l||i!==t);return t}function jh(e,t,i,l,u,h,f){if(e){!f&&h&&wD(e,l,u,h);for(var r=e,v,b;e.prev!==e.next;){if(v=e.prev,b=e.next,h?mD(e,l,u,h):fD(e)){t.push(v.i/i),t.push(e.i/i),t.push(b.i/i),qh(e),e=b.next,r=b.next;continue}if(e=b,e===r){f?f===1?(e=gD(e,t,i),jh(e,t,i,l,u,h,2)):f===2&&yD(e,t,i,l,u,h):jh(Wh(e),t,i,l,u,h,1);break}}}}function fD(e){var t=e.prev,i=e,l=e.next;if(cr(t,i,l)>=0)return!1;for(var u=e.next.next;u!==e.prev;){if(Oc(t.x,t.y,i.x,i.y,l.x,l.y,u.x,u.y)&&cr(u.prev,u,u.next)>=0)return!1;u=u.next}return!0}function mD(e,t,i,l){var u=e.prev,h=e,f=e.next;if(cr(u,h,f)>=0)return!1;for(var r=u.x<h.x?u.x<f.x?u.x:f.x:h.x<f.x?h.x:f.x,v=u.y<h.y?u.y<f.y?u.y:f.y:h.y<f.y?h.y:f.y,b=u.x>h.x?u.x>f.x?u.x:f.x:h.x>f.x?h.x:f.x,E=u.y>h.y?u.y>f.y?u.y:f.y:h.y>f.y?h.y:f.y,M=Uy(r,v,t,i,l),D=Uy(b,E,t,i,l),L=e.prevZ,z=e.nextZ;L&&L.z>=M&&z&&z.z<=D;){if(L!==e.prev&&L!==e.next&&Oc(u.x,u.y,h.x,h.y,f.x,f.y,L.x,L.y)&&cr(L.prev,L,L.next)>=0||(L=L.prevZ,z!==e.prev&&z!==e.next&&Oc(u.x,u.y,h.x,h.y,f.x,f.y,z.x,z.y)&&cr(z.prev,z,z.next)>=0))return!1;z=z.nextZ}for(;L&&L.z>=M;){if(L!==e.prev&&L!==e.next&&Oc(u.x,u.y,h.x,h.y,f.x,f.y,L.x,L.y)&&cr(L.prev,L,L.next)>=0)return!1;L=L.prevZ}for(;z&&z.z<=D;){if(z!==e.prev&&z!==e.next&&Oc(u.x,u.y,h.x,h.y,f.x,f.y,z.x,z.y)&&cr(z.prev,z,z.next)>=0)return!1;z=z.nextZ}return!0}function gD(e,t,i){var l=e;do{var u=l.prev,h=l.next.next;!cl(u,h)&&L0(u,l,l.next,h)&&$h(u,h)&&$h(h,u)&&(t.push(u.i/i),t.push(l.i/i),t.push(h.i/i),qh(l),qh(l.next),l=e=h),l=l.next}while(l!==e);return l}function yD(e,t,i,l,u,h){var f=e;do{for(var r=f.next.next;r!==f.prev;){if(f.i!==r.i&&ED(f,r)){var v=I0(f,r);f=Wh(f,f.next),v=Wh(v,v.next),jh(f,t,i,l,u,h),jh(v,t,i,l,u,h);return}r=r.next}f=f.next}while(f!==e)}function _D(e,t,i,l){var u=[],h,f,r,v,b;for(h=0,f=t.length;h<f;h++)r=t[h]*l,v=h<f-1?t[h+1]*l:e.length,b=P0(e,r,v,l,!1),b===b.next&&(b.steiner=!0),u.push(TD(b));for(u.sort(vD),h=0;h<u.length;h++)xD(u[h],i),i=Wh(i,i.next);return i}function vD(e,t){return e.x-t.x}function xD(e,t){if(t=bD(e,t),t){var i=I0(t,e);Wh(i,i.next)}}function bD(e,t){var i=t,l=e.x,u=e.y,h=-1/0,f;do{if(u<=i.y&&u>=i.next.y&&i.next.y!==i.y){var r=i.x+(u-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(r<=l&&r>h){if(h=r,r===l){if(u===i.y)return i;if(u===i.next.y)return i.next}f=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!f)return null;if(l===h)return f.prev;var v=f,b=f.x,E=f.y,M=1/0,D;for(i=f.next;i!==v;)l>=i.x&&i.x>=b&&l!==i.x&&Oc(u<E?l:h,u,b,E,u<E?h:l,u,i.x,i.y)&&(D=Math.abs(u-i.y)/(l-i.x),(D<M||D===M&&i.x>f.x)&&$h(i,e)&&(f=i,M=D)),i=i.next;return f}function wD(e,t,i,l){var u=e;do u.z===null&&(u.z=Uy(u.x,u.y,t,i,l)),u.prevZ=u.prev,u.nextZ=u.next,u=u.next;while(u!==e);u.prevZ.nextZ=null,u.prevZ=null,MD(u)}function MD(e){var t,i,l,u,h,f,r,v,b=1;do{for(i=e,e=null,h=null,f=0;i;){for(f++,l=i,r=0,t=0;t<b&&(r++,l=l.nextZ,!!l);t++);for(v=b;r>0||v>0&&l;)r!==0&&(v===0||!l||i.z<=l.z)?(u=i,i=i.nextZ,r--):(u=l,l=l.nextZ,v--),h?h.nextZ=u:e=u,u.prevZ=h,h=u;i=l}h.nextZ=null,b*=2}while(f>1);return e}function Uy(e,t,i,l,u){return e=32767*(e-i)*u,t=32767*(t-l)*u,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,e|t<<1}function TD(e){var t=e,i=e;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==e);return i}function Oc(e,t,i,l,u,h,f,r){return(u-f)*(t-r)-(e-f)*(h-r)>=0&&(e-f)*(l-r)-(i-f)*(t-r)>=0&&(i-f)*(h-r)-(u-f)*(l-r)>=0}function ED(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!CD(e,t)&&$h(e,t)&&$h(t,e)&&AD(e,t)}function cr(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function cl(e,t){return e.x===t.x&&e.y===t.y}function L0(e,t,i,l){return cl(e,i)&&cl(t,l)||cl(e,l)&&cl(i,t)?!0:cr(e,t,i)>0!=cr(e,t,l)>0&&cr(i,l,e)>0!=cr(i,l,t)>0}function CD(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&L0(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}function $h(e,t){return cr(e.prev,e,e.next)<0?cr(e,t,e.next)>=0&&cr(e,e.prev,t)>=0:cr(e,t,e.prev)<0||cr(e,e.next,t)<0}function AD(e,t){var i=e,l=!1,u=(e.x+t.x)/2,h=(e.y+t.y)/2;do i.y>h!=i.next.y>h&&i.next.y!==i.y&&u<(i.next.x-i.x)*(h-i.y)/(i.next.y-i.y)+i.x&&(l=!l),i=i.next;while(i!==e);return l}function I0(e,t){var i=new Vy(e.i,e.x,e.y),l=new Vy(t.i,t.x,t.y),u=e.next,h=t.prev;return e.next=t,t.prev=e,i.next=u,u.prev=i,l.next=i,i.prev=l,h.next=l,l.prev=h,l}function R0(e,t,i,l){var u=new Vy(e,t,i);return l?(u.next=l.next,u.prev=l,l.next.prev=u,l.next=u):(u.prev=u,u.next=u),u}function qh(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Vy(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function SD(e,t,i,l){for(var u=0,h=t,f=i-l;h<i;h+=l)u+=(e[f]-e[h])*(e[h+1]+e[f+1]),f=h;return u}var ls={area:function(e){for(var t=e.length,i=0,l=t-1,u=0;u<t;l=u++)i+=e[l].x*e[u].y-e[u].x*e[l].y;return i*.5},isClockWise:function(e){return ls.area(e)<0},triangulateShape:function(e,t){var i=[],l=[],u=[];z0(e),k0(i,e);var h=e.length;t.forEach(z0);for(var f=0;f<t.length;f++)l.push(h),h+=t[f].length,k0(i,t[f]);for(var r=pD.triangulate(i,l),f=0;f<r.length;f+=3)u.push(r.slice(f,f+3));return u}};function z0(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function k0(e,t){for(var i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}function Nc(e,t){Fn.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new ka(e,t)),this.mergeVertices()}Nc.prototype=Object.create(Fn.prototype),Nc.prototype.constructor=Nc,Nc.prototype.toJSON=function(){var e=Fn.prototype.toJSON.call(this),t=this.parameters.shapes,i=this.parameters.options;return B0(t,i,e)};function ka(e,t){vn.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];for(var i=this,l=[],u=[],h=0,f=e.length;h<f;h++){var r=e[h];v(r)}this.setAttribute("position",new ln(l,3)),this.setAttribute("uv",new ln(u,2)),this.computeVertexNormals();function v(b){var E=[],M=t.curveSegments!==void 0?t.curveSegments:12,D=t.steps!==void 0?t.steps:1,L=t.depth!==void 0?t.depth:100,z=t.bevelEnabled!==void 0?t.bevelEnabled:!0,k=t.bevelThickness!==void 0?t.bevelThickness:6,F=t.bevelSize!==void 0?t.bevelSize:k-2,G=t.bevelOffset!==void 0?t.bevelOffset:0,X=t.bevelSegments!==void 0?t.bevelSegments:3,re=t.extrudePath,ue=t.UVGenerator!==void 0?t.UVGenerator:DD;t.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),L=t.amount);var $,te=!1,oe,ie,se,pe;re&&($=re.getSpacedPoints(D),te=!0,z=!1,oe=re.computeFrenetFrames(D,!1),ie=new Se,se=new Se,pe=new Se),z||(X=0,k=0,F=0,G=0);var me,he,Ue,Ve=b.extractPoints(M),$e=Ve.shape,ct=Ve.holes,At=!ls.isClockWise($e);if(At)for($e=$e.reverse(),he=0,Ue=ct.length;he<Ue;he++)me=ct[he],ls.isClockWise(me)&&(ct[he]=me.reverse());var yt=ls.triangulateShape($e,ct),St=$e;for(he=0,Ue=ct.length;he<Ue;he++)me=ct[he],$e=$e.concat(me);function It(Ht,sn,Zt){return sn||console.error("THREE.ExtrudeGeometry: vec does not exist"),sn.clone().multiplyScalar(Zt).add(Ht)}var Nt,Ie,xe,He,Ge,ze=$e.length,rt,fe=yt.length;function Ee(Ht,sn,Zt){var Ze,Ut,en,Dn=Ht.x-sn.x,fn=Ht.y-sn.y,On=Zt.x-Ht.x,Gn=Zt.y-Ht.y,qn=Dn*Dn+fn*fn,Wi=Dn*Gn-fn*On;if(Math.abs(Wi)>Number.EPSILON){var Nn=Math.sqrt(qn),Si=Math.sqrt(On*On+Gn*Gn),ei=sn.x-fn/Nn,Ki=sn.y+Dn/Nn,_i=Zt.x-Gn/Si,Hr=Zt.y+On/Si,ki=((_i-ei)*Gn-(Hr-Ki)*On)/(Dn*Gn-fn*On);Ze=ei+Dn*ki-Ht.x,Ut=Ki+fn*ki-Ht.y;var Wr=Ze*Ze+Ut*Ut;if(Wr<=2)return new Lt(Ze,Ut);en=Math.sqrt(Wr/2)}else{var Cr=!1;Dn>Number.EPSILON?On>Number.EPSILON&&(Cr=!0):Dn<-Number.EPSILON?On<-Number.EPSILON&&(Cr=!0):Math.sign(fn)===Math.sign(Gn)&&(Cr=!0),Cr?(Ze=-fn,Ut=Dn,en=Math.sqrt(qn)):(Ze=Dn,Ut=fn,en=Math.sqrt(qn/2))}return new Lt(Ze/en,Ut/en)}for(var Ce=[],ye=0,Oe=St.length,Ke=Oe-1,st=ye+1;ye<Oe;ye++,Ke++,st++)Ke===Oe&&(Ke=0),st===Oe&&(st=0),Ce[ye]=Ee(St[ye],St[Ke],St[st]);var wt=[],Gt,de=Ce.concat();for(he=0,Ue=ct.length;he<Ue;he++){for(me=ct[he],Gt=[],ye=0,Oe=me.length,Ke=Oe-1,st=ye+1;ye<Oe;ye++,Ke++,st++)Ke===Oe&&(Ke=0),st===Oe&&(st=0),Gt[ye]=Ee(me[ye],me[Ke],me[st]);wt.push(Gt),de=de.concat(Gt)}for(Nt=0;Nt<X;Nt++){for(xe=Nt/X,He=k*Math.cos(xe*Math.PI/2),Ie=F*Math.sin(xe*Math.PI/2)+G,ye=0,Oe=St.length;ye<Oe;ye++)Ge=It(St[ye],Ce[ye],Ie),hn(Ge.x,Ge.y,-He);for(he=0,Ue=ct.length;he<Ue;he++)for(me=ct[he],Gt=wt[he],ye=0,Oe=me.length;ye<Oe;ye++)Ge=It(me[ye],Gt[ye],Ie),hn(Ge.x,Ge.y,-He)}for(Ie=F+G,ye=0;ye<ze;ye++)Ge=z?It($e[ye],de[ye],Ie):$e[ye],te?(se.copy(oe.normals[0]).multiplyScalar(Ge.x),ie.copy(oe.binormals[0]).multiplyScalar(Ge.y),pe.copy($[0]).add(se).add(ie),hn(pe.x,pe.y,pe.z)):hn(Ge.x,Ge.y,0);var we;for(we=1;we<=D;we++)for(ye=0;ye<ze;ye++)Ge=z?It($e[ye],de[ye],Ie):$e[ye],te?(se.copy(oe.normals[we]).multiplyScalar(Ge.x),ie.copy(oe.binormals[we]).multiplyScalar(Ge.y),pe.copy($[we]).add(se).add(ie),hn(pe.x,pe.y,pe.z)):hn(Ge.x,Ge.y,L/D*we);for(Nt=X-1;Nt>=0;Nt--){for(xe=Nt/X,He=k*Math.cos(xe*Math.PI/2),Ie=F*Math.sin(xe*Math.PI/2)+G,ye=0,Oe=St.length;ye<Oe;ye++)Ge=It(St[ye],Ce[ye],Ie),hn(Ge.x,Ge.y,L+He);for(he=0,Ue=ct.length;he<Ue;he++)for(me=ct[he],Gt=wt[he],ye=0,Oe=me.length;ye<Oe;ye++)Ge=It(me[ye],Gt[ye],Ie),te?hn(Ge.x,Ge.y+$[D-1].y,$[D-1].x+He):hn(Ge.x,Ge.y,L+He)}bt(),gt();function bt(){var Ht=l.length/3;if(z){var sn=0,Zt=ze*sn;for(ye=0;ye<fe;ye++)rt=yt[ye],nn(rt[2]+Zt,rt[1]+Zt,rt[0]+Zt);for(sn=D+X*2,Zt=ze*sn,ye=0;ye<fe;ye++)rt=yt[ye],nn(rt[0]+Zt,rt[1]+Zt,rt[2]+Zt)}else{for(ye=0;ye<fe;ye++)rt=yt[ye],nn(rt[2],rt[1],rt[0]);for(ye=0;ye<fe;ye++)rt=yt[ye],nn(rt[0]+ze*D,rt[1]+ze*D,rt[2]+ze*D)}i.addGroup(Ht,l.length/3-Ht,0)}function gt(){var Ht=l.length/3,sn=0;for(bn(St,sn),sn+=St.length,he=0,Ue=ct.length;he<Ue;he++)me=ct[he],bn(me,sn),sn+=me.length;i.addGroup(Ht,l.length/3-Ht,1)}function bn(Ht,sn){var Zt,Ze;for(ye=Ht.length;--ye>=0;){Zt=ye,Ze=ye-1,Ze<0&&(Ze=Ht.length-1);var Ut=0,en=D+X*2;for(Ut=0;Ut<en;Ut++){var Dn=ze*Ut,fn=ze*(Ut+1),On=sn+Zt+Dn,Gn=sn+Ze+Dn,qn=sn+Ze+fn,Wi=sn+Zt+fn;pn(On,Gn,qn,Wi)}}}function hn(Ht,sn,Zt){E.push(Ht),E.push(sn),E.push(Zt)}function nn(Ht,sn,Zt){wn(Ht),wn(sn),wn(Zt);var Ze=l.length/3,Ut=ue.generateTopUV(i,l,Ze-3,Ze-2,Ze-1);cn(Ut[0]),cn(Ut[1]),cn(Ut[2])}function pn(Ht,sn,Zt,Ze){wn(Ht),wn(sn),wn(Ze),wn(sn),wn(Zt),wn(Ze);var Ut=l.length/3,en=ue.generateSideWallUV(i,l,Ut-6,Ut-3,Ut-2,Ut-1);cn(en[0]),cn(en[1]),cn(en[3]),cn(en[1]),cn(en[2]),cn(en[3])}function wn(Ht){l.push(E[Ht*3+0]),l.push(E[Ht*3+1]),l.push(E[Ht*3+2])}function cn(Ht){u.push(Ht.x),u.push(Ht.y)}}}ka.prototype=Object.create(vn.prototype),ka.prototype.constructor=ka,ka.prototype.toJSON=function(){var e=vn.prototype.toJSON.call(this),t=this.parameters.shapes,i=this.parameters.options;return B0(t,i,e)};var DD={generateTopUV:function(e,t,i,l,u){var h=t[i*3],f=t[i*3+1],r=t[l*3],v=t[l*3+1],b=t[u*3],E=t[u*3+1];return[new Lt(h,f),new Lt(r,v),new Lt(b,E)]},generateSideWallUV:function(e,t,i,l,u,h){var f=t[i*3],r=t[i*3+1],v=t[i*3+2],b=t[l*3],E=t[l*3+1],M=t[l*3+2],D=t[u*3],L=t[u*3+1],z=t[u*3+2],k=t[h*3],F=t[h*3+1],G=t[h*3+2];return Math.abs(r-E)<.01?[new Lt(f,1-v),new Lt(b,1-M),new Lt(D,1-z),new Lt(k,1-G)]:[new Lt(r,1-v),new Lt(E,1-M),new Lt(L,1-z),new Lt(F,1-G)]}};function B0(e,t,i){if(i.shapes=[],Array.isArray(e))for(var l=0,u=e.length;l<u;l++){var h=e[l];i.shapes.push(h.uuid)}else i.shapes.push(e.uuid);return t.extrudePath!==void 0&&(i.options.extrudePath=t.extrudePath.toJSON()),i}function Hf(e,t){Fn.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new Zh(e,t)),this.mergeVertices()}Hf.prototype=Object.create(Fn.prototype),Hf.prototype.constructor=Hf;function Zh(e,t){t=t||{};var i=t.font;if(!(i&&i.isFont))return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Fn;var l=i.generateShapes(e,t.size);t.depth=t.height!==void 0?t.height:50,t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1),ka.call(this,l,t),this.type="TextBufferGeometry"}Zh.prototype=Object.create(ka.prototype),Zh.prototype.constructor=Zh;function Wf(e,t,i,l,u,h,f){Fn.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:l,phiLength:u,thetaStart:h,thetaLength:f},this.fromBufferGeometry(new Uc(e,t,i,l,u,h,f)),this.mergeVertices()}Wf.prototype=Object.create(Fn.prototype),Wf.prototype.constructor=Wf;function Uc(e,t,i,l,u,h,f){vn.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:l,phiLength:u,thetaStart:h,thetaLength:f},e=e||1,t=Math.max(3,Math.floor(t)||8),i=Math.max(2,Math.floor(i)||6),l=l!==void 0?l:0,u=u!==void 0?u:Math.PI*2,h=h!==void 0?h:0,f=f!==void 0?f:Math.PI;var r=Math.min(h+f,Math.PI),v,b,E=0,M=[],D=new Se,L=new Se,z=[],k=[],F=[],G=[];for(b=0;b<=i;b++){var X=[],re=b/i,ue=0;for(b==0&&h==0?ue=.5/t:b==i&&r==Math.PI&&(ue=-.5/t),v=0;v<=t;v++){var $=v/t;D.x=-e*Math.cos(l+$*u)*Math.sin(h+re*f),D.y=e*Math.cos(h+re*f),D.z=e*Math.sin(l+$*u)*Math.sin(h+re*f),k.push(D.x,D.y,D.z),L.copy(D).normalize(),F.push(L.x,L.y,L.z),G.push($+ue,1-re),X.push(E++)}M.push(X)}for(b=0;b<i;b++)for(v=0;v<t;v++){var te=M[b][v+1],oe=M[b][v],ie=M[b+1][v],se=M[b+1][v+1];(b!==0||h>0)&&z.push(te,oe,se),(b!==i-1||r<Math.PI)&&z.push(oe,ie,se)}this.setIndex(z),this.setAttribute("position",new ln(k,3)),this.setAttribute("normal",new ln(F,3)),this.setAttribute("uv",new ln(G,2))}Uc.prototype=Object.create(vn.prototype),Uc.prototype.constructor=Uc;function jf(e,t,i,l,u,h){Fn.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:l,thetaStart:u,thetaLength:h},this.fromBufferGeometry(new Xh(e,t,i,l,u,h)),this.mergeVertices()}jf.prototype=Object.create(Fn.prototype),jf.prototype.constructor=jf;function Xh(e,t,i,l,u,h){vn.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:l,thetaStart:u,thetaLength:h},e=e||.5,t=t||1,u=u!==void 0?u:0,h=h!==void 0?h:Math.PI*2,i=i!==void 0?Math.max(3,i):8,l=l!==void 0?Math.max(1,l):1;var f=[],r=[],v=[],b=[],E,M=e,D=(t-e)/l,L=new Se,z=new Lt,k,F;for(k=0;k<=l;k++){for(F=0;F<=i;F++)E=u+F/i*h,L.x=M*Math.cos(E),L.y=M*Math.sin(E),r.push(L.x,L.y,L.z),v.push(0,0,1),z.x=(L.x/t+1)/2,z.y=(L.y/t+1)/2,b.push(z.x,z.y);M+=D}for(k=0;k<l;k++){var G=k*(i+1);for(F=0;F<i;F++){E=F+G;var X=E,re=E+i+1,ue=E+i+2,$=E+1;f.push(X,re,$),f.push(re,ue,$)}}this.setIndex(f),this.setAttribute("position",new ln(r,3)),this.setAttribute("normal",new ln(v,3)),this.setAttribute("uv",new ln(b,2))}Xh.prototype=Object.create(vn.prototype),Xh.prototype.constructor=Xh;function $f(e,t,i,l){Fn.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:l},this.fromBufferGeometry(new Yh(e,t,i,l)),this.mergeVertices()}$f.prototype=Object.create(Fn.prototype),$f.prototype.constructor=$f;function Yh(e,t,i,l){vn.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:l},t=Math.floor(t)||12,i=i||0,l=l||Math.PI*2,l=Wn.clamp(l,0,Math.PI*2);var u=[],h=[],f=[],r,v=1/t,b=new Se,E=new Lt,M,D;for(M=0;M<=t;M++){var L=i+M*v*l,z=Math.sin(L),k=Math.cos(L);for(D=0;D<=e.length-1;D++)b.x=e[D].x*z,b.y=e[D].y,b.z=e[D].x*k,h.push(b.x,b.y,b.z),E.x=M/t,E.y=D/(e.length-1),f.push(E.x,E.y)}for(M=0;M<t;M++)for(D=0;D<e.length-1;D++){r=D+M*e.length;var F=r,G=r+e.length,X=r+e.length+1,re=r+1;u.push(F,G,re),u.push(G,X,re)}if(this.setIndex(u),this.setAttribute("position",new ln(h,3)),this.setAttribute("uv",new ln(f,2)),this.computeVertexNormals(),l===Math.PI*2){var ue=this.attributes.normal.array,$=new Se,te=new Se,oe=new Se;for(r=t*e.length*3,M=0,D=0;M<e.length;M++,D+=3)$.x=ue[D+0],$.y=ue[D+1],$.z=ue[D+2],te.x=ue[r+D+0],te.y=ue[r+D+1],te.z=ue[r+D+2],oe.addVectors($,te).normalize(),ue[D+0]=ue[r+D+0]=oe.x,ue[D+1]=ue[r+D+1]=oe.y,ue[D+2]=ue[r+D+2]=oe.z}}Yh.prototype=Object.create(vn.prototype),Yh.prototype.constructor=Yh;function Vc(e,t){Fn.call(this),this.type="ShapeGeometry",typeof t=="object"&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new Gc(e,t)),this.mergeVertices()}Vc.prototype=Object.create(Fn.prototype),Vc.prototype.constructor=Vc,Vc.prototype.toJSON=function(){var e=Fn.prototype.toJSON.call(this),t=this.parameters.shapes;return F0(t,e)};function Gc(e,t){vn.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var i=[],l=[],u=[],h=[],f=0,r=0;if(Array.isArray(e)===!1)b(e);else for(var v=0;v<e.length;v++)b(e[v]),this.addGroup(f,r,v),f+=r,r=0;this.setIndex(i),this.setAttribute("position",new ln(l,3)),this.setAttribute("normal",new ln(u,3)),this.setAttribute("uv",new ln(h,2));function b(E){var M,D,L,z=l.length/3,k=E.extractPoints(t),F=k.shape,G=k.holes;for(ls.isClockWise(F)===!1&&(F=F.reverse()),M=0,D=G.length;M<D;M++)L=G[M],ls.isClockWise(L)===!0&&(G[M]=L.reverse());var X=ls.triangulateShape(F,G);for(M=0,D=G.length;M<D;M++)L=G[M],F=F.concat(L);for(M=0,D=F.length;M<D;M++){var re=F[M];l.push(re.x,re.y,0),u.push(0,0,1),h.push(re.x,re.y)}for(M=0,D=X.length;M<D;M++){var ue=X[M],$=ue[0]+z,te=ue[1]+z,oe=ue[2]+z;i.push($,te,oe),r+=3}}}Gc.prototype=Object.create(vn.prototype),Gc.prototype.constructor=Gc,Gc.prototype.toJSON=function(){var e=vn.prototype.toJSON.call(this),t=this.parameters.shapes;return F0(t,e)};function F0(e,t){if(t.shapes=[],Array.isArray(e))for(var i=0,l=e.length;i<l;i++){var u=e[i];t.shapes.push(u.uuid)}else t.shapes.push(e.uuid);return t}function qf(e,t){vn.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=t!==void 0?t:1;var i=[],l=Math.cos(Wn.DEG2RAD*t),u=[0,0],h={},f,r,v,b=["a","b","c"],E;e.isBufferGeometry?(E=new Fn,E.fromBufferGeometry(e)):E=e.clone(),E.mergeVertices(),E.computeFaceNormals();for(var M=E.vertices,D=E.faces,L=0,z=D.length;L<z;L++)for(var k=D[L],F=0;F<3;F++)f=k[b[F]],r=k[b[(F+1)%3]],u[0]=Math.min(f,r),u[1]=Math.max(f,r),v=u[0]+","+u[1],h[v]===void 0?h[v]={index1:u[0],index2:u[1],face1:L,face2:void 0}:h[v].face2=L;for(v in h){var G=h[v];if(G.face2===void 0||D[G.face1].normal.dot(D[G.face2].normal)<=l){var X=M[G.index1];i.push(X.x,X.y,X.z),X=M[G.index2],i.push(X.x,X.y,X.z)}}this.setAttribute("position",new ln(i,3))}qf.prototype=Object.create(vn.prototype),qf.prototype.constructor=qf;function Hc(e,t,i,l,u,h,f,r){Fn.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:l,heightSegments:u,openEnded:h,thetaStart:f,thetaLength:r},this.fromBufferGeometry(new cs(e,t,i,l,u,h,f,r)),this.mergeVertices()}Hc.prototype=Object.create(Fn.prototype),Hc.prototype.constructor=Hc;function cs(e,t,i,l,u,h,f,r){vn.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:l,heightSegments:u,openEnded:h,thetaStart:f,thetaLength:r};var v=this;e=e!==void 0?e:1,t=t!==void 0?t:1,i=i||1,l=Math.floor(l)||8,u=Math.floor(u)||1,h=h!==void 0?h:!1,f=f!==void 0?f:0,r=r!==void 0?r:Math.PI*2;var b=[],E=[],M=[],D=[],L=0,z=[],k=i/2,F=0;G(),h===!1&&(e>0&&X(!0),t>0&&X(!1)),this.setIndex(b),this.setAttribute("position",new ln(E,3)),this.setAttribute("normal",new ln(M,3)),this.setAttribute("uv",new ln(D,2));function G(){var re,ue,$=new Se,te=new Se,oe=0,ie=(t-e)/i;for(ue=0;ue<=u;ue++){var se=[],pe=ue/u,me=pe*(t-e)+e;for(re=0;re<=l;re++){var he=re/l,Ue=he*r+f,Ve=Math.sin(Ue),$e=Math.cos(Ue);te.x=me*Ve,te.y=-pe*i+k,te.z=me*$e,E.push(te.x,te.y,te.z),$.set(Ve,ie,$e).normalize(),M.push($.x,$.y,$.z),D.push(he,1-pe),se.push(L++)}z.push(se)}for(re=0;re<l;re++)for(ue=0;ue<u;ue++){var ct=z[ue][re],At=z[ue+1][re],yt=z[ue+1][re+1],St=z[ue][re+1];b.push(ct,At,St),b.push(At,yt,St),oe+=6}v.addGroup(F,oe,0),F+=oe}function X(re){var ue,$,te,oe=new Lt,ie=new Se,se=0,pe=re===!0?e:t,me=re===!0?1:-1;for($=L,ue=1;ue<=l;ue++)E.push(0,k*me,0),M.push(0,me,0),D.push(.5,.5),L++;for(te=L,ue=0;ue<=l;ue++){var he=ue/l,Ue=he*r+f,Ve=Math.cos(Ue),$e=Math.sin(Ue);ie.x=pe*$e,ie.y=k*me,ie.z=pe*Ve,E.push(ie.x,ie.y,ie.z),M.push(0,me,0),oe.x=Ve*.5+.5,oe.y=$e*.5*me+.5,D.push(oe.x,oe.y),L++}for(ue=0;ue<l;ue++){var ct=$+ue,At=te+ue;re===!0?b.push(At,At+1,ct):b.push(At+1,At,ct),se+=3}v.addGroup(F,se,re===!0?1:2),F+=se}}cs.prototype=Object.create(vn.prototype),cs.prototype.constructor=cs;function Zf(e,t,i,l,u,h,f){Hc.call(this,0,e,t,i,l,u,h,f),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:l,openEnded:u,thetaStart:h,thetaLength:f}}Zf.prototype=Object.create(Hc.prototype),Zf.prototype.constructor=Zf;function Xf(e,t,i,l,u,h,f){cs.call(this,0,e,t,i,l,u,h,f),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:l,openEnded:u,thetaStart:h,thetaLength:f}}Xf.prototype=Object.create(cs.prototype),Xf.prototype.constructor=Xf;function Yf(e,t,i,l){Fn.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:l},this.fromBufferGeometry(new Jh(e,t,i,l)),this.mergeVertices()}Yf.prototype=Object.create(Fn.prototype),Yf.prototype.constructor=Yf;function Jh(e,t,i,l){vn.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:l},e=e||1,t=t!==void 0?Math.max(3,t):8,i=i!==void 0?i:0,l=l!==void 0?l:Math.PI*2;var u=[],h=[],f=[],r=[],v,b,E=new Se,M=new Lt;for(h.push(0,0,0),f.push(0,0,1),r.push(.5,.5),b=0,v=3;b<=t;b++,v+=3){var D=i+b/t*l;E.x=e*Math.cos(D),E.y=e*Math.sin(D),h.push(E.x,E.y,E.z),f.push(0,0,1),M.x=(h[v]/e+1)/2,M.y=(h[v+1]/e+1)/2,r.push(M.x,M.y)}for(v=1;v<=t;v++)u.push(v,v+1,0);this.setIndex(u),this.setAttribute("position",new ln(h,3)),this.setAttribute("normal",new ln(f,3)),this.setAttribute("uv",new ln(r,2))}Jh.prototype=Object.create(vn.prototype),Jh.prototype.constructor=Jh;var Tr=Object.freeze({__proto__:null,WireframeGeometry:Rf,ParametricGeometry:zf,ParametricBufferGeometry:Oh,TetrahedronGeometry:Bf,TetrahedronBufferGeometry:Nh,OctahedronGeometry:Ff,OctahedronBufferGeometry:Bc,IcosahedronGeometry:Of,IcosahedronBufferGeometry:Uh,DodecahedronGeometry:Nf,DodecahedronBufferGeometry:Vh,PolyhedronGeometry:kf,PolyhedronBufferGeometry:so,TubeGeometry:Uf,TubeBufferGeometry:Fc,TorusKnotGeometry:Vf,TorusKnotBufferGeometry:Gh,TorusGeometry:Gf,TorusBufferGeometry:Hh,TextGeometry:Hf,TextBufferGeometry:Zh,SphereGeometry:Wf,SphereBufferGeometry:Uc,RingGeometry:jf,RingBufferGeometry:Xh,PlaneGeometry:gf,PlaneBufferGeometry:Dc,LatheGeometry:$f,LatheBufferGeometry:Yh,ShapeGeometry:Vc,ShapeBufferGeometry:Gc,ExtrudeGeometry:Nc,ExtrudeBufferGeometry:ka,EdgesGeometry:qf,ConeGeometry:Zf,ConeBufferGeometry:Xf,CylinderGeometry:Hc,CylinderBufferGeometry:cs,CircleGeometry:Yf,CircleBufferGeometry:Jh,BoxGeometry:_E,BoxBufferGeometry:ff});function Wc(e){Rn.call(this),this.type="ShadowMaterial",this.color=new tn(0),this.transparent=!0,this.setValues(e)}Wc.prototype=Object.create(Rn.prototype),Wc.prototype.constructor=Wc,Wc.prototype.isShadowMaterial=!0,Wc.prototype.copy=function(e){return Rn.prototype.copy.call(this,e),this.color.copy(e.color),this};function us(e){Nr.call(this,e),this.type="RawShaderMaterial"}us.prototype=Object.create(Nr.prototype),us.prototype.constructor=us,us.prototype.isRawShaderMaterial=!0;function Ur(e){Rn.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new tn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new tn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ys,this.normalScale=new Lt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}Ur.prototype=Object.create(Rn.prototype),Ur.prototype.constructor=Ur,Ur.prototype.isMeshStandardMaterial=!0,Ur.prototype.copy=function(e){return Rn.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this};function jc(e){Ur.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearcoat=0,this.clearcoatRoughness=0,this.sheen=null,this.clearcoatNormalScale=new Lt(1,1),this.clearcoatNormalMap=null,this.transparency=0,this.setValues(e)}jc.prototype=Object.create(Ur.prototype),jc.prototype.constructor=jc,jc.prototype.isMeshPhysicalMaterial=!0,jc.prototype.copy=function(e){return Ur.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearcoat=e.clearcoat,this.clearcoatRoughness=e.clearcoatRoughness,e.sheen?this.sheen=(this.sheen||new tn).copy(e.sheen):this.sheen=null,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.transparency=e.transparency,this};function ul(e){Rn.call(this),this.type="MeshPhongMaterial",this.color=new tn(16777215),this.specular=new tn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new tn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ys,this.normalScale=new Lt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Hp,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}ul.prototype=Object.create(Rn.prototype),ul.prototype.constructor=ul,ul.prototype.isMeshPhongMaterial=!0,ul.prototype.copy=function(e){return Rn.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this};function $c(e){Rn.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new tn(16777215),this.specular=new tn(1118481),this.shininess=30,this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new tn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ys,this.normalScale=new Lt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}$c.prototype=Object.create(Rn.prototype),$c.prototype.constructor=$c,$c.prototype.isMeshToonMaterial=!0,$c.prototype.copy=function(e){return Rn.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this};function qc(e){Rn.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ys,this.normalScale=new Lt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}qc.prototype=Object.create(Rn.prototype),qc.prototype.constructor=qc,qc.prototype.isMeshNormalMaterial=!0,qc.prototype.copy=function(e){return Rn.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this};function Zc(e){Rn.call(this),this.type="MeshLambertMaterial",this.color=new tn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new tn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Hp,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}Zc.prototype=Object.create(Rn.prototype),Zc.prototype.constructor=Zc,Zc.prototype.isMeshLambertMaterial=!0,Zc.prototype.copy=function(e){return Rn.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this};function Xc(e){Rn.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new tn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ys,this.normalScale=new Lt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}Xc.prototype=Object.create(Rn.prototype),Xc.prototype.constructor=Xc,Xc.prototype.isMeshMatcapMaterial=!0,Xc.prototype.copy=function(e){return Rn.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this};function Yc(e){Ri.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}Yc.prototype=Object.create(Ri.prototype),Yc.prototype.constructor=Yc,Yc.prototype.isLineDashedMaterial=!0,Yc.prototype.copy=function(e){return Ri.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var PD=Object.freeze({__proto__:null,ShadowMaterial:Wc,SpriteMaterial:ll,RawShaderMaterial:us,ShaderMaterial:Nr,PointsMaterial:ss,MeshPhysicalMaterial:jc,MeshStandardMaterial:Ur,MeshPhongMaterial:ul,MeshToonMaterial:$c,MeshNormalMaterial:qc,MeshLambertMaterial:Zc,MeshDepthMaterial:rl,MeshDistanceMaterial:ol,MeshBasicMaterial:lr,MeshMatcapMaterial:Xc,LineDashedMaterial:Yc,LineBasicMaterial:Ri,Material:Rn}),Gi={arraySlice:function(e,t,i){return Gi.isTypedArray(e)?new e.constructor(e.subarray(t,i!==void 0?i:e.length)):e.slice(t,i)},convertArray:function(e,t,i){return!e||!i&&e.constructor===t?e:typeof t.BYTES_PER_ELEMENT=="number"?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){function t(h,f){return e[h]-e[f]}for(var i=e.length,l=new Array(i),u=0;u!==i;++u)l[u]=u;return l.sort(t),l},sortedArray:function(e,t,i){for(var l=e.length,u=new e.constructor(l),h=0,f=0;f!==l;++h)for(var r=i[h]*t,v=0;v!==t;++v)u[f++]=e[r+v];return u},flattenJSON:function(e,t,i,l){for(var u=1,h=e[0];h!==void 0&&h[l]===void 0;)h=e[u++];if(h!==void 0){var f=h[l];if(f!==void 0)if(Array.isArray(f))do f=h[l],f!==void 0&&(t.push(h.time),i.push.apply(i,f)),h=e[u++];while(h!==void 0);else if(f.toArray!==void 0)do f=h[l],f!==void 0&&(t.push(h.time),f.toArray(i,i.length)),h=e[u++];while(h!==void 0);else do f=h[l],f!==void 0&&(t.push(h.time),i.push(f)),h=e[u++];while(h!==void 0)}},subclip:function(e,t,i,l,u){u=u||30;var h=e.clone();h.name=t;for(var f=[],r=0;r<h.tracks.length;++r){for(var v=h.tracks[r],b=v.getValueSize(),E=[],M=[],D=0;D<v.times.length;++D){var L=v.times[D]*u;if(!(L<i||L>=l)){E.push(v.times[D]);for(var z=0;z<b;++z)M.push(v.values[D*b+z])}}E.length!==0&&(v.times=Gi.convertArray(E,v.times.constructor),v.values=Gi.convertArray(M,v.values.constructor),f.push(v))}h.tracks=f;for(var k=1/0,r=0;r<h.tracks.length;++r)k>h.tracks[r].times[0]&&(k=h.tracks[r].times[0]);for(var r=0;r<h.tracks.length;++r)h.tracks[r].shift(-1*k);return h.resetDuration(),h}};function Vr(e,t,i,l){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=l!==void 0?l:new t.constructor(i),this.sampleValues=t,this.valueSize=i}Object.assign(Vr.prototype,{evaluate:function(e){var t=this.parameterPositions,i=this._cachedIndex,l=t[i],u=t[i-1];e:{t:{var h;n:{i:if(!(e<l)){for(var f=i+2;;){if(l===void 0){if(e<u)break i;return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,e,u)}if(i===f)break;if(u=l,l=t[++i],e<l)break t}h=t.length;break n}if(!(e>=u)){var r=t[1];e<r&&(i=2,u=r);for(var f=i-2;;){if(u===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,l);if(i===f)break;if(l=u,u=t[--i-1],e>=u)break t}h=i,i=0;break n}break e}for(;i<h;){var v=i+h>>>1;e<t[v]?h=v:i=v+1}if(l=t[i],u=t[i-1],u===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,l);if(l===void 0)return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,u,e)}this._cachedIndex=i,this.intervalChanged_(i,u,l)}return this.interpolate_(i,u,e,l)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,i=this.sampleValues,l=this.valueSize,u=e*l,h=0;h!==l;++h)t[h]=i[u+h];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}});//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(Vr.prototype,{beforeStart_:Vr.prototype.copySampleValue_,afterEnd_:Vr.prototype.copySampleValue_});function Gy(e,t,i,l){Vr.call(this,e,t,i,l),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}Gy.prototype=Object.assign(Object.create(Vr.prototype),{constructor:Gy,DefaultSettings_:{endingStart:sc,endingEnd:sc},intervalChanged_:function(e,t,i){var l=this.parameterPositions,u=e-2,h=e+1,f=l[u],r=l[h];if(f===void 0)switch(this.getSettings_().endingStart){case lc:u=e,f=2*t-i;break;case Yp:u=l.length-2,f=t+l[u]-l[u+1];break;default:u=e,f=i}if(r===void 0)switch(this.getSettings_().endingEnd){case lc:h=e,r=2*i-t;break;case Yp:h=1,r=i+l[1]-l[0];break;default:h=e-1,r=t}var v=(i-t)*.5,b=this.valueSize;this._weightPrev=v/(t-f),this._weightNext=v/(r-i),this._offsetPrev=u*b,this._offsetNext=h*b},interpolate_:function(e,t,i,l){for(var u=this.resultBuffer,h=this.sampleValues,f=this.valueSize,r=e*f,v=r-f,b=this._offsetPrev,E=this._offsetNext,M=this._weightPrev,D=this._weightNext,L=(i-t)/(l-t),z=L*L,k=z*L,F=-M*k+2*M*z-M*L,G=(1+M)*k+(-1.5-2*M)*z+(-.5+M)*L+1,X=(-1-D)*k+(1.5+D)*z+.5*L,re=D*k-D*z,ue=0;ue!==f;++ue)u[ue]=F*h[b+ue]+G*h[v+ue]+X*h[r+ue]+re*h[E+ue];return u}});function Jf(e,t,i,l){Vr.call(this,e,t,i,l)}Jf.prototype=Object.assign(Object.create(Vr.prototype),{constructor:Jf,interpolate_:function(e,t,i,l){for(var u=this.resultBuffer,h=this.sampleValues,f=this.valueSize,r=e*f,v=r-f,b=(i-t)/(l-t),E=1-b,M=0;M!==f;++M)u[M]=h[v+M]*E+h[r+M]*b;return u}});function Hy(e,t,i,l){Vr.call(this,e,t,i,l)}Hy.prototype=Object.assign(Object.create(Vr.prototype),{constructor:Hy,interpolate_:function(e){return this.copySampleValue_(e-1)}});function fr(e,t,i,l){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Gi.convertArray(t,this.TimeBufferType),this.values=Gi.convertArray(i,this.ValueBufferType),this.setInterpolation(l||this.DefaultInterpolation)}Object.assign(fr,{toJSON:function(e){var t=e.constructor,i;if(t.toJSON!==void 0)i=t.toJSON(e);else{i={name:e.name,times:Gi.convertArray(e.times,Array),values:Gi.convertArray(e.values,Array)};var l=e.getInterpolation();l!==e.DefaultInterpolation&&(i.interpolation=l)}return i.type=e.ValueTypeName,i}}),Object.assign(fr.prototype,{constructor:fr,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:ac,InterpolantFactoryMethodDiscrete:function(e){return new Hy(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new Jf(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new Gy(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case fh:t=this.InterpolantFactoryMethodDiscrete;break;case ac:t=this.InterpolantFactoryMethodLinear;break;case ey:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){var i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return fh;case this.InterpolantFactoryMethodLinear:return ac;case this.InterpolantFactoryMethodSmooth:return ey}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(e!==0)for(var t=this.times,i=0,l=t.length;i!==l;++i)t[i]+=e;return this},scale:function(e){if(e!==1)for(var t=this.times,i=0,l=t.length;i!==l;++i)t[i]*=e;return this},trim:function(e,t){for(var i=this.times,l=i.length,u=0,h=l-1;u!==l&&i[u]<e;)++u;for(;h!==-1&&i[h]>t;)--h;if(++h,u!==0||h!==l){u>=h&&(h=Math.max(h,1),u=h-1);var f=this.getValueSize();this.times=Gi.arraySlice(i,u,h),this.values=Gi.arraySlice(this.values,u*f,h*f)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var i=this.times,l=this.values,u=i.length;u===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var h=null,f=0;f!==u;f++){var r=i[f];if(typeof r=="number"&&isNaN(r)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,f,r),e=!1;break}if(h!==null&&h>r){console.error("THREE.KeyframeTrack: Out of order keys.",this,f,r,h),e=!1;break}h=r}if(l!==void 0&&Gi.isTypedArray(l))for(var f=0,v=l.length;f!==v;++f){var b=l[f];if(isNaN(b)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,f,b),e=!1;break}}return e},optimize:function(){for(var e=Gi.arraySlice(this.times),t=Gi.arraySlice(this.values),i=this.getValueSize(),l=this.getInterpolation()===ey,u=1,h=e.length-1,f=1;f<h;++f){var r=!1,v=e[f],b=e[f+1];if(v!==b&&(f!==1||v!==v[0]))if(l)r=!0;else for(var E=f*i,M=E-i,D=E+i,L=0;L!==i;++L){var z=t[E+L];if(z!==t[M+L]||z!==t[D+L]){r=!0;break}}if(r){if(f!==u){e[u]=e[f];for(var k=f*i,F=u*i,L=0;L!==i;++L)t[F+L]=t[k+L]}++u}}if(h>0){e[u]=e[h];for(var k=h*i,F=u*i,L=0;L!==i;++L)t[F+L]=t[k+L];++u}return u!==e.length?(this.times=Gi.arraySlice(e,0,u),this.values=Gi.arraySlice(t,0,u*i)):(this.times=e,this.values=t),this},clone:function(){var e=Gi.arraySlice(this.times,0),t=Gi.arraySlice(this.values,0),i=this.constructor,l=new i(this.name,e,t);return l.createInterpolant=this.createInterpolant,l}});function Wy(e,t,i){fr.call(this,e,t,i)}Wy.prototype=Object.assign(Object.create(fr.prototype),{constructor:Wy,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:fh,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});function jy(e,t,i,l){fr.call(this,e,t,i,l)}jy.prototype=Object.assign(Object.create(fr.prototype),{constructor:jy,ValueTypeName:"color"});function Jc(e,t,i,l){fr.call(this,e,t,i,l)}Jc.prototype=Object.assign(Object.create(fr.prototype),{constructor:Jc,ValueTypeName:"number"});function $y(e,t,i,l){Vr.call(this,e,t,i,l)}$y.prototype=Object.assign(Object.create(Vr.prototype),{constructor:$y,interpolate_:function(e,t,i,l){for(var u=this.resultBuffer,h=this.sampleValues,f=this.valueSize,r=e*f,v=(i-t)/(l-t),b=r+f;r!==b;r+=4)Or.slerpFlat(u,0,h,r-f,h,r,v);return u}});function Kh(e,t,i,l){fr.call(this,e,t,i,l)}Kh.prototype=Object.assign(Object.create(fr.prototype),{constructor:Kh,ValueTypeName:"quaternion",DefaultInterpolation:ac,InterpolantFactoryMethodLinear:function(e){return new $y(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0});function qy(e,t,i,l){fr.call(this,e,t,i,l)}qy.prototype=Object.assign(Object.create(fr.prototype),{constructor:qy,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:fh,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});function Kc(e,t,i,l){fr.call(this,e,t,i,l)}Kc.prototype=Object.assign(Object.create(fr.prototype),{constructor:Kc,ValueTypeName:"vector"});function vo(e,t,i){this.name=e,this.tracks=i,this.duration=t!==void 0?t:-1,this.uuid=Wn.generateUUID(),this.duration<0&&this.resetDuration()}function LD(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Jc;case"vector":case"vector2":case"vector3":case"vector4":return Kc;case"color":return jy;case"quaternion":return Kh;case"bool":case"boolean":return Wy;case"string":return qy}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}function ID(e){if(e.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=LD(e.type);if(e.times===void 0){var i=[],l=[];Gi.flattenJSON(e.keys,i,l,"value"),e.times=i,e.values=l}return t.parse!==void 0?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(vo,{parse:function(e){for(var t=[],i=e.tracks,l=1/(e.fps||1),u=0,h=i.length;u!==h;++u)t.push(ID(i[u]).scale(l));return new vo(e.name,e.duration,t)},toJSON:function(e){for(var t=[],i=e.tracks,l={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid},u=0,h=i.length;u!==h;++u)t.push(fr.toJSON(i[u]));return l},CreateFromMorphTargetSequence:function(e,t,i,l){for(var u=t.length,h=[],f=0;f<u;f++){var r=[],v=[];r.push((f+u-1)%u,f,(f+1)%u),v.push(0,1,0);var b=Gi.getKeyframeOrder(r);r=Gi.sortedArray(r,1,b),v=Gi.sortedArray(v,1,b),!l&&r[0]===0&&(r.push(u),v.push(v[0])),h.push(new Jc(".morphTargetInfluences["+t[f].name+"]",r,v).scale(1/i))}return new vo(e,-1,h)},findByName:function(e,t){var i=e;if(!Array.isArray(e)){var l=e;i=l.geometry&&l.geometry.animations||l.animations}for(var u=0;u<i.length;u++)if(i[u].name===t)return i[u];return null},CreateClipsFromMorphTargetSequences:function(e,t,i){for(var l={},u=/^([\w-]*?)([\d]+)$/,h=0,f=e.length;h<f;h++){var r=e[h],v=r.name.match(u);if(v&&v.length>1){var b=v[1],E=l[b];E||(l[b]=E=[]),E.push(r)}}var M=[];for(var b in l)M.push(vo.CreateFromMorphTargetSequence(b,l[b],t,i));return M},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var i=function(re,ue,$,te,oe){if($.length!==0){var ie=[],se=[];Gi.flattenJSON($,ie,se,te),ie.length!==0&&oe.push(new re(ue,ie,se))}},l=[],u=e.name||"default",h=e.length||-1,f=e.fps||30,r=e.hierarchy||[],v=0;v<r.length;v++){var b=r[v].keys;if(!(!b||b.length===0))if(b[0].morphTargets){for(var E={},M=0;M<b.length;M++)if(b[M].morphTargets)for(var D=0;D<b[M].morphTargets.length;D++)E[b[M].morphTargets[D]]=-1;for(var L in E){for(var z=[],k=[],D=0;D!==b[M].morphTargets.length;++D){var F=b[M];z.push(F.time),k.push(F.morphTarget===L?1:0)}l.push(new Jc(".morphTargetInfluence["+L+"]",z,k))}h=E.length*(f||1)}else{var G=".bones["+t[v].name+"]";i(Kc,G+".position",b,"pos",l),i(Kh,G+".quaternion",b,"rot",l),i(Kc,G+".scale",b,"scl",l)}}if(l.length===0)return null;var X=new vo(u,h,l);return X}}),Object.assign(vo.prototype,{resetDuration:function(){for(var e=this.tracks,t=0,i=0,l=e.length;i!==l;++i){var u=this.tracks[i];t=Math.max(t,u.times[u.times.length-1])}return this.duration=t,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new vo(this.name,this.duration,e)}});var Qc={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function O0(e,t,i){var l=this,u=!1,h=0,f=0,r=void 0,v=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(b){f++,u===!1&&l.onStart!==void 0&&l.onStart(b,h,f),u=!0},this.itemEnd=function(b){h++,l.onProgress!==void 0&&l.onProgress(b,h,f),h===f&&(u=!1,l.onLoad!==void 0&&l.onLoad())},this.itemError=function(b){l.onError!==void 0&&l.onError(b)},this.resolveURL=function(b){return r?r(b):b},this.setURLModifier=function(b){return r=b,this},this.addHandler=function(b,E){return v.push(b,E),this},this.removeHandler=function(b){var E=v.indexOf(b);return E!==-1&&v.splice(E,2),this},this.getHandler=function(b){for(var E=0,M=v.length;E<M;E+=2){var D=v[E],L=v[E+1];if(D.global&&(D.lastIndex=0),D.test(b))return L}return null}}var RD=new O0;function ri(e){this.manager=e!==void 0?e:RD,this.crossOrigin="anonymous",this.path="",this.resourcePath=""}Object.assign(ri.prototype,{load:function(){},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this}});var Io={};function xo(e){ri.call(this,e)}xo.prototype=Object.assign(Object.create(ri.prototype),{constructor:xo,load:function(e,t,i,l){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);var u=this,h=Qc.get(e);if(h!==void 0)return u.manager.itemStart(e),setTimeout(function(){t&&t(h),u.manager.itemEnd(e)},0),h;if(Io[e]!==void 0){Io[e].push({onLoad:t,onProgress:i,onError:l});return}var f=/^data:(.*?)(;base64)?,(.*)$/,r=e.match(f);if(r){var v=r[1],b=!!r[2],E=r[3];E=decodeURIComponent(E),b&&(E=atob(E));try{var M,D=(this.responseType||"").toLowerCase();switch(D){case"arraybuffer":case"blob":for(var L=new Uint8Array(E.length),z=0;z<E.length;z++)L[z]=E.charCodeAt(z);D==="blob"?M=new Blob([L.buffer],{type:v}):M=L.buffer;break;case"document":var k=new DOMParser;M=k.parseFromString(E,v);break;case"json":M=JSON.parse(E);break;default:M=E;break}setTimeout(function(){t&&t(M),u.manager.itemEnd(e)},0)}catch(X){setTimeout(function(){l&&l(X),u.manager.itemError(e),u.manager.itemEnd(e)},0)}}else{Io[e]=[],Io[e].push({onLoad:t,onProgress:i,onError:l});var F=new XMLHttpRequest;F.open("GET",e,!0),F.addEventListener("load",function(X){var re=this.response,ue=Io[e];if(delete Io[e],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Qc.add(e,re);for(var $=0,te=ue.length;$<te;$++){var oe=ue[$];oe.onLoad&&oe.onLoad(re)}u.manager.itemEnd(e)}else{for(var $=0,te=ue.length;$<te;$++){var oe=ue[$];oe.onError&&oe.onError(X)}u.manager.itemError(e),u.manager.itemEnd(e)}},!1),F.addEventListener("progress",function(X){for(var re=Io[e],ue=0,$=re.length;ue<$;ue++){var te=re[ue];te.onProgress&&te.onProgress(X)}},!1),F.addEventListener("error",function(X){var re=Io[e];delete Io[e];for(var ue=0,$=re.length;ue<$;ue++){var te=re[ue];te.onError&&te.onError(X)}u.manager.itemError(e),u.manager.itemEnd(e)},!1),F.addEventListener("abort",function(X){var re=Io[e];delete Io[e];for(var ue=0,$=re.length;ue<$;ue++){var te=re[ue];te.onError&&te.onError(X)}u.manager.itemError(e),u.manager.itemEnd(e)},!1),this.responseType!==void 0&&(F.responseType=this.responseType),this.withCredentials!==void 0&&(F.withCredentials=this.withCredentials),F.overrideMimeType&&F.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain");for(var G in this.requestHeader)F.setRequestHeader(G,this.requestHeader[G]);F.send(null)}return u.manager.itemStart(e),F},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}});function N0(e){ri.call(this,e)}N0.prototype=Object.assign(Object.create(ri.prototype),{constructor:N0,load:function(e,t,i,l){var u=this,h=new xo(u.manager);h.setPath(u.path),h.load(e,function(f){t(u.parse(JSON.parse(f)))},i,l)},parse:function(e){for(var t=[],i=0;i<e.length;i++){var l=vo.parse(e[i]);t.push(l)}return t}});function U0(e){ri.call(this,e)}U0.prototype=Object.assign(Object.create(ri.prototype),{constructor:U0,load:function(e,t,i,l){var u=this,h=[],f=new Fh;f.image=h;var r=new xo(this.manager);r.setPath(this.path),r.setResponseType("arraybuffer");function v(D){r.load(e[D],function(L){var z=u.parse(L,!0);h[D]={width:z.width,height:z.height,format:z.format,mipmaps:z.mipmaps},b+=1,b===6&&(z.mipmapCount===1&&(f.minFilter=$i),f.format=z.format,f.needsUpdate=!0,t&&t(f))},i,l)}if(Array.isArray(e))for(var b=0,E=0,M=e.length;E<M;++E)v(E);else r.load(e,function(D){var L=u.parse(D,!0);if(L.isCubemap)for(var z=L.mipmaps.length/L.mipmapCount,k=0;k<z;k++){h[k]={mipmaps:[]};for(var F=0;F<L.mipmapCount;F++)h[k].mipmaps.push(L.mipmaps[k*L.mipmapCount+F]),h[k].format=L.format,h[k].width=L.width,h[k].height=L.height}else f.image.width=L.width,f.image.height=L.height,f.mipmaps=L.mipmaps;L.mipmapCount===1&&(f.minFilter=$i),f.format=L.format,f.needsUpdate=!0,t&&t(f)},i,l);return f}});function V0(e){ri.call(this,e)}V0.prototype=Object.assign(Object.create(ri.prototype),{constructor:V0,load:function(e,t,i,l){var u=this,h=new Ac,f=new xo(this.manager);return f.setResponseType("arraybuffer"),f.setPath(this.path),f.load(e,function(r){var v=u.parse(r);v&&(v.image!==void 0?h.image=v.image:v.data!==void 0&&(h.image.width=v.width,h.image.height=v.height,h.image.data=v.data),h.wrapS=v.wrapS!==void 0?v.wrapS:wr,h.wrapT=v.wrapT!==void 0?v.wrapT:wr,h.magFilter=v.magFilter!==void 0?v.magFilter:$i,h.minFilter=v.minFilter!==void 0?v.minFilter:$i,h.anisotropy=v.anisotropy!==void 0?v.anisotropy:1,v.format!==void 0&&(h.format=v.format),v.type!==void 0&&(h.type=v.type),v.mipmaps!==void 0&&(h.mipmaps=v.mipmaps,h.minFilter=rc),v.mipmapCount===1&&(h.minFilter=$i),h.needsUpdate=!0,t&&t(h,v))},i,l),h}});function Qh(e){ri.call(this,e)}Qh.prototype=Object.assign(Object.create(ri.prototype),{constructor:Qh,load:function(e,t,i,l){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);var u=this,h=Qc.get(e);if(h!==void 0)return u.manager.itemStart(e),setTimeout(function(){t&&t(h),u.manager.itemEnd(e)},0),h;var f=document.createElementNS("http://www.w3.org/1999/xhtml","img");function r(){f.removeEventListener("load",r,!1),f.removeEventListener("error",v,!1),Qc.add(e,this),t&&t(this),u.manager.itemEnd(e)}function v(b){f.removeEventListener("load",r,!1),f.removeEventListener("error",v,!1),l&&l(b),u.manager.itemError(e),u.manager.itemEnd(e)}return f.addEventListener("load",r,!1),f.addEventListener("error",v,!1),e.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(f.crossOrigin=this.crossOrigin),u.manager.itemStart(e),f.src=e,f}});function Zy(e){ri.call(this,e)}Zy.prototype=Object.assign(Object.create(ri.prototype),{constructor:Zy,load:function(e,t,i,l){var u=new os,h=new Qh(this.manager);h.setCrossOrigin(this.crossOrigin),h.setPath(this.path);var f=0;function r(b){h.load(e[b],function(E){u.images[b]=E,f++,f===6&&(u.needsUpdate=!0,t&&t(u))},void 0,l)}for(var v=0;v<e.length;++v)r(v);return u}});function ed(e){ri.call(this,e)}ed.prototype=Object.assign(Object.create(ri.prototype),{constructor:ed,load:function(e,t,i,l){var u=new mi,h=new Qh(this.manager);return h.setCrossOrigin(this.crossOrigin),h.setPath(this.path),h.load(e,function(f){u.image=f;var r=e.search(/\.jpe?g($|\?)/i)>0||e.search(/^data\:image\/jpeg/)===0;u.format=r?Ma:Ao,u.needsUpdate=!0,t!==void 0&&t(u)},i,l),u}});function Sn(){this.type="Curve",this.arcLengthDivisions=200}Object.assign(Sn.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var i=this.getUtoTmapping(e);return this.getPoint(i,t)},getPoints:function(e){e===void 0&&(e=5);for(var t=[],i=0;i<=e;i++)t.push(this.getPoint(i/e));return t},getSpacedPoints:function(e){e===void 0&&(e=5);for(var t=[],i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(e===void 0&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t=[],i,l=this.getPoint(0),u,h=0;for(t.push(0),u=1;u<=e;u++)i=this.getPoint(u/e),h+=i.distanceTo(l),t.push(h),l=i;return this.cacheArcLengths=t,t},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var i=this.getLengths(),l=0,u=i.length,h;t?h=t:h=e*i[u-1];for(var f=0,r=u-1,v;f<=r;)if(l=Math.floor(f+(r-f)/2),v=i[l]-h,v<0)f=l+1;else if(v>0)r=l-1;else{r=l;break}if(l=r,i[l]===h)return l/(u-1);var b=i[l],E=i[l+1],M=E-b,D=(h-b)/M,L=(l+D)/(u-1);return L},getTangent:function(e){var t=1e-4,i=e-t,l=e+t;i<0&&(i=0),l>1&&(l=1);var u=this.getPoint(i),h=this.getPoint(l),f=h.clone().sub(u);return f.normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var i=new Se,l=[],u=[],h=[],f=new Se,r=new jn,v,b,E;for(v=0;v<=e;v++)b=v/e,l[v]=this.getTangentAt(b),l[v].normalize();u[0]=new Se,h[0]=new Se;var M=Number.MAX_VALUE,D=Math.abs(l[0].x),L=Math.abs(l[0].y),z=Math.abs(l[0].z);for(D<=M&&(M=D,i.set(1,0,0)),L<=M&&(M=L,i.set(0,1,0)),z<=M&&i.set(0,0,1),f.crossVectors(l[0],i).normalize(),u[0].crossVectors(l[0],f),h[0].crossVectors(l[0],u[0]),v=1;v<=e;v++)u[v]=u[v-1].clone(),h[v]=h[v-1].clone(),f.crossVectors(l[v-1],l[v]),f.length()>Number.EPSILON&&(f.normalize(),E=Math.acos(Wn.clamp(l[v-1].dot(l[v]),-1,1)),u[v].applyMatrix4(r.makeRotationAxis(f,E))),h[v].crossVectors(l[v],u[v]);if(t===!0)for(E=Math.acos(Wn.clamp(u[0].dot(u[e]),-1,1)),E/=e,l[0].dot(f.crossVectors(u[0],u[e]))>0&&(E=-E),v=1;v<=e;v++)u[v].applyMatrix4(r.makeRotationAxis(l[v],E*v)),h[v].crossVectors(l[v],u[v]);return{tangents:l,normals:u,binormals:h}},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}});function bo(e,t,i,l,u,h,f,r){Sn.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=i||1,this.yRadius=l||1,this.aStartAngle=u||0,this.aEndAngle=h||2*Math.PI,this.aClockwise=f||!1,this.aRotation=r||0}bo.prototype=Object.create(Sn.prototype),bo.prototype.constructor=bo,bo.prototype.isEllipseCurve=!0,bo.prototype.getPoint=function(e,t){for(var i=t||new Lt,l=Math.PI*2,u=this.aEndAngle-this.aStartAngle,h=Math.abs(u)<Number.EPSILON;u<0;)u+=l;for(;u>l;)u-=l;u<Number.EPSILON&&(h?u=0:u=l),this.aClockwise===!0&&!h&&(u===l?u=-l:u=u-l);var f=this.aStartAngle+e*u,r=this.aX+this.xRadius*Math.cos(f),v=this.aY+this.yRadius*Math.sin(f);if(this.aRotation!==0){var b=Math.cos(this.aRotation),E=Math.sin(this.aRotation),M=r-this.aX,D=v-this.aY;r=M*b-D*E+this.aX,v=M*E+D*b+this.aY}return i.set(r,v)},bo.prototype.copy=function(e){return Sn.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},bo.prototype.toJSON=function(){var e=Sn.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},bo.prototype.fromJSON=function(e){return Sn.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this};function td(e,t,i,l,u,h){bo.call(this,e,t,i,i,l,u,h),this.type="ArcCurve"}td.prototype=Object.create(bo.prototype),td.prototype.constructor=td,td.prototype.isArcCurve=!0;function Xy(){var e=0,t=0,i=0,l=0;function u(h,f,r,v){e=h,t=r,i=-3*h+3*f-2*r-v,l=2*h-2*f+r+v}return{initCatmullRom:function(h,f,r,v,b){u(f,r,b*(r-h),b*(v-f))},initNonuniformCatmullRom:function(h,f,r,v,b,E,M){var D=(f-h)/b-(r-h)/(b+E)+(r-f)/E,L=(r-f)/E-(v-f)/(E+M)+(v-r)/M;D*=E,L*=E,u(f,r,D,L)},calc:function(h){var f=h*h,r=f*h;return e+t*h+i*f+l*r}}}var Kf=new Se,Yy=new Xy,Jy=new Xy,Ky=new Xy;function lo(e,t,i,l){Sn.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=i||"centripetal",this.tension=l||.5}lo.prototype=Object.create(Sn.prototype),lo.prototype.constructor=lo,lo.prototype.isCatmullRomCurve3=!0,lo.prototype.getPoint=function(e,t){var i=t||new Se,l=this.points,u=l.length,h=(u-(this.closed?0:1))*e,f=Math.floor(h),r=h-f;this.closed?f+=f>0?0:(Math.floor(Math.abs(f)/u)+1)*u:r===0&&f===u-1&&(f=u-2,r=1);var v,b,E,M;if(this.closed||f>0?v=l[(f-1)%u]:(Kf.subVectors(l[0],l[1]).add(l[0]),v=Kf),b=l[f%u],E=l[(f+1)%u],this.closed||f+2<u?M=l[(f+2)%u]:(Kf.subVectors(l[u-1],l[u-2]).add(l[u-1]),M=Kf),this.curveType==="centripetal"||this.curveType==="chordal"){var D=this.curveType==="chordal"?.5:.25,L=Math.pow(v.distanceToSquared(b),D),z=Math.pow(b.distanceToSquared(E),D),k=Math.pow(E.distanceToSquared(M),D);z<1e-4&&(z=1),L<1e-4&&(L=z),k<1e-4&&(k=z),Yy.initNonuniformCatmullRom(v.x,b.x,E.x,M.x,L,z,k),Jy.initNonuniformCatmullRom(v.y,b.y,E.y,M.y,L,z,k),Ky.initNonuniformCatmullRom(v.z,b.z,E.z,M.z,L,z,k)}else this.curveType==="catmullrom"&&(Yy.initCatmullRom(v.x,b.x,E.x,M.x,this.tension),Jy.initCatmullRom(v.y,b.y,E.y,M.y,this.tension),Ky.initCatmullRom(v.z,b.z,E.z,M.z,this.tension));return i.set(Yy.calc(r),Jy.calc(r),Ky.calc(r)),i},lo.prototype.copy=function(e){Sn.prototype.copy.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var l=e.points[t];this.points.push(l.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},lo.prototype.toJSON=function(){var e=Sn.prototype.toJSON.call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++){var l=this.points[t];e.points.push(l.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},lo.prototype.fromJSON=function(e){Sn.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var l=e.points[t];this.points.push(new Se().fromArray(l))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this};function G0(e,t,i,l,u){var h=(l-t)*.5,f=(u-i)*.5,r=e*e,v=e*r;return(2*i-2*l+h+f)*v+(-3*i+3*l-2*h-f)*r+h*e+i}function zD(e,t){var i=1-e;return i*i*t}function kD(e,t){return 2*(1-e)*e*t}function BD(e,t){return e*e*t}function nd(e,t,i,l){return zD(e,t)+kD(e,i)+BD(e,l)}function FD(e,t){var i=1-e;return i*i*i*t}function OD(e,t){var i=1-e;return 3*i*i*e*t}function ND(e,t){return 3*(1-e)*e*e*t}function UD(e,t){return e*e*e*t}function id(e,t,i,l,u){return FD(e,t)+OD(e,i)+ND(e,l)+UD(e,u)}function Zo(e,t,i,l){Sn.call(this),this.type="CubicBezierCurve",this.v0=e||new Lt,this.v1=t||new Lt,this.v2=i||new Lt,this.v3=l||new Lt}Zo.prototype=Object.create(Sn.prototype),Zo.prototype.constructor=Zo,Zo.prototype.isCubicBezierCurve=!0,Zo.prototype.getPoint=function(e,t){var i=t||new Lt,l=this.v0,u=this.v1,h=this.v2,f=this.v3;return i.set(id(e,l.x,u.x,h.x,f.x),id(e,l.y,u.y,h.y,f.y)),i},Zo.prototype.copy=function(e){return Sn.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Zo.prototype.toJSON=function(){var e=Sn.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Zo.prototype.fromJSON=function(e){return Sn.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this};function Ba(e,t,i,l){Sn.call(this),this.type="CubicBezierCurve3",this.v0=e||new Se,this.v1=t||new Se,this.v2=i||new Se,this.v3=l||new Se}Ba.prototype=Object.create(Sn.prototype),Ba.prototype.constructor=Ba,Ba.prototype.isCubicBezierCurve3=!0,Ba.prototype.getPoint=function(e,t){var i=t||new Se,l=this.v0,u=this.v1,h=this.v2,f=this.v3;return i.set(id(e,l.x,u.x,h.x,f.x),id(e,l.y,u.y,h.y,f.y),id(e,l.z,u.z,h.z,f.z)),i},Ba.prototype.copy=function(e){return Sn.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Ba.prototype.toJSON=function(){var e=Sn.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Ba.prototype.fromJSON=function(e){return Sn.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this};function co(e,t){Sn.call(this),this.type="LineCurve",this.v1=e||new Lt,this.v2=t||new Lt}co.prototype=Object.create(Sn.prototype),co.prototype.constructor=co,co.prototype.isLineCurve=!0,co.prototype.getPoint=function(e,t){var i=t||new Lt;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i},co.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},co.prototype.getTangent=function(){var e=this.v2.clone().sub(this.v1);return e.normalize()},co.prototype.copy=function(e){return Sn.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},co.prototype.toJSON=function(){var e=Sn.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},co.prototype.fromJSON=function(e){return Sn.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this};function Xo(e,t){Sn.call(this),this.type="LineCurve3",this.v1=e||new Se,this.v2=t||new Se}Xo.prototype=Object.create(Sn.prototype),Xo.prototype.constructor=Xo,Xo.prototype.isLineCurve3=!0,Xo.prototype.getPoint=function(e,t){var i=t||new Se;return e===1?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i},Xo.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Xo.prototype.copy=function(e){return Sn.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Xo.prototype.toJSON=function(){var e=Sn.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Xo.prototype.fromJSON=function(e){return Sn.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this};function Yo(e,t,i){Sn.call(this),this.type="QuadraticBezierCurve",this.v0=e||new Lt,this.v1=t||new Lt,this.v2=i||new Lt}Yo.prototype=Object.create(Sn.prototype),Yo.prototype.constructor=Yo,Yo.prototype.isQuadraticBezierCurve=!0,Yo.prototype.getPoint=function(e,t){var i=t||new Lt,l=this.v0,u=this.v1,h=this.v2;return i.set(nd(e,l.x,u.x,h.x),nd(e,l.y,u.y,h.y)),i},Yo.prototype.copy=function(e){return Sn.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Yo.prototype.toJSON=function(){var e=Sn.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Yo.prototype.fromJSON=function(e){return Sn.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this};function Fa(e,t,i){Sn.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new Se,this.v1=t||new Se,this.v2=i||new Se}Fa.prototype=Object.create(Sn.prototype),Fa.prototype.constructor=Fa,Fa.prototype.isQuadraticBezierCurve3=!0,Fa.prototype.getPoint=function(e,t){var i=t||new Se,l=this.v0,u=this.v1,h=this.v2;return i.set(nd(e,l.x,u.x,h.x),nd(e,l.y,u.y,h.y),nd(e,l.z,u.z,h.z)),i},Fa.prototype.copy=function(e){return Sn.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Fa.prototype.toJSON=function(){var e=Sn.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Fa.prototype.fromJSON=function(e){return Sn.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this};function Jo(e){Sn.call(this),this.type="SplineCurve",this.points=e||[]}Jo.prototype=Object.create(Sn.prototype),Jo.prototype.constructor=Jo,Jo.prototype.isSplineCurve=!0,Jo.prototype.getPoint=function(e,t){var i=t||new Lt,l=this.points,u=(l.length-1)*e,h=Math.floor(u),f=u-h,r=l[h===0?h:h-1],v=l[h],b=l[h>l.length-2?l.length-1:h+1],E=l[h>l.length-3?l.length-1:h+2];return i.set(G0(f,r.x,v.x,b.x,E.x),G0(f,r.y,v.y,b.y,E.y)),i},Jo.prototype.copy=function(e){Sn.prototype.copy.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var l=e.points[t];this.points.push(l.clone())}return this},Jo.prototype.toJSON=function(){var e=Sn.prototype.toJSON.call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++){var l=this.points[t];e.points.push(l.toArray())}return e},Jo.prototype.fromJSON=function(e){Sn.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var l=e.points[t];this.points.push(new Lt().fromArray(l))}return this};var Qy=Object.freeze({__proto__:null,ArcCurve:td,CatmullRomCurve3:lo,CubicBezierCurve:Zo,CubicBezierCurve3:Ba,EllipseCurve:bo,LineCurve:co,LineCurve3:Xo,QuadraticBezierCurve:Yo,QuadraticBezierCurve3:Fa,SplineCurve:Jo});function hs(){Sn.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}hs.prototype=Object.assign(Object.create(Sn.prototype),{constructor:hs,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new co(t,e))},getPoint:function(e){for(var t=e*this.getLength(),i=this.getCurveLengths(),l=0;l<i.length;){if(i[l]>=t){var u=i[l]-t,h=this.curves[l],f=h.getLength(),r=f===0?0:1-u/f;return h.getPointAt(r)}l++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,i=0,l=this.curves.length;i<l;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){e===void 0&&(e=40);for(var t=[],i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t=[],i,l=0,u=this.curves;l<u.length;l++)for(var h=u[l],f=h&&h.isEllipseCurve?e*2:h&&(h.isLineCurve||h.isLineCurve3)?1:h&&h.isSplineCurve?e*h.points.length:e,r=h.getPoints(f),v=0;v<r.length;v++){var b=r[v];i&&i.equals(b)||(t.push(b),i=b)}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t},copy:function(e){Sn.prototype.copy.call(this,e),this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){var l=e.curves[t];this.curves.push(l.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=Sn.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,i=this.curves.length;t<i;t++){var l=this.curves[t];e.curves.push(l.toJSON())}return e},fromJSON:function(e){Sn.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){var l=e.curves[t];this.curves.push(new Qy[l.type]().fromJSON(l))}return this}});function Ko(e){hs.call(this),this.type="Path",this.currentPoint=new Lt,e&&this.setFromPoints(e)}Ko.prototype=Object.assign(Object.create(hs.prototype),{constructor:Ko,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){var i=new co(this.currentPoint.clone(),new Lt(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,i,l){var u=new Yo(this.currentPoint.clone(),new Lt(e,t),new Lt(i,l));return this.curves.push(u),this.currentPoint.set(i,l),this},bezierCurveTo:function(e,t,i,l,u,h){var f=new Zo(this.currentPoint.clone(),new Lt(e,t),new Lt(i,l),new Lt(u,h));return this.curves.push(f),this.currentPoint.set(u,h),this},splineThru:function(e){var t=[this.currentPoint.clone()].concat(e),i=new Jo(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,i,l,u,h){var f=this.currentPoint.x,r=this.currentPoint.y;return this.absarc(e+f,t+r,i,l,u,h),this},absarc:function(e,t,i,l,u,h){return this.absellipse(e,t,i,i,l,u,h),this},ellipse:function(e,t,i,l,u,h,f,r){var v=this.currentPoint.x,b=this.currentPoint.y;return this.absellipse(e+v,t+b,i,l,u,h,f,r),this},absellipse:function(e,t,i,l,u,h,f,r){var v=new bo(e,t,i,l,u,h,f,r);if(this.curves.length>0){var b=v.getPoint(0);b.equals(this.currentPoint)||this.lineTo(b.x,b.y)}this.curves.push(v);var E=v.getPoint(1);return this.currentPoint.copy(E),this},copy:function(e){return hs.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=hs.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return hs.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}});function hl(e){Ko.call(this,e),this.uuid=Wn.generateUUID(),this.type="Shape",this.holes=[]}hl.prototype=Object.assign(Object.create(Ko.prototype),{constructor:hl,getPointsHoles:function(e){for(var t=[],i=0,l=this.holes.length;i<l;i++)t[i]=this.holes[i].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){Ko.prototype.copy.call(this,e),this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){var l=e.holes[t];this.holes.push(l.clone())}return this},toJSON:function(){var e=Ko.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,i=this.holes.length;t<i;t++){var l=this.holes[t];e.holes.push(l.toJSON())}return e},fromJSON:function(e){Ko.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){var l=e.holes[t];this.holes.push(new Ko().fromJSON(l))}return this}});function Mi(e,t){on.call(this),this.type="Light",this.color=new tn(e),this.intensity=t!==void 0?t:1,this.receiveShadow=void 0}Mi.prototype=Object.assign(Object.create(on.prototype),{constructor:Mi,isLight:!0,copy:function(e){return on.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=on.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}});function e_(e,t,i){Mi.call(this,e,i),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(on.DefaultUp),this.updateMatrix(),this.groundColor=new tn(t)}e_.prototype=Object.assign(Object.create(Mi.prototype),{constructor:e_,isHemisphereLight:!0,copy:function(e){return Mi.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}});function Oa(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new Lt(512,512),this.map=null,this.mapPass=null,this.matrix=new jn,this._frustum=new Ch,this._frameExtents=new Lt(1,1),this._viewportCount=1,this._viewports=[new gi(0,0,1,1)]}Object.assign(Oa.prototype,{_projScreenMatrix:new jn,_lightPositionWorld:new Se,_lookTarget:new Se,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){var t=this.camera,i=this.matrix,l=this._projScreenMatrix,u=this._lookTarget,h=this._lightPositionWorld;h.setFromMatrixPosition(e.matrixWorld),t.position.copy(h),u.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(u),t.updateMatrixWorld(),l.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(l),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(t.projectionMatrix),i.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){var e={};return this.bias!==0&&(e.bias=this.bias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}});function t_(){Oa.call(this,new Zi(50,1,.5,500))}t_.prototype=Object.assign(Object.create(Oa.prototype),{constructor:t_,isSpotLightShadow:!0,updateMatrices:function(e){var t=this.camera,i=Wn.RAD2DEG*2*e.angle,l=this.mapSize.width/this.mapSize.height,u=e.distance||t.far;(i!==t.fov||l!==t.aspect||u!==t.far)&&(t.fov=i,t.aspect=l,t.far=u,t.updateProjectionMatrix()),Oa.prototype.updateMatrices.call(this,e)}});function Qf(e,t,i,l,u,h){Mi.call(this,e,t),this.type="SpotLight",this.position.copy(on.DefaultUp),this.updateMatrix(),this.target=new on,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(f){this.intensity=f/Math.PI}}),this.distance=i!==void 0?i:0,this.angle=l!==void 0?l:Math.PI/3,this.penumbra=u!==void 0?u:0,this.decay=h!==void 0?h:1,this.shadow=new t_}Qf.prototype=Object.assign(Object.create(Mi.prototype),{constructor:Qf,isSpotLight:!0,copy:function(e){return Mi.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}});function n_(){Oa.call(this,new Zi(90,1,.5,500)),this._frameExtents=new Lt(4,2),this._viewportCount=6,this._viewports=[new gi(2,1,1,1),new gi(0,1,1,1),new gi(3,1,1,1),new gi(1,1,1,1),new gi(3,0,1,1),new gi(1,0,1,1)],this._cubeDirections=[new Se(1,0,0),new Se(-1,0,0),new Se(0,0,1),new Se(0,0,-1),new Se(0,1,0),new Se(0,-1,0)],this._cubeUps=[new Se(0,1,0),new Se(0,1,0),new Se(0,1,0),new Se(0,1,0),new Se(0,0,1),new Se(0,0,-1)]}n_.prototype=Object.assign(Object.create(Oa.prototype),{constructor:n_,isPointLightShadow:!0,updateMatrices:function(e,t){t===void 0&&(t=0);var i=this.camera,l=this.matrix,u=this._lightPositionWorld,h=this._lookTarget,f=this._projScreenMatrix;u.setFromMatrixPosition(e.matrixWorld),i.position.copy(u),h.copy(i.position),h.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(h),i.updateMatrixWorld(),l.makeTranslation(-u.x,-u.y,-u.z),f.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(f)}});function em(e,t,i,l){Mi.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return this.intensity*4*Math.PI},set:function(u){this.intensity=u/(4*Math.PI)}}),this.distance=i!==void 0?i:0,this.decay=l!==void 0?l:1,this.shadow=new n_}em.prototype=Object.assign(Object.create(Mi.prototype),{constructor:em,isPointLight:!0,copy:function(e){return Mi.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}});function eu(e,t,i,l,u,h){Ia.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e!==void 0?e:-1,this.right=t!==void 0?t:1,this.top=i!==void 0?i:1,this.bottom=l!==void 0?l:-1,this.near=u!==void 0?u:.1,this.far=h!==void 0?h:2e3,this.updateProjectionMatrix()}eu.prototype=Object.assign(Object.create(Ia.prototype),{constructor:eu,isOrthographicCamera:!0,copy:function(e,t){return Ia.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this},setViewOffset:function(e,t,i,l,u,h){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=l,this.view.width=u,this.view.height=h,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,l=(this.top+this.bottom)/2,u=i-e,h=i+e,f=l+t,r=l-t;if(this.view!==null&&this.view.enabled){var v=(this.right-this.left)/this.view.fullWidth/this.zoom,b=(this.top-this.bottom)/this.view.fullHeight/this.zoom;u+=v*this.view.offsetX,h=u+v*this.view.width,f-=b*this.view.offsetY,r=f-b*this.view.height}this.projectionMatrix.makeOrthographic(u,h,f,r,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=on.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}});function i_(){Oa.call(this,new eu(-5,5,5,-5,.5,500))}i_.prototype=Object.assign(Object.create(Oa.prototype),{constructor:i_,isDirectionalLightShadow:!0,updateMatrices:function(e){Oa.prototype.updateMatrices.call(this,e)}});function tm(e,t){Mi.call(this,e,t),this.type="DirectionalLight",this.position.copy(on.DefaultUp),this.updateMatrix(),this.target=new on,this.shadow=new i_}tm.prototype=Object.assign(Object.create(Mi.prototype),{constructor:tm,isDirectionalLight:!0,copy:function(e){return Mi.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}});function r_(e,t){Mi.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}r_.prototype=Object.assign(Object.create(Mi.prototype),{constructor:r_,isAmbientLight:!0});function o_(e,t,i,l){Mi.call(this,e,t),this.type="RectAreaLight",this.width=i!==void 0?i:10,this.height=l!==void 0?l:10}o_.prototype=Object.assign(Object.create(Mi.prototype),{constructor:o_,isRectAreaLight:!0,copy:function(e){return Mi.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=Mi.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}});function a_(e){ri.call(this,e),this.textures={}}a_.prototype=Object.assign(Object.create(ri.prototype),{constructor:a_,load:function(e,t,i,l){var u=this,h=new xo(u.manager);h.setPath(u.path),h.load(e,function(f){t(u.parse(JSON.parse(f)))},i,l)},parse:function(e){var t=this.textures;function i(v){return t[v]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",v),t[v]}var l=new PD[e.type];if(e.uuid!==void 0&&(l.uuid=e.uuid),e.name!==void 0&&(l.name=e.name),e.color!==void 0&&l.color.setHex(e.color),e.roughness!==void 0&&(l.roughness=e.roughness),e.metalness!==void 0&&(l.metalness=e.metalness),e.sheen!==void 0&&(l.sheen=new tn().setHex(e.sheen)),e.emissive!==void 0&&l.emissive.setHex(e.emissive),e.specular!==void 0&&l.specular.setHex(e.specular),e.shininess!==void 0&&(l.shininess=e.shininess),e.clearcoat!==void 0&&(l.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(l.clearcoatRoughness=e.clearcoatRoughness),e.vertexColors!==void 0&&(l.vertexColors=e.vertexColors),e.fog!==void 0&&(l.fog=e.fog),e.flatShading!==void 0&&(l.flatShading=e.flatShading),e.blending!==void 0&&(l.blending=e.blending),e.combine!==void 0&&(l.combine=e.combine),e.side!==void 0&&(l.side=e.side),e.opacity!==void 0&&(l.opacity=e.opacity),e.transparent!==void 0&&(l.transparent=e.transparent),e.alphaTest!==void 0&&(l.alphaTest=e.alphaTest),e.depthTest!==void 0&&(l.depthTest=e.depthTest),e.depthWrite!==void 0&&(l.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(l.colorWrite=e.colorWrite),e.stencilWrite!==void 0&&(l.stencilWrite=e.stencilWrite),e.stencilWriteMask!==void 0&&(l.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(l.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(l.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(l.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(l.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(l.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(l.stencilZPass=e.stencilZPass),e.wireframe!==void 0&&(l.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(l.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(l.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(l.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(l.rotation=e.rotation),e.linewidth!==1&&(l.linewidth=e.linewidth),e.dashSize!==void 0&&(l.dashSize=e.dashSize),e.gapSize!==void 0&&(l.gapSize=e.gapSize),e.scale!==void 0&&(l.scale=e.scale),e.polygonOffset!==void 0&&(l.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(l.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(l.polygonOffsetUnits=e.polygonOffsetUnits),e.skinning!==void 0&&(l.skinning=e.skinning),e.morphTargets!==void 0&&(l.morphTargets=e.morphTargets),e.morphNormals!==void 0&&(l.morphNormals=e.morphNormals),e.dithering!==void 0&&(l.dithering=e.dithering),e.visible!==void 0&&(l.visible=e.visible),e.toneMapped!==void 0&&(l.toneMapped=e.toneMapped),e.userData!==void 0&&(l.userData=e.userData),e.uniforms!==void 0)for(var u in e.uniforms){var h=e.uniforms[u];switch(l.uniforms[u]={},h.type){case"t":l.uniforms[u].value=i(h.value);break;case"c":l.uniforms[u].value=new tn().setHex(h.value);break;case"v2":l.uniforms[u].value=new Lt().fromArray(h.value);break;case"v3":l.uniforms[u].value=new Se().fromArray(h.value);break;case"v4":l.uniforms[u].value=new gi().fromArray(h.value);break;case"m3":l.uniforms[u].value=new dr().fromArray(h.value);case"m4":l.uniforms[u].value=new jn().fromArray(h.value);break;default:l.uniforms[u].value=h.value}}if(e.defines!==void 0&&(l.defines=e.defines),e.vertexShader!==void 0&&(l.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(l.fragmentShader=e.fragmentShader),e.extensions!==void 0)for(var f in e.extensions)l.extensions[f]=e.extensions[f];if(e.shading!==void 0&&(l.flatShading=e.shading===1),e.size!==void 0&&(l.size=e.size),e.sizeAttenuation!==void 0&&(l.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(l.map=i(e.map)),e.matcap!==void 0&&(l.matcap=i(e.matcap)),e.alphaMap!==void 0&&(l.alphaMap=i(e.alphaMap),l.transparent=!0),e.bumpMap!==void 0&&(l.bumpMap=i(e.bumpMap)),e.bumpScale!==void 0&&(l.bumpScale=e.bumpScale),e.normalMap!==void 0&&(l.normalMap=i(e.normalMap)),e.normalMapType!==void 0&&(l.normalMapType=e.normalMapType),e.normalScale!==void 0){var r=e.normalScale;Array.isArray(r)===!1&&(r=[r,r]),l.normalScale=new Lt().fromArray(r)}return e.displacementMap!==void 0&&(l.displacementMap=i(e.displacementMap)),e.displacementScale!==void 0&&(l.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(l.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(l.roughnessMap=i(e.roughnessMap)),e.metalnessMap!==void 0&&(l.metalnessMap=i(e.metalnessMap)),e.emissiveMap!==void 0&&(l.emissiveMap=i(e.emissiveMap)),e.emissiveIntensity!==void 0&&(l.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(l.specularMap=i(e.specularMap)),e.envMap!==void 0&&(l.envMap=i(e.envMap)),e.envMapIntensity!==void 0&&(l.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(l.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(l.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(l.lightMap=i(e.lightMap)),e.lightMapIntensity!==void 0&&(l.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(l.aoMap=i(e.aoMap)),e.aoMapIntensity!==void 0&&(l.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(l.gradientMap=i(e.gradientMap)),e.clearcoatNormalMap!==void 0&&(l.clearcoatNormalMap=i(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(l.clearcoatNormalScale=new Lt().fromArray(e.clearcoatNormalScale)),l},setTextures:function(e){return this.textures=e,this}});var dl={decodeText:function(e){if(typeof TextDecoder!="undefined")return new TextDecoder().decode(e);for(var t="",i=0,l=e.length;i<l;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch(u){return t}},extractUrlBase:function(e){var t=e.lastIndexOf("/");return t===-1?"./":e.substr(0,t+1)}};function s_(){vn.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}s_.prototype=Object.assign(Object.create(vn.prototype),{constructor:s_,isInstancedBufferGeometry:!0,copy:function(e){return vn.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){var e=vn.prototype.toJSON.call(this);return e.maxInstancedCount=this.maxInstancedCount,e.isInstancedBufferGeometry=!0,e}});function l_(e,t,i,l){typeof i=="number"&&(l=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),zn.call(this,e,t,i),this.meshPerAttribute=l||1}l_.prototype=Object.assign(Object.create(zn.prototype),{constructor:l_,isInstancedBufferAttribute:!0,copy:function(e){return zn.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){var e=zn.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}});function c_(e){ri.call(this,e)}c_.prototype=Object.assign(Object.create(ri.prototype),{constructor:c_,load:function(e,t,i,l){var u=this,h=new xo(u.manager);h.setPath(u.path),h.load(e,function(f){t(u.parse(JSON.parse(f)))},i,l)},parse:function(e){var t=e.isInstancedBufferGeometry?new s_:new vn,i=e.data.index;if(i!==void 0){var l=new u_[i.type](i.array);t.setIndex(new zn(l,1))}var u=e.data.attributes;for(var h in u){var f=u[h],l=new u_[f.type](f.array),r=f.isInstancedBufferAttribute?l_:zn,v=new r(l,f.itemSize,f.normalized);f.name!==void 0&&(v.name=f.name),t.setAttribute(h,v)}var b=e.data.morphAttributes;if(b)for(var h in b){for(var E=b[h],M=[],D=0,L=E.length;D<L;D++){var f=E[D],l=new u_[f.type](f.array),v=new zn(l,f.itemSize,f.normalized);f.name!==void 0&&(v.name=f.name),M.push(v)}t.morphAttributes[h]=M}var z=e.data.morphTargetsRelative;z&&(t.morphTargetsRelative=!0);var k=e.data.groups||e.data.drawcalls||e.data.offsets;if(k!==void 0)for(var D=0,F=k.length;D!==F;++D){var G=k[D];t.addGroup(G.start,G.count,G.materialIndex)}var X=e.data.boundingSphere;if(X!==void 0){var re=new Se;X.center!==void 0&&re.fromArray(X.center),t.boundingSphere=new Sa(re,X.radius)}return e.name&&(t.name=e.name),e.userData&&(t.userData=e.userData),t}});var u_={Int8Array,Uint8Array,Uint8ClampedArray:typeof Uint8ClampedArray!="undefined"?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function h_(e){ri.call(this,e)}h_.prototype=Object.assign(Object.create(ri.prototype),{constructor:h_,load:function(e,t,i,l){var u=this,h=this.path===""?dl.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||h;var f=new xo(u.manager);f.setPath(this.path),f.load(e,function(r){var v=null;try{v=JSON.parse(r)}catch(E){l!==void 0&&l(E),console.error("THREE:ObjectLoader: Can't parse "+e+".",E.message);return}var b=v.metadata;if(b===void 0||b.type===void 0||b.type.toLowerCase()==="geometry"){console.error("THREE.ObjectLoader: Can't load "+e);return}u.parse(v,t)},i,l)},parse:function(e,t){var i=this.parseShape(e.shapes),l=this.parseGeometries(e.geometries,i),u=this.parseImages(e.images,function(){t!==void 0&&t(r)}),h=this.parseTextures(e.textures,u),f=this.parseMaterials(e.materials,h),r=this.parseObject(e.object,l,f);return e.animations&&(r.animations=this.parseAnimations(e.animations)),(e.images===void 0||e.images.length===0)&&t!==void 0&&t(r),r},parseShape:function(e){var t={};if(e!==void 0)for(var i=0,l=e.length;i<l;i++){var u=new hl().fromJSON(e[i]);t[u.uuid]=u}return t},parseGeometries:function(e,t){var i={};if(e!==void 0)for(var l=new c_,u=0,h=e.length;u<h;u++){var f,r=e[u];switch(r.type){case"PlaneGeometry":case"PlaneBufferGeometry":f=new Tr[r.type](r.width,r.height,r.widthSegments,r.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":f=new Tr[r.type](r.width,r.height,r.depth,r.widthSegments,r.heightSegments,r.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":f=new Tr[r.type](r.radius,r.segments,r.thetaStart,r.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":f=new Tr[r.type](r.radiusTop,r.radiusBottom,r.height,r.radialSegments,r.heightSegments,r.openEnded,r.thetaStart,r.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":f=new Tr[r.type](r.radius,r.height,r.radialSegments,r.heightSegments,r.openEnded,r.thetaStart,r.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":f=new Tr[r.type](r.radius,r.widthSegments,r.heightSegments,r.phiStart,r.phiLength,r.thetaStart,r.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":f=new Tr[r.type](r.radius,r.detail);break;case"RingGeometry":case"RingBufferGeometry":f=new Tr[r.type](r.innerRadius,r.outerRadius,r.thetaSegments,r.phiSegments,r.thetaStart,r.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":f=new Tr[r.type](r.radius,r.tube,r.radialSegments,r.tubularSegments,r.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":f=new Tr[r.type](r.radius,r.tube,r.tubularSegments,r.radialSegments,r.p,r.q);break;case"TubeGeometry":case"TubeBufferGeometry":f=new Tr[r.type](new Qy[r.path.type]().fromJSON(r.path),r.tubularSegments,r.radius,r.radialSegments,r.closed);break;case"LatheGeometry":case"LatheBufferGeometry":f=new Tr[r.type](r.points,r.segments,r.phiStart,r.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":f=new Tr[r.type](r.vertices,r.indices,r.radius,r.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var M=[],v=0,b=r.shapes.length;v<b;v++){var E=t[r.shapes[v]];M.push(E)}f=new Tr[r.type](M,r.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(var M=[],v=0,b=r.shapes.length;v<b;v++){var E=t[r.shapes[v]];M.push(E)}var D=r.options.extrudePath;D!==void 0&&(r.options.extrudePath=new Qy[D.type]().fromJSON(D)),f=new Tr[r.type](M,r.options);break;case"BufferGeometry":case"InstancedBufferGeometry":f=l.parse(r);break;case"Geometry":if("THREE"in window&&"LegacyJSONLoader"in THREE){var L=new THREE.LegacyJSONLoader;f=L.parse(r,this.resourcePath).geometry}else console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+r.type+'"');continue}f.uuid=r.uuid,r.name!==void 0&&(f.name=r.name),f.isBufferGeometry===!0&&r.userData!==void 0&&(f.userData=r.userData),i[r.uuid]=f}return i},parseMaterials:function(e,t){var i={},l={};if(e!==void 0){var u=new a_;u.setTextures(t);for(var h=0,f=e.length;h<f;h++){var r=e[h];if(r.type==="MultiMaterial"){for(var v=[],b=0;b<r.materials.length;b++){var E=r.materials[b];i[E.uuid]===void 0&&(i[E.uuid]=u.parse(E)),v.push(i[E.uuid])}l[r.uuid]=v}else i[r.uuid]===void 0&&(i[r.uuid]=u.parse(r)),l[r.uuid]=i[r.uuid]}}return l},parseAnimations:function(e){for(var t=[],i=0;i<e.length;i++){var l=e[i],u=vo.parse(l);l.uuid!==void 0&&(u.uuid=l.uuid),t.push(u)}return t},parseImages:function(e,t){var i=this,l={};function u(k){return i.manager.itemStart(k),f.load(k,function(){i.manager.itemEnd(k)},void 0,function(){i.manager.itemError(k),i.manager.itemEnd(k)})}if(e!==void 0&&e.length>0){var h=new O0(t),f=new Qh(h);f.setCrossOrigin(this.crossOrigin);for(var r=0,v=e.length;r<v;r++){var b=e[r],E=b.url;if(Array.isArray(E)){l[b.uuid]=[];for(var M=0,D=E.length;M<D;M++){var L=E[M],z=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(L)?L:i.resourcePath+L;l[b.uuid].push(u(z))}}else{var z=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(b.url)?b.url:i.resourcePath+b.url;l[b.uuid]=u(z)}}}return l},parseTextures:function(e,t){function i(v,b){return typeof v=="number"?v:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",v),b[v])}var l={};if(e!==void 0)for(var u=0,h=e.length;u<h;u++){var f=e[u];f.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',f.uuid),t[f.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",f.image);var r;Array.isArray(t[f.image])?r=new os(t[f.image]):r=new mi(t[f.image]),r.needsUpdate=!0,r.uuid=f.uuid,f.name!==void 0&&(r.name=f.name),f.mapping!==void 0&&(r.mapping=i(f.mapping,VD)),f.offset!==void 0&&r.offset.fromArray(f.offset),f.repeat!==void 0&&r.repeat.fromArray(f.repeat),f.center!==void 0&&r.center.fromArray(f.center),f.rotation!==void 0&&(r.rotation=f.rotation),f.wrap!==void 0&&(r.wrapS=i(f.wrap[0],H0),r.wrapT=i(f.wrap[1],H0)),f.format!==void 0&&(r.format=f.format),f.type!==void 0&&(r.type=f.type),f.encoding!==void 0&&(r.encoding=f.encoding),f.minFilter!==void 0&&(r.minFilter=i(f.minFilter,W0)),f.magFilter!==void 0&&(r.magFilter=i(f.magFilter,W0)),f.anisotropy!==void 0&&(r.anisotropy=f.anisotropy),f.flipY!==void 0&&(r.flipY=f.flipY),f.premultiplyAlpha!==void 0&&(r.premultiplyAlpha=f.premultiplyAlpha),f.unpackAlignment!==void 0&&(r.unpackAlignment=f.unpackAlignment),l[f.uuid]=r}return l},parseObject:function(e,t,i){var l;function u(F){return t[F]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",F),t[F]}function h(F){if(F!==void 0){if(Array.isArray(F)){for(var G=[],X=0,re=F.length;X<re;X++){var ue=F[X];i[ue]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",ue),G.push(i[ue])}return G}return i[F]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",F),i[F]}}switch(e.type){case"Scene":l=new Ca,e.background!==void 0&&Number.isInteger(e.background)&&(l.background=new tn(e.background)),e.fog!==void 0&&(e.fog.type==="Fog"?l.fog=new Ry(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(l.fog=new Iy(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":l=new Zi(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(l.focus=e.focus),e.zoom!==void 0&&(l.zoom=e.zoom),e.filmGauge!==void 0&&(l.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(l.filmOffset=e.filmOffset),e.view!==void 0&&(l.view=Object.assign({},e.view));break;case"OrthographicCamera":l=new eu(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(l.zoom=e.zoom),e.view!==void 0&&(l.view=Object.assign({},e.view));break;case"AmbientLight":l=new r_(e.color,e.intensity);break;case"DirectionalLight":l=new tm(e.color,e.intensity);break;case"PointLight":l=new em(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":l=new o_(e.color,e.intensity,e.width,e.height);break;case"SpotLight":l=new Qf(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":l=new e_(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var f=u(e.geometry),r=h(e.material);f.bones&&f.bones.length>0?l=new kh(f,r):l=new Ai(f,r);break;case"InstancedMesh":var f=u(e.geometry),r=h(e.material),v=e.count,b=e.instanceMatrix;l=new Fy(f,r,v),l.instanceMatrix=new zn(new Float32Array(b.array),16);break;case"LOD":l=new bf;break;case"Line":l=new ao(u(e.geometry),h(e.material),e.mode);break;case"LineLoop":l=new Af(u(e.geometry),h(e.material));break;case"LineSegments":l=new Vi(u(e.geometry),h(e.material));break;case"PointCloud":case"Points":l=new Pf(u(e.geometry),h(e.material));break;case"Sprite":l=new ky(h(e.material));break;case"Group":l=new al;break;default:l=new on}if(l.uuid=e.uuid,e.name!==void 0&&(l.name=e.name),e.matrix!==void 0?(l.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(l.matrixAutoUpdate=e.matrixAutoUpdate),l.matrixAutoUpdate&&l.matrix.decompose(l.position,l.quaternion,l.scale)):(e.position!==void 0&&l.position.fromArray(e.position),e.rotation!==void 0&&l.rotation.fromArray(e.rotation),e.quaternion!==void 0&&l.quaternion.fromArray(e.quaternion),e.scale!==void 0&&l.scale.fromArray(e.scale)),e.castShadow!==void 0&&(l.castShadow=e.castShadow),e.receiveShadow!==void 0&&(l.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(l.shadow.bias=e.shadow.bias),e.shadow.radius!==void 0&&(l.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&l.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(l.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(l.visible=e.visible),e.frustumCulled!==void 0&&(l.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(l.renderOrder=e.renderOrder),e.userData!==void 0&&(l.userData=e.userData),e.layers!==void 0&&(l.layers.mask=e.layers),e.children!==void 0)for(var E=e.children,M=0;M<E.length;M++)l.add(this.parseObject(E[M],t,i));if(e.type==="LOD"){e.autoUpdate!==void 0&&(l.autoUpdate=e.autoUpdate);for(var D=e.levels,L=0;L<D.length;L++){var z=D[L],k=l.getObjectByProperty("uuid",z.object);k!==void 0&&l.addLevel(k,z.distance)}}return l}});var VD={UVMapping:qg,CubeReflectionMapping:Zg,CubeRefractionMapping:Xg,EquirectangularReflectionMapping:gx,EquirectangularRefractionMapping:Yg,SphericalReflectionMapping:yx,CubeUVReflectionMapping:uh,CubeUVRefractionMapping:Jg},H0={RepeatWrapping:Xs,ClampToEdgeWrapping:wr,MirroredRepeatWrapping:hh},W0={NearestFilter:Ui,NearestMipmapNearestFilter:jp,NearestMipmapLinearFilter:$p,LinearFilter:$i,LinearMipmapNearestFilter:Kg,LinearMipmapLinearFilter:rc};function j0(e){typeof createImageBitmap=="undefined"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch=="undefined"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),ri.call(this,e),this.options=void 0}j0.prototype=Object.assign(Object.create(ri.prototype),{constructor:j0,setOptions:function(t){return this.options=t,this},load:function(e,t,i,l){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);var u=this,h=Qc.get(e);if(h!==void 0)return u.manager.itemStart(e),setTimeout(function(){t&&t(h),u.manager.itemEnd(e)},0),h;fetch(e).then(function(f){return f.blob()}).then(function(f){return u.options===void 0?createImageBitmap(f):createImageBitmap(f,u.options)}).then(function(f){Qc.add(e,f),t&&t(f),u.manager.itemEnd(e)}).catch(function(f){l&&l(f),u.manager.itemError(e),u.manager.itemEnd(e)}),u.manager.itemStart(e)}});function $0(){this.type="ShapePath",this.color=new tn,this.subPaths=[],this.currentPath=null}Object.assign($0.prototype,{moveTo:function(e,t){return this.currentPath=new Ko,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,i,l){return this.currentPath.quadraticCurveTo(e,t,i,l),this},bezierCurveTo:function(e,t,i,l,u,h){return this.currentPath.bezierCurveTo(e,t,i,l,u,h),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function i($e){for(var ct=[],At=0,yt=$e.length;At<yt;At++){var St=$e[At],It=new hl;It.curves=St.curves,ct.push(It)}return ct}function l($e,ct){for(var At=ct.length,yt=!1,St=At-1,It=0;It<At;St=It++){var Nt=ct[St],Ie=ct[It],xe=Ie.x-Nt.x,He=Ie.y-Nt.y;if(Math.abs(He)>Number.EPSILON){if(He<0&&(Nt=ct[It],xe=-xe,Ie=ct[St],He=-He),$e.y<Nt.y||$e.y>Ie.y)continue;if($e.y===Nt.y){if($e.x===Nt.x)return!0}else{var Ge=He*($e.x-Nt.x)-xe*($e.y-Nt.y);if(Ge===0)return!0;if(Ge<0)continue;yt=!yt}}else{if($e.y!==Nt.y)continue;if(Ie.x<=$e.x&&$e.x<=Nt.x||Nt.x<=$e.x&&$e.x<=Ie.x)return!0}}return yt}var u=ls.isClockWise,h=this.subPaths;if(h.length===0)return[];if(t===!0)return i(h);var f,r,v,b=[];if(h.length===1)return r=h[0],v=new hl,v.curves=r.curves,b.push(v),b;var E=!u(h[0].getPoints());E=e?!E:E;var M=[],D=[],L=[],z=0,k;D[z]=void 0,L[z]=[];for(var F=0,G=h.length;F<G;F++)r=h[F],k=r.getPoints(),f=u(k),f=e?!f:f,f?(!E&&D[z]&&z++,D[z]={s:new hl,p:k},D[z].s.curves=r.curves,E&&z++,L[z]=[]):L[z].push({h:r,p:k[0]});if(!D[0])return i(h);if(D.length>1){for(var X=!1,re=[],ue=0,$=D.length;ue<$;ue++)M[ue]=[];for(var ue=0,$=D.length;ue<$;ue++)for(var te=L[ue],oe=0;oe<te.length;oe++){for(var ie=te[oe],se=!0,pe=0;pe<D.length;pe++)l(ie.p,D[pe].p)&&(ue!==pe&&re.push({froms:ue,tos:pe,hole:oe}),se?(se=!1,M[pe].push(ie)):X=!0);se&&M[ue].push(ie)}re.length>0&&(X||(L=M))}for(var me,F=0,he=D.length;F<he;F++){v=D[F].s,b.push(v),me=L[F];for(var Ue=0,Ve=me.length;Ue<Ve;Ue++)v.holes.push(me[Ue].h)}return b}});function q0(e){this.type="Font",this.data=e}Object.assign(q0.prototype,{isFont:!0,generateShapes:function(e,t){t===void 0&&(t=100);for(var i=[],l=GD(e,t,this.data),u=0,h=l.length;u<h;u++)Array.prototype.push.apply(i,l[u].toShapes());return i}});function GD(e,t,i){for(var l=Array.from?Array.from(e):String(e).split(""),u=t/i.resolution,h=(i.boundingBox.yMax-i.boundingBox.yMin+i.underlineThickness)*u,f=[],r=0,v=0,b=0;b<l.length;b++){var E=l[b];if(E===`
`)r=0,v-=h;else{var M=HD(E,u,r,v,i);r+=M.offsetX,f.push(M.path)}}return f}function HD(e,t,i,l,u){var h=u.glyphs[e]||u.glyphs["?"];if(!h){console.error('THREE.Font: character "'+e+'" does not exists in font family '+u.familyName+".");return}var f=new $0,r,v,b,E,M,D,L,z;if(h.o)for(var k=h._cachedOutline||(h._cachedOutline=h.o.split(" ")),F=0,G=k.length;F<G;){var X=k[F++];switch(X){case"m":r=k[F++]*t+i,v=k[F++]*t+l,f.moveTo(r,v);break;case"l":r=k[F++]*t+i,v=k[F++]*t+l,f.lineTo(r,v);break;case"q":b=k[F++]*t+i,E=k[F++]*t+l,M=k[F++]*t+i,D=k[F++]*t+l,f.quadraticCurveTo(M,D,b,E);break;case"b":b=k[F++]*t+i,E=k[F++]*t+l,M=k[F++]*t+i,D=k[F++]*t+l,L=k[F++]*t+i,z=k[F++]*t+l,f.bezierCurveTo(M,D,L,z,b,E);break}}return{offsetX:h.ha*t,path:f}}function Z0(e){ri.call(this,e)}Z0.prototype=Object.assign(Object.create(ri.prototype),{constructor:Z0,load:function(e,t,i,l){var u=this,h=new xo(this.manager);h.setPath(this.path),h.load(e,function(f){var r;try{r=JSON.parse(f)}catch(b){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),r=JSON.parse(f.substring(65,f.length-2))}var v=u.parse(r);t&&t(v)},i,l)},parse:function(e){return new q0(e)}});var nm,X0={getContext:function(){return nm===void 0&&(nm=new(window.AudioContext||window.webkitAudioContext)),nm},setContext:function(e){nm=e}};function d_(e){ri.call(this,e)}d_.prototype=Object.assign(Object.create(ri.prototype),{constructor:d_,load:function(e,t,i,l){var u=new xo(this.manager);u.setResponseType("arraybuffer"),u.setPath(this.path),u.load(e,function(h){var f=h.slice(0),r=X0.getContext();r.decodeAudioData(f,function(v){t(v)})},i,l)}});function p_(){this.coefficients=[];for(var e=0;e<9;e++)this.coefficients.push(new Se)}Object.assign(p_.prototype,{isSphericalHarmonics3:!0,set:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this},zero:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this},getAt:function(e,t){var i=e.x,l=e.y,u=e.z,h=this.coefficients;return t.copy(h[0]).multiplyScalar(.282095),t.addScale(h[1],.488603*l),t.addScale(h[2],.488603*u),t.addScale(h[3],.488603*i),t.addScale(h[4],1.092548*(i*l)),t.addScale(h[5],1.092548*(l*u)),t.addScale(h[6],.315392*(3*u*u-1)),t.addScale(h[7],1.092548*(i*u)),t.addScale(h[8],.546274*(i*i-l*l)),t},getIrradianceAt:function(e,t){var i=e.x,l=e.y,u=e.z,h=this.coefficients;return t.copy(h[0]).multiplyScalar(.886227),t.addScale(h[1],1.023328*l),t.addScale(h[2],1.023328*u),t.addScale(h[3],1.023328*i),t.addScale(h[4],.858086*i*l),t.addScale(h[5],.858086*l*u),t.addScale(h[6],.743125*u*u-.247708),t.addScale(h[7],.858086*i*u),t.addScale(h[8],.429043*(i*i-l*l)),t},add:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this},scale:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this},lerp:function(e,t){for(var i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this},equals:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0},copy:function(e){return this.set(e.coefficients)},clone:function(){return new this.constructor().copy(this)},fromArray:function(e,t){t===void 0&&(t=0);for(var i=this.coefficients,l=0;l<9;l++)i[l].fromArray(e,t+l*3);return this},toArray:function(e,t){e===void 0&&(e=[]),t===void 0&&(t=0);for(var i=this.coefficients,l=0;l<9;l++)i[l].toArray(e,t+l*3);return e}}),Object.assign(p_,{getBasisAt:function(e,t){var i=e.x,l=e.y,u=e.z;t[0]=.282095,t[1]=.488603*l,t[2]=.488603*u,t[3]=.488603*i,t[4]=1.092548*i*l,t[5]=1.092548*l*u,t[6]=.315392*(3*u*u-1),t[7]=1.092548*i*u,t[8]=.546274*(i*i-l*l)}});function Qo(e,t){Mi.call(this,void 0,t),this.sh=e!==void 0?e:new p_}Qo.prototype=Object.assign(Object.create(Mi.prototype),{constructor:Qo,isLightProbe:!0,copy:function(e){return Mi.prototype.copy.call(this,e),this.sh.copy(e.sh),this.intensity=e.intensity,this},toJSON:function(e){var t=Mi.prototype.toJSON.call(this,e);return t}});function Y0(e,t,i){Qo.call(this,void 0,i);var l=new tn().set(e),u=new tn().set(t),h=new Se(l.r,l.g,l.b),f=new Se(u.r,u.g,u.b),r=Math.sqrt(Math.PI),v=r*Math.sqrt(.75);this.sh.coefficients[0].copy(h).add(f).multiplyScalar(r),this.sh.coefficients[1].copy(h).sub(f).multiplyScalar(v)}Y0.prototype=Object.assign(Object.create(Qo.prototype),{constructor:Y0,isHemisphereLightProbe:!0,copy:function(e){return Qo.prototype.copy.call(this,e),this},toJSON:function(e){var t=Qo.prototype.toJSON.call(this,e);return t}});function J0(e,t){Qo.call(this,void 0,t);var i=new tn().set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}J0.prototype=Object.assign(Object.create(Qo.prototype),{constructor:J0,isAmbientLightProbe:!0,copy:function(e){return Qo.prototype.copy.call(this,e),this},toJSON:function(e){var t=Qo.prototype.toJSON.call(this,e);return t}});var K0=new jn,Q0=new jn;function WD(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Zi,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Zi,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}Object.assign(WD.prototype,{update:function(e){var t=this._cache,i=t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep;if(i){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;var l=e.projectionMatrix.clone(),u=t.eyeSep/2,h=u*t.near/t.focus,f=t.near*Math.tan(Wn.DEG2RAD*t.fov*.5)/t.zoom,r,v;Q0.elements[12]=-u,K0.elements[12]=u,r=-f*t.aspect+h,v=f*t.aspect+h,l.elements[0]=2*t.near/(v-r),l.elements[8]=(v+r)/(v-r),this.cameraL.projectionMatrix.copy(l),r=-f*t.aspect-h,v=f*t.aspect-h,l.elements[0]=2*t.near/(v-r),l.elements[8]=(v+r)/(v-r),this.cameraR.projectionMatrix.copy(l)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Q0),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(K0)}});function e1(e){this.autoStart=e!==void 0?e:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(e1.prototype,{start:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=(typeof performance=="undefined"?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}});var pl=new Se,t1=new Or,jD=new Se,fl=new Se;function n1(){on.call(this),this.type="AudioListener",this.context=X0.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new e1}n1.prototype=Object.assign(Object.create(on.prototype),{constructor:n1,getInput:function(){return this.gain},removeFilter:function(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(e){on.prototype.updateMatrixWorld.call(this,e);var t=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(pl,t1,jD),fl.set(0,0,-1).applyQuaternion(t1),t.positionX){var l=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(pl.x,l),t.positionY.linearRampToValueAtTime(pl.y,l),t.positionZ.linearRampToValueAtTime(pl.z,l),t.forwardX.linearRampToValueAtTime(fl.x,l),t.forwardY.linearRampToValueAtTime(fl.y,l),t.forwardZ.linearRampToValueAtTime(fl.z,l),t.upX.linearRampToValueAtTime(i.x,l),t.upY.linearRampToValueAtTime(i.y,l),t.upZ.linearRampToValueAtTime(i.z,l)}else t.setPosition(pl.x,pl.y,pl.z),t.setOrientation(fl.x,fl.y,fl.z,i.x,i.y,i.z)}});function rd(e){on.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._pausedAt=0,this.filters=[]}rd.prototype=Object.assign(Object.create(on.prototype),{constructor:rd,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setMediaStreamSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(e){if(e===void 0&&(e=0),this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._pausedAt+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()},pause:function(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._pausedAt=(this.context.currentTime-this._startedAt)*this.playbackRate,this.source.stop(),this.source.onended=null,this.isPlaying=!1),this},stop:function(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._pausedAt=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),this.isPlaying===!0?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this},setLoopStart:function(e){return this.loopStart=e,this},setLoopEnd:function(e){return this.loopEnd=e,this},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}});var ml=new Se,i1=new Or,$D=new Se,gl=new Se;function r1(e){rd.call(this,e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}r1.prototype=Object.assign(Object.create(rd.prototype),{constructor:r1,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this},updateMatrixWorld:function(e){if(on.prototype.updateMatrixWorld.call(this,e),!(this.hasPlaybackControl===!0&&this.isPlaying===!1)){this.matrixWorld.decompose(ml,i1,$D),gl.set(0,0,1).applyQuaternion(i1);var t=this.panner;if(t.positionX){var i=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(ml.x,i),t.positionY.linearRampToValueAtTime(ml.y,i),t.positionZ.linearRampToValueAtTime(ml.z,i),t.orientationX.linearRampToValueAtTime(gl.x,i),t.orientationY.linearRampToValueAtTime(gl.y,i),t.orientationZ.linearRampToValueAtTime(gl.z,i)}else t.setPosition(ml.x,ml.y,ml.z),t.setOrientation(gl.x,gl.y,gl.z)}}});function o1(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t!==void 0?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}Object.assign(o1.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),i=0;i<t.length;i++)e+=t[i];return e/t.length}});function a1(e,t,i){this.binding=e,this.valueSize=i;var l=Float64Array,u;switch(t){case"quaternion":u=this._slerp;break;case"string":case"bool":l=Array,u=this._select;break;default:u=this._lerp}this.buffer=new l(i*4),this._mixBufferRegion=u,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}Object.assign(a1.prototype,{accumulate:function(e,t){var i=this.buffer,l=this.valueSize,u=e*l+l,h=this.cumulativeWeight;if(h===0){for(var f=0;f!==l;++f)i[u+f]=i[f];h=t}else{h+=t;var r=t/h;this._mixBufferRegion(i,u,0,r,l)}this.cumulativeWeight=h},apply:function(e){var t=this.valueSize,i=this.buffer,l=e*t+t,u=this.cumulativeWeight,h=this.binding;if(this.cumulativeWeight=0,u<1){var f=t*3;this._mixBufferRegion(i,l,f,1-u,t)}for(var r=t,v=t+t;r!==v;++r)if(i[r]!==i[r+t]){h.setValue(i,l);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,i=this.valueSize,l=i*3;e.getValue(t,l);for(var u=i,h=l;u!==h;++u)t[u]=t[l+u%i];this.cumulativeWeight=0},restoreOriginalState:function(){var e=this.valueSize*3;this.binding.setValue(this.buffer,e)},_select:function(e,t,i,l,u){if(l>=.5)for(var h=0;h!==u;++h)e[t+h]=e[i+h]},_slerp:function(e,t,i,l){Or.slerpFlat(e,t,e,t,e,i,l)},_lerp:function(e,t,i,l,u){for(var h=1-l,f=0;f!==u;++f){var r=t+f;e[r]=e[r]*h+e[i+f]*l}}});var f_="\\[\\]\\.:\\/",qD=new RegExp("["+f_+"]","g"),m_="[^"+f_+"]",ZD="[^"+f_.replace("\\.","")+"]",XD=/((?:WC+[\/:])*)/.source.replace("WC",m_),YD=/(WCOD+)?/.source.replace("WCOD",ZD),JD=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",m_),KD=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",m_),QD=new RegExp("^"+XD+YD+JD+KD+"$"),eP=["material","materials","bones"];function s1(e,t,i){var l=i||mr.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,l)}Object.assign(s1.prototype,{getValue:function(e,t){this.bind();var i=this._targetGroup.nCachedObjects_,l=this._bindings[i];l!==void 0&&l.getValue(e,t)},setValue:function(e,t){for(var i=this._bindings,l=this._targetGroup.nCachedObjects_,u=i.length;l!==u;++l)i[l].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}});function mr(e,t,i){this.path=t,this.parsedPath=i||mr.parseTrackName(t),this.node=mr.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}Object.assign(mr,{Composite:s1,create:function(e,t,i){return e&&e.isAnimationObjectGroup?new mr.Composite(e,t,i):new mr(e,t,i)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(qD,"")},parseTrackName:function(e){var t=QD.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},l=i.nodeName&&i.nodeName.lastIndexOf(".");if(l!==void 0&&l!==-1){var u=i.nodeName.substring(l+1);eP.indexOf(u)!==-1&&(i.nodeName=i.nodeName.substring(0,l),i.objectName=u)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i},findNode:function(e,t){if(!t||t===""||t==="root"||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){var i=e.skeleton.getBoneByName(t);if(i!==void 0)return i}if(e.children){var l=function(h){for(var f=0;f<h.length;f++){var r=h[f];if(r.name===t||r.uuid===t)return r;var v=l(r.children);if(v)return v}return null},u=l(e.children);if(u)return u}return null}}),Object.assign(mr.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,i){t[i]=this.node[this.propertyName]},function(t,i){for(var l=this.resolvedProperty,u=0,h=l.length;u!==h;++u)t[i++]=l[u]},function(t,i){t[i]=this.resolvedProperty[this.propertyIndex]},function(t,i){this.resolvedProperty.toArray(t,i)}],SetterByBindingTypeAndVersioning:[[function(t,i){this.targetObject[this.propertyName]=t[i]},function(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.needsUpdate=!0},function(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,i){for(var l=this.resolvedProperty,u=0,h=l.length;u!==h;++u)l[u]=t[i++]},function(t,i){for(var l=this.resolvedProperty,u=0,h=l.length;u!==h;++u)l[u]=t[i++];this.targetObject.needsUpdate=!0},function(t,i){for(var l=this.resolvedProperty,u=0,h=l.length;u!==h;++u)l[u]=t[i++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,i){this.resolvedProperty[this.propertyIndex]=t[i]},function(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.needsUpdate=!0},function(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,i){this.resolvedProperty.fromArray(t,i)},function(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.needsUpdate=!0},function(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,i){this.bind(),this.getValue(t,i)},setValue:function(t,i){this.bind(),this.setValue(t,i)},bind:function(){var e=this.node,t=this.parsedPath,i=t.objectName,l=t.propertyName,u=t.propertyIndex;if(e||(e=mr.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(i){var h=t.objectIndex;switch(i){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(var f=0;f<e.length;f++)if(e[f].name===h){h=f;break}break;default:if(e[i]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[i]}if(h!==void 0){if(e[h]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[h]}}var r=e[l];if(r===void 0){var v=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+v+"."+l+" but it wasn't found.",e);return}var b=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?b=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(b=this.Versioning.MatrixWorldNeedsUpdate);var E=this.BindingType.Direct;if(u!==void 0){if(l==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}for(var f=0;f<this.node.geometry.morphAttributes.position.length;f++)if(e.geometry.morphAttributes.position[f].name===u){u=f;break}}else{if(!e.geometry.morphTargets){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);return}for(var f=0;f<this.node.geometry.morphTargets.length;f++)if(e.geometry.morphTargets[f].name===u){u=f;break}}}E=this.BindingType.ArrayElement,this.resolvedProperty=r,this.propertyIndex=u}else r.fromArray!==void 0&&r.toArray!==void 0?(E=this.BindingType.HasFromToArray,this.resolvedProperty=r):Array.isArray(r)?(E=this.BindingType.EntireArray,this.resolvedProperty=r):this.propertyName=l;this.getValue=this.GetterByBindingType[E],this.setValue=this.SetterByBindingTypeAndVersioning[E][b]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}});//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(mr.prototype,{_getValue_unbound:mr.prototype.getValue,_setValue_unbound:mr.prototype.setValue});function tP(){this.uuid=Wn.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,i=arguments.length;t!==i;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var l=this;this.stats={objects:{get total(){return l._objects.length},get inUse(){return this.total-l.nCachedObjects_}},get bindingsPerObject(){return l._bindings.length}}}Object.assign(tP.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,i=this.nCachedObjects_,l=this._indicesByUUID,u=this._paths,h=this._parsedPaths,f=this._bindings,r=f.length,v=void 0,b=0,E=arguments.length;b!==E;++b){var M=arguments[b],D=M.uuid,L=l[D];if(L===void 0){L=t++,l[D]=L,e.push(M);for(var z=0,k=r;z!==k;++z)f[z].push(new mr(M,u[z],h[z]))}else if(L<i){v=e[L];var F=--i,G=e[F];l[G.uuid]=L,e[L]=G,l[D]=F,e[F]=M;for(var z=0,k=r;z!==k;++z){var X=f[z],re=X[F],ue=X[L];X[L]=re,ue===void 0&&(ue=new mr(M,u[z],h[z])),X[F]=ue}}else e[L]!==v&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=i},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,i=this._indicesByUUID,l=this._bindings,u=l.length,h=0,f=arguments.length;h!==f;++h){var r=arguments[h],v=r.uuid,b=i[v];if(b!==void 0&&b>=t){var E=t++,M=e[E];i[M.uuid]=b,e[b]=M,i[v]=E,e[E]=r;for(var D=0,L=u;D!==L;++D){var z=l[D],k=z[E],F=z[b];z[b]=k,z[E]=F}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,i=this.nCachedObjects_,l=this._indicesByUUID,u=this._bindings,h=u.length,f=0,r=arguments.length;f!==r;++f){var v=arguments[f],b=v.uuid,E=l[b];if(E!==void 0)if(delete l[b],E<i){var M=--i,D=e[M],L=--t,z=e[L];l[D.uuid]=E,e[E]=D,l[z.uuid]=M,e[M]=z,e.pop();for(var k=0,F=h;k!==F;++k){var G=u[k],X=G[M],re=G[L];G[E]=X,G[M]=re,G.pop()}}else{var L=--t,z=e[L];l[z.uuid]=E,e[E]=z,e.pop();for(var k=0,F=h;k!==F;++k){var G=u[k];G[E]=G[L],G.pop()}}}this.nCachedObjects_=i},subscribe_:function(e,t){var i=this._bindingsIndicesByPath,l=i[e],u=this._bindings;if(l!==void 0)return u[l];var h=this._paths,f=this._parsedPaths,r=this._objects,v=r.length,b=this.nCachedObjects_,E=new Array(v);l=u.length,i[e]=l,h.push(e),f.push(t),u.push(E);for(var M=b,D=r.length;M!==D;++M){var L=r[M];E[M]=new mr(L,e,t)}return E},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,i=t[e];if(i!==void 0){var l=this._paths,u=this._parsedPaths,h=this._bindings,f=h.length-1,r=h[f],v=e[f];t[v]=i,h[i]=r,h.pop(),u[i]=u[f],u.pop(),l[i]=l[f],l.pop()}}});function l1(e,t,i){this._mixer=e,this._clip=t,this._localRoot=i||null;for(var l=t.tracks,u=l.length,h=new Array(u),f={endingStart:sc,endingEnd:sc},r=0;r!==u;++r){var v=l[r].createInterpolant(null);h[r]=v,v.settings=f}this._interpolantSettings=f,this._interpolants=h,this._propertyBindings=new Array(u),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=XT,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}Object.assign(l1.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){var l=this._clip.duration,u=e._clip.duration,h=u/l,f=l/u;e.warp(1,h,t),this.warp(f,1,t)}return this},crossFadeTo:function(e,t,i){return e.crossFadeFrom(this,t,i)},stopFading:function(){var e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,i){var l=this._mixer,u=l.time,h=this._timeScaleInterpolant,f=this.timeScale;h===null&&(h=l._lendControlInterpolant(),this._timeScaleInterpolant=h);var r=h.parameterPositions,v=h.sampleValues;return r[0]=u,r[1]=u+i,v[0]=e/f,v[1]=t/f,this},stopWarping:function(){var e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,i,l){if(!this.enabled){this._updateWeight(e);return}var u=this._startTime;if(u!==null){var h=(e-u)*i;if(h<0||i===0)return;this._startTime=null,t=i*h}t*=this._updateTimeScale(e);var f=this._updateTime(t),r=this._updateWeight(e);if(r>0)for(var v=this._interpolants,b=this._propertyBindings,E=0,M=v.length;E!==M;++E)v[E].evaluate(f),b[E].accumulate(l,r)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var i=this._weightInterpolant;if(i!==null){var l=i.evaluate(e)[0];t*=l,e>i.parameterPositions[1]&&(this.stopFading(),l===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var i=this._timeScaleInterpolant;if(i!==null){var l=i.evaluate(e)[0];t*=l,e>i.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e,i=this._clip.duration,l=this.loop,u=this._loopCount,h=l===YT;if(e===0)return u===-1?t:h&&(u&1)===1?i-t:t;if(l===ZT){u===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=i)t=i;else if(t<0)t=0;else{this.time=t;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(u===-1&&(e>=0?(u=0,this._setEndings(!0,this.repetitions===0,h)):this._setEndings(this.repetitions===0,!0,h)),t>=i||t<0){var f=Math.floor(t/i);t-=i*f,u+=Math.abs(f);var r=this.repetitions-u;if(r<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?i:0,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(r===1){var v=e<0;this._setEndings(v,!v,h)}else this._setEndings(!1,!1,h);this._loopCount=u,this.time=t,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:f})}}else this.time=t;if(h&&(u&1)===1)return i-t}return t},_setEndings:function(e,t,i){var l=this._interpolantSettings;i?(l.endingStart=lc,l.endingEnd=lc):(e?l.endingStart=this.zeroSlopeAtStart?lc:sc:l.endingStart=Yp,t?l.endingEnd=this.zeroSlopeAtEnd?lc:sc:l.endingEnd=Yp)},_scheduleFading:function(e,t,i){var l=this._mixer,u=l.time,h=this._weightInterpolant;h===null&&(h=l._lendControlInterpolant(),this._weightInterpolant=h);var f=h.parameterPositions,r=h.sampleValues;return f[0]=u,r[0]=t,f[1]=u+e,r[1]=i,this}});function c1(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}c1.prototype=Object.assign(Object.create(Ta.prototype),{constructor:c1,_bindAction:function(e,t){var i=e._localRoot||this._root,l=e._clip.tracks,u=l.length,h=e._propertyBindings,f=e._interpolants,r=i.uuid,v=this._bindingsByRootAndName,b=v[r];b===void 0&&(b={},v[r]=b);for(var E=0;E!==u;++E){var M=l[E],D=M.name,L=b[D];if(L!==void 0)h[E]=L;else{if(L=h[E],L!==void 0){L._cacheIndex===null&&(++L.referenceCount,this._addInactiveBinding(L,r,D));continue}var z=t&&t._propertyBindings[E].binding.parsedPath;L=new a1(mr.create(i,D,z),M.ValueTypeName,M.getValueSize()),++L.referenceCount,this._addInactiveBinding(L,r,D),h[E]=L}f[E].resultBuffer=L.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){var t=(e._localRoot||this._root).uuid,i=e._clip.uuid,l=this._actionsByClip[i];this._bindAction(e,l&&l.knownActions[0]),this._addInactiveAction(e,i,t)}for(var u=e._propertyBindings,h=0,f=u.length;h!==f;++h){var r=u[h];r.useCount++===0&&(this._lendBinding(r),r.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,i=0,l=t.length;i!==l;++i){var u=t[i];--u.useCount===0&&(u.restoreOriginalState(),this._takeBackBinding(u))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return t!==null&&t<this._nActiveActions},_addInactiveAction:function(e,t,i){var l=this._actions,u=this._actionsByClip,h=u[t];if(h===void 0)h={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,u[t]=h;else{var f=h.knownActions;e._byClipCacheIndex=f.length,f.push(e)}e._cacheIndex=l.length,l.push(e),h.actionByRoot[i]=e},_removeInactiveAction:function(e){var t=this._actions,i=t[t.length-1],l=e._cacheIndex;i._cacheIndex=l,t[l]=i,t.pop(),e._cacheIndex=null;var u=e._clip.uuid,h=this._actionsByClip,f=h[u],r=f.knownActions,v=r[r.length-1],b=e._byClipCacheIndex;v._byClipCacheIndex=b,r[b]=v,r.pop(),e._byClipCacheIndex=null;var E=f.actionByRoot,M=(e._localRoot||this._root).uuid;delete E[M],r.length===0&&delete h[u],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,i=0,l=t.length;i!==l;++i){var u=t[i];--u.referenceCount===0&&this._removeInactiveBinding(u)}},_lendAction:function(e){var t=this._actions,i=e._cacheIndex,l=this._nActiveActions++,u=t[l];e._cacheIndex=l,t[l]=e,u._cacheIndex=i,t[i]=u},_takeBackAction:function(e){var t=this._actions,i=e._cacheIndex,l=--this._nActiveActions,u=t[l];e._cacheIndex=l,t[l]=e,u._cacheIndex=i,t[i]=u},_addInactiveBinding:function(e,t,i){var l=this._bindingsByRootAndName,u=l[t],h=this._bindings;u===void 0&&(u={},l[t]=u),u[i]=e,e._cacheIndex=h.length,h.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,i=e.binding,l=i.rootNode.uuid,u=i.path,h=this._bindingsByRootAndName,f=h[l],r=t[t.length-1],v=e._cacheIndex;r._cacheIndex=v,t[v]=r,t.pop(),delete f[u],Object.keys(f).length===0&&delete h[l]},_lendBinding:function(e){var t=this._bindings,i=e._cacheIndex,l=this._nActiveBindings++,u=t[l];e._cacheIndex=l,t[l]=e,u._cacheIndex=i,t[i]=u},_takeBackBinding:function(e){var t=this._bindings,i=e._cacheIndex,l=--this._nActiveBindings,u=t[l];e._cacheIndex=l,t[l]=e,u._cacheIndex=i,t[i]=u},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return i===void 0&&(i=new Jf(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=t,e[t]=i),i},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,i=e.__cacheIndex,l=--this._nActiveControlInterpolants,u=t[l];e.__cacheIndex=l,t[l]=e,u.__cacheIndex=i,t[i]=u},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var i=t||this._root,l=i.uuid,u=typeof e=="string"?vo.findByName(i,e):e,h=u!==null?u.uuid:e,f=this._actionsByClip[h],r=null;if(f!==void 0){var v=f.actionByRoot[l];if(v!==void 0)return v;r=f.knownActions[0],u===null&&(u=r._clip)}if(u===null)return null;var b=new l1(this,u,t);return this._bindAction(b,r),this._addInactiveAction(b,h,l),b},existingAction:function(e,t){var i=t||this._root,l=i.uuid,u=typeof e=="string"?vo.findByName(i,e):e,h=u?u.uuid:e,f=this._actionsByClip[h];return f!==void 0&&f.actionByRoot[l]||null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,i=this._bindings,l=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var u=0;u!==t;++u)e[u].reset();for(var u=0;u!==l;++u)i[u].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,i=this._nActiveActions,l=this.time+=e,u=Math.sign(e),h=this._accuIndex^=1,f=0;f!==i;++f){var r=t[f];r._update(l,e,u,h)}for(var v=this._bindings,b=this._nActiveBindings,f=0;f!==b;++f)v[f].apply(h);return this},setTime:function(e){this.time=0;for(var t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,i=e.uuid,l=this._actionsByClip,u=l[i];if(u!==void 0){for(var h=u.knownActions,f=0,r=h.length;f!==r;++f){var v=h[f];this._deactivateAction(v);var b=v._cacheIndex,E=t[t.length-1];v._cacheIndex=null,v._byClipCacheIndex=null,E._cacheIndex=b,t[b]=E,t.pop(),this._removeInactiveBindingsForAction(v)}delete l[i]}},uncacheRoot:function(e){var t=e.uuid,i=this._actionsByClip;for(var l in i){var u=i[l].actionByRoot,h=u[t];h!==void 0&&(this._deactivateAction(h),this._removeInactiveAction(h))}var f=this._bindingsByRootAndName,r=f[t];if(r!==void 0)for(var v in r){var b=r[v];b.restoreOriginalState(),this._removeInactiveBinding(b)}},uncacheAction:function(e,t){var i=this.existingAction(e,t);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}});function g_(e){typeof e=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}g_.prototype.clone=function(){return new g_(this.value.clone===void 0?this.value:this.value.clone())};function u1(e,t,i){za.call(this,e,t),this.meshPerAttribute=i||1}u1.prototype=Object.assign(Object.create(za.prototype),{constructor:u1,isInstancedInterleavedBuffer:!0,copy:function(e){return za.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}});function nP(e,t,i,l){this.ray=new gc(e,t),this.near=i||0,this.far=l||1/0,this.camera=null,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function h1(e,t){return e.distance-t.distance}function y_(e,t,i,l){if(e.visible!==!1&&(e.raycast(t,i),l===!0))for(var u=e.children,h=0,f=u.length;h<f;h++)y_(u[h],t,i,!0)}Object.assign(nP.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,i){var l=i||[];return y_(e,this,l,t),l.sort(h1),l},intersectObjects:function(e,t,i){var l=i||[];if(Array.isArray(e)===!1)return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),l;for(var u=0,h=e.length;u<h;u++)y_(e[u],this,l,t);return l.sort(h1),l}});function iP(e,t,i){return this.radius=e!==void 0?e:1,this.phi=t!==void 0?t:0,this.theta=i!==void 0?i:0,this}Object.assign(iP.prototype,{set:function(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){var e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Wn.clamp(t/this.radius,-1,1))),this}});function rP(e,t,i){return this.radius=e!==void 0?e:1,this.theta=t!==void 0?t:0,this.y=i!==void 0?i:0,this}Object.assign(rP.prototype,{set:function(e,t,i){return this.radius=e,this.theta=t,this.y=i,this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}});var d1=new Lt;function p1(e,t){this.min=e!==void 0?e:new Lt(1/0,1/0),this.max=t!==void 0?t:new Lt(-1/0,-1/0)}Object.assign(p1.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var i=d1.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return e===void 0&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new Lt),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return e===void 0&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new Lt),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return t===void 0&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new Lt),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return t===void 0&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new Lt),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){var t=d1.copy(e).clamp(this.min,this.max);return t.sub(e).length()},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var f1=new Se,im=new Se;function m1(e,t){this.start=e!==void 0?e:new Se,this.end=t!==void 0?t:new Se}Object.assign(m1.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return e===void 0&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new Se),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return e===void 0&&(console.warn("THREE.Line3: .delta() target is now required"),e=new Se),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return t===void 0&&(console.warn("THREE.Line3: .at() target is now required"),t=new Se),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(e,t){f1.subVectors(e,this.start),im.subVectors(this.end,this.start);var i=im.dot(im),l=im.dot(f1),u=l/i;return t&&(u=Wn.clamp(u,0,1)),u},closestPointToPoint:function(e,t,i){var l=this.closestPointToPointParameter(e,t);return i===void 0&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),i=new Se),this.delta(i).multiplyScalar(l).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}});function rm(e){on.call(this),this.material=e,this.render=function(){}}rm.prototype=Object.create(on.prototype),rm.prototype.constructor=rm,rm.prototype.isImmediateRenderObject=!0;var g1=new Se;function od(e,t){on.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var i=new vn,l=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],u=0,h=1,f=32;u<f;u++,h++){var r=u/f*Math.PI*2,v=h/f*Math.PI*2;l.push(Math.cos(r),Math.sin(r),1,Math.cos(v),Math.sin(v),1)}i.setAttribute("position",new ln(l,3));var b=new Ri({fog:!1});this.cone=new Vi(i,b),this.add(this.cone),this.update()}od.prototype=Object.create(on.prototype),od.prototype.constructor=od,od.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},od.prototype.update=function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),g1.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(g1),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};var ds=new Se,om=new jn,__=new jn;function y1(e){var t=[];e&&e.isBone&&t.push(e);for(var i=0;i<e.children.length;i++)t.push.apply(t,y1(e.children[i]));return t}function ad(e){for(var t=y1(e),i=new vn,l=[],u=[],h=new tn(0,0,1),f=new tn(0,1,0),r=0;r<t.length;r++){var v=t[r];v.parent&&v.parent.isBone&&(l.push(0,0,0),l.push(0,0,0),u.push(h.r,h.g,h.b),u.push(f.r,f.g,f.b))}i.setAttribute("position",new ln(l,3)),i.setAttribute("color",new ln(u,3));var b=new Ri({vertexColors:nc,depthTest:!1,depthWrite:!1,transparent:!0});Vi.call(this,i,b),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}ad.prototype=Object.create(Vi.prototype),ad.prototype.constructor=ad,ad.prototype.updateMatrixWorld=function(e){var t=this.bones,i=this.geometry,l=i.getAttribute("position");__.getInverse(this.root.matrixWorld);for(var u=0,h=0;u<t.length;u++){var f=t[u];f.parent&&f.parent.isBone&&(om.multiplyMatrices(__,f.matrixWorld),ds.setFromMatrixPosition(om),l.setXYZ(h,ds.x,ds.y,ds.z),om.multiplyMatrices(__,f.parent.matrixWorld),ds.setFromMatrixPosition(om),l.setXYZ(h+1,ds.x,ds.y,ds.z),h+=2)}i.getAttribute("position").needsUpdate=!0,on.prototype.updateMatrixWorld.call(this,e)};function sd(e,t,i){this.light=e,this.light.updateMatrixWorld(),this.color=i;var l=new Uc(t,4,2),u=new lr({wireframe:!0,fog:!1});Ai.call(this,l,u),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}sd.prototype=Object.create(Ai.prototype),sd.prototype.constructor=sd,sd.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},sd.prototype.update=function(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)};var oP=new Se,_1=new tn,v1=new tn;function ld(e,t,i){on.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;var l=new Bc(t);l.rotateY(Math.PI*.5),this.material=new lr({wireframe:!0,fog:!1}),this.color===void 0&&(this.material.vertexColors=nc);var u=l.getAttribute("position"),h=new Float32Array(u.count*3);l.setAttribute("color",new zn(h,3)),this.add(new Ai(l,this.material)),this.update()}ld.prototype=Object.create(on.prototype),ld.prototype.constructor=ld,ld.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},ld.prototype.update=function(){var e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{var t=e.geometry.getAttribute("color");_1.copy(this.light.color),v1.copy(this.light.groundColor);for(var i=0,l=t.count;i<l;i++){var u=i<l/2?_1:v1;t.setXYZ(i,u.r,u.g,u.b)}t.needsUpdate=!0}e.lookAt(oP.setFromMatrixPosition(this.light.matrixWorld).negate())};function v_(e,t,i,l){e=e||10,t=t||10,i=new tn(i!==void 0?i:4473924),l=new tn(l!==void 0?l:8947848);for(var u=t/2,h=e/t,f=e/2,r=[],v=[],b=0,E=0,M=-f;b<=t;b++,M+=h){r.push(-f,0,M,f,0,M),r.push(M,0,-f,M,0,f);var D=b===u?i:l;D.toArray(v,E),E+=3,D.toArray(v,E),E+=3,D.toArray(v,E),E+=3,D.toArray(v,E),E+=3}var L=new vn;L.setAttribute("position",new ln(r,3)),L.setAttribute("color",new ln(v,3));var z=new Ri({vertexColors:nc});Vi.call(this,L,z)}v_.prototype=Object.assign(Object.create(Vi.prototype),{constructor:v_,copy:function(e){return Vi.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return new this.constructor().copy(this)}});function x_(e,t,i,l,u,h){e=e||10,t=t||16,i=i||8,l=l||64,u=new tn(u!==void 0?u:4473924),h=new tn(h!==void 0?h:8947848);var f=[],r=[],v,b,E,M,D,L,z;for(M=0;M<=t;M++)E=M/t*(Math.PI*2),v=Math.sin(E)*e,b=Math.cos(E)*e,f.push(0,0,0),f.push(v,0,b),z=M&1?u:h,r.push(z.r,z.g,z.b),r.push(z.r,z.g,z.b);for(M=0;M<=i;M++)for(z=M&1?u:h,L=e-e/i*M,D=0;D<l;D++)E=D/l*(Math.PI*2),v=Math.sin(E)*L,b=Math.cos(E)*L,f.push(v,0,b),r.push(z.r,z.g,z.b),E=(D+1)/l*(Math.PI*2),v=Math.sin(E)*L,b=Math.cos(E)*L,f.push(v,0,b),r.push(z.r,z.g,z.b);var k=new vn;k.setAttribute("position",new ln(f,3)),k.setAttribute("color",new ln(r,3));var F=new Ri({vertexColors:nc});Vi.call(this,k,F)}x_.prototype=Object.create(Vi.prototype),x_.prototype.constructor=x_;var x1=new Se,am=new Se,b1=new Se;function cd(e,t,i){on.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,t===void 0&&(t=1);var l=new vn;l.setAttribute("position",new ln([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var u=new Ri({fog:!1});this.lightPlane=new ao(l,u),this.add(this.lightPlane),l=new vn,l.setAttribute("position",new ln([0,0,0,0,0,1],3)),this.targetLine=new ao(l,u),this.add(this.targetLine),this.update()}cd.prototype=Object.create(on.prototype),cd.prototype.constructor=cd,cd.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},cd.prototype.update=function(){x1.setFromMatrixPosition(this.light.matrixWorld),am.setFromMatrixPosition(this.light.target.matrixWorld),b1.subVectors(am,x1),this.lightPlane.lookAt(am),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(am),this.targetLine.scale.z=b1.length()};var sm=new Se,zi=new Ia;function lm(e){var t=new vn,i=new Ri({color:16777215,vertexColors:j2}),l=[],u=[],h={},f=new tn(16755200),r=new tn(16711680),v=new tn(43775),b=new tn(16777215),E=new tn(3355443);M("n1","n2",f),M("n2","n4",f),M("n4","n3",f),M("n3","n1",f),M("f1","f2",f),M("f2","f4",f),M("f4","f3",f),M("f3","f1",f),M("n1","f1",f),M("n2","f2",f),M("n3","f3",f),M("n4","f4",f),M("p","n1",r),M("p","n2",r),M("p","n3",r),M("p","n4",r),M("u1","u2",v),M("u2","u3",v),M("u3","u1",v),M("c","t",b),M("p","c",E),M("cn1","cn2",E),M("cn3","cn4",E),M("cf1","cf2",E),M("cf3","cf4",E);function M(L,z,k){D(L,k),D(z,k)}function D(L,z){l.push(0,0,0),u.push(z.r,z.g,z.b),h[L]===void 0&&(h[L]=[]),h[L].push(l.length/3-1)}t.setAttribute("position",new ln(l,3)),t.setAttribute("color",new ln(u,3)),Vi.call(this,t,i),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=h,this.update()}lm.prototype=Object.create(Vi.prototype),lm.prototype.constructor=lm,lm.prototype.update=function(){var e=this.geometry,t=this.pointMap,i=1,l=1;zi.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Hi("c",t,e,zi,0,0,-1),Hi("t",t,e,zi,0,0,1),Hi("n1",t,e,zi,-i,-l,-1),Hi("n2",t,e,zi,i,-l,-1),Hi("n3",t,e,zi,-i,l,-1),Hi("n4",t,e,zi,i,l,-1),Hi("f1",t,e,zi,-i,-l,1),Hi("f2",t,e,zi,i,-l,1),Hi("f3",t,e,zi,-i,l,1),Hi("f4",t,e,zi,i,l,1),Hi("u1",t,e,zi,i*.7,l*1.1,-1),Hi("u2",t,e,zi,-i*.7,l*1.1,-1),Hi("u3",t,e,zi,0,l*2,-1),Hi("cf1",t,e,zi,-i,0,1),Hi("cf2",t,e,zi,i,0,1),Hi("cf3",t,e,zi,0,-l,1),Hi("cf4",t,e,zi,0,l,1),Hi("cn1",t,e,zi,-i,0,-1),Hi("cn2",t,e,zi,i,0,-1),Hi("cn3",t,e,zi,0,-l,-1),Hi("cn4",t,e,zi,0,l,-1),e.getAttribute("position").needsUpdate=!0};function Hi(e,t,i,l,u,h,f){sm.set(u,h,f).unproject(l);var r=t[e];if(r!==void 0)for(var v=i.getAttribute("position"),b=0,E=r.length;b<E;b++)v.setXYZ(r[b],sm.x,sm.y,sm.z)}var cm=new Do;function yl(e,t){this.object=e,t===void 0&&(t=16776960);var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),l=new Float32Array(8*3),u=new vn;u.setIndex(new zn(i,1)),u.setAttribute("position",new zn(l,3)),Vi.call(this,u,new Ri({color:t})),this.matrixAutoUpdate=!1,this.update()}yl.prototype=Object.create(Vi.prototype),yl.prototype.constructor=yl,yl.prototype.update=function(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&cm.setFromObject(this.object),!cm.isEmpty()){var t=cm.min,i=cm.max,l=this.geometry.attributes.position,u=l.array;u[0]=i.x,u[1]=i.y,u[2]=i.z,u[3]=t.x,u[4]=i.y,u[5]=i.z,u[6]=t.x,u[7]=t.y,u[8]=i.z,u[9]=i.x,u[10]=t.y,u[11]=i.z,u[12]=i.x,u[13]=i.y,u[14]=t.z,u[15]=t.x,u[16]=i.y,u[17]=t.z,u[18]=t.x,u[19]=t.y,u[20]=t.z,u[21]=i.x,u[22]=t.y,u[23]=t.z,l.needsUpdate=!0,this.geometry.computeBoundingSphere()}},yl.prototype.setFromObject=function(e){return this.object=e,this.update(),this},yl.prototype.copy=function(e){return Vi.prototype.copy.call(this,e),this.object=e.object,this},yl.prototype.clone=function(){return new this.constructor().copy(this)};function um(e,t){this.type="Box3Helper",this.box=e,t=t||16776960;var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),l=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],u=new vn;u.setIndex(new zn(i,1)),u.setAttribute("position",new ln(l,3)),Vi.call(this,u,new Ri({color:t})),this.geometry.computeBoundingSphere()}um.prototype=Object.create(Vi.prototype),um.prototype.constructor=um,um.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),on.prototype.updateMatrixWorld.call(this,e))};function hm(e,t,i){this.type="PlaneHelper",this.plane=e,this.size=t===void 0?1:t;var l=i!==void 0?i:16776960,u=[1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],h=new vn;h.setAttribute("position",new ln(u,3)),h.computeBoundingSphere(),ao.call(this,h,new Ri({color:l}));var f=[1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],r=new vn;r.setAttribute("position",new ln(f,3)),r.computeBoundingSphere(),this.add(new Ai(r,new lr({color:l,opacity:.2,transparent:!0,depthWrite:!1})))}hm.prototype=Object.create(ao.prototype),hm.prototype.constructor=hm,hm.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?tr:tc,this.lookAt(this.plane.normal),on.prototype.updateMatrixWorld.call(this,e)};var w1=new Se,dm,b_;function ps(e,t,i,l,u,h){on.call(this),e===void 0&&(e=new Se(0,0,1)),t===void 0&&(t=new Se(0,0,0)),i===void 0&&(i=1),l===void 0&&(l=16776960),u===void 0&&(u=.2*i),h===void 0&&(h=.2*u),dm===void 0&&(dm=new vn,dm.setAttribute("position",new ln([0,0,0,0,1,0],3)),b_=new cs(0,.5,1,5,1),b_.translate(0,-.5,0)),this.position.copy(t),this.line=new ao(dm,new Ri({color:l})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ai(b_,new lr({color:l})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,u,h)}ps.prototype=Object.create(on.prototype),ps.prototype.constructor=ps,ps.prototype.setDirection=function(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{w1.set(e.z,0,-e.x).normalize();var t=Math.acos(e.y);this.quaternion.setFromAxisAngle(w1,t)}},ps.prototype.setLength=function(e,t,i){t===void 0&&(t=.2*e),i===void 0&&(i=.2*t),this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()},ps.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},ps.prototype.copy=function(e){return on.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},ps.prototype.clone=function(){return new this.constructor().copy(this)};function w_(e){e=e||1;var t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],l=new vn;l.setAttribute("position",new ln(t,3)),l.setAttribute("color",new ln(i,3));var u=new Ri({vertexColors:nc});Vi.call(this,l,u)}w_.prototype=Object.create(Vi.prototype),w_.prototype.constructor=w_;var tu=4,fs=8,ea=Math.pow(2,fs),M1=[.125,.215,.35,.446,.526,.582],T1=fs-tu+1+M1.length,nu=20,ta={[no]:0,[mh]:1,[ty]:2,[Px]:3,[Lx]:4,[Ix]:5,[Dx]:6},M_=new eu,pm=cP(nu),ms=null,gs=null,{_lodPlanes:ud,_sizeLods:E1,_sigmas:fm}=aP(),mm=null,yi=null,T_=null,_l=(1+Math.sqrt(5))/2,iu=1/_l,C1=[new Se(1,1,1),new Se(-1,1,1),new Se(1,1,-1),new Se(-1,1,-1),new Se(0,_l,iu),new Se(0,_l,-iu),new Se(iu,0,_l),new Se(-iu,0,_l),new Se(_l,iu,0),new Se(-_l,iu,0)];function A1(e){yi=e,E_(pm)}A1.prototype={constructor:A1,fromScene:function(e,t=0,i=.1,l=100){T_=yi.getRenderTarget();var u=S1();return sP(e,i,l,u),t>0&&I1(u,0,0,t),L1(u),D1(u),u},fromEquirectangular:function(e){return e.magFilter=Ui,e.minFilter=Ui,e.generateMipmaps=!1,this.fromCubemap(e)},fromCubemap:function(e){T_=yi.getRenderTarget();var t=S1(e);return lP(e,t),L1(t),D1(t),t},compileCubemapShader:function(){gs==null&&(gs=k1(),E_(gs))},compileEquirectangularShader:function(){ms==null&&(ms=z1(),E_(ms))},dispose:function(){pm.dispose(),gs!=null&&gs.dispose(),ms!=null&&ms.dispose();for(var e=0;e<ud.length;e++)ud[e].dispose()}};function aP(){for(var e=[],t=[],i=[],l=fs,u=0;u<T1;u++){var h=Math.pow(2,l);t.push(h);var f=1/h;u>fs-tu?f=M1[u-fs+tu-1]:u==0&&(f=0),i.push(f);for(var r=1/(h-1),v=-r/2,b=1+r/2,E=[v,v,b,v,b,b,v,v,b,b,v,b],M=6,D=6,L=3,z=2,k=1,F=new Float32Array(L*D*M),G=new Float32Array(z*D*M),X=new Float32Array(k*D*M),re=0;re<M;re++){var ue=re%3*2/3-1,$=re>2?0:-1,te=[ue,$,0,ue+2/3,$,0,ue+2/3,$+1,0,ue,$,0,ue+2/3,$+1,0,ue,$+1,0];F.set(te,L*D*re),G.set(E,z*D*re);var oe=[re,re,re,re,re,re];X.set(oe,k*D*re)}var ie=new vn;ie.setAttribute("position",new zn(F,L)),ie.setAttribute("uv",new zn(G,z)),ie.setAttribute("faceIndex",new zn(X,k)),e.push(ie),l>tu&&l--}return{_lodPlanes:e,_sizeLods:t,_sigmas:i}}function S1(e){var t={magFilter:Ui,minFilter:Ui,generateMipmaps:!1,type:e?e.type:qp,format:e?e.format:CT,encoding:e?e.encoding:ty,depthBuffer:!1,stencilBuffer:!1},i=P1(t);return i.depthBuffer=!e,mm=P1(t),i}function D1(e){mm.dispose(),yi.setRenderTarget(T_),e.scissorTest=!1,e.setSize(e.width,e.height)}function sP(e,t,i,l){var u=90,h=1,f=new Zi(u,h,t,i),r=[1,1,1,1,-1,1],v=[1,1,-1,-1,-1,1],b=yi.outputEncoding,E=yi.toneMapping,M=yi.toneMappingExposure,D=yi.getClearColor(),L=yi.getClearAlpha();yi.toneMapping=$g,yi.toneMappingExposure=1,yi.outputEncoding=no,e.scale.z*=-1;var z=e.background;if(z&&z.isColor){z.convertSRGBToLinear();var k=Math.max(z.r,z.g,z.b),F=Math.min(Math.max(Math.ceil(Math.log2(k)),-128),127);z=z.multiplyScalar(Math.pow(2,-F));var G=(F+128)/255;yi.setClearColor(z,G),e.background=null}for(var X=0;X<6;X++){var re=X%3;re==0?(f.up.set(0,r[X],0),f.lookAt(v[X],0,0)):re==1?(f.up.set(0,0,r[X]),f.lookAt(0,v[X],0)):(f.up.set(0,r[X],0),f.lookAt(0,0,v[X])),C_(l,re*ea,X>2?ea:0,ea,ea),yi.setRenderTarget(l),yi.render(e,f)}yi.toneMapping=E,yi.toneMappingExposure=M,yi.outputEncoding=b,yi.setClearColor(D,L),e.scale.z*=-1}function lP(e,t){var i=new Ca;e.isCubeTexture?gs==null&&(gs=k1()):ms==null&&(ms=z1());var l=e.isCubeTexture?gs:ms;i.add(new Ai(ud[0],l));var u=l.uniforms;u.envMap.value=e,e.isCubeTexture||u.texelSize.value.set(1/e.image.width,1/e.image.height),u.inputEncoding.value=ta[e.encoding],u.outputEncoding.value=ta[e.encoding],C_(t,0,0,3*ea,2*ea),yi.setRenderTarget(t),yi.render(i,M_)}function E_(e){var t=new Ca;t.add(new Ai(ud[0],e)),yi.compile(t,M_)}function P1(e){var t=new Mr(3*ea,3*ea,e);return t.texture.mapping=uh,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function C_(e,t,i,l,u){e.viewport.set(t,i,l,u),e.scissor.set(t,i,l,u)}function L1(e){var t=yi.autoClear;yi.autoClear=!1;for(var i=1;i<T1;i++){var l=Math.sqrt(fm[i]*fm[i]-fm[i-1]*fm[i-1]),u=C1[(i-1)%C1.length];I1(e,i-1,i,l,u)}yi.autoClear=t}function I1(e,t,i,l,u){R1(e,mm,t,i,l,"latitudinal",u),R1(mm,e,i,i,l,"longitudinal",u)}function R1(e,t,i,l,u,h,f){h!=="latitudinal"&&h!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");var r=3,v=new Ca;v.add(new Ai(ud[l],pm));var b=pm.uniforms,E=E1[i]-1,M=isFinite(u)?Math.PI/(2*E):2*Math.PI/(2*nu-1),D=u/M,L=isFinite(u)?1+Math.floor(r*D):nu;L>nu&&console.warn(`sigmaRadians, ${u}, is too large and will clip, as it requested ${L} samples when the maximum is set to ${nu}`);for(var z=[],k=0,F=0;F<nu;++F){var re=F/D,G=Math.exp(-re*re/2);z.push(G),F==0?k+=G:F<L&&(k+=2*G)}for(var F=0;F<z.length;F++)z[F]=z[F]/k;b.envMap.value=e.texture,b.samples.value=L,b.weights.value=z,b.latitudinal.value=h==="latitudinal",f&&(b.poleAxis.value=f),b.dTheta.value=M,b.mipInt.value=fs-i,b.inputEncoding.value=ta[e.texture.encoding],b.outputEncoding.value=ta[e.texture.encoding];var X=E1[l],re=3*Math.max(0,ea-2*X),ue=(l===0?0:2*ea)+2*X*(l>fs-tu?l-fs+tu:0);C_(t,re,ue,3*X,2*X),yi.setRenderTarget(t),yi.render(v,M_)}function cP(e){var t=new Float32Array(e),i=new Se(0,1,0),l=new us({defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i},inputEncoding:{value:ta[no]},outputEncoding:{value:ta[no]}},vertexShader:A_(),fragmentShader:`
precision mediump float;
precision mediump int;
varying vec3 vOutputDirection;
uniform sampler2D envMap;
uniform int samples;
uniform float weights[n];
uniform bool latitudinal;
uniform float dTheta;
uniform float mipInt;
uniform vec3 poleAxis;

${S_()}

#define ENVMAP_TYPE_CUBE_UV
#include <cube_uv_reflection_fragment>

void main() {
	gl_FragColor = vec4(0.0);
	for (int i = 0; i < n; i++) {
		if (i >= samples)
			break;
		for (int dir = -1; dir < 2; dir += 2) {
			if (i == 0 && dir == 1)
				continue;
			vec3 axis = latitudinal ? poleAxis : cross(poleAxis, vOutputDirection);
			if (all(equal(axis, vec3(0.0))))
				axis = cross(vec3(0.0, 1.0, 0.0), vOutputDirection);
			axis = normalize(axis);
			float theta = dTheta * float(dir * i);
			float cosTheta = cos(theta);
			// Rodrigues' axis-angle rotation
			vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross(axis, vOutputDirection) * sin(theta)
					+ axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);
			gl_FragColor.rgb +=
					weights[i] * bilinearCubeUV(envMap, sampleDirection, mipInt);
		}
	}
	gl_FragColor = linearToOutputTexel(gl_FragColor);
}
		`,blending:es,depthTest:!1,depthWrite:!1});return l.type="SphericalGaussianBlur",l}function z1(){var e=new Lt(1,1),t=new us({uniforms:{envMap:{value:null},texelSize:{value:e},inputEncoding:{value:ta[no]},outputEncoding:{value:ta[no]}},vertexShader:A_(),fragmentShader:`
precision mediump float;
precision mediump int;
varying vec3 vOutputDirection;
uniform sampler2D envMap;
uniform vec2 texelSize;

${S_()}

#define RECIPROCAL_PI 0.31830988618
#define RECIPROCAL_PI2 0.15915494

void main() {
	gl_FragColor = vec4(0.0);
	vec3 outputDirection = normalize(vOutputDirection);
	vec2 uv;
	uv.y = asin(clamp(outputDirection.y, -1.0, 1.0)) * RECIPROCAL_PI + 0.5;
	uv.x = atan(outputDirection.z, outputDirection.x) * RECIPROCAL_PI2 + 0.5;
	vec2 f = fract(uv / texelSize - 0.5);
	uv -= f * texelSize;
	vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	uv.x += texelSize.x;
	vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	uv.y += texelSize.y;
	vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	uv.x -= texelSize.x;
	vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	vec3 tm = mix(tl, tr, f.x);
	vec3 bm = mix(bl, br, f.x);
	gl_FragColor.rgb = mix(tm, bm, f.y);
	gl_FragColor = linearToOutputTexel(gl_FragColor);
}
		`,blending:es,depthTest:!1,depthWrite:!1});return t.type="EquirectangularToCubeUV",t}function k1(){var e=new us({uniforms:{envMap:{value:null},inputEncoding:{value:ta[no]},outputEncoding:{value:ta[no]}},vertexShader:A_(),fragmentShader:`
precision mediump float;
precision mediump int;
varying vec3 vOutputDirection;
uniform samplerCube envMap;

${S_()}

void main() {
	gl_FragColor = vec4(0.0);
	gl_FragColor.rgb = envMapTexelToLinear(textureCube(envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ))).rgb;
	gl_FragColor = linearToOutputTexel(gl_FragColor);
}
		`,blending:es,depthTest:!1,depthWrite:!1});return e.type="CubemapToCubeUV",e}function A_(){return`
precision mediump float;
precision mediump int;
attribute vec3 position;
attribute vec2 uv;
attribute float faceIndex;
varying vec3 vOutputDirection;
vec3 getDirection(vec2 uv, float face) {
	uv = 2.0 * uv - 1.0;
	vec3 direction = vec3(uv, 1.0);
	if (face == 0.0) {
		direction = direction.zyx;
		direction.z *= -1.0;
	} else if (face == 1.0) {
		direction = direction.xzy;
		direction.z *= -1.0;
	} else if (face == 3.0) {
		direction = direction.zyx;
		direction.x *= -1.0;
	} else if (face == 4.0) {
		direction = direction.xzy;
		direction.y *= -1.0;
	} else if (face == 5.0) {
		direction.xz *= -1.0;
	}
	return direction;
}
void main() {
	vOutputDirection = getDirection(uv, faceIndex);
	gl_Position = vec4( position, 1.0 );
}
	`}function S_(){return`
uniform int inputEncoding;
uniform int outputEncoding;

#include <encodings_pars_fragment>

vec4 inputTexelToLinear(vec4 value){
	if(inputEncoding == 0){
		return value;
	}else if(inputEncoding == 1){
		return sRGBToLinear(value);
	}else if(inputEncoding == 2){
		return RGBEToLinear(value);
	}else if(inputEncoding == 3){
		return RGBMToLinear(value, 7.0);
	}else if(inputEncoding == 4){
		return RGBMToLinear(value, 16.0);
	}else if(inputEncoding == 5){
		return RGBDToLinear(value, 256.0);
	}else{
		return GammaToLinear(value, 2.2);
	}
}

vec4 linearToOutputTexel(vec4 value){
	if(outputEncoding == 0){
		return value;
	}else if(outputEncoding == 1){
		return LinearTosRGB(value);
	}else if(outputEncoding == 2){
		return LinearToRGBE(value);
	}else if(outputEncoding == 3){
		return LinearToRGBM(value, 7.0);
	}else if(outputEncoding == 4){
		return LinearToRGBM(value, 16.0);
	}else if(outputEncoding == 5){
		return LinearToRGBD(value, 256.0);
	}else{
		return LinearToGamma(value, 2.2);
	}
}

vec4 envMapTexelToLinear(vec4 color) {
	return inputTexelToLinear(color);
}
	`}Sn.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Sn.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(hs.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new Fn,i=0,l=e.length;i<l;i++){var u=e[i];t.vertices.push(new Se(u.x,u.y,u.z||0))}return t}}),Object.assign(Ko.prototype,{fromPoints:function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),Object.create(lo.prototype),Object.create(lo.prototype);function B1(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),lo.call(this,e),this.type="catmullrom"}B1.prototype=Object.create(lo.prototype),Object.assign(B1.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),v_.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},ad.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(ri.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),dl.extractUrlBase(e)}}),ri.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(h_.prototype,{setTexturePath:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),Object.assign(p1.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(Do.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Ch.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},m1.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(Wn,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),Wn.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),Wn.ceilPowerOfTwo(e)}}),Object.assign(dr.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(jn.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new Se().setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,i,l,u,h){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,l,i,u,h)}}),jo.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Or.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(gc.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(sr.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(sr,{barycoordFromPoint:function(e,t,i,l,u){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),sr.getBarycoord(e,t,i,l,u)},normal:function(e,t,i,l){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),sr.getNormal(e,t,i,l)}}),Object.assign(hl.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Nc(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Vc(this,e)}}),Object.assign(Lt.prototype,{fromAttribute:function(e,t,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Se.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(gi.prototype,{fromAttribute:function(e,t,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Fn.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.assign(on.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(on.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(Ai.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(Ai.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),JT},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(bf.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(wf.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),kh.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Sn.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),Zi.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),t!==void 0&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Mi.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(zn.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===gh},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(gh)}}}),Object.assign(zn.prototype,{setDynamic:function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(e===!0?gh:Jp),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(vn.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addAttribute:function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(t&&t.isBufferAttribute)&&!(t&&t.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new zn(arguments[1],arguments[2]))):e==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t)},addDrawCall:function(e,t,i){i!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},applyMatrix:function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(vn.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(za.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===gh},set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}}),Object.assign(za.prototype,{setDynamic:function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(e===!0?gh:Jp),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(ka.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(g_.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Rn.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new tn}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===sx}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(ul.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(Nr.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(y0.prototype,{clearTarget:function(e,t,i,l){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,i,l)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(y0.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=e===!0?mh:no}}}),Object.defineProperties(m0.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Mr.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(rd.prototype,{load:{value:function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this,i=new d_;return i.load(e,function(l){t.setBuffer(l)}),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),o1.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Eh.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},Js.crossOrigin=void 0,Js.loadTexture=function(e,t,i,l){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var u=new ed;u.setCrossOrigin(this.crossOrigin);var h=u.load(e,i,void 0,l);return t&&(h.mapping=t),h},Js.loadTextureCube=function(e,t,i,l){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var u=new Zy;u.setCrossOrigin(this.crossOrigin);var h=u.load(e,i,void 0,l);return t&&(h.mapping=t),h},Js.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},Js.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")},typeof __THREE_DEVTOOLS__!="undefined"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:V2}}));class gm extends Le.MxDbAlignedDimension{constructor(){super()}getDimText(){var t=new Se(this.point1.x-this.point2.x,this.point1.y-this.point2.y,0),i=t.length();return i.toFixed(2)}create(){return new gm}getTypeName(){return this.constructor.name}}function uP(){return lt(this,null,function*(){const e=new Le.MrxDbgUiPrPoint;e.setMessage(`
指定第一点:`),e.go(t=>{if(t!=0)return;const i=e.value();let l=new gm;l.setPoint1(i),l.setColor(65314);const u=new Le.McEdGetPointWorldDrawObject;u.setDraw(h=>{l.setPoint2(h),u.drawCustomEntity(l)}),e.setBasePt(i),e.setUseBasePt(!0),e.setUserDraw(u),e.setMessage(`
指定第二点:`),e.setInputToucheType(Le.MxType.InputToucheType.kGetEnd),e.go(h=>{if(h!=0){console.log(h);return}const f=e.value();l.setPoint2(f),Le.MxFun.getCurrentDraw().addMxEntity(l),alert("测试长度是："+l.getDimText())})})})}function hP(){const e=new Le.MrxDbgUiPrPoint,t=Le.MxFun.getCurrentDraw(),i=new Le.MxDb2LineAngularDimension;i.color=P.MxCpp.getCurrentMxCAD().getCurrentDatabaseDrawColor();const l=new Le.McEdGetPointWorldDrawObject;l.setColor(P.MxCpp.getCurrentMxCAD().getCurrentDatabaseDrawColor()),e.setMessage(`
指定第一点:`),e.go(u=>{u===0&&(e.setMessage(`
指定第二个角度点:`),i.point1=e.value(),l.setDraw((h,f)=>{i.point2=h,f.drawLine(i.point1,h)}),e.setUserDraw(l),e.go(h=>{e.setMessage(`
指定最后一个点:`),h===0&&(i.point2=e.value(),l.setDraw((f,r)=>{i.point3=f,l.drawCustomEntity(i)}),e.go(f=>{f===0&&t.addMxEntity(i)}))}))})}function dP(){const e=new Le.MrxDbgUiPrPoint;e.setMessage(`
指定坐标点:`),e.go(t=>{if(t!=0)return;const i=e.value();let l=new Le.MxDbCoord;l.point1=i,l.point2=i.clone(),l.color=P.MxCpp.getCurrentMxCAD().getCurrentDatabaseDrawColor(),e.setBasePt(i),e.setUseBasePt(!0),e.setUserDraw((u,h)=>{l.point2=u,h.drawCustomEntity(l)}),e.setMessage(`
指定标注点:`),e.go(u=>{if(u!=0){console.log(u);return}l.point2=e.value(),Le.MxFun.addToCurrentSpace(l)})})}function pP(){new gm().rxInit(),Le.MxFun.addCommand("Mx_Linear",uP),Le.MxFun.addCommand("BR_AngleMeasure",hP),Le.MxFun.addCommand("BR_CoordMeasure",dP)}function fP(){return lt(this,null,function*(){let e=new P.MxCADUiPrEntity;e.setMessage("select entity:");let i=(yield e.go()).getMcDbEntity();if(i!==null){if(console.log("ent.objectName",i.objectName),i instanceof P.McDbBlockReference){let u=i.explode();if(u.GetCount()==0)return;let h=u.GetCount();for(let f=0;f<h;f++){let r=u.AtObject(f).val;if(r instanceof P.McDbPolyline){let v=r,b=v.numVerts();for(let E=0;E<b;E++){let M=v.getPointAt(E),D=v.getBulgeAt(E);console.log("polyline.pt"+E+":"+Er(M.val)),console.log("polyline.bulge"+E+":"+D)}}}}else if(i instanceof P.McDbPolyline){let l=i,u=l.numVerts();for(let h=0;h<u;h++){let f=l.getPointAt(h),r=l.getBulgeAt(h);console.log("polyline.pt"+h+":"+Er(f.val)),console.log("polyline.bulge"+h+":"+r)}}}})}function mP(){Le.MxFun.addCommand("MxTest_SelectEntity",fP)}class gP{constructor(){this.m_aryColumn=[],this.m_allData=[],this.m_dColumnHeight=14,this.m_dRowHeight=10,this.m_dRowLineWdith=0,this.m_dColumnLineWidth=.5,this.m_dRowTextHeight=6,this.m_dColumnTextHeight=10}addColumn(t,i){this.m_aryColumn.push({name:t,w:i})}addRow(t){this.m_allData.push(t)}}class F1{constructor(){this.data=new gP,this.pt=new P.McGePoint3d,this.dScale=1,this.mxcad=P.MxCpp.getCurrentMxCAD()}draw(t,i){return this.pt=t,this.dScale=i,this.data.m_aryColumn.length==0||this.data.m_allData.length==0?!1:(this.DrawTableHead(),this.DrawContent(),!0)}DrawTableHead(){let t=this.data,i=this.pt.clone(),l=this.pt.clone(),u=new P.McGeVector3d(0,1,0).mult(this.Scale(this.data.m_dColumnHeight));console.log(u);let h=this.Scale(this.data.m_dColumnLineWidth),f=0,r=new P.McGeVector3d(1,0,0);for(let v=0;v<t.m_aryColumn.length;v++){let b=t.m_aryColumn[v];this.DrawLine(l,l.clone().subvec(u),h),this.DrawMCText(l.clone().addvec(r.clone().mult(this.Scale(b.w)*.5)).subvec(u.clone().mult(.5)),b.name,this.Scale(t.m_dColumnTextHeight)),l.addvec(r.clone().mult(this.Scale(b.w))),f+=this.Scale(b.w)}return this.DrawLine(l,l.clone().subvec(u),h),this.DrawLine(i,i.clone().addvec(r.clone().mult(f)),h),this.DrawLine(i.clone().subvec(u),i.addvec(r.clone().mult(f)).subvec(u),h),!0}DrawContent(){let t=this.data,i=this.pt,l=0;for(let b=0;b<t.m_aryColumn.length;b++)l+=this.Scale(t.m_aryColumn[b].w);let u=this.Scale(this.data.m_dRowLineWdith),h=new P.McGeVector3d(1,0,0),f=new P.McGeVector3d(0,1,0),r=i.clone().subvec(f.clone().mult(this.Scale(t.m_dColumnHeight))),v=f.clone().mult(this.Scale(t.m_dRowHeight));for(let b=0;b<t.m_allData.length;b++){let E=r.clone();for(let M=0;M<t.m_aryColumn.length;M++){let D=t.m_aryColumn[M];this.DrawLine(E,E.clone().subvec(v),u),this.DrawMCText(E.clone().addvec(h.clone().mult(this.Scale(D.w*.5))).subvec(v.clone().mult(.5)),t.m_allData[b][M],this.Scale(t.m_dRowTextHeight)),E.addvec(h.clone().mult(this.Scale(D.w)))}this.DrawLine(E,E.clone().subvec(v),u),this.DrawLine(r,r.clone().addvec(h.clone().mult(l)),u),this.DrawLine(r.clone().subvec(v),r.clone().addvec(h.clone().mult(l)).subvec(v),u),r.subvec(v)}return!0}DrawLine(t,i,l){this.mxcad.drawLineWidth=l,this.mxcad.drawColorIndex=P.ColorIndexType.kMagenta,this.mxcad.drawLine(t.x,t.y,i.x,i.y)}DrawMCText(t,i,l){this.mxcad.drawColorIndex=0,this.mxcad.drawColor=new P.McCmColor(0,255,0),this.mxcad.drawText(t.x,t.y,i,l,0,P.McDb.TextHorzMode.kTextMid,P.McDb.TextVertMode.kTextVertMid)}Scale(t){return t*this.dScale}}var yP=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function O1(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var N1={exports:{}};(function(e,t){var i=function(){var l=function($,te){var oe=236,ie=17,se=$,pe=h[te],me=null,he=0,Ue=null,Ve=[],$e={},ct=function(fe,Ee){he=se*4+17,me=function(Ce){for(var ye=new Array(Ce),Oe=0;Oe<Ce;Oe+=1){ye[Oe]=new Array(Ce);for(var Ke=0;Ke<Ce;Ke+=1)ye[Oe][Ke]=null}return ye}(he),At(0,0),At(he-7,0),At(0,he-7),It(),St(),Ie(fe,Ee),se>=7&&Nt(fe),Ue==null&&(Ue=Ge(se,pe,Ve)),xe(Ue,Ee)},At=function(fe,Ee){for(var Ce=-1;Ce<=7;Ce+=1)if(!(fe+Ce<=-1||he<=fe+Ce))for(var ye=-1;ye<=7;ye+=1)Ee+ye<=-1||he<=Ee+ye||(0<=Ce&&Ce<=6&&(ye==0||ye==6)||0<=ye&&ye<=6&&(Ce==0||Ce==6)||2<=Ce&&Ce<=4&&2<=ye&&ye<=4?me[fe+Ce][Ee+ye]=!0:me[fe+Ce][Ee+ye]=!1)},yt=function(){for(var fe=0,Ee=0,Ce=0;Ce<8;Ce+=1){ct(!0,Ce);var ye=r.getLostPoint($e);(Ce==0||fe>ye)&&(fe=ye,Ee=Ce)}return Ee},St=function(){for(var fe=8;fe<he-8;fe+=1)me[fe][6]==null&&(me[fe][6]=fe%2==0);for(var Ee=8;Ee<he-8;Ee+=1)me[6][Ee]==null&&(me[6][Ee]=Ee%2==0)},It=function(){for(var fe=r.getPatternPosition(se),Ee=0;Ee<fe.length;Ee+=1)for(var Ce=0;Ce<fe.length;Ce+=1){var ye=fe[Ee],Oe=fe[Ce];if(me[ye][Oe]==null)for(var Ke=-2;Ke<=2;Ke+=1)for(var st=-2;st<=2;st+=1)Ke==-2||Ke==2||st==-2||st==2||Ke==0&&st==0?me[ye+Ke][Oe+st]=!0:me[ye+Ke][Oe+st]=!1}},Nt=function(fe){for(var Ee=r.getBCHTypeNumber(se),Ce=0;Ce<18;Ce+=1){var ye=!fe&&(Ee>>Ce&1)==1;me[Math.floor(Ce/3)][Ce%3+he-8-3]=ye}for(var Ce=0;Ce<18;Ce+=1){var ye=!fe&&(Ee>>Ce&1)==1;me[Ce%3+he-8-3][Math.floor(Ce/3)]=ye}},Ie=function(fe,Ee){for(var Ce=pe<<3|Ee,ye=r.getBCHTypeInfo(Ce),Oe=0;Oe<15;Oe+=1){var Ke=!fe&&(ye>>Oe&1)==1;Oe<6?me[Oe][8]=Ke:Oe<8?me[Oe+1][8]=Ke:me[he-15+Oe][8]=Ke}for(var Oe=0;Oe<15;Oe+=1){var Ke=!fe&&(ye>>Oe&1)==1;Oe<8?me[8][he-Oe-1]=Ke:Oe<9?me[8][15-Oe-1+1]=Ke:me[8][15-Oe-1]=Ke}me[he-8][8]=!fe},xe=function(fe,Ee){for(var Ce=-1,ye=he-1,Oe=7,Ke=0,st=r.getMaskFunction(Ee),wt=he-1;wt>0;wt-=2)for(wt==6&&(wt-=1);;){for(var Gt=0;Gt<2;Gt+=1)if(me[ye][wt-Gt]==null){var de=!1;Ke<fe.length&&(de=(fe[Ke]>>>Oe&1)==1);var we=st(ye,wt-Gt);we&&(de=!de),me[ye][wt-Gt]=de,Oe-=1,Oe==-1&&(Ke+=1,Oe=7)}if(ye+=Ce,ye<0||he<=ye){ye-=Ce,Ce=-Ce;break}}},He=function(fe,Ee){for(var Ce=0,ye=0,Oe=0,Ke=new Array(Ee.length),st=new Array(Ee.length),wt=0;wt<Ee.length;wt+=1){var Gt=Ee[wt].dataCount,de=Ee[wt].totalCount-Gt;ye=Math.max(ye,Gt),Oe=Math.max(Oe,de),Ke[wt]=new Array(Gt);for(var we=0;we<Ke[wt].length;we+=1)Ke[wt][we]=255&fe.getBuffer()[we+Ce];Ce+=Gt;var bt=r.getErrorCorrectPolynomial(de),gt=b(Ke[wt],bt.getLength()-1),bn=gt.mod(bt);st[wt]=new Array(bt.getLength()-1);for(var we=0;we<st[wt].length;we+=1){var hn=we+bn.getLength()-st[wt].length;st[wt][we]=hn>=0?bn.getAt(hn):0}}for(var nn=0,we=0;we<Ee.length;we+=1)nn+=Ee[we].totalCount;for(var pn=new Array(nn),wn=0,we=0;we<ye;we+=1)for(var wt=0;wt<Ee.length;wt+=1)we<Ke[wt].length&&(pn[wn]=Ke[wt][we],wn+=1);for(var we=0;we<Oe;we+=1)for(var wt=0;wt<Ee.length;wt+=1)we<st[wt].length&&(pn[wn]=st[wt][we],wn+=1);return pn},Ge=function(fe,Ee,Ce){for(var ye=E.getRSBlocks(fe,Ee),Oe=M(),Ke=0;Ke<Ce.length;Ke+=1){var st=Ce[Ke];Oe.put(st.getMode(),4),Oe.put(st.getLength(),r.getLengthInBits(st.getMode(),fe)),st.write(Oe)}for(var wt=0,Ke=0;Ke<ye.length;Ke+=1)wt+=ye[Ke].dataCount;if(Oe.getLengthInBits()>wt*8)throw"code length overflow. ("+Oe.getLengthInBits()+">"+wt*8+")";for(Oe.getLengthInBits()+4<=wt*8&&Oe.put(0,4);Oe.getLengthInBits()%8!=0;)Oe.putBit(!1);for(;!(Oe.getLengthInBits()>=wt*8||(Oe.put(oe,8),Oe.getLengthInBits()>=wt*8));)Oe.put(ie,8);return He(Oe,ye)};$e.addData=function(fe,Ee){Ee=Ee||"Byte";var Ce=null;switch(Ee){case"Numeric":Ce=D(fe);break;case"Alphanumeric":Ce=L(fe);break;case"Byte":Ce=z(fe);break;case"Kanji":Ce=k(fe);break;default:throw"mode:"+Ee}Ve.push(Ce),Ue=null},$e.isDark=function(fe,Ee){if(fe<0||he<=fe||Ee<0||he<=Ee)throw fe+","+Ee;return me[fe][Ee]},$e.getModuleCount=function(){return he},$e.make=function(){if(se<1){for(var fe=1;fe<40;fe++){for(var Ee=E.getRSBlocks(fe,pe),Ce=M(),ye=0;ye<Ve.length;ye++){var Oe=Ve[ye];Ce.put(Oe.getMode(),4),Ce.put(Oe.getLength(),r.getLengthInBits(Oe.getMode(),fe)),Oe.write(Ce)}for(var Ke=0,ye=0;ye<Ee.length;ye++)Ke+=Ee[ye].dataCount;if(Ce.getLengthInBits()<=Ke*8)break}se=fe}ct(!1,yt())},$e.createTableTag=function(fe,Ee){fe=fe||2,Ee=typeof Ee=="undefined"?fe*4:Ee;var Ce="";Ce+='<table style="',Ce+=" border-width: 0px; border-style: none;",Ce+=" border-collapse: collapse;",Ce+=" padding: 0px; margin: "+Ee+"px;",Ce+='">',Ce+="<tbody>";for(var ye=0;ye<$e.getModuleCount();ye+=1){Ce+="<tr>";for(var Oe=0;Oe<$e.getModuleCount();Oe+=1)Ce+='<td style="',Ce+=" border-width: 0px; border-style: none;",Ce+=" border-collapse: collapse;",Ce+=" padding: 0px; margin: 0px;",Ce+=" width: "+fe+"px;",Ce+=" height: "+fe+"px;",Ce+=" background-color: ",Ce+=$e.isDark(ye,Oe)?"#000000":"#ffffff",Ce+=";",Ce+='"/>';Ce+="</tr>"}return Ce+="</tbody>",Ce+="</table>",Ce},$e.createSvgTag=function(fe,Ee,Ce,ye){var Oe={};typeof arguments[0]=="object"&&(Oe=arguments[0],fe=Oe.cellSize,Ee=Oe.margin,Ce=Oe.alt,ye=Oe.title),fe=fe||2,Ee=typeof Ee=="undefined"?fe*4:Ee,Ce=typeof Ce=="string"?{text:Ce}:Ce||{},Ce.text=Ce.text||null,Ce.id=Ce.text?Ce.id||"qrcode-description":null,ye=typeof ye=="string"?{text:ye}:ye||{},ye.text=ye.text||null,ye.id=ye.text?ye.id||"qrcode-title":null;var Ke=$e.getModuleCount()*fe+Ee*2,st,wt,Gt,de,we="",bt;for(bt="l"+fe+",0 0,"+fe+" -"+fe+",0 0,-"+fe+"z ",we+='<svg version="1.1" xmlns="http://www.w3.org/2000/svg"',we+=Oe.scalable?"":' width="'+Ke+'px" height="'+Ke+'px"',we+=' viewBox="0 0 '+Ke+" "+Ke+'" ',we+=' preserveAspectRatio="xMinYMin meet"',we+=ye.text||Ce.text?' role="img" aria-labelledby="'+ze([ye.id,Ce.id].join(" ").trim())+'"':"",we+=">",we+=ye.text?'<title id="'+ze(ye.id)+'">'+ze(ye.text)+"</title>":"",we+=Ce.text?'<description id="'+ze(Ce.id)+'">'+ze(Ce.text)+"</description>":"",we+='<rect width="100%" height="100%" fill="white" cx="0" cy="0"/>',we+='<path d="',Gt=0;Gt<$e.getModuleCount();Gt+=1)for(de=Gt*fe+Ee,st=0;st<$e.getModuleCount();st+=1)$e.isDark(Gt,st)&&(wt=st*fe+Ee,we+="M"+wt+","+de+bt);return we+='" stroke="transparent" fill="black"/>',we+="</svg>",we},$e.createDataURL=function(fe,Ee){fe=fe||2,Ee=typeof Ee=="undefined"?fe*4:Ee;var Ce=$e.getModuleCount()*fe+Ee*2,ye=Ee,Oe=Ce-Ee;return ue(Ce,Ce,function(Ke,st){if(ye<=Ke&&Ke<Oe&&ye<=st&&st<Oe){var wt=Math.floor((Ke-ye)/fe),Gt=Math.floor((st-ye)/fe);return $e.isDark(Gt,wt)?0:1}else return 1})},$e.createImgTag=function(fe,Ee,Ce){fe=fe||2,Ee=typeof Ee=="undefined"?fe*4:Ee;var ye=$e.getModuleCount()*fe+Ee*2,Oe="";return Oe+="<img",Oe+=' src="',Oe+=$e.createDataURL(fe,Ee),Oe+='"',Oe+=' width="',Oe+=ye,Oe+='"',Oe+=' height="',Oe+=ye,Oe+='"',Ce&&(Oe+=' alt="',Oe+=ze(Ce),Oe+='"'),Oe+="/>",Oe};var ze=function(fe){for(var Ee="",Ce=0;Ce<fe.length;Ce+=1){var ye=fe.charAt(Ce);switch(ye){case"<":Ee+="&lt;";break;case">":Ee+="&gt;";break;case"&":Ee+="&amp;";break;case'"':Ee+="&quot;";break;default:Ee+=ye;break}}return Ee},rt=function(fe){var Ee=1;fe=typeof fe=="undefined"?Ee*2:fe;var Ce=$e.getModuleCount()*Ee+fe*2,ye=fe,Oe=Ce-fe,Ke,st,wt,Gt,de,we={"██":"█","█ ":"▀"," █":"▄","  ":" "},bt={"██":"▀","█ ":"▀"," █":" ","  ":" "},gt="";for(Ke=0;Ke<Ce;Ke+=2){for(wt=Math.floor((Ke-ye)/Ee),Gt=Math.floor((Ke+1-ye)/Ee),st=0;st<Ce;st+=1)de="█",ye<=st&&st<Oe&&ye<=Ke&&Ke<Oe&&$e.isDark(wt,Math.floor((st-ye)/Ee))&&(de=" "),ye<=st&&st<Oe&&ye<=Ke+1&&Ke+1<Oe&&$e.isDark(Gt,Math.floor((st-ye)/Ee))?de+=" ":de+="█",gt+=fe<1&&Ke+1>=Oe?bt[de]:we[de];gt+=`
`}return Ce%2&&fe>0?gt.substring(0,gt.length-Ce-1)+Array(Ce+1).join("▀"):gt.substring(0,gt.length-1)};return $e.createASCII=function(fe,Ee){if(fe=fe||1,fe<2)return rt(Ee);fe-=1,Ee=typeof Ee=="undefined"?fe*2:Ee;var Ce=$e.getModuleCount()*fe+Ee*2,ye=Ee,Oe=Ce-Ee,Ke,st,wt,Gt,de=Array(fe+1).join("██"),we=Array(fe+1).join("  "),bt="",gt="";for(Ke=0;Ke<Ce;Ke+=1){for(wt=Math.floor((Ke-ye)/fe),gt="",st=0;st<Ce;st+=1)Gt=1,ye<=st&&st<Oe&&ye<=Ke&&Ke<Oe&&$e.isDark(wt,Math.floor((st-ye)/fe))&&(Gt=0),gt+=Gt?de:we;for(wt=0;wt<fe;wt+=1)bt+=gt+`
`}return bt.substring(0,bt.length-1)},$e.renderTo2dContext=function(fe,Ee){Ee=Ee||2;for(var Ce=$e.getModuleCount(),ye=0;ye<Ce;ye++)for(var Oe=0;Oe<Ce;Oe++)fe.fillStyle=$e.isDark(ye,Oe)?"black":"white",fe.fillRect(ye*Ee,Oe*Ee,Ee,Ee)},$e};l.stringToBytesFuncs={default:function($){for(var te=[],oe=0;oe<$.length;oe+=1){var ie=$.charCodeAt(oe);te.push(ie&255)}return te}},l.stringToBytes=l.stringToBytesFuncs.default,l.createStringToBytes=function($,te){var oe=function(){for(var se=X($),pe=function(){var St=se.read();if(St==-1)throw"eof";return St},me=0,he={};;){var Ue=se.read();if(Ue==-1)break;var Ve=pe(),$e=pe(),ct=pe(),At=String.fromCharCode(Ue<<8|Ve),yt=$e<<8|ct;he[At]=yt,me+=1}if(me!=te)throw me+" != "+te;return he}(),ie="?".charCodeAt(0);return function(se){for(var pe=[],me=0;me<se.length;me+=1){var he=se.charCodeAt(me);if(he<128)pe.push(he);else{var Ue=oe[se.charAt(me)];typeof Ue=="number"?(Ue&255)==Ue?pe.push(Ue):(pe.push(Ue>>>8),pe.push(Ue&255)):pe.push(ie)}}return pe}};var u={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},h={L:1,M:0,Q:3,H:2},f={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},r=function(){var $=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],te=1335,oe=7973,ie=21522,se={},pe=function(me){for(var he=0;me!=0;)he+=1,me>>>=1;return he};return se.getBCHTypeInfo=function(me){for(var he=me<<10;pe(he)-pe(te)>=0;)he^=te<<pe(he)-pe(te);return(me<<10|he)^ie},se.getBCHTypeNumber=function(me){for(var he=me<<12;pe(he)-pe(oe)>=0;)he^=oe<<pe(he)-pe(oe);return me<<12|he},se.getPatternPosition=function(me){return $[me-1]},se.getMaskFunction=function(me){switch(me){case f.PATTERN000:return function(he,Ue){return(he+Ue)%2==0};case f.PATTERN001:return function(he,Ue){return he%2==0};case f.PATTERN010:return function(he,Ue){return Ue%3==0};case f.PATTERN011:return function(he,Ue){return(he+Ue)%3==0};case f.PATTERN100:return function(he,Ue){return(Math.floor(he/2)+Math.floor(Ue/3))%2==0};case f.PATTERN101:return function(he,Ue){return he*Ue%2+he*Ue%3==0};case f.PATTERN110:return function(he,Ue){return(he*Ue%2+he*Ue%3)%2==0};case f.PATTERN111:return function(he,Ue){return(he*Ue%3+(he+Ue)%2)%2==0};default:throw"bad maskPattern:"+me}},se.getErrorCorrectPolynomial=function(me){for(var he=b([1],0),Ue=0;Ue<me;Ue+=1)he=he.multiply(b([1,v.gexp(Ue)],0));return he},se.getLengthInBits=function(me,he){if(1<=he&&he<10)switch(me){case u.MODE_NUMBER:return 10;case u.MODE_ALPHA_NUM:return 9;case u.MODE_8BIT_BYTE:return 8;case u.MODE_KANJI:return 8;default:throw"mode:"+me}else if(he<27)switch(me){case u.MODE_NUMBER:return 12;case u.MODE_ALPHA_NUM:return 11;case u.MODE_8BIT_BYTE:return 16;case u.MODE_KANJI:return 10;default:throw"mode:"+me}else if(he<41)switch(me){case u.MODE_NUMBER:return 14;case u.MODE_ALPHA_NUM:return 13;case u.MODE_8BIT_BYTE:return 16;case u.MODE_KANJI:return 12;default:throw"mode:"+me}else throw"type:"+he},se.getLostPoint=function(me){for(var he=me.getModuleCount(),Ue=0,Ve=0;Ve<he;Ve+=1)for(var $e=0;$e<he;$e+=1){for(var ct=0,At=me.isDark(Ve,$e),yt=-1;yt<=1;yt+=1)if(!(Ve+yt<0||he<=Ve+yt))for(var St=-1;St<=1;St+=1)$e+St<0||he<=$e+St||yt==0&&St==0||At==me.isDark(Ve+yt,$e+St)&&(ct+=1);ct>5&&(Ue+=3+ct-5)}for(var Ve=0;Ve<he-1;Ve+=1)for(var $e=0;$e<he-1;$e+=1){var It=0;me.isDark(Ve,$e)&&(It+=1),me.isDark(Ve+1,$e)&&(It+=1),me.isDark(Ve,$e+1)&&(It+=1),me.isDark(Ve+1,$e+1)&&(It+=1),(It==0||It==4)&&(Ue+=3)}for(var Ve=0;Ve<he;Ve+=1)for(var $e=0;$e<he-6;$e+=1)me.isDark(Ve,$e)&&!me.isDark(Ve,$e+1)&&me.isDark(Ve,$e+2)&&me.isDark(Ve,$e+3)&&me.isDark(Ve,$e+4)&&!me.isDark(Ve,$e+5)&&me.isDark(Ve,$e+6)&&(Ue+=40);for(var $e=0;$e<he;$e+=1)for(var Ve=0;Ve<he-6;Ve+=1)me.isDark(Ve,$e)&&!me.isDark(Ve+1,$e)&&me.isDark(Ve+2,$e)&&me.isDark(Ve+3,$e)&&me.isDark(Ve+4,$e)&&!me.isDark(Ve+5,$e)&&me.isDark(Ve+6,$e)&&(Ue+=40);for(var Nt=0,$e=0;$e<he;$e+=1)for(var Ve=0;Ve<he;Ve+=1)me.isDark(Ve,$e)&&(Nt+=1);var Ie=Math.abs(100*Nt/he/he-50)/5;return Ue+=Ie*10,Ue},se}(),v=function(){for(var $=new Array(256),te=new Array(256),oe=0;oe<8;oe+=1)$[oe]=1<<oe;for(var oe=8;oe<256;oe+=1)$[oe]=$[oe-4]^$[oe-5]^$[oe-6]^$[oe-8];for(var oe=0;oe<255;oe+=1)te[$[oe]]=oe;var ie={};return ie.glog=function(se){if(se<1)throw"glog("+se+")";return te[se]},ie.gexp=function(se){for(;se<0;)se+=255;for(;se>=256;)se-=255;return $[se]},ie}();function b($,te){if(typeof $.length=="undefined")throw $.length+"/"+te;var oe=function(){for(var se=0;se<$.length&&$[se]==0;)se+=1;for(var pe=new Array($.length-se+te),me=0;me<$.length-se;me+=1)pe[me]=$[me+se];return pe}(),ie={};return ie.getAt=function(se){return oe[se]},ie.getLength=function(){return oe.length},ie.multiply=function(se){for(var pe=new Array(ie.getLength()+se.getLength()-1),me=0;me<ie.getLength();me+=1)for(var he=0;he<se.getLength();he+=1)pe[me+he]^=v.gexp(v.glog(ie.getAt(me))+v.glog(se.getAt(he)));return b(pe,0)},ie.mod=function(se){if(ie.getLength()-se.getLength()<0)return ie;for(var pe=v.glog(ie.getAt(0))-v.glog(se.getAt(0)),me=new Array(ie.getLength()),he=0;he<ie.getLength();he+=1)me[he]=ie.getAt(he);for(var he=0;he<se.getLength();he+=1)me[he]^=v.gexp(v.glog(se.getAt(he))+pe);return b(me,0).mod(se)},ie}var E=function(){var $=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],te=function(se,pe){var me={};return me.totalCount=se,me.dataCount=pe,me},oe={},ie=function(se,pe){switch(pe){case h.L:return $[(se-1)*4+0];case h.M:return $[(se-1)*4+1];case h.Q:return $[(se-1)*4+2];case h.H:return $[(se-1)*4+3];default:return}};return oe.getRSBlocks=function(se,pe){var me=ie(se,pe);if(typeof me=="undefined")throw"bad rs block @ typeNumber:"+se+"/errorCorrectionLevel:"+pe;for(var he=me.length/3,Ue=[],Ve=0;Ve<he;Ve+=1)for(var $e=me[Ve*3+0],ct=me[Ve*3+1],At=me[Ve*3+2],yt=0;yt<$e;yt+=1)Ue.push(te(ct,At));return Ue},oe}(),M=function(){var $=[],te=0,oe={};return oe.getBuffer=function(){return $},oe.getAt=function(ie){var se=Math.floor(ie/8);return($[se]>>>7-ie%8&1)==1},oe.put=function(ie,se){for(var pe=0;pe<se;pe+=1)oe.putBit((ie>>>se-pe-1&1)==1)},oe.getLengthInBits=function(){return te},oe.putBit=function(ie){var se=Math.floor(te/8);$.length<=se&&$.push(0),ie&&($[se]|=128>>>te%8),te+=1},oe},D=function($){var te=u.MODE_NUMBER,oe=$,ie={};ie.getMode=function(){return te},ie.getLength=function(me){return oe.length},ie.write=function(me){for(var he=oe,Ue=0;Ue+2<he.length;)me.put(se(he.substring(Ue,Ue+3)),10),Ue+=3;Ue<he.length&&(he.length-Ue==1?me.put(se(he.substring(Ue,Ue+1)),4):he.length-Ue==2&&me.put(se(he.substring(Ue,Ue+2)),7))};var se=function(me){for(var he=0,Ue=0;Ue<me.length;Ue+=1)he=he*10+pe(me.charAt(Ue));return he},pe=function(me){if("0"<=me&&me<="9")return me.charCodeAt(0)-"0".charCodeAt(0);throw"illegal char :"+me};return ie},L=function($){var te=u.MODE_ALPHA_NUM,oe=$,ie={};ie.getMode=function(){return te},ie.getLength=function(pe){return oe.length},ie.write=function(pe){for(var me=oe,he=0;he+1<me.length;)pe.put(se(me.charAt(he))*45+se(me.charAt(he+1)),11),he+=2;he<me.length&&pe.put(se(me.charAt(he)),6)};var se=function(pe){if("0"<=pe&&pe<="9")return pe.charCodeAt(0)-"0".charCodeAt(0);if("A"<=pe&&pe<="Z")return pe.charCodeAt(0)-"A".charCodeAt(0)+10;switch(pe){case" ":return 36;case"$":return 37;case"%":return 38;case"*":return 39;case"+":return 40;case"-":return 41;case".":return 42;case"/":return 43;case":":return 44;default:throw"illegal char :"+pe}};return ie},z=function($){var te=u.MODE_8BIT_BYTE,oe=l.stringToBytes($),ie={};return ie.getMode=function(){return te},ie.getLength=function(se){return oe.length},ie.write=function(se){for(var pe=0;pe<oe.length;pe+=1)se.put(oe[pe],8)},ie},k=function($){var te=u.MODE_KANJI,oe=l.stringToBytesFuncs.SJIS;if(!oe)throw"sjis not supported.";(function(pe,me){var he=oe(pe);if(he.length!=2||(he[0]<<8|he[1])!=me)throw"sjis not supported."})("友",38726);var ie=oe($),se={};return se.getMode=function(){return te},se.getLength=function(pe){return~~(ie.length/2)},se.write=function(pe){for(var me=ie,he=0;he+1<me.length;){var Ue=(255&me[he])<<8|255&me[he+1];if(33088<=Ue&&Ue<=40956)Ue-=33088;else if(57408<=Ue&&Ue<=60351)Ue-=49472;else throw"illegal char at "+(he+1)+"/"+Ue;Ue=(Ue>>>8&255)*192+(Ue&255),pe.put(Ue,13),he+=2}if(he<me.length)throw"illegal char at "+(he+1)},se},F=function(){var $=[],te={};return te.writeByte=function(oe){$.push(oe&255)},te.writeShort=function(oe){te.writeByte(oe),te.writeByte(oe>>>8)},te.writeBytes=function(oe,ie,se){ie=ie||0,se=se||oe.length;for(var pe=0;pe<se;pe+=1)te.writeByte(oe[pe+ie])},te.writeString=function(oe){for(var ie=0;ie<oe.length;ie+=1)te.writeByte(oe.charCodeAt(ie))},te.toByteArray=function(){return $},te.toString=function(){var oe="";oe+="[";for(var ie=0;ie<$.length;ie+=1)ie>0&&(oe+=","),oe+=$[ie];return oe+="]",oe},te},G=function(){var $=0,te=0,oe=0,ie="",se={},pe=function(he){ie+=String.fromCharCode(me(he&63))},me=function(he){if(!(he<0)){if(he<26)return 65+he;if(he<52)return 97+(he-26);if(he<62)return 48+(he-52);if(he==62)return 43;if(he==63)return 47}throw"n:"+he};return se.writeByte=function(he){for($=$<<8|he&255,te+=8,oe+=1;te>=6;)pe($>>>te-6),te-=6},se.flush=function(){if(te>0&&(pe($<<6-te),$=0,te=0),oe%3!=0)for(var he=3-oe%3,Ue=0;Ue<he;Ue+=1)ie+="="},se.toString=function(){return ie},se},X=function($){var te=$,oe=0,ie=0,se=0,pe={};pe.read=function(){for(;se<8;){if(oe>=te.length){if(se==0)return-1;throw"unexpected end of file./"+se}var he=te.charAt(oe);if(oe+=1,he=="=")return se=0,-1;if(he.match(/^\s$/))continue;ie=ie<<6|me(he.charCodeAt(0)),se+=6}var Ue=ie>>>se-8&255;return se-=8,Ue};var me=function(he){if(65<=he&&he<=90)return he-65;if(97<=he&&he<=122)return he-97+26;if(48<=he&&he<=57)return he-48+52;if(he==43)return 62;if(he==47)return 63;throw"c:"+he};return pe},re=function($,te){var oe=$,ie=te,se=new Array($*te),pe={};pe.setPixel=function(Ve,$e,ct){se[$e*oe+Ve]=ct},pe.write=function(Ve){Ve.writeString("GIF87a"),Ve.writeShort(oe),Ve.writeShort(ie),Ve.writeByte(128),Ve.writeByte(0),Ve.writeByte(0),Ve.writeByte(0),Ve.writeByte(0),Ve.writeByte(0),Ve.writeByte(255),Ve.writeByte(255),Ve.writeByte(255),Ve.writeString(","),Ve.writeShort(0),Ve.writeShort(0),Ve.writeShort(oe),Ve.writeShort(ie),Ve.writeByte(0);var $e=2,ct=he($e);Ve.writeByte($e);for(var At=0;ct.length-At>255;)Ve.writeByte(255),Ve.writeBytes(ct,At,255),At+=255;Ve.writeByte(ct.length-At),Ve.writeBytes(ct,At,ct.length-At),Ve.writeByte(0),Ve.writeString(";")};var me=function(Ve){var $e=Ve,ct=0,At=0,yt={};return yt.write=function(St,It){if(St>>>It)throw"length over";for(;ct+It>=8;)$e.writeByte(255&(St<<ct|At)),It-=8-ct,St>>>=8-ct,At=0,ct=0;At=St<<ct|At,ct=ct+It},yt.flush=function(){ct>0&&$e.writeByte(At)},yt},he=function(Ve){for(var $e=1<<Ve,ct=(1<<Ve)+1,At=Ve+1,yt=Ue(),St=0;St<$e;St+=1)yt.add(String.fromCharCode(St));yt.add(String.fromCharCode($e)),yt.add(String.fromCharCode(ct));var It=F(),Nt=me(It);Nt.write($e,At);var Ie=0,xe=String.fromCharCode(se[Ie]);for(Ie+=1;Ie<se.length;){var He=String.fromCharCode(se[Ie]);Ie+=1,yt.contains(xe+He)?xe=xe+He:(Nt.write(yt.indexOf(xe),At),yt.size()<4095&&(yt.size()==1<<At&&(At+=1),yt.add(xe+He)),xe=He)}return Nt.write(yt.indexOf(xe),At),Nt.write(ct,At),Nt.flush(),It.toByteArray()},Ue=function(){var Ve={},$e=0,ct={};return ct.add=function(At){if(ct.contains(At))throw"dup key:"+At;Ve[At]=$e,$e+=1},ct.size=function(){return $e},ct.indexOf=function(At){return Ve[At]},ct.contains=function(At){return typeof Ve[At]!="undefined"},ct};return pe},ue=function($,te,oe){for(var ie=re($,te),se=0;se<te;se+=1)for(var pe=0;pe<$;pe+=1)ie.setPixel(pe,se,oe(pe,se));var me=F();ie.write(me);for(var he=G(),Ue=me.toByteArray(),Ve=0;Ve<Ue.length;Ve+=1)he.writeByte(Ue[Ve]);return he.flush(),"data:image/gif;base64,"+he};return l}();(function(){i.stringToBytesFuncs["UTF-8"]=function(l){function u(h){for(var f=[],r=0;r<h.length;r++){var v=h.charCodeAt(r);v<128?f.push(v):v<2048?f.push(192|v>>6,128|v&63):v<55296||v>=57344?f.push(224|v>>12,128|v>>6&63,128|v&63):(r++,v=65536+((v&1023)<<10|h.charCodeAt(r)&1023),f.push(240|v>>18,128|v>>12&63,128|v>>6&63,128|v&63))}return f}return u(l)}})(),function(l){e.exports=l()}(function(){return i})})(N1);var _P=N1.exports;const vP=O1(_P);function xP(e){let t={};if(t.ObjectName=e.objectName,t.id=e.getObjectID().id,t.handle=e.getHandle(),t.layer=e.layer,t.color=e.trueColor.getColorString(),t.colorVal=e.trueColor.getColorValue(e.layerId),t.linetype=e.linetype,t.textStyle=e.textStyle,t.type=e.objectName,t.dxf0=e.dxf0,e instanceof P.McDbText){let i=e;t.position=Er(i.position),t.textString=i.textString}else if(e instanceof P.McDbMText){let i=e;t.contents=i.contents,t.location=Er(i.location)}else if(e instanceof P.McDbLine){let i=e;t.startPoint=Er(i.startPoint),t.endPoint=Er(i.endPoint)}else if(e instanceof P.McDbCircle){let i=e;t.center=Er(i.center),t.radius=i.radius}else if(e instanceof P.McDbArc){let i=e;t.center=Er(i.center),t.startAngle=i.startAngle,t.endAngle=i.endAngle}else if(e instanceof P.McDbPolyline){let i=e,l=i.numVerts();t.num=l;for(let u=0;u<l;u++){let h=i.getPointAt(u),f=i.getBulgeAt(u);t["pt"+u]=Er(h.val),t["bulge"+u]=f}}else if(e instanceof P.McDbBlockReference){let i=e;t.position=Er(i.position),t.blockTransform=i.blockTransform,t.blockName=i.blockName}else if(e instanceof P.McDbAlignedDimension){let i=e;t.xLine1Point=Er(i.xLine1Point),t.xLine2Point=Er(i.xLine2Point),i.GetAllText().forEach((u,h)=>{t["txt:"+h]=u})}else if(e instanceof P.McDbRotatedDimension){let i=e;t.xLine1Point=Er(i.xLine1Point),t.xLine2Point=Er(i.xLine2Point),i.GetAllText().forEach((u,h)=>{t["txt:"+h]=u})}else if(e instanceof P.McDbDimension)e.GetAllText().forEach((u,h)=>{t["txt:"+h]=u});else if(e instanceof P.McDbHatch){let i=e;t.patternType=i.patternType(),t.patternName=i.patternName(),t.patternAngle=i.patternAngle,t.patternScale=i.patternScale,t.patternSpace=i.patternSpace,t.patternDouble=i.patternDouble,t.hatchStyle=i.hatchStyle(),t.isSolid=i.isSolid(),t.numLoops=i.numLoops;for(let l=0;l<t.numLoops;l++){let u=i.getLoopAt(l);u.vertices.forEach((h,f)=>{u["pt:"+f]={},u["pt:"+f].x=h.x,u["pt:"+f].y=h.y,u["pt:"+f].z=h.z}),t["loop:"+l]=u}t.numPatternDefinitions=i.numPatternDefinitions;for(let l=0;l<t.numPatternDefinitions;l++)t["patternDefinitions:"+l]=i.getPatternDefinitionAt(l)}else if(e instanceof P.McDbRasterImage){let i=e,l=i.getOrientation();t.orientation={},t.orientation.origin=l.origin.toVector3(),t.orientation.uCorner=l.uCorner.toVector3(),t.orientation.vOnPlane=l.vOnPlane.toVector3();let u=i.clipBoundary();t.clipBoundary={},u.forEach((f,r)=>{t.clipBoundary["pt"+r]=f.toVector3()}),t.clipBoundaryType=i.clipBoundaryType();let h=i.imageDefId().getMcDbRasterImageDef();h&&(t.filePath=h.sourceFileName)}return t}function bP(){return lt(this,null,function*(){let e=new P.MxCADSelectionSet;e.allSelect(),e.forEach(t=>{let i=t.getMcDbEntity();i&&(i=xP(i),console.log(JSON.stringify(i)))})})}function wP(){return lt(this,null,function*(){let e=new P.MxCADSelectionSet,t=new P.MxCADResbuf;t.AddString("0",8),e.allSelect(t),e.forEach(i=>{let l=i.getMcDbEntity();if(l&&l instanceof P.McDbHatch){let u={},h=l;u.patternType=h.patternType(),u.patternName=h.patternName(),u.patternAngle=h.patternAngle,u.patternScale=h.patternScale,u.patternSpace=h.patternSpace,u.patternDouble=h.patternDouble,u.hatchStyle=h.hatchStyle(),u.isSolid=h.isSolid(),u.numLoops=h.numLoops;for(let f=0;f<u.numLoops;f++){let r=h.getLoopAt(f);r.vertices.forEach((v,b)=>{r["pt:"+b]={},r["pt:"+b].x=v.x,r["pt:"+b].y=v.y,r["pt:"+b].z=v.z}),u["loop:"+f]=r}u.numPatternDefinitions=h.numPatternDefinitions;for(let f=0;f<u.numPatternDefinitions;f++)u["patternDefinitions:"+f]=h.getPatternDefinitionAt(f);console.log(u)}})})}function MP(){return lt(this,null,function*(){let e=P.MxCpp.getCurrentMxCAD(),t=e.getDatabase(),i={};i.name="GRIDMODE",i.isShow=e.getSysVarLong("GRIDMODE");let l=e.getSysVarPoint("SNAPUNIT");i.xdist=l.x,i.ydist=l.x,console.log(i);let u={};u.name="ORTHOMODE",u.isShow=e.getSysVarLong("ORTHOMODE"),console.log(u);let h={};h.name="AUTOSNAP",h.enable=(e.getSysVarLong("AUTOSNAP")&8)!=0,h.polarang=e.getSysVarDouble("POLARANG"),console.log(h);let f={};f.name="OSMODE",f.enable=(e.getSysVarLong("OSMODE")&16384)==0,f.value=e.getSysVarLong("OSMODE"),f.End=(e.getSysVarLong("OSMODE")&1)!=0,f.Mid=(e.getSysVarLong("OSMODE")&2)!=0,f.Cen=(e.getSysVarLong("OSMODE")&4)!=0,f.Node=(e.getSysVarLong("OSMODE")&8)!=0,f.Quad=(e.getSysVarLong("OSMODE")&16)!=0,f.Int=(e.getSysVarLong("OSMODE")&32)!=0,f.Ins=(e.getSysVarLong("OSMODE")&64)!=0,f.Perp=(e.getSysVarLong("OSMODE")&128)!=0,f.Tan=(e.getSysVarLong("OSMODE")&256)!=0,f.Near=(e.getSysVarLong("OSMODE")&512)!=0,console.log(f);let r={};r.name="DYNTRACE",r.enable=e.getSysVarLong("DYNTRACE")!=0,console.log(r);let v={};v.name="DYNINPUT",v.enable=e.getSysVarLong("DYNINPUT")!=0,console.log(v);let b={};b.LTSCALE=e.getSysVarDouble("LTSCALE"),b.CELTSCALE=e.getSysVarDouble("CELTSCALE"),b.CELTYPE=e.getSysVarString("CELTYPE"),b.TEXTSTYLE=e.getSysVarString("TEXTSTYLE"),b.CLAYOUTNAME=e.getSysVarString("CLAYOUTNAME"),b.CLAYER=e.getSysVarString("CLAYER"),b.CECOLOR=t.getCurrentlyTrueColor().getColorValue(),b.INSBASE=e.getSysVarPoint("INSBASE"),b.CELWEIGHT=e.getSysVarLong("CELWEIGHT"),b.PDMODE=e.getSysVarLong("PDMODE"),b.PDSIZE=e.getSysVarDouble("PDSIZE"),console.log(b)})}function TP(){return lt(this,null,function*(){let e=new P.MxCADUiPrEntity;e.setMessage("选择对象");let t=yield e.go();if(!t.isValid())return;let i=t.getMcDbEntity();if(i===null)return;i.getxData().forEach((u,h,f)=>{console.log(JSON.stringify({val:u,type:h,dxf:f}))})})}function EP(){return lt(this,null,function*(){let e=new P.MxCADUiPrEntity;e.setMessage("选择对象");let t=yield e.go();if(!t.isValid())return;let i=t.getMcDbEntity();i!==null&&i.setxDataString("DataName","xxxxx")})}function CP(){return lt(this,null,function*(){const e=new P.MxCADUiPrPoint;e.setMessage(`
指定第一点:`);let t=yield e.go();if(t)for(e.setMessage(`
指定下一个点:`);;){e.setBasePt(t);let i=yield e.go();if(!i)return;let l=new P.McDbLine(t,i);P.MxCpp.getCurrentMxCAD().drawEntity(l),t=i}})}function U1(){let e=window.location.hostname;return e.substring(0,4)!="http"&&(e=document.location.protocol+"//"+e),e}function AP(){return lt(this,null,function*(){let e="http://localhost:3000/mxcad/";e.substring(0,16)=="http://localhost"&&(e=U1()+e.substring(16));let t=e+"tree.mxweb",i=P.MxCpp.App.getCurrentMxCAD(),l=yield i.insertBlock(t,"tree");if(!l.isValid())return;let u=new P.McDbBlockReference;u.blockTableRecordId=l;let h=u.getBoundingBox();if(h.ret){let M=h.maxPt.distanceTo(h.minPt);M>1e-5&&u.setScale(i.getMxDrawObject().screenCoordLong2Doc(100)/M)}let f=new P.MxCADUiPrPoint;f.setMessage("指定插入基点"),f.setUserDraw((M,D)=>{u.position=M,D.drawMcDbEntity(u)});let r=yield f.go();if(!r)return;u.position=r;let v=i.drawEntity(u);if(!v.isValid){console.log("insert error");return}u=v.getMcDbEntity(),u.disableDisplay(!0),l.getMcDbBlockTableRecord().getAllEntityId().forEach((M,D)=>{if(!M.isKindOf("McDbAttributeDefinition"))return;let L=M.getMcDbEntity(),z=L.tag,k=L.textString,F=new P.McDbAttribute;F.position=L.position,F.alignmentPoint=L.alignmentPoint,F.height=L.height,F.trueColor=L.trueColor,F.widthFactor=L.widthFactor,k.length>0?F.textString=k:F.textString="test"+D,F.tag=z,F.isInvisible=L.isInvisible,F.transformBy(u.blockTransform),F=u.appendAttribute(F).getMcDbEntity(),F.textStyle=L.textStyle,F.layer=L.layer}),u.disableDisplay(!1)})}function SP(){let i=P.MxCpp.App.getCurrentMxCAD().getDatabase().getLayerTable().getAllRecordId(),l=[];return i.forEach(u=>{let h=u.getMcDbLayerTableRecord();if(h===null)return;console.log(h),console.log("layerRec.color:"+h.color.getColorString()),console.log("layerRec.name:"+h.name);let f={};f.name=h.name,f.color=h.color.getColorString(),l.push(f)}),Le.MxFun.postMessageToParentFrame(l),l}function DP(){let t=P.MxCpp.App.getCurrentMxCAD().getDatabase().getLayerTable();if(!t.has("xxx11")){let i=new P.McDbLayerTableRecord;i.name="xxx11",t.add(i)}t.has("xxx11")&&console.log("add layer ok")}function PP(){P.MxCpp.App.getCurrentMxCAD().getDatabase().getLinetypeTable().getAllRecordId().forEach(l=>{let u=l.getMcDbLinetypeTableRecord();u!==null&&console.log(u)})}function LP(){P.MxCpp.getCurrentMxCAD().getDatabase().getTextStyleTable().getAllRecordId().forEach(l=>{let u=l.getMcDbTextStyleTableRecord();if(u===null)return;let h={};h.name=u.name,h.font=u.font(),h.fileName=u.fileName,h.bigFontFileName=u.bigFontFileName,h.textSize=u.textSize,h.xScale=u.xScale,console.log(h)})}function IP(){return lt(this,null,function*(){let t=P.MxCpp.getCurrentMxCAD().getDatabase().getTextStyleTable(),i="MyTextStyle";t.has(i,!1)&&t.get(i,!1).erase(!1);let l=new P.McDbTextStyleTableRecord;l.fileName="txt.shx",l.bigFontFileName="hztxt.shx",l.textSize=10,l.name=i,l.xScale=.7,t.add(l).isValid()&&console.log("add ok")})}function RP(){P.MxCpp.App.getCurrentMxCAD().getDatabase().getBlockTable().getAllRecordId().forEach(l=>{let u=l.getMcDbBlockTableRecord();u!==null&&(console.log(u),console.log("blkRec.name:"+u.name),console.log("blkRec.origin:"+u.origin))})}function zP(){return lt(this,null,function*(){let e=new F1;e.data.addColumn("序号",30),e.data.addColumn("名称",45),e.data.addColumn("材料",60),e.data.addColumn("长度",50);for(let u=0;u<10;u++){let h=""+u;e.data.addRow([h,"AAAA","BBBB","1000"])}let t=new P.MxCADUiPrPoint;t.setMessage(`
指定表格插入点:`);let i=yield t.go();if(!i)return;let l=Le.MxFun.screenCoordLong2Doc(100)/200;e.draw(i,l)})}function kP(){return lt(this,null,function*(){const e=new Le.MrxDbgUiPrPoint;e.setMessage(`
指定插入点:`);let t=yield e.go();if(!t)return;let i=Le.MxFun.getCurrentDraw();const l=vP(5,"L");l.addData("https://www.mxdraw3d.com"),l.make();const u=l.createDataURL(),h=new ed().load(u),f=new lr({map:h});let r=Le.MxFun.screenCoordLong2Doc(80),v=Le.MxFun.screenCoordLong2Doc(80),b=new Le.MxDbImage;b.setRenderOrder(Le.MxType.MxDefaultRenderOrder.kCADMeshRenderOrder-1),b.setPoint1(t);let E=new Se(t.x+r,t.y+v,t.z);b.setPoint2(E),b.setMaterial(f),i.addMxEntity(b),setInterval(()=>{i.updateDisplay()},100)})}function BP(){return lt(this,null,function*(){let e="http://localhost:3000/mxcad/";e.substring(0,16)=="http://localhost"&&(e=U1()+e.substring(16));let t=e+"stamp.mxweb",i=P.MxCpp.App.getCurrentMxCAD(),l=yield i.insertBlock(t,"stamp");if(!l.isValid())return;let u=new P.McDbBlockReference;u.blockTableRecordId=l;let h=u.getBoundingBox();if(h.ret){let v=h.maxPt.distanceTo(h.minPt);v>1e-5&&u.setScale(i.getMxDrawObject().screenCoordLong2Doc(100)/v)}let f=new P.MxCADUiPrPoint;f.setMessage("指定插入基点"),f.setUserDraw((v,b)=>{u.position=v,b.drawMcDbEntity(u)});let r=yield f.go();r&&(u.position=r,i.drawEntity(u))})}function FP(){return lt(this,null,function*(){let e=P.MxCpp.getCurrentMxCAD(),t=e.database.getLinetypeTable().get("TestMyLine");t.isErase()||t.erase();let i=e.addLinetypeEx("TestMyLine",'.5,-.2,["HW",STANDARD,S=.1,R=0.0,X=-0.1,Y=-.05],-.2',"");if(!i.isValid())return;let h=(yield new P.MxCADUiPrEntity().go()).getMcDbEntity();h&&(h.linetypeId=i)})}function D_(e){e.getAllObjectName().forEach(i=>{console.log(i);let u=e.getAt(i).getMcDbObject();if(u instanceof P.McDbDictionary){let h=u;console.log(h),D_(h)}else u instanceof P.McDbXrecord&&u.getData().PrintData()})}function OP(){return lt(this,null,function*(){let e=new P.MxCADUiPrEntity;e.setMessage("选择标注对象");let t=yield e.go();if(!t.isValid())return;let i=t.getMcDbEntity();if(i&&i.isHaveExtensionDictionary()){let l=i.getExtensionDictionary();D_(l)}})}function NP(){return lt(this,null,function*(){let t=P.MxCpp.getCurrentMxCAD().getDatabase().getNamedObjectsDictionary();t.getAllObjectName().forEach(l=>{console.log(l);let h=t.getAt(l).getMcDbObject();if(h instanceof P.McDbDictionary){let f=h;console.log(f),D_(f)}})})}function UP(){return lt(this,null,function*(){let t=P.MxCpp.getCurrentMxCAD().getDatabase().getNamedObjectsDictionary(),i="MyDict",l=t.getAt(i);if(l.isNull()){let h=new P.McDbDictionary;l=t.addObject(i,h)}let u=l.getMcDbDictionary();if(u){let h=new P.McDbXrecord,f=new P.MxCADResbuf;f.AddString("TestData"),h.setData(f),u.addObject("MyRecord",h),console.log("write xrecord ok")}})}function VP(){return lt(this,null,function*(){let e=new P.MxCADUiPrEntity;e.setMessage("选择标注对象");let t=yield e.go();if(!t.isValid())return;let i=t.getMcDbEntity();i&&(i.trueColor=new P.McCmColor(255,0,255))})}let P_;function GP(){return lt(this,null,function*(){if(P_){let e=P_.getMcDbEntity();if(!e)return;e.visible=!0}else{let e=new P.MxCADUiPrEntity;e.setMessage("选择标注对象");let t=yield e.go();if(!t.isValid())return;let i=t.getMcDbEntity();if(!i)return;i.visible=!1,P_=t}})}function HP(){return lt(this,null,function*(){let e="WALL";P.MxCpp.getCurrentMxCAD().database.layerTable.has(e)||console.log("no have layer:"+e);let i=new P.MxCADUiPrEntity;i.setMessage("选择对象");let l=yield i.go();if(!l.isValid())return;let u=l.getMcDbEntity();u&&(u.layer=e)})}function WP(){return lt(this,null,function*(){let e=new P.MxCADSelectionSet;if(!(yield e.userSelect(`
选择对象`)))return;let i=P.MxCpp.getCurrentDatabase().currentSpace.getMinMaxDrawOrder().maxDrawOrder+1;e.forEach(l=>{let u=l.getMcDbEntity();u&&(u.drawOrder=i)})})}function jP(){Le.MxFun.addCommand("TestGetAllEntity",bP),Le.MxFun.addCommand("MxTest_GetSysVars",MP),Le.MxFun.addCommand("MxTest_ReadxData",TP),Le.MxFun.addCommand("MxTest_WritexData",EP),Le.MxFun.addCommand("MxTest_DrawLine",CP),Le.MxFun.addCommand("MxTest_InsertBlock",AP),Le.MxFun.addCommand("MxTest_GetAllLayer",SP),Le.MxFun.addCommand("MxTest_AddLayer",DP),Le.MxFun.addCommand("MxTest_GetAllTextStyle",LP),Le.MxFun.addCommand("MxTest_GetAllBlock",RP),Le.MxFun.addCommand("MxTest_GetAllLinetype",PP),Le.MxFun.addCommand("Mx_Test_DrawTable",zP),Le.MxFun.addCommand("Mx_Test_QRCode",kP),Le.MxFun.addCommand("MxTest_InsertStamp",BP),Le.MxFun.addCommand("MxTest_LineTypeTest",FP),Le.MxFun.addCommand("TestGentEntityOnLayer",wP),Le.MxFun.addCommand("MxTest_GetNamedObjectsDictionary",NP),Le.MxFun.addCommand("MxTest_GetObjectExDictionaryData",OP),Le.MxFun.addCommand("MxTest_WriteXRecord",UP),Le.MxFun.addCommand("MxTest_AddTextStyleTable",IP),Le.MxFun.addCommand("Mx_Test_ChangeColor",VP),Le.MxFun.addCommand("Mx_Test_ChangeVisible",GP),Le.MxFun.addCommand("Mx_Test_ChangeEntityLayer",HP),Le.MxFun.addCommand("Mx_ChaneEntityDrawOrder",WP)}function $P(){return lt(this,null,function*(){let{baseUrl:e="",saveDwgUrl:t="",mxfilepath:i=""}=wd().getUploadFileConfig();P.MxCpp.getCurrentMxCAD().saveFileToUrl(t,(l,u)=>{try{let h=JSON.parse(u);if(h.ret=="ok"){let f=e+i+h.file;fetch(f).then(r=>lt(this,null,function*(){const v=yield r.blob();P.MxTools.saveAsFileDialog({blob:v,filename:h.file,types:[{description:"dwg图纸",accept:{"application/octet-stream":[".dwg"]}}]})}))}else console.log(u)}catch(h){console.log("Mx: sserverResult error")}})})}function qP(){return lt(this,null,function*(){let{baseUrl:e="",mxfilepath:t="",saveUrl:i=""}=wd().getUploadFileConfig();P.MxCpp.getCurrentMxCAD().saveFileToUrl(i,(l,u)=>{try{let h=JSON.parse(u);if(h.ret=="ok"){let f=e+t+h.file;P.MxTools.downloadFileFromUrl(f,h.file)}else console.log(u)}catch(h){console.log("Mx: sserverResult error")}})})}function ZP(){return lt(this,null,function*(){P.MxCpp.getCurrentMxCAD().openWebFile("http://localhost:1337/mxcad/file/8c79da20e232495888dbb0da17459399.mxweb")})}function XP(){return lt(this,null,function*(){P.MxCpp.getCurrentMxCAD().newFile()})}function YP(){return lt(this,null,function*(){let e=new P.MxCADUiPrPoint;e.setMessage(`
指定输出范围第一点:`);let t=yield e.go();if(!t)return;e.setMessage(`
指定输出范围第二点:`),e.setUserDraw((r,v)=>{v.setColor(16711680);let b=new P.McDbPolyline;b.addVertexAt(t),b.addVertexAt(new P.McGePoint3d(t.x,r.y)),b.addVertexAt(r),b.addVertexAt(new P.McGePoint3d(r.x,t.y)),b.constantWidth=Le.MxFun.screenCoordLong2Doc(2),b.isClosed=!0,v.drawMcDbEntity(b);let E=[];E.push(t.toVector3()),E.push(new THREE.Vector3(t.x,r.y)),E.push(r.toVector3()),E.push(new THREE.Vector3(r.x,t.y)),v.setColor(12868),v.drawSolid(E,.5)}),e.setDisableOsnap(!0),e.setDisableOrthoTrace(!0),e.setDynamicInputType(Le.DynamicInputType.kXYCoordInput);let i=yield e.go();if(!i)return;let{baseUrl:l="",mxfilepath:u="",printPdfUrl:h=""}=wd().getUploadFileConfig();console.log(wd().getUploadFileConfig());let f={width:"2100",height:"2970",bd_pt1_x:""+t.x,bd_pt1_y:""+t.y,bd_pt2_x:""+i.x,bd_pt2_y:""+i.y};P.MxCpp.getCurrentMxCAD().saveFileToUrl(h,(r,v)=>{try{let b=JSON.parse(v);if(b.ret=="ok"){let E=l+u+b.file;P.MxTools.downloadFileFromUrl(E,b.file)}else console.log(v)}catch(b){console.log("Mx: sserverResult error")}},void 0,JSON.stringify(f))})}function JP(){Le.MxFun.addCommand("Mx_Export_DWG",$P),Le.MxFun.addCommand("Mx_Export_MxWeb",qP),Le.MxFun.addCommand("Mx_Open_MxWeb",ZP),Le.MxFun.addCommand("MxTest_NewFile",XP),Le.MxFun.addCommand("Mx_Export_Pdf",YP)}function KP(){return lt(this,null,function*(){let e="0601",t="001A",i=new P.MxCADSelectionSet,l=new P.MxCADResbuf;l.AddMcDbEntityTypes("TEXT,MTEXT,INSERT,ACAD_PROXY_ENTITY"),i.allSelect(l);let u,h,f=i.count();for(let r=0;r<f;r++){let b=i.item(r).getMcDbEntity();if(!b)return;if(b instanceof P.McDbText){let E=b;if(E.textString==e){u=E.position,h=E.getBoundingBox();break}}else if(b instanceof P.McDbMText){let E=b;if(E.contents==e){u=E.location,h=E.getBoundingBox();break}}else if(b instanceof P.McDbBlockReference){let E=b,M=E.getAllAttribute(),D=0;if(M.forEach(L=>{let z=L.getMcDbEntity();(z.textString==e||z.textString==t)&&D++}),D==2){u=E.position,h=E.getBoundingBox();break}}else if(b instanceof P.McDbProxyEntity){let E=b,M=E.getAllTextContent(),D=0;if(M.forEach(L=>{L==e&&D++}),D>=1){h=E.getBoundingBox(),h&&h.ret&&(u=new P.McGePoint3d(h.minPt.x+(h.maxPt.x-h.minPt.x)*.5,h.minPt.y+(h.maxPt.y-h.minPt.y)*.5));break}}}if(h&&h.ret){console.log(h);let r=h.minPt.distanceTo(h.maxPt)*2;Le.MxFun.getCurrentDraw().zoomW(new THREE.Vector3(h.minPt.x-r,h.minPt.y-r,0),new THREE.Vector3(h.maxPt.x+r,h.maxPt.y+r,0))}else u?Le.MxFun.getCurrentDraw().zoomCenter(u.x,u.y):console.log("没有找到文字:"+e)})}function QP(){Le.MxFun.addCommand("MxTest_FindText",KP)}class ym extends P.McDbCustomEntity{constructor(t){super(t),this.pt1=new P.McGePoint3d,this.pt2=new P.McGePoint3d}create(t){return new ym(t)}getTypeName(){return"McDbTestLineCustomEntity"}dwgInFields(t){return this.pt1=t.readPoint("pt1").val,this.pt2=t.readPoint("pt2").val,!0}dwgOutFields(t){return t.writePoint("pt1",this.pt1),t.writePoint("pt2",this.pt2),!0}moveGripPointsAt(t,i,l,u){this.assertWrite(),t==0?(this.pt1.x+=i,this.pt1.y+=l,this.pt1.z+=u):t==1&&(this.pt2.x+=i,this.pt2.y+=l,this.pt2.z+=u)}getGripPoints(){let t=new P.McGePoint3dArray;return t.append(this.pt1),t.append(this.pt2),t}worldDraw(t){let i=new P.McDbPolyline;i.addVertexAt(this.pt1),i.addVertexAt(this.pt2),i.addVertexAt(new P.McGePoint3d),t.drawEntity(i)}setPoint1(t){this.assertWrite(),this.pt1=t.clone()}setPoint2(t){this.assertWrite(),this.pt2=t.clone()}getPoint1(){return this.pt1}getPoint2(){return this.pt2}}function e3(){return lt(this,null,function*(){let e=P.MxCpp.getCurrentMxCAD();const t=new P.MxCADUiPrPoint;t.setMessage(`
指定一点:`);let i=yield t.go();if(!i)return;t.setBasePt(i),t.setUseBasePt(!0),t.setMessage(`
指定二点:`);let l=yield t.go();if(!l)return;let u=new ym;u.setPoint1(i),u.setPoint2(l),e.drawEntity(u)})}function t3(){new ym().rxInit(),Le.MxFun.addCommand("MxTest_DrawCustomEntity",e3)}function n3(){return lt(this,null,function*(){let e=new P.MxCADSelectionSet;if(!(yield e.userSelect("选择要做成块的对象:"))||e.count()==0)return;let t=P.MxCpp.getCurrentMxCAD(),l=t.getDatabase().getBlockTable().add(new P.McDbBlockTableRecord),u=l.getMcDbBlockTableRecord();if(u==null)return;let h,f,r,v;if(e.forEach(D=>{let L=D.getMcDbEntity();if(!L)return;let z=L.clone();u.appendAcDbEntity(z);let k=L.getBoundingBox();k.ret&&(h?(h>k.minPt.x&&(h=k.minPt.x),f>k.minPt.y&&(f=k.minPt.y),r<k.maxPt.x&&(r=k.maxPt.x),v<k.maxPt.y&&(v=k.maxPt.y)):(h=k.minPt.x,f=k.minPt.y,r=k.maxPt.x,v=k.maxPt.y))}),h===void 0)return;let b=h+(r-h)*.5,E=f+(v-f)*.5;u.origin=new P.McGePoint3d(b,E,0);let M=new P.McDbBlockReference;M.blockTableRecordId=l,M.position=new P.McGePoint3d(b,E,0),t.drawEntity(M),e.forEach(D=>{let L=D.getMcDbEntity();L&&L.erase()})})}function i3(){Le.MxFun.addCommand("MxTest_SelectEntitysToBlock",n3)}function r3(){return lt(this,null,function*(){const e=new P.MxCADUiPrPoint;e.setMessage(`
指定填充区域内部一点:`),e.disableAllTrace(!0),e.setDisableOsnap(!0);let t=yield e.go();if(!t)return;let i=P.MxCADUtility.builderHatchFromPoint(t);if(!i){Le.MxFun.acutPrintf(`没有找到闭合区域
`);return}P.MxCpp.getCurrentMxCAD().drawEntity(i)})}function o3(){Le.MxFun.addCommand("MxTest_DrawHatchFormPoint",r3)}const L_={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function a3(e){if(/^\d+,\s*\d+,\s*\d+$/.test(e))return e.split(",").map(Number);if(/^0x[0-9a-fA-F]{6}$/.test(e)){const t=parseInt(e,16);return[t>>16&255,t>>8&255,t&255]}else if(/^#[0-9a-fA-F]{6}$/.test(e)){const t=parseInt(e.slice(1),16);return[t>>16&255,t>>8&255,t&255]}else if(L_[e.toLowerCase()]){const t=e.toLowerCase();if(L_[t])return L_[t]}else{const t=new P.McCmColor;return t.setColorIndex(256),[t.red,t.green,t.blue]}}const s3=e=>{const t=P.MxCpp.getCurrentDatabase().layerTable;if(t.has(e))return;const i=new P.McDbLayerTableRecord;i.color=new P.McCmColor(0,0,0),i.isFrozen=!1,i.isLocked=!1,i.isOff=!1,i.lineWeight=P.McDb.LineWeight.kLnWtByLayer,i.name=e,t.add(i)},ys=[{name:"color",description:"颜色",type:"str",required:!0},{name:"layer",description:"图层",type:"str",required:!0},{name:"lineweight",description:"线重",type:"float",required:!0}],_s=(e,t)=>{t.layer&&s3(t.layer);const i=l=>{t.color?l.trueColor=new P.McCmColor(...a3(t.color)):l.trueColor=new P.McCmColor(P.MxCpp.getCurrentDatabase().getCurrentlyDrawColor()),t.layer?l.layer=t.layer:l.layer=P.MxCpp.getCurrentDatabase().getCurrentlyLayerName(),t.lineweight&&(l.lineweight=t.lineweight)};Array.isArray(e)?e.forEach(i):e&&i(e)},l3=e=>{const t=e.split(",").map(u=>Number(u)),i=[];let l=0;for(;l<t.length;){const u=t[l];l++;const h=t[l];if(l++,typeof u=="undefined"||typeof h=="undefined")return i;const f=new P.McGePoint3d(u,h);i.push(f)}return i},ur=e=>{if(typeof e=="object"&&"x"in e&&"y"in e)return new P.McGePoint3d(e.x,e.y);if(Array.isArray(e))return new P.McGePoint3d(e[0],e[1]);if(typeof e=="string"){const[t,i]=e.split(",").map(l=>Number(l));if(typeof t=="number"&&typeof i=="number")return new P.McGePoint3d(t,i)}};class c3{call(t){if(console.log(t),t&&t.pt1&&t.pt2){let i=P.MxCpp.getCurrentMxCAD();t.pt1&&(t.pt1=ur(t.pt1)),t.pt2&&(t.pt2=ur(t.pt2));const l=i.drawLine(t.pt1.x,t.pt1.y,t.pt2.x,t.pt2.y);_s(l.getMcDbEntity(),t),i.updateDisplay()}}regist_data(){return{filename:"drawline.json",name:"draw_line",description:"根据直线的开始点和结束点绘制一个直线段",params:[{name:"pt1",description:"直线开始点",type:"tuple[float, float]",required:!0},{name:"pt2",description:"直线结束点",type:"tuple[float, float]",required:!0},...ys]}}}function u3(){wo.regist(c3)}class h3{call(t){if(console.log(t),t&&t.cen&&t.radius){t.cen&&(t.center=ur(t.cen));let i=P.MxCpp.getCurrentMxCAD();const l=i.drawCircle(t.center.x,t.center.y,t.radius);_s(l.getMcDbEntity(),t),i.updateDisplay()}}regist_data(){return{filename:"drawcircle.json",name:"draw_circle",description:"根据圆心和半径绘制一个圆",params:[{name:"center",description:"圆的中心点",type:"tuple[float, float]",required:!0},{name:"radius",description:"圆的半径",type:"float",required:!0},...ys]}}}const d3=()=>{wo.regist(h3)};function Gr(e,t,i,l,u){const h=e.x,f=e.y,r=t.x,v=t.y,b=i.x,E=i.y,M=l.x,D=l.y,L=(h-r)*(E-D)-(f-v)*(b-M);if(L===0)return null;const z=((h-b)*(E-D)-(f-E)*(b-M))/L,k=-((h-r)*(f-E)-(f-v)*(h-b))/L,F=h+z*(r-h),G=f+z*(v-f),X=new P.McGePoint3d(F,G,0);return u||z>0&&z<1&&k>0&&k<1?X:null}function ru(e,t){const i=t.x,l=t.y;let u=!1;for(let h=0,f=e.length-1;h<e.length;f=h++){const r=e[h].x,v=e[h].y,b=e[f].x,E=e[f].y;v>l!=E>l&&i<(b-r)*(l-v)/(E-v)+r&&(u=!u)}return u}function hd(e,t,i,l){const u=e-i,h=t-l;let f=0;return u==0?f=Math.PI/2:f=Math.atan(Math.abs(h/u)),u<0&&h>=0?f=Math.PI-f:u<0&&h<0?f=Math.PI+f:u>=0&&h<0&&(f=Math.PI*2-f),f}function dd(e,t,i,l){const u=new P.McDbArc;return u.center=e,u.radius=t,u.startAngle=i,u.endAngle=l,u}class p3{call(t){return lt(this,null,function*(){console.log(t);let{center:i,radius:l,startAngle:u,endAngle:h,is3PDraw:f,point1:r,point2:v,point3:b}=t,E=P.MxCpp.getCurrentMxCAD();E.newFile(),E.zoomAll();const M=new P.MxCADUiPrPoint,D=new P.MxCADUiPrDist;if(f){if(r&&(r=ur(r)),v&&(v=ur(v)),b&&(b=ur(b)),M.setKeyWords(""),!r&&(M.setMessage("指定圆弧起点"),M.setUserDraw((z,k)=>{if(!v||!b)return;const F=new P.McDbArc;F.computeArc(z.x,z.y,v.x,v.y,b.x,b.y),k.drawMcDbEntity(F)}),r=yield M.go(),!r)||!v&&(M.setMessage("指定圆弧第二个点"),M.setUserDraw((z,k)=>{if(!r||!b)return;const F=new P.McDbArc;F.computeArc(r.x,r.y,z.x,z.y,b.x,b.y),k.drawMcDbEntity(F)}),v=yield M.go(),!v)||!b&&(M.setMessage("指定圆弧的端点"),M.setUserDraw((z,k)=>{if(!r||!v)return;const F=new P.McDbArc;F.computeArc(r.x,r.y,v.x,v.y,z.x,z.y),k.drawMcDbEntity(F)}),b=yield M.go(),!b))return;const L=new P.McDbArc;console.log(r.x,r.y,v.x,v.y,b.x,b.y),L.computeArc(r.x,r.y,v.x,v.y,b.x,b.y),_s(L,t),E.drawEntity(L),E.updateDisplay()}else{if(i&&(i=ur(i)),u&&(u=u*(Math.PI/180)),h&&(h=h*(Math.PI/180)),!i){M.setMessage("指定圆弧圆心"),M.setKeyWords(""),M.setUserDraw((k,F)=>{l&&F.drawMcDbEntity(dd(k,l,u||0,h||Math.PI*2))});const z=yield M.go();if(!z)return;i=z}if(!l&&(D.setBasePt(i),D.setMessage(P._ML_String("MxAiDrawCircleArc_Radius","指定圆弧半径")),D.setKeyWords(""),D.setUserDraw((z,k)=>{if(!i)return;const F=z.distanceTo(i);k.drawMcDbEntity(dd(i,F,u||0,h||Math.PI*2))}),l=yield D.go(),!l))return;if(!u){if(!i)return;D.setBasePt(i),D.setMessage(P._ML_String("MxAiDrawCircleArc_StartAngle","指定圆弧开始角")),D.setKeyWords(""),D.setUserDraw((k,F)=>{i&&l&&(u=hd(i.x,i.y,k.x,k.y)-Math.PI,F.drawMcDbEntity(dd(i,l,u||0,h||Math.PI*2)))});const z=yield D.go();if(!z)return;D.getDetailedResult()===Le.DetailedResult.kCoordIn&&(u=z*(Math.PI/180))}if(!h){if(!i)return;D.setBasePt(i),D.setMessage(P._ML_String("MxAiDrawCircleArc_EndAngle","指定圆弧结束角")),D.setKeyWords(""),D.setUserDraw((k,F)=>{i&&l&&(h=hd(i.x,i.y,k.x,k.y)-Math.PI,F.drawMcDbEntity(dd(i,l,u||0,h||Math.PI*2)))});const z=yield D.go();if(!z)return;D.getDetailedResult()===Le.DetailedResult.kCoordIn&&(h=z*(Math.PI/180))}const L=dd(i,l,u,h);_s(L,t),E.drawEntity(L),E.updateDisplay()}})}regist_data(){return{filename:"drawcirclearc.json",name:"draw_circle_arc",description:"绘制圆弧",params:[{name:"center",description:"圆弧圆心",type:"tuple[float, float]",required:!0},{name:"radius",description:"圆弧半径",type:"float",required:!0},{name:"startAngle",description:"圆弧开始角",type:"float",required:!0},{name:"endAngle",description:"圆弧结束角",type:"float",required:!0},{name:"is3PDraw",description:"是否三点绘制",type:"boolean",required:!0},{name:"point1",description:"三点绘制圆弧的第一个点(起点)",type:"tuple[float, float]",required:!0},{name:"point2",description:"三点绘制圆弧的第二个点",type:"tuple[float, float]",required:!0},{name:"point3",description:"三点绘制圆弧的第三个点(终点)",type:"tuple[float, float]",required:!0},...ys]}}}const f3=()=>{wo.regist(p3)};function V1(e=new P.McGePoint3d,t=new P.McGePoint3d,i=3){const l=t.x,u=t.y,h=e.x,f=e.y,r=Math.max(3,i),b=Math.sqrt(rx(l-h,2)+rx(u-f,2))/Math.cos(Math.PI/r),E=Math.atan2(u-f,l-h)-Math.PI/r,M=[];for(let D=0;D<r;D++){const L=E+D*2*Math.PI/r,z=h+b*Math.cos(L),k=f+b*Math.sin(L);M.push(new P.McGePoint3d(z,k))}return M}function G1(e=new P.McGePoint3d,t=new P.McGePoint3d,i=3){const l=[];i=Math.max(3,i),l.push(t);const u=Math.PI*2/i;for(let h=1;h<i;h++){const f=Math.cos(u*h),r=Math.sin(u*h),v=e.clone(),b=t.clone(),E=b.x-v.x,M=b.y-v.y,D=E*f-M*r+v.x,L=E*r+M*f+v.y,z=new P.McGePoint3d(D,L);l.push(z)}return l}function m3(e,t,i){let l=t.x-e.x,u=t.y-e.y,h=Math.sqrt(l*l+u*u),f=Math.atan2(u,l),r=2*Math.PI/Math.max(3,i),v=[e,t];for(let b=0;b<i;b++){let E=e.x+h*Math.cos(f+b*r),M=e.y+h*Math.sin(f+b*r);e=new P.McGePoint3d(E,M),v.push(e)}return v}class g3{call(t){return lt(this,null,function*(){P.MxCpp.getCurrentMxCAD().newFile(),console.log(t);let{isDrawToCenter:i,sideNum:l,startPoint:u,endPoint:h,radius:f,centerPoint:r,isTangentToTheCircle:v}=t;if(!l){const b=new P.MxCADUiPrInt;b.setMessage("输入边的数目<5>"),b.setKeyWords(""),b.clearLastInputPoint(),l=(yield b.go())||5}if(i){if(r)r=ur(r);else{const D=new P.MxCADUiPrPoint;if(D.setMessage(`
指定正多变形的中心点`),D.setKeyWords(""),D.clearLastInputPoint(),r=yield D.go(),!r)return}let b=P.McGeVector3d.kXAxis,E;if(!f){const D=new P.MxCADUiPrDist;D.setMessage(P._ML_String("MxAiDrawPolygon_radius","指定圆的半径")),D.setKeyWords(""),D.setBasePt(r),D.setUserDraw((z,k)=>{if(v){const F=z.distanceTo(r);b=z.sub(r);const G=r.clone().addvec(z.sub(r).normalize().mult(F)),X=V1(r,G,l),re=new P.McDbPolyline;X.forEach(ue=>{re.addVertexAt(ue)}),re.isClosed=!0,k.drawMcDbEntity(re)}else{E=z;const F=new P.McDbPolyline;G1(r,z,l).forEach(G=>{F.addVertexAt(G)}),F.isClosed=!0,k.drawMcDbEntity(F)}});const L=yield D.go();if(!L)return;f=L}const M=new P.McDbPolyline;if(M.isClosed=!0,v){const D=r.clone().addvec(b.normalize().mult(f));V1(r,D,l).forEach(z=>{M.addVertexAt(z)})}else{if(!E){const D=P.McGeVector3d.kXAxis.clone().rotateBy(Math.PI/l).mult(f);E=r.clone().addvec(D)}G1(r,E,l).forEach(D=>{M.addVertexAt(D)})}P.MxCpp.getCurrentMxCAD().drawEntity(M)}else{const b=M=>{const D=new P.McDbPolyline;return m3(u,M,l||5).forEach(z=>{D.addVertexAt(z)}),D.isClosed=!0,D};if(u)u=ur(u);else{const M=new P.MxCADUiPrPoint;if(M.clearLastInputPoint(),M.setMessage(`
指定边的第一个端点`),M.setKeyWords(""),u=yield M.go(),!u)return;M.setUserDraw((D,L)=>{L.drawMcDbEntity(b(D))})}if(h)h=ur(h);else{const M=new P.MxCADUiPrPoint;M.setBasePt(u),M.setMessage(`
指定边的第二个端点`),h=yield M.go()}if(!h)return;const E=b(h);P.MxCpp.getCurrentMxCAD().drawEntity(E)}})}regist_data(){return{filename:"DrawPolygon.json",name:"draw_polygon",description:"绘制正多边形",params:[{name:"isDrawToCenter",description:"是否用圆绘制多边形",type:"boolean",required:!0},{name:"sideNum",description:"边数",type:"int",required:!0},{name:"startPoint",description:"边绘制提供开始点",type:"tuple[float, float]",required:!0},{name:"endPoint",description:"边绘制提供结束点",type:"tuple[float, float]",required:!0},{name:"radius",description:"圆的半径",type:"number",required:!0},{name:"centerPoint",description:"圆心",type:"tuple[float, float]",required:!0},{name:"isTangentToTheCircle",description:"外切于圆",type:"boolean",required:!0}]}}}const y3=()=>{wo.regist(g3)},H1=(e,t,i)=>{const l=Math.cos(i),u=Math.sin(i),h=t.x-e.x,f=t.y-e.y,r=h*l-f*u+e.x,v=h*u+f*l+e.y,b=t.z;return new P.McGePoint3d(r,v,b)},I_=(e,t,i=0)=>{const l=new P.McGePoint3d((e.x+t.x)/2,(e.y+t.y)/2,(e.z+t.z)/2),u=new P.McGePoint3d(e.x,t.y,e.z),h=new P.McGePoint3d(t.x,e.y,t.z),f=H1(l,u,i),r=H1(l,h,i);return[e,f,t,r]},W1=(e,t)=>[t.x>=e.x&&t.y>=e.y,t.x<e.x&&t.y>=e.y,t.x<e.x&&t.y<e.y,t.x>=e.x&&t.y<e.y];function j1(e,t,i){if(t===0&&i===0)return e;const[l,u,h,f]=e,r=l.distanceTo(f),v=l.distanceTo(u),[b,E,M,D]=W1(l,h),L=E||M?-t:t,z=M||D?-i:i;if(r-Math.abs(L)*2<=0||v-Math.abs(z)*2<=0)return e;const k=new P.McGePoint3d(l.x+L,l.y,l.z),F=new P.McGePoint3d(l.x,l.y+z,l.z),G=new P.McGePoint3d(u.x,u.y-z,u.z),X=new P.McGePoint3d(u.x+L,u.y,u.z),re=new P.McGePoint3d(h.x-L,h.y,h.z),ue=new P.McGePoint3d(h.x,u.y-z,h.z),$=new P.McGePoint3d(f.x,f.y+z,f.z),te=new P.McGePoint3d(f.x-L,f.y,f.z);return[k,F,G,X,re,ue,$,te]}function _3(e,t,i){if(e.isEqualTo(t))return 0;let l=e.c().addvec(t.c().sub(e).mult(.5)),u=t.c().sub(e);u.rotateBy(Math.PI/2,P.McGeVector3d.kZAxis);let h=new P.McDbLine(l,l.c().addvec(u)),f=i.c();f.rotateBy(Math.PI/2,P.McGeVector3d.kZAxis);let r=new P.McDbLine(e,e.c().addvec(f)),v=h.IntersectWith(r,P.McDb.Intersect.kExtendBoth);if(v.isEmpty())return 0;let b=v.at(0),E=b.distanceTo(e);u.normalize(),u.mult(E);let M=b.c().addvec(u),D=b.c().subvec(u),L=M.c().sub(e),z=D.c().sub(e),k=M;return L.angleTo1(i)>z.angleTo1(i)&&(k=D),P.MxCADUtility.calcBulge(e,k,t).val}class v3{call(t){return lt(this,null,function*(){console.log(t),P.MxCpp.getCurrentMxCAD().newFile();let{pt1:i,pt2:l,chamfer1Length:u,chamfer2Length:h,filletRadius:f,lineWidth:r,area:v,rectLength:b,rectWidth:E,rotationAngle:M}=t;const D=(k,F)=>{const[G,X,re,ue]=I_(k,F,M),$=new P.McDbPolyline;return $.addVertexAt(G,0,r,r),$.addVertexAt(X,0,r,r),$.addVertexAt(re,0,r,r),$.addVertexAt(ue,0,r,r),$.isClosed=!0,r&&($.constantWidth=r),$},L=(k,F)=>{let G;if(f){const X=j1(I_(k,F,M),f,f),[re,ue,$,te]=W1(k,F);if(X.length===8){G||(G=new P.McDbPolyline);const oe=(he,Ue,Ve)=>{let $e=new P.McGeVector3d(Ve);const ct=_3(he,Ue,$e);G.addVertexAt(he,ct,r,r),G.addVertexAt(Ue,0,r,r)},ie=new P.McGeVector3d(-1,0),se=new P.McGeVector3d(0,1),pe=new P.McGeVector3d(1,0),me=new P.McGeVector3d(0,-1);te&&(se.y=-1,pe.x=1,me.y=1),ue&&(ie.x=1,se.y=1,pe.x=-1,me.y=-1),$&&(ie.x=1,se.y=-1,pe.x=-1,me.y=1),oe(X[0],X[1],ie),oe(X[2],X[3],se),oe(X[4],X[5],pe),oe(X[6],X[7],me),G.isClosed=!0}}else(u||h)&&(G||(G=new P.McDbPolyline),j1(I_(k,F,M),u||h,h||u).forEach(re=>{G.addVertexAt(re)}),G.isClosed=!0);return G||(G=D(k,F)),r&&(G.constantWidth=r),G};if(i)i=ur(i);else{const k=new P.MxCADUiPrPoint;if(k.setMessage("指定第一个角点"),k.setKeyWords(""),i=yield k.go(),!i)return}if(v&&(b&&(E=v/b),E&&(b=v/E)),b&&E&&(l=new P.McGePoint3d(i.x+E,i.y+b,0)),l)l=ur(l);else{const k=new P.MxCADUiPrPoint;if(k.setMessage("指定第二个角点"),k.setKeyWords(""),k.setUserDraw((F,G)=>{G.drawMcDbEntity(L(i,F))}),l=yield k.go(),!l)return}const z=L(i,l);_s(z,t),P.MxCpp.getCurrentMxCAD().drawEntity(z)})}regist_data(){return{filename:"drawRect.json",name:"draw_rect",description:"根据一些信息绘制矩形",params:[{name:"pt1",description:"一个对角点",type:"tuple[float, float]",required:!0},{name:"pt2",description:"另一个对角点",type:"tuple[float, float]",required:!0},{name:"lineWidth",description:"矩形线的宽",type:"float",required:!0},{name:"filletRadius",description:"圆角半径",type:"float",required:!0},{name:"chamfer1Length",description:"第一个倒角距离",type:"float",required:!0},{name:"chamfer2Length",description:"第二个倒角距离",type:"float",required:!0},{name:"rectLength",description:"长度",type:"float",required:!0},{name:"rectWidth",description:"矩形宽度",type:"float",required:!0},{name:"area",description:"面积",type:"float",required:!0},{name:"rotationAngle",description:"旋转角度",type:"float",required:!0},...ys]}}}function x3(){wo.regist(v3)}const na=(e,t,i,l,u)=>{const h=new P.McDbEllipse,f=new P.McGePoint3d((e.x+t.x)/2,(t.y+t.y)/2),r=e.sub(t),v=r,b=e.distanceTo(t)/2,M=i/2/b;return h.center=f,h.majorAxis=r,h.minorAxis=v,h.radiusRatio=M,h.startAngle=l,h.endAngle=u,h};class b3{call(t){return lt(this,null,function*(){let{endPoint1:i,endPoint2:l,halfAxisLength:u}=t;const h=P.MxCpp.getCurrentMxCAD();h.newFile();const f=new P.MxCADUiPrPoint,r=new P.MxCADUiPrDist;if(i&&(i=ur(i)),l&&(l=ur(l)),!i&&(f.setMessage("指定椭圆的轴端点1"),f.setKeyWords(""),f.setUserDraw((b,E)=>{l&&u&&E.drawMcDbEntity(na(b,l,u,0,Math.PI*2))}),i=yield f.go(),!i)||!l&&(f.setMessage("指定椭圆的轴端点2"),f.setKeyWords(""),f.setUserDraw((b,E)=>{i&&u&&E.drawMcDbEntity(na(i,b,u,0,Math.PI*2))}),l=yield f.go(),!l))return;if(!u){r.setMessage("指定半轴长度"),r.setKeyWords("");const b=new P.McGePoint3d((i.x+l.x)/2,(l.y+l.y)/2);if(r.setBasePt(b),r.setUserDraw((E,M)=>{i&&M.drawMcDbEntity(na(i,l,b.distanceTo(E),0,Math.PI*2))}),u=yield r.go(),!u)return}const v=na(i,l,u,0,Math.PI*2);_s(v,t),h.drawEntity(v)})}regist_data(){return{filename:"drawellipse.json",name:"draw_ellipse",description:"绘制椭圆",params:[{name:"endPoint1",description:"椭圆端点1",type:"tuple[float, float]",required:!0},{name:"endPoint2",description:"椭圆端点2",type:"tuple[float, float]",required:!0},{name:"halfAxisLength",description:"半轴长度",type:"float",required:!0},...ys]}}}class w3{call(t){return lt(this,null,function*(){let{endPoint1:i,endPoint2:l,halfAxisLength:u,startAngle:h,endAngle:f}=t;const r=P.MxCpp.getCurrentMxCAD();r.newFile();const v=new P.MxCADUiPrPoint,b=new P.MxCADUiPrDist;if(i&&(i=ur(i)),l&&(l=ur(l)),h&&(h=h*(Math.PI/180)),f&&(f=f*(Math.PI/180)),!i&&(v.setMessage("指定椭圆的轴端点1"),v.setKeyWords(""),v.setUserDraw((L,z)=>{l&&u&&z.drawMcDbEntity(na(L,l,u,0,Math.PI*2))}),i=yield v.go(),!i)||!l&&(v.setMessage("指定椭圆的轴端点2"),v.setKeyWords(""),v.setUserDraw((L,z)=>{i&&u&&z.drawMcDbEntity(na(i,L,u,0,Math.PI*2))}),l=yield v.go(),!l))return;const E=new P.McGePoint3d((i.x+l.x)/2,(l.y+l.y)/2);if(!u&&(b.setMessage("指定半轴长度"),b.setKeyWords(""),b.setBasePt(E),b.setUserDraw((L,z)=>{i&&z.drawMcDbEntity(na(i,l,E.distanceTo(L),0,Math.PI*2))}),u=yield b.go(),!u))return;const M=hd(E.x,E.y,i.x,i.y);if(!h){b.setMessage(P._ML_String("EllipticalArc_startAngle","指定起点角度")),b.setKeyWords(""),b.setUserDraw((z,k)=>{h=hd(E.x,E.y,z.x,z.y)-M-Math.PI,k.drawMcDbEntity(na(i,l,u,h,Math.PI*2))});const L=yield b.go();if(!L)return;b.getDetailedResult()==Le.DetailedResult.kCoordIn&&(h=L*(180/Math.PI))}if(!f){b.setLastInputPoint(E),b.setMessage(P._ML_String("EllipticalArc_endAngle","指定端点角度")),b.setKeyWords(""),b.setUserDraw((z,k)=>{f=hd(E.x,E.y,z.x,z.y)-M-Math.PI,k.drawMcDbEntity(na(i,l,u,h,f))});const L=yield b.go();if(!L)return;b.getDetailedResult()===Le.DetailedResult.kCoordIn&&(f=L*(180/Math.PI))}const D=na(i,l,u,h,f);_s(D,t),r.drawEntity(D)})}regist_data(){return{filename:"drawellipseArc.json",name:"draw_ellipse_arc",description:"绘制椭圆弧",params:[{name:"endPoint1",description:"椭圆弧端点1",type:"tuple[float, float]",required:!0},{name:"endPoint2",description:"椭圆弧端点2",type:"tuple[float, float]",required:!0},{name:"halfAxisLength",description:"半轴长度",type:"float",required:!0},{name:"startAngle",description:"开始角度",type:"float",required:!0},{name:"endAngle",description:"结束角度",type:"float",required:!0},...ys]}}}const M3=()=>{wo.regist(b3),wo.regist(w3)},uo=class uo{constructor(t,i,l=50){this.width=50,this.isDraw=!1,this.update(t,i,l)}update(t,i,l=this.width){let u=t.clone().sub(i).normalize();u=new P.McGeVector3d(-u.y,u.x,0).mult(l/2);const h=u.clone().negate();this.outsidePoints=[t.clone().addvec(u),i.clone().addvec(u)],this.insidePoints=[t.clone().addvec(h),i.clone().addvec(h)],this.width=l,this.startPoint=t.clone(),this.endPoint=i.clone(),this.outsideLine?(this.outsideLine.startPoint=this.outsidePoints[0],this.outsideLine.endPoint=this.outsidePoints[1]):this.outsideLine=new P.McDbLine(this.outsidePoints[0],this.outsidePoints[1]),this.insideLine?(this.insideLine.startPoint=this.insidePoints[0],this.insideLine.endPoint=this.insidePoints[1]):this.insideLine=new P.McDbLine(this.insidePoints[0],this.insidePoints[1]),this.startClosedLine?(this.startClosedLine.startPoint=this.outsidePoints[0],this.startClosedLine.endPoint=this.insidePoints[0]):this.startClosedLine=new P.McDbLine(this.outsidePoints[0],this.insidePoints[0]),this.endClosedLine?(this.endClosedLine.startPoint=this.outsidePoints[1],this.endClosedLine.endPoint=this.insidePoints[1]):this.endClosedLine=new P.McDbLine(this.outsidePoints[1],this.insidePoints[1])}clone(){const t=new uo(this.startPoint,this.endPoint,this.width);return t.insideLine=this.insideLine.clone(),t.outsideLine=this.outsideLine.clone(),t}hiddenStartClosedLine(){this.startClosedLine.visible=!1}hiddenEndClosedLine(){this.endClosedLine.visible=!1}getClosedStartLineToDiffWallInsideLineIntersectionPoint(t,i=!1){return this.startClosedLine.visible?Gr(t.insideLine.startPoint,t.insideLine.endPoint,this.startClosedLine.startPoint,this.startClosedLine.endPoint,i):null}getClosedStartLineToDiffWallOutsideLineIntersectionPoint(t,i=!1){return this.startClosedLine.visible?Gr(t.outsideLine.startPoint,t.outsideLine.endPoint,this.startClosedLine.startPoint,this.startClosedLine.endPoint,i):null}getClosedEndLineToDiffWallInsideLineIntersectionPoint(t,i=!1){return this.endClosedLine.visible?Gr(t.insideLine.startPoint,t.insideLine.endPoint,this.endClosedLine.startPoint,this.endClosedLine.endPoint,i):null}getClosedEndLineToDiffWallOutsideLineIntersectionPoint(t,i=!1){return this.endClosedLine.visible?Gr(t.outsideLine.startPoint,t.outsideLine.endPoint,this.endClosedLine.startPoint,this.endClosedLine.endPoint,i):null}getInsideToDiffInsideIntersectionPoint(t,i=!1){return Gr(t.insideLine.startPoint,t.insideLine.endPoint,this.insideLine.startPoint,this.insideLine.endPoint,i)}getOutsideToDiffOutsideIntersectionPoint(t,i=!1){return Gr(t.outsideLine.startPoint,t.outsideLine.endPoint,this.outsideLine.startPoint,this.outsideLine.endPoint,i)}getInsideToDiffOutsideIntersectionPoint(t,i=!1){return Gr(t.outsideLine.startPoint,t.outsideLine.endPoint,this.insideLine.startPoint,this.insideLine.endPoint,i)}getOutsideToDiffInsideIntersectionPoint(t,i=!1){return Gr(t.insideLine.startPoint,t.insideLine.endPoint,this.outsideLine.startPoint,this.outsideLine.endPoint,i)}getClosedStartLineToDiffLineClosedStartLineIntersectionPoint(t,i=!1){return this.startClosedLine.visible?Gr(t.startClosedLine.startPoint,t.startClosedLine.endPoint,this.startClosedLine.startPoint,this.startClosedLine.endPoint,i):null}getClosedStartLineToDiffLineClosedEndLineIntersectionPoint(t,i=!1){return this.startClosedLine.visible?Gr(t.endClosedLine.startPoint,t.endClosedLine.endPoint,this.startClosedLine.startPoint,this.startClosedLine.endPoint,i):null}getClosedEndLineToDiffLineClosedStartLineIntersectionPoint(t,i=!1){return this.endClosedLine.visible?Gr(t.startClosedLine.startPoint,t.startClosedLine.endPoint,this.endClosedLine.startPoint,this.endClosedLine.endPoint,i):null}getClosedEndLineToDiffLineClosedEndLineIntersectionPoint(t,i=!1){return this.endClosedLine.visible?Gr(t.endClosedLine.startPoint,t.endClosedLine.endPoint,this.endClosedLine.startPoint,this.endClosedLine.endPoint,i):null}isCorner(t){const i=t.startPoint.sub(t.endPoint).normalize(),l=i.clone().mult(t.width),u=i.clone().mult(-t.width),h=t.insideLine.startPoint.clone().addvec(l),f=t.insideLine.startPoint.clone().addvec(u),r=t.outsideLine.startPoint.clone().addvec(u),v=t.outsideLine.startPoint.clone().addvec(l),b=t.insideLine.endPoint.clone().addvec(l),E=t.insideLine.endPoint.clone().addvec(u),M=t.outsideLine.endPoint.clone().addvec(u),D=t.outsideLine.endPoint.clone().addvec(l),L=ru([h,f,r,v],this.startPoint),z=ru([h,f,r,v],this.endPoint),k=ru([b,E,M,D],this.startPoint),F=ru([b,E,M,D],this.endPoint);return[{start:L,end:z},{start:k,end:F}]}handlingCorners(t){const[i,l]=this.isCorner(t);if(l.start){this.outsideLine.startPoint=t.outsideLine.endPoint=this.getOutsideToDiffOutsideIntersectionPoint(t,!0),this.insideLine.startPoint=t.insideLine.endPoint=this.getInsideToDiffInsideIntersectionPoint(t,!0),this.hiddenStartClosedLine(),t.hiddenEndClosedLine();return}else if(l.end){this.outsideLine.endPoint=t.insideLine.endPoint=this.getOutsideToDiffInsideIntersectionPoint(t,!0),this.insideLine.endPoint=t.outsideLine.endPoint=this.getInsideToDiffOutsideIntersectionPoint(t,!0),this.hiddenEndClosedLine(),t.hiddenEndClosedLine();return}else if(i.start){this.insideLine.startPoint=t.outsideLine.startPoint=this.getInsideToDiffOutsideIntersectionPoint(t,!0),this.outsideLine.startPoint=t.insideLine.startPoint=this.getOutsideToDiffInsideIntersectionPoint(t,!0),this.hiddenStartClosedLine(),t.hiddenStartClosedLine();return}else if(i.end){this.outsideLine.endPoint=t.outsideLine.startPoint=this.getOutsideToDiffOutsideIntersectionPoint(t,!0),this.insideLine.endPoint=t.insideLine.startPoint=this.getInsideToDiffInsideIntersectionPoint(t,!0),this.hiddenEndClosedLine(),t.hiddenStartClosedLine();return}}processingIntersection(){const t=[];uo.lines.forEach(i=>{const l=this.getInsideToDiffInsideIntersectionPoint(i),u=this.getInsideToDiffOutsideIntersectionPoint(i),h=this.getOutsideToDiffOutsideIntersectionPoint(i),f=this.getOutsideToDiffInsideIntersectionPoint(i);(l||u||h||f)&&t.push({diffLine:i,intersectionPoints:[l,u,h,f]})}),t.forEach(({diffLine:i,intersectionPoints:l})=>{const[u,h]=this.isCorner(i);u.end||u.start||h.start||h.start;const[f,r,v,b]=l,E=[i.insideLine.startPoint,i.insideLine.endPoint,i.outsideLine.endPoint,i.outsideLine.startPoint];if(ru(E,this.startPoint),ru(E,this.endPoint),f&&r&&v&&b){const M=Gr(this.startPoint,this.endPoint,i.startPoint,i.endPoint),D=new uo(this.startPoint,M,this.width),L=new uo(M,this.endPoint,this.width),z=new uo(i.startPoint,M,i.width),k=new uo(M,i.endPoint,i.width);D.insideLine.startPoint=this.insideLine.startPoint,D.outsideLine.startPoint=this.outsideLine.startPoint,L.insideLine.endPoint=this.insideLine.endPoint,L.outsideLine.endPoint=this.outsideLine.endPoint,i.remove(),this.remove(),D.draw(),L.draw(),z.draw(),k.draw()}else if(v&&r||f&&b){const M=Gr(this.startPoint,this.endPoint,i.startPoint,i.endPoint,!0),D=new uo(i.startPoint,M,i.width);D.hiddenEndClosedLine();const L=new uo(M,i.endPoint,i.width);L.hiddenStartClosedLine(),i.remove(),D.draw(),L.draw()}else{if(t.length===1)return this.handlingCorners(i);h.start?(console.log("endCorner.start"),v&&(i.outsideLine.endPoint=this.outsideLine.startPoint=v),f&&(i.insideLine.endPoint=this.insideLine.startPoint=f),this.hiddenStartClosedLine(),i.hiddenEndClosedLine()):h.end?(console.log("endCorner.end"),b&&(i.insideLine.endPoint=this.outsideLine.endPoint=b),r&&(i.outsideLine.endPoint=this.insideLine.endPoint=r),this.hiddenEndClosedLine(),i.hiddenEndClosedLine()):u.start?(console.log("startCorner.start"),r&&(i.outsideLine.startPoint=this.insideLine.startPoint=r),b&&(i.insideLine.startPoint=this.outsideLine.startPoint=b),i.hiddenStartClosedLine(),this.hiddenStartClosedLine()):u.end&&(console.log("startCorner.end"),v&&(i.outsideLine.startPoint=this.outsideLine.endPoint=v),f&&(i.insideLine.startPoint=this.insideLine.endPoint=f),i.hiddenStartClosedLine(),this.hiddenEndClosedLine())}})}draw(t=!0){if(this.isDraw)return;const i=P.MxCpp.getCurrentMxCAD();if(this.outsideLine&&this.outsideLine.erase(),this.insideLine&&this.insideLine.erase(),!i)return;this.outsideLine.trueColor=new P.McCmColor(255,0,0),this.outsideId=i.drawEntity(this.outsideLine),this.insideLine.trueColor=new P.McCmColor(0,255,255),this.insideId=i.drawEntity(this.insideLine);const l=this.outsideId.getMcDbEntity();l&&(this.outsideLine=l);const u=this.insideId.getMcDbEntity();u&&(this.insideLine=u),this.startClosedId=i.drawEntity(this.startClosedLine),this.endClosedId=i.drawEntity(this.endClosedLine);const h=this.startClosedId.getMcDbEntity();h&&(this.startClosedLine=h);const f=this.endClosedId.getMcDbEntity();f&&(this.endClosedLine=f),i.updateDisplay(),uo.lines.add(this),this.isDraw=!0,t&&this.processingIntersection()}remove(){this.endClosedId&&this.endClosedId.erase(),this.startClosedId&&this.startClosedId.erase(),this.insideId&&this.insideId.erase(),this.outsideId&&this.outsideId.erase(),uo.lines.delete(this)}};uo.lines=new Set;let R_=uo;class T3{call(t){if(t&&t.points){let i=P.MxCpp.getCurrentMxCAD();const l=l3(t.points);if(l.length<2)return;l.forEach((u,h)=>{const f=l[h+1];if(!f)return;new R_(u,f,t.width).draw()}),i.updateDisplay()}}regist_data(){return{filename:"drawWall.json",name:"drawWall",description:"根据坐标点合集绘制墙",params:[{name:"points",description:"绘制墙的坐标点",type:"str",required:!0},{name:"width",description:"绘制墙的宽度",type:"float",required:!1},...ys]}}}class E3{call(t){return lt(this,null,function*(){let i=P.MxCpp.App.getCurrentMxCAD();if(t.name){const u=i.getDatabase().getBlockTable().get(t.name);if(!u||!u.isValid())return;let h=new P.McDbBlockReference;h.blockTableRecordId=u;let f=h.getBoundingBox(),r=0;if(f.ret){let v=f.maxPt.distanceTo(f.minPt);v>1e-5&&(r=i.getMxDrawObject().screenCoordLong2Doc(100)/v,h.setScale(r))}h.position=new P.McGePoint3d(t.pos[0],t.pos[1]),i.drawEntity(h),i.updateDisplay()}})}regist_data(){return{filename:"insertBock.json",name:"insertBock",description:"放置插入某个物品",params:[{name:"name",description:"要放置插入的物品名称",type:"str",required:!0},{name:"pos",description:"要放置插入物品的位置",type:"tuple[float, float]",required:!0}]}}}function C3(){wo.regist(T3),wo.regist(E3)}class A3{call(t){return lt(this,null,function*(){let i=P.MxCpp.getCurrentMxCAD();console.log(t),i.newFile();let l;const u=typeof t.isMText=="undefined"?!1:t.isMText,h=()=>{const r=new P.McDbMText;return r.textHeight=t.textSize||100,r.location=t.textPos||new P.McGePoint3d,r.contents=t.textString||"",r},f=()=>{const r=new P.McDbText;return r.height=t.textSize||100,r.textString=t.textString||"",r.position=t.textPos||new P.McGePoint3d,r};if(!t.textString){const r=new P.MxCADUiPrString;r.setMessage("请输入文字");const v=yield r.go();if(!v)return;t.textString=v}if(t.textPos)t.textPos=ur(t.textPos);else{const r=new P.MxCADUiPrPoint;r.clearLastInputPoint(),r.setMessage("请指定文字位置");const v=yield r.go();if(r.setUserDraw((b,E)=>{if(t.textPos=b,u){const M=h();E.drawMcDbEntity(M)}else{const M=f();E.drawMcDbEntity(M)}}),!v)return;t.textPos=v}if(!t.textSize){const r=new P.MxCADUiPrPoint;r.clearLastInputPoint(),r.setMessage("通过线段长度确定文字高度");const v=yield r.go();if(v){r.setUserDraw((E,M)=>{if(t.textSize=v.distanceTo(E),u){const D=h();M.drawMcDbEntity(D)}else{const D=f();M.drawMcDbEntity(D)}});const b=yield r.go();b&&(t.textSize=b.distanceTo(v))}}if(u){const r=h();l=i.drawEntity(r)}else{const r=f();l=i.drawEntity(r)}_s(l.getMcDbEntity(),t),i.updateDisplay()})}regist_data(){return{filename:"drawText.json",name:"draw_text",description:"绘制或者插入文字或者多行文字(文本)",params:[{name:"isMText",description:"绘制的文字是否为多行文字",type:"boolean",required:!0},{name:"textString",description:"绘制的文字的内容",type:"str",required:!0},{name:"textPos",description:"绘制的文字的位置",type:"tuple[float, float]",required:!0},{name:"textSize",description:"绘制的文字的高度",type:"float",required:!0},...ys]}}}function S3(){wo.regist(A3)}class D3{call(t){if(console.log(t),t.isWithdraw){typeof t.withdrawNum!="number"&&(t.withdrawNum=1);for(let i=0;i<t.withdrawNum;i++)Le.MxFun.sendStringToExecute("Mx_Undo")}if(t.isRestore){typeof t.restoreNum!="number"&&(t.restoreNum=1);for(let i=0;i<t.restoreNum;i++)Le.MxFun.sendStringToExecute("Mx_Redo")}}regist_data(){return{filename:"call_withdraw_restore.json",name:"call_withdraw_restore",description:"撤回撤销和恢复",params:[{name:"isWithdraw",description:"是否要撤回或撤销",type:"boolean",required:!0},{name:"isRestore",description:"是否要恢复",type:"boolean",required:!0},{name:"withdrawNum",description:"撤回撤销(上)几步",type:"int",required:!1},{name:"restoreNum",description:"恢复(前)几步",type:"int",required:!1}]}}}function P3(){wo.regist(D3)}class L3{constructor(){this.aryRegData=[]}regist(t){let i=new t,l=i.regist_data();P.MxCpp.Ai.addFunction(l.name,i.call),this.aryRegData.push(l)}regist_server(t){this.aryRegData.forEach(i=>{i.operation_code=t,P.MxCpp.Ai.registTool(i)}),P.MxCpp.Ai.reloadTools({operation_code:t})}}let wo=new L3;function I3(){return lt(this,null,function*(){let e=new P.MxCADUiPrString;e.setMessage(`
 human:`);let t=yield e.go();t&&P.MxCpp.Ai.chat_tool(t)})}function R3(){return lt(this,null,function*(){let e=new P.MxCADUiPrString;e.setMessage(`
 输入 server_operate_code:`);let t=yield e.go();t&&wo.regist_server(t)})}function z3(){Le.MxFun.addCommand("Mx_Ai",I3),Le.MxFun.addCommand("Mx_AiRegistServer",R3),u3(),d3(),f3(),y3(),M3(),C3(),S3(),P3(),x3()}function k3(e,t){let i=40,l=new P.MxCADResbuf;l.AddString("电杆层",0),l.AddString("INSERT",5020);let u=new P.MxCADSelectionSet;u.crossingSelect(e.x-i,e.y-i,e.x+i,e.y+i,l);let h=[];if(u.forEach(f=>{let r=f.getMcDbEntity();if(r){let v=r;t[v.getObjectID().id]&&h.push({dist:v.position.distanceTo(e),blk:t[v.getObjectID().id]})}}),h.length!=0)return h.sort((f,r)=>f.dist-r.dist),h[0].dist<i?h[0].blk:!1}function B3(e,t,i){let l=t[e],u=l.ref,h=40,f=new P.MxCADResbuf;f.AddString("0",0),f.AddString("LINE",5020);let r=new P.MxCADSelectionSet;r.crossingSelect(u.position.x-h,u.position.y-h,u.position.x+h,u.position.y+h,f),r.forEach(v=>{let b=v.getMcDbEntity();if(b){let E=b,M=E.endPoint,D=E.startPoint.distanceTo(u.position);if(D>E.endPoint.distanceTo(u.position)&&(D=E.endPoint.distanceTo(u.position),M=E.startPoint),D<h&&!E[E.getObjectID().id]){let L=k3(M,t);L&&(i[E.getObjectID().id]={tag1:l.tag,tag2:L.tag,handle:E.getHandle()})}}})}function F3(){return lt(this,null,function*(){let e=new P.MxCADSelectionSet,t=new P.MxCADResbuf;t.AddString("电杆层",0),t.AddString("INSERT",5020),e.allSelect(t);let i={};e.forEach(u=>{let h=u.getMcDbEntity();if(h){let f=h,r=f.getAllAttribute(),v={};r.forEach(b=>{let E=b.getMcDbEntity();E.tag=="杆号"&&(v.tag=E.textString)}),v.tag&&(v.handle=f.getHandle(),i[u.id]={ref:f,tag:v.tag},console.log(v))}});let l={};Object.keys(i).forEach(u=>{B3(u,i,l)}),Object.keys(l).forEach(u=>{console.log(l[u])})})}function O3(){Le.MxFun.addCommand("MxTest_UserGetData",F3)}class vs extends P.McDbCustomEntity{constructor(t){super(t),this.pt1=new P.McGePoint3d,this.pt2=new P.McGePoint3d,this._text="",this._textsize=10}create(t){return new vs(t)}getTypeName(){return"McDbLineText"}set text(t){this._text=t}get text(){return this._text}set textsize(t){this._textsize=t}get textsize(){return this._textsize}dwgInFields(t){return this.pt1=t.readPoint("pt1").val,this.pt2=t.readPoint("pt2").val,this._text=t.readString("text").val,this._textsize=t.readDouble("textsize").val,!0}dwgOutFields(t){return t.writePoint("pt1",this.pt1),t.writePoint("pt2",this.pt2),t.writeString("text",this._text),t.writeDouble("textsize",this._textsize),!0}fineLink(t){let i={},l=this.getObjectID(),u=this._textsize*.5,h=new P.MxCADResbuf;h.AddString("McDbCustomEntity",5020);let f=new P.MxCADSelectionSet;return f.crossingSelect(t.x-u,t.y-u,t.x+u,t.y+u,h),f.forEach(r=>{if(r==l)return;let v=r.getMcDbEntity();if(v&&v instanceof vs){let b=v,E=b.getPoint1(),M=0,D=b.getPoint1().distanceTo(t);D>b.getPoint2().distanceTo(t)&&(D=b.getPoint2().distanceTo(t),E=b.getPoint2(),M=1),D<u&&(i[r.id]={link_point:E,link_pos:M})}}),i}moveGripPointsAt(t,i,l,u){this.assertWrite();let h=this.pt1.clone(),f=h;if(t==0?(this.pt1.x+=i,this.pt1.y+=l,this.pt1.z+=u,f=this.pt1):t==1&&(h=this.pt2.clone(),this.pt2.x+=i,this.pt2.y+=l,this.pt2.z+=u,f=this.pt2),this.getObjectID().isValid()){let r=this.fineLink(h);Object.keys(r).forEach(v=>{let E=new P.McObjectId(v).getMcDbEntity();r[v].link_pos==0?E.setPoint1(f):E.setPoint2(f)})}}getGripPoints(){let t=new P.McGePoint3dArray;return t.append(this.pt1),t.append(this.pt2),t}worldDraw(t){let i=this._textsize*.4,l=this.pt2.sub(this.pt1);l.normalize().mult(i);let u=new P.McDbLine(this.pt1.clone().addvec(l),this.pt2.clone().subvec(l));t.drawEntity(u);let h=this.pt2.sub(this.pt1).mult(.5),f=this.pt1.clone().addvec(h);h.dotProduct(P.McGeVector3d.kXAxis)<0&&h.negate();let r=h.angleTo2(P.McGeVector3d.kXAxis,P.McGeVector3d.kNegateZAxis),v=this._text;v.length==0&&(v=this.pt1.distanceTo(this.pt2).toFixed(2)),h.perpVector(),h.dotProduct(P.McGeVector3d.kYAxis)<0&&h.negate(),h.normalize().mult(this._textsize*.2);let b=new P.McDbText;b.textString=v,b.position=f.clone().addvec(h),b.alignmentPoint=f.clone().addvec(h),b.rotation=r,b.verticalMode=P.McDb.TextVertMode.kTextBottom,b.horizontalMode=P.McDb.TextHorzMode.kTextCenter,b.height=this._textsize,t.drawEntity(b);let E=new P.McDbCircle;E.center=this.pt1,E.radius=i,t.drawEntity(E);let M=new P.McDbCircle;M.center=this.pt2,M.radius=i,t.drawEntity(M)}setPoint1(t){this.assertWrite(),this.pt1=t.clone()}setPoint2(t){this.assertWrite(),this.pt2=t.clone()}getPoint1(){return this.pt1}getPoint2(){return this.pt2}}function N3(){return lt(this,null,function*(){let e=P.MxCpp.getCurrentMxCAD();e.newFile();let t=new P.McGePoint3d(100,100,0),i=new P.McGePoint3d(200,150,0),l=new P.McGePoint3d(400,50,0),u=new P.McGePoint3d(600,60,0),h=new P.McGePoint3d(200,300,0),f=5,r=new vs;r.setPoint1(t),r.setPoint2(i),r.textsize=f,r.text="xxxx",e.drawEntity(r);let v=new vs;v.setPoint1(i),v.setPoint2(l),v.textsize=f,e.drawEntity(v);let b=new vs;b.setPoint1(l),b.setPoint2(u),b.textsize=f,e.drawEntity(b);let E=new vs;E.setPoint1(i),E.setPoint2(h),E.textsize=f,e.drawEntity(E),e.zoomW(new P.McGePoint3d(-300,-300,0),new P.McGePoint3d(650,500,0)),e.updateDisplay()})}function U3(){Le.MxFun.addCommand("MxTest_LineText",N3),new vs().rxInit()}function V3(){O3(),U3()}class pd extends P.McDbCustomEntity{create(t){throw new Error("Method not implemented.")}getTypeName(){throw new Error("Method not implemented.")}dwgInFields(t){throw new Error("Method not implemented.")}dwgOutFields(t){throw new Error("Method not implemented.")}worldDraw(t){throw new Error("Method not implemented.")}}class fd extends pd{constructor(t){super(t),this.pt=new P.McGePoint3d}create(t){return new fd(t)}getTypeName(){return"McDbGisPoint"}dwgInFields(t){return this.pt=t.readPoint("pt").val,!0}dwgOutFields(t){return t.writePoint("pt",this.pt),!0}moveGripPointsAt(t,i,l,u){this.assertWrite(),t==0&&(this.pt.x+=i,this.pt.y+=l,this.pt.z+=u)}getGripPoints(){let t=new P.McGePoint3dArray;return t.append(this.pt),t}worldDraw(t){t.drawEntity(new P.McDbPoint(this.pt))}setPoint(t){this.assertWrite(),this.pt=t.clone()}getPoint(){return this.pt}}class md extends pd{constructor(t){super(t),this.pts=[]}create(t){return new md(t)}getTypeName(){return"McDbGisMultiPoint"}dwgInFields(t){return this.pts=t.readPoints("pts").val,!0}dwgOutFields(t){return t.writePoints("pts",this.pts),!0}moveGripPointsAt(t,i,l,u){this.assertWrite(),t>=0&&t<this.pts.length&&(this.pts[t].x+=i,this.pts[t].y+=l,this.pts[t].z+=u)}getGripPoints(){let t=new P.McGePoint3dArray;return this.pts.forEach(i=>{t.append(i)}),t}worldDraw(t){this.pts.forEach(i=>{t.drawEntity(new P.McDbPoint(i))})}setPoint(t,i){this.assertWrite(),t>=0&&t<this.pts.length&&(this.pts[t]=i.clone())}getPoint(t){return t>=0&&t<this.pts.length?this.pts[t]:new P.McGePoint3d}addPoint(t){this.pts.push(t.clone())}removeAllPoint(){this.pts=[]}getPointCount(){return this.pts.length}}class gd extends pd{constructor(t){super(t),this.pts=[]}create(t){return new gd(t)}getTypeName(){return"McDbGisLineString"}dwgInFields(t){return this.pts=t.readPoints("pts").val,!0}dwgOutFields(t){return t.writePoints("pts",this.pts),!0}moveGripPointsAt(t,i,l,u){this.assertWrite(),t>=0&&t<this.pts.length&&(this.pts[t].x+=i,this.pts[t].y+=l,this.pts[t].z+=u)}getGripPoints(){let t=new P.McGePoint3dArray;return this.pts.forEach(i=>{t.append(i)}),t}worldDraw(t){let i=new P.McDbPolyline;this.pts.forEach(l=>{i.addVertexAt(l)}),t.drawEntity(i)}setPoint(t,i){this.assertWrite(),t>=0&&t<this.pts.length&&(this.pts[t]=i.clone())}getPoint(t){return t>=0&&t<this.pts.length?this.pts[t]:new P.McGePoint3d}addPoint(t){this.pts.push(t.clone())}removeAllPoint(){this.pts=[]}getPointCount(){return this.pts.length}}class yd extends pd{constructor(t){super(t),this.ptss=[]}create(t){return new yd(t)}getTypeName(){return"McDbGisMultiLineString"}dwgInFields(t){this.ptss=[];let i=t.readLong("ptss_n");for(let l=0;l<i.val;l++){let u=t.readPoints("ptss_"+l);u.ret&&this.ptss.push(u.val)}return!0}dwgOutFields(t){return t.writeLong("ptss_n",this.ptss.length),this.ptss.forEach((i,l)=>{t.writePoints("ptss_"+l,i)}),!0}moveGripPointsAt(t,i,l,u){this.assertWrite();let h=0;for(let f=0;f<this.ptss.length;f++){let r=this.ptss[f];for(let v=0;v<r.length;v++){if(h==t){this.ptss[f][v].x+=i,this.ptss[f][v].y+=l,this.ptss[f][v].z+=u,f=this.ptss.length;break}h++}}}getGripPoints(){let t=new P.McGePoint3dArray;return this.ptss.forEach(i=>{i.forEach(l=>{t.append(l)})}),t}worldDraw(t){for(let i=0;i<this.ptss.length;i++){let l=this.ptss[i],u=new P.McDbPolyline;l.forEach(h=>{u.addVertexAt(h)}),t.drawEntity(u)}}addPoints(t){this.ptss.push(t)}removeAllPoint(){this.ptss=[]}getPointsCount(){return this.ptss.length}getPoints(t){return t>=0&&t<this.ptss.length?this.ptss[t]:[]}}class _d extends pd{constructor(t){super(t),this.ptss=[]}create(t){return new _d(t)}getTypeName(){return"McDbGisPolygon"}dwgInFields(t){this.ptss=[];let i=t.readLong("ptss_n");for(let l=0;l<i.val;l++){let u=t.readPoints("ptss_"+l);u.ret&&this.ptss.push(u.val)}return!0}dwgOutFields(t){return t.writeLong("ptss_n",this.ptss.length),this.ptss.forEach((i,l)=>{t.writePoints("ptss_"+l,i)}),!0}moveGripPointsAt(t,i,l,u){this.assertWrite();let h=0;for(let f=0;f<this.ptss.length;f++){let r=this.ptss[f];for(let v=0;v<r.length;v++){if(h==t){this.ptss[f][v].x+=i,this.ptss[f][v].y+=l,this.ptss[f][v].z+=u,f=this.ptss.length;break}h++}}}getGripPoints(){let t=new P.McGePoint3dArray;return this.ptss.forEach(i=>{i.forEach(l=>{t.append(l)})}),t}worldDraw(t){let i=new P.McDbHatch;for(let l=0;l<this.ptss.length;l++){let u=this.ptss[l];u.length>2&&i.appendLoop(new P.McGePoint3dArray(u))}i.numLoops>0&&t.drawEntity(i)}addPoints(t){this.ptss.push(t)}removeAllPoint(){this.ptss=[]}getPointsCount(){return this.ptss.length}getPoints(t){return t>=0&&t<this.ptss.length?this.ptss[t]:[]}}function G3(){return lt(this,null,function*(){let e=P.MxCpp.getCurrentMxCAD(),t=new P.MxCADUiPrPoint;t.setMessage("点取一个点坐标");let i=yield t.go();if(i){let l=new fd;l.setPoint(i),e.drawEntity(l)}})}function H3(){return lt(this,null,function*(){let e=P.MxCpp.getCurrentMxCAD(),t=new P.MxCADUiPrPoint;t.setMessage("点取一个点坐标");let i=new md,l=[];for(;;){t.clearLastInputPoint(),t.setDynamicInputType(Le.DynamicInputType.kXYCoordInput);let u=yield t.go();if(u){i.addPoint(u);let h=new P.McDbPoint(u);l.push(e.drawEntity(h))}else break}i.getPointCount()>0&&e.drawEntity(i),l.forEach(u=>{u.erase()})})}function W3(){return lt(this,null,function*(){let e=P.MxCpp.getCurrentMxCAD(),t=new P.MxCADUiPrPoint;t.setMessage("点取一个点坐标");let i=new gd,l=[],u;for(;;){u&&(t.setBasePt(u),t.setUseBasePt(!0)),t.setDynamicInputType(Le.DynamicInputType.kXYCoordInput);let h=yield t.go();if(h){if(i.addPoint(h),u){let f=new P.McDbLine;f.startPoint=u,f.endPoint=h,l.push(e.drawEntity(f))}u=h}else break}i.getPointCount()>1&&e.drawEntity(i),l.forEach(h=>{h.erase()})})}function j3(){return lt(this,null,function*(){let e=P.MxCpp.getCurrentMxCAD(),t=new P.MxCADUiPrPoint;t.setMessage("点取一个点坐标"),t.setKeyWords("[下一段线(N)]");let i=new yd,l=[],u=[],h;for(;;){h?t.setBasePt(h):t.setUseBasePt(!1),t.setDynamicInputType(Le.DynamicInputType.kXYCoordInput);let f=yield t.go();if(t.isKeyWordPicked("N"))l.length>1&&i.addPoints(l),l=[],h=void 0;else if(f){if(l.push(f),h){let r=new P.McDbLine;r.startPoint=h,r.endPoint=f,u.push(e.drawEntity(r))}h=f}else break}l.length>1&&i.addPoints(l),i.getPointsCount()>0&&e.drawEntity(i),u.forEach(f=>{f.erase()})})}function $3(){return lt(this,null,function*(){let e=P.MxCpp.getCurrentMxCAD(),t=new P.MxCADUiPrPoint;t.setMessage("点取一个点坐标");let i=new _d,l=[],u=[],h;for(;;){h?t.setBasePt(h):t.setUseBasePt(!1),l.length>2&&t.setKeyWords("[闭合(C)/退出(E)]"),t.setDynamicInputType(Le.DynamicInputType.kXYCoordInput);let f=yield t.go();if(t.isKeyWordPicked("C")){let r=new P.McDbLine;r.startPoint=l[0],r.endPoint=l[l.length-1],u.push(e.drawEntity(r)),l.length>2&&i.addPoints(l),l=[],h=void 0}else{if(t.isKeyWordPicked("E"))break;if(f){if(l.push(f),h){let r=new P.McDbLine;r.startPoint=h,r.endPoint=f,u.push(e.drawEntity(r))}h=f}else break}}l.length>2&&i.addPoints(l),i.getPointsCount()>0&&e.drawEntity(i),u.forEach(f=>{f.erase()})})}function q3(){let e=new P.MxCADSelectionSet,t=new P.MxCADResbuf;t.AddMcDbEntityTypes("McDbCustomEntity"),e.allSelect(t);let i={type:"FeatureCollection",features:[]};e.forEach(l=>{let u=l.getMcDbEntity();if(u){if(u instanceof fd){let f=u.getPoint(),r={type:"Feature",properties:{},geometry:{type:"Point",coordinates:[f.x,f.y,f.z]}};i.features.push(r)}else if(u instanceof md){let h=u,f=[],r=h.getPointCount();for(let b=0;b<r;b++){let E=h.getPoint(b);f.push([E.x,E.y,E.z])}let v={type:"Feature",properties:{},geometry:{type:"MultiPoint",coordinates:f}};i.features.push(v)}else if(u instanceof gd){let h=u,f=[],r=h.getPointCount();for(let b=0;b<r;b++){let E=h.getPoint(b);f.push([E.x,E.y,E.z])}let v={type:"Feature",properties:{},geometry:{type:"LineString",coordinates:f}};i.features.push(v)}else if(u instanceof yd){let h=u,f=[],r=h.getPointsCount();for(let b=0;b<r;b++){let E=h.getPoints(b),M=[];for(let D=0;D<E.length;D++){let L=E[D];M.push([L.x,L.y,L.z])}f.push(M)}let v={type:"Feature",properties:{},geometry:{type:"MultiLineString",coordinates:f}};i.features.push(v)}else if(u instanceof _d){let h=u,f=[],r=h.getPointsCount();for(let b=0;b<r;b++){let E=h.getPoints(b),M=[];for(let D=0;D<E.length;D++){let L=E[D];M.push([L.x,L.y,L.z])}f.push(M)}let v={type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:f}};i.features.push(v)}}}),console.log(JSON.stringify(i))}function Z3(){Le.MxFun.addCommand("MxGis_DrawPoint",G3),Le.MxFun.addCommand("MxGis_DrawMultiPoint",H3),Le.MxFun.addCommand("MxGis_DrawLineString",W3),Le.MxFun.addCommand("MxGis_DrawMultiLineString",j3),Le.MxFun.addCommand("MxGis_DrawPolygon",$3),Le.MxFun.addCommand("MxGis_Get_geojson",q3),new fd().rxInit(),new md().rxInit(),new gd().rxInit(),new yd().rxInit(),new _d().rxInit()}function X3(){return lt(this,null,function*(){let e=new P.MxCADSelectionSet;if(!(yield e.userSelect("选择对象:"))||e.count()==0)return;const t=[],i=P.MxCpp.getCurrentMxCAD(),l=new P.MxCADUiPrPoint;l.setMessage("指定基点");const u=yield l.go();if(u)for(;;){const h=new P.MxCADUiPrPoint;h.setMessage(`指定第二个点
`),t.length>0?h.setKeyWords("[阵列(A)/退出(E)/放弃(U)]"):h.setKeyWords("[阵列(A)/退出(E)]"),h.setUserDraw((r,v)=>{v.drawLine(r.toVector3(),u.toVector3()),e.forEach(b=>{let E=b.getMcDbEntity();if(!E)return;let M=E.clone();M.move(u,r),v.drawMcDbEntity(M)})});const f=yield h.go();if(h.getStatus()===Le.MrxDbgUiPrBaseReturn.kKeyWord){if(h.isKeyWordPicked("E"))return;if(h.isKeyWordPicked("U"))if(t.length>0)t[t.length-1].forEach(r=>{r.erase()}),t.pop();else return;else if(h.isKeyWordPicked("A")){const r=new P.MxCADUiPrInt;r.clearLastInputPoint(),r.setMessage(`输入要进行阵列的项目数
`);const v=(yield r.go())||1;let b=[];if(h.setUserDraw((M,D)=>{D.drawLine(M.toVector3(),u.toVector3()),b.length=0;let L=M.clone();b.push(L);for(let z=0;z<v-1;z++)L=L.clone().addvec(M.sub(u)),b.push(L);e.forEach(z=>{let k=z.getMcDbEntity();k&&b.forEach(F=>{let G=new P.McGeMatrix3d,X=k.clone();G.clone(),G.setToTranslation(F.sub(u)),X.transformBy(G),D.drawMcDbEntity(X)})})}),!(yield h.go()))return;t.push([]),e.forEach(M=>{let D=M.getMcDbEntity();D&&b.forEach(L=>{let z=new P.McGeMatrix3d,k=D.clone();z.clone(),z.setToTranslation(L.sub(u)),k.transformBy(z),t[t.length-1].push(i.drawEntity(k))})})}}else if(h.getStatus()===Le.MrxDbgUiPrBaseReturn.kOk){if(!f)return;t.push([]),e.forEach(r=>{let v=r.getMcDbEntity();if(!v)return;let b=v.clone();b.move(u,f),t[t.length-1].push(i.drawEntity(b))})}else return}})}function Y3(){return lt(this,null,function*(){let e=new P.MxCADResbuf;e.AddMcDbEntityTypes("ARC");let t=yield P.MxCADUtility.userSelect("选择圆弧对象",e);t.length!=0&&t.forEach(i=>lt(this,null,function*(){let l=yield i.getMcDbEntity(),u=l,h=u.center,f=u.radius,r=new P.McDbCircle;r.center=h,r.radius=f,l.erase(),P.MxCpp.getCurrentMxCAD().drawEntity(r)}))})}function J3(){return lt(this,null,function*(){const e=P.MxCpp.getCurrentMxCAD();let t=new P.MxCADSelectionSet;if(!(yield t.userSelect("选择复制旋转对象:"))||t.count()==0)return;const i=new P.MxCADUiPrPoint;i.setMessage("指定基点");const l=yield i.go(),u=new P.MxCADUiPrPoint;u.setMessage(`请指定目标点
`),u.setUserDraw((E,M)=>{M.drawLine(E.toVector3(),l.toVector3()),t.forEach(D=>{let L=D.getMcDbEntity();if(!L)return;let z=L.clone();z.move(l,E),M.drawMcDbEntity(z)})});const h=yield u.go();if(!h)return;let f=[];t.forEach(E=>{let M=E.getMcDbEntity();if(!M)return;let D=M.clone();D.move(l,h),f.push(e.drawEntity(D))});let r=new P.MxCADUiPrAngle;if(r.setMessage("请指定旋转角度"),r.setBasePt(h),r.setUserDraw((E,M)=>{M.drawLine(E.toVector3(),h.toVector3()),f.forEach(D=>{let L=D.getMcDbEntity();if(!L)return;let z=L.clone(),k=E.sub(h).angleTo2(P.McGeVector3d.kXAxis,P.McGeVector3d.kNegateZAxis);z.rotate(h,k),M.drawMcDbEntity(z)})}),!(yield r.go()))return;const b=r.value();f.forEach(E=>{let M=E.getMcDbEntity();if(!M)return;let D=M.clone();D.rotate(h,b),e.drawEntity(D),M.erase()})})}function K3(){return lt(this,null,function*(){let e=new P.MxCADResbuf;e.AddMcDbEntityTypes("CIRCLE");let t=yield P.MxCADUtility.userSelect("选择要转成多边形的对象",e);if(t.length==0)return;let i=new P.MxCADUiPrInt;i.setMessage("设置多边形边数");let l=(yield i.go())||5;if(i.clearLastInputPoint(),!l)return;const u=new P.MxCADUiPrPoint;u.setMessage(`
输入选项`),u.setKeyWords("[内接于圆(I)/外切于圆(C)]"),u.clearLastInputPoint(),yield u.go();let h="inside";u.isKeyWordPicked("i")&&(h="inside"),u.isKeyWordPicked("c")&&(h="outside");let f=P.MxCpp.getCurrentMxCAD();t.forEach(r=>lt(this,null,function*(){let v=yield r.getMcDbEntity(),b=v,E=[];if(h==="inside"){for(let D=0;D<l;D++){let L=b.getPointAtDist(b.getLength().val/l*D);L.ret&&E.push(L.val)}let M=new P.McDbPolyline;E.forEach(D=>{M.addVertexAt(D)}),M.isClosed=!0,f.drawEntity(M)}else if(h==="outside"){let M=90-360/(l*2),D=Math.sin(M*Math.PI/180),L=b.radius/D,z=new P.McDbCircle;z.center=b.center,z.radius=L;let k=[];for(let G=0;G<l;G++){let X=z.getPointAtDist(z.getLength().val/l*G);X.ret&&k.push(X.val)}let F=new P.McDbPolyline;k.forEach(G=>{F.addVertexAt(G)}),F.isClosed=!0,f.drawEntity(F)}v.erase()}))})}function Q3(){return lt(this,null,function*(){let e=yield P.MxCADUtility.userSelect("选择要修改颜色的对象");if(e.length==0)return;const t=new P.MxCADUiPrInt;t.setMessage("输入颜色索引(0~256)");let i=(yield t.go())||20,l=new P.McCmColor;l.setColorIndex(i),e.forEach(u=>lt(this,null,function*(){let h=u.getMcDbEntity();h.trueColor=l}))})}function eL(){return lt(this,null,function*(){let e=new P.MxCADResbuf;e.AddMcDbEntityTypes("ARC");let t=yield P.MxCADUtility.userSelect("选择圆弧对象",e);t.length!=0&&t.forEach(i=>lt(this,null,function*(){let l=yield i.getMcDbEntity();if(!l)return;let u=l.clone(),h=u.getLength(),f=u.getStartPoint().val,r=P.MxCpp.getCurrentMxCAD(),v=new P.McDbCircle;v.center=u.center,v.radius=u.radius;let b=v.getDistAtPoint(f),E=v.getPointAtDist(h.val+b.val).val,M=u.getFirstDeriv(f);if(!M.ret)return;let D=f.clone();D.addvec(M.val);let L=u.getFirstDeriv(E);if(!L.ret)return;let z=E.clone();z.addvec(L.val);let k=new P.McDbLine;k.startPoint=f,k.endPoint=D;let F=new P.McDbLine;F.startPoint=E,F.endPoint=z;let G=k.IntersectWith(F,P.McDb.Intersect.kExtendBoth);if(G.length()===0)return;let X=G.at(0);k.endPoint=X,F.endPoint=X,r.drawEntity(k),r.drawEntity(F)}))})}function tL(){return lt(this,null,function*(){let e=P.MxCpp.getCurrentMxCAD();const t=new P.MxCADUiPrPoint;if(t.setMessage(`
输入选项`),t.setKeyWords("[隐藏(A)/隐藏未选(B)/全部显示(C)]"),t.clearLastInputPoint(),yield t.go(),t.isKeyWordPicked("A")||t.isKeyWordPicked("B")){let i=yield P.MxCADUtility.userSelect("选择目标的对象");if(i.length==0)return;let l=[];if(i.forEach(u=>l.push(u.id)),t.isKeyWordPicked("A"))i.forEach(u=>lt(this,null,function*(){let h=yield u.getMcDbEntity(),f=h.clone();f.visible=!1,e.drawEntity(f),h.erase()}));else if(t.isKeyWordPicked("B")){let u=new P.MxCADSelectionSet;u.allSelect(),u.forEach(h=>lt(this,null,function*(){if(!l.includes(h.id)){let f=yield h.getMcDbEntity(),r=f.clone();r.visible=!1,e.drawEntity(r),f.erase()}}))}}else if(t.isKeyWordPicked("C")){let i=new P.MxCADSelectionSet;i.allSelect(),i.forEach(l=>lt(this,null,function*(){let u=yield l.getMcDbEntity(),h=u.clone();h.visible===!1&&(h.visible=!0,e.drawEntity(h),u.erase())}))}else return})}function nL(){return lt(this,null,function*(){const e=new P.MxCADUiPrPoint;let t=P.MxCpp.getCurrentMxCAD().getCurrentDatabaseDrawColor();e.setMessage(`
指定删除方框第一点:`);let i=yield e.go();if(!i)return;let l=P.MxCpp.getCurrentMxCAD(),u=new Le.MxDbRect;u.pt1=i.toVector3(),e.setUserDraw((E,M)=>{u.pt2=E.toVector3(),u.setColor(t),M.drawCustomEntity(u)}),e.setMessage(`
指定删除方框第二点:`),e.setDynamicInputType(Le.DynamicInputType.kXYCoordInput);let h=yield e.go();if(!h)return;u.pt2=h.toVector3();let f=new P.McDbPolyline;f.addVertexAt(i),f.addVertexAt(new P.McGePoint3d(i.x,h.y)),f.addVertexAt(h),f.addVertexAt(new P.McGePoint3d(h.x,i.y)),f.isClosed=!0;let r=l.drawEntity(f);const v=new P.MxCADSelectionSet;for(v.crossingSelect(i.x,i.y,h.x,h.y),v.getIds().forEach(E=>{if(E&&E.id!==r.id){let M=E.getMcDbEntity(),D=M.IntersectWith(f,P.McDb.Intersect.kOnBothOperands);if(D.length()===0)E.erase();else{let L=[];D.forEach(z=>L.push(z)),M.splitCurves(L).forEach(z=>{l.drawEntity(z)}),E.erase()}}});;){const E=new P.MxCADUiPrPoint;E.setMessage(`
选择需要精确删除的实体`);const M=yield E.go();if(!M)break;let D=P.MxCADUtility.findEntAtPoint(M.x,M.y,M.z,-1);l.addCurrentSelect(D)}P.MxCADUtility.getCurrentSelect().forEach(E=>{E.erase()}),l.mxdraw.clearMxCurrentSelect()})}function iL(){return lt(this,null,function*(){const e=P.MxCpp.getCurrentMxCAD(),t=new P.MxCADUiPrEntity;t.setMessage(`
请选择角度复制对象`);const i=yield t.go();if(i===null)return;const l=yield i.getMcDbEntity(),u=new P.MxCADUiPrInt;u.setMessage(`
请输入角度复制数量`);const h=(yield u.go())||1,f=new P.MxCADUiPrPoint;f.setMessage(`
请输入角度复制的基点`);const r=yield f.go();if(!r)return;const v=new P.MxCADUiPrAngle;if(v.setMessage(`
请输入复制角度`),v.setBasePt(r),v.setUserDraw((M,D)=>{const L=M.sub(r).angleTo2(P.McGeVector3d.kXAxis,P.McGeVector3d.kNegateZAxis);for(let z=1;z<h+1;z++){let k=l.clone();k.rotate(r,L*z),D.drawMcDbEntity(k)}}),!(yield v.go()))return;const E=v.value();for(let M=1;M<h+1;M++){let D=l.clone();D.rotate(r,E*M),e.drawEntity(D)}})}function rL(){return lt(this,null,function*(){let e=new P.MxCADResbuf;e.AddMcDbEntityTypes("LWPOLYLINE");let t=yield P.MxCADUtility.userSelect("请选择顶点对象",e);if(t.length==0)return;let i=yield P.MxCADUtility.userSelect("请选择复制对象");if(i.length==0)return;const l=new P.MxCADUiPrPoint;l.setMessage("请确定复制基点");const u=yield l.go();if(!u)return;const h=P.MxCpp.getCurrentMxCAD();t.forEach(f=>{let r=f.getMcDbEntity();if(!r)return;let v=r.numVerts();for(let b=0;b<v;b++){const E=r.getPointAt(b).val;i.forEach(M=>{const L=M.getMcDbEntity().clone();L.move(u,E),h.drawEntity(L)})}})})}function oL(){return lt(this,null,function*(){let e=new P.MxCADUiPrEntity;e.setMessage("请选择参考曲线");let t=yield e.go(),i=yield t.getMcDbEntity();if(i===null)return;const l=P.MxCpp.App.getCurrentMxCAD();let u=i.clone(),h=new P.MxCADResbuf;h.AddMcDbEntityTypes("CIRCLE,ARC,LINE,LWPOLYLINE,ELLIPSE");let f=yield P.MxCADUtility.userSelect("选择打断对象",h);f.length!=0&&f.forEach(r=>lt(this,null,function*(){if(r.id!==t.id){let v=yield r.getMcDbEntity(),b=v.IntersectWith(u,P.McDb.Intersect.kOnBothOperands);if(b.length()!=0){let E=[];b.forEach(L=>{E.push(L)});let M=[];E.forEach(L=>{let z=v.getClosestPointTo(L,!1);if(!z.ret)return;let k=v.getFirstDeriv(z.val);if(!k.ret)return;k.val.normalize().mult(Le.MxFun.viewCoordLong2Cad(10));let F=z.val.clone();F.addvec(k.val);let G=z.val.clone();G.subvec(k.val),M.push(F),M.push(G)});let D=v.splitCurves(M);if(D.empty()){v.highlight(!1);return}D.forEach((L,z)=>{z%2==0&&l.drawEntity(L)}),v.erase()}}}))})}function aL(){return lt(this,null,function*(){let e=P.MxCpp.App.getCurrentMxCAD(),t=new P.MxCADResbuf;t.AddMcDbEntityTypes("CIRCLE,ARC,LINE,LWPOLYLINE,ELLIPSE");let i=new P.MxCADUiPrEntity;i.setFilter(t),i.setMessage("指定偏移对象");let l=yield i.go();if(!l)return;const u=new P.MxCADUiPrDist;if(u.setMessage("请输入偏移距离"),!(yield u.go()))return;const f=u.value();let r=yield l.getMcDbEntity();const v=r.getStartPoint().val,E=r.getFirstDeriv(v).val.rotateBy(P.McGeVector3d.kYAxis.angleTo1(P.McGeVector3d.kXAxis)),M=v.clone().addvec(E),D=v.clone().subvec(E);let L=r.offsetCurves(f,M);if(L.length()===0)return;L.forEach(k=>{e.drawEntity(k)});let z=r.offsetCurves(f,D);z.length()!==0&&z.forEach(k=>{e.drawEntity(k)})})}function sL(){return lt(this,null,function*(){const e=new P.MxCADResbuf;e.AddMcDbEntityTypes("ARC,LINE,LWPOLYLINE");const t=new P.MxCADUiPrEntity;t.setFilter(e),t.setMessage("指定伸缩对象(选择直线、多段线、圆弧)");const i=yield t.go();if(!i)return;const l=P.MxCpp.App.getCurrentMxCAD(),u=i.getMcDbEntity();if(u instanceof P.McDbArc){const h=u.clone(),f=h.center,r=new P.MxCADUiPrPoint;r.setMessage("伸缩至"),u.visible=!1,r.setUserDraw((b,E)=>{h.endAngle=b.sub(f).angleTo2(P.McGeVector3d.kXAxis,P.McGeVector3d.kNegateZAxis),E.drawMcDbEntity(h)});const v=yield r.go();if(u.visible=!0,!v)return;u.endAngle=v.sub(f).angleTo2(P.McGeVector3d.kXAxis,P.McGeVector3d.kNegateZAxis),l.updateDisplay()}else if(u instanceof P.McDbLine){const h=u.clone(),f=new P.MxCADUiPrPoint;f.setMessage("伸缩至"),u.visible=!1;let r;f.setUserDraw((b,E)=>{r=h.getClosestPointTo(b,!0).val,h.endPoint=r,E.drawMcDbEntity(h)});const v=yield f.go();if(u.visible=!0,!v)return;u.endPoint=r,l.updateDisplay()}else if(u instanceof P.McDbPolyline){const h=u.clone(),f=new P.MxCADUiPrPoint;f.setMessage("伸缩至"),u.visible=!1;let r;const v=u.numVerts(),b=u.getBulgeAt(v-1),E=u.getWidthsAt(v-1);f.setUserDraw((D,L)=>{r=h.getClosestPointTo(D,!0).val,h.setPointAt(v-1,r),h.setBulgeAt(v-1,b),h.setWidthsAt(v-1,E.val1,E.val2),L.drawMcDbEntity(h)});const M=yield f.go();if(u.visible=!0,!M)return;u.setPointAt(v-1,r),u.setBulgeAt(v-1,b),u.setWidthsAt(v-1,E.val1,E.val2),l.updateDisplay()}})}function lL(){return lt(this,null,function*(){const e=new P.MxCADResbuf;e.AddMcDbEntityTypes("CIRCLE");let t=yield P.MxCADUtility.userSelect("选择对象",e);if(t.length==0)return;const i=new P.MxCADUiPrDist;i.setMessage("请输入圆半径");const l=t[0].getMcDbEntity();if(i.setBasePt(l.center),i.setUserDraw((f,r)=>{const v=f.distanceTo(l.center);t.forEach(b=>{const M=b.getMcDbEntity().clone();M.radius=v,r.drawMcDbEntity(M)})}),!(yield i.go()))return;const h=i.value();t.forEach(f=>{const r=f.getMcDbEntity();r.radius=h})})}function cL(){return lt(this,null,function*(){let e=new P.MxCADResbuf;e.AddMcDbEntityTypes("LWPOLYLINE,ARC,LINE,CIRCLE,ELLIPSE");let t=yield P.MxCADUtility.userSelect("选择要修改线型比例的对象",e);if(t.length==0)return;const i=new P.MxCADUiPrString;if(i.setMessage("请输入线型比例"),!(yield i.go()))return;const u=Number(i.value());u&&t.forEach(h=>lt(this,null,function*(){let f=h.getMcDbEntity();f.linetypeScale=u}))})}function uL(){return lt(this,null,function*(){const e=P.MxCpp.App.getCurrentMxCAD(),t=new P.MxCADUiPrDist;if(t.setMessage("请输入阵列间距"),!(yield t.go()))return;const l=t.value(),u=new P.MxCADResbuf;u.AddMcDbEntityTypes("ARC");const h=new P.MxCADUiPrEntity;h.setFilter(u),h.setMessage("请选择圆弧");const f=yield h.go();if(!f.id)return;const r=f.getMcDbEntity(),v=yield P.MxCADUtility.userSelect("选择排列对象");if(v.length==0)return;const b=new P.MxCADUiPrPoint;b.setMessage("指定排列基点");const E=yield b.go();E&&v.forEach(M=>lt(this,null,function*(){let D=M.getMcDbEntity(),L=r.getLength().val/l;if(!(L<1))for(let z=0;z<L;z++){let k=D.clone(),F=r.getPointAtDist(z*l);if(!F.ret)return;let G=F.val.sub(E),X=new P.McGeMatrix3d;X.setToTranslation(G),k.transformBy(X);let $=r.getFirstDeriv(F.val).val.rotateBy(P.McGeVector3d.kYAxis.angleTo1(P.McGeVector3d.kXAxis)).negate().angleTo2(P.McGeVector3d.kYAxis,P.McGeVector3d.kNegateZAxis);k.rotate(F.val,$),e.drawEntity(k)}}))})}function hL(){return lt(this,null,function*(){let e=new P.MxCADResbuf;e.AddMcDbEntityTypes("LWPOLYLINE");let t=new P.MxCADSelectionSet;if(!(yield t.userSelect("选择目标多段线:",e))||t.count()==0)return;const i=new P.MxCADUiPrDist;i.setMessage("请输入圆角半径<5>");let l=5;(yield i.go())&&(l=i.value());const h=P.MxCpp.getCurrentMxCAD();t.forEach(f=>{const r=f.getMcDbEntity(),v=new P.McDbPolyline;v.trueColor=r.trueColor,v.isClosed=r.isClosed,v.colorIndex=r.colorIndex,v.layerId=r.layerId;const b=r.numVerts(),E=[];for(let M=0;M<b;M++)E.push(r.getPointAt(M).val);r.isClosed===!0&&E.push(E[0],E[1]),E.forEach((M,D)=>{if(D+2>=E.length)return;const L=E[D+1],z=E[D+2],k=new P.McDbLine(L,M),F=new P.McDbLine(L,z),G=M.sub(L).angleTo2(z.sub(L),P.McGeVector3d.kNegateZAxis);let X=l*Math.sin(Math.PI/2-G/2)/Math.sin(G/2);X<0&&(X=-X);const re=k.getPointAtDist(X).val,ue=F.getPointAtDist(X).val;k.rotate(re,Math.PI/2),F.rotate(ue,Math.PI/2);const $=k.IntersectWith(F,P.McDb.Intersect.kExtendBoth);if(!$.length())return;const te=$.at(0),ie=new P.McDbLine(te,L).getPointAtDist(l).val;let se=P.MxCADUtility.calcBulge(re,ie,ue).val;if(D===0&&r.isClosed===!1){let me=r.getWidthsAt(D);v.addVertexAt(M,0,me.val1,me.val2)}let pe;r.isClosed===!0&&D+2===E.length-1?pe=r.getWidthsAt(D):pe=r.getWidthsAt(D+1),v.addVertexAt(re,se,pe.val1,pe.val2),v.addVertexAt(ue,0,pe.val1,pe.val2),D+2===E.length-1&&r.isClosed===!1&&v.addVertexAt(z,0,pe.val1,pe.val2)}),r.erase(),h.drawEntity(v)})})}function dL(){return lt(this,null,function*(){const e=new P.MxCADResbuf;e.AddMcDbEntityTypes("LWPOLYLINE");const t=new P.MxCADUiPrEntity;t.setMessage("请选择线对象"),t.setFilter(e);const i=yield t.go();if(console.log(i),!i.id)return;const l=i.getMcDbEntity(),u=l.numVerts(),h=new P.McDbPolyline;for(let r=u-1;r>=0;r--){const v=l.getPointAt(r).val;if(r>0){const b=l.getWidthsAt(r-1),E=l.getBulgeAt(r-1);h.addVertexAt(v,-E,b.val2,b.val1)}else{const b=l.getWidthsAt(r),E=l.getBulgeAt(r);h.addVertexAt(v,-E,b.val2,b.val2)}}const f=P.MxCpp.getCurrentMxCAD();h.isClosed=l.isClosed,f.drawEntity(h),l.erase()})}function pL(){Le.MxFun.addCommand("Mx_Multicopy",X3),Le.MxFun.addCommand("Mx_ArcToCircle",Y3),Le.MxFun.addCommand("Mx_CopyRotation",J3),Le.MxFun.addCommand("Mx_CricleTotoll",K3),Le.MxFun.addCommand("Mx_ChangeColor",Q3),Le.MxFun.addCommand("Mx_ArcToAngle",eL),Le.MxFun.addCommand("Mx_TemHiding",tL),Le.MxFun.addCommand("Mx_BoxDel",nL),Le.MxFun.addCommand("Mx_AngleCopy",iL),Le.MxFun.addCommand("Mx_VertexRep",rL),Le.MxFun.addCommand("Mx_IntersectBreak",oL),Le.MxFun.addCommand("Mx_DoubleOff",aL),Le.MxFun.addCommand("Mx_Telescoping",sL),Le.MxFun.addCommand("Mx_EitCircle",lL),Le.MxFun.addCommand("Mx_LayerTypeScale",cL),Le.MxFun.addCommand("Mx_ArcOrder",uL),Le.MxFun.addCommand("Mx_PlRoundCorners",hL),Le.MxFun.addCommand("Mx_PlReverse",dL)}function fL(){return lt(this,null,function*(){let e=new P.MxCADResbuf;e.AddMcDbEntityTypes("LINE");const t=new P.MxCADUiPrEntity;t.setMessage("请选择目标对齐线对象(选择直线)"),t.setFilter(e);const i=yield t.go();if(!i.id)return;const l=i.getMcDbEntity(),u=new P.MxCADUiPrEntity;let h=new P.MxCADResbuf;h.AddMcDbEntityTypes("TEXT"),u.setMessage("请选择目标文字对象"),u.setFilter(h);const f=yield u.go();if(!f.id)return;const r=f.getMcDbEntity();let b=l.getFirstDeriv(l.getStartPoint().val).val.angleTo2(P.McGeVector3d.kXAxis,P.McGeVector3d.kNegateZAxis),E=r.rotation;r.rotate(r.position,b-E),P.MxCpp.App.getCurrentMxCAD().updateDisplay()})}function mL(){return lt(this,null,function*(){let e=new P.MxCADResbuf;e.AddMcDbEntityTypes("TEXT, MTEXT");const t=yield P.MxCADUtility.userSelect("选择文字对象",e);if(t.length==0)return;const i=new P.MxCADUiPrString;i.setMessage("请设置字高");const l=yield i.go();!l||!Number(l)||(t.forEach(u=>{const h=u.getMcDbEntity();h.height=Number(l)}),P.MxCpp.getCurrentMxCAD().updateDisplay())})}function gL(){return lt(this,null,function*(){let e=new P.MxCADResbuf;e.AddMcDbEntityTypes("TEXT, MTEXT");const t=yield P.MxCADUtility.userSelect("选择文字对象",e);if(t.length==0)return;const i=new P.MxCADUiPrString;i.setMessage("请设置字宽");const l=yield i.go();!l||!Number(l)||(t.forEach(u=>{const h=u.getMcDbEntity();h.widthFactor=Number(l)}),P.MxCpp.getCurrentMxCAD().updateDisplay())})}function yL(){return lt(this,null,function*(){const e=new P.MxCADResbuf;e.AddMcDbEntityTypes("TEXT");const t=new P.MxCADUiPrEntity;t.setMessage("请选择源文字"),t.setFilter(e);const i=yield t.go();if(!(i!=null&&i.id))return;const l=i.getMcDbEntity();let u=yield P.MxCADUtility.userSelect("请选择目标文字",e);if(u.length==0)return;const h=P.MxCpp.App.getCurrentMxCAD();u.forEach(f=>{let v=f.getMcDbEntity().clone();v.textString=l.textString,h.drawEntity(v),f.erase()})})}function _L(){return lt(this,null,function*(){const e=new P.MxCADResbuf;e.AddMcDbEntityTypes("TEXT");const t=new P.MxCADUiPrEntity;t.setFilter(e),t.setMessage("请选择第一个文字");const i=yield t.go();if(!(i!=null&&i.id))return;const l=i.getMcDbEntity(),u=P.MxCpp.App.getCurrentMxCAD(),h=new P.MxCADUiPrEntity;h.setFilter(e),h.setMessage("请选择第二个文字");const f=yield h.go();if(!(f!=null&&f.id))return;const r=f.getMcDbEntity();let v=l.textString,b=r.textString,E=l.clone(),M=r.clone();E.textString=b,M.textString=v,u.drawEntity(E),u.drawEntity(M),i.erase(),f.erase()})}function vL(){return lt(this,null,function*(){const e=new P.MxCADResbuf;e.AddMcDbEntityTypes("TEXT");let t=yield P.MxCADUtility.userSelect("请选择需要对齐的文字",e);if(t.length==0)return;const i=new P.MxCADUiPrKeyWord;i.setMessage("请选择对齐方式"),i.setKeyWords("[左(L)/中(M)/右(R)]");const l=yield i.go();if(!l)return;const u=new P.MxCADUiPrPoint;u.setMessage("请选择对齐基点");const h=yield u.go();if(!h)return;const f=P.MxCpp.getCurrentMxCAD();l==="L"?t.forEach(r=>{const v=r.getMcDbEntity(),b=v.clone(),E=v.alignmentPoint,M=v.position;b.horizontalMode=P.McDb.TextHorzMode.kTextLeft,b.alignmentPoint=new P.McGePoint3d(h.x,E.y),b.position=new P.McGePoint3d(h.x,M.y),f.drawEntity(b),r.erase()}):l==="R"?t.forEach(r=>{const v=r.getMcDbEntity(),b=v.clone(),E=v.alignmentPoint,M=v.position;b.horizontalMode=P.McDb.TextHorzMode.kTextRight,b.alignmentPoint=new P.McGePoint3d(h.x,E.y),b.position=new P.McGePoint3d(h.x,M.y),f.drawEntity(b),r.erase()}):l==="M"&&t.forEach(r=>{const v=r.getMcDbEntity(),b=v.clone(),E=v.alignmentPoint,M=v.position;b.horizontalMode=P.McDb.TextHorzMode.kTextCenter,b.alignmentPoint=new P.McGePoint3d(h.x,E.y),b.position=new P.McGePoint3d(h.x,M.y),f.drawEntity(b),r.erase()})})}function xL(){return lt(this,null,function*(){const e=new P.MxCADResbuf;e.AddMcDbEntityTypes("TEXT");let t=yield P.MxCADUtility.userSelect("请选择需要对齐的文字",e);if(t.length==0)return;const i=new P.MxCADUiPrPoint;i.setMessage("请选择对齐基点");const l=yield i.go();l&&(t.forEach(u=>{const h=u.getMcDbEntity(),f=h.position;h.alignmentPoint=h.position=new P.McGePoint3d(f.x,l.y)}),P.MxCpp.getCurrentMxCAD().updateDisplay())})}function bL(){return lt(this,null,function*(){const e=new P.MxCADResbuf;e.AddMcDbEntityTypes("TEXT");let t=yield P.MxCADUtility.userSelect("请选择需要反转的文字",e);if(t.length==0)return;const i=P.MxCpp.App.getCurrentMxCAD();t.forEach(l=>{const u=l.getMcDbEntity(),h=u.clone();let f=u.getBoundingBox();if(!f.ret)return;const r=f.maxPt,v=f.minPt,b=new P.McDbLine(v,r),E=b.getPointAtDist(b.getLength().val/2).val,M=P.McGeVector3d.kXAxis.angleTo1(new P.McGeVector3d(-1,0,0))+u.rotation;h.rotate(E,M),l.erase(),i.drawEntity(h)})})}function wL(){return lt(this,null,function*(){const e=new P.MxCADResbuf;e.AddMcDbEntityTypes("TEXT, MTEXT");let t=yield P.MxCADUtility.userSelect("请选择需要去空格的文字",e);t.length!=0&&t.forEach(i=>{const l=i.getMcDbEntity();let u;l instanceof P.McDbText?(u=l.clone(),u.textString=l.textString.replace(/\s+/g,"")):l instanceof P.McDbMText&&(u=l.clone(),u.contents=l.contents.replace(/\s+/g,"")),i.erase(),P.MxCpp.App.getCurrentMxCAD().drawEntity(u)})})}function ML(){return lt(this,null,function*(){const e=new P.MxCADResbuf;e.AddMcDbEntityTypes("TEXT, MTEXT");let t=yield P.MxCADUtility.userSelect("请选择文字对象",e);t.length!=0&&t.forEach(i=>{let u=i.getMcDbEntity().getBoundingBox();if(!u.ret)return;const h=u.maxPt,f=u.minPt,r=new P.McDbPolyline;r.addVertexAt(f),r.addVertexAt(new P.McGePoint3d(f.x,h.y)),r.addVertexAt(h),r.addVertexAt(new P.McGePoint3d(h.x,f.y)),r.isClosed=!0,P.MxCpp.getCurrentMxCAD().drawEntity(r)})})}function TL(){return lt(this,null,function*(){const e=new P.MxCADResbuf;e.AddMcDbEntityTypes("TEXT");let t=yield P.MxCADUtility.userSelect("请选择文字对象",e);if(t.length==0)return;const i=new P.MxCADUiPrInt;i.setMessage(`请输入下划线宽度
`);const l=(yield i.go())||0,u=new P.MxCADUiPrDist;u.setMessage(`请设置下划线距离
`);const h=yield u.go();let f=0;h&&(f=u.value());const r=new P.MxCADUiPrDist;r.setMessage(`请设置下划线延长距离
`);const v=yield r.go();let b=0;v&&(b=r.value()),t.forEach(E=>{let D=E.getMcDbEntity().getBoundingBox();if(!D.ret)return;const L=D.maxPt,z=D.minPt,k=new P.McDbLine(z.x,z.y,0,L.x,z.y,0),F=new P.McDbLine(L.x,z.y,0,z.x,z.y,0),G=F.getLength().val,X=k.getPointAtDist(G+b).val,re=F.getPointAtDist(G+b).val,ue=new P.McDbPolyline;ue.addVertexAt(X,0,l,l),ue.addVertexAt(re,0,l,l);const $=ue.getClosestPointTo(L,!0).val,te=$.clone().sub(L);te.normalize().mult(f);const oe=$.clone().addvec(te),ie=new P.McGeMatrix3d;ie.setToTranslation(oe.sub($)),ue.transformBy(ie),P.MxCpp.getCurrentMxCAD().drawEntity(ue)})})}function EL(){return lt(this,null,function*(){const e=new P.MxCADResbuf;e.AddMcDbEntityTypes("TEXT");let t=yield P.MxCADUtility.userSelect("请选择文字对象",e);t.length!=0&&t.forEach(i=>{let u=i.getMcDbEntity().getBoundingBox();if(!u.ret)return;const h=u.maxPt,f=u.minPt,r=new P.McDbPolyline;r.addVertexAt(f,0,2,2),r.addVertexAt(new P.McGePoint3d(h.x,f.y),0,2,2);const v=new P.McDbPolyline;v.addVertexAt(f),v.addVertexAt(new P.McGePoint3d(h.x,f.y));const b=r.getClosestPointTo(h,!0).val,E=b.clone().sub(h),M=b.clone().sub(h);E.normalize().mult(2),M.normalize().mult(4);const D=b.clone().addvec(E),L=b.clone().addvec(M),z=new P.McGeMatrix3d,k=new P.McGeMatrix3d;z.setToTranslation(D.sub(b)),r.transformBy(z),k.setToTranslation(L.sub(b)),v.transformBy(k),P.MxCpp.getCurrentMxCAD().drawEntity(r),P.MxCpp.getCurrentMxCAD().drawEntity(v)})})}function CL(){return lt(this,null,function*(){const e=new P.MxCADResbuf;e.AddMcDbEntityTypes("TEXT");let t=yield P.MxCADUtility.userSelect("请选择文字对象",e);if(t.length==0)return;const i=new P.MxCADUiPrKeyWord;i.setMessage(`请选择操作选项
`),i.setKeyWords("[大写(C)/小写(S)/句首大写(I)]");const l=yield i.go();if(!l)return;const u=P.MxCpp.getCurrentMxCAD();l==="C"?t.forEach(h=>{const f=h.getMcDbEntity(),r=f.textString,v=f.clone();v.textString=r.toUpperCase(),console.log(v.textString),f.erase(),u.drawEntity(v)}):l==="S"?t.forEach(h=>{const f=h.getMcDbEntity(),r=f.textString,v=f.clone();v.textString=r.toLowerCase(),console.log(v.textString),f.erase(),u.drawEntity(v)}):l==="I"&&t.forEach(h=>{const f=h.getMcDbEntity(),r=f.textString,v=f.clone();v.textString=r.charAt(0).toUpperCase()+r.slice(1),f.erase(),u.drawEntity(v)})})}function AL(){return lt(this,null,function*(){const e=new P.MxCADResbuf;e.AddMcDbEntityTypes("TEXT");let t=yield P.MxCADUtility.userSelect("请选择数字对象",e);if(t.length==0)return;let i=[];if(t.forEach(v=>{const b=v.getMcDbEntity(),E=Number(b.textString);isNaN(E)||i.push(E)}),i.length!==t.length)return;let l=i.reduce((v,b)=>v+b,0);const u=new P.MxCADUiPrPoint,h=new P.McDbText;h.textString=l.toString(),h.height=10,u.setMessage(`请选择文字插入点
`),u.setUserDraw((v,b)=>{h.position=v,h.alignmentPoint=v,b.drawMcDbEntity(h)});const f=yield u.go();if(!f)return;const r=P.MxCpp.getCurrentMxCAD();h.position=f,h.alignmentPoint=f,r.drawEntity(h)})}function SL(){return lt(this,null,function*(){const e=new P.MxCADResbuf;e.AddMcDbEntityTypes("TEXT");let t=new P.MxCADSelectionSet;if(!(yield t.userSelect("选择要查找的范围:",e))||t.count()==0)return;const i=new P.MxCADUiPrKeyWord;i.setMessage(`请选择查找模式
`),i.setKeyWords("[等于(A)/包含(B)/前缀为(C)/后缀为(D)]");const l=yield i.go();if(!l)return;const u=new P.MxCADUiPrString;u.setMessage(`请输入关键字
`);const h=yield u.go();if(!h)return;const f=P.MxCpp.getCurrentMxCAD();let r=[];t.forEach(v=>{const E=v.getMcDbEntity().textString;l==="A"?E===h&&r.push(v):l==="B"?E.includes(h)&&r.push(v):l==="C"?E.startsWith(h)&&r.push(v):l==="D"&&E.endsWith(h)&&r.push(v)}),r.length>0&&r.forEach(v=>{f.addCurrentSelect(v)})})}function DL(){return lt(this,null,function*(){const e=new P.MxCADResbuf;e.AddMcDbEntityTypes("TEXT");let t=new P.MxCADSelectionSet;if(!(yield t.userSelect("选择要操作的范围:",e))||t.count()==0)return;const i=new P.MxCADUiPrKeyWord;i.setMessage("选择操作方式"),i.setKeyWords("[添加(A)/删除(D)]");let l=yield i.go();if(!l)return;const u=new P.MxCADUiPrKeyWord;u.setMessage("选择操作位置"),u.setKeyWords("[前缀(P)/后缀(S)]");let h=yield u.go();if(!h)return;const f=new P.MxCADUiPrString;f.setMessage("请输入内容");const r=yield f.go();r&&t.forEach(v=>{const b=v.getMcDbEntity(),E=b.textString;l==="A"?h==="P"?b.textString=r+E:h==="S"&&(b.textString=E+r):l==="D"&&(h==="P"?E.startsWith(r)&&(b.textString=E.slice(r.length)):h==="S"&&E.endsWith(r)&&(b.textString=E.slice(0,-r.length)))})})}function PL(){return lt(this,null,function*(){const e=new P.MxCADResbuf;e.AddMcDbEntityTypes("TEXT");const t=P.MxCpp.getCurrentMxCAD();for(;;){const h=new P.MxCADUiPrPoint;h.setMessage(`请选择文本
`);const f=yield h.go();if(!f)break;let r=P.MxCADUtility.findEntAtPoint(f.x,f.y,f.z,-1,e);t.addCurrentSelect(r)}const i=P.MxCADUtility.getCurrentSelect();if(!i.length)return;let l="";i.forEach((h,f)=>{const r=h.getMcDbEntity();l+=r.textString,f!==0&&h.erase()});const u=i.at(0).getMcDbEntity();u.textString=l,t.mxdraw.clearMxCurrentSelect()})}function LL(){return lt(this,null,function*(){new P.MxCADResbuf().AddMcDbEntityTypes("TEXT");const t=new P.MxCADUiPrEntity;t.setMessage(`请选择文本
`);const i=yield t.go();if(!i)return;const l=i.getMcDbEntity(),u=l.textString.split("").join("\\P"),h=new P.McDbMText;h.contents=u,h.textHeight=l.height,h.location=l.position,h.trueColor=l.trueColor,h.colorIndex=l.colorIndex,h.layerId=l.layerId;const f=P.MxCpp.getCurrentMxCAD();i.erase(),f.drawEntity(h)})}function IL(){return lt(this,null,function*(){const e=new P.MxCADResbuf;e.AddMcDbEntityTypes("TEXT");const t=new P.MxCADUiPrEntity;t.setFilter(e),t.setMessage(`请选择文本
`);const i=yield t.go();if(!i.id)return;const l=i.getMcDbEntity();l.highlight(!0);const u=new P.MxCADResbuf;u.AddMcDbEntityTypes("ARC");const h=new P.MxCADUiPrEntity;h.setFilter(u),h.setMessage(`请选择圆弧
`);const f=yield h.go();if(!f.id)return;const r=f.getMcDbEntity();r.highlight(!0);const v=l.textString.split("");v.reverse();const b=r.getLength().val/(v.length-1),E=P.MxCpp.getCurrentMxCAD();for(let M=0;M<v.length;M++){const D=r.getPointAtDist(b*M).val,L=new P.McDbText;L.textString=v[M],L.position=L.alignmentPoint=D,L.horizontalMode=P.McDb.TextHorzMode.kTextMid,L.trueColor=l.trueColor,L.colorIndex=l.colorIndex,L.height=l.height,L.widthFactor=l.widthFactor,L.rotation=l.rotation,E.drawEntity(L)}l.highlight(!1),r.highlight(!1)})}function RL(){Le.MxFun.addCommand("Mx_AlignByLine",fL),Le.MxFun.addCommand("Mx_TextHeight",mL),Le.MxFun.addCommand("Mx_TextWidth",gL),Le.MxFun.addCommand("Mx_BrushCon",yL),Le.MxFun.addCommand("Mx_ReplaceCon",_L),Le.MxFun.addCommand("Mx_AlignLeft",vL),Le.MxFun.addCommand("Mx_AlignUp",xL),Le.MxFun.addCommand("Mx_TextReversal",bL),Le.MxFun.addCommand("Mx_TextTrim",wL),Le.MxFun.addCommand("Mx_TextTraming",ML),Le.MxFun.addCommand("Mx_Underline",TL),Le.MxFun.addCommand("Mx_TitleLine",EL),Le.MxFun.addCommand("Mx_Case",CL),Le.MxFun.addCommand("Mx_NumSum",AL),Le.MxFun.addCommand("Mx_SSWords",SL),Le.MxFun.addCommand("Mx_Prefix",DL),Le.MxFun.addCommand("Mx_ConnectText",PL),Le.MxFun.addCommand("Mx_VerticalText",LL),Le.MxFun.addCommand("Mx_AlignByArc",IL)}function zL(){return lt(this,null,function*(){let e=new P.MxCADResbuf;e.AddMcDbEntityTypes("INSERT");const t=new P.MxCADUiPrEntity;t.setMessage("请选择目标块对象"),t.setFilter(e);const i=yield t.go();if(!i.id)return;const l=new P.MxCADUiPrString;l.setMessage("请输入新块名");const u=yield l.go();if(!u)return;const h=i.getMcDbEntity().blockTableRecordId.getMcDbBlockTableRecord();console.log("原块名",h.name),h.name=u,console.log("新块名",h.name)})}function kL(){return lt(this,null,function*(){let e=new P.MxCADResbuf;e.AddMcDbEntityTypes("INSERT");const t=new P.MxCADUiPrEntity;t.setMessage("选择需要修改基点的块"),t.setFilter(e);const i=yield t.go();if(!i.id)return;const l=i.getMcDbEntity(),u=new P.MxCADUiPrPoint,h=P.MxCpp.getCurrentMxCAD();u.setMessage("设置基点");const f=yield u.go();if(!f)return;let r=l.blockTableRecordId.getMcDbBlockTableRecord(),v=r.origin.clone(),b=l.blockTransform;v.transformBy(b);const E=f.sub(v);b.invert(),f.transformBy(b),r.origin=f,l.position=l.position.addvec(E),h.updateDisplay()})}function $1(e){e.getAllEntityId().forEach(t=>{let i=t.getMcDbEntity();i.colorIndex=P.ColorIndexType.kByblock,i instanceof P.McDbBlockReference&&$1(i.blockTableRecordId.getMcDbBlockTableRecord())})}function BL(){return lt(this,null,function*(){let e=new P.MxCADResbuf;e.AddMcDbEntityTypes("INSERT");const t=new P.MxCADUiPrEntity;t.setMessage("选择需要修改基点的块"),t.setFilter(e);const i=yield t.go();if(!i.id)return;const l=i.getMcDbEntity();let u=l.blockTableRecordId.getMcDbBlockTableRecord();$1(u);const h=new P.MxCADUiPrInt;h.setMessage("输入颜色索引(0~256)");let f=(yield h.go())||0,r=new P.McCmColor;r.setColorIndex(f),l.trueColor=r,P.MxCpp.getCurrentMxCAD().updateDisplay()})}function FL(){return lt(this,null,function*(){let e=new P.MxCADResbuf;e.AddMcDbEntityTypes("INSERT");const t=new P.MxCADUiPrEntity;t.setMessage("请选择源块"),t.setFilter(e);const i=yield t.go();if(!i.id)return;const l=i.getMcDbEntity();let u=new P.MxCADSelectionSet;(yield u.userSelect("选择要刷的目标块:",e))&&u.count()!=0&&u.forEach(h=>{const f=h.getMcDbEntity(),r=l.clone();r.position=f.position,h.erase(),P.MxCpp.getCurrentMxCAD().drawEntity(r)})})}function OL(){return lt(this,null,function*(){const e=new P.MxCADUiPrKeyWord;e.setMessage("选择连接方式"),e.setKeyWords("[手动逐个连线(H)/自动批量连线(A)]");const t=yield e.go();if(!t)return;const i=P.MxCpp.getCurrentMxCAD();let l=new P.MxCADResbuf;if(l.AddMcDbEntityTypes("INSERT"),t==="A"){let u=new P.MxCADSelectionSet;if(!(yield u.userSelect("选择要刷的目标块:",l))||u.count()==0)return;const h=new P.McDbPolyline;u.forEach(f=>{const r=f.getMcDbEntity();h.addVertexAt(r.position)}),i.drawEntity(h)}else if(t==="H"){const u=new P.McDbPolyline;for(;;){const h=new P.MxCADUiPrEntity;h.setMessage("请选择连线的块"),h.setFilter(l),h.setUserDraw((v,b)=>{const E=u.clone();E.addVertexAt(v),b.drawMcDbEntity(E)});const f=yield h.go();if(!f.id)break;const r=f.getMcDbEntity();u.addVertexAt(r.position)}i.drawEntity(u)}})}function NL(){return lt(this,null,function*(){let e=new P.MxCADResbuf;e.AddMcDbEntityTypes("INSERT");const t=new P.MxCADUiPrEntity;t.setMessage("请选择连线的块"),t.setFilter(e);const i=yield t.go();if(!i.id)return;let u=i.getMcDbEntity().getBoundingBox();const h=new P.McDbPolyline;h.addVertexAt(u.minPt),h.addVertexAt(u.maxPt);const f=h.getPointAtDist(h.getLength().val/2).val,r=new P.MxCADUiPrDist;r.setMessage("设置中心线长度"),r.setBasePt(f),r.setUserDraw((L,z)=>{const k=L.distanceTo(f);let F=new P.McDbLine(f.x+k,f.y,f.z,f.x-k,f.y,f.z),G=F.clone();G.rotate(f,Math.PI/2),z.drawMcDbEntity(G),z.drawMcDbEntity(F)});const v=yield r.go();let b=10;v&&(b=r.value());const E=P.MxCpp.App.getCurrentMxCAD();let M=new P.McDbLine(f.x+b,f.y,f.z,f.x-b,f.y,f.z);M.trueColor=new P.McCmColor(255,0,0);let D=M.clone();D.rotate(f,Math.PI/2),E.drawEntity(D),E.drawEntity(M)})}function UL(){return lt(this,null,function*(){let e=new P.MxCADResbuf;e.AddMcDbEntityTypes("INSERT");let t=new P.MxCADSelectionSet;if(!(yield t.userSelect("选择要旋转的目标块:",e))||t.count()==0)return;const i=t.item(0).getMcDbEntity(),l=new P.MxCADUiPrDist;l.setMessage("设置旋转角度"),l.setBasePt(i.position);let u=0;l.setUserDraw((r,v)=>{u=r.sub(i.position).angleTo2(P.McGeVector3d.kXAxis,P.McGeVector3d.kNegateZAxis),t.forEach(b=>{const M=b.getMcDbEntity().clone();M.rotate(M.position,u),v.drawMcDbEntity(M)})});const h=yield l.go();if(!h)return;l.getDetailedResult()===Le.DetailedResult.kCoordIn&&(u=h*Math.PI/180),t.forEach(r=>{const v=r.getMcDbEntity();v.rotate(v.position,u)}),P.MxCpp.getCurrentMxCAD().updateDisplay()})}function VL(){return lt(this,null,function*(){let e=new P.MxCADResbuf;e.AddMcDbEntityTypes("INSERT");let t=new P.MxCADSelectionSet;if(!(yield t.userSelect("选择要旋转的目标块:",e))||t.count()==0)return;const i=new P.MxCADUiPrDist;i.setMessage("请设置缩放比例");let l=t.item(0).getMcDbEntity();if(i.setBasePt(l.position),i.setUserDraw((r,v)=>{const b=r.distanceTo(l.position);t.forEach(E=>{const D=E.getMcDbEntity().clone();let L=new P.McGeMatrix3d;L.setToScaling(b,D.position),D.transformBy(L),v.drawMcDbEntity(D)})}),!(yield i.go()))return;const h=i.value()||1;t.forEach(r=>{const v=r.getMcDbEntity();let b=new P.McGeMatrix3d;b.setToScaling(h,v.position),v.transformBy(b)}),P.MxCpp.getCurrentMxCAD().updateDisplay()})}function GL(){return lt(this,null,function*(){let e=new P.MxCADResbuf;e.AddMcDbEntityTypes("INSERT");const t=new P.MxCADUiPrEntity;t.setMessage("请选择源块"),t.setFilter(e);const i=yield t.go();if(!i.id)return;const u=i.getMcDbEntity().rotation;let h=new P.MxCADSelectionSet;if(!(yield h.userSelect("选择要刷的目标块:",e))||h.count()==0)return;h.forEach(r=>{const v=r.getMcDbEntity();v.rotation=u}),P.MxCpp.getCurrentMxCAD().updateDisplay()})}function HL(){return lt(this,null,function*(){let e=new P.MxCADResbuf;e.AddMcDbEntityTypes("INSERT");const t=new P.MxCADUiPrEntity;t.setMessage("请选择源块"),t.setFilter(e);const i=yield t.go();if(!i.id)return;const u=i.getMcDbEntity().blockName;let h=new P.MxCADSelectionSet;(yield h.userSelect("请设置选择范围:",e))&&h.count()!=0&&h.forEach(f=>{f.getMcDbEntity().blockName==u&&P.MxCpp.getCurrentMxCAD().addCurrentSelect(f)})})}function WL(){return lt(this,null,function*(){let e=new P.MxCADResbuf;e.AddMcDbEntityTypes("INSERT");const t=new P.MxCADUiPrEntity;t.setMessage("请选择目标块"),t.setFilter(e);const i=yield t.go();if(!i.id)return;const u=i.getMcDbEntity().blockName;let h=new P.MxCADSelectionSet;h.allSelect(e),h.count()!=0&&h.forEach(f=>{f.getMcDbEntity().blockName==u&&P.MxCpp.getCurrentMxCAD().addCurrentSelect(f)})})}function jL(){return lt(this,null,function*(){const e=new P.MxCADResbuf;e.AddMcDbEntityTypes("INSERT");const t=new P.MxCADUiPrEntity;t.setMessage("请选择目标块"),t.setFilter(e);const i=yield t.go();if(!i.id)return;const u=i.getMcDbEntity().blockName,h=new P.MxCADSelectionSet;if(!(yield h.userSelect("请设置统计范围",e))||h.count()==0)return;let f=0;h.forEach(r=>{r.getMcDbEntity().blockName==u&&(f+=1)}),console.log(`找到块${u}：共${f}个`)})}function $L(){return lt(this,null,function*(){const e=new P.MxCADResbuf;e.AddMcDbEntityTypes("INSERT");const t=new P.MxCADSelectionSet;if(!(yield t.userSelect("请设置统计范围",e))||t.count()==0)return;let i=[];t.forEach(v=>{const E=v.getMcDbEntity().blockName;i.push(E)});let l=[];Array.from(new Set(i)).forEach(v=>{const b=i.filter(E=>E===v).length;l.push({blkName:v,num:b})});let u=new F1;u.data.addColumn("名称",100),u.data.addColumn("数量",30),l.forEach(v=>{u.data.addRow([v.blkName,v.num])});let h=new P.MxCADUiPrPoint;h.setMessage(`
指定表格插入点:`);let f=yield h.go();if(!f)return;let r=Le.MxFun.screenCoordLong2Doc(100)/200;u.draw(f,r)})}function qL(){Le.MxFun.addCommand("Mx_ChangeBN",zL),Le.MxFun.addCommand("Mx_BushBlk",FL),Le.MxFun.addCommand("Mx_ConBlk",OL),Le.MxFun.addCommand("Mx_BlkCenterLine",NL),Le.MxFun.addCommand("Mx_BlkPt",kL),Le.MxFun.addCommand("Mx_BlkColor",BL),Le.MxFun.addCommand("Mx_BlkRotate",UL),Le.MxFun.addCommand("Mx_BlkScale",VL),Le.MxFun.addCommand("Mx_BlkAngle",GL),Le.MxFun.addCommand("Mx_BlkSelect",HL),Le.MxFun.addCommand("Mx_BlkAllSelect",WL),Le.MxFun.addCommand("Mx_SSBlk",jL),Le.MxFun.addCommand("Mx_SMBlk",$L)}function ZL(){return lt(this,null,function*(){const e=P.MxCpp.App.getCurrentMxCAD(),t=new P.McDbText;t.height=10;let i=new P.McGePoint3d,l=new P.MxCADResbuf;l.AddMcDbEntityTypes("CIRCLE,ARC,LINE,LWPOLYLINE,ELLIPSE");let u=yield P.MxCADUtility.userSelect("选择目标曲线",l);if(u.length==0)return;let h=0;u.forEach(r=>lt(this,null,function*(){let v=r.getMcDbEntity();h+=v.getLength().val})),t.textString=h.toFixed(2).toString();const f=new P.MxCADUiPrPoint;f.setMessage("指定长度标注点"),f.setUserDraw((r,v)=>{t.position=r,t.alignmentPoint=r,v.drawMcDbEntity(t)}),i=yield f.go(),i&&(t.alignmentPoint=i,t.position=i,e.drawEntity(t))})}function XL(){return lt(this,null,function*(){const e=P.MxCpp.App.getCurrentMxCAD(),t=new P.McDbText;t.height=10;let i=new P.McGePoint3d,l=new P.MxCADResbuf;l.AddMcDbEntityTypes("CIRCLE,LWPOLYLINE,ELLIPSE");let u=yield P.MxCADUtility.userSelect("选择目标对象",l);if(u.length==0)return;let h=0;u.forEach(r=>lt(this,null,function*(){let v=r.getMcDbEntity();h+=v.getArea().val})),t.textString=h.toFixed(2).toString();const f=new P.MxCADUiPrPoint;f.setMessage("指定长度标注点"),f.setUserDraw((r,v)=>{t.position=r,t.alignmentPoint=r,v.drawMcDbEntity(t)}),i=yield f.go(),i&&(t.alignmentPoint=i,t.position=i,e.drawEntity(t))})}function YL(){return lt(this,null,function*(){let e=new P.MxCADResbuf;e.AddMcDbEntityTypes("LINE");const t=new P.MxCADUiPrEntity;t.setFilter(e),t.setMessage("请选择目标斜率对象");const i=yield t.go();if(!i.id)return;const l=i.getMcDbEntity(),u=new P.MxCADUiPrDist;if(u.setMessage("请设置标注文字高度"),!(yield u.go()))return;const f=u.value(),r=new P.MxCADUiPrPoint;r.setMessage("指定斜率标注点");let v=new P.McDbBlockReference;const b=P.MxCpp.getCurrentMxCAD();r.setUserDraw((M,D)=>{const L=l.getClosestPointTo(M,!0).val,z=new P.McGePoint3d(L.x,L.y+f*4),k=new P.McDbLine(L,z),F=k.clone();F.rotate(z,Math.PI*1/2);const G=l.IntersectWith(F,P.McDb.Intersect.kExtendBoth).at(0),X=l.getClosestPointTo(L,!1).val,re=new P.McDbPolyline;re.isClosed=!0,re.addVertexAt(X),re.addVertexAt(L),re.addVertexAt(z),re.addVertexAt(G);const ue=new P.McDbText;ue.height=f,ue.position=k.getPointAtDist(k.getLength().val/2).val,ue.alignmentPoint=ue.position,ue.rotation=-Math.PI/2,ue.horizontalMode=P.McDb.TextHorzMode.kTextMid,ue.textString="1000";const $=new P.McDbText,te=new P.McDbLine(G,z);$.height=f,$.position=te.getPointAtDist(G.distanceTo(z)/2).val,$.alignmentPoint=$.position,$.horizontalMode=P.McDb.TextHorzMode.kTextMid,$.textString=(1e3*G.distanceTo(z)/k.getLength().val).toFixed(0).toString();let ie=b.getDatabase().getBlockTable().add(new P.McDbBlockTableRecord),se=ie.getMcDbBlockTableRecord();se!=null&&(se.appendAcDbEntity(re),se.appendAcDbEntity(ue),se.appendAcDbEntity($),se.name="斜率test",se.origin=L,v.blockTableRecordId=ie,v.position=L,D.drawMcDbEntity(v))}),(yield r.go())&&b.drawEntity(v)})}function JL(){return lt(this,null,function*(){const e=new P.MxCADUiPrPoint;e.setMessage("指定第一点");const t=yield e.go();if(!t)return;const i=new P.MxCADUiPrPoint;i.setMessage("指定第二点");const l=P.MxCpp.getCurrentMxCAD(),u=new P.McDbMText;u.textHeight=10,u.attachment=P.McDb.AttachmentPoint.kMiddleLeft,u.contents=`X=${t.x.toFixed(2)}\\PY=${t.y.toFixed(2)}`,u.location=t;const h=l.drawEntity(u);if(l.updateDisplay(),!h)return;let f,r,v;setTimeout(()=>lt(this,null,function*(){const b=h.getMcDbEntity().getBoundingBox();f=b.maxPt.distanceTo(new P.McGePoint3d(b.minPt.x,b.maxPt.y)),h.erase(),i.setUserDraw((M,D)=>{v=u.clone(),v.location=M;const L=new P.McGePoint3d(M.x+f,M.y);D.drawMcDbEntity(v),r=new P.McDbPolyline,r.addVertexAt(t),r.addVertexAt(M),r.addVertexAt(L),D.drawMcDbEntity(r)}),(yield i.go())&&(l.drawEntity(v),l.drawEntity(r))}),0)})}function KL(){return lt(this,null,function*(){const e=new P.MxCADUiPrPoint;e.setMessage("指定起点");const t=yield e.go();if(!t)return;const i=10,l=P.MxCpp.getCurrentMxCAD(),u=new P.McDbText;u.height=i,u.textString=t.y.toFixed(2),u.position=t;const h=l.drawEntity(u);let f,r,v;setTimeout(()=>lt(this,null,function*(){const b=h.getMcDbEntity().getBoundingBox(),E=b.maxPt.distanceTo(new P.McGePoint3d(b.minPt.x,b.maxPt.y));h.erase();const M=new P.MxCADUiPrPoint;if(M.setMessage("指定终点"),M.setUserDraw((k,F)=>{f=new P.McDbLine(t,new P.McGePoint3d(t.x+i,t.y,0)),f.startPoint=t,f.endPoint=f.getClosestPointTo(k,!0).val,F.drawMcDbEntity(f);const G=new P.McGePoint3d(k.x,t.y+i,0),X=f.getPointAtDist(f.getLength().val-i).val,re=f.getPointAtDist(f.getLength().val-i*2).val;r=new P.McDbPolyline,r.addVertexAt(G),r.addVertexAt(X),r.addVertexAt(new P.McGePoint3d(re.x,re.y+i,0)),k.x>t.x?r.addVertexAt(new P.McGePoint3d(G.x+E,G.y,0)):r.addVertexAt(new P.McGePoint3d(G.x-E,G.y,0)),F.drawMcDbEntity(r),v=u.clone(),v.position=v.alignmentPoint=G,k.x>t.x?u.horizontalMode=P.McDb.TextHorzMode.kTextLeft:u.horizontalMode=P.McDb.TextHorzMode.kTextRight,F.drawMcDbEntity(v)}),!(yield M.go()))return;const L=new P.MxCADUiPrPoint;L.setMessage("指定标注方向"),L.setUserDraw((k,F)=>{const G=r.clone(),X=v.clone();if(k.y<f.endPoint.y){G.mirror(r.getPointAt(1).val,f.endPoint);const re=G.getPointAt(0).val;X.position=X.alignmentPoint=new P.McGePoint3d(re.x,re.y-i,0)}F.drawMcDbEntity(X),F.drawMcDbEntity(G),F.drawMcDbEntity(f)});const z=yield L.go();if(z){if(z.y<f.endPoint.y){r.mirror(r.getPointAt(1).val,f.endPoint);const k=r.getPointAt(0).val;v.position=v.alignmentPoint=new P.McGePoint3d(k.x,k.y-i,0)}l.drawEntity(f),l.drawEntity(v),l.drawEntity(r)}}),0)})}function QL(){return lt(this,null,function*(){const e=new P.MxCADUiPrString;e.setMessage("请设置文字内容");const t=yield e.go();if(!t)return;const i=new P.McDbText;i.textString=t,i.height=10,i.position=i.alignmentPoint=new P.McGePoint3d(0,0,0),i.horizontalMode=P.McDb.TextHorzMode.kTextMid;const l=P.MxCpp.getCurrentMxCAD(),u=l.drawEntity(i);setTimeout(()=>lt(this,null,function*(){const h=u.getMcDbEntity().getBoundingBox(),f=h.maxPt.distanceTo(new P.McGePoint3d(h.minPt.x,h.maxPt.y));u.erase();const r=new P.MxCADUiPrPoint;r.setMessage("请指定标注位置");let v,b;r.setUserDraw((M,D)=>{const L=new P.McGePoint3d(M.x,M.y+f,0),z=new P.McGePoint3d(L.x-f/2,L.y,0),k=new P.McGePoint3d(L.x+f/2,L.y,0),F=new P.McDbLine(M,k),G=F.getPointAtDist(F.getLength().val+f).val;v=new P.McDbPolyline,v.addVertexAt(k),v.addVertexAt(z),v.addVertexAt(M),v.addVertexAt(G),D.drawMcDbEntity(v),b=i.clone(),b.position=b.alignmentPoint=L,D.drawMcDbEntity(b)}),(yield r.go())&&(l.drawEntity(v),l.drawEntity(b))}),0)})}function eI(){Le.MxFun.addCommand("Mx_StaLength",ZL),Le.MxFun.addCommand("Mx_StaArea",XL),Le.MxFun.addCommand("Mx_StandardSlope",YL),Le.MxFun.addCommand("Mx_CoordAnnotation",JL),Le.MxFun.addCommand("Mx_Elevation",KL),Le.MxFun.addCommand("Mx_Roughness",QL)}function tI(){return lt(this,null,function*(){const e=new P.MxCADUiPrInt;e.setMessage(`
请输入星形顶点数：`);const t=yield e.go();if(!t)return;const i=new P.MxCADUiPrPoint;i.setMessage(`
指定星形中心点:`);const l=yield i.go();if(!l)return;const u=new P.MxCADUiPrPoint;u.setMessage(`
指定星形的内半径:`),u.setUserDraw((L,z)=>{let k=L.distanceTo(l);z.drawMcDbEntity(new P.McDbCircle(l.x,l.y,l.z,k)),z.drawMcDbEntity(new P.McDbLine(l,L))});const h=yield u.go();if(!h)return;const f=h.distanceTo(l),r=new P.McDbCircle(l.x,l.y,l.z,f);let v=[];const b=new P.MxCADUiPrPoint;if(b.setMessage(`
指定星形的外半径:`),b.setUserDraw((L,z)=>{let k=new P.McDbCircle(l.x,l.y,l.z,L.distanceTo(l)),F=r.getLength(),G=k.getLength();if(!F||!G)return;let X=[];for(let ue=0;ue<t*2;ue++){let $=r.getPointAtDist(F.val/(t*2)*ue);if(!$.ret)return;let te=k.getPointAtDist(G.val/(t*2)*ue);if(!te.ret)return;ue%2===0?X.push($.val):X.push(te.val)}let re=new P.McDbPolyline;X.forEach(ue=>{re.addVertexAt(ue)}),re.isClosed=!0,z.drawMcDbEntity(re),v=[...X]}),!(yield b.go()))return;let M=P.MxCpp.getCurrentMxCAD(),D=new P.McDbPolyline;v.forEach(L=>{D.addVertexAt(L)}),D.isClosed=!0,M.drawEntity(D)})}function nI(){return lt(this,null,function*(){let e=5;const t=new P.MxCADUiPrDist;t.setMessage(`
请输入凹凸线宽度<5>`),(yield t.go())&&(e=t.value());let l=10;const u=new P.MxCADUiPrDist;u.setMessage(`
请输入凹凸线高度<10>`),(yield u.go())&&(l=u.value());let f=new P.MxCADUiPrPoint;f.setMessage("请点击确定起始点");let r=yield f.go();if(!r)return;let v=new P.MxCADUiPrPoint;v.setMessage("请点击确定终点"),v.setUserDraw((pe,me)=>{let he=new P.McDbLine(r.x,r.y,r.z,pe.x,pe.y,pe.z);me.drawMcDbEntity(he)});let b=yield v.go();if(!b)return;let E=new P.McDbLine(r.x,r.y,r.z,b.x,b.y,b.z),M=E.clone(),D=E.getLength(),L=E.getPointAtDist(D.val/2).val,z=P.McGeVector3d.kYAxis.angleTo1(P.McGeVector3d.kXAxis);M.rotate(L,z);let k=M.getPointAtDist(D.val/2+l/2).val,F=M.getPointAtDist(D.val/2-l/2).val,G=E.offsetCurves(l/2,k),X=E.offsetCurves(l/2,F),re=P.MxCpp.App.getCurrentMxCAD();if(G.length()===0||X.length()===0)return;let ue,$;G.forEach(pe=>{ue=pe.clone()}),X.forEach(pe=>{$=pe.clone()});let te=[],oe=D.val/e;for(let pe=0;pe<oe;pe++)pe%2===0?(te.push(ue.getPointAtDist(e*pe).val),te.push($.getPointAtDist(e*pe).val)):(te.push($.getPointAtDist(e*pe).val),te.push(ue.getPointAtDist(e*pe).val));let ie=new P.McDbPolyline;te.forEach(pe=>{ie.addVertexAt(pe)});let se=E.getPointAtDist(e*parseInt(oe.toString())).val;ie.setPointAt(0,E.startPoint),ie.setPointAt(te.length-1,se),re.drawEntity(ie)})}function iI(){return lt(this,null,function*(){let e=5;const t=new P.MxCADUiPrDist;t.setMessage(`
请输入锯齿线宽度<5>`),(yield t.go())&&(e=t.value());let l=10;const u=new P.MxCADUiPrDist;u.setMessage(`
请输入锯齿线高度<10>`),(yield u.go())&&(l=u.value());let f=new P.MxCADUiPrPoint;f.setMessage("请点击确定起始点");let r=yield f.go();if(!r)return;let v=new P.MxCADUiPrPoint;v.setMessage("请点击确定终点"),v.setUserDraw((pe,me)=>{let he=new P.McDbLine(r.x,r.y,r.z,pe.x,pe.y,pe.z);me.drawMcDbEntity(he)});let b=yield v.go();if(!b)return;let E=new P.McDbLine(r.x,r.y,r.z,b.x,b.y,b.z),M=E.clone(),D=E.getLength(),L=E.getPointAtDist(D.val/2).val,z=P.McGeVector3d.kYAxis.angleTo1(P.McGeVector3d.kXAxis);M.rotate(L,z);let k=M.getPointAtDist(D.val/2+l/2).val,F=M.getPointAtDist(D.val/2-l/2).val,G=E.offsetCurves(l/2,k),X=E.offsetCurves(l/2,F),re=P.MxCpp.App.getCurrentMxCAD();if(G.length()===0||X.length()===0)return;let ue,$;G.forEach(pe=>{ue=pe.clone()}),X.forEach(pe=>{$=pe.clone()});let te=[],oe=D.val/(e/2);for(let pe=0;pe<oe;pe++)pe%2===0?te.push(ue.getPointAtDist(e/2*pe).val):te.push($.getPointAtDist(e/2*pe).val);let ie=new P.McDbPolyline;te.forEach(pe=>{ie.addVertexAt(pe)});let se=E.getPointAtDist(e/2*parseInt(oe.toString())).val;ie.setPointAt(0,E.startPoint),ie.setPointAt(te.length-1,se),re.drawEntity(ie)})}function rI(){return lt(this,null,function*(){let e=5;const t=new P.MxCADUiPrDist;t.setMessage(`
请输入矩形宽度<5>`),(yield t.go())&&(e=t.value());let l=10;const u=new P.MxCADUiPrDist;u.setMessage(`
请输入矩形高度<10>`),(yield u.go())&&(l=u.value());const f=new P.MxCADUiPrPoint;f.setMessage("请点击确定矩形中心");const r=yield f.go();if(!r)return;let v=new P.McGePoint3d(r.x+e/2,r.y+l/2,r.z),b=new P.McGePoint3d(r.x-e/2,r.y+l/2,r.z),E=new P.McGePoint3d(r.x-e/2,r.y-l/2,r.z),M=new P.McGePoint3d(r.x+e/2,r.y-l/2,r.z),D=new P.McDbPolyline;D.addVertexAt(v),D.addVertexAt(b),D.addVertexAt(E),D.addVertexAt(M);const L=P.MxCpp.App.getCurrentMxCAD();D.isClosed=!0,L.drawEntity(D)})}function oI(){return lt(this,null,function*(){let e=10;const t=new P.MxCADUiPrDist;t.setMessage(`
请设置断口宽度<10>`),(yield t.go())&&(e=t.value());let l=5;const u=new P.MxCADUiPrDist;u.setMessage(`
请设置两头延长长度<5>`),(yield u.go())&&(l=u.value()),console.log(l);const f=new P.MxCADUiPrPoint;f.setMessage("请点击确定起点");const r=yield f.go();if(!r)return;const v=new P.MxCADUiPrPoint;v.setMessage("请点击下一个点"),v.setUserDraw((se,pe)=>{const me=new P.McDbLine(r.x,r.y,r.z,se.x,se.y,se.z);pe.drawMcDbEntity(me)});const b=yield v.go();if(!b)return;const E=new P.McDbLine(r.x,r.y,r.z,b.x,b.y,b.z),M=E.getPointAtDist(E.getLength().val/2).val;let D=E.getFirstDeriv(M),L=D.val.clone();if(!D.ret)return;D.val.normalize().mult(e/2),L.normalize().mult(l),r.subvec(L),b.addvec(L);let z=M.clone();z.addvec(D.val);let k=M.clone();k.subvec(D.val);let F=new P.McDbLine(M.x,M.y,M.z,z.x,z.y,z.z),G=P.McGeVector3d.kXAxis.angleTo1(P.McGeVector3d.kYAxis),X=F.clone();X.rotate(F.getPointAtDist(F.getLength().val/2).val,G);let re=X.getPointAtDist(2*X.getLength().val).val,$=new P.McDbLine(M.x,M.y,M.z,k.x,k.y,k.z).clone();$.rotate($.getPointAtDist($.getLength().val/2).val,G);let te=$.getPointAtDist(2*$.getLength().val).val;const oe=new P.McDbPolyline;oe.addVertexAt(r),oe.addVertexAt(k),oe.addVertexAt(te),oe.addVertexAt(re),oe.addVertexAt(z),oe.addVertexAt(b),P.MxCpp.App.getCurrentMxCAD().drawEntity(oe)})}function aI(){return lt(this,null,function*(){let e=new P.MxCADResbuf;e.AddMcDbEntityTypes("CIRCLE");let t=yield P.MxCADUtility.userSelect("选择目标对象",e);t.length!=0&&t.forEach(i=>lt(this,null,function*(){let l=yield i.getMcDbEntity(),u=l.center,h=l.radius,f=P.MxCpp.App.getCurrentMxCAD(),r=new P.McDbLine(u.x+h*1.3,u.y,u.z,u.x-h*1.3,u.y,u.z);r.trueColor=new P.McCmColor(255,0,0);let v=new P.McDbLine(u.x,u.y+h*1.3,u.z,u.x,u.y-h*1.3,u.z);v.trueColor=new P.McCmColor(255,0,0),f.drawEntity(r),f.drawEntity(v)}))})}function sI(){return lt(this,null,function*(){let e=10;const t=new P.MxCADUiPrDist;t.setMessage(`
请输入管径<10>`),(yield t.go())&&(e=t.value());let l=10;const u=new P.MxCADUiPrDist;u.setMessage(`
请输入长出管口长度<5>`),(yield u.go())&&(l=u.value());let f=new P.MxCADUiPrPoint;f.setMessage("请点击确定起点");const r=yield f.go();if(!r)return;const v=new P.MxCADUiPrPoint;v.setMessage("请点击确定终点"),v.setUserDraw(($,te)=>{const oe=new P.McDbLine(r.x,r.y,r.z,$.x,$.y,$.z);te.drawMcDbEntity(oe)});const b=yield v.go();if(!b)return;const E=new P.McDbLine(r.x,r.y,r.z,b.x,b.y,b.z),M=P.MxCpp.App.getCurrentMxCAD();let D=E.getLength().val,L=E.getPointAtDist(D+l),z=E.getPointAtDist(0-l),k=E.getPointAtDist(D/2).val,F=P.McGeVector3d.kXAxis.angleTo1(P.McGeVector3d.kYAxis),G=E.clone();G.rotate(k,F);let X=G.getPointAtDist(D/2+e/2).val,re=G.getPointAtDist(D/2-e/2).val;E.offsetCurves(e/2,X).forEach($=>{$.trueColor=new P.McCmColor(0,255,0),M.drawEntity($)}),E.offsetCurves(e/2,re).forEach($=>{$.trueColor=new P.McCmColor(0,255,0),M.drawEntity($)});let ue=M.addLinetypeEx("TestMyLine","25,-5");ue.isValid()&&(E.linetypeId=ue,E.endPoint=z.val,E.startPoint=L.val,E.trueColor=new P.McCmColor(255,0,0),M.drawEntity(E))})}function lI(){return lt(this,null,function*(){const e=new P.MxCADUiPrPoint;e.setMessage("指定剖管线起点");const t=yield e.go();if(!t)return;const i=new P.MxCADUiPrPoint;i.setMessage("指定剖管线终点"),i.setUserDraw(($,te)=>{let oe=new P.McDbLine(t.x,t.y,t.z,$.x,$.y,$.z);te.drawMcDbEntity(oe)});const l=yield i.go();if(!l)return;const u=new P.McDbLine(t.x,t.y,t.z,l.x,l.y,l.z),h=u.getLength().val,f=h/8,r=u.getPointAtDist(h/2).val,v=u.clone();v.rotate(r,Math.PI/2);const b=v.getPointAtDist(h/2+f).val,E=v.getPointAtDist(h/2-f).val,M=P.MxCpp.App.getCurrentMxCAD();let D;u.clone().offsetCurves(f,b).forEach($=>{D=$});let L;u.clone().offsetCurves(f,E).forEach($=>{L=$});const z=[],k=[];for(let $=0;$<4;$++)$%2!==0&&(z.push(D.getPointAtDist($*f*2).val),k.push(L.getPointAtDist($*f*2).val));let F,G=new P.McDbArc;G.computeArc(t.x,t.y,z[0].x,z[0].y,r.x,r.y),M.drawEntity(G);let X=new P.McDbArc;X.computeArc(t.x,t.y,k[0].x,k[0].y,r.x,r.y),M.drawEntity(X);let re=new P.McDbArc;re.computeArc(r.x,r.y,k[1].x,k[1].y,l.x,l.y),F=M.drawEntity(re);let ue=new P.MxCADUiPrKeyWord;for(;;){ue.setMessage("选择剖管线圆弧方向"),ue.setKeyWords("[左边(L)/右边(R)]");const $=yield ue.go();if(!$)return;if($=="L"){let te=new P.McDbArc;F.erase(),te.computeArc(r.x,r.y,k[1].x,k[1].y,l.x,l.y),F=M.drawEntity(te)}else if($=="R"){F.erase();let te=new P.McDbArc;te.computeArc(r.x,r.y,z[1].x,z[1].y,l.x,l.y),F=M.drawEntity(te)}}})}function cI(){return lt(this,null,function*(){const e=new P.MxCADUiPrKeyWord;e.setMessage("选择模式"),e.setKeyWords("[直线焊缝(L)/弧线焊缝(A)]");const t=yield e.go();if(!t)return;let i=5;const l=new P.MxCADUiPrDist;l.setMessage(`
请输入焊缝半径<5>`),(yield l.go())&&(i=l.value());let h=new P.McDbCurve;if(t==="L"){let D=new P.MxCADUiPrPoint;D.setMessage("请点击确定起始点");let L=yield D.go();if(!L)return;let z=new P.MxCADUiPrPoint;z.setMessage("请点击确定终点"),z.setUserDraw((F,G)=>{let X=new P.McDbLine(L.x,L.y,L.z,F.x,F.y,F.z);G.drawMcDbEntity(X)});let k=yield z.go();if(!k)return;h=new P.McDbLine(L.x,L.y,L.z,k.x,k.y,k.z)}else if(t==="A"){let D=new P.MxCADUiPrPoint;D.setMessage("指定起点");let L=yield D.go();if(!L)return;let z=new P.MxCADUiPrPoint;z.setMessage("指定圆弧的第二个点"),z.setUserDraw((re,ue)=>{ue.drawLine(L.toVector3(),re.toVector3())});let k=yield z.go();if(!k)return;let F=new P.MxCADUiPrPoint;F.setMessage("指定圆弧的端点"),F.setUserDraw((re,ue)=>{let $=new P.McDbArc;$.computeArc(L.x,L.y,k.x,k.y,re.x,re.y),ue.drawMcDbEntity($)});let G=yield F.go();if(!G)return;let X=new P.McDbArc;X.computeArc(L.x,L.y,k.x,k.y,G.x,G.y),h=X}const f=P.MxCpp.App.getCurrentMxCAD();let v=h.getLength().val/i,b=[],E,M;t==="A"&&(E=h.center,M=h.radius);for(let D=0;D<v;D++){let L=h.getPointAtDist(i*D).val,z=new P.McDbCircle(L.x,L.y,L.z,i);const k=z.IntersectWith(h,P.McDb.Intersect.kExtendBoth);if(!k.length())return;let F=[];k.forEach(re=>{F.push(re)});let G=[],X=[];z.splitCurves(F).forEach((re,ue)=>{if(t==="L")ue%2!==0&&b.push(re);else if(t==="A"){let $=re.clone();$.getPointAtDist($.getLength().val/2).val.distanceTo(E)>M?G.push($):X.push($)}}),G.length===1&&t==="A"?b.push(G[0]):t==="A"&&G.length>1&&(X[0].rotate(z.center,Math.PI),b.push(X[0]))}b.forEach((D,L)=>{if(L===0)f.drawEntity(D);else{let z=D.IntersectWith(b[L-1],P.McDb.Intersect.kExtendThis);if(z.length()===0)return;let k=[];z.forEach(X=>{k.push(X)});let F=[];D.splitCurves(k).forEach((X,re)=>{F.push({obj_cur:X,lenth:X.getLength().val})});let G=F.map(X=>X.lenth);f.drawEntity(F[G.indexOf(Math.max(...G))].obj_cur)}})})}function uI(){return lt(this,null,function*(){let e=new P.MxCADResbuf;e.AddMcDbEntityTypes("LINE,LWPOLYLINE");let t=yield P.MxCADUtility.userSelect("选择对象",e);t.length!=0&&t.forEach(i=>lt(this,null,function*(){let l=yield i.getMcDbEntity();if(!l)return;let u=l.clone(),h=u.getLength(),f=u.getPointAtDist(h.val/2).val;if(!u.getFirstDeriv(f).ret)return;let v=P.McGeVector3d.kYAxis.angleTo1(P.McGeVector3d.kXAxis);u.rotate(f,v);let b=P.MxCpp.App.getCurrentMxCAD();u.trueColor=new P.McCmColor(255,0,0),b.drawEntity(u)}))})}function hI(){return lt(this,null,function*(){let e=25;const t=new P.MxCADUiPrDist;t.setMessage("请输入宽度<25>"),(yield t.go())&&(e=t.value());let l=15;const u=new P.MxCADUiPrDist;u.setMessage("请输入高度<15>"),(yield u.go())&&(l=u.value());const f=new P.MxCADUiPrInt;f.setMessage("请输入楼梯级数<10>");const r=(yield f.go())||10,v=Math.sqrt(e*e+l*l),b=new P.MxCADUiPrPoint;b.setMessage("请点击确定起点");const E=yield b.go();if(!E)return;const M=new P.MxCADUiPrPoint;M.setMessage("请点击确定终点"),M.setUserDraw((G,X)=>{const re=new P.McDbLine(E.x,E.y,E.z,G.x,G.y,G.z);X.drawMcDbEntity(re)});const D=yield M.go();if(!D)return;const L=new P.McDbLine(E.x,E.y,E.z,D.x,D.y,D.z),z=[];for(let G=0;G<r+1;G++){let X=L.getPointAtDist(v*G).val;z.push(X)}const k=new P.McDbPolyline;z.forEach((G,X)=>{if(k.addVertexAt(G),X!=z.length-1){let re=new P.McGePoint3d(G.x,z[X+1].y,G.z);k.addVertexAt(re)}}),P.MxCpp.App.getCurrentMxCAD().drawEntity(k)})}function dI(){return lt(this,null,function*(){const e=new P.MxCADUiPrPoint;e.setMessage(`请确定圆心位置
`);const t=yield e.go();if(!t)return;const i=new P.MxCADUiPrDist;if(i.setBasePt(t),i.setMessage("请输入圆半径"),i.setUserDraw((f,r)=>{const v=f.distanceTo(t),b=new P.McDbCircle;b.center=t,b.radius=v,r.drawMcDbEntity(b)}),!(yield i.go()))return;const u=i.value(),h=P.MxCpp.getCurrentMxCAD();h.pathCircle(t.x,t.y,u),h.drawPathToHatch()})}function pI(){return lt(this,null,function*(){let e=5;const t=new P.MxCADUiPrDist;t.setMessage(`
请输入保温棉宽度<5>`),(yield t.go())&&(e=t.value());let l=10;const u=new P.MxCADUiPrDist;u.setMessage(`
请输入保温棉高度<10>`),(yield u.go())&&(l=u.value());const f=new P.MxCADUiPrPoint;f.setMessage("请点击确定起点");const r=yield f.go();if(!r)return;const v=new P.MxCADUiPrPoint;v.setMessage("请点击下一个点"),v.setUserDraw((oe,ie)=>{const se=new P.McDbLine(r.x,r.y,r.z,oe.x,oe.y,oe.z);ie.drawMcDbEntity(se)});const b=yield v.go();if(!b)return;const E=new P.McDbLine(r.x,r.y,r.z,b.x,b.y,b.z);r.y<b.y&&(E.startPoint=new P.McGePoint3d(b.x,b.y,b.z),E.endPoint=new P.McGePoint3d(r.x,r.y,r.z));const M=E.getPointAtDist(E.getLength().val/2).val,D=E.clone();D.rotate(M,Math.PI/2);const L=D.getPointAtDist(E.getLength().val/2+l/2).val,z=D.getPointAtDist(E.getLength().val/2-l/2).val;let k,F;E.offsetCurves(l/2,L).forEach(oe=>{k=oe}),E.offsetCurves(l/2,z).forEach(oe=>{F=oe});let G=E.getLength().val/e*2,X=[],re=[],ue=[];for(let oe=0;oe<G;oe++)if(oe%2==0){let ie=F.getPointAtDist(oe*(e/2)).val,se=k.getPointAtDist(oe*(e/2)).val;re.push(se),X.push(ie)}else{let ie=k.getPointAtDist(oe*(e/2)).val,se=F.getPointAtDist(oe*(e/2)).val;ue.push(se),X.push(ie)}const $=new P.McDbPolyline;X.forEach(oe=>{$.addVertexAt(oe)});const te=P.MxCpp.App.getCurrentMxCAD();te.drawEntity($),re.forEach(oe=>{const ie=new P.McDbArc;ie.center=oe,ie.radius=e/2,ie.startAngle=-new P.McGeVector3d(E.endPoint.x-E.startPoint.x,E.endPoint.y-E.startPoint.y).angleTo1(P.McGeVector3d.kXAxis),ie.endAngle=new P.McGeVector3d(E.startPoint.x-E.endPoint.x,E.startPoint.y-E.endPoint.y).angleTo1(P.McGeVector3d.kXAxis),te.drawEntity(ie)}),ue.forEach(oe=>{const ie=new P.McDbArc;ie.center=oe,ie.radius=e/2,ie.startAngle=new P.McGeVector3d(E.startPoint.x-E.endPoint.x,E.startPoint.y-E.endPoint.y).angleTo1(P.McGeVector3d.kXAxis),ie.endAngle=-new P.McGeVector3d(E.endPoint.x-E.startPoint.x,E.endPoint.y-E.startPoint.y).angleTo1(P.McGeVector3d.kXAxis),te.drawEntity(ie)})})}function fI(){return lt(this,null,function*(){let e=new P.MxCADResbuf;e.AddMcDbEntityTypes("LINE");const t=new P.MxCADUiPrEntity;t.setFilter(e),t.setMessage("请选择第一条线");const i=yield t.go();if(!i.id)return;const l=i.getMcDbEntity(),u=new P.McDbLine(l.startPoint,l.endPoint),h=new P.MxCADUiPrEntity;h.setFilter(e),h.setMessage("请选择第二条线");const f=yield h.go();if(!f.id)return;const r=f.getMcDbEntity(),v=new P.McDbLine(r.startPoint,r.endPoint),b=P.MxCpp.getCurrentMxCAD();let E=l.IntersectWith(v,P.McDb.Intersect.kExtendBoth);if(console.log(E.length()),E.length()===0){const M=l.getLength().val>r.getLength().val?r.clone():l.clone(),D=l.getLength().val>r.getLength().val?u:v,L=M.clone(),z=M.getPointAtDist(M.getLength().val/2).val;if(M.rotate(z,Math.PI/2),E=M.IntersectWith(D,P.McDb.Intersect.kExtendBoth),!E.length())return;const k=E.at(0).distanceTo(z)/2;L.offsetCurves(k,E.at(0)).forEach(F=>{F.trueColor=new P.McCmColor(255,0,0),b.drawEntity(F)})}else{const M=new P.McDbCircle;let D,L=u.endPoint.distanceTo(E.at(0)),z=u.startPoint.distanceTo(E.at(0));L!==0&&z!==0&&(L>z?u.startPoint=E.at(0):u.endPoint=E.at(0));let k=v.endPoint.distanceTo(E.at(0)),F=v.startPoint.distanceTo(E.at(0));k!==0&&F!==0&&(F>k?v.startPoint=E.at(0):v.endPoint=E.at(0)),u.getLength().val>v.getLength().val?(D=v.getLength().val,new P.McDbLine(r.startPoint,v.endPoint)):(D=l.getLength().val,new P.McDbLine(u.startPoint,u.endPoint)),M.center=E.at(0),M.radius=D;let G=M.IntersectWith(u,P.McDb.Intersect.kOnBothOperands),X=M.IntersectWith(v,P.McDb.Intersect.kOnBothOperands);if(!G.length()||!X.length())return;let re=G.at(0).sub(E.at(0)).angleTo2(P.McGeVector3d.kXAxis),ue=X.at(0).sub(E.at(0)).angleTo2(P.McGeVector3d.kXAxis),$=new P.McDbArc;$.center=E.at(0),$.radius=D,$.startAngle=re,$.endAngle=ue;const te=$.getPointAtDist($.getLength().val/2).val,oe=new P.McDbLine(E.at(0),te),ie=new P.MxCADUiPrPoint;ie.setMessage("请选择终点"),ie.setUserDraw((pe,me)=>{let he=oe.getClosestPointTo(pe,!0).val,Ue=oe.clone();Ue.endPoint=he,me.drawMcDbEntity(Ue)});const se=yield ie.go();if(!se)return;oe.endPoint=oe.getClosestPointTo(se,!0).val,oe.trueColor=new P.McCmColor(255,0,0),b.drawEntity(oe)}})}function mI(){return lt(this,null,function*(){let e=new P.MxCADResbuf;e.AddMcDbEntityTypes("LWPOLYLINE");const t=new P.MxCADUiPrEntity;t.setFilter(e),t.setMessage("请选择目标矩形");const i=yield t.go();if(!i.id)return;const l=i.getMcDbEntity();let u=[];const h=l.numVerts();for(let E=0;E<h;E++)u.push(l.getPointAt(E).val);const f=new P.MxCADUiPrPoint;let r;f.setUserDraw((E,M)=>{let D=[];u.forEach(z=>{D.push(z.distanceTo(E))}),r=D.findIndex(z=>z===Math.min(...D));let L=l.clone();L.setPointAt(r,E),M.drawMcDbEntity(L)});const v=yield f.go();if(!v)return;let b=l.clone();b.setPointAt(r,v),P.MxCpp.getCurrentMxCAD().drawEntity(b)})}function gI(){return lt(this,null,function*(){const e=new P.MxCADUiPrPoint;e.setMessage("设置指北针中心点");const t=yield e.go();if(!t)return;const i=new P.MxCADUiPrDist;if(i.setMessage("设置指北针半径"),i.setBasePt(t),i.setUserDraw((F,G)=>{const X=F.distanceTo(t);G.drawCircle(t.toVector3(),X)}),!(yield i.go()))return;const u=i.value(),h=P.MxCpp.App.getCurrentMxCAD(),f=new P.McDbCircle;f.trueColor=new P.McCmColor(0,255,0),f.center=t,f.radius=u,h.drawEntity(f);const r=new P.McGePoint3d(t.x,t.y+u),v=new P.McGePoint3d(t.x,t.y-u),b=new P.McDbLine;b.startPoint=r,b.endPoint=v;const E=b.clone();E.rotate(r,Math.PI/30);const M=b.clone();M.rotate(r,-Math.PI/30);let D,L;E.IntersectWith(f,P.McDb.Intersect.kOnBothOperands).forEach(F=>{F.x!==r.x&&F.y!==r.y&&(D=F)}),M.IntersectWith(f,P.McDb.Intersect.kOnBothOperands).forEach(F=>{F.x!==r.x&&F.y!==r.y&&(L=F)});let z=P.MxCADUtility.calcBulge(D,v,L);h.pathMoveToEx(D.x,D.y,0,0,z.val),h.pathLineTo(L.x,L.y),h.pathLineTo(r.x,r.y),h.pathLineTo(D.x,D.y),h.drawColor=new P.McCmColor(25,255,0),h.drawPathToHatch(1);const k=new P.McDbText;k.height=u/3,k.position=new P.McGePoint3d(t.x,t.y+u*1.2),k.alignmentPoint=k.position,k.textString="N",k.horizontalMode=P.McDb.TextHorzMode.kTextMid,k.trueColor=new P.McCmColor(25,255,0),h.drawEntity(k)})}function yI(){return lt(this,null,function*(){const e=new P.MxCADUiPrKeyWord;e.setMessage("选择提示框指向"),e.setKeyWords("[向上(U)/向下(D)]");const t=yield e.go();if(!t)return;const i=new P.MxCADUiPrPoint;let l=P.MxCpp.getCurrentMxCAD().getCurrentDatabaseDrawColor();i.setMessage(`
指定消息框第一点:`);let u=yield i.go();if(!u)return;let h=P.MxCpp.getCurrentMxCAD(),f=new Le.MxDbRect;f.pt1=u.toVector3(),i.setUserDraw((G,X)=>{f.pt2=G.toVector3(),f.setColor(l),X.drawCustomEntity(f)}),i.setMessage(`
指定消息框第二点:`),i.setDynamicInputType(Le.DynamicInputType.kXYCoordInput);let r=yield i.go();if(!r)return;f.pt2=r.toVector3();let v=new P.McDbPolyline;v.isClosed=!0;let b;u.y>r.y&&t==="U"||u.y<r.y&&t==="D"?(b=new P.McDbLine(u,new P.McGePoint3d(r.x,u.y)),v.addVertexAt(new P.McGePoint3d(r.x,u.y)),v.addVertexAt(r),v.addVertexAt(new P.McGePoint3d(u.x,r.y)),v.addVertexAt(u)):(u.y>r.y&&t==="D"||u.y<r.y&&t==="U")&&(b=new P.McDbLine(r,new P.McGePoint3d(u.x,r.y)),v.addVertexAt(new P.McGePoint3d(u.x,r.y)),v.addVertexAt(u),v.addVertexAt(new P.McGePoint3d(r.x,u.y)),v.addVertexAt(r));const E=u.distanceTo(r)/6,M=b.getPointAtDist(E).val,D=b.getPointAtDist(b.getLength().val-E).val;b.startPoint=M,b.endPoint=D;const L=new P.MxCADUiPrPoint;L.setMessage(`
设置消息框指向:`);let z,k;L.setUserDraw((G,X)=>{const re=b.getClosestPointTo(G,!1).val;let ue=v.getFirstDeriv(re);if(!ue.ret)return;ue.val.normalize().mult(E/4),z=re.clone(),z.addvec(ue.val),k=re.clone(),k.subvec(ue.val);let $=v.clone();$.addVertexAt(k),$.addVertexAt(G),$.addVertexAt(z),X.drawMcDbEntity($)});let F=yield L.go();F&&(v.addVertexAt(k),v.addVertexAt(F),v.addVertexAt(z),h.drawEntity(v))})}function _I(){return lt(this,null,function*(){const e=new P.MxCADUiPrString;e.setMessage("请设置基准符文字");const t=yield e.go();if(!t)return;const i=new P.MxCADUiPrDist;if(i.setMessage("请设置文字高度"),!(yield i.go()))return;const u=i.value(),h=new P.MxCADUiPrPoint;h.setMessage("请设置基准符位置");const f=P.MxCpp.getCurrentMxCAD();let r=new P.McDbBlockReference;h.setUserDraw((b,E)=>{const M=new P.McDbPolyline;M.addVertexAt(new P.McGePoint3d(b.x+u,b.y,0),0,2,2),M.addVertexAt(new P.McGePoint3d(b.x-u,b.y,0));const D=new P.McDbLine(b,new P.McGePoint3d(b.x,b.y+u*(8/7),0)),L=new P.McDbCircle;L.center=new P.McGePoint3d(b.x,b.y+u*2.142857142857143,0),L.radius=u;const z=new P.McDbText;z.textString=t,z.height=u,z.position=z.alignmentPoint=new P.McGePoint3d(b.x,b.y+u*1.7857142857142858,0),z.horizontalMode=P.McDb.TextHorzMode.kTextMid;let F=f.getDatabase().getBlockTable().add(new P.McDbBlockTableRecord),G=F.getMcDbBlockTableRecord();G!=null&&(G.appendAcDbEntity(M),G.appendAcDbEntity(D),G.appendAcDbEntity(L),G.appendAcDbEntity(z),G.name="基准符",G.origin=b,r.blockTableRecordId=F,r.position=b,E.drawMcDbEntity(r))}),(yield h.go())&&f.drawEntity(r)})}function vI(){Le.MxFun.addCommand("Mx_DrawStart",tI),Le.MxFun.addCommand("Mx_ConcavoVex",nI),Le.MxFun.addCommand("Mx_ZigzagLine",iI),Le.MxFun.addCommand("Mx_CenterRect",rI),Le.MxFun.addCommand("Mx_BreakLine",oI),Le.MxFun.addCommand("Mx_CCLine",aI),Le.MxFun.addCommand("Mx_Piping",sI),Le.MxFun.addCommand("Mx_CutPipeline",lI),Le.MxFun.addCommand("Mx_WelLine",cI),Le.MxFun.addCommand("Mx_PerpLine",uI),Le.MxFun.addCommand("Mx_StairLine",hI),Le.MxFun.addCommand("Mx_SolidCircle",dI),Le.MxFun.addCommand("Mx_CottonInsulation",pI),Le.MxFun.addCommand("Mx_CenterLine",fI),Le.MxFun.addCommand("Mx_DoHole",mI),Le.MxFun.addCommand("Mx_Compass",gI),Le.MxFun.addCommand("Mx_MassegeBox",yI),Le.MxFun.addCommand("Mx_DatumSymbol",_I)}var q1={exports:{}};(function(e,t){(function(i,l){e.exports=l()})(yP,function(){var i,l,u;function h(r,v){if(!i)i=v;else if(!l)l=v;else{var b="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+i+")(sharedChunk); ("+l+")(sharedChunk); self.onerror = null;",E={};i(E),u=v(E),typeof window!="undefined"&&window&&window.URL&&window.URL.createObjectURL&&(u.workerUrl=window.URL.createObjectURL(new Blob([b],{type:"text/javascript"})))}}h(["exports"],function(r){var v="2.8.2",b=E;function E(a,n,s,c){this.cx=3*a,this.bx=3*(s-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(c-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=c,this.p2x=s,this.p2y=c}E.prototype.sampleCurveX=function(a){return((this.ax*a+this.bx)*a+this.cx)*a},E.prototype.sampleCurveY=function(a){return((this.ay*a+this.by)*a+this.cy)*a},E.prototype.sampleCurveDerivativeX=function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},E.prototype.solveCurveX=function(a,n){var s,c,p,g,_;for(n===void 0&&(n=1e-6),p=a,_=0;_<8;_++){if(g=this.sampleCurveX(p)-a,Math.abs(g)<n)return p;var x=this.sampleCurveDerivativeX(p);if(Math.abs(x)<1e-6)break;p-=g/x}if((p=a)<(s=0))return s;if(p>(c=1))return c;for(;s<c;){if(g=this.sampleCurveX(p),Math.abs(g-a)<n)return p;a>g?s=p:c=p,p=.5*(c-s)+s}return p},E.prototype.solve=function(a,n){return this.sampleCurveY(this.solveCurveX(a,n))};var M=D;function D(a,n){this.x=a,this.y=n}D.prototype={clone:function(){return new D(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,n){return this.clone()._rotateAround(a,n)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var n=a.x-this.x,s=a.y-this.y;return n*n+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,n){return Math.atan2(this.x*n-this.y*a,this.x*a+this.y*n)},_matMult:function(a){var n=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=n,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var n=Math.cos(a),s=Math.sin(a),c=s*this.x+n*this.y;return this.x=n*this.x-s*this.y,this.y=c,this},_rotateAround:function(a,n){var s=Math.cos(a),c=Math.sin(a),p=n.y+c*(this.x-n.x)+s*(this.y-n.y);return this.x=n.x+s*(this.x-n.x)-c*(this.y-n.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},D.convert=function(a){return a instanceof D?a:Array.isArray(a)?new D(a[0],a[1]):a};var L=typeof self!="undefined"?self:{};const z=Math.PI/180,k=180/Math.PI;function F(a){return a*z}function G(a){return a*k}const X=[[0,0],[1,0],[1,1],[0,1]];function re(a){if(a<=0)return 0;if(a>=1)return 1;const n=a*a,s=n*a;return 4*(a<.5?s:3*(a-n)+s-.75)}function ue(a,n,s,c){const p=new b(a,n,s,c);return function(g){return p.solve(g)}}const $=ue(.25,.1,.25,1);function te(a,n,s){return Math.min(s,Math.max(n,a))}function oe(a,n,s){return(s=te((s-a)/(n-a),0,1))*s*(3-2*s)}function ie(a,n,s){const c=s-n,p=((a-n)%c+c)%c+n;return p===n?s:p}function se(a,n,s){if(!a.length)return s(null,[]);let c=a.length;const p=new Array(a.length);let g=null;a.forEach((_,x)=>{n(_,(C,S)=>{C&&(g=C),p[x]=S,--c==0&&s(g,p)})})}function pe(a){const n=[];for(const s in a)n.push(a[s]);return n}function me(a,...n){for(const s of n)for(const c in s)a[c]=s[c];return a}let he=1;function Ue(){return he++}function Ve(){return function a(n){return n?(n^Math.random()*(16>>n/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()}function $e(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function ct(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}function At(a,n){a.forEach(s=>{n[s]&&(n[s]=n[s].bind(n))})}function yt(a,n){return a.indexOf(n,a.length-n.length)!==-1}function St(a,n,s){const c={};for(const p in a)c[p]=n.call(s||this,a[p],p,a);return c}function It(a,n,s){const c={};for(const p in a)n.call(s||this,a[p],p,a)&&(c[p]=a[p]);return c}function Nt(a){return Array.isArray(a)?a.map(Nt):typeof a=="object"&&a?St(a,Nt):a}const Ie={};function xe(a){Ie[a]||(typeof console!="undefined"&&console.warn(a),Ie[a]=!0)}function He(a,n,s){return(s.y-a.y)*(n.x-a.x)>(n.y-a.y)*(s.x-a.x)}function Ge(a){let n=0;for(let s,c,p=0,g=a.length,_=g-1;p<g;_=p++)s=a[p],c=a[_],n+=(c.x-s.x)*(s.y+c.y);return n}function ze(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function rt(a){const n={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(s,c,p,g)=>{const _=p||g;return n[c]=!_||_.toLowerCase(),""}),n["max-age"]){const s=parseInt(n["max-age"],10);isNaN(s)?delete n["max-age"]:n["max-age"]=s}return n}let fe,Ee,Ce,ye,Oe=null;function Ke(a){if(Oe==null){const n=a.navigator?a.navigator.userAgent:null;Oe=!!a.safari||!(!n||!(/\b(iPad|iPhone|iPod)\b/.test(n)||n.match("Safari")&&!n.match("Chrome")))}return Oe}function st(a){try{const n=L[a];return n.setItem("_mapbox_test_",1),n.removeItem("_mapbox_test_"),!0}catch(n){return!1}}const wt={now:()=>Ce!==void 0?Ce:L.performance.now(),setNow(a){Ce=a},restoreNow(){Ce=void 0},frame(a){const n=L.requestAnimationFrame(a);return{cancel:()=>L.cancelAnimationFrame(n)}},getImageData(a,n=0){const{width:s,height:c}=a;ye||(ye=L.document.createElement("canvas"));const p=ye.getContext("2d");if(!p)throw new Error("failed to create canvas 2d context");return(s>ye.width||c>ye.height)&&(ye.width=s,ye.height=c),p.clearRect(-n,-n,s+2*n,c+2*n),p.drawImage(a,0,0,s,c),p.getImageData(-n,-n,s+2*n,c+2*n)},resolveURL:a=>(fe||(fe=L.document.createElement("a")),fe.href=a,fe.href),get devicePixelRatio(){return L.devicePixelRatio},get prefersReducedMotion(){return!!L.matchMedia&&(Ee==null&&(Ee=L.matchMedia("(prefers-reduced-motion: reduce)")),Ee.matches)}};let Gt;const de={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(Gt==null){const a=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Gt=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):a}catch(n){Gt=a}}return Gt},get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},we={supported:!1,testSupport:function(a){!bn&&gt&&(hn?nn(a):bt=a)}};let bt,gt,bn=!1,hn=!1;function nn(a){const n=a.createTexture();a.bindTexture(a.TEXTURE_2D,n);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,gt),a.isContextLost())return;we.supported=!0}catch(s){}a.deleteTexture(n),bn=!0}L.document&&(gt=L.document.createElement("img"),gt.onload=function(){bt&&nn(bt),bt=null,hn=!0},gt.onerror=function(){bn=!0,bt=null},gt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const pn="01",wn="NO_ACCESS_TOKEN";function cn(a){return a.indexOf("mapbox:")===0}function Ht(a){return de.API_URL_REGEX.test(a)}const sn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Zt(a){const n=a.match(sn);if(!n)throw new Error("Unable to parse URL object");return{protocol:n[1],authority:n[2],path:n[3]||"/",params:n[4]?n[4].split("&"):[]}}function Ze(a){const n=a.params.length?`?${a.params.join("&")}`:"";return`${a.protocol}://${a.authority}${a.path}${n}`}function Ut(a){if(!a)return null;const n=a.split(".");if(!n||n.length!==3)return null;try{return JSON.parse(decodeURIComponent(L.atob(n[1]).split("").map(s=>"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(s){return null}}class en{constructor(n){this.type=n,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(n){const s=Ut(de.ACCESS_TOKEN);let c="";return c=s&&s.u?L.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,(p,g)=>String.fromCharCode(+("0x"+g)))):de.ACCESS_TOKEN||"",n?`mapbox.eventData.${n}:${c}`:`mapbox.eventData:${c}`}fetchEventData(){const n=st("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(n)try{const p=L.localStorage.getItem(s);p&&(this.eventData=JSON.parse(p));const g=L.localStorage.getItem(c);g&&(this.anonId=g)}catch(p){xe("Unable to read from LocalStorage")}}saveEventData(){const n=st("localStorage"),s=this.getStorageKey(),c=this.getStorageKey("uuid");if(n)try{L.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&L.localStorage.setItem(s,JSON.stringify(this.eventData))}catch(p){xe("Unable to write to LocalStorage")}}processRequests(n){}postEvent(n,s,c,p){if(!de.EVENTS_URL)return;const g=Zt(de.EVENTS_URL);g.params.push(`access_token=${p||de.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(n).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:v,skuId:pn,userId:this.anonId},x=s?me(_,s):_,C={url:Ze(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=We(C,S=>{this.pendingRequest=null,c(S),this.saveEventData(),this.processRequests(p)})}queueRequest(n,s){this.queue.push(n),this.processRequests(s)}}const Dn=new class extends en{constructor(a){super("appUserTurnstile"),this._customAccessToken=a}postTurnstileEvent(a,n){de.EVENTS_URL&&de.ACCESS_TOKEN&&Array.isArray(a)&&a.some(s=>cn(s)||Ht(s))&&this.queueRequest(Date.now(),n)}processRequests(a){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=Ut(de.ACCESS_TOKEN),s=n?n.u:de.ACCESS_TOKEN;let c=s!==this.eventData.tokenU;ct(this.anonId)||(this.anonId=Ve(),c=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const g=new Date(this.eventData.lastSuccess),_=new Date(p),x=(p-this.eventData.lastSuccess)/864e5;c=c||x>=1||x<-1||g.getDate()!==_.getDate()}else c=!0;c?this.postEvent(p,{"enabled.telemetry":!1},g=>{g||(this.eventData.lastSuccess=p,this.eventData.tokenU=s)},a):this.processRequests()}},fn=Dn.postTurnstileEvent.bind(Dn),On=new class extends en{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(a,n,s,c){this.skuToken=n,this.errorCb=c,de.EVENTS_URL&&(s||de.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},s):this.errorCb(new Error(wn)))}processRequests(a){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:s}=this.queue.shift();n&&this.success[n]||(this.anonId||this.fetchEventData(),ct(this.anonId)||(this.anonId=Ve()),this.postEvent(s,{skuToken:this.skuToken},c=>{c?this.errorCb(c):n&&(this.success[n]=!0)},a))}},Gn=On.postMapLoadEvent.bind(On),qn=new class extends en{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(a,n,s,c){if(!de.API_URL||!de.SESSION_PATH)return;const p=Zt(de.API_URL+de.SESSION_PATH);p.params.push(`sku=${n||""}`),p.params.push(`access_token=${c||de.ACCESS_TOKEN||""}`);const g={url:Ze(p),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Qe(g,_=>{this.pendingRequest=null,s(_),this.saveEventData(),this.processRequests(c)})}getSessionAPI(a,n,s,c){this.skuToken=n,this.errorCb=c,de.SESSION_PATH&&de.API_URL&&(s||de.ACCESS_TOKEN?this.queueRequest({id:a,timestamp:Date.now()},s):this.errorCb(new Error(wn)))}processRequests(a){if(this.pendingRequest||this.queue.length===0)return;const{id:n,timestamp:s}=this.queue.shift();n&&this.success[n]||this.getSession(s,this.skuToken,c=>{c?this.errorCb(c):n&&(this.success[n]=!0)},a)}},Wi=qn.getSessionAPI.bind(qn),Nn=new Set,Si="mapbox-tiles";let ei,Ki,_i=500,Hr=50;function ki(){L.caches&&!ei&&(ei=L.caches.open(Si))}function Wr(a){const n=a.indexOf("?");return n<0?a:a.slice(0,n)}let Cr=1/0;const be={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(be);class W extends Error{constructor(n,s,c){s===401&&Ht(c)&&(n+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(n),this.status=s,this.url=c}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Y=ze()?()=>self.worker&&self.worker.referrer:()=>(L.location.protocol==="blob:"?L.parent:L).location.href,ge=function(a,n){if(!(/^file:/.test(s=a.url)||/^file:/.test(Y())&&!/^\w+:/.test(s))){if(L.fetch&&L.Request&&L.AbortController&&L.Request.prototype.hasOwnProperty("signal"))return function(c,p){const g=new L.AbortController,_=new L.Request(c.url,{method:c.method||"GET",body:c.body,credentials:c.credentials,headers:c.headers,referrer:Y(),signal:g.signal});let x=!1,C=!1;const S=(R=_.url).indexOf("sku=")>0&&Ht(R);var R;c.type==="json"&&_.headers.set("Accept","application/json");const B=(H,Z,Q)=>{if(C)return;if(H&&H.message!=="SecurityError"&&xe(H),Z&&Q)return N(Z);const le=Date.now();L.fetch(_).then(ve=>{if(ve.ok){const Fe=S?ve.clone():null;return N(ve,Fe,le)}return p(new W(ve.statusText,ve.status,c.url))}).catch(ve=>{ve.code!==20&&p(new Error(ve.message))})},N=(H,Z,Q)=>{(c.type==="arrayBuffer"?H.arrayBuffer():c.type==="json"?H.json():H.text()).then(le=>{C||(Z&&Q&&function(ve,Fe,je){if(ki(),!ei)return;const Xe={status:Fe.status,statusText:Fe.statusText,headers:new L.Headers};Fe.headers.forEach((ut,dt)=>Xe.headers.set(dt,ut));const Ye=rt(Fe.headers.get("Cache-Control")||"");if(Ye["no-store"])return;Ye["max-age"]&&Xe.headers.set("Expires",new Date(je+1e3*Ye["max-age"]).toUTCString());const Je=Xe.headers.get("Expires");Je&&(new Date(Je).getTime()-je<42e4||function(ut,dt){if(Ki===void 0)try{new Response(new ReadableStream),Ki=!0}catch(xt){Ki=!1}Ki?dt(ut.body):ut.blob().then(dt)}(Fe,ut=>{const dt=new L.Response(ut,Xe);ki(),ei&&ei.then(xt=>xt.put(Wr(ve.url),dt)).catch(xt=>xe(xt.message))}))}(_,Z,Q),x=!0,p(null,le,H.headers.get("Cache-Control"),H.headers.get("Expires")))}).catch(le=>{C||p(new Error(le.message))})};return S?function(H,Z){if(ki(),!ei)return Z(null);const Q=Wr(H.url);ei.then(le=>{le.match(Q).then(ve=>{const Fe=function(je){if(!je)return!1;const Xe=new Date(je.headers.get("Expires")||0),Ye=rt(je.headers.get("Cache-Control")||"");return Xe>Date.now()&&!Ye["no-cache"]}(ve);le.delete(Q),Fe&&le.put(Q,ve.clone()),Z(null,ve,Fe)}).catch(Z)}).catch(Z)}(_,B):B(null,null),{cancel:()=>{C=!0,x||g.abort()}}}(a,n);if(ze()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",a,n,void 0,!0)}var s;return function(c,p){const g=new L.XMLHttpRequest;g.open(c.method||"GET",c.url,!0),c.type==="arrayBuffer"&&(g.responseType="arraybuffer");for(const _ in c.headers)g.setRequestHeader(_,c.headers[_]);return c.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=c.credentials==="include",g.onerror=()=>{p(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let _=g.response;if(c.type==="json")try{_=JSON.parse(g.response)}catch(x){return p(x)}p(null,_,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else p(new W(g.statusText,g.status,c.url))},g.send(c.body),{cancel:()=>g.abort()}}(a,n)},Re=function(a,n){return ge(me(a,{type:"arrayBuffer"}),n)},We=function(a,n){return ge(me(a,{method:"POST"}),n)},Qe=function(a,n){return ge(me(a,{method:"GET"}),n)};function et(a){const n=L.document.createElement("a");return n.href=a,n.protocol===L.document.location.protocol&&n.host===L.document.location.host}const qe="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let it,vt;it=[],vt=0;const Vt=function(a,n){if(we.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),vt>=de.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:a,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return it.push(g),g}vt++;let s=!1;const c=()=>{if(!s)for(s=!0,vt--;it.length&&vt<de.MAX_PARALLEL_IMAGE_REQUESTS;){const g=it.shift(),{requestParameters:_,callback:x,cancelled:C}=g;C||(g.cancel=Vt(_,x).cancel)}},p=Re(a,(g,_,x,C)=>{c(),g?n(g):_&&(L.createImageBitmap?function(S,R){const B=new L.Blob([new Uint8Array(S)],{type:"image/png"});L.createImageBitmap(B).then(N=>{R(null,N)}).catch(N=>{R(new Error(`Could not load image because of ${N.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(S,R)=>n(S,R,x,C)):function(S,R){const B=new L.Image,N=L.URL;B.onload=()=>{R(null,B),N.revokeObjectURL(B.src),B.onload=null,L.requestAnimationFrame(()=>{B.src=qe})},B.onerror=()=>R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const H=new L.Blob([new Uint8Array(S)],{type:"image/png"});B.src=S.byteLength?N.createObjectURL(H):qe}(_,(S,R)=>n(S,R,x,C)))});return{cancel:()=>{p.cancel(),c()}}};function Ct(a,n,s){s[a]&&s[a].indexOf(n)!==-1||(s[a]=s[a]||[],s[a].push(n))}function _n(a,n,s){if(s&&s[a]){const c=s[a].indexOf(n);c!==-1&&s[a].splice(c,1)}}class q{constructor(n,s={}){me(this,s),this.type=n}}class K extends q{constructor(n,s={}){super("error",me({error:n},s))}}class Be{on(n,s){return this._listeners=this._listeners||{},Ct(n,s,this._listeners),this}off(n,s){return _n(n,s,this._listeners),_n(n,s,this._oneTimeListeners),this}once(n,s){return s?(this._oneTimeListeners=this._oneTimeListeners||{},Ct(n,s,this._oneTimeListeners),this):new Promise(c=>this.once(n,c))}fire(n,s){typeof n=="string"&&(n=new q(n,s||{}));const c=n.type;if(this.listens(c)){n.target=this;const p=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];for(const x of p)x.call(this,n);const g=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];for(const x of g)_n(c,x,this._oneTimeListeners),x.call(this,n);const _=this._eventedParent;_&&(me(n,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(n))}else n instanceof K&&console.error(n.error);return this}listens(n){return!!(this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n))}setEventedParent(n,s){return this._eventedParent=n,this._eventedParentData=s,this}}var Me=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Tt(a,...n){for(const s of n)for(const c in s)a[c]=s[c];return a}function _t(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function Ot(a){if(Array.isArray(a))return a.map(Ot);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const n={};for(const s in a)n[s]=Ot(a[s]);return n}return _t(a)}class rn extends Error{constructor(n,s){super(s),this.message=s,this.key=n}}class Pn{constructor(n,s=[]){this.parent=n,this.bindings={};for(const[c,p]of s)this.bindings[c]=p}concat(n){return new Pn(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const Ln={kind:"null"},Mt={kind:"number"},un={kind:"string"},Jt={kind:"boolean"},mn={kind:"color"},Tn={kind:"object"},Cn={kind:"value"},di={kind:"collator"},Ar={kind:"formatted"},oi={kind:"resolvedImage"};function li(a,n){return{kind:"array",itemType:a,N:n}}function ai(a){if(a.kind==="array"){const n=ai(a.itemType);return typeof a.N=="number"?`array<${n}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${n}>`}return a.kind}const xs=[Ln,Mt,un,Jt,mn,Ar,Tn,li(Cn),oi];function zo(a,n){if(n.kind==="error")return null;if(a.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!zo(a.itemType,n.itemType))&&(typeof a.N!="number"||a.N===n.N))return null}else{if(a.kind===n.kind)return null;if(a.kind==="value"){for(const s of xs)if(!zo(s,n))return null}}return`Expected ${ai(a)} but found ${ai(n)} instead.`}function su(a,n){return n.some(s=>s.kind===a.kind)}function bs(a,n){return n.some(s=>s==="null"?a===null:s==="array"?Array.isArray(a):s==="object"?a&&!Array.isArray(a)&&typeof a=="object":s===typeof a)}function lu(a){var n={exports:{}};return a(n,n.exports),n.exports}var Md=lu(function(a,n){var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function c(x){return(x=Math.round(x))<0?0:x>255?255:x}function p(x){return c(x[x.length-1]==="%"?parseFloat(x)/100*255:parseInt(x))}function g(x){return(C=x[x.length-1]==="%"?parseFloat(x)/100:parseFloat(x))<0?0:C>1?1:C;var C}function _(x,C,S){return S<0?S+=1:S>1&&(S-=1),6*S<1?x+(C-x)*S*6:2*S<1?C:3*S<2?x+(C-x)*(2/3-S)*6:x}try{n.parseCSSColor=function(x){var C,S=x.replace(/ /g,"").toLowerCase();if(S in s)return s[S].slice();if(S[0]==="#")return S.length===4?(C=parseInt(S.substr(1),16))>=0&&C<=4095?[(3840&C)>>4|(3840&C)>>8,240&C|(240&C)>>4,15&C|(15&C)<<4,1]:null:S.length===7&&(C=parseInt(S.substr(1),16))>=0&&C<=16777215?[(16711680&C)>>16,(65280&C)>>8,255&C,1]:null;var R=S.indexOf("("),B=S.indexOf(")");if(R!==-1&&B+1===S.length){var N=S.substr(0,R),H=S.substr(R+1,B-(R+1)).split(","),Z=1;switch(N){case"rgba":if(H.length!==4)return null;Z=g(H.pop());case"rgb":return H.length!==3?null:[p(H[0]),p(H[1]),p(H[2]),Z];case"hsla":if(H.length!==4)return null;Z=g(H.pop());case"hsl":if(H.length!==3)return null;var Q=(parseFloat(H[0])%360+360)%360/360,le=g(H[1]),ve=g(H[2]),Fe=ve<=.5?ve*(le+1):ve+le-ve*le,je=2*ve-Fe;return[c(255*_(je,Fe,Q+1/3)),c(255*_(je,Fe,Q)),c(255*_(je,Fe,Q-1/3)),Z];default:return null}}return null}}catch(x){}});class Zn{constructor(n,s,c,p=1){this.r=n,this.g=s,this.b=c,this.a=p}static parse(n){if(!n)return;if(n instanceof Zn)return n;if(typeof n!="string")return;const s=Md.parseCSSColor(n);return s?new Zn(s[0]/255*s[3],s[1]/255*s[3],s[2]/255*s[3],s[3]):void 0}toString(){const[n,s,c,p]=this.toArray();return`rgba(${Math.round(n)},${Math.round(s)},${Math.round(c)},${p})`}toArray(){const{r:n,g:s,b:c,a:p}=this;return p===0?[0,0,0,0]:[255*n/p,255*s/p,255*c/p,p]}}Zn.black=new Zn(0,0,0,1),Zn.white=new Zn(1,1,1,1),Zn.transparent=new Zn(0,0,0,0),Zn.red=new Zn(1,0,0,1),Zn.blue=new Zn(0,0,1,1);class ws{constructor(n,s,c){this.sensitivity=n?s?"variant":"case":s?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,s){return this.collator.compare(n,s)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Td{constructor(n,s,c,p,g){this.text=n.normalize?n.normalize():n,this.image=s,this.scale=c,this.fontStack=p,this.textColor=g}}class Bi{constructor(n){this.sections=n}static fromString(n){return new Bi([new Td(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.name.length!==0)}static factory(n){return n instanceof Bi?n:Bi.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}serialize(){const n=["format"];for(const s of this.sections){if(s.image){n.push(["image",s.image.name]);continue}n.push(s.text);const c={};s.fontStack&&(c["text-font"]=["literal",s.fontStack.split(",")]),s.scale&&(c["font-scale"]=s.scale),s.textColor&&(c["text-color"]=["rgba"].concat(s.textColor.toArray())),n.push(c)}return n}}class Sr{constructor(n){this.name=n.name,this.available=n.available}toString(){return this.name}static fromString(n){return n?new Sr({name:n,available:!1}):null}serialize(){return["image",this.name]}}function ho(a,n,s,c){return typeof a=="number"&&a>=0&&a<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof s=="number"&&s>=0&&s<=255?c===void 0||typeof c=="number"&&c>=0&&c<=1?null:`Invalid rgba value [${[a,n,s,c].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof c=="number"?[a,n,s,c]:[a,n,s]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function cu(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof Zn||a instanceof ws||a instanceof Bi||a instanceof Sr)return!0;if(Array.isArray(a)){for(const n of a)if(!cu(n))return!1;return!0}if(typeof a=="object"){for(const n in a)if(!cu(a[n]))return!1;return!0}return!1}function Di(a){if(a===null)return Ln;if(typeof a=="string")return un;if(typeof a=="boolean")return Jt;if(typeof a=="number")return Mt;if(a instanceof Zn)return mn;if(a instanceof ws)return di;if(a instanceof Bi)return Ar;if(a instanceof Sr)return oi;if(Array.isArray(a)){const n=a.length;let s;for(const c of a){const p=Di(c);if(s){if(s===p)continue;s=Cn;break}s=p}return li(s||Cn,n)}return Tn}function ko(a){const n=typeof a;return a===null?"":n==="string"||n==="number"||n==="boolean"?String(a):a instanceof Zn||a instanceof Bi||a instanceof Sr?a.toString():JSON.stringify(a)}class Bo{constructor(n,s){this.type=n,this.value=s}static parse(n,s){if(n.length!==2)return s.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!cu(n[1]))return s.error("invalid value");const c=n[1];let p=Di(c);const g=s.expectedType;return p.kind!=="array"||p.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(p=g),new Bo(p,c)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Zn?["rgba"].concat(this.value.toArray()):this.value instanceof Bi?this.value.serialize():this.value}}class Qi{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const Ed={string:un,number:Mt,boolean:Jt,object:Tn};class po{constructor(n,s){this.type=n,this.args=s}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");let c,p=1;const g=n[0];if(g==="array"){let x,C;if(n.length>2){const S=n[1];if(typeof S!="string"||!(S in Ed)||S==="object")return s.error('The item type argument of "array" must be one of string, number, boolean',1);x=Ed[S],p++}else x=Cn;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return s.error('The length argument to "array" must be a positive integer literal',2);C=n[2],p++}c=li(x,C)}else c=Ed[g];const _=[];for(;p<n.length;p++){const x=s.parse(n[p],p,Cn);if(!x)return null;_.push(x)}return new po(c,_)}evaluate(n){for(let s=0;s<this.args.length;s++){const c=this.args[s].evaluate(n);if(!zo(this.type,Di(c)))return c;if(s===this.args.length-1)throw new Qi(`Expected value to be of type ${ai(this.type)}, but found ${ai(Di(c))} instead.`)}return null}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=this.type,s=[n.kind];if(n.kind==="array"){const c=n.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){s.push(c.kind);const p=n.N;(typeof p=="number"||this.args.length>1)&&s.push(p)}}return s.concat(this.args.map(c=>c.serialize()))}}class Ms{constructor(n){this.type=Ar,this.sections=n}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");const c=n[1];if(!Array.isArray(c)&&typeof c=="object")return s.error("First argument must be an image or text section.");const p=[];let g=!1;for(let _=1;_<=n.length-1;++_){const x=n[_];if(g&&typeof x=="object"&&!Array.isArray(x)){g=!1;let C=null;if(x["font-scale"]&&(C=s.parse(x["font-scale"],1,Mt),!C))return null;let S=null;if(x["text-font"]&&(S=s.parse(x["text-font"],1,li(un)),!S))return null;let R=null;if(x["text-color"]&&(R=s.parse(x["text-color"],1,mn),!R))return null;const B=p[p.length-1];B.scale=C,B.font=S,B.textColor=R}else{const C=s.parse(n[_],1,Cn);if(!C)return null;const S=C.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return s.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,p.push({content:C,scale:null,font:null,textColor:null})}}return new Ms(p)}evaluate(n){return new Bi(this.sections.map(s=>{const c=s.content.evaluate(n);return Di(c)===oi?new Td("",c,null,null,null):new Td(ko(c),null,s.scale?s.scale.evaluate(n):null,s.font?s.font.evaluate(n).join(","):null,s.textColor?s.textColor.evaluate(n):null)}))}eachChild(n){for(const s of this.sections)n(s.content),s.scale&&n(s.scale),s.font&&n(s.font),s.textColor&&n(s.textColor)}outputDefined(){return!1}serialize(){const n=["format"];for(const s of this.sections){n.push(s.content.serialize());const c={};s.scale&&(c["font-scale"]=s.scale.serialize()),s.font&&(c["text-font"]=s.font.serialize()),s.textColor&&(c["text-color"]=s.textColor.serialize()),n.push(c)}return n}}class Ts{constructor(n){this.type=oi,this.input=n}static parse(n,s){if(n.length!==2)return s.error("Expected two arguments.");const c=s.parse(n[1],1,un);return c?new Ts(c):s.error("No image name provided.")}evaluate(n){const s=this.input.evaluate(n),c=Sr.fromString(s);return c&&n.availableImages&&(c.available=n.availableImages.indexOf(s)>-1),c}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const k_={"to-boolean":Jt,"to-color":mn,"to-number":Mt,"to-string":un};class fo{constructor(n,s){this.type=n,this.args=s}static parse(n,s){if(n.length<2)return s.error("Expected at least one argument.");const c=n[0];if((c==="to-boolean"||c==="to-string")&&n.length!==2)return s.error("Expected one argument.");const p=k_[c],g=[];for(let _=1;_<n.length;_++){const x=s.parse(n[_],_,Cn);if(!x)return null;g.push(x)}return new fo(p,g)}evaluate(n){if(this.type.kind==="boolean")return!!this.args[0].evaluate(n);if(this.type.kind==="color"){let s,c;for(const p of this.args){if(s=p.evaluate(n),c=null,s instanceof Zn)return s;if(typeof s=="string"){const g=n.parseColor(s);if(g)return g}else if(Array.isArray(s)&&(c=s.length<3||s.length>4?`Invalid rbga value ${JSON.stringify(s)}: expected an array containing either three or four numeric values.`:ho(s[0],s[1],s[2],s[3]),!c))return new Zn(s[0]/255,s[1]/255,s[2]/255,s[3])}throw new Qi(c||`Could not parse color from value '${typeof s=="string"?s:String(JSON.stringify(s))}'`)}if(this.type.kind==="number"){let s=null;for(const c of this.args){if(s=c.evaluate(n),s===null)return 0;const p=Number(s);if(!isNaN(p))return p}throw new Qi(`Could not convert ${JSON.stringify(s)} to number.`)}return this.type.kind==="formatted"?Bi.fromString(ko(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?Sr.fromString(ko(this.args[0].evaluate(n))):ko(this.args[0].evaluate(n))}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Ms([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Ts(this.args[0]).serialize();const n=[`to-${this.type.kind}`];return this.eachChild(s=>{n.push(s.serialize())}),n}}const B_=["Unknown","Point","LineString","Polygon"];class vm{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?B_[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,s=this.featureDistanceData.scale,{x:c,y:p}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(c*s-n[0])+this.featureDistanceData.bearing[1]*(p*s-n[1])}return 0}parseColor(n){let s=this._parseColorCache[n];return s||(s=this._parseColorCache[n]=Zn.parse(n)),s}}class Dr{constructor(n,s,c,p){this.name=n,this.type=s,this._evaluate=c,this.args=p}evaluate(n){return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(n=>n.serialize()))}static parse(n,s){const c=n[0],p=Dr.definitions[c];if(!p)return s.error(`Unknown expression "${c}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(p)?p[0]:p.type,_=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,x=_.filter(([S])=>!Array.isArray(S)||S.length===n.length-1);let C=null;for(const[S,R]of x){C=new ra(s.registry,s.path,null,s.scope);const B=[];let N=!1;for(let H=1;H<n.length;H++){const Z=n[H],Q=Array.isArray(S)?S[H-1]:S.type,le=C.parse(Z,1+B.length,Q);if(!le){N=!0;break}B.push(le)}if(!N)if(Array.isArray(S)&&S.length!==B.length)C.error(`Expected ${S.length} arguments, but found ${B.length} instead.`);else{for(let H=0;H<B.length;H++){const Z=Array.isArray(S)?S[H]:S.type,Q=B[H];C.concat(H+1).checkSubtype(Z,Q.type)}if(C.errors.length===0)return new Dr(c,g,R,B)}}if(x.length===1)s.errors.push(...C.errors);else{const S=(x.length?x:_).map(([B])=>{return N=B,Array.isArray(N)?`(${N.map(ai).join(", ")})`:`(${ai(N.type)}...)`;var N}).join(" | "),R=[];for(let B=1;B<n.length;B++){const N=s.parse(n[B],1+R.length);if(!N)return null;R.push(ai(N.type))}s.error(`Expected arguments of type ${S}, but found (${R.join(", ")}) instead.`)}return null}static register(n,s){Dr.definitions=s;for(const c in s)n[c]=Dr}}class uu{constructor(n,s,c){this.type=di,this.locale=c,this.caseSensitive=n,this.diacriticSensitive=s}static parse(n,s){if(n.length!==2)return s.error("Expected one argument.");const c=n[1];if(typeof c!="object"||Array.isArray(c))return s.error("Collator options argument must be an object.");const p=s.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,Jt);if(!p)return null;const g=s.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,Jt);if(!g)return null;let _=null;return c.locale&&(_=s.parse(c.locale,1,un),!_)?null:new uu(p,g,_)}evaluate(n){return new ws(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}serialize(){const n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]}}const ia=8192;function Cd(a,n){a[0]=Math.min(a[0],n[0]),a[1]=Math.min(a[1],n[1]),a[2]=Math.max(a[2],n[0]),a[3]=Math.max(a[3],n[1])}function hu(a,n){return!(a[0]<=n[0]||a[2]>=n[2]||a[1]<=n[1]||a[3]>=n[3])}function xm(a,n){const s=(180+a[0])/360,c=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,p=Math.pow(2,n.z);return[Math.round(s*p*ia),Math.round(c*p*ia)]}function du(a,n,s){const c=a[0]-n[0],p=a[1]-n[1],g=a[0]-s[0],_=a[1]-s[1];return c*_-g*p==0&&c*g<=0&&p*_<=0}function Ad(a,n){let s=!1;for(let _=0,x=n.length;_<x;_++){const C=n[_];for(let S=0,R=C.length;S<R-1;S++){if(du(a,C[S],C[S+1]))return!1;(p=C[S])[1]>(c=a)[1]!=(g=C[S+1])[1]>c[1]&&c[0]<(g[0]-p[0])*(c[1]-p[1])/(g[1]-p[1])+p[0]&&(s=!s)}}var c,p,g;return s}function F_(a,n){for(let s=0;s<n.length;s++)if(Ad(a,n[s]))return!0;return!1}function bm(a,n,s,c){const p=c[0]-s[0],g=c[1]-s[1],_=(a[0]-s[0])*g-p*(a[1]-s[1]),x=(n[0]-s[0])*g-p*(n[1]-s[1]);return _>0&&x<0||_<0&&x>0}function O_(a,n,s){for(const S of s)for(let R=0;R<S.length-1;++R)if((x=[(_=S[R+1])[0]-(g=S[R])[0],_[1]-g[1]])[0]*(C=[(p=n)[0]-(c=a)[0],p[1]-c[1]])[1]-x[1]*C[0]!=0&&bm(c,p,g,_)&&bm(g,_,c,p))return!0;var c,p,g,_,x,C;return!1}function wm(a,n){for(let s=0;s<a.length;++s)if(!Ad(a[s],n))return!1;for(let s=0;s<a.length-1;++s)if(O_(a[s],a[s+1],n))return!1;return!0}function N_(a,n){for(let s=0;s<n.length;s++)if(wm(a,n[s]))return!0;return!1}function pu(a,n,s){const c=[];for(let p=0;p<a.length;p++){const g=[];for(let _=0;_<a[p].length;_++){const x=xm(a[p][_],s);Cd(n,x),g.push(x)}c.push(g)}return c}function xl(a,n,s){const c=[];for(let p=0;p<a.length;p++){const g=pu(a[p],n,s);c.push(g)}return c}function Mm(a,n,s,c){if(a[0]<s[0]||a[0]>s[2]){const p=.5*c;let g=a[0]-s[0]>p?-c:s[0]-a[0]>p?c:0;g===0&&(g=a[0]-s[2]>p?-c:s[2]-a[0]>p?c:0),a[0]+=g}Cd(n,a)}function Tm(a,n,s,c){const p=Math.pow(2,c.z)*ia,g=[c.x*ia,c.y*ia],_=[];if(!a)return _;for(const x of a)for(const C of x){const S=[C.x+g[0],C.y+g[1]];Mm(S,n,s,p),_.push(S)}return _}function Em(a,n,s,c){const p=Math.pow(2,c.z)*ia,g=[c.x*ia,c.y*ia],_=[];if(!a)return _;for(const C of a){const S=[];for(const R of C){const B=[R.x+g[0],R.y+g[1]];Cd(n,B),S.push(B)}_.push(S)}if(n[2]-n[0]<=p/2){(x=n)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const C of _)for(const S of C)Mm(S,n,s,p)}var x;return _}class Na{constructor(n,s){this.type=Jt,this.geojson=n,this.geometries=s}static parse(n,s){if(n.length!==2)return s.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(cu(n[1])){const c=n[1];if(c.type==="FeatureCollection")for(let p=0;p<c.features.length;++p){const g=c.features[p].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Na(c,c.features[p].geometry)}else if(c.type==="Feature"){const p=c.geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new Na(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new Na(c,c)}return s.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(s,c){const p=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if(!_)return!1;if(c.type==="Polygon"){const x=pu(c.coordinates,g,_),C=Tm(s.geometry(),p,g,_);if(!hu(p,g))return!1;for(const S of C)if(!Ad(S,x))return!1}if(c.type==="MultiPolygon"){const x=xl(c.coordinates,g,_),C=Tm(s.geometry(),p,g,_);if(!hu(p,g))return!1;for(const S of C)if(!F_(S,x))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(s,c){const p=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=s.canonicalID();if(!_)return!1;if(c.type==="Polygon"){const x=pu(c.coordinates,g,_),C=Em(s.geometry(),p,g,_);if(!hu(p,g))return!1;for(const S of C)if(!wm(S,x))return!1}if(c.type==="MultiPolygon"){const x=xl(c.coordinates,g,_),C=Em(s.geometry(),p,g,_);if(!hu(p,g))return!1;for(const S of C)if(!N_(S,x))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function gr(a){if(a instanceof Dr&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Na)return!1;let n=!0;return a.eachChild(s=>{n&&!gr(s)&&(n=!1)}),n}function bl(a){if(a instanceof Dr&&a.name==="feature-state")return!1;let n=!0;return a.eachChild(s=>{n&&!bl(s)&&(n=!1)}),n}function wl(a,n){if(a instanceof Dr&&n.indexOf(a.name)>=0)return!1;let s=!0;return a.eachChild(c=>{s&&!wl(c,n)&&(s=!1)}),s}class Ua{constructor(n,s){this.type=s.type,this.name=n,this.boundExpression=s}static parse(n,s){if(n.length!==2||typeof n[1]!="string")return s.error("'var' expression requires exactly one string literal argument.");const c=n[1];return s.scope.has(c)?new Ua(c,s.scope.get(c)):s.error(`Unknown variable "${c}". Make sure "${c}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class ra{constructor(n,s=[],c,p=new Pn,g=[]){this.registry=n,this.path=s,this.key=s.map(_=>`[${_}]`).join(""),this.scope=p,this.errors=g,this.expectedType=c}parse(n,s,c,p,g={}){return s?this.concat(s,c,p)._parse(n,g):this._parse(n,g)}_parse(n,s){function c(p,g,_){return _==="assert"?new po(g,[p]):_==="coerce"?new fo(g,[p]):p}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=n[0];if(typeof p!="string")return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[p];if(g){let _=g.parse(n,this);if(!_)return null;if(this.expectedType){const x=this.expectedType,C=_.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||C.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||C.kind!=="value"&&C.kind!=="string"){if(this.checkSubtype(x,C))return null}else _=c(_,x,s.typeAnnotation||"coerce");else _=c(_,x,s.typeAnnotation||"assert")}if(!(_ instanceof Bo)&&_.type.kind!=="resolvedImage"&&fu(_)){const x=new vm;try{_=new Bo(_.type,_.evaluate(x))}catch(C){return this.error(C.message),null}}return _}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,s,c){const p=typeof n=="number"?this.path.concat(n):this.path,g=c?this.scope.concat(c):this.scope;return new ra(this.registry,p,s||null,g,this.errors)}error(n,...s){const c=`${this.key}${s.map(p=>`[${p}]`).join("")}`;this.errors.push(new rn(c,n))}checkSubtype(n,s){const c=zo(n,s);return c&&this.error(c),c}}function fu(a){if(a instanceof Ua)return fu(a.boundExpression);if(a instanceof Dr&&a.name==="error"||a instanceof uu||a instanceof Na)return!1;const n=a instanceof fo||a instanceof po;let s=!0;return a.eachChild(c=>{s=n?s&&fu(c):s&&c instanceof Bo}),!!s&&gr(a)&&wl(a,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Ml(a,n){const s=a.length-1;let c,p,g=0,_=s,x=0;for(;g<=_;)if(x=Math.floor((g+_)/2),c=a[x],p=a[x+1],c<=n){if(x===s||n<p)return x;g=x+1}else{if(!(c>n))throw new Qi("Input is not a number.");_=x-1}return 0}class Tl{constructor(n,s,c){this.type=n,this.input=s,this.labels=[],this.outputs=[];for(const[p,g]of c)this.labels.push(p),this.outputs.push(g)}static parse(n,s){if(n.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return s.error("Expected an even number of arguments.");const c=s.parse(n[1],1,Mt);if(!c)return null;const p=[];let g=null;s.expectedType&&s.expectedType.kind!=="value"&&(g=s.expectedType);for(let _=1;_<n.length;_+=2){const x=_===1?-1/0:n[_],C=n[_+1],S=_,R=_+1;if(typeof x!="number")return s.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(p.length&&p[p.length-1][0]>=x)return s.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const B=s.parse(C,R,g);if(!B)return null;g=g||B.type,p.push([x,B])}return new Tl(g,c,p)}evaluate(n){const s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(n);const p=this.input.evaluate(n);if(p<=s[0])return c[0].evaluate(n);const g=s.length;return p>=s[g-1]?c[g-1].evaluate(n):c[Ml(s,p)].evaluate(n)}eachChild(n){n(this.input);for(const s of this.outputs)n(s)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){const n=["step",this.input.serialize()];for(let s=0;s<this.labels.length;s++)s>0&&n.push(this.labels[s]),n.push(this.outputs[s].serialize());return n}}function yn(a,n,s){return a*(1-s)+n*s}var mu=Object.freeze({__proto__:null,number:yn,color:function(a,n,s){return new Zn(yn(a.r,n.r,s),yn(a.g,n.g,s),yn(a.b,n.b,s),yn(a.a,n.a,s))},array:function(a,n,s){return a.map((c,p)=>yn(c,n[p],s))}});const Cm=.95047,Am=1.08883,Sd=4/29,Dd=6/29,Pd=3*Dd*Dd,Sm=Math.PI/180,Dm=180/Math.PI;function gu(a){return a>.008856451679035631?Math.pow(a,.3333333333333333):a/Pd+Sd}function oa(a){return a>Dd?a*a*a:Pd*(a-Sd)}function Es(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,.4166666666666667)-.055)}function Ld(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function yu(a){const n=Ld(a.r),s=Ld(a.g),c=Ld(a.b),p=gu((.4124564*n+.3575761*s+.1804375*c)/Cm),g=gu((.2126729*n+.7151522*s+.072175*c)/1);return{l:116*g-16,a:500*(p-g),b:200*(g-gu((.0193339*n+.119192*s+.9503041*c)/Am)),alpha:a.a}}function Id(a){let n=(a.l+16)/116,s=isNaN(a.a)?n:n+a.a/500,c=isNaN(a.b)?n:n-a.b/200;return n=1*oa(n),s=Cm*oa(s),c=Am*oa(c),new Zn(Es(3.2404542*s-1.5371385*n-.4985314*c),Es(-.969266*s+1.8760108*n+.041556*c),Es(.0556434*s-.2040259*n+1.0572252*c),a.alpha)}function U_(a,n,s){const c=n-a;return a+s*(c>180||c<-180?c-360*Math.round(c/360):c)}const El={forward:yu,reverse:Id,interpolate:function(a,n,s){return{l:yn(a.l,n.l,s),a:yn(a.a,n.a,s),b:yn(a.b,n.b,s),alpha:yn(a.alpha,n.alpha,s)}}},Cl={forward:function(a){const{l:n,a:s,b:c}=yu(a),p=Math.atan2(c,s)*Dm;return{h:p<0?p+360:p,c:Math.sqrt(s*s+c*c),l:n,alpha:a.a}},reverse:function(a){const n=a.h*Sm,s=a.c;return Id({l:a.l,a:Math.cos(n)*s,b:Math.sin(n)*s,alpha:a.alpha})},interpolate:function(a,n,s){return{h:U_(a.h,n.h,s),c:yn(a.c,n.c,s),l:yn(a.l,n.l,s),alpha:yn(a.alpha,n.alpha,s)}}};var Rd=Object.freeze({__proto__:null,lab:El,hcl:Cl});class Pr{constructor(n,s,c,p,g){this.type=n,this.operator=s,this.interpolation=c,this.input=p,this.labels=[],this.outputs=[];for(const[_,x]of g)this.labels.push(_),this.outputs.push(x)}static interpolationFactor(n,s,c,p){let g=0;if(n.name==="exponential")g=_u(s,n.base,c,p);else if(n.name==="linear")g=_u(s,1,c,p);else if(n.name==="cubic-bezier"){const _=n.controlPoints;g=new b(_[0],_[1],_[2],_[3]).solve(_u(s,1,c,p))}return g}static parse(n,s){let[c,p,g,..._]=n;if(!Array.isArray(p)||p.length===0)return s.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){const S=p[1];if(typeof S!="number")return s.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:S}}else{if(p[0]!=="cubic-bezier")return s.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const S=p.slice(1);if(S.length!==4||S.some(R=>typeof R!="number"||R<0||R>1))return s.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:S}}}if(n.length-1<4)return s.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return s.error("Expected an even number of arguments.");if(g=s.parse(g,2,Mt),!g)return null;const x=[];let C=null;c==="interpolate-hcl"||c==="interpolate-lab"?C=mn:s.expectedType&&s.expectedType.kind!=="value"&&(C=s.expectedType);for(let S=0;S<_.length;S+=2){const R=_[S],B=_[S+1],N=S+3,H=S+4;if(typeof R!="number")return s.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(x.length&&x[x.length-1][0]>=R)return s.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',N);const Z=s.parse(B,H,C);if(!Z)return null;C=C||Z.type,x.push([R,Z])}return C.kind==="number"||C.kind==="color"||C.kind==="array"&&C.itemType.kind==="number"&&typeof C.N=="number"?new Pr(C,c,p,g,x):s.error(`Type ${ai(C)} is not interpolatable.`)}evaluate(n){const s=this.labels,c=this.outputs;if(s.length===1)return c[0].evaluate(n);const p=this.input.evaluate(n);if(p<=s[0])return c[0].evaluate(n);const g=s.length;if(p>=s[g-1])return c[g-1].evaluate(n);const _=Ml(s,p),x=Pr.interpolationFactor(this.interpolation,p,s[_],s[_+1]),C=c[_].evaluate(n),S=c[_+1].evaluate(n);return this.operator==="interpolate"?mu[this.type.kind.toLowerCase()](C,S,x):this.operator==="interpolate-hcl"?Cl.reverse(Cl.interpolate(Cl.forward(C),Cl.forward(S),x)):El.reverse(El.interpolate(El.forward(C),El.forward(S),x))}eachChild(n){n(this.input);for(const s of this.outputs)n(s)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){let n;n=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const s=[this.operator,n,this.input.serialize()];for(let c=0;c<this.labels.length;c++)s.push(this.labels[c],this.outputs[c].serialize());return s}}function _u(a,n,s,c){const p=c-s,g=a-s;return p===0?0:n===1?g/p:(Math.pow(n,g)-1)/(Math.pow(n,p)-1)}class Al{constructor(n,s){this.type=n,this.args=s}static parse(n,s){if(n.length<2)return s.error("Expectected at least one argument.");let c=null;const p=s.expectedType;p&&p.kind!=="value"&&(c=p);const g=[];for(const x of n.slice(1)){const C=s.parse(x,1+g.length,c,void 0,{typeAnnotation:"omit"});if(!C)return null;c=c||C.type,g.push(C)}const _=p&&g.some(x=>zo(p,x.type));return new Al(_?Cn:c,g)}evaluate(n){let s,c=null,p=0;for(const g of this.args){if(p++,c=g.evaluate(n),c&&c instanceof Sr&&!c.available&&(s||(s=c),c=null,p===this.args.length))return s;if(c!==null)break}return c}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=["coalesce"];return this.eachChild(s=>{n.push(s.serialize())}),n}}class Sl{constructor(n,s){this.type=s.type,this.bindings=[].concat(n),this.result=s}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const s of this.bindings)n(s[1]);n(this.result)}static parse(n,s){if(n.length<4)return s.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const c=[];for(let g=1;g<n.length-1;g+=2){const _=n[g];if(typeof _!="string")return s.error(`Expected string, but found ${typeof _} instead.`,g);if(/[^a-zA-Z0-9_]/.test(_))return s.error("Variable names must contain only alphanumeric characters or '_'.",g);const x=s.parse(n[g+1],g+1);if(!x)return null;c.push([_,x])}const p=s.parse(n[n.length-1],n.length-1,s.expectedType,c);return p?new Sl(c,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const n=["let"];for(const[s,c]of this.bindings)n.push(s,c.serialize());return n.push(this.result.serialize()),n}}class zd{constructor(n,s,c){this.type=n,this.index=s,this.input=c}static parse(n,s){if(n.length!==3)return s.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const c=s.parse(n[1],1,Mt),p=s.parse(n[2],2,li(s.expectedType||Cn));return c&&p?new zd(p.type.itemType,c,p):null}evaluate(n){const s=this.index.evaluate(n),c=this.input.evaluate(n);if(s<0)throw new Qi(`Array index out of bounds: ${s} < 0.`);if(s>=c.length)throw new Qi(`Array index out of bounds: ${s} > ${c.length-1}.`);if(s!==Math.floor(s))throw new Qi(`Array index must be an integer, but found ${s} instead.`);return c[s]}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class vu{constructor(n,s){this.type=Jt,this.needle=n,this.haystack=s}static parse(n,s){if(n.length!==3)return s.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const c=s.parse(n[1],1,Cn),p=s.parse(n[2],2,Cn);return c&&p?su(c.type,[Jt,un,Mt,Ln,Cn])?new vu(c,p):s.error(`Expected first argument to be of type boolean, string, number or null, but found ${ai(c.type)} instead`):null}evaluate(n){const s=this.needle.evaluate(n),c=this.haystack.evaluate(n);if(c==null)return!1;if(!bs(s,["boolean","string","number","null"]))throw new Qi(`Expected first argument to be of type boolean, string, number or null, but found ${ai(Di(s))} instead.`);if(!bs(c,["string","array"]))throw new Qi(`Expected second argument to be of type array or string, but found ${ai(Di(c))} instead.`);return c.indexOf(s)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class xu{constructor(n,s,c){this.type=Mt,this.needle=n,this.haystack=s,this.fromIndex=c}static parse(n,s){if(n.length<=2||n.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const c=s.parse(n[1],1,Cn),p=s.parse(n[2],2,Cn);if(!c||!p)return null;if(!su(c.type,[Jt,un,Mt,Ln,Cn]))return s.error(`Expected first argument to be of type boolean, string, number or null, but found ${ai(c.type)} instead`);if(n.length===4){const g=s.parse(n[3],3,Mt);return g?new xu(c,p,g):null}return new xu(c,p)}evaluate(n){const s=this.needle.evaluate(n),c=this.haystack.evaluate(n);if(!bs(s,["boolean","string","number","null"]))throw new Qi(`Expected first argument to be of type boolean, string, number or null, but found ${ai(Di(s))} instead.`);if(!bs(c,["string","array"]))throw new Qi(`Expected second argument to be of type array or string, but found ${ai(Di(c))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(n);return c.indexOf(s,p)}return c.indexOf(s)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class bu{constructor(n,s,c,p,g,_){this.inputType=n,this.type=s,this.input=c,this.cases=p,this.outputs=g,this.otherwise=_}static parse(n,s){if(n.length<5)return s.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return s.error("Expected an even number of arguments.");let c,p;s.expectedType&&s.expectedType.kind!=="value"&&(p=s.expectedType);const g={},_=[];for(let S=2;S<n.length-1;S+=2){let R=n[S];const B=n[S+1];Array.isArray(R)||(R=[R]);const N=s.concat(S);if(R.length===0)return N.error("Expected at least one branch label.");for(const Z of R){if(typeof Z!="number"&&typeof Z!="string")return N.error("Branch labels must be numbers or strings.");if(typeof Z=="number"&&Math.abs(Z)>Number.MAX_SAFE_INTEGER)return N.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Z=="number"&&Math.floor(Z)!==Z)return N.error("Numeric branch labels must be integer values.");if(c){if(N.checkSubtype(c,Di(Z)))return null}else c=Di(Z);if(g[String(Z)]!==void 0)return N.error("Branch labels must be unique.");g[String(Z)]=_.length}const H=s.parse(B,S,p);if(!H)return null;p=p||H.type,_.push(H)}const x=s.parse(n[1],1,Cn);if(!x)return null;const C=s.parse(n[n.length-1],n.length-1,p);return C?x.type.kind!=="value"&&s.concat(1).checkSubtype(c,x.type)?null:new bu(c,p,x,g,_,C):null}evaluate(n){const s=this.input.evaluate(n);return(Di(s)===this.inputType&&this.outputs[this.cases[s]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["match",this.input.serialize()],s=Object.keys(this.cases).sort(),c=[],p={};for(const _ of s){const x=p[this.cases[_]];x===void 0?(p[this.cases[_]]=c.length,c.push([this.cases[_],[_]])):c[x][1].push(_)}const g=_=>this.inputType.kind==="number"?Number(_):_;for(const[_,x]of c)n.push(x.length===1?g(x[0]):x.map(g)),n.push(this.outputs[_].serialize());return n.push(this.otherwise.serialize()),n}}class wu{constructor(n,s,c){this.type=n,this.branches=s,this.otherwise=c}static parse(n,s){if(n.length<4)return s.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return s.error("Expected an odd number of arguments.");let c;s.expectedType&&s.expectedType.kind!=="value"&&(c=s.expectedType);const p=[];for(let _=1;_<n.length-1;_+=2){const x=s.parse(n[_],_,Jt);if(!x)return null;const C=s.parse(n[_+1],_+1,c);if(!C)return null;p.push([x,C]),c=c||C.type}const g=s.parse(n[n.length-1],n.length-1,c);return g?new wu(c,p,g):null}evaluate(n){for(const[s,c]of this.branches)if(s.evaluate(n))return c.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[s,c]of this.branches)n(s),n(c);n(this.otherwise)}outputDefined(){return this.branches.every(([n,s])=>s.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["case"];return this.eachChild(s=>{n.push(s.serialize())}),n}}class Mu{constructor(n,s,c,p){this.type=n,this.input=s,this.beginIndex=c,this.endIndex=p}static parse(n,s){if(n.length<=2||n.length>=5)return s.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const c=s.parse(n[1],1,Cn),p=s.parse(n[2],2,Mt);if(!c||!p)return null;if(!su(c.type,[li(Cn),un,Cn]))return s.error(`Expected first argument to be of type array or string, but found ${ai(c.type)} instead`);if(n.length===4){const g=s.parse(n[3],3,Mt);return g?new Mu(c.type,c,p,g):null}return new Mu(c.type,c,p)}evaluate(n){const s=this.input.evaluate(n),c=this.beginIndex.evaluate(n);if(!bs(s,["string","array"]))throw new Qi(`Expected first argument to be of type array or string, but found ${ai(Di(s))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(n);return s.slice(c,p)}return s.slice(c)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Pm(a,n){return a==="=="||a==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function Lm(a,n,s,c){return c.compare(n,s)===0}function Cs(a,n,s){const c=a!=="=="&&a!=="!=";return class oM{constructor(g,_,x){this.type=Jt,this.lhs=g,this.rhs=_,this.collator=x,this.hasUntypedArgument=g.type.kind==="value"||_.type.kind==="value"}static parse(g,_){if(g.length!==3&&g.length!==4)return _.error("Expected two or three arguments.");const x=g[0];let C=_.parse(g[1],1,Cn);if(!C)return null;if(!Pm(x,C.type))return _.concat(1).error(`"${x}" comparisons are not supported for type '${ai(C.type)}'.`);let S=_.parse(g[2],2,Cn);if(!S)return null;if(!Pm(x,S.type))return _.concat(2).error(`"${x}" comparisons are not supported for type '${ai(S.type)}'.`);if(C.type.kind!==S.type.kind&&C.type.kind!=="value"&&S.type.kind!=="value")return _.error(`Cannot compare types '${ai(C.type)}' and '${ai(S.type)}'.`);c&&(C.type.kind==="value"&&S.type.kind!=="value"?C=new po(S.type,[C]):C.type.kind!=="value"&&S.type.kind==="value"&&(S=new po(C.type,[S])));let R=null;if(g.length===4){if(C.type.kind!=="string"&&S.type.kind!=="string"&&C.type.kind!=="value"&&S.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(R=_.parse(g[3],3,di),!R)return null}return new oM(C,S,R)}evaluate(g){const _=this.lhs.evaluate(g),x=this.rhs.evaluate(g);if(c&&this.hasUntypedArgument){const C=Di(_),S=Di(x);if(C.kind!==S.kind||C.kind!=="string"&&C.kind!=="number")throw new Qi(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${C.kind}, ${S.kind}) instead.`)}if(this.collator&&!c&&this.hasUntypedArgument){const C=Di(_),S=Di(x);if(C.kind!=="string"||S.kind!=="string")return n(g,_,x)}return this.collator?s(g,_,x,this.collator.evaluate(g)):n(g,_,x)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[a];return this.eachChild(_=>{g.push(_.serialize())}),g}}}const V_=Cs("==",function(a,n,s){return n===s},Lm),G_=Cs("!=",function(a,n,s){return n!==s},function(a,n,s,c){return!Lm(0,n,s,c)}),Im=Cs("<",function(a,n,s){return n<s},function(a,n,s,c){return c.compare(n,s)<0}),H_=Cs(">",function(a,n,s){return n>s},function(a,n,s,c){return c.compare(n,s)>0}),W_=Cs("<=",function(a,n,s){return n<=s},function(a,n,s,c){return c.compare(n,s)<=0}),j_=Cs(">=",function(a,n,s){return n>=s},function(a,n,s,c){return c.compare(n,s)>=0});class kd{constructor(n,s,c,p,g){this.type=un,this.number=n,this.locale=s,this.currency=c,this.minFractionDigits=p,this.maxFractionDigits=g}static parse(n,s){if(n.length!==3)return s.error("Expected two arguments.");const c=s.parse(n[1],1,Mt);if(!c)return null;const p=n[2];if(typeof p!="object"||Array.isArray(p))return s.error("NumberFormat options argument must be an object.");let g=null;if(p.locale&&(g=s.parse(p.locale,1,un),!g))return null;let _=null;if(p.currency&&(_=s.parse(p.currency,1,un),!_))return null;let x=null;if(p["min-fraction-digits"]&&(x=s.parse(p["min-fraction-digits"],1,Mt),!x))return null;let C=null;return p["max-fraction-digits"]&&(C=s.parse(p["max-fraction-digits"],1,Mt),!C)?null:new kd(c,g,_,x,C)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]}}class Tu{constructor(n){this.type=Mt,this.input=n}static parse(n,s){if(n.length!==2)return s.error(`Expected 1 argument, but found ${n.length-1} instead.`);const c=s.parse(n[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?s.error(`Expected argument of type string or array, but found ${ai(c.type)} instead.`):new Tu(c):null}evaluate(n){const s=this.input.evaluate(n);if(typeof s=="string"||Array.isArray(s))return s.length;throw new Qi(`Expected value to be of type string or array, but found ${ai(Di(s))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){const n=["length"];return this.eachChild(s=>{n.push(s.serialize())}),n}}const Va={"==":V_,"!=":G_,">":H_,"<":Im,">=":j_,"<=":W_,array:po,at:zd,boolean:po,case:wu,coalesce:Al,collator:uu,format:Ms,image:Ts,in:vu,"index-of":xu,interpolate:Pr,"interpolate-hcl":Pr,"interpolate-lab":Pr,length:Tu,let:Sl,literal:Bo,match:bu,number:po,"number-format":kd,object:po,slice:Mu,step:Tl,string:po,"to-boolean":fo,"to-color":fo,"to-number":fo,"to-string":fo,var:Ua,within:Na};function Bd(a,[n,s,c,p]){n=n.evaluate(a),s=s.evaluate(a),c=c.evaluate(a);const g=p?p.evaluate(a):1,_=ho(n,s,c,g);if(_)throw new Qi(_);return new Zn(n/255*g,s/255*g,c/255*g,g)}function Rm(a,n){return a in n}function Fd(a,n){const s=n[a];return s===void 0?null:s}function aa(a){return{type:a}}function Od(a){return{result:"success",value:a}}function Ga(a){return{result:"error",value:a}}function As(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function zm(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Nd(a){return!!a.expression&&a.expression.interpolated}function Qn(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function Ha(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function km(a){return a}function Ud(a,n){const s=n.type==="color",c=a.stops&&typeof a.stops[0][0]=="object",p=c||!(c||a.property!==void 0),g=a.type||(Nd(n)?"exponential":"interval");if(s&&((a=Tt({},a)).stops&&(a.stops=a.stops.map(S=>[S[0],Zn.parse(S[1])])),a.default=Zn.parse(a.default?a.default:n.default)),a.colorSpace&&a.colorSpace!=="rgb"&&!Rd[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let _,x,C;if(g==="exponential")_=Vd;else if(g==="interval")_=q_;else if(g==="categorical"){_=$_,x=Object.create(null);for(const S of a.stops)x[S[0]]=S[1];C=typeof a.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);_=Bm}if(c){const S={},R=[];for(let H=0;H<a.stops.length;H++){const Z=a.stops[H],Q=Z[0].zoom;S[Q]===void 0&&(S[Q]={zoom:Q,type:a.type,property:a.property,default:a.default,stops:[]},R.push(Q)),S[Q].stops.push([Z[0].value,Z[1]])}const B=[];for(const H of R)B.push([S[H].zoom,Ud(S[H],n)]);const N={name:"linear"};return{kind:"composite",interpolationType:N,interpolationFactor:Pr.interpolationFactor.bind(void 0,N),zoomStops:B.map(H=>H[0]),evaluate:({zoom:H},Z)=>Vd({stops:B,base:a.base},n,H).evaluate(H,Z)}}if(p){const S=g==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:Pr.interpolationFactor.bind(void 0,S),zoomStops:a.stops.map(R=>R[0]),evaluate:({zoom:R})=>_(a,n,R,x,C)}}return{kind:"source",evaluate(S,R){const B=R&&R.properties?R.properties[a.property]:void 0;return B===void 0?Dl(a.default,n.default):_(a,n,B,x,C)}}}function Dl(a,n,s){return a!==void 0?a:n!==void 0?n:s!==void 0?s:void 0}function $_(a,n,s,c,p){return Dl(typeof s===p?c[s]:void 0,a.default,n.default)}function q_(a,n,s){if(Qn(s)!=="number")return Dl(a.default,n.default);const c=a.stops.length;if(c===1||s<=a.stops[0][0])return a.stops[0][1];if(s>=a.stops[c-1][0])return a.stops[c-1][1];const p=Ml(a.stops.map(g=>g[0]),s);return a.stops[p][1]}function Vd(a,n,s){const c=a.base!==void 0?a.base:1;if(Qn(s)!=="number")return Dl(a.default,n.default);const p=a.stops.length;if(p===1||s<=a.stops[0][0])return a.stops[0][1];if(s>=a.stops[p-1][0])return a.stops[p-1][1];const g=Ml(a.stops.map(R=>R[0]),s),_=function(R,B,N,H){const Z=H-N,Q=R-N;return Z===0?0:B===1?Q/Z:(Math.pow(B,Q)-1)/(Math.pow(B,Z)-1)}(s,c,a.stops[g][0],a.stops[g+1][0]),x=a.stops[g][1],C=a.stops[g+1][1];let S=mu[n.type]||km;if(a.colorSpace&&a.colorSpace!=="rgb"){const R=Rd[a.colorSpace];S=(B,N)=>R.reverse(R.interpolate(R.forward(B),R.forward(N),_))}return typeof x.evaluate=="function"?{evaluate(...R){const B=x.evaluate.apply(void 0,R),N=C.evaluate.apply(void 0,R);if(B!==void 0&&N!==void 0)return S(B,N,_)}}:S(x,C,_)}function Bm(a,n,s){return n.type==="color"?s=Zn.parse(s):n.type==="formatted"?s=Bi.fromString(s.toString()):n.type==="resolvedImage"?s=Sr.fromString(s.toString()):Qn(s)===n.type||n.type==="enum"&&n.values[s]||(s=void 0),Dl(s,a.default,n.default)}Dr.register(Va,{error:[{kind:"error"},[un],(a,[n])=>{throw new Qi(n.evaluate(a))}],typeof:[un,[Cn],(a,[n])=>ai(Di(n.evaluate(a)))],"to-rgba":[li(Mt,4),[mn],(a,[n])=>n.evaluate(a).toArray()],rgb:[mn,[Mt,Mt,Mt],Bd],rgba:[mn,[Mt,Mt,Mt,Mt],Bd],has:{type:Jt,overloads:[[[un],(a,[n])=>Rm(n.evaluate(a),a.properties())],[[un,Tn],(a,[n,s])=>Rm(n.evaluate(a),s.evaluate(a))]]},get:{type:Cn,overloads:[[[un],(a,[n])=>Fd(n.evaluate(a),a.properties())],[[un,Tn],(a,[n,s])=>Fd(n.evaluate(a),s.evaluate(a))]]},"feature-state":[Cn,[un],(a,[n])=>Fd(n.evaluate(a),a.featureState||{})],properties:[Tn,[],a=>a.properties()],"geometry-type":[un,[],a=>a.geometryType()],id:[Cn,[],a=>a.id()],zoom:[Mt,[],a=>a.globals.zoom],pitch:[Mt,[],a=>a.globals.pitch||0],"distance-from-center":[Mt,[],a=>a.distanceFromCenter()],"heatmap-density":[Mt,[],a=>a.globals.heatmapDensity||0],"line-progress":[Mt,[],a=>a.globals.lineProgress||0],"sky-radial-progress":[Mt,[],a=>a.globals.skyRadialProgress||0],accumulated:[Cn,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[Mt,aa(Mt),(a,n)=>{let s=0;for(const c of n)s+=c.evaluate(a);return s}],"*":[Mt,aa(Mt),(a,n)=>{let s=1;for(const c of n)s*=c.evaluate(a);return s}],"-":{type:Mt,overloads:[[[Mt,Mt],(a,[n,s])=>n.evaluate(a)-s.evaluate(a)],[[Mt],(a,[n])=>-n.evaluate(a)]]},"/":[Mt,[Mt,Mt],(a,[n,s])=>n.evaluate(a)/s.evaluate(a)],"%":[Mt,[Mt,Mt],(a,[n,s])=>n.evaluate(a)%s.evaluate(a)],ln2:[Mt,[],()=>Math.LN2],pi:[Mt,[],()=>Math.PI],e:[Mt,[],()=>Math.E],"^":[Mt,[Mt,Mt],(a,[n,s])=>Math.pow(n.evaluate(a),s.evaluate(a))],sqrt:[Mt,[Mt],(a,[n])=>Math.sqrt(n.evaluate(a))],log10:[Mt,[Mt],(a,[n])=>Math.log(n.evaluate(a))/Math.LN10],ln:[Mt,[Mt],(a,[n])=>Math.log(n.evaluate(a))],log2:[Mt,[Mt],(a,[n])=>Math.log(n.evaluate(a))/Math.LN2],sin:[Mt,[Mt],(a,[n])=>Math.sin(n.evaluate(a))],cos:[Mt,[Mt],(a,[n])=>Math.cos(n.evaluate(a))],tan:[Mt,[Mt],(a,[n])=>Math.tan(n.evaluate(a))],asin:[Mt,[Mt],(a,[n])=>Math.asin(n.evaluate(a))],acos:[Mt,[Mt],(a,[n])=>Math.acos(n.evaluate(a))],atan:[Mt,[Mt],(a,[n])=>Math.atan(n.evaluate(a))],min:[Mt,aa(Mt),(a,n)=>Math.min(...n.map(s=>s.evaluate(a)))],max:[Mt,aa(Mt),(a,n)=>Math.max(...n.map(s=>s.evaluate(a)))],abs:[Mt,[Mt],(a,[n])=>Math.abs(n.evaluate(a))],round:[Mt,[Mt],(a,[n])=>{const s=n.evaluate(a);return s<0?-Math.round(-s):Math.round(s)}],floor:[Mt,[Mt],(a,[n])=>Math.floor(n.evaluate(a))],ceil:[Mt,[Mt],(a,[n])=>Math.ceil(n.evaluate(a))],"filter-==":[Jt,[un,Cn],(a,[n,s])=>a.properties()[n.value]===s.value],"filter-id-==":[Jt,[Cn],(a,[n])=>a.id()===n.value],"filter-type-==":[Jt,[un],(a,[n])=>a.geometryType()===n.value],"filter-<":[Jt,[un,Cn],(a,[n,s])=>{const c=a.properties()[n.value],p=s.value;return typeof c==typeof p&&c<p}],"filter-id-<":[Jt,[Cn],(a,[n])=>{const s=a.id(),c=n.value;return typeof s==typeof c&&s<c}],"filter->":[Jt,[un,Cn],(a,[n,s])=>{const c=a.properties()[n.value],p=s.value;return typeof c==typeof p&&c>p}],"filter-id->":[Jt,[Cn],(a,[n])=>{const s=a.id(),c=n.value;return typeof s==typeof c&&s>c}],"filter-<=":[Jt,[un,Cn],(a,[n,s])=>{const c=a.properties()[n.value],p=s.value;return typeof c==typeof p&&c<=p}],"filter-id-<=":[Jt,[Cn],(a,[n])=>{const s=a.id(),c=n.value;return typeof s==typeof c&&s<=c}],"filter->=":[Jt,[un,Cn],(a,[n,s])=>{const c=a.properties()[n.value],p=s.value;return typeof c==typeof p&&c>=p}],"filter-id->=":[Jt,[Cn],(a,[n])=>{const s=a.id(),c=n.value;return typeof s==typeof c&&s>=c}],"filter-has":[Jt,[Cn],(a,[n])=>n.value in a.properties()],"filter-has-id":[Jt,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[Jt,[li(un)],(a,[n])=>n.value.indexOf(a.geometryType())>=0],"filter-id-in":[Jt,[li(Cn)],(a,[n])=>n.value.indexOf(a.id())>=0],"filter-in-small":[Jt,[un,li(Cn)],(a,[n,s])=>s.value.indexOf(a.properties()[n.value])>=0],"filter-in-large":[Jt,[un,li(Cn)],(a,[n,s])=>function(c,p,g,_){for(;g<=_;){const x=g+_>>1;if(p[x]===c)return!0;p[x]>c?_=x-1:g=x+1}return!1}(a.properties()[n.value],s.value,0,s.value.length-1)],all:{type:Jt,overloads:[[[Jt,Jt],(a,[n,s])=>n.evaluate(a)&&s.evaluate(a)],[aa(Jt),(a,n)=>{for(const s of n)if(!s.evaluate(a))return!1;return!0}]]},any:{type:Jt,overloads:[[[Jt,Jt],(a,[n,s])=>n.evaluate(a)||s.evaluate(a)],[aa(Jt),(a,n)=>{for(const s of n)if(s.evaluate(a))return!0;return!1}]]},"!":[Jt,[Jt],(a,[n])=>!n.evaluate(a)],"is-supported-script":[Jt,[un],(a,[n])=>{const s=a.globals&&a.globals.isSupportedScript;return!s||s(n.evaluate(a))}],upcase:[un,[un],(a,[n])=>n.evaluate(a).toUpperCase()],downcase:[un,[un],(a,[n])=>n.evaluate(a).toLowerCase()],concat:[un,aa(Cn),(a,n)=>n.map(s=>ko(s.evaluate(a))).join("")],"resolved-locale":[un,[di],(a,[n])=>n.evaluate(a).resolvedLocale()]});class Eu{constructor(n,s){this.expression=n,this._warningHistory={},this._evaluator=new vm,this._defaultValue=s?function(c){return c.type==="color"&&Ha(c.default)?new Zn(0,0,0,0):c.type==="color"?Zn.parse(c.default)||null:c.default===void 0?null:c.default}(s):null,this._enumValues=s&&s.type==="enum"?s.values:null}evaluateWithoutErrorHandling(n,s,c,p,g,_,x,C){return this._evaluator.globals=n,this._evaluator.feature=s,this._evaluator.featureState=c,this._evaluator.canonical=p||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=C||null,this.expression.evaluate(this._evaluator)}evaluate(n,s,c,p,g,_,x,C){this._evaluator.globals=n,this._evaluator.feature=s||null,this._evaluator.featureState=c||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=C||null;try{const S=this.expression.evaluate(this._evaluator);if(S==null||typeof S=="number"&&S!=S)return this._defaultValue;if(this._enumValues&&!(S in this._enumValues))throw new Qi(`Expected value to be one of ${Object.keys(this._enumValues).map(R=>JSON.stringify(R)).join(", ")}, but found ${JSON.stringify(S)} instead.`);return S}catch(S){return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console!="undefined"&&console.warn(S.message)),this._defaultValue}}}function Ss(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Va}function Pl(a,n){const s=new ra(Va,[],n?function(p){const g={color:mn,string:un,number:Mt,enum:un,boolean:Jt,formatted:Ar,resolvedImage:oi};return p.type==="array"?li(g[p.value]||Cn,p.length):g[p.type]}(n):void 0),c=s.parse(a,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return c?Od(new Eu(c,n)):Ga(s.errors)}class Gd{constructor(n,s){this.kind=n,this._styleExpression=s,this.isStateDependent=n!=="constant"&&!bl(s.expression)}evaluateWithoutErrorHandling(n,s,c,p,g,_){return this._styleExpression.evaluateWithoutErrorHandling(n,s,c,p,g,_)}evaluate(n,s,c,p,g,_){return this._styleExpression.evaluate(n,s,c,p,g,_)}}class Hd{constructor(n,s,c,p){this.kind=n,this.zoomStops=c,this._styleExpression=s,this.isStateDependent=n!=="camera"&&!bl(s.expression),this.interpolationType=p}evaluateWithoutErrorHandling(n,s,c,p,g,_){return this._styleExpression.evaluateWithoutErrorHandling(n,s,c,p,g,_)}evaluate(n,s,c,p,g,_){return this._styleExpression.evaluate(n,s,c,p,g,_)}interpolationFactor(n,s,c){return this.interpolationType?Pr.interpolationFactor(this.interpolationType,n,s,c):0}}function Fm(a,n){if((a=Pl(a,n)).result==="error")return a;const s=a.value.expression,c=gr(s);if(!c&&!As(n))return Ga([new rn("","data expressions not supported")]);const p=wl(s,["zoom","pitch","distance-from-center"]);if(!p&&!zm(n))return Ga([new rn("","zoom expressions not supported")]);const g=Au(s);return g||p?g instanceof rn?Ga([g]):g instanceof Pr&&!Nd(n)?Ga([new rn("",'"interpolate" expressions cannot be used with this property')]):Od(g?new Hd(c?"camera":"composite",a.value,g.labels,g instanceof Pr?g.interpolation:void 0):new Gd(c?"constant":"source",a.value)):Ga([new rn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Cu{constructor(n,s){this._parameters=n,this._specification=s,Tt(this,Ud(this._parameters,this._specification))}static deserialize(n){return new Cu(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function Au(a){let n=null;if(a instanceof Sl)n=Au(a.result);else if(a instanceof Al){for(const s of a.args)if(n=Au(s),n)break}else(a instanceof Tl||a instanceof Pr)&&a.input instanceof Dr&&a.input.name==="zoom"&&(n=a);return n instanceof rn||a.eachChild(s=>{const c=Au(s);c instanceof rn?n=c:!n&&c?n=new rn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&c&&n!==c&&(n=new rn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}class Wt{constructor(n,s,c,p){this.message=(n?`${n}: `:"")+c,p&&(this.identifier=p),s!=null&&s.__line__&&(this.line=s.__line__)}}function jr(a){const n=a.key,s=a.value,c=a.valueSpec||{},p=a.objectElementValidators||{},g=a.style,_=a.styleSpec;let x=[];const C=Qn(s);if(C!=="object")return[new Wt(n,s,`object expected, ${C} found`)];for(const S in s){const R=S.split(".")[0],B=c[R]||c["*"];let N;p[R]?N=p[R]:c[R]?N=ji:p["*"]?N=p["*"]:c["*"]&&(N=ji),N?x=x.concat(N({key:(n&&`${n}.`)+S,value:s[S],valueSpec:B,style:g,styleSpec:_,object:s,objectKey:S},s)):x.push(new Wt(n,s[S],`unknown property "${S}"`))}for(const S in c)p[S]||c[S].required&&c[S].default===void 0&&s[S]===void 0&&x.push(new Wt(n,s,`missing required property "${S}"`));return x}function Ll(a){const n=a.value,s=a.valueSpec,c=a.style,p=a.styleSpec,g=a.key,_=a.arrayElementValidator||ji;if(Qn(n)!=="array")return[new Wt(g,n,`array expected, ${Qn(n)} found`)];if(s.length&&n.length!==s.length)return[new Wt(g,n,`array length ${s.length} expected, length ${n.length} found`)];if(s["min-length"]&&n.length<s["min-length"])return[new Wt(g,n,`array length at least ${s["min-length"]} expected, length ${n.length} found`)];let x={type:s.value,values:s.values,minimum:s.minimum,maximum:s.maximum,function:void 0};p.$version<7&&(x.function=s.function),Qn(s.value)==="object"&&(x=s.value);let C=[];for(let S=0;S<n.length;S++)C=C.concat(_({array:n,arrayIndex:S,value:n[S],valueSpec:x,style:c,styleSpec:p,key:`${g}[${S}]`}));return C}function Om(a){const n=a.key,s=a.value,c=a.valueSpec;let p=Qn(s);if(p==="number"&&s!=s&&(p="NaN"),p!=="number")return[new Wt(n,s,`number expected, ${p} found`)];if("minimum"in c){let g=c.minimum;if(Qn(c.minimum)==="array"&&(g=c.minimum[a.arrayIndex]),s<g)return[new Wt(n,s,`${s} is less than the minimum value ${g}`)]}if("maximum"in c){let g=c.maximum;if(Qn(c.maximum)==="array"&&(g=c.maximum[a.arrayIndex]),s>g)return[new Wt(n,s,`${s} is greater than the maximum value ${g}`)]}return[]}function Nm(a){const n=a.valueSpec,s=_t(a.value.type);let c,p,g,_={};const x=s!=="categorical"&&a.value.property===void 0,C=!x,S=Qn(a.value.stops)==="array"&&Qn(a.value.stops[0])==="array"&&Qn(a.value.stops[0][0])==="object",R=jr({key:a.key,value:a.value,valueSpec:a.styleSpec.function,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(H){if(s==="identity")return[new Wt(H.key,H.value,'identity function may not have a "stops" property')];let Z=[];const Q=H.value;return Z=Z.concat(Ll({key:H.key,value:Q,valueSpec:H.valueSpec,style:H.style,styleSpec:H.styleSpec,arrayElementValidator:B})),Qn(Q)==="array"&&Q.length===0&&Z.push(new Wt(H.key,Q,"array must have at least one stop")),Z},default:function(H){return ji({key:H.key,value:H.value,valueSpec:n,style:H.style,styleSpec:H.styleSpec})}}});return s==="identity"&&x&&R.push(new Wt(a.key,a.value,'missing required property "property"')),s==="identity"||a.value.stops||R.push(new Wt(a.key,a.value,'missing required property "stops"')),s==="exponential"&&a.valueSpec.expression&&!Nd(a.valueSpec)&&R.push(new Wt(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(C&&!As(a.valueSpec)?R.push(new Wt(a.key,a.value,"property functions not supported")):x&&!zm(a.valueSpec)&&R.push(new Wt(a.key,a.value,"zoom functions not supported"))),s!=="categorical"&&!S||a.value.property!==void 0||R.push(new Wt(a.key,a.value,'"property" property is required')),R;function B(H){let Z=[];const Q=H.value,le=H.key;if(Qn(Q)!=="array")return[new Wt(le,Q,`array expected, ${Qn(Q)} found`)];if(Q.length!==2)return[new Wt(le,Q,`array length 2 expected, length ${Q.length} found`)];if(S){if(Qn(Q[0])!=="object")return[new Wt(le,Q,`object expected, ${Qn(Q[0])} found`)];if(Q[0].zoom===void 0)return[new Wt(le,Q,"object stop key must have zoom")];if(Q[0].value===void 0)return[new Wt(le,Q,"object stop key must have value")];const ve=_t(Q[0].zoom);if(typeof ve!="number")return[new Wt(le,Q[0].zoom,"stop zoom values must be numbers")];if(g&&g>ve)return[new Wt(le,Q[0].zoom,"stop zoom values must appear in ascending order")];ve!==g&&(g=ve,p=void 0,_={}),Z=Z.concat(jr({key:`${le}[0]`,value:Q[0],valueSpec:{zoom:{}},style:H.style,styleSpec:H.styleSpec,objectElementValidators:{zoom:Om,value:N}}))}else Z=Z.concat(N({key:`${le}[0]`,value:Q[0],valueSpec:{},style:H.style,styleSpec:H.styleSpec},Q));return Ss(Ot(Q[1]))?Z.concat([new Wt(`${le}[1]`,Q[1],"expressions are not allowed in function stops.")]):Z.concat(ji({key:`${le}[1]`,value:Q[1],valueSpec:n,style:H.style,styleSpec:H.styleSpec}))}function N(H,Z){const Q=Qn(H.value),le=_t(H.value),ve=H.value!==null?H.value:Z;if(c){if(Q!==c)return[new Wt(H.key,ve,`${Q} stop domain type must match previous stop domain type ${c}`)]}else c=Q;if(Q!=="number"&&Q!=="string"&&Q!=="boolean"&&typeof le!="number"&&typeof le!="string"&&typeof le!="boolean")return[new Wt(H.key,ve,"stop domain value must be a number, string, or boolean")];if(Q!=="number"&&s!=="categorical"){let Fe=`number expected, ${Q} found`;return As(n)&&s===void 0&&(Fe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Wt(H.key,ve,Fe)]}return s!=="categorical"||Q!=="number"||typeof le=="number"&&isFinite(le)&&Math.floor(le)===le?s!=="categorical"&&Q==="number"&&typeof le=="number"&&typeof p=="number"&&p!==void 0&&le<p?[new Wt(H.key,ve,"stop domain values must appear in ascending order")]:(p=le,s==="categorical"&&le in _?[new Wt(H.key,ve,"stop domain values must be unique")]:(_[le]=!0,[])):[new Wt(H.key,ve,`integer expected, found ${String(le)}`)]}}function Ds(a){const n=(a.expressionContext==="property"?Fm:Pl)(Ot(a.value),a.valueSpec);if(n.result==="error")return n.value.map(c=>new Wt(`${a.key}${c.key}`,a.value,c.message));const s=n.value.expression||n.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!s.outputDefined())return[new Wt(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!bl(s))return[new Wt(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter")return Fo(s,a);if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!wl(s,["zoom","feature-state"]))return[new Wt(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!gr(s))return[new Wt(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Fo(a,n){const s=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(n.valueSpec&&n.valueSpec.expression)for(const p of n.valueSpec.expression.parameters)s.delete(p);if(s.size===0)return[];const c=[];return a instanceof Dr&&s.has(a.name)?[new Wt(n.key,n.value,`["${a.name}"] expression is not supported in a filter for a ${n.object.type} layer with id: ${n.object.id}`)]:(a.eachChild(p=>{c.push(...Fo(p,n))}),c)}function Il(a){const n=a.key,s=a.value,c=a.valueSpec,p=[];return Array.isArray(c.values)?c.values.indexOf(_t(s))===-1&&p.push(new Wt(n,s,`expected one of [${c.values.join(", ")}], ${JSON.stringify(s)} found`)):Object.keys(c.values).indexOf(_t(s))===-1&&p.push(new Wt(n,s,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(s)} found`)),p}function sa(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const n of a.slice(1))if(!sa(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}function la(a,n="fill"){if(a==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};sa(a)||(a=Rl(a));const s=a;let c=!0;try{c=function(S){if(!ca(S))return S;let R=Ot(S);return Um(R),R=Wd(R),R}(s)}catch(S){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(s,null,2)}
        `)}const p=Me[`filter_${n}`],g=Pl(c,p);let _=null;if(g.result==="error")throw new Error(g.value.map(S=>`${S.key}: ${S.message}`).join(", "));_=(S,R,B)=>g.value.evaluate(S,R,{},B);let x=null,C=null;if(c!==s){const S=Pl(s,p);if(S.result==="error")throw new Error(S.value.map(R=>`${R.key}: ${R.message}`).join(", "));x=(R,B,N,H,Z)=>S.value.evaluate(R,B,{},N,void 0,void 0,H,Z),C=!gr(S.value.expression)}return _=_,{filter:_,dynamicFilter:x||void 0,needGeometry:Su(c),needFeature:!!C}}function Wd(a){if(!Array.isArray(a))return a;const n=function(s){if(Vm.has(s[0])){for(let c=1;c<s.length;c++)if(ca(s[c]))return!0}return s}(a);return n===!0?n:n.map(s=>Wd(s))}function Um(a){let n=!1;const s=[];if(a[0]==="case"){for(let c=1;c<a.length-1;c+=2)n=n||ca(a[c]),s.push(a[c+1]);s.push(a[a.length-1])}else if(a[0]==="match"){n=n||ca(a[1]);for(let c=2;c<a.length-1;c+=2)s.push(a[c+1]);s.push(a[a.length-1])}else if(a[0]==="step"){n=n||ca(a[1]);for(let c=1;c<a.length-1;c+=2)s.push(a[c+1])}n&&(a.length=0,a.push("any",...s));for(let c=1;c<a.length;c++)Um(a[c])}function ca(a){if(!Array.isArray(a))return!1;if((n=a[0])==="pitch"||n==="distance-from-center")return!0;var n;for(let s=1;s<a.length;s++)if(ca(a[s]))return!0;return!1}const Vm=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function jd(a,n){return a<n?-1:a>n?1:0}function Su(a){if(!Array.isArray(a))return!1;if(a[0]==="within")return!0;for(let n=1;n<a.length;n++)if(Su(a[n]))return!0;return!1}function Rl(a){if(!a)return!0;const n=a[0];return a.length<=1?n!=="any":n==="=="?zl(a[1],a[2],"=="):n==="!="?kl(zl(a[1],a[2],"==")):n==="<"||n===">"||n==="<="||n===">="?zl(a[1],a[2],n):n==="any"?(s=a.slice(1),["any"].concat(s.map(Rl))):n==="all"?["all"].concat(a.slice(1).map(Rl)):n==="none"?["all"].concat(a.slice(1).map(Rl).map(kl)):n==="in"?$d(a[1],a.slice(2)):n==="!in"?kl($d(a[1],a.slice(2))):n==="has"?qd(a[1]):n==="!has"?kl(qd(a[1])):n!=="within"||a;var s}function zl(a,n,s){switch(a){case"$type":return[`filter-type-${s}`,n];case"$id":return[`filter-id-${s}`,n];default:return[`filter-${s}`,a,n]}}function $d(a,n){if(n.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(s=>typeof s!=typeof n[0])?["filter-in-large",a,["literal",n.sort(jd)]]:["filter-in-small",a,["literal",n]]}}function qd(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function kl(a){return["!",a]}function ua(a){return sa(Ot(a.value))?Ds(Tt({},a,{expressionContext:"filter",valueSpec:a.styleSpec[`filter_${a.layerType||"fill"}`]})):Zd(a)}function Zd(a){const n=a.value,s=a.key;if(Qn(n)!=="array")return[new Wt(s,n,`array expected, ${Qn(n)} found`)];const c=a.styleSpec;let p,g=[];if(n.length<1)return[new Wt(s,n,"filter array must have at least 1 element")];switch(g=g.concat(Il({key:`${s}[0]`,value:n[0],valueSpec:c.filter_operator,style:a.style,styleSpec:a.styleSpec})),_t(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&_t(n[1])==="$type"&&g.push(new Wt(s,n,`"$type" cannot be use with operator "${n[0]}"`));case"==":case"!=":n.length!==3&&g.push(new Wt(s,n,`filter array for operator "${n[0]}" must have 3 elements`));case"in":case"!in":n.length>=2&&(p=Qn(n[1]),p!=="string"&&g.push(new Wt(`${s}[1]`,n[1],`string expected, ${p} found`)));for(let _=2;_<n.length;_++)p=Qn(n[_]),_t(n[1])==="$type"?g=g.concat(Il({key:`${s}[${_}]`,value:n[_],valueSpec:c.geometry_type,style:a.style,styleSpec:a.styleSpec})):p!=="string"&&p!=="number"&&p!=="boolean"&&g.push(new Wt(`${s}[${_}]`,n[_],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let _=1;_<n.length;_++)g=g.concat(Zd({key:`${s}[${_}]`,value:n[_],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":p=Qn(n[1]),n.length!==2?g.push(new Wt(s,n,`filter array for "${n[0]}" operator must have 2 elements`)):p!=="string"&&g.push(new Wt(`${s}[1]`,n[1],`string expected, ${p} found`));break;case"within":p=Qn(n[1]),n.length!==2?g.push(new Wt(s,n,`filter array for "${n[0]}" operator must have 2 elements`)):p!=="object"&&g.push(new Wt(`${s}[1]`,n[1],`object expected, ${p} found`))}return g}function Xd(a,n){const s=a.key,c=a.style,p=a.styleSpec,g=a.value,_=a.objectKey,x=p[`${n}_${a.layerType}`];if(!x)return[];const C=_.match(/^(.*)-transition$/);if(n==="paint"&&C&&x[C[1]]&&x[C[1]].transition)return ji({key:s,value:g,valueSpec:p.transition,style:c,styleSpec:p});const S=a.valueSpec||x[_];if(!S)return[new Wt(s,g,`unknown property "${_}"`)];let R;if(Qn(g)==="string"&&As(S)&&!S.tokens&&(R=/^{([^}]+)}$/.exec(g)))return[new Wt(s,g,`"${_}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(R[1])} }\`.`)];const B=[];return a.layerType==="symbol"&&(_==="text-field"&&c&&!c.glyphs&&B.push(new Wt(s,g,'use of "text-field" requires a style "glyphs" property')),_==="text-font"&&Ha(Ot(g))&&_t(g.type)==="identity"&&B.push(new Wt(s,g,'"text-font" does not support identity functions'))),B.concat(ji({key:a.key,value:g,valueSpec:S,style:c,styleSpec:p,expressionContext:"property",propertyType:n,propertyKey:_}))}function Du(a){return Xd(a,"paint")}function Yd(a){return Xd(a,"layout")}function Gm(a){let n=[];const s=a.value,c=a.key,p=a.style,g=a.styleSpec;s.type||s.ref||n.push(new Wt(c,s,'either "type" or "ref" is required'));let _=_t(s.type);const x=_t(s.ref);if(s.id){const C=_t(s.id);for(let S=0;S<a.arrayIndex;S++){const R=p.layers[S];_t(R.id)===C&&n.push(new Wt(c,s.id,`duplicate layer id "${s.id}", previously used at line ${R.id.__line__}`))}}if("ref"in s){let C;["type","source","source-layer","filter","layout"].forEach(S=>{S in s&&n.push(new Wt(c,s[S],`"${S}" is prohibited for ref layers`))}),p.layers.forEach(S=>{_t(S.id)===x&&(C=S)}),C?C.ref?n.push(new Wt(c,s.ref,"ref cannot reference another ref layer")):_=_t(C.type):typeof x=="string"&&n.push(new Wt(c,s.ref,`ref layer "${x}" not found`))}else if(_!=="background"&&_!=="sky")if(s.source){const C=p.sources&&p.sources[s.source],S=C&&_t(C.type);C?S==="vector"&&_==="raster"?n.push(new Wt(c,s.source,`layer "${s.id}" requires a raster source`)):S==="raster"&&_!=="raster"?n.push(new Wt(c,s.source,`layer "${s.id}" requires a vector source`)):S!=="vector"||s["source-layer"]?S==="raster-dem"&&_!=="hillshade"?n.push(new Wt(c,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):_!=="line"||!s.paint||!s.paint["line-gradient"]||S==="geojson"&&C.lineMetrics||n.push(new Wt(c,s,`layer "${s.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):n.push(new Wt(c,s,`layer "${s.id}" must specify a "source-layer"`)):n.push(new Wt(c,s.source,`source "${s.source}" not found`))}else n.push(new Wt(c,s,'missing required property "source"'));return n=n.concat(jr({key:c,value:s,valueSpec:g.layer,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ji({key:`${c}.type`,value:s.type,valueSpec:g.layer.type,style:a.style,styleSpec:a.styleSpec,object:s,objectKey:"type"}),filter:C=>ua(Tt({layerType:_},C)),layout:C=>jr({layer:s,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":S=>Yd(Tt({layerType:_},S))}}),paint:C=>jr({layer:s,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":S=>Du(Tt({layerType:_},S))}})}})),n}function Oo(a){const n=a.value,s=a.key,c=Qn(n);return c!=="string"?[new Wt(s,n,`string expected, ${c} found`)]:[]}const Hm={promoteId:function({key:a,value:n}){if(Qn(n)==="string")return Oo({key:a,value:n});{const s=[];for(const c in n)s.push(...Oo({key:`${a}.${c}`,value:n[c]}));return s}}};function Wm(a){const n=a.value,s=a.key,c=a.styleSpec,p=a.style;if(!n.type)return[new Wt(s,n,'"type" is required')];const g=_t(n.type);let _;switch(g){case"vector":case"raster":case"raster-dem":return _=jr({key:s,value:n,valueSpec:c[`source_${g.replace("-","_")}`],style:a.style,styleSpec:c,objectElementValidators:Hm}),_;case"geojson":if(_=jr({key:s,value:n,valueSpec:c.source_geojson,style:p,styleSpec:c,objectElementValidators:Hm}),n.cluster)for(const x in n.clusterProperties){const[C,S]=n.clusterProperties[x],R=typeof C=="string"?[C,["accumulated"],["get",x]]:C;_.push(...Ds({key:`${s}.${x}.map`,value:S,expressionContext:"cluster-map"})),_.push(...Ds({key:`${s}.${x}.reduce`,value:R,expressionContext:"cluster-reduce"}))}return _;case"video":return jr({key:s,value:n,valueSpec:c.source_video,style:p,styleSpec:c});case"image":return jr({key:s,value:n,valueSpec:c.source_image,style:p,styleSpec:c});case"canvas":return[new Wt(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Il({key:`${s}.type`,value:n.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:p,styleSpec:c})}}function jm(a){const n=a.value,s=a.styleSpec,c=s.light,p=a.style;let g=[];const _=Qn(n);if(n===void 0)return g;if(_!=="object")return g=g.concat([new Wt("light",n,`object expected, ${_} found`)]),g;for(const x in n){const C=x.match(/^(.*)-transition$/);g=g.concat(C&&c[C[1]]&&c[C[1]].transition?ji({key:x,value:n[x],valueSpec:s.transition,style:p,styleSpec:s}):c[x]?ji({key:x,value:n[x],valueSpec:c[x],style:p,styleSpec:s}):[new Wt(x,n[x],`unknown property "${x}"`)])}return g}function $m(a){const n=a.value,s=a.key,c=a.style,p=a.styleSpec,g=p.terrain;let _=[];const x=Qn(n);if(n===void 0)return _;if(x!=="object")return _=_.concat([new Wt("terrain",n,`object expected, ${x} found`)]),_;for(const C in n){const S=C.match(/^(.*)-transition$/);_=_.concat(S&&g[S[1]]&&g[S[1]].transition?ji({key:C,value:n[C],valueSpec:p.transition,style:c,styleSpec:p}):g[C]?ji({key:C,value:n[C],valueSpec:g[C],style:c,styleSpec:p}):[new Wt(C,n[C],`unknown property "${C}"`)])}if(n.source){const C=c.sources&&c.sources[n.source],S=C&&_t(C.type);C?S!=="raster-dem"&&_.push(new Wt(s,n.source,`terrain cannot be used with a source of type ${String(S)}, it only be used with a "raster-dem" source type`)):_.push(new Wt(s,n.source,`source "${n.source}" not found`))}else _.push(new Wt(s,n,'terrain is missing required property "source"'));return _}function qm(a){const n=a.value,s=a.style,c=a.styleSpec,p=c.fog;let g=[];const _=Qn(n);if(n===void 0)return g;if(_!=="object")return g=g.concat([new Wt("fog",n,`object expected, ${_} found`)]),g;for(const x in n){const C=x.match(/^(.*)-transition$/);g=g.concat(C&&p[C[1]]&&p[C[1]].transition?ji({key:x,value:n[x],valueSpec:c.transition,style:s,styleSpec:c}):p[x]?ji({key:x,value:n[x],valueSpec:p[x],style:s,styleSpec:c}):[new Wt(x,n[x],`unknown property "${x}"`)])}return g}const Bl={"*":()=>[],array:Ll,boolean:function(a){const n=a.value,s=a.key,c=Qn(n);return c!=="boolean"?[new Wt(s,n,`boolean expected, ${c} found`)]:[]},number:Om,color:function(a){const n=a.key,s=a.value,c=Qn(s);return c!=="string"?[new Wt(n,s,`color expected, ${c} found`)]:Md.parseCSSColor(s)===null?[new Wt(n,s,`color expected, "${s}" found`)]:[]},enum:Il,filter:ua,function:Nm,layer:Gm,object:jr,source:Wm,light:jm,terrain:$m,fog:qm,string:Oo,formatted:function(a){return Oo(a).length===0?[]:Ds(a)},resolvedImage:function(a){return Oo(a).length===0?[]:Ds(a)},projection:function(a){const n=a.value,s=a.styleSpec,c=s.projection,p=a.style;let g=[];const _=Qn(n);if(_==="object")for(const x in n)g=g.concat(ji({key:x,value:n[x],valueSpec:c[x],style:p,styleSpec:s}));else _!=="string"&&(g=g.concat([new Wt("projection",n,`object or string expected, ${_} found`)]));return g}};function ji(a){const n=a.value,s=a.valueSpec,c=a.styleSpec;return s.expression&&Ha(_t(n))?Nm(a):s.expression&&Ss(Ot(n))?Ds(a):s.type&&Bl[s.type]?Bl[s.type](a):jr(Tt({},a,{valueSpec:s.type?c[s.type]:s}))}function Lr(a){const n=a.value,s=a.key,c=Oo(a);return c.length||(n.indexOf("{fontstack}")===-1&&c.push(new Wt(s,n,'"glyphs" url must include a "{fontstack}" token')),n.indexOf("{range}")===-1&&c.push(new Wt(s,n,'"glyphs" url must include a "{range}" token'))),c}function Fl(a,n=Me){return No(ji({key:"",value:a,valueSpec:n.$root,styleSpec:n,style:a,objectElementValidators:{glyphs:Lr,"*":()=>[]}}))}const Z_=a=>No(Du(a)),X_=a=>No(Yd(a));function No(a){return a.slice().sort((n,s)=>n.line&&s.line?n.line-s.line:0)}function Zm(a,n){let s=!1;if(n&&n.length)for(const c of n)a.fire(new K(new Error(c.message))),s=!0;return s}var ha=Mo;function Mo(a,n,s){var c=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var p=new Int32Array(this.arrayBuffer);a=p[0],this.d=(n=p[1])+2*(s=p[2]);for(var g=0;g<this.d*this.d;g++){var _=p[3+g],x=p[3+g+1];c.push(_===x?null:p.subarray(_,x))}var C=p[3+c.length+1];this.keys=p.subarray(p[3+c.length],C),this.bboxes=p.subarray(C),this.insert=this._insertReadonly}else{this.d=n+2*s;for(var S=0;S<this.d*this.d;S++)c.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=a,this.padding=s,this.scale=n/a,this.uid=0;var R=s/n*a;this.min=-R,this.max=a+R}Mo.prototype.insert=function(a,n,s,c,p){this._forEachCell(n,s,c,p,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(n),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(p)},Mo.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Mo.prototype._insertCell=function(a,n,s,c,p,g){this.cells[p].push(g)},Mo.prototype.query=function(a,n,s,c,p){var g=this.min,_=this.max;if(a<=g&&n<=g&&_<=s&&_<=c&&!p)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(a,n,s,c,this._queryCell,x,{},p),x},Mo.prototype._queryCell=function(a,n,s,c,p,g,_,x){var C=this.cells[p];if(C!==null)for(var S=this.keys,R=this.bboxes,B=0;B<C.length;B++){var N=C[B];if(_[N]===void 0){var H=4*N;(x?x(R[H+0],R[H+1],R[H+2],R[H+3]):a<=R[H+2]&&n<=R[H+3]&&s>=R[H+0]&&c>=R[H+1])?(_[N]=!0,g.push(S[N])):_[N]=!1}}},Mo.prototype._forEachCell=function(a,n,s,c,p,g,_,x){for(var C=this._convertToCellCoord(a),S=this._convertToCellCoord(n),R=this._convertToCellCoord(s),B=this._convertToCellCoord(c),N=C;N<=R;N++)for(var H=S;H<=B;H++){var Z=this.d*H+N;if((!x||x(this._convertFromCellCoord(N),this._convertFromCellCoord(H),this._convertFromCellCoord(N+1),this._convertFromCellCoord(H+1)))&&p.call(this,a,n,s,c,Z,g,_,x))return}},Mo.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},Mo.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},Mo.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,n=3+this.cells.length+1+1,s=0,c=0;c<this.cells.length;c++)s+=this.cells[c].length;var p=new Int32Array(n+s+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var g=n,_=0;_<a.length;_++){var x=a[_];p[3+_]=g,p.set(x,g),g+=x.length}return p[3+a.length]=g,p.set(this.keys,g),p[3+a.length+1]=g+=this.keys.length,p.set(this.bboxes,g),g+=this.bboxes.length,p.buffer};const Ps={};function $t(a,n,s={}){Object.defineProperty(a,"_classRegistryKey",{value:n,writeable:!1}),Ps[n]={klass:a,omit:s.omit||[]}}$t(Object,"Object"),ha.serialize=function(a,n){const s=a.toArrayBuffer();return n&&n.push(s),{buffer:s}},ha.deserialize=function(a){return new ha(a.buffer)},Object.defineProperty(ha,"name",{value:"Grid"}),$t(ha,"Grid"),$t(Zn,"Color"),$t(Error,"Error"),$t(W,"AJAXError"),$t(Sr,"ResolvedImage"),$t(Cu,"StylePropertyFunction"),$t(Eu,"StyleExpression",{omit:["_evaluator"]}),$t(Hd,"ZoomDependentExpression"),$t(Gd,"ZoomConstantExpression"),$t(Dr,"CompoundExpression",{omit:["_evaluate"]});for(const a in Va)Ps[Va[a]._classRegistryKey]||$t(Va[a],`Expression${a}`);function Xm(a){return a&&typeof ArrayBuffer!="undefined"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function Pu(a){return L.ImageBitmap&&a instanceof L.ImageBitmap}function Ol(a,n){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(Xm(a)||Pu(a))return n&&n.push(a),a;if(ArrayBuffer.isView(a)){const s=a;return n&&n.push(s.buffer),s}if(a instanceof L.ImageData)return n&&n.push(a.data.buffer),a;if(Array.isArray(a)){const s=[];for(const c of a)s.push(Ol(c,n));return s}if(typeof a=="object"){const s=a.constructor,c=s._classRegistryKey;if(!c)throw new Error(`can't serialize object of unregistered class ${c}`);const p=s.serialize?s.serialize(a,n):{};if(!s.serialize){for(const g in a)a.hasOwnProperty(g)&&(Ps[c].omit.indexOf(g)>=0||(p[g]=Ol(a[g],n)));a instanceof Error&&(p.message=a.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return c!=="Object"&&(p.$name=c),p}throw new Error("can't serialize object of type "+typeof a)}function Ls(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||Xm(a)||Pu(a)||ArrayBuffer.isView(a)||a instanceof L.ImageData)return a;if(Array.isArray(a))return a.map(Ls);if(typeof a=="object"){const n=a.$name||"Object",{klass:s}=Ps[n];if(!s)throw new Error(`can't deserialize unregistered class ${n}`);if(s.deserialize)return s.deserialize(a);const c=Object.create(s.prototype);for(const p of Object.keys(a))p!=="$name"&&(c[p]=Ls(a[p]));return c}throw new Error("can't deserialize object of type "+typeof a)}class Jd{constructor(){this.first=!0}update(n,s){const c=Math.floor(n);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=n,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=s):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=s),n!==this.lastZoom&&(this.lastZoom=n,this.lastFloorZoom=c,!0))}}const Ym=a=>a>=1536&&a<=1791,Lu=a=>a>=1872&&a<=1919,Nl=a=>a>=2208&&a<=2303,Kd=a=>a>=11904&&a<=12031,Jm=a=>a>=12032&&a<=12255,Qd=a=>a>=12272&&a<=12287,Iu=a=>a>=12288&&a<=12351,Ul=a=>a>=12352&&a<=12447,Ru=a=>a>=12448&&a<=12543,Km=a=>a>=12544&&a<=12591,Qm=a=>a>=12704&&a<=12735,eg=a=>a>=12736&&a<=12783,ep=a=>a>=12784&&a<=12799,tg=a=>a>=12800&&a<=13055,ng=a=>a>=13056&&a<=13311,ig=a=>a>=13312&&a<=19903,tp=a=>a>=19968&&a<=40959,rg=a=>a>=40960&&a<=42127,og=a=>a>=42128&&a<=42191,ag=a=>a>=44032&&a<=55215,Vl=a=>a>=63744&&a<=64255,np=a=>a>=64336&&a<=65023,sg=a=>a>=65040&&a<=65055,Is=a=>a>=65072&&a<=65103,lg=a=>a>=65104&&a<=65135,zu=a=>a>=65136&&a<=65279,ip=a=>a>=65280&&a<=65519;function ku(a){for(const n of a)if(Bu(n.charCodeAt(0)))return!0;return!1}function Y_(a){for(const n of a)if(!cg(n.charCodeAt(0)))return!1;return!0}function cg(a){return!(Ym(a)||Lu(a)||Nl(a)||np(a)||zu(a))}function Bu(a){return!(a!==746&&a!==747&&(a<4352||!(Qm(a)||Km(a)||Is(a)&&!(a>=65097&&a<=65103)||Vl(a)||ng(a)||Kd(a)||eg(a)||!(!Iu(a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||ig(a)||tp(a)||tg(a)||(n=>n>=12592&&n<=12687)(a)||(n=>n>=43360&&n<=43391)(a)||(n=>n>=55216&&n<=55295)(a)||(n=>n>=4352&&n<=4607)(a)||ag(a)||Ul(a)||Qd(a)||(n=>n>=12688&&n<=12703)(a)||Jm(a)||ep(a)||Ru(a)&&a!==12540||!(!ip(a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!lg(a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||(n=>n>=5120&&n<=5759)(a)||(n=>n>=6320&&n<=6399)(a)||sg(a)||(n=>n>=19904&&n<=19967)(a)||rg(a)||og(a))))}function Fu(a){return!(Bu(a)||function(n){return!!((s=>s>=128&&s<=255)(n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||(s=>s>=8192&&s<=8303)(n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||(s=>s>=8448&&s<=8527)(n)||(s=>s>=8528&&s<=8591)(n)||(s=>s>=8960&&s<=9215)(n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||(s=>s>=9216&&s<=9279)(n)&&n!==9251||(s=>s>=9280&&s<=9311)(n)||(s=>s>=9312&&s<=9471)(n)||(s=>s>=9632&&s<=9727)(n)||(s=>s>=9728&&s<=9983)(n)&&!(n>=9754&&n<=9759)||(s=>s>=11008&&s<=11263)(n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||Iu(n)||Ru(n)||(s=>s>=57344&&s<=63743)(n)||Is(n)||lg(n)||ip(n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(a))}function Ou(a){return a>=1424&&a<=2303||np(a)||zu(a)}function J_(a,n){return!(!n&&Ou(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||(s=>s>=6016&&s<=6143)(a))}function K_(a){for(const n of a)if(Ou(n.charCodeAt(0)))return!0;return!1}const rp="deferred",Gl="loading",op="loaded";let ap=null,yr="unavailable",Ir=null;const Hl=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(yr="error"),ap&&ap(a)};function Wa(){sp.fire(new q("pluginStateChange",{pluginStatus:yr,pluginURL:Ir}))}const sp=new Be,Nu=function(){return yr},Rs=function(){if(yr!==rp||!Ir)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");yr=Gl,Wa(),Ir&&Re({url:Ir},a=>{a?Hl(a):(yr=op,Wa())})},$r={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>yr===op||$r.applyArabicShaping!=null,isLoading:()=>yr===Gl,setState(a){yr=a.pluginStatus,Ir=a.pluginURL},isParsed:()=>$r.applyArabicShaping!=null&&$r.processBidirectionalText!=null&&$r.processStyledBidirectionalText!=null,getPluginURL:()=>Ir};class ci{constructor(n,s){this.zoom=n,s?(this.now=s.now,this.fadeDuration=s.fadeDuration,this.zoomHistory=s.zoomHistory,this.transition=s.transition,this.pitch=s.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Jd,this.transition={},this.pitch=0)}isSupportedScript(n){return function(s,c){for(const p of s)if(!J_(p.charCodeAt(0),c))return!1;return!0}(n,$r.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const n=this.zoom,s=n-Math.floor(n),c=this.crossFadingFactor();return n>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:s+(1-s)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*s}}}class Wl{constructor(n,s){this.property=n,this.value=s,this.expression=function(c,p){if(Ha(c))return new Cu(c,p);if(Ss(c)){const g=Fm(c,p);if(g.result==="error")throw new Error(g.value.map(_=>`${_.key}: ${_.message}`).join(", "));return g.value}{let g=c;return typeof c=="string"&&p.type==="color"&&(g=Zn.parse(c)),{kind:"constant",evaluate:()=>g}}}(s===void 0?n.specification.default:s,n.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,s,c){return this.property.possiblyEvaluate(this,n,s,c)}}class zs{constructor(n){this.property=n,this.value=new Wl(n,void 0)}transitioned(n,s){return new o(this.property,this.value,s,me({},n.transition,this.transition),n.now)}untransitioned(){return new o(this.property,this.value,null,{},0)}}class m{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues)}getValue(n){return Nt(this._values[n].value.value)}setValue(n,s){this._values.hasOwnProperty(n)||(this._values[n]=new zs(this._values[n].property)),this._values[n].value=new Wl(this._values[n].property,s===null?void 0:Nt(s))}getTransition(n){return Nt(this._values[n].transition)}setTransition(n,s){this._values.hasOwnProperty(n)||(this._values[n]=new zs(this._values[n].property)),this._values[n].transition=Nt(s)||void 0}serialize(){const n={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(n[s]=c);const p=this.getTransition(s);p!==void 0&&(n[`${s}-transition`]=p)}return n}transitioned(n,s){const c=new d(this._properties);for(const p of Object.keys(this._values))c._values[p]=this._values[p].transitioned(n,s._values[p]);return c}untransitioned(){const n=new d(this._properties);for(const s of Object.keys(this._values))n._values[s]=this._values[s].untransitioned();return n}}class o{constructor(n,s,c,p,g){const _=p.delay||0,x=p.duration||0;g=g||0,this.property=n,this.value=s,this.begin=g+_,this.end=this.begin+x,n.specification.transition&&(p.delay||p.duration)&&(this.prior=c)}possiblyEvaluate(n,s,c){const p=n.now||0,g=this.value.possiblyEvaluate(n,s,c),_=this.prior;if(_){if(p>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(p<this.begin)return _.possiblyEvaluate(n,s,c);{const x=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(n,s,c),g,re(x))}}return g}}class d{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,s,c){const p=new T(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].possiblyEvaluate(n,s,c);return p}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class y{constructor(n){this._properties=n,this._values=Object.create(n.defaultPropertyValues)}getValue(n){return Nt(this._values[n].value)}setValue(n,s){this._values[n]=new Wl(this._values[n].property,s===null?void 0:Nt(s))}serialize(){const n={};for(const s of Object.keys(this._values)){const c=this.getValue(s);c!==void 0&&(n[s]=c)}return n}possiblyEvaluate(n,s,c){const p=new T(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].possiblyEvaluate(n,s,c);return p}}class w{constructor(n,s,c){this.property=n,this.value=s,this.parameters=c}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,s,c,p){return this.property.evaluate(this.value,this.parameters,n,s,c,p)}}class T{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class A{constructor(n){this.specification=n}possiblyEvaluate(n,s){return n.expression.evaluate(s)}interpolate(n,s,c){const p=mu[this.specification.type];return p?p(n,s,c):n}}class I{constructor(n,s){this.specification=n,this.overrides=s}possiblyEvaluate(n,s,c,p){return new w(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(s,null,{},c,p)}:n.expression,s)}interpolate(n,s,c){if(n.value.kind!=="constant"||s.value.kind!=="constant")return n;if(n.value.value===void 0||s.value.value===void 0)return new w(this,{kind:"constant",value:void 0},n.parameters);const p=mu[this.specification.type];return p?new w(this,{kind:"constant",value:p(n.value.value,s.value.value,c)},n.parameters):n}evaluate(n,s,c,p,g,_){return n.kind==="constant"?n.value:n.evaluate(s,c,p,g,_)}}class O extends I{possiblyEvaluate(n,s,c,p){if(n.value===void 0)return new w(this,{kind:"constant",value:void 0},s);if(n.expression.kind==="constant"){const g=n.expression.evaluate(s,null,{},c,p),_=n.property.specification.type==="resolvedImage"&&typeof g!="string"?g.name:g,x=this._calculate(_,_,_,s);return new w(this,{kind:"constant",value:x},s)}if(n.expression.kind==="camera"){const g=this._calculate(n.expression.evaluate({zoom:s.zoom-1}),n.expression.evaluate({zoom:s.zoom}),n.expression.evaluate({zoom:s.zoom+1}),s);return new w(this,{kind:"constant",value:g},s)}return new w(this,n.expression,s)}evaluate(n,s,c,p,g,_){if(n.kind==="source"){const x=n.evaluate(s,c,p,g,_);return this._calculate(x,x,x,s)}return n.kind==="composite"?this._calculate(n.evaluate({zoom:Math.floor(s.zoom)-1},c,p),n.evaluate({zoom:Math.floor(s.zoom)},c,p),n.evaluate({zoom:Math.floor(s.zoom)+1},c,p),s):n.value}_calculate(n,s,c,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:n,to:s,other:c}:{from:c,to:s,other:n}}interpolate(n){return n}}class U{constructor(n){this.specification=n}possiblyEvaluate(n,s,c,p){if(n.value!==void 0){if(n.expression.kind==="constant"){const g=n.expression.evaluate(s,null,{},c,p);return this._calculate(g,g,g,s)}return this._calculate(n.expression.evaluate(new ci(Math.floor(s.zoom-1),s)),n.expression.evaluate(new ci(Math.floor(s.zoom),s)),n.expression.evaluate(new ci(Math.floor(s.zoom+1),s)),s)}}_calculate(n,s,c,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:n,to:s}:{from:c,to:s}}interpolate(n){return n}}class V{constructor(n){this.specification=n}possiblyEvaluate(n,s,c,p){return!!n.expression.evaluate(s,null,{},c,p)}interpolate(){return!1}}class j{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const s in n){const c=n[s];c.specification.overridable&&this.overridableProperties.push(s);const p=this.defaultPropertyValues[s]=new Wl(c,void 0),g=this.defaultTransitionablePropertyValues[s]=new zs(c);this.defaultTransitioningPropertyValues[s]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=p.possiblyEvaluate({})}}}function ee(a,n){return 256*(a=te(Math.floor(a),0,255))+te(Math.floor(n),0,255)}$t(I,"DataDrivenProperty"),$t(A,"DataConstantProperty"),$t(O,"CrossFadedDataDrivenProperty"),$t(U,"CrossFadedProperty"),$t(V,"ColorRampProperty");const ce={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ae{constructor(n,s){this._structArray=n,this._pos1=s*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class J{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,s){return n._trim(),s&&(n.isTransferred=!0,s.push(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const s=Object.create(this.prototype);return s.arrayBuffer=n.arrayBuffer,s.length=n.length,s.capacity=n.arrayBuffer.byteLength/s.bytesPerElement,s._refreshViews(),s}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const s=this.uint8;this._refreshViews(),s&&this.uint8.set(s)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Pe(a,n=1){let s=0,c=0;return{members:a.map(p=>{const g=ce[p.type].BYTES_PER_ELEMENT,_=s=_e(s,Math.max(n,g)),x=p.components||1;return c=Math.max(c,g),s+=g*x,{name:p.name,type:p.type,components:x,offset:_}}),size:_e(s,Math.max(c,n)),alignment:n}}function _e(a,n){return Math.ceil(a/n)*n}class Ae extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s){const c=this.length;return this.resize(c+1),this.emplace(c,n,s)}emplace(n,s,c){const p=2*n;return this.int16[p+0]=s,this.int16[p+1]=c,n}}Ae.prototype.bytesPerElement=4,$t(Ae,"StructArrayLayout2i4");class De extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,n,s,c)}emplace(n,s,c,p){const g=3*n;return this.int16[g+0]=s,this.int16[g+1]=c,this.int16[g+2]=p,n}}De.prototype.bytesPerElement=6,$t(De,"StructArrayLayout3i6");class ke extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,n,s,c,p)}emplace(n,s,c,p,g){const _=4*n;return this.int16[_+0]=s,this.int16[_+1]=c,this.int16[_+2]=p,this.int16[_+3]=g,n}}ke.prototype.bytesPerElement=8,$t(ke,"StructArrayLayout4i8");class Te extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,c,p,g,_,x){const C=this.length;return this.resize(C+1),this.emplace(C,n,s,c,p,g,_,x)}emplace(n,s,c,p,g,_,x,C){const S=6*n,R=12*n,B=3*n;return this.int16[S+0]=s,this.int16[S+1]=c,this.uint8[R+4]=p,this.uint8[R+5]=g,this.uint8[R+6]=_,this.uint8[R+7]=x,this.float32[B+2]=C,n}}Te.prototype.bytesPerElement=12,$t(Te,"StructArrayLayout2i4ub1f12");class Ne extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,n,s,c,p)}emplace(n,s,c,p,g){const _=4*n;return this.float32[_+0]=s,this.float32[_+1]=c,this.float32[_+2]=p,this.float32[_+3]=g,n}}Ne.prototype.bytesPerElement=16,$t(Ne,"StructArrayLayout4f16");class tt extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,c,p,g,_,x,C,S,R){const B=this.length;return this.resize(B+1),this.emplace(B,n,s,c,p,g,_,x,C,S,R)}emplace(n,s,c,p,g,_,x,C,S,R,B){const N=10*n;return this.uint16[N+0]=s,this.uint16[N+1]=c,this.uint16[N+2]=p,this.uint16[N+3]=g,this.uint16[N+4]=_,this.uint16[N+5]=x,this.uint16[N+6]=C,this.uint16[N+7]=S,this.uint16[N+8]=R,this.uint16[N+9]=B,n}}tt.prototype.bytesPerElement=20,$t(tt,"StructArrayLayout10ui20");class at extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,c,p,g,_,x,C){const S=this.length;return this.resize(S+1),this.emplace(S,n,s,c,p,g,_,x,C)}emplace(n,s,c,p,g,_,x,C,S){const R=8*n;return this.uint16[R+0]=s,this.uint16[R+1]=c,this.uint16[R+2]=p,this.uint16[R+3]=g,this.uint16[R+4]=_,this.uint16[R+5]=x,this.uint16[R+6]=C,this.uint16[R+7]=S,n}}at.prototype.bytesPerElement=16,$t(at,"StructArrayLayout8ui16");class pt extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,c,p,g,_){const x=this.length;return this.resize(x+1),this.emplace(x,n,s,c,p,g,_)}emplace(n,s,c,p,g,_,x){const C=6*n;return this.int16[C+0]=s,this.int16[C+1]=c,this.int16[C+2]=p,this.int16[C+3]=g,this.int16[C+4]=_,this.int16[C+5]=x,n}}pt.prototype.bytesPerElement=12,$t(pt,"StructArrayLayout6i12");class ht extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,c,p,g,_,x,C,S,R,B,N,H,Z,Q,le){const ve=this.length;return this.resize(ve+1),this.emplace(ve,n,s,c,p,g,_,x,C,S,R,B,N,H,Z,Q,le)}emplace(n,s,c,p,g,_,x,C,S,R,B,N,H,Z,Q,le,ve){const Fe=16*n;return this.int16[Fe+0]=s,this.int16[Fe+1]=c,this.int16[Fe+2]=p,this.int16[Fe+3]=g,this.uint16[Fe+4]=_,this.uint16[Fe+5]=x,this.uint16[Fe+6]=C,this.uint16[Fe+7]=S,this.int16[Fe+8]=R,this.int16[Fe+9]=B,this.int16[Fe+10]=N,this.int16[Fe+11]=H,this.int16[Fe+12]=Z,this.int16[Fe+13]=Q,this.int16[Fe+14]=le,this.int16[Fe+15]=ve,n}}ht.prototype.bytesPerElement=32,$t(ht,"StructArrayLayout4i4ui4i4i32");class zt extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,n,s,c)}emplace(n,s,c,p){const g=3*n;return this.float32[g+0]=s,this.float32[g+1]=c,this.float32[g+2]=p,n}}zt.prototype.bytesPerElement=12,$t(zt,"StructArrayLayout3f12");class nt extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.uint32[1*n+0]=s,n}}nt.prototype.bytesPerElement=4,$t(nt,"StructArrayLayout1ul4");class kt extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,c,p,g,_,x,C,S,R,B,N,H){const Z=this.length;return this.resize(Z+1),this.emplace(Z,n,s,c,p,g,_,x,C,S,R,B,N,H)}emplace(n,s,c,p,g,_,x,C,S,R,B,N,H,Z){const Q=20*n,le=10*n;return this.int16[Q+0]=s,this.int16[Q+1]=c,this.int16[Q+2]=p,this.int16[Q+3]=g,this.int16[Q+4]=_,this.float32[le+3]=x,this.float32[le+4]=C,this.float32[le+5]=S,this.float32[le+6]=R,this.int16[Q+14]=B,this.uint32[le+8]=N,this.uint16[Q+18]=H,this.uint16[Q+19]=Z,n}}kt.prototype.bytesPerElement=40,$t(kt,"StructArrayLayout5i4f1i1ul2ui40");class Pt extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,c,p,g,_,x){const C=this.length;return this.resize(C+1),this.emplace(C,n,s,c,p,g,_,x)}emplace(n,s,c,p,g,_,x,C){const S=8*n;return this.int16[S+0]=s,this.int16[S+1]=c,this.int16[S+2]=p,this.int16[S+4]=g,this.int16[S+5]=_,this.int16[S+6]=x,this.int16[S+7]=C,n}}Pt.prototype.bytesPerElement=16,$t(Pt,"StructArrayLayout3i2i2i16");class Kt extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,s,c,p,g){const _=this.length;return this.resize(_+1),this.emplace(_,n,s,c,p,g)}emplace(n,s,c,p,g,_){const x=4*n,C=8*n;return this.float32[x+0]=s,this.float32[x+1]=c,this.float32[x+2]=p,this.int16[C+6]=g,this.int16[C+7]=_,n}}Kt.prototype.bytesPerElement=16,$t(Kt,"StructArrayLayout2f1f2i16");class ft extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,n,s,c,p)}emplace(n,s,c,p,g){const _=12*n,x=3*n;return this.uint8[_+0]=s,this.uint8[_+1]=c,this.float32[x+1]=p,this.float32[x+2]=g,n}}ft.prototype.bytesPerElement=12,$t(ft,"StructArrayLayout2ub2f12");class qt extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,c){const p=this.length;return this.resize(p+1),this.emplace(p,n,s,c)}emplace(n,s,c,p){const g=3*n;return this.uint16[g+0]=s,this.uint16[g+1]=c,this.uint16[g+2]=p,n}}qt.prototype.bytesPerElement=6,$t(qt,"StructArrayLayout3ui6");class gn extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,s,c,p,g,_,x,C,S,R,B,N,H,Z,Q,le,ve,Fe,je,Xe,Ye){const Je=this.length;return this.resize(Je+1),this.emplace(Je,n,s,c,p,g,_,x,C,S,R,B,N,H,Z,Q,le,ve,Fe,je,Xe,Ye)}emplace(n,s,c,p,g,_,x,C,S,R,B,N,H,Z,Q,le,ve,Fe,je,Xe,Ye,Je){const ut=30*n,dt=15*n,xt=60*n;return this.int16[ut+0]=s,this.int16[ut+1]=c,this.int16[ut+2]=p,this.float32[dt+2]=g,this.float32[dt+3]=_,this.uint16[ut+8]=x,this.uint16[ut+9]=C,this.uint32[dt+5]=S,this.uint32[dt+6]=R,this.uint32[dt+7]=B,this.uint16[ut+16]=N,this.uint16[ut+17]=H,this.uint16[ut+18]=Z,this.float32[dt+10]=Q,this.float32[dt+11]=le,this.uint8[xt+48]=ve,this.uint8[xt+49]=Fe,this.uint8[xt+50]=je,this.uint32[dt+13]=Xe,this.int16[ut+28]=Ye,this.uint8[xt+58]=Je,n}}gn.prototype.bytesPerElement=60,$t(gn,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Xt extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,s,c,p,g,_,x,C,S,R,B,N,H,Z,Q,le,ve,Fe,je,Xe,Ye,Je,ut,dt,xt,Et,ot,mt,Dt,Ft){const Rt=this.length;return this.resize(Rt+1),this.emplace(Rt,n,s,c,p,g,_,x,C,S,R,B,N,H,Z,Q,le,ve,Fe,je,Xe,Ye,Je,ut,dt,xt,Et,ot,mt,Dt,Ft)}emplace(n,s,c,p,g,_,x,C,S,R,B,N,H,Z,Q,le,ve,Fe,je,Xe,Ye,Je,ut,dt,xt,Et,ot,mt,Dt,Ft,Rt){const Bt=38*n,En=19*n;return this.int16[Bt+0]=s,this.int16[Bt+1]=c,this.int16[Bt+2]=p,this.float32[En+2]=g,this.float32[En+3]=_,this.int16[Bt+8]=x,this.int16[Bt+9]=C,this.int16[Bt+10]=S,this.int16[Bt+11]=R,this.int16[Bt+12]=B,this.int16[Bt+13]=N,this.uint16[Bt+14]=H,this.uint16[Bt+15]=Z,this.uint16[Bt+16]=Q,this.uint16[Bt+17]=le,this.uint16[Bt+18]=ve,this.uint16[Bt+19]=Fe,this.uint16[Bt+20]=je,this.uint16[Bt+21]=Xe,this.uint16[Bt+22]=Ye,this.uint16[Bt+23]=Je,this.uint16[Bt+24]=ut,this.uint16[Bt+25]=dt,this.uint16[Bt+26]=xt,this.uint16[Bt+27]=Et,this.uint16[Bt+28]=ot,this.uint32[En+15]=mt,this.float32[En+16]=Dt,this.float32[En+17]=Ft,this.float32[En+18]=Rt,n}}Xt.prototype.bytesPerElement=76,$t(Xt,"StructArrayLayout3i2f6i15ui1ul3f76");class Yt extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.float32[1*n+0]=s,n}}Yt.prototype.bytesPerElement=4,$t(Yt,"StructArrayLayout1f4");class xn extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,c,p,g,_,x){const C=this.length;return this.resize(C+1),this.emplace(C,n,s,c,p,g,_,x)}emplace(n,s,c,p,g,_,x,C){const S=7*n;return this.float32[S+0]=s,this.float32[S+1]=c,this.float32[S+2]=p,this.float32[S+3]=g,this.float32[S+4]=_,this.float32[S+5]=x,this.float32[S+6]=C,n}}xn.prototype.bytesPerElement=28,$t(xn,"StructArrayLayout7f28");class kn extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,c,p,g){const _=this.length;return this.resize(_+1),this.emplace(_,n,s,c,p,g)}emplace(n,s,c,p,g,_){const x=5*n;return this.float32[x+0]=s,this.float32[x+1]=c,this.float32[x+2]=p,this.float32[x+3]=g,this.float32[x+4]=_,n}}kn.prototype.bytesPerElement=20,$t(kn,"StructArrayLayout5f20");class dn extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s,c,p){const g=this.length;return this.resize(g+1),this.emplace(g,n,s,c,p)}emplace(n,s,c,p,g){const _=6*n;return this.uint32[3*n+0]=s,this.uint16[_+2]=c,this.uint16[_+3]=p,this.uint16[_+4]=g,n}}dn.prototype.bytesPerElement=12,$t(dn,"StructArrayLayout1ul3ui12");class Mn extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,s){const c=this.length;return this.resize(c+1),this.emplace(c,n,s)}emplace(n,s,c){const p=2*n;return this.uint16[p+0]=s,this.uint16[p+1]=c,n}}Mn.prototype.bytesPerElement=4,$t(Mn,"StructArrayLayout2ui4");class $n extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const s=this.length;return this.resize(s+1),this.emplace(s,n)}emplace(n,s){return this.uint16[1*n+0]=s,n}}$n.prototype.bytesPerElement=2,$t($n,"StructArrayLayout1ui2");class vi extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s){const c=this.length;return this.resize(c+1),this.emplace(c,n,s)}emplace(n,s,c){const p=2*n;return this.float32[p+0]=s,this.float32[p+1]=c,n}}vi.prototype.bytesPerElement=8,$t(vi,"StructArrayLayout2f8");class nr extends J{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,s,c,p,g,_,x){const C=this.length;return this.resize(C+1),this.emplace(C,n,s,c,p,g,_,x)}emplace(n,s,c,p,g,_,x,C){const S=8*n,R=4*n;return this.int16[S+0]=s,this.int16[S+1]=c,this.int16[S+2]=p,this.int16[S+3]=g,this.int16[S+4]=_,this.int16[S+5]=x,this.float32[R+3]=C,n}}nr.prototype.bytesPerElement=16,$t(nr,"StructArrayLayout6i1f16");class ir extends ae{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}ir.prototype.size=12;class Rr extends pt{get(n){return new ir(this,n)}}$t(Rr,"FillExtrusionExtArray");class mo extends ae{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}mo.prototype.size=40;class Uo extends kt{get(n){return new mo(this,n)}}$t(Uo,"CollisionBoxArray");class da extends ae{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(n){this._structArray.uint8[this._pos1+49]=n}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(n){this._structArray.uint8[this._pos1+50]=n}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(n){this._structArray.uint32[this._pos4+13]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(n){this._structArray.uint8[this._pos1+58]=n}}da.prototype.size=60;class Vo extends gn{get(n){return new da(this,n)}}$t(Vo,"PlacedSymbolArray");class bi extends ae{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(n){this._structArray.uint32[this._pos4+15]=n}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}bi.prototype.size=76;class Ti extends Xt{get(n){return new bi(this,n)}}$t(Ti,"SymbolInstanceArray");class Yn extends Yt{getoffsetX(n){return this.float32[1*n+0]}}$t(Yn,"GlyphOffsetArray");class Pi extends De{getx(n){return this.int16[3*n+0]}gety(n){return this.int16[3*n+1]}gettileUnitDistanceFromAnchor(n){return this.int16[3*n+2]}}$t(Pi,"SymbolLineVertexArray");class zr extends ae{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}zr.prototype.size=12;class xi extends dn{get(n){return new zr(this,n)}}$t(xi,"FeatureIndexArray");class qr extends ae{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}qr.prototype.size=4;class jl extends Mn{get(n){return new qr(this,n)}}$t(jl,"FillExtrusionCentroidArray");class kr extends ae{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}get a_scale(){return this._structArray.float32[this._pos4+3]}}kr.prototype.size=16;class ja extends nr{get(n){return new kr(this,n)}}$t(ja,"CircleGlobeExtArray");const ug=Pe([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),lp=Pe([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var ks=lu(function(a){a.exports=function(n,s){var c,p,g,_,x,C,S,R;for(p=n.length-(c=3&n.length),g=s,x=3432918353,C=461845907,R=0;R<p;)S=255&n.charCodeAt(R)|(255&n.charCodeAt(++R))<<8|(255&n.charCodeAt(++R))<<16|(255&n.charCodeAt(++R))<<24,++R,g=27492+(65535&(_=5*(65535&(g=(g^=S=(65535&(S=(S=(65535&S)*x+(((S>>>16)*x&65535)<<16)&4294967295)<<15|S>>>17))*C+(((S>>>16)*C&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(S=0,c){case 3:S^=(255&n.charCodeAt(R+2))<<16;case 2:S^=(255&n.charCodeAt(R+1))<<8;case 1:g^=S=(65535&(S=(S=(65535&(S^=255&n.charCodeAt(R)))*x+(((S>>>16)*x&65535)<<16)&4294967295)<<15|S>>>17))*C+(((S>>>16)*C&65535)<<16)&4294967295}return g^=n.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}}),Q_=lu(function(a){a.exports=function(n,s){for(var c,p=n.length,g=s^p,_=0;p>=4;)c=1540483477*(65535&(c=255&n.charCodeAt(_)|(255&n.charCodeAt(++_))<<8|(255&n.charCodeAt(++_))<<16|(255&n.charCodeAt(++_))<<24))+((1540483477*(c>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(c=1540483477*(65535&(c^=c>>>24))+((1540483477*(c>>>16)&65535)<<16)),p-=4,++_;switch(p){case 3:g^=(255&n.charCodeAt(_+2))<<16;case 2:g^=(255&n.charCodeAt(_+1))<<8;case 1:g=1540483477*(65535&(g^=255&n.charCodeAt(_)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}}),pa=ks,cp=Q_;pa.murmur3=ks,pa.murmur2=cp;class hg{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(n,s,c,p){this.ids.push(eb(n)),this.positions.push(s,c,p)}getPositions(n){const s=eb(n);let c=0,p=this.ids.length-1;for(;c<p;){const _=c+p>>1;this.ids[_]>=s?p=_:c=_+1}const g=[];for(;this.ids[c]===s;)g.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return g}static serialize(n,s){const c=new Float64Array(n.ids),p=new Uint32Array(n.positions);return ev(c,p,0,c.length-1),s&&s.push(c.buffer,p.buffer),{ids:c,positions:p}}static deserialize(n){const s=new hg;return s.ids=n.ids,s.positions=n.positions,s.indexed=!0,s}}function eb(a){const n=+a;return!isNaN(n)&&Number.MIN_SAFE_INTEGER<=n&&n<=Number.MAX_SAFE_INTEGER?n:pa(String(a))}function ev(a,n,s,c){for(;s<c;){const p=a[s+c>>1];let g=s-1,_=c+1;for(;;){do g++;while(a[g]<p);do _--;while(a[_]>p);if(g>=_)break;dg(a,g,_),dg(n,3*g,3*_),dg(n,3*g+1,3*_+1),dg(n,3*g+2,3*_+2)}_-s<c-_?(ev(a,n,s,_),s=_+1):(ev(a,n,_+1,c),c=_)}}function dg(a,n,s){const c=a[n];a[n]=a[s],a[s]=c}$t(hg,"FeaturePositionMap");class $a{constructor(n,s){this.gl=n.gl,this.location=s}}class pg extends $a{constructor(n,s){super(n,s),this.current=0}set(n){this.current!==n&&(this.current=n,this.gl.uniform1f(this.location,n))}}class tb extends $a{constructor(n,s){super(n,s),this.current=[0,0,0,0]}set(n){n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]&&n[3]===this.current[3]||(this.current=n,this.gl.uniform4f(this.location,n[0],n[1],n[2],n[3]))}}class nb extends $a{constructor(n,s){super(n,s),this.current=Zn.transparent}set(n){n.r===this.current.r&&n.g===this.current.g&&n.b===this.current.b&&n.a===this.current.a||(this.current=n,this.gl.uniform4f(this.location,n.r,n.g,n.b,n.a))}}const nR=new Float32Array(16),iR=new Float32Array(9),rR=new Float32Array(4);function tv(a){return[ee(255*a.r,255*a.g),ee(255*a.b,255*a.a)]}class up{constructor(n,s,c){this.value=n,this.uniformNames=s.map(p=>`u_${p}`),this.type=c}setUniform(n,s,c){n.set(c.constantOr(this.value))}getBinding(n,s,c){return this.type==="color"?new nb(n,s):new pg(n,s)}}class Uu{constructor(n,s){this.uniformNames=s.map(c=>`u_${c}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(n,s){this.pixelRatioFrom=s.pixelRatio||1,this.pixelRatioTo=n.pixelRatio||1,this.patternFrom=s.tl.concat(s.br),this.patternTo=n.tl.concat(n.br)}setUniform(n,s,c,p){const g=p==="u_pattern_to"||p==="u_dash_to"?this.patternTo:p==="u_pattern_from"||p==="u_dash_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&n.set(g)}getBinding(n,s,c){return c==="u_pattern_from"||c==="u_pattern_to"||c==="u_dash_from"||c==="u_dash_to"?new tb(n,s):new pg(n,s)}}class qa{constructor(n,s,c,p){this.expression=n,this.type=c,this.maxValue=0,this.paintVertexAttributes=s.map(g=>({name:`a_${g}`,type:"Float32",components:c==="color"?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(n,s,c,p,g,_){const x=this.paintVertexArray.length,C=this.expression.evaluate(new ci(0),s,{},g,p,_);this.paintVertexArray.resize(n),this._setPaintValue(x,n,C)}updatePaintArray(n,s,c,p,g){const _=this.expression.evaluate({zoom:0},c,p,void 0,g);this._setPaintValue(n,s,_)}_setPaintValue(n,s,c){if(this.type==="color"){const p=tv(c);for(let g=n;g<s;g++)this.paintVertexArray.emplace(g,p[0],p[1])}else{for(let p=n;p<s;p++)this.paintVertexArray.emplace(p,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Go{constructor(n,s,c,p,g,_){this.expression=n,this.uniformNames=s.map(x=>`u_${x}_t`),this.type=c,this.useIntegerZoom=p,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=s.map(x=>({name:`a_${x}`,type:"Float32",components:c==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(n,s,c,p,g,_){const x=this.expression.evaluate(new ci(this.zoom),s,{},g,p,_),C=this.expression.evaluate(new ci(this.zoom+1),s,{},g,p,_),S=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(S,n,x,C)}updatePaintArray(n,s,c,p,g){const _=this.expression.evaluate({zoom:this.zoom},c,p,void 0,g),x=this.expression.evaluate({zoom:this.zoom+1},c,p,void 0,g);this._setPaintValue(n,s,_,x)}_setPaintValue(n,s,c,p){if(this.type==="color"){const g=tv(c),_=tv(p);for(let x=n;x<s;x++)this.paintVertexArray.emplace(x,g[0],g[1],_[0],_[1])}else{for(let g=n;g<s;g++)this.paintVertexArray.emplace(g,c,p);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(p))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,s){const c=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,p=te(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);n.set(p)}getBinding(n,s,c){return new pg(n,s)}}class Bs{constructor(n,s,c,p,g,_,x){this.expression=n,this.type=c,this.useIntegerZoom=p,this.zoom=g,this.layerId=x,this.paintVertexAttributes=(c==="array"?lp:ug).members;for(let C=0;C<s.length;++C);this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(n,s,c){const p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(n),this.zoomOutPaintVertexArray.resize(n),this._setPaintValues(p,n,s.patterns&&s.patterns[this.layerId],c)}updatePaintArray(n,s,c,p,g,_){this._setPaintValues(n,s,c.patterns&&c.patterns[this.layerId],_)}_setPaintValues(n,s,c,p){if(!p||!c)return;const{min:g,mid:_,max:x}=c,C=p[g],S=p[_],R=p[x];if(C&&S&&R)for(let B=n;B<s;B++)this._setPaintValue(this.zoomInPaintVertexArray,B,S,C),this._setPaintValue(this.zoomOutPaintVertexArray,B,S,R)}_setPaintValue(n,s,c,p){n.emplace(s,c.tl[0],c.tl[1],c.br[0],c.br[1],p.tl[0],p.tl[1],p.br[0],p.br[1],c.pixelRatio,p.pixelRatio)}upload(n){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=n.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=n.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Fs{constructor(n,s,c=()=>!0){this.binders={},this._buffers=[];const p=[];for(const g in n.paint._values){if(!c(g))continue;const _=n.paint.get(g);if(!(_ instanceof w&&As(_.property.specification)))continue;const x=aR(g,n.type),C=_.value,S=_.property.specification.type,R=_.property.useIntegerZoom,B=_.property.specification["property-type"],N=B==="cross-faded"||B==="cross-faded-data-driven",H=String(g)==="line-dasharray"&&n.layout.get("line-cap").value.kind!=="constant";if(C.kind!=="constant"||H)if(C.kind==="source"||H||N){const Z=ib(g,S,"source");this.binders[g]=N?new Bs(C,x,S,R,s,Z,n.id):new qa(C,x,S,Z),p.push(`/a_${g}`)}else{const Z=ib(g,S,"composite");this.binders[g]=new Go(C,x,S,R,s,Z),p.push(`/z_${g}`)}else this.binders[g]=N?new Uu(C.value,x):new up(C.value,x,S),p.push(`/u_${g}`)}this.cacheKey=p.sort().join("")}getMaxValue(n){const s=this.binders[n];return s instanceof qa||s instanceof Go?s.maxValue:0}populatePaintArrays(n,s,c,p,g,_){for(const x in this.binders){const C=this.binders[x];(C instanceof qa||C instanceof Go||C instanceof Bs)&&C.populatePaintArray(n,s,c,p,g,_)}}setConstantPatternPositions(n,s){for(const c in this.binders){const p=this.binders[c];p instanceof Uu&&p.setConstantPatternPositions(n,s)}}updatePaintArrays(n,s,c,p,g,_){let x=!1;for(const C in n){const S=s.getPositions(C);for(const R of S){const B=c.feature(R.index);for(const N in this.binders){const H=this.binders[N];if((H instanceof qa||H instanceof Go||H instanceof Bs)&&H.expression.isStateDependent===!0){const Z=p.paint.get(N);H.expression=Z.value,H.updatePaintArray(R.start,R.end,B,n[C],g,_),x=!0}}}}return x}defines(){const n=[];for(const s in this.binders){const c=this.binders[s];(c instanceof up||c instanceof Uu)&&n.push(...c.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return n}getBinderAttributes(){const n=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof qa||c instanceof Go||c instanceof Bs)for(let p=0;p<c.paintVertexAttributes.length;p++)n.push(c.paintVertexAttributes[p].name)}return n}getBinderUniforms(){const n=[];for(const s in this.binders){const c=this.binders[s];if(c instanceof up||c instanceof Uu||c instanceof Go)for(const p of c.uniformNames)n.push(p)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n,s){const c=[];for(const p in this.binders){const g=this.binders[p];if(g instanceof up||g instanceof Uu||g instanceof Go){for(const _ of g.uniformNames)if(s[_]){const x=g.getBinding(n,s[_],_);c.push({name:_,property:p,binding:x})}}}return c}setUniforms(n,s,c,p){for(const{name:g,property:_,binding:x}of s)this.binders[_].setUniform(x,p,c.get(_),g)}updatePaintBuffers(n){this._buffers=[];for(const s in this.binders){const c=this.binders[s];if(n&&c instanceof Bs){const p=n.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(c instanceof qa||c instanceof Go)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}}upload(n){for(const s in this.binders){const c=this.binders[s];(c instanceof qa||c instanceof Go||c instanceof Bs)&&c.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const s=this.binders[n];(s instanceof qa||s instanceof Go||s instanceof Bs)&&s.destroy()}}}class $l{constructor(n,s,c=()=>!0){this.programConfigurations={};for(const p of n)this.programConfigurations[p.id]=new Fs(p,s,c);this.needsUpload=!1,this._featureMap=new hg,this._bufferOffset=0}populatePaintArrays(n,s,c,p,g,_,x){for(const C in this.programConfigurations)this.programConfigurations[C].populatePaintArrays(n,s,p,g,_,x);s.id!==void 0&&this._featureMap.add(s.id,c,this._bufferOffset,n),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,s,c,p,g){for(const _ of c)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(n,this._featureMap,s,_,p,g)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const s in this.programConfigurations)this.programConfigurations[s].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}const oR={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function aR(a,n){return oR[a]||[a.replace(`${n}-`,"").replace(/-/g,"_")]}const sR={"line-pattern":{source:tt,composite:tt},"fill-pattern":{source:tt,composite:tt},"fill-extrusion-pattern":{source:tt,composite:tt},"line-dasharray":{source:at,composite:at}},lR={color:{source:vi,composite:Ne},number:{source:Yt,composite:vi}};function ib(a,n,s){const c=sR[a];return c&&c[s]||lR[n][s]}$t(up,"ConstantBinder"),$t(Uu,"CrossFadedConstantBinder"),$t(qa,"SourceExpressionBinder"),$t(Bs,"CrossFadedCompositeBinder"),$t(Go,"CompositeExpressionBinder"),$t(Fs,"ProgramConfiguration",{omit:["_buffers"]}),$t($l,"ProgramConfigurationSet");const fg="-transition";class Ho extends Be{constructor(n,s){if(super(),this.id=n.id,this.type=n.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,n.type!=="custom"&&(this.metadata=(n=n).metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type!=="background"&&n.type!=="sky"&&(this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter),s.layout&&(this._unevaluatedLayout=new y(s.layout)),s.paint)){this._transitionablePaint=new m(s.paint);for(const c in n.paint)this.setPaintProperty(c,n.paint[c],{validate:!1});for(const c in n.layout)this.setLayoutProperty(c,n.layout[c],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new T(s.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,s,c={}){s!=null&&this._validate(X_,`layers.${this.id}.layout.${n}`,n,s,c)||(n!=="visibility"?this._unevaluatedLayout.setValue(n,s):this.visibility=s)}getPaintProperty(n){return yt(n,fg)?this._transitionablePaint.getTransition(n.slice(0,-fg.length)):this._transitionablePaint.getValue(n)}setPaintProperty(n,s,c={}){if(s!=null&&this._validate(Z_,`layers.${this.id}.paint.${n}`,n,s,c))return!1;if(yt(n,fg))return this._transitionablePaint.setTransition(n.slice(0,-fg.length),s||void 0),!1;{const p=this._transitionablePaint._values[n],g=p.property.specification["property-type"]==="cross-faded-data-driven",_=p.value.isDataDriven(),x=p.value;this._transitionablePaint.setValue(n,s),this._handleSpecialPaintPropertyUpdate(n);const C=this._transitionablePaint._values[n].value;return C.isDataDriven()||_||g||this._handleOverridablePaintPropertyUpdate(n,x,C)}}_handleSpecialPaintPropertyUpdate(n){}getProgramIds(){return null}getProgramConfiguration(n){return null}_handleOverridablePaintPropertyUpdate(n,s,c){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,s){n.getCrossfadeParameters&&(this._crossfadeParameters=n.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,s)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,s)}serialize(){const n={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(n.layout=n.layout||{},n.layout.visibility=this.visibility),It(n,(s,c)=>!(s===void 0||c==="layout"&&!Object.keys(s).length||c==="paint"&&!Object.keys(s).length))}_validate(n,s,c,p,g={}){return(!g||g.validate!==!1)&&Zm(this,n.call(Fl,{key:s,layerType:this.type,objectKey:c,value:p,styleSpec:Me,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const n in this.paint._values){const s=this.paint.get(n);if(s instanceof w&&As(s.property.specification)&&(s.value.kind==="source"||s.value.kind==="composite")&&s.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=la(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const cR=Pe([{name:"a_pos",components:2,type:"Int16"}],4),uR=Pe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"},{name:"a_scale",components:1,type:"Float32"}]);class Ei{constructor(n=[]){this.segments=n}prepareSegment(n,s,c,p){let g=this.segments[this.segments.length-1];return n>Ei.MAX_VERTEX_ARRAY_LENGTH&&xe(`Max vertices per segment is ${Ei.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!g||g.vertexLength+n>Ei.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==p)&&(g={vertexOffset:s.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},p!==void 0&&(g.sortKey=p),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const n of this.segments)for(const s in n.vaos)n.vaos[s].destroy()}static simpleSegment(n,s,c,p){return new Ei([{vertexOffset:n,primitiveOffset:s,vertexLength:c,primitiveLength:p,vaos:{},sortKey:0}])}}Ei.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,$t(Ei,"SegmentVector");var In=8192;class Os{constructor(n,s){n&&(s?this.setSouthWest(n).setNorthEast(s):n.length===4?this.setSouthWest([n[0],n[1]]).setNorthEast([n[2],n[3]]):this.setSouthWest(n[0]).setNorthEast(n[1]))}setNorthEast(n){return this._ne=n instanceof ti?new ti(n.lng,n.lat):ti.convert(n),this}setSouthWest(n){return this._sw=n instanceof ti?new ti(n.lng,n.lat):ti.convert(n),this}extend(n){const s=this._sw,c=this._ne;let p,g;if(n instanceof ti)p=n,g=n;else{if(!(n instanceof Os))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(Os.convert(n)):this.extend(ti.convert(n)):this;if(p=n._sw,g=n._ne,!p||!g)return this}return s||c?(s.lng=Math.min(p.lng,s.lng),s.lat=Math.min(p.lat,s.lat),c.lng=Math.max(g.lng,c.lng),c.lat=Math.max(g.lat,c.lat)):(this._sw=new ti(p.lng,p.lat),this._ne=new ti(g.lng,g.lat)),this}getCenter(){return new ti((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ti(this.getWest(),this.getNorth())}getSouthEast(){return new ti(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:s,lat:c}=ti.convert(n);let p=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=c&&c<=this._ne.lat&&p}static convert(n){return!n||n instanceof Os?n:new Os(n)}}const nv=63710088e-1;class ti{constructor(n,s){if(isNaN(n)||isNaN(s))throw new Error(`Invalid LngLat object: (${n}, ${s})`);if(this.lng=+n,this.lat=+s,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ti(ie(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const s=Math.PI/180,c=this.lat*s,p=n.lat*s,g=Math.sin(c)*Math.sin(p)+Math.cos(c)*Math.cos(p)*Math.cos((n.lng-this.lng)*s);return nv*Math.acos(Math.min(g,1))}toBounds(n=0){const s=360*n/40075017,c=s/Math.cos(Math.PI/180*this.lat);return new Os(new ti(this.lng-c,this.lat-s),new ti(this.lng+c,this.lat+s))}static convert(n){if(n instanceof ti)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new ti(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new ti(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const rb=2*Math.PI*nv;function iv(a){return rb*Math.cos(a*Math.PI/180)}function hp(a){return(180+a)/360}function Vu(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Gu(a,n){return a/iv(n)}function To(a){return 360*a-180}function rr(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function ob(a,n){return a*iv(rr(n))}const fa=85.051129;class mg{constructor(n,s,c=0){this.x=+n,this.y=+s,this.z=+c}static fromLngLat(n,s=0){const c=ti.convert(n);return new mg(hp(c.lng),Vu(c.lat),Gu(s,c.lat))}toLngLat(){return new ti(To(this.x),rr(this.y))}toAltitude(){return ob(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/rb*(n=rr(this.y),1/Math.cos(n*Math.PI/180));var n}}function rv(a,n,s,c,p,g,_,x,C){const S=(n+c)/2,R=(s+p)/2,B=new M(S,R);x(B),function(N,H,Z,Q,le,ve){const Fe=Z-le,je=Q-ve;return Math.abs((Q-H)*Fe-(Z-N)*je)/Math.hypot(Fe,je)}(B.x,B.y,g.x,g.y,_.x,_.y)>=C?(rv(a,n,s,S,R,g,B,x,C),rv(a,S,R,c,p,B,_,x,C)):a.push(_)}function hR(a,n,s){let c=a[0],p=c.x,g=c.y;n(c);const _=[c];for(let x=1;x<a.length;x++){const C=a[x],{x:S,y:R}=C;n(C),rv(_,p,g,S,R,c,C,n,s),p=S,g=R,c=C}return _}const ov=Math.pow(2,14)-1,ab=-ov-1;function dR(a,n){const s=Math.round(a.x*n),c=Math.round(a.y*n);return a.x=te(s,ab,ov),a.y=te(c,ab,ov),(s<a.x||s>a.x+1||c<a.y||c>a.y+1)&&xe("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function Za(a,n,s){const c=a.loadGeometry(),p=a.extent,g=In/p;if(n&&s&&s.projection.isReprojectedInTileSpace){const _=1<<n.z,{scale:x,x:C,y:S,projection:R}=s,B=N=>{const H=To((n.x+N.x/p)/_),Z=rr((n.y+N.y/p)/_),Q=R.project(H,Z);N.x=(Q.x*x-C)*p,N.y=(Q.y*x-S)*p};for(let N=0;N<c.length;N++)if(a.type!==1)c[N]=hR(c[N],B,1);else{const H=[];for(const Z of c[N])Z.x<0||Z.x>=p||Z.y<0||Z.y>=p||(B(Z),H.push(Z));c[N]=H}}for(const _ of c)for(const x of _)dR(x,g);return c}function ql(a,n){return{type:a.type,id:a.id,properties:a.properties,geometry:n?Za(a):[]}}function gg(a,n,s,c,p){a.emplaceBack(2*n+(c+1)/2,2*s+(p+1)/2)}function yg(a,n,s,c){a.emplaceBack(n.x,n.y,n.z,s[0]*16384,s[1]*16384,s[2]*16384,c)}class av{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.id),this.index=n.index,this.hasPattern=!1,this.projection=n.projection,this.layoutVertexArray=new Ae,this.indexArray=new qt,this.segments=new Ei,this.programConfigurations=new $l(n.layers,n.zoom),this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(n,s,c,p){const g=this.layers[0],_=[];let x=null;g.type==="circle"&&(x=g.layout.get("circle-sort-key"));for(const{feature:S,id:R,index:B,sourceLayerIndex:N}of n){const H=this.layers[0]._featureFilter.needGeometry,Z=ql(S,H);if(!this.layers[0]._featureFilter.filter(new ci(this.zoom),Z,c))continue;const Q=x?x.evaluate(Z,{},c):void 0,le={id:R,properties:S.properties,type:S.type,sourceLayerIndex:N,index:B,geometry:H?Z.geometry:Za(S,c,p),patterns:{},sortKey:Q};_.push(le)}x&&_.sort((S,R)=>S.sortKey-R.sortKey);let C=null;p.projection.name==="globe"&&(this.globeExtVertexArray=new ja,C=p.projection);for(const S of _){const{geometry:R,index:B,sourceLayerIndex:N}=S,H=n[B].feature;this.addFeature(S,R,B,s.availableImages,c,C),s.featureIndex.insert(H,R,B,N,this.index)}}update(n,s,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,c,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,cR.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,uR.members))),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(n,s,c,p,g,_){for(const x of s)for(const C of x){const S=C.x,R=C.y;if(S<0||S>=In||R<0||R>=In)continue;if(_){const H=_.projectTilePoint(S,R,g),Z=_.upVector(g,S,R),Q=rr((R/In+g.y)/(1<<g.z)),le=_.pixelsPerMeter(Q,1)/Gu(1,Q),ve=this.globeExtVertexArray;yg(ve,H,Z,le),yg(ve,H,Z,le),yg(ve,H,Z,le),yg(ve,H,Z,le)}const B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),N=B.vertexLength;gg(this.layoutVertexArray,S,R,-1,-1),gg(this.layoutVertexArray,S,R,1,-1),gg(this.layoutVertexArray,S,R,1,1),gg(this.layoutVertexArray,S,R,-1,1),this.indexArray.emplaceBack(N,N+1,N+2),this.indexArray.emplaceBack(N,N+3,N+2),B.vertexLength+=4,B.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,c,{},p,g)}}function sb(a,n){for(let s=0;s<a.length;s++)if(Hu(n,a[s]))return!0;for(let s=0;s<n.length;s++)if(Hu(a,n[s]))return!0;return!!sv(a,n)}function pR(a,n,s){return!!Hu(a,n)||!!lv(n,a,s)}function lb(a,n){if(a.length===1)return ub(n,a[0]);for(let s=0;s<n.length;s++){const c=n[s];for(let p=0;p<c.length;p++)if(Hu(a,c[p]))return!0}for(let s=0;s<a.length;s++)if(ub(n,a[s]))return!0;for(let s=0;s<n.length;s++)if(sv(a,n[s]))return!0;return!1}function fR(a,n,s){if(a.length>1){if(sv(a,n))return!0;for(let c=0;c<n.length;c++)if(lv(n[c],a,s))return!0}for(let c=0;c<a.length;c++)if(lv(a[c],n,s))return!0;return!1}function sv(a,n){if(a.length===0||n.length===0)return!1;for(let s=0;s<a.length-1;s++){const c=a[s],p=a[s+1];for(let g=0;g<n.length-1;g++)if(mR(c,p,n[g],n[g+1]))return!0}return!1}function mR(a,n,s,c){return He(a,s,c)!==He(n,s,c)&&He(a,n,s)!==He(a,n,c)}function lv(a,n,s){const c=s*s;if(n.length===1)return a.distSqr(n[0])<c;for(let p=1;p<n.length;p++)if(cb(a,n[p-1],n[p])<c)return!0;return!1}function cb(a,n,s){const c=n.distSqr(s);if(c===0)return a.distSqr(n);const p=((a.x-n.x)*(s.x-n.x)+(a.y-n.y)*(s.y-n.y))/c;return a.distSqr(p<0?n:p>1?s:s.sub(n)._mult(p)._add(n))}function ub(a,n){let s,c,p,g=!1;for(let _=0;_<a.length;_++){s=a[_];for(let x=0,C=s.length-1;x<s.length;C=x++)c=s[x],p=s[C],c.y>n.y!=p.y>n.y&&n.x<(p.x-c.x)*(n.y-c.y)/(p.y-c.y)+c.x&&(g=!g)}return g}function Hu(a,n){let s=!1;for(let c=0,p=a.length-1;c<a.length;p=c++){const g=a[c],_=a[p];g.y>n.y!=_.y>n.y&&n.x<(_.x-g.x)*(n.y-g.y)/(_.y-g.y)+g.x&&(s=!s)}return s}function hb(a,n,s,c,p){for(const _ of a)if(n<=_.x&&s<=_.y&&c>=_.x&&p>=_.y)return!0;const g=[new M(n,s),new M(n,p),new M(c,p),new M(c,s)];if(a.length>2){for(const _ of g)if(Hu(a,_))return!0}for(let _=0;_<a.length-1;_++)if(gR(a[_],a[_+1],g))return!0;return!1}function gR(a,n,s){const c=s[0],p=s[2];if(a.x<c.x&&n.x<c.x||a.x>p.x&&n.x>p.x||a.y<c.y&&n.y<c.y||a.y>p.y&&n.y>p.y)return!1;const g=He(a,n,s[0]);return g!==He(a,n,s[1])||g!==He(a,n,s[2])||g!==He(a,n,s[3])}function Wu(a,n,s){const c=n.paint.get(a).value;return c.kind==="constant"?c.value:s.programConfigurations.get(n.id).getMaxValue(a)}function _g(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function db(a,n,s,c,p){if(!n[0]&&!n[1])return a;const g=M.convert(n)._mult(p);s==="viewport"&&g._rotate(-c);const _=[];for(let x=0;x<a.length;x++)_.push(a[x].sub(g));return _}function pb(a,n,s,c){const p=M.convert(a)._mult(c);return n==="viewport"&&p._rotate(-s),p}$t(av,"CircleBucket",{omit:["layers"]});const yR=new j({"circle-sort-key":new I(Me.layout_circle["circle-sort-key"])});var _R={paint:new j({"circle-radius":new I(Me.paint_circle["circle-radius"]),"circle-color":new I(Me.paint_circle["circle-color"]),"circle-blur":new I(Me.paint_circle["circle-blur"]),"circle-opacity":new I(Me.paint_circle["circle-opacity"]),"circle-translate":new A(Me.paint_circle["circle-translate"]),"circle-translate-anchor":new A(Me.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new A(Me.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new A(Me.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new I(Me.paint_circle["circle-stroke-width"]),"circle-stroke-color":new I(Me.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new I(Me.paint_circle["circle-stroke-opacity"])}),layout:yR},cv=1e-6,Zr=typeof Float32Array!="undefined"?Float32Array:Array;function fb(){var a=new Zr(9);return Zr!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function ma(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function uv(a,n,s){var c=n[0],p=n[1],g=n[2],_=n[3],x=n[4],C=n[5],S=n[6],R=n[7],B=n[8],N=n[9],H=n[10],Z=n[11],Q=n[12],le=n[13],ve=n[14],Fe=n[15],je=s[0],Xe=s[1],Ye=s[2],Je=s[3];return a[0]=je*c+Xe*x+Ye*B+Je*Q,a[1]=je*p+Xe*C+Ye*N+Je*le,a[2]=je*g+Xe*S+Ye*H+Je*ve,a[3]=je*_+Xe*R+Ye*Z+Je*Fe,a[4]=(je=s[4])*c+(Xe=s[5])*x+(Ye=s[6])*B+(Je=s[7])*Q,a[5]=je*p+Xe*C+Ye*N+Je*le,a[6]=je*g+Xe*S+Ye*H+Je*ve,a[7]=je*_+Xe*R+Ye*Z+Je*Fe,a[8]=(je=s[8])*c+(Xe=s[9])*x+(Ye=s[10])*B+(Je=s[11])*Q,a[9]=je*p+Xe*C+Ye*N+Je*le,a[10]=je*g+Xe*S+Ye*H+Je*ve,a[11]=je*_+Xe*R+Ye*Z+Je*Fe,a[12]=(je=s[12])*c+(Xe=s[13])*x+(Ye=s[14])*B+(Je=s[15])*Q,a[13]=je*p+Xe*C+Ye*N+Je*le,a[14]=je*g+Xe*S+Ye*H+Je*ve,a[15]=je*_+Xe*R+Ye*Z+Je*Fe,a}function Zl(a,n,s){var c,p,g,_,x,C,S,R,B,N,H,Z,Q=s[0],le=s[1],ve=s[2];return n===a?(a[12]=n[0]*Q+n[4]*le+n[8]*ve+n[12],a[13]=n[1]*Q+n[5]*le+n[9]*ve+n[13],a[14]=n[2]*Q+n[6]*le+n[10]*ve+n[14],a[15]=n[3]*Q+n[7]*le+n[11]*ve+n[15]):(p=n[1],g=n[2],_=n[3],x=n[4],C=n[5],S=n[6],R=n[7],B=n[8],N=n[9],H=n[10],Z=n[11],a[0]=c=n[0],a[1]=p,a[2]=g,a[3]=_,a[4]=x,a[5]=C,a[6]=S,a[7]=R,a[8]=B,a[9]=N,a[10]=H,a[11]=Z,a[12]=c*Q+x*le+B*ve+n[12],a[13]=p*Q+C*le+N*ve+n[13],a[14]=g*Q+S*le+H*ve+n[14],a[15]=_*Q+R*le+Z*ve+n[15]),a}function Ns(a,n,s){var c=s[0],p=s[1],g=s[2];return a[0]=n[0]*c,a[1]=n[1]*c,a[2]=n[2]*c,a[3]=n[3]*c,a[4]=n[4]*p,a[5]=n[5]*p,a[6]=n[6]*p,a[7]=n[7]*p,a[8]=n[8]*g,a[9]=n[9]*g,a[10]=n[10]*g,a[11]=n[11]*g,a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15],a}function hv(a,n,s){var c=Math.sin(s),p=Math.cos(s),g=n[4],_=n[5],x=n[6],C=n[7],S=n[8],R=n[9],B=n[10],N=n[11];return n!==a&&(a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[3],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]),a[4]=g*p+S*c,a[5]=_*p+R*c,a[6]=x*p+B*c,a[7]=C*p+N*c,a[8]=S*p-g*c,a[9]=R*p-_*c,a[10]=B*p-x*c,a[11]=N*p-C*c,a}function dv(a,n,s){var c=Math.sin(s),p=Math.cos(s),g=n[0],_=n[1],x=n[2],C=n[3],S=n[8],R=n[9],B=n[10],N=n[11];return n!==a&&(a[4]=n[4],a[5]=n[5],a[6]=n[6],a[7]=n[7],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]),a[0]=g*p-S*c,a[1]=_*p-R*c,a[2]=x*p-B*c,a[3]=C*p-N*c,a[8]=g*c+S*p,a[9]=_*c+R*p,a[10]=x*c+B*p,a[11]=C*c+N*p,a}Math.hypot||(Math.hypot=function(){for(var a=0,n=arguments.length;n--;)a+=arguments[n]*arguments[n];return Math.sqrt(a)});var vR=uv;function pv(){var a=new Zr(3);return Zr!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function mb(a){var n=new Zr(3);return n[0]=a[0],n[1]=a[1],n[2]=a[2],n}function gb(a){return Math.hypot(a[0],a[1],a[2])}function dp(a,n,s){var c=new Zr(3);return c[0]=a,c[1]=n,c[2]=s,c}function yb(a,n,s){return a[0]=n[0]+s[0],a[1]=n[1]+s[1],a[2]=n[2]+s[2],a}function _b(a,n,s){return a[0]=n[0]-s[0],a[1]=n[1]-s[1],a[2]=n[2]-s[2],a}function vb(a,n,s){return a[0]=n[0]*s[0],a[1]=n[1]*s[1],a[2]=n[2]*s[2],a}function fv(a,n,s){return a[0]=Math.min(n[0],s[0]),a[1]=Math.min(n[1],s[1]),a[2]=Math.min(n[2],s[2]),a}function mv(a,n,s){return a[0]=Math.max(n[0],s[0]),a[1]=Math.max(n[1],s[1]),a[2]=Math.max(n[2],s[2]),a}function pp(a,n,s){return a[0]=n[0]*s,a[1]=n[1]*s,a[2]=n[2]*s,a}function gv(a,n,s,c){return a[0]=n[0]+s[0]*c,a[1]=n[1]+s[1]*c,a[2]=n[2]+s[2]*c,a}function fp(a,n){var s=n[0],c=n[1],p=n[2],g=s*s+c*c+p*p;return g>0&&(g=1/Math.sqrt(g)),a[0]=n[0]*g,a[1]=n[1]*g,a[2]=n[2]*g,a}function mp(a,n){return a[0]*n[0]+a[1]*n[1]+a[2]*n[2]}function xb(a,n,s){var c=n[0],p=n[1],g=n[2],_=s[0],x=s[1],C=s[2];return a[0]=p*C-g*x,a[1]=g*_-c*C,a[2]=c*x-p*_,a}function Xl(a,n,s){var c=n[0],p=n[1],g=n[2],_=s[3]*c+s[7]*p+s[11]*g+s[15];return a[0]=(s[0]*c+s[4]*p+s[8]*g+s[12])/(_=_||1),a[1]=(s[1]*c+s[5]*p+s[9]*g+s[13])/_,a[2]=(s[2]*c+s[6]*p+s[10]*g+s[14])/_,a}function bb(a,n,s){var c=s[0],p=s[1],g=s[2],_=n[0],x=n[1],C=n[2],S=p*C-g*x,R=g*_-c*C,B=c*x-p*_,N=p*B-g*R,H=g*S-c*B,Z=c*R-p*S,Q=2*s[3];return R*=Q,B*=Q,H*=2,Z*=2,a[0]=_+(S*=Q)+(N*=2),a[1]=x+R+H,a[2]=C+B+Z,a}var gp,ju=_b,xR=vb,bR=gb;function $u(a,n,s){var c=n[0],p=n[1],g=n[2],_=n[3];return a[0]=s[0]*c+s[4]*p+s[8]*g+s[12]*_,a[1]=s[1]*c+s[5]*p+s[9]*g+s[13]*_,a[2]=s[2]*c+s[6]*p+s[10]*g+s[14]*_,a[3]=s[3]*c+s[7]*p+s[11]*g+s[15]*_,a}function wb(){var a=new Zr(4);return Zr!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function Mb(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function Tb(a,n,s){s*=.5;var c=n[0],p=n[1],g=n[2],_=n[3],x=Math.sin(s),C=Math.cos(s);return a[0]=c*C+_*x,a[1]=p*C+g*x,a[2]=g*C-p*x,a[3]=_*C-c*x,a}pv(),gp=new Zr(4),Zr!=Float32Array&&(gp[0]=0,gp[1]=0,gp[2]=0,gp[3]=0),pv(),dp(1,0,0),dp(0,1,0),wb(),wb(),fb();class yv{constructor(n,s){this.points=n,this.planes=s}static fromInvProjectionMatrix(n,s,c,p){const g=Math.pow(2,c),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(C=>{const S=$u([],C,n),R=1/S[3]/s*g;return function(B,N,H){return B[0]=N[0]*H[0],B[1]=N[1]*H[1],B[2]=N[2]*H[2],B[3]=N[3]*H[3],B}(S,S,[R,R,p?1/S[3]:R,R])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(C=>{const S=fp([],xb([],ju([],_[C[0]],_[C[1]]),ju([],_[C[2]],_[C[1]]))),R=-mp(S,_[C[1]]);return S.concat(R)});return new yv(_,x)}}class go{constructor(n,s){this.min=n,this.max=s,this.center=pp([],yb([],this.min,this.max),.5)}quadrant(n){const s=[n%2==0,n<2],c=mb(this.min),p=mb(this.max);for(let g=0;g<s.length;g++)c[g]=s[g]?this.min[g]:this.center[g],p[g]=s[g]?this.center[g]:this.max[g];return p[2]=this.max[2],new go(c,p)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}distanceZ(n){return Math.max(Math.min(this.max[2],n[2]),this.min[2])-n[2]}getCorners(){const n=this.min,s=this.max;return[[n[0],n[1],n[2]],[s[0],n[1],n[2]],[s[0],s[1],n[2]],[n[0],s[1],n[2]],[n[0],n[1],s[2]],[s[0],n[1],s[2]],[s[0],s[1],s[2]],[n[0],s[1],s[2]]]}intersects(n){const s=this.getCorners();let c=!0;for(let p=0;p<n.planes.length;p++){const g=n.planes[p];let _=0;for(let x=0;x<s.length;x++)_+=mp(g,s[x])+g[3]>=0;if(_===0)return 0;_!==s.length&&(c=!1)}if(c)return 2;for(let p=0;p<3;p++){let g=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let x=0;x<n.points.length;x++){const C=n.points[x][p]-this.min[p];g=Math.min(g,C),_=Math.max(_,C)}if(_<0||g>this.max[p]-this.min[p])return 0}return 1}}function Eb(a,n,s,c,p,g,_,x,C){if(g&&a.queryGeometry.isAboveHorizon)return!1;g&&(C*=a.pixelToTileUnitsFactor);for(const S of n)for(const R of S){const B=R.add(x),N=p&&s.elevation?s.elevation.exaggeration()*p.getElevationAt(B.x,B.y,!0):0,H=g?B:wR(B,N,c),Z=g?a.tilespaceRays.map(le=>TR(le,N)):a.queryGeometry.screenGeometry,Q=$u([],[R.x,R.y,N,1],c);if(!_&&g?C*=Q[3]/s.cameraToCenterDistance:_&&!g&&(C*=s.cameraToCenterDistance/Q[3]),pR(Z,H,C))return!0}return!1}function wR(a,n,s){const c=$u([],[a.x,a.y,n,1],s);return new M(c[0]/c[3],c[1]/c[3])}const Cb=dp(0,0,0),MR=dp(0,0,1);function TR(a,n){const s=pv();return Cb[2]=n,a.intersectsPlane(Cb,MR,s),new M(s[0],s[1])}class Ab extends av{}function Sb(a,{width:n,height:s},c,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==n*s*c)throw new RangeError("mismatched image size")}else p=new Uint8Array(n*s*c);return a.width=n,a.height=s,a.data=p,a}function Db(a,n,s){const{width:c,height:p}=n;c===a.width&&p===a.height||(_v(a,n,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,c),height:Math.min(a.height,p)},s),a.width=c,a.height=p,a.data=n.data)}function _v(a,n,s,c,p,g){if(p.width===0||p.height===0)return n;if(p.width>a.width||p.height>a.height||s.x>a.width-p.width||s.y>a.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>n.width||p.height>n.height||c.x>n.width-p.width||c.y>n.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const _=a.data,x=n.data;for(let C=0;C<p.height;C++){const S=((s.y+C)*a.width+s.x)*g,R=((c.y+C)*n.width+c.x)*g;for(let B=0;B<p.width*g;B++)x[R+B]=_[S+B]}return n}$t(Ab,"HeatmapBucket",{omit:["layers"]});class Xa{constructor(n,s){Sb(this,n,1,s)}resize(n){Db(this,new Xa(n),1)}clone(){return new Xa({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,s,c,p,g){_v(n,s,c,p,g,1)}}class Xr{constructor(n,s){Sb(this,n,4,s)}resize(n){Db(this,new Xr(n),4)}replace(n,s){s?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new Xr({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,s,c,p,g){_v(n,s,c,p,g,4)}}$t(Xa,"AlphaImage"),$t(Xr,"RGBAImage");var ER={paint:new j({"heatmap-radius":new I(Me.paint_heatmap["heatmap-radius"]),"heatmap-weight":new I(Me.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new A(Me.paint_heatmap["heatmap-intensity"]),"heatmap-color":new V(Me.paint_heatmap["heatmap-color"]),"heatmap-opacity":new A(Me.paint_heatmap["heatmap-opacity"])})};function vv(a){const n={},s=a.resolution||256,c=a.clips?a.clips.length:1,p=a.image||new Xr({width:s,height:c}),g=(_,x,C)=>{n[a.evaluationKey]=C;const S=a.expression.evaluate(n);p.data[_+x+0]=Math.floor(255*S.r/S.a),p.data[_+x+1]=Math.floor(255*S.g/S.a),p.data[_+x+2]=Math.floor(255*S.b/S.a),p.data[_+x+3]=Math.floor(255*S.a)};if(a.clips)for(let _=0,x=0;_<c;++_,x+=4*s)for(let C=0,S=0;C<s;C++,S+=4){const R=C/(s-1),{start:B,end:N}=a.clips[_];g(x,S,B*(1-R)+N*R)}else for(let _=0,x=0;_<s;_++,x+=4)g(0,x,_/(s-1));return p}var CR={paint:new j({"hillshade-illumination-direction":new A(Me.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new A(Me.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new A(Me.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new A(Me.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new A(Me.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new A(Me.paint_hillshade["hillshade-accent-color"])})};const AR=Pe([{name:"a_pos",components:2,type:"Int16"}],4),{members:SR}=AR;var vg=xg,DR=xg;function xg(a,n,s){s=s||2;var c,p,g,_,x,C,S,R=n&&n.length,B=R?n[0]*s:a.length,N=Pb(a,0,B,s,!0),H=[];if(!N||N.next===N.prev)return H;if(R&&(N=function(Q,le,ve,Fe){var je,Xe,Ye,Je=[];for(je=0,Xe=le.length;je<Xe;je++)(Ye=Pb(Q,le[je]*Fe,je<Xe-1?le[je+1]*Fe:Q.length,Fe,!1))===Ye.next&&(Ye.steiner=!0),Je.push(FR(Ye));for(Je.sort(zR),je=0;je<Je.length;je++)ve=Us(ve=kR(Je[je],ve),ve.next);return ve}(a,n,N,s)),a.length>80*s){c=g=a[0],p=_=a[1];for(var Z=s;Z<B;Z+=s)(x=a[Z])<c&&(c=x),(C=a[Z+1])<p&&(p=C),x>g&&(g=x),C>_&&(_=C);S=(S=Math.max(g-c,_-p))!==0?1/S:0}return yp(N,H,s,c,p,S),H}function Pb(a,n,s,c,p){var g,_;if(p===wv(a,n,s,c)>0)for(g=n;g<s;g+=c)_=Rb(g,a[g],a[g+1],_);else for(g=s-c;g>=n;g-=c)_=Rb(g,a[g],a[g+1],_);return _&&bg(_,_.next)&&(vp(_),_=_.next),_}function Us(a,n){if(!a)return a;n||(n=a);var s,c=a;do if(s=!1,c.steiner||!bg(c,c.next)&&Li(c.prev,c,c.next)!==0)c=c.next;else{if(vp(c),(c=n=c.prev)===c.next)break;s=!0}while(s||c!==n);return n}function yp(a,n,s,c,p,g,_){if(a){!_&&g&&function(R,B,N,H){var Z=R;do Z.z===null&&(Z.z=xv(Z.x,Z.y,B,N,H)),Z.prevZ=Z.prev,Z.nextZ=Z.next,Z=Z.next;while(Z!==R);Z.prevZ.nextZ=null,Z.prevZ=null,function(Q){var le,ve,Fe,je,Xe,Ye,Je,ut,dt=1;do{for(ve=Q,Q=null,Xe=null,Ye=0;ve;){for(Ye++,Fe=ve,Je=0,le=0;le<dt&&(Je++,Fe=Fe.nextZ);le++);for(ut=dt;Je>0||ut>0&&Fe;)Je!==0&&(ut===0||!Fe||ve.z<=Fe.z)?(je=ve,ve=ve.nextZ,Je--):(je=Fe,Fe=Fe.nextZ,ut--),Xe?Xe.nextZ=je:Q=je,je.prevZ=Xe,Xe=je;ve=Fe}Xe.nextZ=null,dt*=2}while(Ye>1)}(Z)}(a,c,p,g);for(var x,C,S=a;a.prev!==a.next;)if(x=a.prev,C=a.next,g?LR(a,c,p,g):PR(a))n.push(x.i/s),n.push(a.i/s),n.push(C.i/s),vp(a),a=C.next,S=C.next;else if((a=C)===S){_?_===1?yp(a=IR(Us(a),n,s),n,s,c,p,g,2):_===2&&RR(a,n,s,c,p,g):yp(Us(a),n,s,c,p,g,1);break}}}function PR(a){var n=a.prev,s=a,c=a.next;if(Li(n,s,c)>=0)return!1;for(var p=a.next.next;p!==a.prev;){if(qu(n.x,n.y,s.x,s.y,c.x,c.y,p.x,p.y)&&Li(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function LR(a,n,s,c){var p=a.prev,g=a,_=a.next;if(Li(p,g,_)>=0)return!1;for(var x=p.x>g.x?p.x>_.x?p.x:_.x:g.x>_.x?g.x:_.x,C=p.y>g.y?p.y>_.y?p.y:_.y:g.y>_.y?g.y:_.y,S=xv(p.x<g.x?p.x<_.x?p.x:_.x:g.x<_.x?g.x:_.x,p.y<g.y?p.y<_.y?p.y:_.y:g.y<_.y?g.y:_.y,n,s,c),R=xv(x,C,n,s,c),B=a.prevZ,N=a.nextZ;B&&B.z>=S&&N&&N.z<=R;){if(B!==a.prev&&B!==a.next&&qu(p.x,p.y,g.x,g.y,_.x,_.y,B.x,B.y)&&Li(B.prev,B,B.next)>=0||(B=B.prevZ,N!==a.prev&&N!==a.next&&qu(p.x,p.y,g.x,g.y,_.x,_.y,N.x,N.y)&&Li(N.prev,N,N.next)>=0))return!1;N=N.nextZ}for(;B&&B.z>=S;){if(B!==a.prev&&B!==a.next&&qu(p.x,p.y,g.x,g.y,_.x,_.y,B.x,B.y)&&Li(B.prev,B,B.next)>=0)return!1;B=B.prevZ}for(;N&&N.z<=R;){if(N!==a.prev&&N!==a.next&&qu(p.x,p.y,g.x,g.y,_.x,_.y,N.x,N.y)&&Li(N.prev,N,N.next)>=0)return!1;N=N.nextZ}return!0}function IR(a,n,s){var c=a;do{var p=c.prev,g=c.next.next;!bg(p,g)&&Lb(p,c,c.next,g)&&_p(p,g)&&_p(g,p)&&(n.push(p.i/s),n.push(c.i/s),n.push(g.i/s),vp(c),vp(c.next),c=a=g),c=c.next}while(c!==a);return Us(c)}function RR(a,n,s,c,p,g){var _=a;do{for(var x=_.next.next;x!==_.prev;){if(_.i!==x.i&&OR(_,x)){var C=Ib(_,x);return _=Us(_,_.next),C=Us(C,C.next),yp(_,n,s,c,p,g),void yp(C,n,s,c,p,g)}x=x.next}_=_.next}while(_!==a)}function zR(a,n){return a.x-n.x}function kR(a,n){var s=function(g,_){var x,C=_,S=g.x,R=g.y,B=-1/0;do{if(R<=C.y&&R>=C.next.y&&C.next.y!==C.y){var N=C.x+(R-C.y)*(C.next.x-C.x)/(C.next.y-C.y);if(N<=S&&N>B){if(B=N,N===S){if(R===C.y)return C;if(R===C.next.y)return C.next}x=C.x<C.next.x?C:C.next}}C=C.next}while(C!==_);if(!x)return null;if(S===B)return x;var H,Z=x,Q=x.x,le=x.y,ve=1/0;C=x;do S>=C.x&&C.x>=Q&&S!==C.x&&qu(R<le?S:B,R,Q,le,R<le?B:S,R,C.x,C.y)&&(H=Math.abs(R-C.y)/(S-C.x),_p(C,g)&&(H<ve||H===ve&&(C.x>x.x||C.x===x.x&&BR(x,C)))&&(x=C,ve=H)),C=C.next;while(C!==Z);return x}(a,n);if(!s)return n;var c=Ib(s,a),p=Us(s,s.next);return Us(c,c.next),n===s?p:n}function BR(a,n){return Li(a.prev,a,n.prev)<0&&Li(n.next,a,a.next)<0}function xv(a,n,s,c,p){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-s)*p)|a<<8))|a<<4))|a<<2))|a<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-c)*p)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function FR(a){var n=a,s=a;do(n.x<s.x||n.x===s.x&&n.y<s.y)&&(s=n),n=n.next;while(n!==a);return s}function qu(a,n,s,c,p,g,_,x){return(p-_)*(n-x)-(a-_)*(g-x)>=0&&(a-_)*(c-x)-(s-_)*(n-x)>=0&&(s-_)*(g-x)-(p-_)*(c-x)>=0}function OR(a,n){return a.next.i!==n.i&&a.prev.i!==n.i&&!function(s,c){var p=s;do{if(p.i!==s.i&&p.next.i!==s.i&&p.i!==c.i&&p.next.i!==c.i&&Lb(p,p.next,s,c))return!0;p=p.next}while(p!==s);return!1}(a,n)&&(_p(a,n)&&_p(n,a)&&function(s,c){var p=s,g=!1,_=(s.x+c.x)/2,x=(s.y+c.y)/2;do p.y>x!=p.next.y>x&&p.next.y!==p.y&&_<(p.next.x-p.x)*(x-p.y)/(p.next.y-p.y)+p.x&&(g=!g),p=p.next;while(p!==s);return g}(a,n)&&(Li(a.prev,a,n.prev)||Li(a,n.prev,n))||bg(a,n)&&Li(a.prev,a,a.next)>0&&Li(n.prev,n,n.next)>0)}function Li(a,n,s){return(n.y-a.y)*(s.x-n.x)-(n.x-a.x)*(s.y-n.y)}function bg(a,n){return a.x===n.x&&a.y===n.y}function Lb(a,n,s,c){var p=Mg(Li(a,n,s)),g=Mg(Li(a,n,c)),_=Mg(Li(s,c,a)),x=Mg(Li(s,c,n));return p!==g&&_!==x||!(p!==0||!wg(a,s,n))||!(g!==0||!wg(a,c,n))||!(_!==0||!wg(s,a,c))||!(x!==0||!wg(s,n,c))}function wg(a,n,s){return n.x<=Math.max(a.x,s.x)&&n.x>=Math.min(a.x,s.x)&&n.y<=Math.max(a.y,s.y)&&n.y>=Math.min(a.y,s.y)}function Mg(a){return a>0?1:a<0?-1:0}function _p(a,n){return Li(a.prev,a,a.next)<0?Li(a,n,a.next)>=0&&Li(a,a.prev,n)>=0:Li(a,n,a.prev)<0||Li(a,a.next,n)<0}function Ib(a,n){var s=new bv(a.i,a.x,a.y),c=new bv(n.i,n.x,n.y),p=a.next,g=n.prev;return a.next=n,n.prev=a,s.next=p,p.prev=s,c.next=s,s.prev=c,g.next=c,c.prev=g,c}function Rb(a,n,s,c){var p=new bv(a,n,s);return c?(p.next=c.next,p.prev=c,c.next.prev=p,c.next=p):(p.prev=p,p.next=p),p}function vp(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function bv(a,n,s){this.i=a,this.x=n,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function wv(a,n,s,c){for(var p=0,g=n,_=s-c;g<s;g+=c)p+=(a[_]-a[g])*(a[g+1]+a[_+1]),_=g;return p}function NR(a,n,s,c,p){zb(a,n,s||0,c||a.length-1,p||UR)}function zb(a,n,s,c,p){for(;c>s;){if(c-s>600){var g=c-s+1,_=n-s+1,x=Math.log(g),C=.5*Math.exp(2*x/3),S=.5*Math.sqrt(x*C*(g-C)/g)*(_-g/2<0?-1:1);zb(a,n,Math.max(s,Math.floor(n-_*C/g+S)),Math.min(c,Math.floor(n+(g-_)*C/g+S)),p)}var R=a[n],B=s,N=c;for(xp(a,s,n),p(a[c],R)>0&&xp(a,s,c);B<N;){for(xp(a,B,N),B++,N--;p(a[B],R)<0;)B++;for(;p(a[N],R)>0;)N--}p(a[s],R)===0?xp(a,s,N):xp(a,++N,c),N<=n&&(s=N+1),n<=N&&(c=N-1)}}function xp(a,n,s){var c=a[n];a[n]=a[s],a[s]=c}function UR(a,n){return a<n?-1:a>n?1:0}function Mv(a,n){const s=a.length;if(s<=1)return[a];const c=[];let p,g;for(let _=0;_<s;_++){const x=Ge(a[_]);x!==0&&(a[_].area=Math.abs(x),g===void 0&&(g=x<0),g===x<0?(p&&c.push(p),p=[a[_]]):p.push(a[_]))}if(p&&c.push(p),n>1)for(let _=0;_<c.length;_++)c[_].length<=n||(NR(c[_],n,1,c[_].length-1,VR),c[_]=c[_].slice(0,n));return c}function VR(a,n){return n.area-a.area}function Tv(a,n,s){const c=s.patternDependencies;let p=!1;for(const g of n){const _=g.paint.get(`${a}-pattern`);_.isConstant()||(p=!0);const x=_.constantOr(null);x&&(p=!0,c[x.to]=!0,c[x.from]=!0)}return p}function Ev(a,n,s,c,p){const g=p.patternDependencies;for(const _ of n){const x=_.paint.get(`${a}-pattern`).value;if(x.kind!=="constant"){let C=x.evaluate({zoom:c-1},s,{},p.availableImages),S=x.evaluate({zoom:c},s,{},p.availableImages),R=x.evaluate({zoom:c+1},s,{},p.availableImages);C=C&&C.name?C.name:C,S=S&&S.name?S.name:S,R=R&&R.name?R.name:R,g[C]=!0,g[S]=!0,g[R]=!0,s.patterns[_.id]={min:C,mid:S,max:R}}}return s}xg.deviation=function(a,n,s,c){var p=n&&n.length,g=Math.abs(wv(a,0,p?n[0]*s:a.length,s));if(p)for(var _=0,x=n.length;_<x;_++)g-=Math.abs(wv(a,n[_]*s,_<x-1?n[_+1]*s:a.length,s));var C=0;for(_=0;_<c.length;_+=3){var S=c[_]*s,R=c[_+1]*s,B=c[_+2]*s;C+=Math.abs((a[S]-a[B])*(a[R+1]-a[S+1])-(a[S]-a[R])*(a[B+1]-a[S+1]))}return g===0&&C===0?0:Math.abs((C-g)/g)},xg.flatten=function(a){for(var n=a[0][0].length,s={vertices:[],holes:[],dimensions:n},c=0,p=0;p<a.length;p++){for(var g=0;g<a[p].length;g++)for(var _=0;_<n;_++)s.vertices.push(a[p][g][_]);p>0&&s.holes.push(c+=a[p-1].length)}return s},vg.default=DR;class Tg{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.id),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ae,this.indexArray=new qt,this.indexArray2=new Mn,this.programConfigurations=new $l(n.layers,n.zoom),this.segments=new Ei,this.segments2=new Ei,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.projection=n.projection}populate(n,s,c,p){this.hasPattern=Tv("fill",this.layers,s);const g=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:x,id:C,index:S,sourceLayerIndex:R}of n){const B=this.layers[0]._featureFilter.needGeometry,N=ql(x,B);if(!this.layers[0]._featureFilter.filter(new ci(this.zoom),N,c))continue;const H=g?g.evaluate(N,{},c,s.availableImages):void 0,Z={id:C,properties:x.properties,type:x.type,sourceLayerIndex:R,index:S,geometry:B?N.geometry:Za(x,c,p),patterns:{},sortKey:H};_.push(Z)}g&&_.sort((x,C)=>x.sortKey-C.sortKey);for(const x of _){const{geometry:C,index:S,sourceLayerIndex:R}=x;if(this.hasPattern){const B=Ev("fill",this.layers,x,this.zoom,s);this.patternFeatures.push(B)}else this.addFeature(x,C,S,c,{},s.availableImages);s.featureIndex.insert(n[S].feature,C,S,R,this.index)}}update(n,s,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,c,p)}addFeatures(n,s,c,p,g){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,s,c,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,SR),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,s,c,p,g,_=[]){for(const x of Mv(s,500)){let C=0;for(const Z of x)C+=Z.length;const S=this.segments.prepareSegment(C,this.layoutVertexArray,this.indexArray),R=S.vertexLength,B=[],N=[];for(const Z of x){if(Z.length===0)continue;Z!==x[0]&&N.push(B.length/2);const Q=this.segments2.prepareSegment(Z.length,this.layoutVertexArray,this.indexArray2),le=Q.vertexLength;this.layoutVertexArray.emplaceBack(Z[0].x,Z[0].y),this.indexArray2.emplaceBack(le+Z.length-1,le),B.push(Z[0].x),B.push(Z[0].y);for(let ve=1;ve<Z.length;ve++)this.layoutVertexArray.emplaceBack(Z[ve].x,Z[ve].y),this.indexArray2.emplaceBack(le+ve-1,le+ve),B.push(Z[ve].x),B.push(Z[ve].y);Q.vertexLength+=Z.length,Q.primitiveLength+=Z.length}const H=vg(B,N);for(let Z=0;Z<H.length;Z+=3)this.indexArray.emplaceBack(R+H[Z],R+H[Z+1],R+H[Z+2]);S.vertexLength+=C,S.primitiveLength+=H.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,c,g,_,p)}}$t(Tg,"FillBucket",{omit:["layers","patternFeatures"]});const GR=new j({"fill-sort-key":new I(Me.layout_fill["fill-sort-key"])});var HR={paint:new j({"fill-antialias":new A(Me.paint_fill["fill-antialias"]),"fill-opacity":new I(Me.paint_fill["fill-opacity"]),"fill-color":new I(Me.paint_fill["fill-color"]),"fill-outline-color":new I(Me.paint_fill["fill-outline-color"]),"fill-translate":new A(Me.paint_fill["fill-translate"]),"fill-translate-anchor":new A(Me.paint_fill["fill-translate-anchor"]),"fill-pattern":new O(Me.paint_fill["fill-pattern"])}),layout:GR};const WR=Pe([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),jR=Pe([{name:"a_centroid_pos",components:2,type:"Uint16"}]),$R=Pe([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:qR}=WR;var kb=Zu;function Zu(a,n,s,c,p){this.properties={},this.extent=s,this.type=0,this._pbf=a,this._geometry=-1,this._keys=c,this._values=p,a.readFields(ZR,this,n)}function ZR(a,n,s){a==1?n.id=s.readVarint():a==2?function(c,p){for(var g=c.readVarint()+c.pos;c.pos<g;){var _=p._keys[c.readVarint()],x=p._values[c.readVarint()];p.properties[_]=x}}(s,n):a==3?n.type=s.readVarint():a==4&&(n._geometry=s.pos)}function XR(a){for(var n,s,c=0,p=0,g=a.length,_=g-1;p<g;_=p++)c+=((s=a[_]).x-(n=a[p]).x)*(n.y+s.y);return c}Zu.types=["Unknown","Point","LineString","Polygon"],Zu.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var n,s=a.readVarint()+a.pos,c=1,p=0,g=0,_=0,x=[];a.pos<s;){if(p<=0){var C=a.readVarint();c=7&C,p=C>>3}if(p--,c===1||c===2)g+=a.readSVarint(),_+=a.readSVarint(),c===1&&(n&&x.push(n),n=[]),n.push(new M(g,_));else{if(c!==7)throw new Error("unknown command "+c);n&&n.push(n[0].clone())}}return n&&x.push(n),x},Zu.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var n=a.readVarint()+a.pos,s=1,c=0,p=0,g=0,_=1/0,x=-1/0,C=1/0,S=-1/0;a.pos<n;){if(c<=0){var R=a.readVarint();s=7&R,c=R>>3}if(c--,s===1||s===2)(p+=a.readSVarint())<_&&(_=p),p>x&&(x=p),(g+=a.readSVarint())<C&&(C=g),g>S&&(S=g);else if(s!==7)throw new Error("unknown command "+s)}return[_,C,x,S]},Zu.prototype.toGeoJSON=function(a,n,s){var c,p,g=this.extent*Math.pow(2,s),_=this.extent*a,x=this.extent*n,C=this.loadGeometry(),S=Zu.types[this.type];function R(H){for(var Z=0;Z<H.length;Z++){var Q=H[Z];H[Z]=[360*(Q.x+_)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(Q.y+x)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var B=[];for(c=0;c<C.length;c++)B[c]=C[c][0];R(C=B);break;case 2:for(c=0;c<C.length;c++)R(C[c]);break;case 3:for(C=function(H){var Z=H.length;if(Z<=1)return[H];for(var Q,le,ve=[],Fe=0;Fe<Z;Fe++){var je=XR(H[Fe]);je!==0&&(le===void 0&&(le=je<0),le===je<0?(Q&&ve.push(Q),Q=[H[Fe]]):Q.push(H[Fe]))}return Q&&ve.push(Q),ve}(C),c=0;c<C.length;c++)for(p=0;p<C[c].length;p++)R(C[c][p])}C.length===1?C=C[0]:S="Multi"+S;var N={type:"Feature",geometry:{type:S,coordinates:C},properties:this.properties};return"id"in this&&(N.id=this.id),N};var Bb=Fb;function Fb(a,n){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(YR,this,n),this.length=this._features.length}function YR(a,n,s){a===15?n.version=s.readVarint():a===1?n.name=s.readString():a===5?n.extent=s.readVarint():a===2?n._features.push(s.pos):a===3?n._keys.push(s.readString()):a===4&&n._values.push(function(c){for(var p=null,g=c.readVarint()+c.pos;c.pos<g;){var _=c.readVarint()>>3;p=_===1?c.readString():_===2?c.readFloat():_===3?c.readDouble():_===4?c.readVarint64():_===5?c.readVarint():_===6?c.readSVarint():_===7?c.readBoolean():null}return p}(s))}function JR(a,n,s){if(a===3){var c=new Bb(s,s.readVarint()+s.pos);c.length&&(n[c.name]=c)}}Fb.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var n=this._pbf.readVarint()+this._pbf.pos;return new kb(this._pbf,n,this.extent,this._keys,this._values)};var Yl={VectorTile:function(a,n){this.layers=a.readFields(JR,{},n)},VectorTileFeature:kb,VectorTileLayer:Bb};function Eg(a,n,s,c){const p=[],g=c===0?(_,x,C,S,R,B)=>{_.push(new M(B,C+(B-x)/(S-x)*(R-C)))}:(_,x,C,S,R,B)=>{_.push(new M(x+(B-C)/(R-C)*(S-x),B))};for(const _ of a){const x=[];for(const C of _){if(C.length<=2)continue;const S=[];for(let N=0;N<C.length-1;N++){const H=C[N].x,Z=C[N].y,Q=C[N+1].x,le=C[N+1].y,ve=c===0?H:Z,Fe=c===0?Q:le;ve<n?Fe>n&&g(S,H,Z,Q,le,n):ve>s?Fe<s&&g(S,H,Z,Q,le,s):S.push(C[N]),Fe<n&&ve>=n&&g(S,H,Z,Q,le,n),Fe>s&&ve<=s&&g(S,H,Z,Q,le,s)}let R=C[C.length-1];const B=c===0?R.x:R.y;B>=n&&B<=s&&S.push(R),S.length&&(R=S[S.length-1],S[0].x===R.x&&S[0].y===R.y||S.push(S[0]),x.push(S))}x.length&&p.push(x)}return p}const KR=Yl.VectorTileFeature.types,QR=Math.pow(2,13);function bp(a,n,s,c,p,g,_,x){a.emplaceBack((n<<1)+_,(s<<1)+g,(Math.floor(c*QR)<<1)+p,Math.round(x))}function wp(a,n,s){a.emplaceBack(n.x,n.y,n.z,s[0]*16384,s[1]*16384,s[2]*16384)}class Ob{constructor(){this.acc=new M(0,0),this.polyCount=[]}startRing(n){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new M(n.x,n.y),this.max=new M(n.x,n.y))}append(n,s){this.currentPolyCount.edges++,this.acc._add(n);const c=this.min,p=this.max;n.x<c.x?c.x=n.x:n.x>p.x&&(p.x=n.x),n.y<c.y?c.y=n.y:n.y>p.y&&(p.y=n.y),((n.x===0||n.x===In)&&n.x===s.x)!=((n.y===0||n.y===In)&&n.y===s.y)&&this.processBorderOverlap(n,s),s.x<0!=n.x<0&&this.addBorderIntersection(0,yn(s.y,n.y,(0-s.x)/(n.x-s.x))),s.x>In!=n.x>In&&this.addBorderIntersection(1,yn(s.y,n.y,(In-s.x)/(n.x-s.x))),s.y<0!=n.y<0&&this.addBorderIntersection(2,yn(s.x,n.x,(0-s.y)/(n.y-s.y))),s.y>In!=n.y>In&&this.addBorderIntersection(3,yn(s.x,n.x,(In-s.y)/(n.y-s.y)))}addBorderIntersection(n,s){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const c=this.borders[n];s<c[0]&&(c[0]=s),s>c[1]&&(c[1]=s)}processBorderOverlap(n,s){if(n.x===s.x){if(n.y===s.y)return;const c=n.x===0?0:1;this.addBorderIntersection(c,s.y),this.addBorderIntersection(c,n.y)}else{const c=n.y===0?2:3;this.addBorderIntersection(c,s.x),this.addBorderIntersection(c,n.x)}}centroid(){const n=this.polyCount.reduce((s,c)=>s+c.edges,0);return n!==0?this.acc.div(n)._round():new M(0,0)}span(){return new M(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((n,s)=>n+ +(s[0]!==Number.MAX_VALUE),0)}}class Mp{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.id),this.index=n.index,this.hasPattern=!1,this.projection=n.projection,this.layoutVertexArray=new ke,this.centroidVertexArray=new jl,this.indexArray=new qt,this.programConfigurations=new $l(n.layers,n.zoom),this.segments=new Ei,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id),this.enableTerrain=n.enableTerrain}populate(n,s,c,p){this.features=[],this.hasPattern=Tv("fill-extrusion",this.layers,s),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(g){const _=Math.exp(Math.PI*(1-g.y/(1<<g.z)*2));return 80150034*_/(_*_+1)/In/(1<<g.z)}(c);for(const{feature:g,id:_,index:x,sourceLayerIndex:C}of n){const S=this.layers[0]._featureFilter.needGeometry,R=ql(g,S);if(!this.layers[0]._featureFilter.filter(new ci(this.zoom),R,c))continue;const B={id:_,sourceLayerIndex:C,index:x,geometry:S?R.geometry:Za(g,c,p),properties:g.properties,type:g.type,patterns:{}},N=this.layoutVertexArray.length;this.hasPattern?this.features.push(Ev("fill-extrusion",this.layers,B,this.zoom,s)):this.addFeature(B,B.geometry,x,c,{},s.availableImages,p),s.featureIndex.insert(g,B.geometry,x,C,this.index,N)}this.sortBorders()}addFeatures(n,s,c,p,g){for(const _ of this.features){const{geometry:x}=_;this.addFeature(_,x,_.index,s,c,p,g)}this.sortBorders()}update(n,s,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,c,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,qR),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=n.createVertexBuffer(this.layoutVertexExtArray,$R.members,!0))),this.programConfigurations.upload(n),this.uploaded=!0}uploadCentroid(n){this.centroidVertexArray.length!==0&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,jR.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,s,c,p,g,_,x){const C=[new M(0,0),new M(In,In)],S=x.projection,R=S.name==="globe",B=this.enableTerrain&&!R?new Ob:null;R&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Rr);const N=Mv(s,500);for(let Q=N.length-1;Q>=0;Q--){const le=N[Q];(le.length===0||(H=le[0]).every(ve=>ve.x<=0)||H.every(ve=>ve.x>=In)||H.every(ve=>ve.y<=0)||H.every(ve=>ve.y>=In))&&N.splice(Q,1)}var H;let Z;if(R){const le=1<<p.z,ve=To(p.x/le),Fe=To((p.x+1)/le),je=rr(p.y/le),Xe=rr((p.y+1)/le);Z=function(Ye,Je,ut,dt,xt=0,Et){const ot=[];if(!Ye.length||!ut||!dt)return ot;const mt=(An,Bn)=>{for(const Qt of An)ot.push({polygon:Qt,bounds:Bn})},Dt=Math.ceil(Math.log2(ut)),Ft=Math.ceil(Math.log2(dt)),Rt=Dt-Ft,Bt=[];for(let An=0;An<Math.abs(Rt);An++)Bt.push(Rt>0?0:1);for(let An=0;An<Math.min(Dt,Ft);An++)Bt.push(0),Bt.push(1);let En=Ye;if(En=Eg(En,Je[0].y-xt,Je[1].y+xt,1),En=Eg(En,Je[0].x-xt,Je[1].x+xt,0),!En.length)return ot;const Un=[];for(Bt.length?Un.push({polygons:En,bounds:Je,depth:0}):mt(En,Je);Un.length;){const An=Un.pop(),Bn=An.depth,Qt=Bt[Bn],jt=An.bounds[0],Vn=An.bounds[1],Jn=Qt===0?jt.x:jt.y,Fi=Qt===0?Vn.x:Vn.y,ui=Et?Et(Qt,Jn,Fi):.5*(Jn+Fi),Oi=Eg(An.polygons,Jn-xt,ui+xt,Qt),Kn=Eg(An.polygons,ui-xt,Fi+xt,Qt);if(Oi.length){const Hn=[jt,new M(Qt===0?ui:Vn.x,Qt===1?ui:Vn.y)];Bt.length>Bn+1?Un.push({polygons:Oi,bounds:Hn,depth:Bn+1}):mt(Oi,Hn)}if(Kn.length){const Hn=[new M(Qt===0?ui:jt.x,Qt===1?ui:jt.y),Vn];Bt.length>Bn+1?Un.push({polygons:Kn,bounds:Hn,depth:Bn+1}):mt(Kn,Hn)}}return ot}(N,C,Math.ceil((Fe-ve)/11.25),Math.ceil((je-Xe)/11.25),1,(Ye,Je,ut)=>{if(Ye===0)return .5*(Je+ut);{const dt=rr((p.y+Je/In)/le);return(Vu(.5*(rr((p.y+ut/In)/le)+dt))*le-p.y)*In}})}else{Z=[];for(const Q of N)Z.push({polygon:Q,bounds:C})}for(const Q of Z){const le=Q.polygon;let ve=0,Fe=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let ut=0;ut<le.length;ut++){const dt=le[ut];if(dt.length===0)continue;ve+=dt.length;let xt=0;B&&B.startRing(dt[0]);for(let Et=0;Et<dt.length;Et++){const ot=dt[Et];if(Et>=1){const mt=dt[Et-1];if(!ez(ot,mt,Q.bounds)){B&&B.append(ot,mt),Fe.vertexLength+4>Ei.MAX_VERTEX_ARRAY_LENGTH&&(Fe=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Dt=ot.sub(mt)._perp(),Ft=Dt.x/(Math.abs(Dt.x)+Math.abs(Dt.y)),Rt=Dt.y>0?1:0,Bt=mt.dist(ot);xt+Bt>32768&&(xt=0),bp(this.layoutVertexArray,ot.x,ot.y,Ft,Rt,0,0,xt),bp(this.layoutVertexArray,ot.x,ot.y,Ft,Rt,0,1,xt),xt+=Bt,bp(this.layoutVertexArray,mt.x,mt.y,Ft,Rt,0,0,xt),bp(this.layoutVertexArray,mt.x,mt.y,Ft,Rt,0,1,xt);const En=Fe.vertexLength;if(this.indexArray.emplaceBack(En,En+2,En+1),this.indexArray.emplaceBack(En+1,En+2,En+3),Fe.vertexLength+=4,Fe.primitiveLength+=2,R){const Un=this.layoutVertexExtArray,An=S.projectTilePoint(ot.x,ot.y,p),Bn=S.projectTilePoint(mt.x,mt.y,p),Qt=S.upVector(p,ot.x,ot.y),jt=S.upVector(p,mt.x,mt.y);wp(Un,An,Qt),wp(Un,An,Qt),wp(Un,Bn,jt),wp(Un,Bn,jt)}}}}}if(Fe.vertexLength+ve>Ei.MAX_VERTEX_ARRAY_LENGTH&&(Fe=this.segments.prepareSegment(ve,this.layoutVertexArray,this.indexArray)),KR[n.type]!=="Polygon")continue;const je=[],Xe=[],Ye=Fe.vertexLength;for(let ut=0;ut<le.length;ut++){const dt=le[ut];if(dt.length!==0){dt!==le[0]&&Xe.push(je.length/2);for(let xt=0;xt<dt.length;xt++){const Et=dt[xt];bp(this.layoutVertexArray,Et.x,Et.y,0,0,1,1,0),je.push(Et.x),je.push(Et.y),B&&B.currentPolyCount.top++,R&&wp(this.layoutVertexExtArray,S.projectTilePoint(Et.x,Et.y,p),S.upVector(p,Et.x,Et.y))}}}const Je=vg(je,Xe);for(let ut=0;ut<Je.length;ut+=3)this.indexArray.emplaceBack(Ye+Je[ut],Ye+Je[ut+2],Ye+Je[ut+1]);Fe.primitiveLength+=Je.length/3,Fe.vertexLength+=ve}if(B&&B.polyCount.length>0){if(B.borders){B.vertexArrayOffset=this.centroidVertexArray.length;const Q=B.borders,le=this.featuresOnBorder.push(B)-1;for(let ve=0;ve<4;ve++)Q[ve][0]!==Number.MAX_VALUE&&this.borders[ve].push(le)}this.encodeCentroid(B.borders?void 0:B.centroid(),B)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,c,g,_,p)}sortBorders(){for(let n=0;n<4;n++)this.borders[n].sort((s,c)=>this.featuresOnBorder[s].borders[n][0]-this.featuresOnBorder[c].borders[n][0])}encodeCentroid(n,s,c=!0){let p,g;if(n)if(n.y!==0){const x=s.span()._mult(this.tileToMeter);p=(Math.max(n.x,1)<<3)+Math.min(7,Math.round(x.x/10)),g=(Math.max(n.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else p=Math.ceil(7*(n.x+450)),g=0;else p=0,g=+c;let _=c?this.centroidVertexArray.length:s.vertexArrayOffset;for(const x of s.polyCount){c&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let C=0;C<2*x.edges;C++)this.centroidVertexArray.emplace(_++,0,g),this.centroidVertexArray.emplace(_++,p,g);for(let C=0;C<x.top;C++)this.centroidVertexArray.emplace(_++,p,g)}}}function ez(a,n,s){return a.x===n.x&&(a.x<s[0].x||a.x>s[1].x)||a.y===n.y&&(a.y<s[0].y||a.y>s[1].y)}$t(Mp,"FillExtrusionBucket",{omit:["layers","features"]}),$t(Ob,"PartMetadata");var tz={paint:new j({"fill-extrusion-opacity":new A(Me["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new I(Me["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new A(Me["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new A(Me["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new O(Me["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new I(Me["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new I(Me["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new A(Me["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function Tp(a,n){return a.x*n.x+a.y*n.y}function Nb(a,n){if(a.length===1){let s=0;const c=n[s++];let p;for(;!p||c.equals(p);)if(p=n[s++],!p)return 1/0;for(;s<n.length;s++){const g=n[s],_=a[0],x=p.sub(c),C=g.sub(c),S=_.sub(c),R=Tp(x,x),B=Tp(x,C),N=Tp(C,C),H=Tp(S,x),Z=Tp(S,C),Q=R*N-B*B,le=(N*H-B*Z)/Q,ve=(R*Z-B*H)/Q,Fe=c.z*(1-le-ve)+p.z*le+g.z*ve;if(isFinite(Fe))return Fe}return 1/0}{let s=1/0;for(const c of n)s=Math.min(s,c.z);return s}}function Ub(a){const n=new M(a[0],a[1]);return n.z=a[2],n}function nz(a,n,s,c,p,g,_,x){const C=_*p.getElevationAt(a,n,!0,!0),S=g[0]!==0,R=S?g[1]===0?_*(g[0]/7-450):_*function(B,N,H){const Z=Math.floor(N[0]/8),Q=Math.floor(N[1]/8),le=10*(N[0]-8*Z),ve=10*(N[1]-8*Q),Fe=B.getElevationAt(Z,Q,!0,!0),je=B.getMeterToDEM(H),Xe=Math.floor(.5*(le*je-1)),Ye=Math.floor(.5*(ve*je-1)),Je=B.tileCoordToPixel(Z,Q),ut=2*Xe+1,dt=2*Ye+1,xt=function(Rt,Bt,En,Un,An){return[Rt.getElevationAtPixel(Bt,En,!0),Rt.getElevationAtPixel(Bt+An,En,!0),Rt.getElevationAtPixel(Bt,En+An,!0),Rt.getElevationAtPixel(Bt+Un,En+An,!0)]}(B,Je.x-Xe,Je.y-Ye,ut,dt),Et=Math.abs(xt[0]-xt[1]),ot=Math.abs(xt[2]-xt[3]),mt=Math.abs(xt[0]-xt[2])+Math.abs(xt[1]-xt[3]),Dt=Math.min(.25,.5*je*(Et+ot)/ut),Ft=Math.min(.25,.5*je*mt/dt);return Fe+Math.max(Dt*le,Ft*ve)}(p,g,x):C;return{base:C+(s===0)?-1:s,top:S?Math.max(R+c,C+s+2):C+c}}const iz=Pe([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:rz}=iz,oz=Pe([{name:"a_packed",components:3,type:"Float32"}]),{members:az}=oz,sz=Yl.VectorTileFeature.types,lz=Math.cos(Math.PI/180*37.5);class Cg{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(s=>s.id),this.index=n.index,this.projection=n.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(s=>{this.gradients[s.id]={}}),this.layoutVertexArray=new Te,this.layoutVertexArray2=new zt,this.indexArray=new qt,this.programConfigurations=new $l(n.layers,n.zoom),this.segments=new Ei,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(s=>s.isStateDependent()).map(s=>s.id)}populate(n,s,c,p){this.hasPattern=Tv("line",this.layers,s);const g=this.layers[0].layout.get("line-sort-key"),_=[];for(const{feature:R,id:B,index:N,sourceLayerIndex:H}of n){const Z=this.layers[0]._featureFilter.needGeometry,Q=ql(R,Z);if(!this.layers[0]._featureFilter.filter(new ci(this.zoom),Q,c))continue;const le=g?g.evaluate(Q,{},c):void 0,ve={id:B,properties:R.properties,type:R.type,sourceLayerIndex:H,index:N,geometry:Z?Q.geometry:Za(R,c,p),patterns:{},sortKey:le};_.push(ve)}g&&_.sort((R,B)=>R.sortKey-B.sortKey);const{lineAtlas:x,featureIndex:C}=s,S=this.addConstantDashes(x);for(const R of _){const{geometry:B,index:N,sourceLayerIndex:H}=R;if(S&&this.addFeatureDashes(R,x),this.hasPattern){const Z=Ev("line",this.layers,R,this.zoom,s);this.patternFeatures.push(Z)}else this.addFeature(R,B,N,c,x.positions,s.availableImages);C.insert(n[N].feature,B,N,H,this.index)}}addConstantDashes(n){let s=!1;for(const c of this.layers){const p=c.paint.get("line-dasharray").value,g=c.layout.get("line-cap").value;if(p.kind!=="constant"||g.kind!=="constant")s=!0;else{const _=g.value,x=p.value;if(!x)continue;n.addDash(x.from,_),n.addDash(x.to,_),x.other&&n.addDash(x.other,_)}}return s}addFeatureDashes(n,s){const c=this.zoom;for(const p of this.layers){const g=p.paint.get("line-dasharray").value,_=p.layout.get("line-cap").value;if(g.kind==="constant"&&_.kind==="constant")continue;let x,C,S,R,B,N;if(g.kind==="constant"){const le=g.value;if(!le)continue;x=le.other||le.to,C=le.to,S=le.from}else x=g.evaluate({zoom:c-1},n),C=g.evaluate({zoom:c},n),S=g.evaluate({zoom:c+1},n);_.kind==="constant"?R=B=N=_.value:(R=_.evaluate({zoom:c-1},n),B=_.evaluate({zoom:c},n),N=_.evaluate({zoom:c+1},n)),s.addDash(x,R),s.addDash(C,B),s.addDash(S,N);const H=s.getKey(x,R),Z=s.getKey(C,B),Q=s.getKey(S,N);n.patterns[p.id]={min:H,mid:Z,max:Q}}}update(n,s,c,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(n,s,this.stateDependentLayers,c,p)}addFeatures(n,s,c,p,g){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,s,c,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,az)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,rz),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&n.properties.hasOwnProperty("mapbox_clip_start")&&n.properties.hasOwnProperty("mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,s,c,p,g,_){const x=this.layers[0].layout,C=x.get("line-join").evaluate(n,{}),S=x.get("line-cap").evaluate(n,{}),R=x.get("line-miter-limit"),B=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(n);for(const N of s)this.addLine(N,n,C,S,R,B);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,c,g,_,p)}addLine(n,s,c,p,g,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ve=0;ve<n.length-1;ve++)this.totalDistance+=n[ve].dist(n[ve+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x=sz[s.type]==="Polygon";let C=n.length;for(;C>=2&&n[C-1].equals(n[C-2]);)C--;let S=0;for(;S<C-1&&n[S].equals(n[S+1]);)S++;if(C<(x?3:2))return;c==="bevel"&&(g=1.05);const R=this.overscaling<=16?122880/(512*this.overscaling):0,B=this.segments.prepareSegment(10*C,this.layoutVertexArray,this.indexArray);let N,H,Z,Q,le;this.e1=this.e2=-1,x&&(N=n[C-2],le=n[S].sub(N)._unit()._perp());for(let ve=S;ve<C;ve++){if(Z=ve===C-1?x?n[S+1]:void 0:n[ve+1],Z&&n[ve].equals(Z))continue;le&&(Q=le),N&&(H=N),N=n[ve],le=Z?Z.sub(N)._unit()._perp():Q,Q=Q||le;let Fe=Q.add(le);Fe.x===0&&Fe.y===0||Fe._unit();const je=Q.x*le.x+Q.y*le.y,Xe=Fe.x*le.x+Fe.y*le.y,Ye=Xe!==0?1/Xe:1/0,Je=2*Math.sqrt(2-2*Xe),ut=Xe<lz&&H&&Z,dt=Q.x*le.y-Q.y*le.x>0;if(ut&&ve>S){const ot=N.dist(H);if(ot>2*R){const mt=N.sub(N.sub(H)._mult(R/ot)._round());this.updateDistance(H,mt),this.addCurrentVertex(mt,Q,0,0,B),H=mt}}const xt=H&&Z;let Et=xt?c:x?"butt":p;if(xt&&Et==="round"&&(Ye<_?Et="miter":Ye<=2&&(Et="fakeround")),Et==="miter"&&Ye>g&&(Et="bevel"),Et==="bevel"&&(Ye>2&&(Et="flipbevel"),Ye<g&&(Et="miter")),H&&this.updateDistance(H,N),Et==="miter")Fe._mult(Ye),this.addCurrentVertex(N,Fe,0,0,B);else if(Et==="flipbevel"){if(Ye>100)Fe=le.mult(-1);else{const ot=Ye*Q.add(le).mag()/Q.sub(le).mag();Fe._perp()._mult(ot*(dt?-1:1))}this.addCurrentVertex(N,Fe,0,0,B),this.addCurrentVertex(N,Fe.mult(-1),0,0,B)}else if(Et==="bevel"||Et==="fakeround"){const ot=-Math.sqrt(Ye*Ye-1),mt=dt?ot:0,Dt=dt?0:ot;if(H&&this.addCurrentVertex(N,Q,mt,Dt,B),Et==="fakeround"){const Ft=Math.round(180*Je/Math.PI/20);for(let Rt=1;Rt<Ft;Rt++){let Bt=Rt/Ft;if(Bt!==.5){const Un=Bt-.5;Bt+=Bt*Un*(Bt-1)*((1.0904+je*(je*(3.55645-1.43519*je)-3.2452))*Un*Un+(.848013+je*(.215638*je-1.06021)))}const En=le.sub(Q)._mult(Bt)._add(Q)._unit()._mult(dt?-1:1);this.addHalfVertex(N,En.x,En.y,!1,dt,0,B)}}Z&&this.addCurrentVertex(N,le,-mt,-Dt,B)}else if(Et==="butt")this.addCurrentVertex(N,Fe,0,0,B);else if(Et==="square"){const ot=H?1:-1;H||this.addCurrentVertex(N,Fe,ot,ot,B),this.addCurrentVertex(N,Fe,0,0,B),H&&this.addCurrentVertex(N,Fe,ot,ot,B)}else Et==="round"&&(H&&(this.addCurrentVertex(N,Q,0,0,B),this.addCurrentVertex(N,Q,1,1,B,!0)),Z&&(this.addCurrentVertex(N,le,-1,-1,B,!0),this.addCurrentVertex(N,le,0,0,B)));if(ut&&ve<C-1){const ot=N.dist(Z);if(ot>2*R){const mt=N.add(Z.sub(N)._mult(R/ot)._round());this.updateDistance(N,mt),this.addCurrentVertex(mt,le,0,0,B),N=mt}}}}addCurrentVertex(n,s,c,p,g,_=!1){const x=s.y*p-s.x,C=-s.y-s.x*p;this.addHalfVertex(n,s.x+s.y*c,s.y-s.x*c,_,!1,c,g),this.addHalfVertex(n,x,C,_,!0,-p,g)}addHalfVertex({x:n,y:s},c,p,g,_,x,C){this.layoutVertexArray.emplaceBack((n<<1)+(g?1:0),(s<<1)+(_?1:0),Math.round(63*c)+128,Math.round(63*p)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const S=C.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,S),C.primitiveLength++),_?this.e2=S:this.e1=S}updateScaledDistance(){if(this.lineClips){const n=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=n*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(n,s){this.distance+=n.dist(s),this.updateScaledDistance()}}$t(Cg,"LineBucket",{omit:["layers","patternFeatures"]});const cz=new j({"line-cap":new I(Me.layout_line["line-cap"]),"line-join":new I(Me.layout_line["line-join"]),"line-miter-limit":new A(Me.layout_line["line-miter-limit"]),"line-round-limit":new A(Me.layout_line["line-round-limit"]),"line-sort-key":new I(Me.layout_line["line-sort-key"])});var Vb={paint:new j({"line-opacity":new I(Me.paint_line["line-opacity"]),"line-color":new I(Me.paint_line["line-color"]),"line-translate":new A(Me.paint_line["line-translate"]),"line-translate-anchor":new A(Me.paint_line["line-translate-anchor"]),"line-width":new I(Me.paint_line["line-width"]),"line-gap-width":new I(Me.paint_line["line-gap-width"]),"line-offset":new I(Me.paint_line["line-offset"]),"line-blur":new I(Me.paint_line["line-blur"]),"line-dasharray":new O(Me.paint_line["line-dasharray"]),"line-pattern":new O(Me.paint_line["line-pattern"]),"line-gradient":new V(Me.paint_line["line-gradient"])}),layout:cz};const Gb=new class extends I{possiblyEvaluate(a,n){return n=new ci(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(a,n)}evaluate(a,n,s,c){return n=me({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(a,n,s,c)}}(Vb.paint.properties["line-width"].specification);function Hb(a,n){return n>0?n+2*a:a}Gb.useIntegerZoom=!0;const uz=Pe([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),hz=Pe([{name:"a_projected_pos",components:3,type:"Float32"}],4);Pe([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const dz=Pe([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),pz=Pe([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Pe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Wb=Pe([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),fz=Pe([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Pe([{name:"triangle",components:3,type:"Uint16"}]),Pe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Pe([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Pe([{type:"Float32",name:"offsetX"}]),Pe([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var or=24;const ga=128;function Cv(a,n){const{expression:s}=n;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new ci(a+1))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:c,interpolationType:p}=s;let g=0;for(;g<c.length&&c[g]<=a;)g++;g=Math.max(0,g-1);let _=g;for(;_<c.length&&c[_]<a+1;)_++;_=Math.min(c.length-1,_);const x=c[g],C=c[_];return s.kind==="composite"?{kind:"composite",minZoom:x,maxZoom:C,interpolationType:p}:{kind:"camera",minZoom:x,maxZoom:C,minSize:s.evaluate(new ci(x)),maxSize:s.evaluate(new ci(C)),interpolationType:p}}}function Ag(a,{uSize:n,uSizeT:s},{lowerSize:c,upperSize:p}){return a.kind==="source"?c/ga:a.kind==="composite"?yn(c/ga,p/ga,s):n}function Xu(a,n){let s=0,c=0;if(a.kind==="constant")c=a.layoutSize;else if(a.kind!=="source"){const{interpolationType:p,minZoom:g,maxZoom:_}=a,x=p?te(Pr.interpolationFactor(p,n,g,_),0,1):0;a.kind==="camera"?c=yn(a.minSize,a.maxSize,x):s=x}return{uSizeT:s,uSize:c}}var mz=Object.freeze({__proto__:null,getSizeData:Cv,evaluateSizeForFeature:Ag,evaluateSizeForZoom:Xu,SIZE_PACK_FACTOR:ga});function gz(a,n,s){return a.sections.forEach(c=>{c.text=function(p,g,_){const x=g.layout.get("text-transform").evaluate(_,{});return x==="uppercase"?p=p.toLocaleUpperCase():x==="lowercase"&&(p=p.toLocaleLowerCase()),$r.applyArabicShaping&&(p=$r.applyArabicShaping(p)),p}(c.text,n,s)}),a}const Ep={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};function yz(a){return a==="︶"||a==="﹈"||a==="︸"||a==="﹄"||a==="﹂"||a==="︾"||a==="︼"||a==="︺"||a==="︘"||a==="﹀"||a==="︐"||a==="︓"||a==="︔"||a==="｀"||a==="￣"||a==="︑"||a==="︒"}function _z(a){return a==="︵"||a==="﹇"||a==="︷"||a==="﹃"||a==="﹁"||a==="︽"||a==="︻"||a==="︹"||a==="︗"||a==="︿"}var jb=function(a,n,s,c,p){var g,_,x=8*p-c-1,C=(1<<x)-1,S=C>>1,R=-7,B=s?p-1:0,N=s?-1:1,H=a[n+B];for(B+=N,g=H&(1<<-R)-1,H>>=-R,R+=x;R>0;g=256*g+a[n+B],B+=N,R-=8);for(_=g&(1<<-R)-1,g>>=-R,R+=c;R>0;_=256*_+a[n+B],B+=N,R-=8);if(g===0)g=1-S;else{if(g===C)return _?NaN:1/0*(H?-1:1);_+=Math.pow(2,c),g-=S}return(H?-1:1)*_*Math.pow(2,g-c)},$b=function(a,n,s,c,p,g){var _,x,C,S=8*g-p-1,R=(1<<S)-1,B=R>>1,N=p===23?Math.pow(2,-24)-Math.pow(2,-77):0,H=c?0:g-1,Z=c?1:-1,Q=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(x=isNaN(n)?1:0,_=R):(_=Math.floor(Math.log(n)/Math.LN2),n*(C=Math.pow(2,-_))<1&&(_--,C*=2),(n+=_+B>=1?N/C:N*Math.pow(2,1-B))*C>=2&&(_++,C/=2),_+B>=R?(x=0,_=R):_+B>=1?(x=(n*C-1)*Math.pow(2,p),_+=B):(x=n*Math.pow(2,B-1)*Math.pow(2,p),_=0));p>=8;a[s+H]=255&x,H+=Z,x/=256,p-=8);for(_=_<<p|x,S+=p;S>0;a[s+H]=255&_,H+=Z,_/=256,S-=8);a[s+H-Z]|=128*Q},Cp=si;function si(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}si.Varint=0,si.Fixed64=1,si.Bytes=2,si.Fixed32=5;var Av=4294967296,qb=1/Av,Zb=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Ya(a){return a.type===si.Bytes?a.readVarint()+a.pos:a.pos+1}function Yu(a,n,s){return s?4294967296*n+(a>>>0):4294967296*(n>>>0)+(a>>>0)}function Xb(a,n,s){var c=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));s.realloc(c);for(var p=s.pos-1;p>=a;p--)s.buf[p+c]=s.buf[p]}function vz(a,n){for(var s=0;s<a.length;s++)n.writeVarint(a[s])}function xz(a,n){for(var s=0;s<a.length;s++)n.writeSVarint(a[s])}function bz(a,n){for(var s=0;s<a.length;s++)n.writeFloat(a[s])}function wz(a,n){for(var s=0;s<a.length;s++)n.writeDouble(a[s])}function Mz(a,n){for(var s=0;s<a.length;s++)n.writeBoolean(a[s])}function Tz(a,n){for(var s=0;s<a.length;s++)n.writeFixed32(a[s])}function Ez(a,n){for(var s=0;s<a.length;s++)n.writeSFixed32(a[s])}function Cz(a,n){for(var s=0;s<a.length;s++)n.writeFixed64(a[s])}function Az(a,n){for(var s=0;s<a.length;s++)n.writeSFixed64(a[s])}function Sg(a,n){return(a[n]|a[n+1]<<8|a[n+2]<<16)+16777216*a[n+3]}function Ju(a,n,s){a[s]=n,a[s+1]=n>>>8,a[s+2]=n>>>16,a[s+3]=n>>>24}function Yb(a,n){return(a[n]|a[n+1]<<8|a[n+2]<<16)+(a[n+3]<<24)}function Sz(a,n,s){n.glyphs=[],a===1&&s.readMessage(Dz,n)}function Dz(a,n,s){if(a===3){const{id:c,bitmap:p,width:g,height:_,left:x,top:C,advance:S}=s.readMessage(Pz,{});n.glyphs.push({id:c,bitmap:new Xa({width:g+6,height:_+6},p),metrics:{width:g,height:_,left:x,top:C,advance:S}})}else a===4?n.ascender=s.readSVarint():a===5&&(n.descender=s.readSVarint())}function Pz(a,n,s){a===1?n.id=s.readVarint():a===2?n.bitmap=s.readBytes():a===3?n.width=s.readVarint():a===4?n.height=s.readVarint():a===5?n.left=s.readSVarint():a===6?n.top=s.readSVarint():a===7&&(n.advance=s.readVarint())}function Sv(a){let n=0,s=0;for(const _ of a)n+=_.w*_.h,s=Math.max(s,_.w);a.sort((_,x)=>x.h-_.h);const c=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),s),h:1/0}];let p=0,g=0;for(const _ of a)for(let x=c.length-1;x>=0;x--){const C=c[x];if(!(_.w>C.w||_.h>C.h)){if(_.x=C.x,_.y=C.y,g=Math.max(g,_.y+_.h),p=Math.max(p,_.x+_.w),_.w===C.w&&_.h===C.h){const S=c.pop();x<c.length&&(c[x]=S)}else _.h===C.h?(C.x+=_.w,C.w-=_.w):_.w===C.w?(C.y+=_.h,C.h-=_.h):(c.push({x:C.x+_.w,y:C.y,w:C.w-_.w,h:_.h}),C.y+=_.h,C.h-=_.h);break}}return{w:p,h:g,fill:n/(p*g)||0}}si.prototype={destroy:function(){this.buf=null},readFields:function(a,n,s){for(s=s||this.length;this.pos<s;){var c=this.readVarint(),p=c>>3,g=this.pos;this.type=7&c,a(p,n,this),this.pos===g&&this.skip(c)}return n},readMessage:function(a,n){return this.readFields(a,n,this.readVarint()+this.pos)},readFixed32:function(){var a=Sg(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=Yb(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Sg(this.buf,this.pos)+Sg(this.buf,this.pos+4)*Av;return this.pos+=8,a},readSFixed64:function(){var a=Sg(this.buf,this.pos)+Yb(this.buf,this.pos+4)*Av;return this.pos+=8,a},readFloat:function(){var a=jb(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=jb(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var n,s,c=this.buf;return n=127&(s=c[this.pos++]),s<128?n:(n|=(127&(s=c[this.pos++]))<<7,s<128?n:(n|=(127&(s=c[this.pos++]))<<14,s<128?n:(n|=(127&(s=c[this.pos++]))<<21,s<128?n:function(p,g,_){var x,C,S=_.buf;if(x=(112&(C=S[_.pos++]))>>4,C<128||(x|=(127&(C=S[_.pos++]))<<3,C<128)||(x|=(127&(C=S[_.pos++]))<<10,C<128)||(x|=(127&(C=S[_.pos++]))<<17,C<128)||(x|=(127&(C=S[_.pos++]))<<24,C<128)||(x|=(1&(C=S[_.pos++]))<<31,C<128))return Yu(p,x,g);throw new Error("Expected varint not more than 10 bytes")}(n|=(15&(s=c[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,n=this.pos;return this.pos=a,a-n>=12&&Zb?function(s,c,p){return Zb.decode(s.subarray(c,p))}(this.buf,n,a):function(s,c,p){for(var g="",_=c;_<p;){var x,C,S,R=s[_],B=null,N=R>239?4:R>223?3:R>191?2:1;if(_+N>p)break;N===1?R<128&&(B=R):N===2?(192&(x=s[_+1]))==128&&(B=(31&R)<<6|63&x)<=127&&(B=null):N===3?(C=s[_+2],(192&(x=s[_+1]))==128&&(192&C)==128&&((B=(15&R)<<12|(63&x)<<6|63&C)<=2047||B>=55296&&B<=57343)&&(B=null)):N===4&&(C=s[_+2],S=s[_+3],(192&(x=s[_+1]))==128&&(192&C)==128&&(192&S)==128&&((B=(15&R)<<18|(63&x)<<12|(63&C)<<6|63&S)<=65535||B>=1114112)&&(B=null)),B===null?(B=65533,N=1):B>65535&&(B-=65536,g+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),g+=String.fromCharCode(B),_+=N}return g}(this.buf,n,a)},readBytes:function(){var a=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,a);return this.pos=a,n},readPackedVarint:function(a,n){if(this.type!==si.Bytes)return a.push(this.readVarint(n));var s=Ya(this);for(a=a||[];this.pos<s;)a.push(this.readVarint(n));return a},readPackedSVarint:function(a){if(this.type!==si.Bytes)return a.push(this.readSVarint());var n=Ya(this);for(a=a||[];this.pos<n;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==si.Bytes)return a.push(this.readBoolean());var n=Ya(this);for(a=a||[];this.pos<n;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==si.Bytes)return a.push(this.readFloat());var n=Ya(this);for(a=a||[];this.pos<n;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==si.Bytes)return a.push(this.readDouble());var n=Ya(this);for(a=a||[];this.pos<n;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==si.Bytes)return a.push(this.readFixed32());var n=Ya(this);for(a=a||[];this.pos<n;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==si.Bytes)return a.push(this.readSFixed32());var n=Ya(this);for(a=a||[];this.pos<n;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==si.Bytes)return a.push(this.readFixed64());var n=Ya(this);for(a=a||[];this.pos<n;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==si.Bytes)return a.push(this.readSFixed64());var n=Ya(this);for(a=a||[];this.pos<n;)a.push(this.readSFixed64());return a},skip:function(a){var n=7&a;if(n===si.Varint)for(;this.buf[this.pos++]>127;);else if(n===si.Bytes)this.pos=this.readVarint()+this.pos;else if(n===si.Fixed32)this.pos+=4;else{if(n!==si.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(a,n){this.writeVarint(a<<3|n)},realloc:function(a){for(var n=this.length||16;n<this.pos+a;)n*=2;if(n!==this.length){var s=new Uint8Array(n);s.set(this.buf),this.buf=s,this.length=n}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),Ju(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),Ju(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),Ju(this.buf,-1&a,this.pos),Ju(this.buf,Math.floor(a*qb),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),Ju(this.buf,-1&a,this.pos),Ju(this.buf,Math.floor(a*qb),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(n,s){var c,p;if(n>=0?(c=n%4294967296|0,p=n/4294967296|0):(p=~(-n/4294967296),4294967295^(c=~(-n%4294967296))?c=c+1|0:(c=0,p=p+1|0)),n>=18446744073709552e3||n<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(g,_,x){x.buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,g>>>=7,x.buf[x.pos++]=127&g|128,x.buf[x.pos]=127&(g>>>=7)}(c,0,s),function(g,_){var x=(7&g)<<4;_.buf[_.pos++]|=x|((g>>>=3)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g)))))}(p,s)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var n=this.pos;this.pos=function(c,p,g){for(var _,x,C=0;C<p.length;C++){if((_=p.charCodeAt(C))>55295&&_<57344){if(!x){_>56319||C+1===p.length?(c[g++]=239,c[g++]=191,c[g++]=189):x=_;continue}if(_<56320){c[g++]=239,c[g++]=191,c[g++]=189,x=_;continue}_=x-55296<<10|_-56320|65536,x=null}else x&&(c[g++]=239,c[g++]=191,c[g++]=189,x=null);_<128?c[g++]=_:(_<2048?c[g++]=_>>6|192:(_<65536?c[g++]=_>>12|224:(c[g++]=_>>18|240,c[g++]=_>>12&63|128),c[g++]=_>>6&63|128),c[g++]=63&_|128)}return g}(this.buf,a,this.pos);var s=this.pos-n;s>=128&&Xb(n,s,this),this.pos=n-1,this.writeVarint(s),this.pos+=s},writeFloat:function(a){this.realloc(4),$b(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),$b(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var n=a.length;this.writeVarint(n),this.realloc(n);for(var s=0;s<n;s++)this.buf[this.pos++]=a[s]},writeRawMessage:function(a,n){this.pos++;var s=this.pos;a(n,this);var c=this.pos-s;c>=128&&Xb(s,c,this),this.pos=s-1,this.writeVarint(c),this.pos+=c},writeMessage:function(a,n,s){this.writeTag(a,si.Bytes),this.writeRawMessage(n,s)},writePackedVarint:function(a,n){n.length&&this.writeMessage(a,vz,n)},writePackedSVarint:function(a,n){n.length&&this.writeMessage(a,xz,n)},writePackedBoolean:function(a,n){n.length&&this.writeMessage(a,Mz,n)},writePackedFloat:function(a,n){n.length&&this.writeMessage(a,bz,n)},writePackedDouble:function(a,n){n.length&&this.writeMessage(a,wz,n)},writePackedFixed32:function(a,n){n.length&&this.writeMessage(a,Tz,n)},writePackedSFixed32:function(a,n){n.length&&this.writeMessage(a,Ez,n)},writePackedFixed64:function(a,n){n.length&&this.writeMessage(a,Cz,n)},writePackedSFixed64:function(a,n){n.length&&this.writeMessage(a,Az,n)},writeBytesField:function(a,n){this.writeTag(a,si.Bytes),this.writeBytes(n)},writeFixed32Field:function(a,n){this.writeTag(a,si.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(a,n){this.writeTag(a,si.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(a,n){this.writeTag(a,si.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(a,n){this.writeTag(a,si.Fixed64),this.writeSFixed64(n)},writeVarintField:function(a,n){this.writeTag(a,si.Varint),this.writeVarint(n)},writeSVarintField:function(a,n){this.writeTag(a,si.Varint),this.writeSVarint(n)},writeStringField:function(a,n){this.writeTag(a,si.Bytes),this.writeString(n)},writeFloatField:function(a,n){this.writeTag(a,si.Fixed32),this.writeFloat(n)},writeDoubleField:function(a,n){this.writeTag(a,si.Fixed64),this.writeDouble(n)},writeBooleanField:function(a,n){this.writeVarintField(a,!!n)}};class Dv{constructor(n,{pixelRatio:s,version:c,stretchX:p,stretchY:g,content:_}){this.paddedRect=n,this.pixelRatio=s,this.stretchX=p,this.stretchY=g,this.content=_,this.version=c}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Jb{constructor(n,s){const c={},p={};this.haveRenderCallbacks=[];const g=[];this.addImages(n,c,g),this.addImages(s,p,g);const{w:_,h:x}=Sv(g),C=new Xr({width:_||1,height:x||1});for(const S in n){const R=n[S],B=c[S].paddedRect;Xr.copy(R.data,C,{x:0,y:0},{x:B.x+1,y:B.y+1},R.data)}for(const S in s){const R=s[S],B=p[S].paddedRect,N=B.x+1,H=B.y+1,Z=R.data.width,Q=R.data.height;Xr.copy(R.data,C,{x:0,y:0},{x:N,y:H},R.data),Xr.copy(R.data,C,{x:0,y:Q-1},{x:N,y:H-1},{width:Z,height:1}),Xr.copy(R.data,C,{x:0,y:0},{x:N,y:H+Q},{width:Z,height:1}),Xr.copy(R.data,C,{x:Z-1,y:0},{x:N-1,y:H},{width:1,height:Q}),Xr.copy(R.data,C,{x:0,y:0},{x:N+Z,y:H},{width:1,height:Q})}this.image=C,this.iconPositions=c,this.patternPositions=p}addImages(n,s,c){for(const p in n){const g=n[p],_={x:0,y:0,w:g.data.width+2,h:g.data.height+2};c.push(_),s[p]=new Dv(_,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(n,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(c=>n.hasImage(c)),n.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const c in n.updatedImages)this.patchUpdatedImage(this.iconPositions[c],n.getImage(c),s),this.patchUpdatedImage(this.patternPositions[c],n.getImage(c),s)}patchUpdatedImage(n,s,c){if(!n||!s||n.version===s.version)return;n.version=s.version;const[p,g]=n.tl;c.update(s.data,void 0,{x:p,y:g})}}$t(Dv,"ImagePosition"),$t(Jb,"ImageAtlas");const yo={horizontal:1,vertical:2,horizontalOnly:3};class Ap{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(n,s){const c=new Ap;return c.scale=n||1,c.fontStack=s,c}static forImage(n){const s=new Ap;return s.imageName=n,s}}class Ku{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,s){const c=new Ku;for(let p=0;p<n.sections.length;p++){const g=n.sections[p];g.image?c.addImageSection(g):c.addTextSection(g,s)}return c}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSections(){return this.sections}getSectionIndex(n){return this.sectionIndex[n]}getCharCode(n){return this.text.charCodeAt(n)}verticalizePunctuation(n){this.text=function(s,c){let p="";for(let g=0;g<s.length;g++){const _=s.charCodeAt(g+1)||null,x=s.charCodeAt(g-1)||null;p+=!c&&(_&&Fu(_)&&!Ep[s[g+1]]||x&&Fu(x)&&!Ep[s[g-1]])||!Ep[s[g]]?s[g]:Ep[s[g]]}return p}(this.text,n)}trim(){let n=0;for(let c=0;c<this.text.length&&Dg[this.text.charCodeAt(c)];c++)n++;let s=this.text.length;for(let c=this.text.length-1;c>=0&&c>=n&&Dg[this.text.charCodeAt(c)];c--)s--;this.text=this.text.substring(n,s),this.sectionIndex=this.sectionIndex.slice(n,s)}substring(n,s){const c=new Ku;return c.text=this.text.substring(n,s),c.sectionIndex=this.sectionIndex.slice(n,s),c.sections=this.sections,c}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,s)=>Math.max(n,this.sections[s].scale),0)}addTextSection(n,s){this.text+=n.text,this.sections.push(Ap.forText(n.scale,n.fontStack||s));const c=this.sections.length-1;for(let p=0;p<n.text.length;++p)this.sectionIndex.push(c)}addImageSection(n){const s=n.image?n.image.name:"";if(s.length===0)return void xe("Can't add FormattedSection with an empty image.");const c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Ap.forImage(s)),this.sectionIndex.push(this.sections.length-1)):xe("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Pv(a,n,s,c,p,g,_,x,C,S,R,B,N,H,Z,Q){const le=Ku.fromFeature(a,p);let ve;B===yo.vertical&&le.verticalizePunctuation(N);const{processBidirectionalText:Fe,processStyledBidirectionalText:je}=$r;if(Fe&&le.sections.length===1){ve=[];const Je=Fe(le.toString(),Lv(le,S,g,n,c,H,Z));for(const ut of Je){const dt=new Ku;dt.text=ut,dt.sections=le.sections;for(let xt=0;xt<ut.length;xt++)dt.sectionIndex.push(0);ve.push(dt)}}else if(je){ve=[];const Je=je(le.text,le.sectionIndex,Lv(le,S,g,n,c,H,Z));for(const ut of Je){const dt=new Ku;dt.text=ut[0],dt.sectionIndex=ut[1],dt.sections=le.sections,ve.push(dt)}}else ve=function(Je,ut){const dt=[],xt=Je.text;let Et=0;for(const ot of ut)dt.push(Je.substring(Et,ot)),Et=ot;return Et<xt.length&&dt.push(Je.substring(Et,xt.length)),dt}(le,Lv(le,S,g,n,c,H,Z));const Xe=[],Ye={positionedLines:Xe,text:le.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:B,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Je,ut,dt,xt,Et,ot,mt,Dt,Ft,Rt,Bt,En){let Un=0,An=0,Bn=0;const Qt=Dt==="right"?1:Dt==="left"?0:.5;let jt=!1;for(const Kn of Et){const Hn=Kn.getSections();for(const ni of Hn){if(ni.imageName)continue;const wi=ut[ni.fontStack];if(wi&&(jt=wi.ascender!==void 0&&wi.descender!==void 0,!jt))break}if(!jt)break}let Vn=0;for(const Kn of Et){Kn.trim();const Hn=Kn.getMaxScale(),ni=(Hn-1)*or,wi={positionedGlyphs:[],lineOffset:0};Je.positionedLines[Vn]=wi;const Ci=wi.positionedGlyphs;let Ni=0;if(!Kn.length()){An+=ot,++Vn;continue}let Xi=0,Kr=0;for(let ii=0;ii<Kn.length();ii++){const vr=Kn.getSection(ii),Qr=Kn.getSectionIndex(ii),er=Kn.getCharCode(ii);let Yi=vr.scale,fi=null,hi=null,Fr=null,xr=or,Ii=0;const br=!(Ft===yo.horizontal||!Bt&&!Bu(er)||Bt&&(Dg[er]||(Jn=er,Ym(Jn)||Lu(Jn)||Nl(Jn)||np(Jn)||zu(Jn))));if(vr.imageName){const hr=xt[vr.imageName];if(!hr)continue;Fr=vr.imageName,Je.iconsInText=Je.iconsInText||!0,hi=hr.paddedRect;const Ji=hr.displaySize;Yi=Yi*or/En,fi={width:Ji[0],height:Ji[1],left:1,top:-3,advance:br?Ji[1]:Ji[0],localGlyph:!1},Ii=jt?-fi.height*Yi:Hn*or-17-Ji[1]*Yi,xr=fi.advance;const Co=(br?Ji[0]:Ji[1])*Yi-or*Hn;Co>0&&Co>Ni&&(Ni=Co)}else{const hr=dt[vr.fontStack];if(!hr)continue;hr[er]&&(hi=hr[er]);const Ji=ut[vr.fontStack];if(!Ji)continue;const Co=Ji.glyphs[er];if(!Co)continue;if(fi=Co.metrics,xr=er!==8203?or:0,jt){const qs=Ji.ascender!==void 0?Math.abs(Ji.ascender):0,Fp=Ji.descender!==void 0?Math.abs(Ji.descender):0,Op=(qs+Fp)*Yi;Xi<Op&&(Xi=Op,Kr=(qs-Fp)/2*Yi),Ii=-qs*Yi}else Ii=(Hn-Yi)*or-17}br?(Je.verticalizable=!0,Ci.push({glyph:er,imageName:Fr,x:Un,y:An+Ii,vertical:br,scale:Yi,localGlyph:fi.localGlyph,fontStack:vr.fontStack,sectionIndex:Qr,metrics:fi,rect:hi}),Un+=xr*Yi+Rt):(Ci.push({glyph:er,imageName:Fr,x:Un,y:An+Ii,vertical:br,scale:Yi,localGlyph:fi.localGlyph,fontStack:vr.fontStack,sectionIndex:Qr,metrics:fi,rect:hi}),Un+=fi.advance*Yi+Rt)}Ci.length!==0&&(Bn=Math.max(Un-Rt,Bn),jt?nw(Ci,Qt,Ni,Kr,ot*Hn/2):nw(Ci,Qt,Ni,0,ot/2)),Un=0;const Br=ot*Hn+Ni;wi.lineOffset=Math.max(Ni,ni),An+=Br,++Vn}var Jn;const Fi=An,{horizontalAlign:ui,verticalAlign:Oi}=Iv(mt);(function(Kn,Hn,ni,wi,Ci,Ni){const Xi=(Hn-ni)*Ci,Kr=-Ni*wi;for(const Br of Kn)for(const ii of Br.positionedGlyphs)ii.x+=Xi,ii.y+=Kr})(Je.positionedLines,Qt,ui,Oi,Bn,Fi),Je.top+=-Oi*Fi,Je.bottom=Je.top+Fi,Je.left+=-ui*Bn,Je.right=Je.left+Bn,Je.hasBaseline=jt}(Ye,n,s,c,ve,_,x,C,B,S,N,Q),!function(Je){for(const ut of Je)if(ut.positionedGlyphs.length!==0)return!1;return!0}(Xe)&&Ye}const Dg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Lz={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Kb(a,n,s,c,p,g){if(n.imageName){const _=c[n.imageName];return _?_.displaySize[0]*n.scale*or/g+p:0}{const _=s[n.fontStack],x=_&&_.glyphs[a];return x?x.metrics.advance*n.scale+p:0}}function Qb(a,n,s,c){const p=Math.pow(a-n,2);return c?a<n?p/2:2*p:p+Math.abs(s)*s}function Iz(a,n,s){let c=0;return a===10&&(c-=1e4),s&&(c+=150),a!==40&&a!==65288||(c+=50),n!==41&&n!==65289||(c+=50),c}function ew(a,n,s,c,p,g){let _=null,x=Qb(n,s,p,g);for(const C of c){const S=Qb(n-C.x,s,p,g)+C.badness;S<=x&&(_=C,x=S)}return{index:a,x:n,priorBreak:_,badness:x}}function tw(a){return a?tw(a.priorBreak).concat(a.index):[]}function Lv(a,n,s,c,p,g,_){if(g!=="point")return[];if(!a)return[];const x=[],C=function(N,H,Z,Q,le,ve){let Fe=0;for(let je=0;je<N.length();je++){const Xe=N.getSection(je);Fe+=Kb(N.getCharCode(je),Xe,Q,le,H,ve)}return Fe/Math.max(1,Math.ceil(Fe/Z))}(a,n,s,c,p,_),S=a.text.indexOf("​")>=0;let R=0;for(let N=0;N<a.length();N++){const H=a.getSection(N),Z=a.getCharCode(N);if(Dg[Z]||(R+=Kb(Z,H,c,p,n,_)),N<a.length()-1){const Q=!((B=Z)<11904||!(Qm(B)||Km(B)||Is(B)||Vl(B)||ng(B)||Kd(B)||eg(B)||Iu(B)||ig(B)||tp(B)||tg(B)||ip(B)||Ul(B)||Qd(B)||Jm(B)||ep(B)||Ru(B)||sg(B)||og(B)||rg(B)));(Lz[Z]||Q||H.imageName)&&x.push(ew(N+1,R,C,x,Iz(Z,a.getCharCode(N+1),Q&&S),!1))}}var B;return tw(ew(a.length(),R,C,x,0,!0))}function Iv(a){let n=.5,s=.5;switch(a){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:n,verticalAlign:s}}function nw(a,n,s,c,p){if(!(n||s||c||p))return;const g=a.length-1,_=a[g],x=(_.x+_.metrics.advance*_.scale)*n;for(let C=0;C<=g;C++)a[C].x-=x,a[C].y+=s+c+p}function Rz(a,n,s){const{horizontalAlign:c,verticalAlign:p}=Iv(s),g=n[0]-a.displaySize[0]*c,_=n[1]-a.displaySize[1]*p;return{image:a,top:_,bottom:_+a.displaySize[1],left:g,right:g+a.displaySize[0]}}function iw(a,n,s,c,p,g){const _=a.image;let x;if(_.content){const le=_.content,ve=_.pixelRatio||1;x=[le[0]/ve,le[1]/ve,_.displaySize[0]-le[2]/ve,_.displaySize[1]-le[3]/ve]}const C=n.left*g,S=n.right*g;let R,B,N,H;s==="width"||s==="both"?(H=p[0]+C-c[3],B=p[0]+S+c[1]):(H=p[0]+(C+S-_.displaySize[0])/2,B=H+_.displaySize[0]);const Z=n.top*g,Q=n.bottom*g;return s==="height"||s==="both"?(R=p[1]+Z-c[0],N=p[1]+Q+c[2]):(R=p[1]+(Z+Q-_.displaySize[1])/2,N=R+_.displaySize[1]),{image:_,top:R,right:B,bottom:N,left:H,collisionPadding:x}}class Ja extends M{constructor(n,s,c,p,g){super(n,s),this.angle=p,this.z=c,g!==void 0&&(this.segment=g)}clone(){return new Ja(this.x,this.y,this.z,this.angle,this.segment)}}function rw(a,n,s,c,p){if(n.segment===void 0)return!0;let g=n,_=n.segment+1,x=0;for(;x>-s/2;){if(_--,_<0)return!1;x-=a[_].dist(g),g=a[_]}x+=a[_].dist(a[_+1]),_++;const C=[];let S=0;for(;x<s/2;){const R=a[_],B=a[_+1];if(!B)return!1;let N=a[_-1].angleTo(R)-R.angleTo(B);for(N=Math.abs((N+3*Math.PI)%(2*Math.PI)-Math.PI),C.push({distance:x,angleDelta:N}),S+=N;x-C[0].distance>c;)S-=C.shift().angleDelta;if(S>p)return!1;_++,x+=R.dist(B)}return!0}function ow(a){let n=0;for(let s=0;s<a.length-1;s++)n+=a[s].dist(a[s+1]);return n}function aw(a,n,s){return a?.6*n*s:0}function sw(a,n){return Math.max(a?a.right-a.left:0,n?n.right-n.left:0)}function zz(a,n,s,c,p,g){const _=aw(s,p,g),x=sw(s,c)*g;let C=0;const S=ow(a)/2;for(let R=0;R<a.length-1;R++){const B=a[R],N=a[R+1],H=B.dist(N);if(C+H>S){const Z=(S-C)/H,Q=yn(B.x,N.x,Z),le=yn(B.y,N.y,Z),ve=new Ja(Q,le,0,N.angleTo(B),R);return!_||rw(a,ve,x,_,n)?ve:void 0}C+=H}}function kz(a,n,s,c,p,g,_,x,C){const S=aw(c,g,_),R=sw(c,p),B=R*_,N=a[0].x===0||a[0].x===C||a[0].y===0||a[0].y===C;return n-B<n/4&&(n=B+n/4),lw(a,N?n/2*x%n:(R/2+2*g)*_*x%n,n,S,s,B,N,!1,C)}function lw(a,n,s,c,p,g,_,x,C){const S=g/2,R=ow(a);let B=0,N=n-s,H=[];for(let Z=0;Z<a.length-1;Z++){const Q=a[Z],le=a[Z+1],ve=Q.dist(le),Fe=le.angleTo(Q);for(;N+s<B+ve;){N+=s;const je=(N-B)/ve,Xe=yn(Q.x,le.x,je),Ye=yn(Q.y,le.y,je);if(Xe>=0&&Xe<C&&Ye>=0&&Ye<C&&N-S>=0&&N+S<=R){const Je=new Ja(Xe,Ye,0,Fe,Z);Je._round(),c&&!rw(a,Je,g,c,p)||H.push(Je)}}B+=ve}return x||H.length||_||(H=lw(a,B/2,s,c,p,g,_,!0,C)),H}function cw(a,n,s,c,p){const g=[];for(let _=0;_<a.length;_++){const x=a[_];let C;for(let S=0;S<x.length-1;S++){let R=x[S],B=x[S+1];R.x<n&&B.x<n||(R.x<n?R=new M(n,R.y+(n-R.x)/(B.x-R.x)*(B.y-R.y))._round():B.x<n&&(B=new M(n,R.y+(n-R.x)/(B.x-R.x)*(B.y-R.y))._round()),R.y<s&&B.y<s||(R.y<s?R=new M(R.x+(s-R.y)/(B.y-R.y)*(B.x-R.x),s)._round():B.y<s&&(B=new M(R.x+(s-R.y)/(B.y-R.y)*(B.x-R.x),s)._round()),R.x>=c&&B.x>=c||(R.x>=c?R=new M(c,R.y+(c-R.x)/(B.x-R.x)*(B.y-R.y))._round():B.x>=c&&(B=new M(c,R.y+(c-R.x)/(B.x-R.x)*(B.y-R.y))._round()),R.y>=p&&B.y>=p||(R.y>=p?R=new M(R.x+(p-R.y)/(B.y-R.y)*(B.x-R.x),p)._round():B.y>=p&&(B=new M(R.x+(p-R.y)/(B.y-R.y)*(B.x-R.x),p)._round()),C&&R.equals(C[C.length-1])||(C=[R],g.push(C)),C.push(B)))))}}return g}$t(Ja,"Anchor");const Sp=1e20;function uw(a,n,s,c,p,g,_,x,C){for(let S=n;S<n+c;S++)hw(a,s*g+S,g,p,_,x,C);for(let S=s;S<s+p;S++)hw(a,S*g+n,1,c,_,x,C)}function hw(a,n,s,c,p,g,_){g[0]=0,_[0]=-Sp,_[1]=Sp,p[0]=a[n];for(let x=1,C=0,S=0;x<c;x++){p[x]=a[n+x*s];const R=x*x;do{const B=g[C];S=(p[x]-p[B]+R-B*B)/(x-B)/2}while(S<=_[C]&&--C>-1);C++,g[C]=x,_[C]=S,_[C+1]=Sp}for(let x=0,C=0;x<c;x++){for(;_[C+1]<x;)C++;const S=g[C],R=x-S;a[n+x*s]=p[S]+R*R}}const Rv={none:0,ideographs:1,all:2};class Qu{constructor(n,s,c){this.requestManager=n,this.localGlyphMode=s,this.localFontFamily=c,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(n){this.url=n}getGlyphs(n,s){const c=[];for(const p in n)for(const g of n[p])c.push({stack:p,id:g});se(c,({stack:p,id:g},_)=>{let x=this.entries[p];x||(x=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let C=x.glyphs[g];if(C!==void 0)return void _(null,{stack:p,id:g,glyph:C});if(C=this._tinySDF(x,p,g),C)return x.glyphs[g]=C,void _(null,{stack:p,id:g,glyph:C});const S=Math.floor(g/256);if(256*S>65535)return void _(new Error("glyphs > 65535 not supported"));if(x.ranges[S])return void _(null,{stack:p,id:g,glyph:C});let R=x.requests[S];R||(R=x.requests[S]=[],Qu.loadGlyphRange(p,S,this.url,this.requestManager,(B,N)=>{if(N){x.ascender=N.ascender,x.descender=N.descender;for(const H in N.glyphs)this._doesCharSupportLocalGlyph(+H)||(x.glyphs[+H]=N.glyphs[+H]);x.ranges[S]=!0}for(const H of R)H(B,N);delete x.requests[S]})),R.push((B,N)=>{B?_(B):N&&_(null,{stack:p,id:g,glyph:N.glyphs[g]||null})})},(p,g)=>{if(p)s(p);else if(g){const _={};for(const{stack:x,id:C,glyph:S}of g)_[x]===void 0&&(_[x]={}),_[x].glyphs===void 0&&(_[x].glyphs={}),_[x].glyphs[C]=S&&{id:S.id,bitmap:S.bitmap.clone(),metrics:S.metrics},_[x].ascender=this.entries[x].ascender,_[x].descender=this.entries[x].descender;s(null,_)}})}_doesCharSupportLocalGlyph(n){return this.localGlyphMode!==Rv.none&&(this.localGlyphMode===Rv.all?!!this.localFontFamily:!!this.localFontFamily&&(tp(n)||ag(n)||Ul(n)||Ru(n)||Iu(n)))}_tinySDF(n,s,c){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(c))return;let g=n.tinySDF;if(!g){let Q="400";/bold/i.test(s)?Q="900":/medium/i.test(s)?Q="500":/light/i.test(s)&&(Q="200"),g=n.tinySDF=new Qu.TinySDF({fontFamily:p,fontWeight:Q,fontSize:48,buffer:6,radius:16}),g.fontWeight=Q}if(this.localGlyphs[g.fontWeight][c])return this.localGlyphs[g.fontWeight][c];const _=String.fromCharCode(c),{data:x,width:C,height:S,glyphWidth:R,glyphHeight:B,glyphLeft:N,glyphTop:H,glyphAdvance:Z}=g.draw(_);return this.localGlyphs[g.fontWeight][c]={id:c,bitmap:new Xa({width:C,height:S},x),metrics:{width:R/2,height:B/2,left:N/2,top:H/2-27,advance:Z/2,localGlyph:!0}}}}function dw(a,n,s,c){const p=[],g=a.image,_=g.pixelRatio,x=g.paddedRect.w-2,C=g.paddedRect.h-2,S=a.right-a.left,R=a.bottom-a.top,B=g.stretchX||[[0,x]],N=g.stretchY||[[0,C]],H=(ot,mt)=>ot+mt[1]-mt[0],Z=B.reduce(H,0),Q=N.reduce(H,0),le=x-Z,ve=C-Q;let Fe=0,je=Z,Xe=0,Ye=Q,Je=0,ut=le,dt=0,xt=ve;if(g.content&&c){const ot=g.content;Fe=Pg(B,0,ot[0]),Xe=Pg(N,0,ot[1]),je=Pg(B,ot[0],ot[2]),Ye=Pg(N,ot[1],ot[3]),Je=ot[0]-Fe,dt=ot[1]-Xe,ut=ot[2]-ot[0]-je,xt=ot[3]-ot[1]-Ye}const Et=(ot,mt,Dt,Ft)=>{const Rt=Lg(ot.stretch-Fe,je,S,a.left),Bt=Ig(ot.fixed-Je,ut,ot.stretch,Z),En=Lg(mt.stretch-Xe,Ye,R,a.top),Un=Ig(mt.fixed-dt,xt,mt.stretch,Q),An=Lg(Dt.stretch-Fe,je,S,a.left),Bn=Ig(Dt.fixed-Je,ut,Dt.stretch,Z),Qt=Lg(Ft.stretch-Xe,Ye,R,a.top),jt=Ig(Ft.fixed-dt,xt,Ft.stretch,Q),Vn=new M(Rt,En),Jn=new M(An,En),Fi=new M(An,Qt),ui=new M(Rt,Qt),Oi=new M(Bt/_,Un/_),Kn=new M(Bn/_,jt/_),Hn=n*Math.PI/180;if(Hn){const Ci=Math.sin(Hn),Ni=Math.cos(Hn),Xi=[Ni,-Ci,Ci,Ni];Vn._matMult(Xi),Jn._matMult(Xi),ui._matMult(Xi),Fi._matMult(Xi)}const ni=ot.stretch+ot.fixed,wi=mt.stretch+mt.fixed;return{tl:Vn,tr:Jn,bl:ui,br:Fi,tex:{x:g.paddedRect.x+1+ni,y:g.paddedRect.y+1+wi,w:Dt.stretch+Dt.fixed-ni,h:Ft.stretch+Ft.fixed-wi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Oi,pixelOffsetBR:Kn,minFontScaleX:ut/_/S,minFontScaleY:xt/_/R,isSDF:s}};if(c&&(g.stretchX||g.stretchY)){const ot=pw(B,le,Z),mt=pw(N,ve,Q);for(let Dt=0;Dt<ot.length-1;Dt++){const Ft=ot[Dt],Rt=ot[Dt+1];for(let Bt=0;Bt<mt.length-1;Bt++)p.push(Et(Ft,mt[Bt],Rt,mt[Bt+1]))}}else p.push(Et({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:C+1}));return p}function Pg(a,n,s){let c=0;for(const p of a)c+=Math.max(n,Math.min(s,p[1]))-Math.max(n,Math.min(s,p[0]));return c}function pw(a,n,s){const c=[{fixed:-1,stretch:0}];for(const[p,g]of a){const _=c[c.length-1];c.push({fixed:p-_.stretch,stretch:_.stretch}),c.push({fixed:p-_.stretch,stretch:_.stretch+(g-p)})}return c.push({fixed:n+1,stretch:s}),c}function Lg(a,n,s,c){return a/n*s+c}function Ig(a,n,s,c){return a-n*s/c}function Bz(a,n,s,c){const p=n+a.positionedLines[c].lineOffset;return c===0?s+p/2:s+(p+(n+a.positionedLines[c-1].lineOffset))/2}Qu.loadGlyphRange=function(a,n,s,c,p){const g=256*n,_=g+255,x=c.transformRequest(c.normalizeGlyphsURL(s).replace("{fontstack}",a).replace("{range}",`${g}-${_}`),be.Glyphs);Re(x,(C,S)=>{if(C)p(C);else if(S){const R={},B=function(N){return new Cp(N).readFields(Sz,{})}(S);for(const N of B.glyphs)R[N.id]=N;p(null,{glyphs:R,ascender:B.ascender,descender:B.descender})}})},Qu.TinySDF=class{constructor({fontSize:a=24,buffer:n=3,radius:s=8,cutoff:c=.25,fontFamily:p="sans-serif",fontWeight:g="normal",fontStyle:_="normal"}){this.buffer=n,this.cutoff=c,this.radius=s;const x=this.size=a+4*n,C=this._createCanvas(x),S=this.ctx=C.getContext("2d",{willReadFrequently:!0});S.font=`${_} ${g} ${a}px ${p}`,S.textBaseline="alphabetic",S.textAlign="left",S.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(a){const n=document.createElement("canvas");return n.width=n.height=a,n}draw(a){const{width:n,actualBoundingBoxAscent:s,actualBoundingBoxDescent:c,actualBoundingBoxLeft:p,actualBoundingBoxRight:g}=this.ctx.measureText(a),_=Math.floor(s),x=Math.min(this.size-this.buffer,Math.ceil(g-p)),C=Math.min(this.size-this.buffer,Math.ceil(s)+Math.ceil(c)),S=x+2*this.buffer,R=C+2*this.buffer,B=S*R,N=new Uint8ClampedArray(B),H={data:N,width:S,height:R,glyphWidth:x,glyphHeight:C,glyphTop:_,glyphLeft:0,glyphAdvance:n};if(x===0||C===0)return H;const{ctx:Z,buffer:Q,gridInner:le,gridOuter:ve}=this;Z.clearRect(Q,Q,x,C),Z.fillText(a,Q,Q+_+1);const Fe=Z.getImageData(Q,Q,x,C);ve.fill(Sp,0,B),le.fill(0,0,B);for(let je=0;je<C;je++)for(let Xe=0;Xe<x;Xe++){const Ye=Fe.data[4*(je*x+Xe)+3]/255;if(Ye===0)continue;const Je=(je+Q)*S+Xe+Q;if(Ye===1)ve[Je]=0,le[Je]=Sp;else{const ut=.5-Ye;ve[Je]=ut>0?ut*ut:0,le[Je]=ut<0?ut*ut:0}}uw(ve,0,0,S,R,S,this.f,this.v,this.z),uw(le,Q,Q,x,C,S,this.f,this.v,this.z);for(let je=0;je<B;je++){const Xe=Math.sqrt(ve[je])-Math.sqrt(le[je]);N[je]=Math.round(255-255*(Xe/this.radius+this.cutoff))}return H}};class Fz{constructor(n=[],s=Oz){if(this.data=n,this.length=this.data.length,this.compare=s,this.length>0)for(let c=(this.length>>1)-1;c>=0;c--)this._down(c)}push(n){this.data.push(n),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const n=this.data[0],s=this.data.pop();return this.length--,this.length>0&&(this.data[0]=s,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:s,compare:c}=this,p=s[n];for(;n>0;){const g=n-1>>1,_=s[g];if(c(p,_)>=0)break;s[n]=_,n=g}s[n]=p}_down(n){const{data:s,compare:c}=this,p=this.length>>1,g=s[n];for(;n<p;){let _=1+(n<<1),x=s[_];const C=_+1;if(C<this.length&&c(s[C],x)<0&&(_=C,x=s[C]),c(x,g)>=0)break;s[n]=x,n=_}s[n]=g}}function Oz(a,n){return a<n?-1:a>n?1:0}function Nz(a,n=1,s=!1){let c=1/0,p=1/0,g=-1/0,_=-1/0;const x=a[0];for(let H=0;H<x.length;H++){const Z=x[H];(!H||Z.x<c)&&(c=Z.x),(!H||Z.y<p)&&(p=Z.y),(!H||Z.x>g)&&(g=Z.x),(!H||Z.y>_)&&(_=Z.y)}const C=Math.min(g-c,_-p);let S=C/2;const R=new Fz([],Uz);if(C===0)return new M(c,p);for(let H=c;H<g;H+=C)for(let Z=p;Z<_;Z+=C)R.push(new eh(H+S,Z+S,S,a));let B=function(H){let Z=0,Q=0,le=0;const ve=H[0];for(let Fe=0,je=ve.length,Xe=je-1;Fe<je;Xe=Fe++){const Ye=ve[Fe],Je=ve[Xe],ut=Ye.x*Je.y-Je.x*Ye.y;Q+=(Ye.x+Je.x)*ut,le+=(Ye.y+Je.y)*ut,Z+=3*ut}return new eh(Q/Z,le/Z,0,H)}(a),N=R.length;for(;R.length;){const H=R.pop();(H.d>B.d||!B.d)&&(B=H,s&&console.log("found best %d after %d probes",Math.round(1e4*H.d)/1e4,N)),H.max-B.d<=n||(S=H.h/2,R.push(new eh(H.p.x-S,H.p.y-S,S,a)),R.push(new eh(H.p.x+S,H.p.y-S,S,a)),R.push(new eh(H.p.x-S,H.p.y+S,S,a)),R.push(new eh(H.p.x+S,H.p.y+S,S,a)),N+=4)}return s&&(console.log(`num probes: ${N}`),console.log(`best distance: ${B.d}`)),B.p}function Uz(a,n){return n.max-a.max}function eh(a,n,s,c){this.p=new M(a,n),this.h=s,this.d=function(p,g){let _=!1,x=1/0;for(let C=0;C<g.length;C++){const S=g[C];for(let R=0,B=S.length,N=B-1;R<B;N=R++){const H=S[R],Z=S[N];H.y>p.y!=Z.y>p.y&&p.x<(Z.x-H.x)*(p.y-H.y)/(Z.y-H.y)+H.x&&(_=!_),x=Math.min(x,cb(p,H,Z))}}return(_?1:-1)*Math.sqrt(x)}(this.p,c),this.max=this.d+this.h*Math.SQRT2}const zv=Number.POSITIVE_INFINITY,Vz=Math.sqrt(2);function fw(a,n){return n[1]!==zv?function(s,c,p){let g=0,_=0;switch(c=Math.abs(c),p=Math.abs(p),s){case"top-right":case"top-left":case"top":_=p-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-p}switch(s){case"top-right":case"bottom-right":case"right":g=-c;break;case"top-left":case"bottom-left":case"left":g=c}return[g,_]}(a,n[0],n[1]):function(s,c){let p=0,g=0;c<0&&(c=0);const _=c/Vz;switch(s){case"top-right":case"top-left":g=_-7;break;case"bottom-right":case"bottom-left":g=7-_;break;case"bottom":g=7-c;break;case"top":g=c-7}switch(s){case"top-right":case"bottom-right":p=-_;break;case"top-left":case"bottom-left":p=_;break;case"left":p=c;break;case"right":p=-c}return[p,g]}(a,n[0])}function Gz(a,n,s,c,p,g,_,x,C,S){a.createArrays(),a.tilePixelRatio=In/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const R=a.layers[0].layout,B=a.layers[0]._unevaluatedLayout._values,N={};if(a.textSizeData.kind==="composite"){const{minZoom:Q,maxZoom:le}=a.textSizeData;N.compositeTextSizes=[B["text-size"].possiblyEvaluate(new ci(Q),x),B["text-size"].possiblyEvaluate(new ci(le),x)]}if(a.iconSizeData.kind==="composite"){const{minZoom:Q,maxZoom:le}=a.iconSizeData;N.compositeIconSizes=[B["icon-size"].possiblyEvaluate(new ci(Q),x),B["icon-size"].possiblyEvaluate(new ci(le),x)]}N.layoutTextSize=B["text-size"].possiblyEvaluate(new ci(C+1),x),N.layoutIconSize=B["icon-size"].possiblyEvaluate(new ci(C+1),x),N.textMaxSize=B["text-size"].possiblyEvaluate(new ci(18),x);const H=R.get("text-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",Z=R.get("text-size");for(const Q of a.features){const le=R.get("text-font").evaluate(Q,{},x).join(","),ve=Z.evaluate(Q,{},x),Fe=N.layoutTextSize.evaluate(Q,{},x),je=(N.layoutIconSize.evaluate(Q,{},x),{horizontal:{},vertical:void 0}),Xe=Q.text;let Ye,Je=[0,0];if(Xe){const xt=Xe.toString(),Et=R.get("text-letter-spacing").evaluate(Q,{},x)*or,ot=R.get("text-line-height").evaluate(Q,{},x)*or,mt=Y_(xt)?Et:0,Dt=R.get("text-anchor").evaluate(Q,{},x),Ft=R.get("text-variable-anchor");if(!Ft){const Bn=R.get("text-radial-offset").evaluate(Q,{},x);Je=Bn?fw(Dt,[Bn*or,zv]):R.get("text-offset").evaluate(Q,{},x).map(Qt=>Qt*or)}let Rt=H?"center":R.get("text-justify").evaluate(Q,{},x);const Bt=R.get("symbol-placement"),En=Bt==="point",Un=Bt==="point"?R.get("text-max-width").evaluate(Q,{},x)*or:0,An=Bn=>{a.allowVerticalPlacement&&ku(xt)&&(je.vertical=Pv(Xe,n,s,p,le,Un,ot,Dt,Bn,mt,Je,yo.vertical,!0,Bt,Fe,ve))};if(!H&&Ft){const Bn=Rt==="auto"?Ft.map(jt=>kv(jt)):[Rt];let Qt=!1;for(let jt=0;jt<Bn.length;jt++){const Vn=Bn[jt];if(!je.horizontal[Vn])if(Qt)je.horizontal[Vn]=je.horizontal[0];else{const Jn=Pv(Xe,n,s,p,le,Un,ot,"center",Vn,mt,Je,yo.horizontal,!1,Bt,Fe,ve);Jn&&(je.horizontal[Vn]=Jn,Qt=Jn.positionedLines.length===1)}}An("left")}else{if(Rt==="auto"&&(Rt=kv(Dt)),En||R.get("text-writing-mode").indexOf("horizontal")>=0||!ku(xt)){const Bn=Pv(Xe,n,s,p,le,Un,ot,Dt,Rt,mt,Je,yo.horizontal,!1,Bt,Fe,ve);Bn&&(je.horizontal[Rt]=Bn)}An(Bt==="point"?"left":Rt)}}let ut=!1;if(Q.icon&&Q.icon.name){const xt=c[Q.icon.name];xt&&(Ye=Rz(p[Q.icon.name],R.get("icon-offset").evaluate(Q,{},x),R.get("icon-anchor").evaluate(Q,{},x)),ut=xt.sdf,a.sdfIcons===void 0?a.sdfIcons=xt.sdf:a.sdfIcons!==xt.sdf&&xe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(xt.pixelRatio!==a.pixelRatio||R.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0))}const dt=gw(je.horizontal)||je.vertical;a.iconsInText||(a.iconsInText=!!dt&&dt.iconsInText),(dt||Ye)&&Hz(a,Q,je,Ye,c,N,Fe,0,Je,ut,_,x,S)}g&&a.generateCollisionDebugBuffers(C,a.collisionBoxArray)}function kv(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Hz(a,n,s,c,p,g,_,x,C,S,R,B,N){let H=g.textMaxSize.evaluate(n,{},B);H===void 0&&(H=_);const Z=a.layers[0].layout,Q=Z.get("icon-offset").evaluate(n,{},B),le=gw(s.horizontal)||s.vertical,ve=_/24,Fe=a.tilePixelRatio*H/24,je=(ot=a.overscaling,a.zoom>18&&ot>2&&(ot>>=1),Math.max(In/(512*ot),1)*Z.get("symbol-spacing")),Xe=Z.get("text-padding")*a.tilePixelRatio,Ye=Z.get("icon-padding")*a.tilePixelRatio,Je=F(Z.get("text-max-angle")),ut=Z.get("text-rotation-alignment")==="map"&&Z.get("symbol-placement")!=="point",dt=Z.get("icon-rotation-alignment")==="map"&&Z.get("symbol-placement")!=="point",xt=Z.get("symbol-placement"),Et=je/2;var ot;const mt=Z.get("icon-text-fit");let Dt;c&&mt!=="none"&&(a.allowVerticalPlacement&&s.vertical&&(Dt=iw(c,s.vertical,mt,Z.get("icon-text-fit-padding"),Q,ve)),le&&(c=iw(c,le,mt,Z.get("icon-text-fit-padding"),Q,ve)));const Ft=(Rt,Bt,En)=>{if(Bt.x<0||Bt.x>=In||Bt.y<0||Bt.y>=In)return;const{x:Un,y:An,z:Bn}=N.projectTilePoint(Bt.x,Bt.y,En),Qt=new Ja(Un,An,Bn,0,void 0);(function(jt,Vn,Jn,Fi,ui,Oi,Kn,Hn,ni,wi,Ci,Ni,Xi,Kr,Br,ii,vr,Qr,er,Yi,fi,hi,Fr,xr,Ii){const br=jt.addToLineVertexArray(Vn,Fi);let hr,Ji,Co,qs,Fp,Op,Kw,Qw=0,eM=0,tM=0,nM=0,Kv=-1,Qv=-1;const xa={};let iM=pa(""),ex=0,tx=0;if(ni._unevaluatedLayout.getValue("text-radial-offset")===void 0?[ex,tx]=ni.layout.get("text-offset").evaluate(fi,{},Ii).map(eo=>eo*or):(ex=ni.layout.get("text-radial-offset").evaluate(fi,{},Ii)*or,tx=zv),jt.allowVerticalPlacement&&ui.vertical){const eo=ui.vertical;if(Br)Op=Bv(eo),Hn&&(Kw=Bv(Hn));else{const to=ni.layout.get("text-rotate").evaluate(fi,{},Ii)+90;Co=Rg(wi,Jn,Vn,Ci,Ni,Xi,eo,Kr,to,ii),Hn&&(qs=Rg(wi,Jn,Vn,Ci,Ni,Xi,Hn,Qr,to))}}if(Oi){const eo=ni.layout.get("icon-rotate").evaluate(fi,{},Ii),to=ni.layout.get("icon-text-fit")!=="none",Np=dw(Oi,eo,Fr,to),ix=Hn?dw(Hn,eo,Fr,to):void 0;Ji=Rg(wi,Jn,Vn,Ci,Ni,Xi,Oi,Qr,eo),Qw=4*Np.length;const rM=jt.iconSizeData;let Ql=null;rM.kind==="source"?(Ql=[ga*ni.layout.get("icon-size").evaluate(fi,{},Ii)],Ql[0]>Vs&&xe(`${jt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):rM.kind==="composite"&&(Ql=[ga*hi.compositeIconSizes[0].evaluate(fi,{},Ii),ga*hi.compositeIconSizes[1].evaluate(fi,{},Ii)],(Ql[0]>Vs||Ql[1]>Vs)&&xe(`${jt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),jt.addSymbols(jt.icon,Np,Ql,Yi,er,fi,!1,Jn,Vn,br.lineStartIndex,br.lineLength,-1,xr,Ii),Kv=jt.icon.placedSymbolArray.length-1,ix&&(eM=4*ix.length,jt.addSymbols(jt.icon,ix,Ql,Yi,er,fi,yo.vertical,Jn,Vn,br.lineStartIndex,br.lineLength,-1,xr,Ii),Qv=jt.icon.placedSymbolArray.length-1)}for(const eo in ui.horizontal){const to=ui.horizontal[eo];hr||(iM=pa(to.text),Br?Fp=Bv(to):hr=Rg(wi,Jn,Vn,Ci,Ni,Xi,to,Kr,ni.layout.get("text-rotate").evaluate(fi,{},Ii),ii));const Np=to.positionedLines.length===1;if(tM+=mw(jt,Jn,Vn,to,Kn,ni,Br,fi,ii,br,ui.vertical?yo.horizontal:yo.horizontalOnly,Np?Object.keys(ui.horizontal):[eo],xa,Kv,hi,xr,Ii),Np)break}ui.vertical&&(nM+=mw(jt,Jn,Vn,ui.vertical,Kn,ni,Br,fi,ii,br,yo.vertical,["vertical"],xa,Qv,hi,xr,Ii));let Zs=-1;const nx=(eo,to)=>eo?Math.max(eo,to):to;Zs=nx(Fp,Zs),Zs=nx(Op,Zs),Zs=nx(Kw,Zs);const Mk=Zs>-1?1:0;jt.glyphOffsetArray.length>=Gs.MAX_GLYPHS&&xe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),fi.sortKey!==void 0&&jt.addToSortKeyRanges(jt.symbolInstances.length,fi.sortKey),jt.symbolInstances.emplaceBack(Jn.x,Jn.y,Jn.z,Vn.x,Vn.y,xa.right>=0?xa.right:-1,xa.center>=0?xa.center:-1,xa.left>=0?xa.left:-1,xa.vertical>=0?xa.vertical:-1,Kv,Qv,iM,hr!==void 0?hr:jt.collisionBoxArray.length,hr!==void 0?hr+1:jt.collisionBoxArray.length,Co!==void 0?Co:jt.collisionBoxArray.length,Co!==void 0?Co+1:jt.collisionBoxArray.length,Ji!==void 0?Ji:jt.collisionBoxArray.length,Ji!==void 0?Ji+1:jt.collisionBoxArray.length,qs||jt.collisionBoxArray.length,qs?qs+1:jt.collisionBoxArray.length,Ci,tM,nM,Qw,eM,Mk,0,ex,tx,Zs)})(a,Bt,Qt,Rt,s,c,p,Dt,a.layers[0],a.collisionBoxArray,n.index,n.sourceLayerIndex,a.index,Xe,ut,C,0,Ye,dt,Q,n,g,S,R,B)};if(xt==="line")for(const Rt of cw(n.geometry,0,0,In,In)){const Bt=kz(Rt,je,Je,s.vertical||le,c,24,Fe,a.overscaling,In);for(const En of Bt){const Un=le;Un&&Wz(a,Un.text,Et,En)||Ft(Rt,En,B)}}else if(xt==="line-center"){for(const Rt of n.geometry)if(Rt.length>1){const Bt=zz(Rt,Je,s.vertical||le,c,24,Fe);Bt&&Ft(Rt,Bt,B)}}else if(n.type==="Polygon")for(const Rt of Mv(n.geometry,0)){const Bt=Nz(Rt,16);Ft(Rt[0],new Ja(Bt.x,Bt.y,0,0,void 0),B)}else if(n.type==="LineString")for(const Rt of n.geometry)Ft(Rt,new Ja(Rt[0].x,Rt[0].y,0,0,void 0),B);else if(n.type==="Point")for(const Rt of n.geometry)for(const Bt of Rt)Ft([Bt],new Ja(Bt.x,Bt.y,0,0,void 0),B)}const Vs=32640;function mw(a,n,s,c,p,g,_,x,C,S,R,B,N,H,Z,Q,le){const ve=function(Xe,Ye,Je,ut,dt,xt,Et,ot){const mt=[];if(Ye.positionedLines.length===0)return mt;const Dt=ut.layout.get("text-rotate").evaluate(xt,{})*Math.PI/180,Ft=function(An){const Bn=An[0],Qt=An[1],jt=Bn*Qt;return jt>0?[Bn,-Qt]:jt<0?[-Bn,Qt]:Bn===0?[Qt,Bn]:[Qt,-Bn]}(Je);let Rt=Math.abs(Ye.top-Ye.bottom);for(const An of Ye.positionedLines)Rt-=An.lineOffset;const Bt=Ye.positionedLines.length,En=Rt/Bt;let Un=Ye.top-Je[1];for(let An=0;An<Bt;++An){const Bn=Ye.positionedLines[An];Un=Bz(Ye,En,Un,An);for(const Qt of Bn.positionedGlyphs){if(!Qt.rect)continue;const jt=Qt.rect||{};let Vn=4,Jn=!0,Fi=1,ui=0;if(Qt.imageName){const hi=Et[Qt.imageName];if(!hi)continue;if(hi.sdf){xe("SDF images are not supported in formatted text and will be ignored.");continue}Jn=!1,Fi=hi.pixelRatio,Vn=1/Fi}const Oi=(dt||ot)&&Qt.vertical,Kn=Qt.metrics.advance*Qt.scale/2,Hn=Qt.metrics,ni=Qt.rect;if(ni===null)continue;ot&&Ye.verticalizable&&(ui=Qt.imageName?Kn-Qt.metrics.width*Qt.scale/2:0);const wi=dt?[Qt.x+Kn,Qt.y]:[0,0];let Ci=[0,0],Ni=[0,0],Xi=!1;dt||(Oi?(Ni=[Qt.x+Kn+Ft[0],Qt.y+Ft[1]-ui],Xi=!0):Ci=[Qt.x+Kn+Je[0],Qt.y+Je[1]-ui]);const Kr=ni.w*Qt.scale/(Fi*(Qt.localGlyph?2:1)),Br=ni.h*Qt.scale/(Fi*(Qt.localGlyph?2:1));let ii,vr,Qr,er;if(Oi){const hi=Qt.y-Un,Fr=new M(-Kn,Kn-hi),xr=-Math.PI/2,Ii=new M(...Ni);ii=new M(-Kn+Ci[0],Ci[1]),ii._rotateAround(xr,Fr)._add(Ii),ii.x+=-hi+Kn,ii.y-=(Hn.left-Vn)*Qt.scale;const br=Qt.imageName?Hn.advance*Qt.scale:or*Qt.scale,hr=String.fromCharCode(Qt.glyph);yz(hr)?ii.x+=(1-Vn)*Qt.scale:_z(hr)?ii.x+=br-Hn.height*Qt.scale+(-Vn-1)*Qt.scale:ii.x+=Qt.imageName||Hn.width+2*Vn===ni.w&&Hn.height+2*Vn===ni.h?(br-Br)/2:(br-(Hn.height+2*Vn)*Qt.scale)/2,vr=new M(ii.x,ii.y-Kr),Qr=new M(ii.x+Br,ii.y),er=new M(ii.x+Br,ii.y-Kr)}else{const hi=(Hn.left-Vn)*Qt.scale-Kn+Ci[0],Fr=(-Hn.top-Vn)*Qt.scale+Ci[1],xr=hi+Kr,Ii=Fr+Br;ii=new M(hi,Fr),vr=new M(xr,Fr),Qr=new M(hi,Ii),er=new M(xr,Ii)}if(Dt){let hi;hi=dt?new M(0,0):Xi?new M(Ft[0],Ft[1]):new M(Je[0],Je[1]),ii._rotateAround(Dt,hi),vr._rotateAround(Dt,hi),Qr._rotateAround(Dt,hi),er._rotateAround(Dt,hi)}const Yi=new M(0,0),fi=new M(0,0);mt.push({tl:ii,tr:vr,bl:Qr,br:er,tex:jt,writingMode:Ye.writingMode,glyphOffset:wi,sectionIndex:Qt.sectionIndex,isSDF:Jn,pixelOffsetTL:Yi,pixelOffsetBR:fi,minFontScaleX:0,minFontScaleY:0})}}return mt}(0,c,C,g,_,x,p,a.allowVerticalPlacement),Fe=a.textSizeData;let je=null;Fe.kind==="source"?(je=[ga*g.layout.get("text-size").evaluate(x,{},le)],je[0]>Vs&&xe(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):Fe.kind==="composite"&&(je=[ga*Z.compositeTextSizes[0].evaluate(x,{},le),ga*Z.compositeTextSizes[1].evaluate(x,{},le)],(je[0]>Vs||je[1]>Vs)&&xe(`${a.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),a.addSymbols(a.text,ve,je,C,_,x,R,n,s,S.lineStartIndex,S.lineLength,H,Q,le);for(const Xe of B)N[Xe]=a.text.placedSymbolArray.length-1;return 4*ve.length}function gw(a){for(const n in a)return a[n];return null}function Rg(a,n,s,c,p,g,_,x,C,S){let R=_.top,B=_.bottom,N=_.left,H=_.right;const Z=_.collisionPadding;if(Z&&(N-=Z[0],R-=Z[1],H+=Z[2],B+=Z[3]),C){const Q=new M(N,R),le=new M(H,R),ve=new M(N,B),Fe=new M(H,B),je=F(C);let Xe=new M(0,0);S&&(Xe=new M(S[0],S[1])),Q._rotateAround(je,Xe),le._rotateAround(je,Xe),ve._rotateAround(je,Xe),Fe._rotateAround(je,Xe),N=Math.min(Q.x,le.x,ve.x,Fe.x),H=Math.max(Q.x,le.x,ve.x,Fe.x),R=Math.min(Q.y,le.y,ve.y,Fe.y),B=Math.max(Q.y,le.y,ve.y,Fe.y)}return a.emplaceBack(n.x,n.y,n.z,s.x,s.y,N,R,H,B,x,c,p,g),a.length-1}function Bv(a){a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const n=a.bottom-a.top;return n>0?Math.max(10,n):null}function Wz(a,n,s,c){const p=a.compareText;if(n in p){const g=p[n];for(let _=g.length-1;_>=0;_--)if(c.dist(g[_])<s)return!0}else p[n]=[];return p[n].push(c),!1}const jz=Yl.VectorTileFeature.types,$z=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function zg(a,n,s,c,p,g,_,x,C,S,R,B,N,H,Z,Q){const le=R?Math.min(Vs,Math.round(R[0])):0,ve=R?Math.min(Vs,Math.round(R[1])):0;a.emplaceBack(n,s,Math.round(32*_),Math.round(32*x),C,S,(le<<1)+(B?1:0),ve,16*N,16*H,256*Z,256*Q,c,p,g,0)}function Fv(a,n,s){a.emplaceBack(n.x,n.y,s),a.emplaceBack(n.x,n.y,s),a.emplaceBack(n.x,n.y,s),a.emplaceBack(n.x,n.y,s)}function qz(a){for(const n of a.sections)if(K_(n.text))return!0;return!1}class Ov{constructor(n){this.layoutVertexArray=new ht,this.indexArray=new qt,this.programConfigurations=n,this.segments=new Ei,this.dynamicLayoutVertexArray=new zt,this.opacityVertexArray=new nt,this.placedSymbolArray=new Vo}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(n,s,c,p){this.isEmpty()||(c&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,uz.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,s),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,hz.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,$z,!0),this.opacityVertexBuffer.itemSize=1),(c||p)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}$t(Ov,"SymbolBuffers");class Nv{constructor(n,s,c){this.layoutVertexArray=new n,this.layoutAttributes=s,this.indexArray=new c,this.segments=new Ei,this.collisionVertexArray=new ft,this.collisionVertexArrayExt=new zt}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,dz.members,!0),this.collisionVertexBufferExt=n.createVertexBuffer(this.collisionVertexArrayExt,pz.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}$t(Nv,"CollisionBuffers");class Gs{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(_=>_.id),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ma([]),this.placementViewportMatrix=ma([]);const s=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Cv(this.zoom,s["text-size"]),this.iconSizeData=Cv(this.zoom,s["icon-size"]);const c=this.layers[0].layout,p=c.get("symbol-sort-key"),g=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=c.get("text-writing-mode").map(_=>yo[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=n.sourceID,this.projection=n.projection}createArrays(){this.text=new Ov(new $l(this.layers,this.zoom,n=>/^text/.test(n))),this.icon=new Ov(new $l(this.layers,this.zoom,n=>/^icon/.test(n))),this.glyphOffsetArray=new Yn,this.lineVertexArray=new Pi,this.symbolInstances=new Ti}calculateGlyphDependencies(n,s,c,p,g){for(let _=0;_<n.length;_++)if(s[n.charCodeAt(_)]=!0,p&&g){const x=Ep[n.charAt(_)];x&&(s[x.charCodeAt(0)]=!0)}}populate(n,s,c,p){const g=this.layers[0],_=g.layout,x=_.get("text-font"),C=_.get("text-field"),S=_.get("icon-image"),R=(C.value.kind!=="constant"||C.value.value instanceof Bi&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),B=S.value.kind!=="constant"||!!S.value.value||Object.keys(S.parameters).length>0,N=_.get("symbol-sort-key");if(this.features=[],!R&&!B)return;const H=s.iconDependencies,Z=s.glyphDependencies,Q=s.availableImages,le=new ci(this.zoom);for(const{feature:ve,id:Fe,index:je,sourceLayerIndex:Xe}of n){const Ye=g._featureFilter.needGeometry,Je=ql(ve,Ye);if(!g._featureFilter.filter(le,Je,c))continue;let ut,dt;if(Ye||(Je.geometry=Za(ve,c,p)),R){const Et=g.getValueAndResolveTokens("text-field",Je,c,Q),ot=Bi.factory(Et);qz(ot)&&(this.hasRTLText=!0),(!this.hasRTLText||Nu()==="unavailable"||this.hasRTLText&&$r.isParsed())&&(ut=gz(ot,g,Je))}if(B){const Et=g.getValueAndResolveTokens("icon-image",Je,c,Q);dt=Et instanceof Sr?Et:Sr.fromString(Et)}if(!ut&&!dt)continue;const xt=this.sortFeaturesByKey?N.evaluate(Je,{},c):void 0;if(this.features.push({id:Fe,text:ut,icon:dt,index:je,sourceLayerIndex:Xe,geometry:Je.geometry,properties:ve.properties,type:jz[ve.type],sortKey:xt}),dt&&(H[dt.name]=!0),ut){const Et=x.evaluate(Je,{},c).join(","),ot=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(yo.vertical)>=0;for(const mt of ut.sections)if(mt.image)H[mt.image.name]=!0;else{const Dt=ku(ut.toString()),Ft=mt.fontStack||Et,Rt=Z[Ft]=Z[Ft]||{};this.calculateGlyphDependencies(mt.text,Rt,ot,this.allowVerticalPlacement,Dt)}}}_.get("symbol-placement")==="line"&&(this.features=function(ve){const Fe={},je={},Xe=[];let Ye=0;function Je(Et){Xe.push(ve[Et]),Ye++}function ut(Et,ot,mt){const Dt=je[Et];return delete je[Et],je[ot]=Dt,Xe[Dt].geometry[0].pop(),Xe[Dt].geometry[0]=Xe[Dt].geometry[0].concat(mt[0]),Dt}function dt(Et,ot,mt){const Dt=Fe[ot];return delete Fe[ot],Fe[Et]=Dt,Xe[Dt].geometry[0].shift(),Xe[Dt].geometry[0]=mt[0].concat(Xe[Dt].geometry[0]),Dt}function xt(Et,ot,mt){const Dt=mt?ot[0][ot[0].length-1]:ot[0][0];return`${Et}:${Dt.x}:${Dt.y}`}for(let Et=0;Et<ve.length;Et++){const ot=ve[Et],mt=ot.geometry,Dt=ot.text?ot.text.toString():null;if(!Dt){Je(Et);continue}const Ft=xt(Dt,mt),Rt=xt(Dt,mt,!0);if(Ft in je&&Rt in Fe&&je[Ft]!==Fe[Rt]){const Bt=dt(Ft,Rt,mt),En=ut(Ft,Rt,Xe[Bt].geometry);delete Fe[Ft],delete je[Rt],je[xt(Dt,Xe[En].geometry,!0)]=En,Xe[Bt].geometry=null}else Ft in je?ut(Ft,Rt,mt):Rt in Fe?dt(Ft,Rt,mt):(Je(Et),Fe[Ft]=Ye-1,je[Rt]=Ye-1)}return Xe.filter(Et=>Et.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ve,Fe)=>ve.sortKey-Fe.sortKey)}update(n,s,c,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(n,s,this.layers,c,p),this.icon.programConfigurations.updatePaintArrays(n,s,this.layers,c,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,s){const c=this.lineVertexArray.length,p=n.segment;if(p!==void 0){let g=n.dist(s[p+1]),_=n.dist(s[p]);const x={};for(let C=p+1;C<s.length;C++)x[C]={x:s[C].x,y:s[C].y,tileUnitDistanceFromAnchor:g},C<s.length-1&&(g+=s[C+1].dist(s[C]));for(let C=p||0;C>=0;C--)x[C]={x:s[C].x,y:s[C].y,tileUnitDistanceFromAnchor:_},C>0&&(_+=s[C-1].dist(s[C]));for(let C=0;C<s.length;C++){const S=x[C];this.lineVertexArray.emplaceBack(S.x,S.y,S.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}}addSymbols(n,s,c,p,g,_,x,C,S,R,B,N,H,Z){const Q=n.indexArray,le=n.layoutVertexArray,ve=n.segments.prepareSegment(4*s.length,le,Q,this.canOverlap?_.sortKey:void 0),Fe=this.glyphOffsetArray.length,je=ve.vertexLength,Xe=this.allowVerticalPlacement&&x===yo.vertical?Math.PI/2:0,Ye=_.text&&_.text.sections;for(let Je=0;Je<s.length;Je++){const{tl:ut,tr:dt,bl:xt,br:Et,tex:ot,pixelOffsetTL:mt,pixelOffsetBR:Dt,minFontScaleX:Ft,minFontScaleY:Rt,glyphOffset:Bt,isSDF:En,sectionIndex:Un}=s[Je],An=ve.vertexLength,Bn=Bt[1];zg(le,C.x,C.y,C.z,S.x,S.y,ut.x,Bn+ut.y,ot.x,ot.y,c,En,mt.x,mt.y,Ft,Rt),zg(le,C.x,C.y,C.z,S.x,S.y,dt.x,Bn+dt.y,ot.x+ot.w,ot.y,c,En,Dt.x,mt.y,Ft,Rt),zg(le,C.x,C.y,C.z,S.x,S.y,xt.x,Bn+xt.y,ot.x,ot.y+ot.h,c,En,mt.x,Dt.y,Ft,Rt),zg(le,C.x,C.y,C.z,S.x,S.y,Et.x,Bn+Et.y,ot.x+ot.w,ot.y+ot.h,c,En,Dt.x,Dt.y,Ft,Rt),Fv(n.dynamicLayoutVertexArray,C,Xe),Q.emplaceBack(An,An+1,An+2),Q.emplaceBack(An+1,An+2,An+3),ve.vertexLength+=4,ve.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Bt[0]),Je!==s.length-1&&Un===s[Je+1].sectionIndex||n.programConfigurations.populatePaintArrays(le.length,_,_.index,{},H,Z,Ye&&Ye[Un])}n.placedSymbolArray.emplaceBack(C.x,C.y,C.z,S.x,S.y,Fe,this.glyphOffsetArray.length-Fe,je,R,B,S.segment,c?c[0]:0,c?c[1]:0,p[0],p[1],x,0,!1,0,N,0)}_commitLayoutVertex(n,s,c,p,g,_,x){n.emplaceBack(s,c,p,g,_,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(n,s,c,p,g,_,x){const C=c.segments.prepareSegment(4,c.layoutVertexArray,c.indexArray),S=C.vertexLength,R=x.tileAnchorX,B=x.tileAnchorY;for(let H=0;H<4;H++)c.collisionVertexArray.emplaceBack(0,0,0,0);c.collisionVertexArrayExt.emplaceBack(s,-n.padding,-n.padding),c.collisionVertexArrayExt.emplaceBack(s,n.padding,-n.padding),c.collisionVertexArrayExt.emplaceBack(s,n.padding,n.padding),c.collisionVertexArrayExt.emplaceBack(s,-n.padding,n.padding),this._commitLayoutVertex(c.layoutVertexArray,p,g,_,R,B,new M(n.x1,n.y1)),this._commitLayoutVertex(c.layoutVertexArray,p,g,_,R,B,new M(n.x2,n.y1)),this._commitLayoutVertex(c.layoutVertexArray,p,g,_,R,B,new M(n.x2,n.y2)),this._commitLayoutVertex(c.layoutVertexArray,p,g,_,R,B,new M(n.x1,n.y2)),C.vertexLength+=4;const N=c.indexArray;N.emplaceBack(S,S+1),N.emplaceBack(S+1,S+2),N.emplaceBack(S+2,S+3),N.emplaceBack(S+3,S),C.primitiveLength+=4}_addTextDebugCollisionBoxes(n,s,c,p,g,_){for(let x=p;x<g;x++){const C=c.get(x),S=this.getSymbolInstanceTextSize(n,_,s,x);this._addCollisionDebugVertices(C,S,this.textCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(n,s,c,p,g,_){for(let x=p;x<g;x++){const C=c.get(x),S=this.getSymbolInstanceIconSize(n,s,x);this._addCollisionDebugVertices(C,S,this.iconCollisionBox,C.projectedAnchorX,C.projectedAnchorY,C.projectedAnchorZ,_)}}generateCollisionDebugBuffers(n,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Nv(Pt,Wb.members,Mn),this.iconCollisionBox=new Nv(Pt,Wb.members,Mn);const c=Xu(this.iconSizeData,n),p=Xu(this.textSizeData,n);for(let g=0;g<this.symbolInstances.length;g++){const _=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(p,n,s,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(p,n,s,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(c,n,s,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(c,n,s,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(n,s,c,p){const g=this.text.placedSymbolArray.get(s.rightJustifiedTextSymbolIndex>=0?s.rightJustifiedTextSymbolIndex:s.centerJustifiedTextSymbolIndex>=0?s.centerJustifiedTextSymbolIndex:s.leftJustifiedTextSymbolIndex>=0?s.leftJustifiedTextSymbolIndex:s.verticalPlacedTextSymbolIndex>=0?s.verticalPlacedTextSymbolIndex:p),_=Ag(this.textSizeData,n,g)/or;return this.tilePixelRatio*_}getSymbolInstanceIconSize(n,s,c){const p=this.icon.placedSymbolArray.get(c),g=Ag(this.iconSizeData,n,p);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(n,s,c){n.emplaceBack(s,-c,-c),n.emplaceBack(s,c,-c),n.emplaceBack(s,c,c),n.emplaceBack(s,-c,c)}_updateTextDebugCollisionBoxes(n,s,c,p,g,_){for(let x=p;x<g;x++){const C=c.get(x),S=this.getSymbolInstanceTextSize(n,_,s,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,S,C.padding)}}_updateIconDebugCollisionBoxes(n,s,c,p,g){for(let _=p;_<g;_++){const x=c.get(_),C=this.getSymbolInstanceIconSize(n,s,_);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,C,x.padding)}}updateCollisionDebugBuffers(n,s){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const c=Xu(this.iconSizeData,n),p=Xu(this.textSizeData,n);for(let g=0;g<this.symbolInstances.length;g++){const _=this.symbolInstances.get(g);this._updateTextDebugCollisionBoxes(p,n,s,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(p,n,s,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(c,n,s,_.iconBoxStartIndex,_.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(c,n,s,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(n,s,c,p,g,_,x,C,S){const R={};for(let B=s;B<c;B++){const N=n.get(B);R.textBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,padding:N.padding,projectedAnchorX:N.projectedAnchorX,projectedAnchorY:N.projectedAnchorY,projectedAnchorZ:N.projectedAnchorZ,tileAnchorX:N.tileAnchorX,tileAnchorY:N.tileAnchorY},R.textFeatureIndex=N.featureIndex;break}for(let B=p;B<g;B++){const N=n.get(B);R.verticalTextBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,padding:N.padding,projectedAnchorX:N.projectedAnchorX,projectedAnchorY:N.projectedAnchorY,projectedAnchorZ:N.projectedAnchorZ,tileAnchorX:N.tileAnchorX,tileAnchorY:N.tileAnchorY},R.verticalTextFeatureIndex=N.featureIndex;break}for(let B=_;B<x;B++){const N=n.get(B);R.iconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,padding:N.padding,projectedAnchorX:N.projectedAnchorX,projectedAnchorY:N.projectedAnchorY,projectedAnchorZ:N.projectedAnchorZ,tileAnchorX:N.tileAnchorX,tileAnchorY:N.tileAnchorY},R.iconFeatureIndex=N.featureIndex;break}for(let B=C;B<S;B++){const N=n.get(B);R.verticalIconBox={x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2,padding:N.padding,projectedAnchorX:N.projectedAnchorX,projectedAnchorY:N.projectedAnchorY,projectedAnchorZ:N.projectedAnchorZ,tileAnchorX:N.tileAnchorX,tileAnchorY:N.tileAnchorY},R.verticalIconFeatureIndex=N.featureIndex;break}return R}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let s=0;s<this.symbolInstances.length;s++){const c=this.symbolInstances.get(s);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(n,s){const c=n.placedSymbolArray.get(s),p=c.vertexStartIndex+4*c.numGlyphs;for(let g=c.vertexStartIndex;g<p;g+=4)n.indexArray.emplaceBack(g,g+1,g+2),n.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const s=Math.sin(n),c=Math.cos(n),p=[],g=[],_=[];for(let x=0;x<this.symbolInstances.length;++x){_.push(x);const C=this.symbolInstances.get(x);p.push(0|Math.round(s*C.tileAnchorX+c*C.tileAnchorY)),g.push(C.featureIndex)}return _.sort((x,C)=>p[x]-p[C]||g[C]-g[x]),_}addToSortKeyRanges(n,s){const c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===s?c.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:s,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const s of this.symbolInstanceIndexes){const c=this.symbolInstances.get(s);this.featureSortOrder.push(c.featureIndex),[c.rightJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.leftJustifiedTextSymbolIndex].forEach((p,g,_)=>{p>=0&&_.indexOf(p)===g&&this.addIndicesForPlacedSymbol(this.text,p)}),c.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,c.verticalPlacedTextSymbolIndex),c.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.placedIconSymbolIndex),c.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,c.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}$t(Gs,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Gs.MAX_GLYPHS=65535,Gs.addDynamicAttributes=Fv;const Zz=new j({"symbol-placement":new A(Me.layout_symbol["symbol-placement"]),"symbol-spacing":new A(Me.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new A(Me.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new I(Me.layout_symbol["symbol-sort-key"]),"symbol-z-order":new A(Me.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new A(Me.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new A(Me.layout_symbol["icon-ignore-placement"]),"icon-optional":new A(Me.layout_symbol["icon-optional"]),"icon-rotation-alignment":new A(Me.layout_symbol["icon-rotation-alignment"]),"icon-size":new I(Me.layout_symbol["icon-size"]),"icon-text-fit":new A(Me.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new A(Me.layout_symbol["icon-text-fit-padding"]),"icon-image":new I(Me.layout_symbol["icon-image"]),"icon-rotate":new I(Me.layout_symbol["icon-rotate"]),"icon-padding":new A(Me.layout_symbol["icon-padding"]),"icon-keep-upright":new A(Me.layout_symbol["icon-keep-upright"]),"icon-offset":new I(Me.layout_symbol["icon-offset"]),"icon-anchor":new I(Me.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new A(Me.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new A(Me.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new A(Me.layout_symbol["text-rotation-alignment"]),"text-field":new I(Me.layout_symbol["text-field"]),"text-font":new I(Me.layout_symbol["text-font"]),"text-size":new I(Me.layout_symbol["text-size"]),"text-max-width":new I(Me.layout_symbol["text-max-width"]),"text-line-height":new I(Me.layout_symbol["text-line-height"]),"text-letter-spacing":new I(Me.layout_symbol["text-letter-spacing"]),"text-justify":new I(Me.layout_symbol["text-justify"]),"text-radial-offset":new I(Me.layout_symbol["text-radial-offset"]),"text-variable-anchor":new A(Me.layout_symbol["text-variable-anchor"]),"text-anchor":new I(Me.layout_symbol["text-anchor"]),"text-max-angle":new A(Me.layout_symbol["text-max-angle"]),"text-writing-mode":new A(Me.layout_symbol["text-writing-mode"]),"text-rotate":new I(Me.layout_symbol["text-rotate"]),"text-padding":new A(Me.layout_symbol["text-padding"]),"text-keep-upright":new A(Me.layout_symbol["text-keep-upright"]),"text-transform":new I(Me.layout_symbol["text-transform"]),"text-offset":new I(Me.layout_symbol["text-offset"]),"text-allow-overlap":new A(Me.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new A(Me.layout_symbol["text-ignore-placement"]),"text-optional":new A(Me.layout_symbol["text-optional"])});var Uv={paint:new j({"icon-opacity":new I(Me.paint_symbol["icon-opacity"]),"icon-color":new I(Me.paint_symbol["icon-color"]),"icon-halo-color":new I(Me.paint_symbol["icon-halo-color"]),"icon-halo-width":new I(Me.paint_symbol["icon-halo-width"]),"icon-halo-blur":new I(Me.paint_symbol["icon-halo-blur"]),"icon-translate":new A(Me.paint_symbol["icon-translate"]),"icon-translate-anchor":new A(Me.paint_symbol["icon-translate-anchor"]),"text-opacity":new I(Me.paint_symbol["text-opacity"]),"text-color":new I(Me.paint_symbol["text-color"],{runtimeType:mn,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new I(Me.paint_symbol["text-halo-color"]),"text-halo-width":new I(Me.paint_symbol["text-halo-width"]),"text-halo-blur":new I(Me.paint_symbol["text-halo-blur"]),"text-translate":new A(Me.paint_symbol["text-translate"]),"text-translate-anchor":new A(Me.paint_symbol["text-translate-anchor"])}),layout:Zz};class yw{constructor(n){this.type=n.property.overrides?n.property.overrides.runtimeType:Ln,this.defaultValue=n}evaluate(n){if(n.formattedSection){const s=this.defaultValue.property.overrides;if(s&&s.hasOverride(n.formattedSection))return s.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}$t(yw,"FormatSectionOverride",{omit:["defaultValue"]});class kg extends Ho{constructor(n){super(n,Uv)}recalculate(n,s){super.recalculate(n,s),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const c=this.layout.get("text-writing-mode");if(c){const p=[];for(const g of c)p.indexOf(g)<0&&p.push(g);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(n,s,c,p){const g=this.layout.get(n).evaluate(s,{},c,p),_=this._unevaluatedLayout._values[n];return _.isDataDriven()||Ss(_.value)||!g?g:function(x,C){return C.replace(/{([^{}]+)}/g,(S,R)=>R in x?String(x[R]):"")}(s.properties,g)}createBucket(n){return new Gs(n)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const n of Uv.paint.overridableProperties){if(!kg.hasPaintOverride(this.layout,n))continue;const s=this.paint.get(n),c=new yw(s),p=new Eu(c,s.property.specification);let g=null;g=s.value.kind==="constant"||s.value.kind==="source"?new Gd("source",p):new Hd("composite",p,s.value.zoomStops,s.value._interpolationType),this.paint._values[n]=new w(s.property,g,s.parameters)}}_handleOverridablePaintPropertyUpdate(n,s,c){return!(!this.layout||s.isDataDriven()||c.isDataDriven())&&kg.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,s){const c=n.get("text-field"),p=Uv.paint.properties[s];let g=!1;const _=x=>{for(const C of x)if(p.overrides&&p.overrides.hasOverride(C))return void(g=!0)};if(c.value.kind==="constant"&&c.value.value instanceof Bi)_(c.value.value.sections);else if(c.value.kind==="source"){const x=S=>{g||(S instanceof Bo&&Di(S.value)===Ar?_(S.value.sections):S instanceof Ms?_(S.sections):S.eachChild(x))},C=c.value;C._styleExpression&&x(C._styleExpression.expression)}return g}getProgramConfiguration(n){return new Fs(this,n)}}var Xz={paint:new j({"background-color":new A(Me.paint_background["background-color"]),"background-pattern":new U(Me.paint_background["background-pattern"]),"background-opacity":new A(Me.paint_background["background-opacity"])})},Yz={paint:new j({"raster-opacity":new A(Me.paint_raster["raster-opacity"]),"raster-hue-rotate":new A(Me.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new A(Me.paint_raster["raster-brightness-min"]),"raster-brightness-max":new A(Me.paint_raster["raster-brightness-max"]),"raster-saturation":new A(Me.paint_raster["raster-saturation"]),"raster-contrast":new A(Me.paint_raster["raster-contrast"]),"raster-resampling":new A(Me.paint_raster["raster-resampling"]),"raster-fade-duration":new A(Me.paint_raster["raster-fade-duration"])})};class Jz extends Ho{constructor(n){super(n,{}),this.implementation=n}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(n){this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)}onRemove(n){this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)}}var Kz={paint:new j({"sky-type":new A(Me.paint_sky["sky-type"]),"sky-atmosphere-sun":new A(Me.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new A(Me.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new A(Me.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new A(Me.paint_sky["sky-gradient-radius"]),"sky-gradient":new V(Me.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new A(Me.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new A(Me.paint_sky["sky-atmosphere-color"]),"sky-opacity":new A(Me.paint_sky["sky-opacity"])})};function Vv(a,n,s){const c=[0,0,1],p=Mb([]);return function(g,_,x){x*=.5;var C=_[0],S=_[1],R=_[2],B=_[3],N=Math.sin(x),H=Math.cos(x);g[0]=C*H-R*N,g[1]=S*H+B*N,g[2]=R*H+C*N,g[3]=B*H-S*N}(p,p,s?-F(a)+Math.PI:F(a)),Tb(p,p,-F(n)),bb(c,c,p),fp(c,c)}const Qz={circle:class extends Ho{constructor(a){super(a,_R)}createBucket(a){return new av(a)}queryRadius(a){const n=a;return Wu("circle-radius",this,n)+Wu("circle-stroke-width",this,n)+_g(this.paint.get("circle-translate"))}queryIntersectsFeature(a,n,s,c,p,g,_,x){const C=pb(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(n,s)+this.paint.get("circle-stroke-width").evaluate(n,s);return Eb(a,c,g,_,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",C,S)}getProgramIds(){return["circle"]}getProgramConfiguration(a){return new Fs(this,a)}},heatmap:class extends Ho{createBucket(a){return new Ab(a)}constructor(a){super(a,ER),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=vv({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(a){return Wu("heatmap-radius",this,a)}queryIntersectsFeature(a,n,s,c,p,g,_,x){const C=this.paint.get("heatmap-radius").evaluate(n,s);return Eb(a,c,g,_,x,!0,!0,new M(0,0),C)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(a){return new Fs(this,a)}},hillshade:class extends Ho{constructor(a){super(a,CR)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Ho{constructor(a){super(a,HR)}getProgramIds(){const a=this.paint.get("fill-pattern"),n=a&&a.constantOr(1),s=[n?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&s.push(n&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),s}getProgramConfiguration(a){return new Fs(this,a)}recalculate(a,n){super.recalculate(a,n);const s=this.paint._values["fill-outline-color"];s.value.kind==="constant"&&s.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new Tg(a)}queryRadius(){return _g(this.paint.get("fill-translate"))}queryIntersectsFeature(a,n,s,c,p,g){return!a.queryGeometry.isAboveHorizon&&lb(db(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),c)}isTileClipped(){return!0}},"fill-extrusion":class extends Ho{constructor(a){super(a,tz)}createBucket(a){return new Mp(a)}queryRadius(){return _g(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(a){return new Fs(this,a)}queryIntersectsFeature(a,n,s,c,p,g,_,x,C){const S=pb(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),R=this.paint.get("fill-extrusion-height").evaluate(n,s),B=this.paint.get("fill-extrusion-base").evaluate(n,s),N=[0,0],H=x&&g.elevation,Z=g.elevation?g.elevation.exaggeration():1,Q=a.tile.getBucket(this);if(H&&Q instanceof Mp){const Fe=Q.centroidVertexArray,je=C+1;if(je<Fe.length){const Xe=Fe.get(je);N[0]=Xe.a_centroid_pos0,N[1]=Xe.a_centroid_pos1}}if(N[0]===0&&N[1]===1)return!1;const le=function(Fe,je,Xe,Ye,Je,ut,dt,xt,Et){return ut?function(ot,mt,Dt,Ft,Rt,Bt,En,Un,An){const Bn=[],Qt=[],jt=[0,0,0,1];for(const Vn of ot){const Jn=[],Fi=[];for(const ui of Vn){const Oi=ui.x+Ft.x,Kn=ui.y+Ft.y,Hn=nz(Oi,Kn,mt,Dt,Bt,En,Un,An);jt[0]=Oi,jt[1]=Kn,jt[2]=Hn.base,jt[3]=1,$u(jt,jt,Rt),jt[3]=Math.max(jt[3],1e-5);const ni=Ub([jt[0]/jt[3],jt[1]/jt[3],jt[2]/jt[3]]);jt[0]=Oi,jt[1]=Kn,jt[2]=Hn.top,jt[3]=1,$u(jt,jt,Rt),jt[3]=Math.max(jt[3],1e-5);const wi=Ub([jt[0]/jt[3],jt[1]/jt[3],jt[2]/jt[3]]);Jn.push(ni),Fi.push(wi)}Bn.push(Jn),Qt.push(Fi)}return[Bn,Qt]}(Fe,je,Xe,Ye,Je,ut,dt,xt,Et):function(ot,mt,Dt,Ft,Rt){const Bt=[],En=[],Un=Rt[8]*mt,An=Rt[9]*mt,Bn=Rt[10]*mt,Qt=Rt[11]*mt,jt=Rt[8]*Dt,Vn=Rt[9]*Dt,Jn=Rt[10]*Dt,Fi=Rt[11]*Dt;for(const ui of ot){const Oi=[],Kn=[];for(const Hn of ui){const ni=Hn.x+Ft.x,wi=Hn.y+Ft.y,Ci=Rt[0]*ni+Rt[4]*wi+Rt[12],Ni=Rt[1]*ni+Rt[5]*wi+Rt[13],Xi=Rt[2]*ni+Rt[6]*wi+Rt[14],Kr=Rt[3]*ni+Rt[7]*wi+Rt[15],Br=Ci+Un,ii=Ni+An,vr=Xi+Bn,Qr=Math.max(Kr+Qt,1e-5),er=Ci+jt,Yi=Ni+Vn,fi=Xi+Jn,hi=Math.max(Kr+Fi,1e-5),Fr=new M(Br/Qr,ii/Qr);Fr.z=vr/Qr,Oi.push(Fr);const xr=new M(er/hi,Yi/hi);xr.z=fi/hi,Kn.push(xr)}Bt.push(Oi),En.push(Kn)}return[Bt,En]}(Fe,je,Xe,Ye,Je)}(c,B,R,S,_,H?x:null,N,Z,g.center.lat),ve=a.queryGeometry;return function(Fe,je,Xe){let Ye=1/0;lb(Xe,je)&&(Ye=Nb(Xe,je[0]));for(let Je=0;Je<je.length;Je++){const ut=je[Je],dt=Fe[Je];for(let xt=0;xt<ut.length-1;xt++){const Et=ut[xt],ot=[Et,ut[xt+1],dt[xt+1],dt[xt],Et];sb(Xe,ot)&&(Ye=Math.min(Ye,Nb(Xe,ot)))}}return Ye!==1/0&&Ye}(le[0],le[1],ve.isPointQuery()?ve.screenBounds:ve.screenGeometry)}},line:class extends Ho{constructor(a){super(a,Vb),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const n=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=n._styleExpression&&n._styleExpression.expression instanceof Tl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,n){super.recalculate(a,n),this.paint._values["line-floorwidth"]=Gb.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new Cg(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(a){return new Fs(this,a)}queryRadius(a){const n=a,s=Hb(Wu("line-width",this,n),Wu("line-gap-width",this,n)),c=Wu("line-offset",this,n);return s/2+Math.abs(c)+_g(this.paint.get("line-translate"))}queryIntersectsFeature(a,n,s,c,p,g){if(a.queryGeometry.isAboveHorizon)return!1;const _=db(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),x=a.pixelToTileUnitsFactor/2*Hb(this.paint.get("line-width").evaluate(n,s),this.paint.get("line-gap-width").evaluate(n,s)),C=this.paint.get("line-offset").evaluate(n,s);return C&&(c=function(S,R){const B=[],N=new M(0,0);for(let H=0;H<S.length;H++){const Z=S[H],Q=[];for(let le=0;le<Z.length;le++){const ve=Z[le-1],Fe=Z[le],je=Z[le+1],Xe=le===0?N:Fe.sub(ve)._unit()._perp(),Ye=le===Z.length-1?N:je.sub(Fe)._unit()._perp(),Je=Xe._add(Ye)._unit();Je._mult(1/(Je.x*Ye.x+Je.y*Ye.y)),Q.push(Je._mult(R)._add(Fe))}B.push(Q)}return B}(c,C*a.pixelToTileUnitsFactor)),function(S,R,B){for(let N=0;N<R.length;N++){const H=R[N];if(S.length>=3){for(let Z=0;Z<H.length;Z++)if(Hu(S,H[Z]))return!0}if(fR(S,H,B))return!0}return!1}(_,c,x)}isTileClipped(){return!0}},symbol:kg,background:class extends Ho{constructor(a){super(a,Xz)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ho{constructor(a){super(a,Yz)}getProgramIds(){return["raster"]}},sky:class extends Ho{constructor(a){super(a,Kz),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="sky-gradient"?this._updateColorRamp():a!=="sky-atmosphere-sun"&&a!=="sky-atmosphere-halo-color"&&a!=="sky-atmosphere-color"&&a!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=vv({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const n=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==n.azimuthal||this._lightPosition.polar!==n.polar}return!1}getCenter(a,n){if(this.paint.get("sky-type")==="atmosphere"){const c=this.paint.get("sky-atmosphere-sun"),p=!c,g=a.style.light,_=g.properties.get("position");return p&&g.properties.get("anchor")==="viewport"&&xe("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?Vv(_.azimuthal,90-_.polar,n):Vv(c[0],90-c[1],n)}const s=this.paint.get("sky-gradient-center");return Vv(s[0],90-s[1],n)}is3D(){return!1}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return a==="atmosphere"?["skyboxCapture","skybox"]:a==="gradient"?["skyboxGradient"]:null}}};class Dp{constructor(n,s,c,p){this.context=n,this.format=c,this.texture=n.gl.createTexture(),this.update(s,p)}update(n,s,c){const{width:p,height:g}=n,{context:_}=this,{gl:x}=_,{HTMLImageElement:C,HTMLCanvasElement:S,HTMLVideoElement:R,ImageData:B,ImageBitmap:N}=L;if(x.bindTexture(x.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!s||s.premultiply!==!1)),c||this.size&&this.size[0]===p&&this.size[1]===g){const{x:H,y:Z}=c||{x:0,y:0};n instanceof C||n instanceof S||n instanceof R||n instanceof B||N&&n instanceof N?x.texSubImage2D(x.TEXTURE_2D,0,H,Z,x.RGBA,x.UNSIGNED_BYTE,n):x.texSubImage2D(x.TEXTURE_2D,0,H,Z,p,g,x.RGBA,x.UNSIGNED_BYTE,n.data)}else this.size=[p,g],n instanceof C||n instanceof S||n instanceof R||n instanceof B||N&&n instanceof N?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,n):x.texImage2D(x.TEXTURE_2D,0,this.format,p,g,0,this.format,x.UNSIGNED_BYTE,n.data);this.useMipmap=!!(s&&s.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(n,s){const{context:c}=this,{gl:p}=c;p.bindTexture(p.TEXTURE_2D,this.texture),n!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,n),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?n===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_NEAREST:n),this.filter=n),s!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,s),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}class Gv{constructor(n,s){this.width=n,this.height=s,this.nextRow=0,this.image=new Xa({width:n,height:s}),this.positions={},this.uploaded=!1}getDash(n,s){const c=this.getKey(n,s);return this.positions[c]}trim(){const n=this.width,s=this.height=$e(this.nextRow);this.image.resize({width:n,height:s})}getKey(n,s){return n.join(",")+s}getDashRanges(n,s,c){const p=[];let g=n.length%2==1?-n[n.length-1]*c:0,_=n[0]*c,x=!0;p.push({left:g,right:_,isDash:x,zeroLength:n[0]===0});let C=n[0];for(let S=1;S<n.length;S++){x=!x;const R=n[S];g=C*c,C+=R,_=C*c,p.push({left:g,right:_,isDash:x,zeroLength:R===0})}return p}addRoundDash(n,s,c){const p=s/2;for(let g=-c;g<=c;g++){const _=this.width*(this.nextRow+c+g);let x=0,C=n[x];for(let S=0;S<this.width;S++){S/C.right>1&&(C=n[++x]);const R=Math.abs(S-C.left),B=Math.abs(S-C.right),N=Math.min(R,B);let H;const Z=g/c*(p+1);if(C.isDash){const Q=p-Math.abs(Z);H=Math.sqrt(N*N+Q*Q)}else H=p-Math.sqrt(N*N+Z*Z);this.image.data[_+S]=Math.max(0,Math.min(255,H+128))}}}addRegularDash(n,s){for(let C=n.length-1;C>=0;--C){const S=n[C],R=n[C+1];S.zeroLength?n.splice(C,1):R&&R.isDash===S.isDash&&(R.left=S.left,n.splice(C,1))}const c=n[0],p=n[n.length-1];c.isDash===p.isDash&&(c.left=p.left-this.width,p.right=c.right+this.width);const g=this.width*this.nextRow;let _=0,x=n[_];for(let C=0;C<this.width;C++){C/x.right>1&&(x=n[++_]);const S=Math.abs(C-x.left),R=Math.abs(C-x.right),B=Math.min(S,R);this.image.data[g+C]=Math.max(0,Math.min(255,(x.isDash?B:-B)+s+128))}}addDash(n,s){const c=this.getKey(n,s);if(this.positions[c])return this.positions[c];const p=s==="round",g=p?7:0,_=2*g+1;if(this.nextRow+_>this.height)return xe("LineAtlas out of space"),null;n.length===0&&n.push(1);let x=0;for(let R=0;R<n.length;R++)n[R]<0&&(xe("Negative value is found in line dasharray, replacing values with 0"),n[R]=0),x+=n[R];if(x!==0){const R=this.width/x,B=this.getDashRanges(n,this.width,R);p?this.addRoundDash(B,R,g):this.addRegularDash(B,s==="square"?.5*R:0)}const C=this.nextRow+g;this.nextRow+=_;const S={tl:[C,g],br:[x,0]};return this.positions[c]=S,S}}$t(Gv,"LineAtlas");class ek{constructor(n){this._callback=n,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}const tk=L.performance;function _w(a){const n=a?a.url.toString():void 0;return tk.getEntriesByName(n)}class nk{constructor(){this.tasks={},this.taskQueue=[],At(["process"],this),this.invoker=new ek(this.process),this.nextId=0}add(n,s){const c=this.nextId++,p=function({type:g,isSymbolTile:_,zoom:x}){return x=x||0,g==="message"?0:g!=="maybePrepare"||_?g!=="parseTile"||_?g==="parseTile"&&_?300-x:g==="maybePrepare"&&_?400-x:500:200-x:100-x}(s);if(p===0){ze();try{n()}finally{}return{cancel:()=>{}}}return this.tasks[c]={fn:n,metadata:s,priority:p,id:c},this.taskQueue.push(c),this.invoker.trigger(),{cancel:()=>{delete this.tasks[c]}}}process(){ze();try{if(this.taskQueue=this.taskQueue.filter(c=>!!this.tasks[c]),!this.taskQueue.length)return;const n=this.pick();if(n===null)return;const s=this.tasks[n];if(delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),!s)return;s.fn()}finally{}}pick(){let n=null,s=1/0;for(let p=0;p<this.taskQueue.length;p++){const g=this.tasks[this.taskQueue[p]];g.priority<s&&(s=g.priority,n=p)}if(n===null)return null;const c=this.taskQueue[n];return this.taskQueue.splice(n,1),c}remove(){this.invoker.remove()}}const ik=Pe([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),rk=Pe([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:vw}=ik,xw=Pe([{name:"a_pos_3",components:3,type:"Int16"}]);var Pp=Pe([{name:"a_pos",type:"Int16",components:2}]);const th=In/Math.PI/2,Yr=-th,Jr=th,ok=[new go([Yr,Yr,Yr],[Jr,Jr,Jr]),new go([Yr,Yr,Yr],[0,0,Jr]),new go([0,Yr,Yr],[Jr,0,Jr]),new go([Yr,0,Yr],[0,Jr,Jr]),new go([0,0,Yr],[Jr,Jr,Jr])];class ak{constructor(n,s,c){this.a=ju([],n,c),this.b=ju([],s,c),this.center=c;const p=fp([],this.a),g=fp([],this.b);this.angle=Math.acos(mp(p,g))}}function Hv(a,n){if(a.angle===0)return null;let s;return s=a.a[n]===0?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[n]/a.a[n]/Math.sin(a.angle)-1/Math.tan(a.angle)),s<0||s>1?null:function(c,p,g,_){const x=Math.sin(g);return c*(Math.sin((1-_)*g)/x)+p*(Math.sin(_*g)/x)}(a.a[n],a.b[n],a.angle,te(s,0,1))+a.center[n]}function Lp(a){if(a.z<=1)return ok[a.z+2*a.y+a.x];const[n,s]=Wv(a),c=[Ka(n[0],n[1]),Ka(n[0],s[1]),Ka(s[0],n[1]),Ka(s[0],s[1])],p=[Jr,Jr,Jr],g=[Yr,Yr,Yr];for(const _ of c)p[0]=Math.min(p[0],_[0]),p[1]=Math.min(p[1],_[1]),p[2]=Math.min(p[2],_[2]),g[0]=Math.max(g[0],_[0]),g[1]=Math.max(g[1],_[1]),g[2]=Math.max(g[2],_[2]);return new go(p,g)}function sk(a,n,s){const c=n/a.worldSize,p=(mt,Dt)=>{pp(mt,mt,c),pp(Dt,Dt,c)},g=Number.MAX_VALUE,_=[-g,-g,-g],x=[g,g,g],C=Ew(a);if(s.z<=1){const mt=Lp(s).getCorners();for(let Dt=0;Dt<mt.length;Dt++)Xl(mt[Dt],mt[Dt],C),fv(x,x,mt[Dt]),mv(_,_,mt[Dt]);return p(x,_),new go(x,_)}const[S,R]=Wv(s),B=new Os;B.setSouthWest([S[1],R[0]]),B.setNorthEast([R[1],S[0]]);const N=[Ka(B.getSouth(),B.getWest()),Ka(B.getSouth(),B.getEast()),Ka(B.getNorth(),B.getEast()),Ka(B.getNorth(),B.getWest())];for(let mt=0;mt<N.length;mt++)Xl(N[mt],N[mt],C),fv(x,x,N[mt]),mv(_,_,N[mt]);if(B.contains(a.center))return _[2]=0,p(x,_),new go(x,_);const H=[C[12],C[13],C[14]],Z=a.center.lng,Q=te(a.center.lat,-85.051129,fa),le=[hp(Z),Vu(Q)],ve=B.getCenter().lng,Fe=te(B.getCenter().lat,-85.051129,fa),je=[hp(ve),Vu(Fe)];let Xe=new Array(3),Ye=0;const Je=le[0]-je[0],ut=le[1]-je[1];if(Math.abs(Je)>Math.abs(ut))Ye=Je>=0?1:3,Xe=H;else{Ye=ut>=0?0:2;const mt=[C[4],C[5],C[6]];let Dt;Dt=ut>=0?-Math.sin(F(B.getSouth()))*th:-Math.sin(F(B.getNorth()))*th,Xe=gv(Xe,H,mt,Dt)}const dt=N[Ye],xt=N[(Ye+1)%4],Et=new ak(dt,xt,Xe),ot=[Hv(Et,0)||dt[0],Hv(Et,1)||dt[1],Hv(Et,2)||dt[2]];return x[2]=Math.min(dt[2],xt[2]),fv(x,x,ot),mv(_,_,ot),p(x,_),new go(x,_)}function Wv(a){const n=1<<a.z,s=a.x/n,c=(a.x+1)/n,p=(a.y+1)/n;return[[rr(a.y/n),To(s)],[rr(p),To(c)]]}function bw(a,n,s,c=th){return s=F(s),[a*Math.sin(s)*c,-n*c,a*Math.cos(s)*c]}function Ka(a,n,s){return bw(Math.cos(F(a)),Math.sin(F(a)),n,s)}function ww(a,n,s){const c=Math.pow(2,s.z),p=(a/In+s.x)/c;return Ka(rr((n/In+s.y)/c),To(p))}function jv(a){return 16383/Math.max(...ju([],a.max,a.min))}function Mw(a){const n=ma(new Float64Array(16)),s=jv(a);var c,p;return Ns(n,n,[s,s,s]),Zl(n,n,((c=[])[0]=-(p=a.min)[0],c[1]=-p[1],c[2]=-p[2],c)),n}function Tw(a,n,s,c,p){const g=function(C){const S=In/(2*Math.PI);return C/(2*Math.PI)/S}(s),_=[a,n,-s/(2*Math.PI)],x=ma(new Float64Array(16));return Zl(x,x,_),Ns(x,x,[g,g,g]),hv(x,x,F(-p)),dv(x,x,F(-c)),x}function Ew(a){const{x:n,y:s}=a.point,{lng:c,lat:p}=a._center;return Tw(n,s,a.worldSize,c,p)}const Cw=F(85),lk=Math.cos(Cw),ck=Math.sin(Cw);function Aw(a,n,s){var c=2*Math.PI*6378137/256/Math.pow(2,s);return[a*c-2*Math.PI*6378137/2,n*c-2*Math.PI*6378137/2]}class Bg{constructor(n,s,c){this.z=n,this.x=s,this.y=c,this.key=Ip(0,n,n,s,c)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,s){const c=function(g,_,x){var C=Aw(256*g,256*(_=Math.pow(2,x)-_-1),x),S=Aw(256*(g+1),256*(_+1),x);return C[0]+","+C[1]+","+S[0]+","+S[1]}(this.x,this.y,this.z),p=function(g,_,x){let C,S="";for(let R=g;R>0;R--)C=1<<R-1,S+=(_&C?1:0)+(x&C?2:0);return S}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(s==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",c)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Sw{constructor(n,s){this.wrap=n,this.canonical=s,this.key=Ip(n,s.z,s.z,s.x,s.y)}}class _r{constructor(n,s,c,p,g){this.overscaledZ=n,this.wrap=s,this.canonical=new Bg(c,+p,+g),this.key=s===0&&n===c?this.canonical.key:Ip(s,n,c,p,g)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){const s=this.canonical.z-n;return n>this.canonical.z?new _r(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new _r(n,this.wrap,n,this.canonical.x>>s,this.canonical.y>>s)}calculateScaledKey(n,s=!0){if(this.overscaledZ===n&&s)return this.key;if(n>this.canonical.z)return Ip(this.wrap*+s,n,this.canonical.z,this.canonical.x,this.canonical.y);{const c=this.canonical.z-n;return Ip(this.wrap*+s,n,n,this.canonical.x>>c,this.canonical.y>>c)}}isChildOf(n){if(n.wrap!==this.wrap)return!1;const s=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.x===this.canonical.x>>s&&n.canonical.y===this.canonical.y>>s}children(n){if(this.overscaledZ>=n)return[new _r(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const s=this.canonical.z+1,c=2*this.canonical.x,p=2*this.canonical.y;return[new _r(s,this.wrap,s,c,p),new _r(s,this.wrap,s,c+1,p),new _r(s,this.wrap,s,c,p+1),new _r(s,this.wrap,s,c+1,p+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new _r(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new _r(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Sw(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ip(a,n,s,c,p){const g=1<<Math.min(s,22);let _=g*(p%g)+c%g;return a&&s<22&&(_+=g*g*((a<0?-2*a-1:2*a)%(1<<2*(22-s)))),16*(32*_+s)+(n-s)}function Jl(a,n){if(!n.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:n};const s=Math.pow(2,-a.z),c=a.x*s,p=(a.x+1)*s,g=a.y*s,_=(a.y+1)*s,x=To(c),C=To(p),S=rr(g),R=rr(_),B=n.project(x,S),N=n.project(C,S),H=n.project(C,R),Z=n.project(x,R);let Q=Math.min(B.x,N.x,H.x,Z.x),le=Math.min(B.y,N.y,H.y,Z.y),ve=Math.max(B.x,N.x,H.x,Z.x),Fe=Math.max(B.y,N.y,H.y,Z.y);const je=s/16;function Xe(Je,ut,dt,xt,Et,ot){const mt=(dt+Et)/2,Dt=(xt+ot)/2,Ft=n.project(To(mt),rr(Dt)),Rt=Math.max(0,Q-Ft.x,le-Ft.y,Ft.x-ve,Ft.y-Fe);Q=Math.min(Q,Ft.x),ve=Math.max(ve,Ft.x),le=Math.min(le,Ft.y),Fe=Math.max(Fe,Ft.y),Rt>je&&(Xe(Je,Ft,dt,xt,mt,Dt),Xe(Ft,ut,mt,Dt,Et,ot))}Xe(B,N,c,g,p,g),Xe(N,H,p,g,p,_),Xe(H,Z,p,_,c,_),Xe(Z,B,c,_,c,g),Q-=je,le-=je,ve+=je,Fe+=je;const Ye=1/Math.max(ve-Q,Fe-le);return{scale:Ye,x:Q*Ye,y:le*Ye,x2:ve*Ye,y2:Fe*Ye,projection:n}}$t(Bg,"CanonicalTileID"),$t(_r,"OverscaledTileID",{omit:["projMatrix"]});class Dw{constructor(n){this._stringToNumber={},this._numberToString=[];for(let s=0;s<n.length;s++){const c=n[s];this._stringToNumber[c]=s,this._numberToString[s]=c}}encode(n){return this._stringToNumber[n]}decode(n){return this._numberToString[n]}}const uk=["tile","layer","source","sourceLayer","state"];class Pw{constructor(n,s,c,p,g){this.type="Feature",this._vectorTileFeature=n,this._z=s,this._x=c,this._y=p,this.properties=n.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={type:"Feature",geometry:this.geometry,properties:this.properties};this.id!==void 0&&(n.id=this.id);for(const s of uk)this[s]!==void 0&&(n[s]=this[s]);return n}}const Eo=32,ya=33,Hs=new Uint16Array(8184);for(let a=0;a<2046;a++){let n=a+2,s=0,c=0,p=0,g=0,_=0,x=0;for(1&n?p=g=_=Eo:s=c=x=Eo;(n>>=1)>1;){const S=s+p>>1,R=c+g>>1;1&n?(p=s,g=c,s=_,c=x):(s=p,c=g,p=_,g=x),_=S,x=R}const C=4*a;Hs[C+0]=s,Hs[C+1]=c,Hs[C+2]=p,Hs[C+3]=g}const _a=new Uint16Array(2178),Ws=new Uint8Array(1089),Fg=new Uint16Array(1089);function Lw(a){return a===0?-.03125:a===32?.03125:0}var Iw=Pe([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Rw={type:2,extent:In,loadGeometry:()=>[[new M(0,0),new M(8193,0),new M(8193,8193),new M(0,8193),new M(0,0)]]};class $v{constructor(n,s,c,p,g){this.tileID=n,this.uid=Ue(),this.uses=0,this.tileSize=s,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(n){const s=n+this.timeAdded;s<wt.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=Jl(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(n,s,c){if(this.unloadVectorData(),this.state="loaded",n){n.featureIndex&&(this.latestFeatureIndex=n.featureIndex,n.rawTileData?(this.latestRawTileData=n.rawTileData,this.latestFeatureIndex.rawTileData=n.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=n.collisionBoxArray,this.buckets=function(p,g){const _={};if(!g)return _;for(const x of p){const C=x.layerIds.map(S=>g.getLayer(S)).filter(Boolean);if(C.length!==0){x.layers=C,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(S=>C.filter(R=>R.id===S)[0]));for(const S of C)_[S.id]=x}}return _}(n.buckets,s.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const g=this.buckets[p];if(g instanceof Gs){if(this.hasSymbolBuckets=!0,!c)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const g=this.buckets[p];if(g instanceof Gs&&g.hasRTLText){this.hasRTLText=!0,$r.isLoading()||$r.isLoaded()||Nu()!=="deferred"||Rs();break}}this.queryPadding=0;for(const p in this.buckets){const g=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(p).queryRadius(g))}n.imageAtlas&&(this.imageAtlas=n.imageAtlas),n.glyphAtlasImage&&(this.glyphAtlasImage=n.glyphAtlasImage),n.lineAtlas&&(this.lineAtlas=n.lineAtlas)}else this.collisionBoxArray=new Uo}unloadVectorData(){if(this.hasData()){for(const n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(n){return this.buckets[n.id]}upload(n){for(const c in this.buckets){const p=this.buckets[c];p.uploadPending()&&p.upload(n)}const s=n.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Dp(n,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Dp(n,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Dp(n,this.lineAtlas.image,s.ALPHA),this.lineAtlas.uploaded=!0)}prepare(n){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(n,this.imageAtlasTexture)}queryRenderedFeatures(n,s,c,p,g,_,x,C){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:p,pixelPosMatrix:x,transform:_,params:g,tileTransform:this.tileTransform},n,s,c):{}}querySourceFeatures(n,s){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const p=c.loadVTLayers(),g=s?s.sourceLayer:"",_=p._geojsonTileLayer||p[g];if(!_)return;const x=la(s&&s.filter),{z:C,x:S,y:R}=this.tileID.canonical,B={z:C,x:S,y:R};for(let N=0;N<_.length;N++){const H=_.feature(N);if(x.needGeometry){const le=ql(H,!0);if(!x.filter(new ci(this.tileID.overscaledZ),le,this.tileID.canonical))continue}else if(!x.filter(new ci(this.tileID.overscaledZ),H))continue;const Z=c.getId(H,g),Q=new Pw(H,C,S,R,Z);Q.tile=B,n.push(Q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(n){const s=this.expirationTime;if(n.cacheControl){const c=rt(n.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else n.expires&&(this.expirationTime=new Date(n.expires).getTime());if(this.expirationTime){const c=Date.now();let p=!1;if(this.expirationTime>c)p=!1;else if(s)if(this.expirationTime<s)p=!0;else{const g=this.expirationTime-s;g?this.expirationTime=c+Math.max(g,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(n,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(n).length===0||!s)return;const c=this.latestFeatureIndex.loadVTLayers(),p=s.style.listImages();for(const g in this.buckets){if(!s.style.hasLayer(g))continue;const _=this.buckets[g],x=_.layers[0].sourceLayer||"_geojsonTileLayer",C=c[x],S=n[x];if(!C||!S||Object.keys(S).length===0)continue;if(_.update(S,C,p,this.imageAtlas&&this.imageAtlas.patternPositions||{}),_ instanceof Cg||_ instanceof Tg){const B=s.style._getSourceCache(_.layers[0].source);s._terrain&&s._terrain.enabled&&B&&_.programConfigurations.needsUpload&&s._terrain._clearRenderCacheForTile(B.id,this.tileID)}const R=s&&s.style&&s.style.getLayer(g);R&&(this.queryPadding=Math.max(this.queryPadding,R.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<wt.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(n){this.symbolFadeHoldUntil=wt.now()+n}setTexture(n,s){const c=s.context,p=c.gl;this.texture=s.getTileTexture(n.width),this.texture?this.texture.update(n,{useMipmap:!0}):(this.texture=new Dp(c,n,p.RGBA,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE),c.extTextureFilterAnisotropic&&p.texParameterf(p.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax))}setDependencies(n,s){const c={};for(const p of s)c[p]=!0;this.dependencies[n]=c}hasDependency(n,s){for(const c of n){const p=this.dependencies[c];if(p){for(const g of s)if(p[g])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(n,s){if(!s||s.name==="mercator"||this._tileDebugBuffer)return;const c=Za(Rw,this.tileID.canonical,this.tileTransform)[0],p=new Ae,g=new $n;for(let _=0;_<c.length;_++){const{x,y:C}=c[_];p.emplaceBack(x,C),g.emplaceBack(_)}g.emplaceBack(0),this._tileDebugIndexBuffer=n.createIndexBuffer(g),this._tileDebugBuffer=n.createVertexBuffer(p,Pp.members),this._tileDebugSegments=Ei.simpleSegment(0,0,p.length,g.length)}_makeTileBoundsBuffers(n,s){if(this._tileBoundsBuffer||!s||s.name==="mercator")return;const c=Za(Rw,this.tileID.canonical,this.tileTransform)[0];let p,g;if(this.isRaster){const _=function(x,C){const S=Jl(x,C),R=Math.pow(2,x.z);for(let le=0;le<ya;le++)for(let ve=0;ve<ya;ve++){const Fe=To((x.x+(ve+Lw(ve))/Eo)/R),je=rr((x.y+(le+Lw(le))/Eo)/R),Xe=C.project(Fe,je),Ye=le*ya+ve;_a[2*Ye+0]=Math.round((Xe.x*S.scale-S.x)*In),_a[2*Ye+1]=Math.round((Xe.y*S.scale-S.y)*In)}Ws.fill(0),Fg.fill(0);for(let le=2045;le>=0;le--){const ve=4*le,Fe=Hs[ve+0],je=Hs[ve+1],Xe=Hs[ve+2],Ye=Hs[ve+3],Je=Fe+Xe>>1,ut=je+Ye>>1,dt=Je+ut-je,xt=ut+Fe-Je,Et=je*ya+Fe,ot=Ye*ya+Xe,mt=ut*ya+Je,Dt=Math.hypot((_a[2*Et+0]+_a[2*ot+0])/2-_a[2*mt+0],(_a[2*Et+1]+_a[2*ot+1])/2-_a[2*mt+1])>=16;if(Ws[mt]=Ws[mt]||(Dt?1:0),le<1022){const Ft=(je+xt>>1)*ya+(Fe+dt>>1),Rt=(Ye+xt>>1)*ya+(Xe+dt>>1);Ws[mt]=Ws[mt]||Ws[Ft]||Ws[Rt]}}const B=new ke,N=new qt;let H=0;function Z(le,ve){const Fe=ve*ya+le;return Fg[Fe]===0&&(B.emplaceBack(_a[2*Fe+0],_a[2*Fe+1],le*In/Eo,ve*In/Eo),Fg[Fe]=++H),Fg[Fe]-1}function Q(le,ve,Fe,je,Xe,Ye){const Je=le+Fe>>1,ut=ve+je>>1;if(Math.abs(le-Xe)+Math.abs(ve-Ye)>1&&Ws[ut*ya+Je])Q(Xe,Ye,le,ve,Je,ut),Q(Fe,je,Xe,Ye,Je,ut);else{const dt=Z(le,ve),xt=Z(Fe,je),Et=Z(Xe,Ye);N.emplaceBack(dt,xt,Et)}}return Q(0,0,Eo,Eo,Eo,0),Q(Eo,Eo,0,0,0,Eo),{vertices:B,indices:N}}(this.tileID.canonical,s);p=_.vertices,g=_.indices}else{p=new ke,g=new qt;for(const{x,y:C}of c)p.emplaceBack(x,C,0,0);const _=vg(p.int16,void 0,4);for(let x=0;x<_.length;x+=3)g.emplaceBack(_[x],_[x+1],_[x+2])}this._tileBoundsBuffer=n.createVertexBuffer(p,Iw.members),this._tileBoundsIndexBuffer=n.createIndexBuffer(g),this._tileBoundsSegments=Ei.simpleSegment(0,0,p.length,g.length)}_makeGlobeTileDebugBuffers(n,s){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!s||s.name!=="globe")return;const c=this.tileID.canonical,p=Mw(Lp(c));this._makeGlobeTileDebugBorderBuffer(n,c,p),this._makeGlobeTileDebugTextBuffer(n,c,p)}_makeGlobeTileDebugBorderBuffer(n,s,c){const p=new Ae,g=new $n,_=new De,x=(S,R,B,N,H)=>{const Z=(B-S)/(H-1),Q=(N-R)/(H-1),le=p.length;for(let ve=0;ve<H;ve++){const Fe=S+ve*Z,je=R+ve*Q;p.emplaceBack(Fe,je);const Xe=ww(Fe,je,s),Ye=Xl(Xe,Xe,c);_.emplaceBack(Ye[0],Ye[1],Ye[2]),g.emplaceBack(le+ve)}},C=In;x(0,0,C,0,16),x(C,0,C,C,16),x(C,C,0,C,16),x(0,C,0,0,16),this._tileDebugIndexBuffer=n.createIndexBuffer(g),this._tileDebugBuffer=n.createVertexBuffer(p,Pp.members),this._globeTileDebugBorderBuffer=n.createVertexBuffer(_,xw.members),this._tileDebugSegments=Ei.simpleSegment(0,0,p.length,g.length)}_makeGlobeTileDebugTextBuffer(n,s,c){const p=new Ae,g=new qt,_=new De,x=25;g.reserve(32),p.reserve(x),_.reserve(x);const C=(S,R)=>x*S+R;for(let S=0;S<x;S++){const R=2048*S;for(let B=0;B<x;B++){const N=2048*B;p.emplaceBack(N,R);const H=ww(N,R,s),Z=Xl(H,H,c);_.emplaceBack(Z[0],Z[1],Z[2])}}for(let S=0;S<4;S++)for(let R=0;R<4;R++){const B=C(S,R),N=C(S,R+1),H=C(S+1,R),Z=C(S+1,R+1);g.emplaceBack(B,N,H),g.emplaceBack(H,N,Z)}this._tileDebugTextIndexBuffer=n.createIndexBuffer(g),this._tileDebugTextBuffer=n.createVertexBuffer(p,Pp.members),this._globeTileDebugTextBuffer=n.createVertexBuffer(_,xw.members),this._tileDebugTextSegments=Ei.simpleSegment(0,0,x,32)}}class hk{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(n,s,c){const p=String(s);if(this.stateChanges[n]=this.stateChanges[n]||{},this.stateChanges[n][p]=this.stateChanges[n][p]||{},me(this.stateChanges[n][p],c),this.deletedStates[n]===null){this.deletedStates[n]={};for(const g in this.state[n])g!==p&&(this.deletedStates[n][g]=null)}else if(this.deletedStates[n]&&this.deletedStates[n][p]===null){this.deletedStates[n][p]={};for(const g in this.state[n][p])c[g]||(this.deletedStates[n][p][g]=null)}else for(const g in c)this.deletedStates[n]&&this.deletedStates[n][p]&&this.deletedStates[n][p][g]===null&&delete this.deletedStates[n][p][g]}removeFeatureState(n,s,c){if(this.deletedStates[n]===null)return;const p=String(s);if(this.deletedStates[n]=this.deletedStates[n]||{},c&&s!==void 0)this.deletedStates[n][p]!==null&&(this.deletedStates[n][p]=this.deletedStates[n][p]||{},this.deletedStates[n][p][c]=null);else if(s!==void 0)if(this.stateChanges[n]&&this.stateChanges[n][p])for(c in this.deletedStates[n][p]={},this.stateChanges[n][p])this.deletedStates[n][p][c]=null;else this.deletedStates[n][p]=null;else this.deletedStates[n]=null}getState(n,s){const c=String(s),p=me({},(this.state[n]||{})[c],(this.stateChanges[n]||{})[c]);if(this.deletedStates[n]===null)return{};if(this.deletedStates[n]){const g=this.deletedStates[n][s];if(g===null)return{};for(const _ in g)delete p[_]}return p}initializeTileState(n,s){n.setFeatureState(this.state,s)}coalesceChanges(n,s){const c={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const g={};for(const _ in this.stateChanges[p])this.state[p][_]||(this.state[p][_]={}),me(this.state[p][_],this.stateChanges[p][_]),g[_]=this.state[p][_];c[p]=g}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const g={};if(this.deletedStates[p]===null)for(const _ in this.state[p])g[_]={},this.state[p][_]={};else for(const _ in this.deletedStates[p]){if(this.deletedStates[p][_]===null)this.state[p][_]={};else for(const x of Object.keys(this.deletedStates[p][_]))delete this.state[p][_][x];g[_]=this.state[p][_]}c[p]=c[p]||{},me(c[p],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const p in n)n[p].setFeatureState(c,s)}}class zw{constructor(n){this.size=n,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(n,s){const c=this.toIdx(n,s);return{min:this.minimums[c],max:this.maximums[c]}}isLeaf(n,s){return this.leaves[this.toIdx(n,s)]}toIdx(n,s){return s*this.size+n}}function kw(a,n,s,c){let p=0,g=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(c[_])<1e-15){if(s[_]<a[_]||s[_]>n[_])return null}else{const x=1/c[_];let C=(a[_]-s[_])*x,S=(n[_]-s[_])*x;if(C>S){const R=C;C=S,S=R}if(C>p&&(p=C),S<g&&(g=S),p>g)return null}return p}function Bw(a,n,s,c,p,g,_,x,C,S,R){const B=c-a,N=p-n,H=g-s,Z=_-a,Q=x-n,le=C-s,ve=R[1]*le-R[2]*Q,Fe=R[2]*Z-R[0]*le,je=R[0]*Q-R[1]*Z,Xe=B*ve+N*Fe+H*je;if(Math.abs(Xe)<1e-15)return null;const Ye=1/Xe,Je=S[0]-a,ut=S[1]-n,dt=S[2]-s,xt=(Je*ve+ut*Fe+dt*je)*Ye;if(xt<0||xt>1)return null;const Et=ut*H-dt*N,ot=dt*B-Je*H,mt=Je*N-ut*B,Dt=(R[0]*Et+R[1]*ot+R[2]*mt)*Ye;return Dt<0||xt+Dt>1?null:(Z*Et+Q*ot+le*mt)*Ye}function Fw(a,n,s){return(a-n)/(s-n)}function Ow(a,n,s,c,p,g,_,x,C){const S=1<<s,R=g-c,B=_-p,N=(a+1)/S*R+c,H=(n+0)/S*B+p,Z=(n+1)/S*B+p;x[0]=(a+0)/S*R+c,x[1]=H,C[0]=N,C[1]=Z}class Nw{constructor(n){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=n,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const s=function(g){const _=Math.ceil(Math.log2(g.dim/8)),x=[];let C=Math.ceil(Math.pow(2,_));const S=1/C,R=(H,Z,Q,le,ve)=>{const Fe=le?1:0,je=(H+1)*Q-Fe,Xe=Z*Q,Ye=(Z+1)*Q-Fe;ve[0]=H*Q,ve[1]=Xe,ve[2]=je,ve[3]=Ye};let B=new zw(C);const N=[];for(let H=0;H<C*C;H++){R(H%C,Math.floor(H/C),S,!1,N);const Z=js(N[0],N[1],g),Q=js(N[2],N[1],g),le=js(N[2],N[3],g),ve=js(N[0],N[3],g);B.minimums.push(Math.min(Z,Q,le,ve)),B.maximums.push(Math.max(Z,Q,le,ve)),B.leaves.push(1)}for(x.push(B),C/=2;C>=1;C/=2){const H=x[x.length-1];B=new zw(C);for(let Z=0;Z<C*C;Z++){R(Z%C,Math.floor(Z/C),2,!0,N);const Q=H.getElevation(N[0],N[1]),le=H.getElevation(N[2],N[1]),ve=H.getElevation(N[2],N[3]),Fe=H.getElevation(N[0],N[3]),je=H.isLeaf(N[0],N[1]),Xe=H.isLeaf(N[2],N[1]),Ye=H.isLeaf(N[2],N[3]),Je=H.isLeaf(N[0],N[3]),ut=Math.min(Q.min,le.min,ve.min,Fe.min),dt=Math.max(Q.max,le.max,ve.max,Fe.max),xt=je&&Xe&&Ye&&Je;B.maximums.push(dt),B.minimums.push(ut),B.leaves.push(dt-ut<=5&&xt?1:0)}x.push(B)}return x}(this.dem),c=s.length-1,p=s[c];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(s,0,0,c,0)}raycastRoot(n,s,c,p,g,_,x=1){return kw([n,s,-100],[c,p,this.maximums[0]*x],g,_)}raycast(n,s,c,p,g,_,x=1){if(!this.nodeCount)return null;const C=this.raycastRoot(n,s,c,p,g,_,x);if(C==null)return null;const S=[],R=[],B=[],N=[],H=[{idx:0,t:C,nodex:0,nodey:0,depth:0}];for(;H.length>0;){const{idx:Z,t:Q,nodex:le,nodey:ve,depth:Fe}=H.pop();if(this.leaves[Z]){Ow(le,ve,Fe,n,s,c,p,B,N);const Xe=1<<Fe,Ye=(le+0)/Xe,Je=(le+1)/Xe,ut=(ve+0)/Xe,dt=(ve+1)/Xe,xt=js(Ye,ut,this.dem)*x,Et=js(Je,ut,this.dem)*x,ot=js(Je,dt,this.dem)*x,mt=js(Ye,dt,this.dem)*x,Dt=Bw(B[0],B[1],xt,N[0],B[1],Et,N[0],N[1],ot,g,_),Ft=Bw(N[0],N[1],ot,B[0],N[1],mt,B[0],B[1],xt,g,_),Rt=Math.min(Dt!==null?Dt:Number.MAX_VALUE,Ft!==null?Ft:Number.MAX_VALUE);if(Rt!==Number.MAX_VALUE)return Rt;{const Bt=gv([],g,_,Q);if(Uw(xt,Et,mt,ot,Fw(Bt[0],B[0],N[0]),Fw(Bt[1],B[1],N[1]))>=Bt[2])return Q}continue}let je=0;for(let Xe=0;Xe<this._siblingOffset.length;Xe++){Ow((le<<1)+this._siblingOffset[Xe][0],(ve<<1)+this._siblingOffset[Xe][1],Fe+1,n,s,c,p,B,N),B[2]=-100,N[2]=this.maximums[this.childOffsets[Z]+Xe]*x;const Ye=kw(B,N,g,_);if(Ye!=null){const Je=Ye;S[Xe]=Je;let ut=!1;for(let dt=0;dt<je&&!ut;dt++)Je>=S[R[dt]]&&(R.splice(dt,0,Xe),ut=!0);ut||(R[je]=Xe),je++}}for(let Xe=0;Xe<je;Xe++){const Ye=R[Xe];H.push({idx:this.childOffsets[Z]+Ye,t:S[Ye],nodex:(le<<1)+this._siblingOffset[Ye][0],nodey:(ve<<1)+this._siblingOffset[Ye][1],depth:Fe+1})}}return null}_addNode(n,s,c){return this.minimums.push(n),this.maximums.push(s),this.leaves.push(c),this.childOffsets.push(0),this.nodeCount++}_construct(n,s,c,p,g){if(n[p].isLeaf(s,c)===1)return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const _=p-1,x=n[_];let C=0,S=0;for(let R=0;R<this._siblingOffset.length;R++){const B=2*s+this._siblingOffset[R][0],N=2*c+this._siblingOffset[R][1],H=x.getElevation(B,N),Z=x.isLeaf(B,N),Q=this._addNode(H.min,H.max,Z);Z&&(C|=1<<R),S||(S=Q)}for(let R=0;R<this._siblingOffset.length;R++)C&1<<R||this._construct(n,2*s+this._siblingOffset[R][0],2*c+this._siblingOffset[R][1],_,S+R)}}function Uw(a,n,s,c,p,g){return yn(yn(a,s,g),yn(n,c,g),p)}function js(a,n,s){const c=s.dim,p=te(a*c-.5,0,c-1),g=te(n*c-.5,0,c-1),_=Math.floor(p),x=Math.floor(g),C=Math.min(_+1,c-1),S=Math.min(x+1,c-1);return Uw(s.get(_,x),s.get(C,x),s.get(_,S),s.get(C,S),p-_,g-x)}const Vw={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Og{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(n,s,c,p=!1,g=!1){if(this.uid=n,s.height!==s.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return xe(`"${c}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=s.height;const _=this.dim=s.height-2,x=new Uint32Array(s.data.buffer);if(this.pixels=new Uint8Array(s.data.buffer),this.encoding=c||"mapbox",this.borderReady=p,!p){for(let C=0;C<_;C++)x[this._idx(-1,C)]=x[this._idx(0,C)],x[this._idx(_,C)]=x[this._idx(_-1,C)],x[this._idx(C,-1)]=x[this._idx(C,0)],x[this._idx(C,_)]=x[this._idx(C,_-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(_,-1)]=x[this._idx(_-1,0)],x[this._idx(-1,_)]=x[this._idx(0,_-1)],x[this._idx(_,_)]=x[this._idx(_-1,_-1)],g&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Nw(this)}get(n,s,c=!1){c&&(n=te(n,-1,this.dim),s=te(s,-1,this.dim));const p=4*this._idx(n,s);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(this.pixels[p],this.pixels[p+1],this.pixels[p+2])}static getUnpackVector(n){return Vw[n]}get unpackVector(){return Vw[this.encoding]}_idx(n,s){if(n<-1||n>=this.dim+1||s<-1||s>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(s+1)*this.stride+(n+1)}_unpackMapbox(n,s,c){return(256*n*256+256*s+c)/10-1e4}_unpackTerrarium(n,s,c){return 256*n+s+c/256-32768}static pack(n,s){const c=[0,0,0,0],p=Og.getUnpackVector(s);let g=Math.floor((n+p[3])/p[2]);return c[2]=g%256,g=Math.floor(g/256),c[1]=g%256,g=Math.floor(g/256),c[0]=g,c}getPixels(){return new Xr({width:this.stride,height:this.stride},this.pixels)}backfillBorder(n,s,c){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let p=s*this.dim,g=s*this.dim+this.dim,_=c*this.dim,x=c*this.dim+this.dim;switch(s){case-1:p=g-1;break;case 1:g=p+1}switch(c){case-1:_=x-1;break;case 1:x=_+1}const C=-s*this.dim,S=-c*this.dim;for(let R=_;R<x;R++)for(let B=p;B<g;B++){const N=4*this._idx(B,R),H=4*this._idx(B+C,R+S);this.pixels[N+0]=n.pixels[H+0],this.pixels[N+1]=n.pixels[H+1],this.pixels[N+2]=n.pixels[H+2],this.pixels[N+3]=n.pixels[H+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}$t(Og,"DEMData"),$t(Nw,"DemMinMaxQuadTree",{omit:["dem"]});class dk{constructor(n,s){this.max=n,this.onRemove=s,this.reset()}reset(){for(const n in this.data)for(const s of this.data[n])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(n,s,c){const p=n.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const g={value:s,timeout:void 0};if(c!==void 0&&(g.timeout=setTimeout(()=>{this.remove(n,g)},c)),this.data[p].push(g),this.order.push(p),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(n){return n.wrapped().key in this.data}getAndRemove(n){return this.has(n)?this._getAndRemoveByKey(n.wrapped().key):null}_getAndRemoveByKey(n){const s=this.data[n].shift();return s.timeout&&clearTimeout(s.timeout),this.data[n].length===0&&delete this.data[n],this.order.splice(this.order.indexOf(n),1),s.value}getByKey(n){const s=this.data[n];return s?s[0].value:null}get(n){return this.has(n)?this.data[n.wrapped().key][0].value:null}remove(n,s){if(!this.has(n))return this;const c=n.wrapped().key,p=s===void 0?0:this.data[c].indexOf(s),g=this.data[c][p];return this.data[c].splice(p,1),g.timeout&&clearTimeout(g.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(g.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(n){for(this.max=n;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(n){const s=[];for(const c in this.data)for(const p of this.data[c])n(p.value)||s.push(p);for(const c of s)this.remove(c.value.tileID,c)}}class nh{constructor(n,s,c){this.func=n,this.mask=s,this.range=c}}nh.ReadOnly=!1,nh.ReadWrite=!0,nh.disabled=new nh(519,nh.ReadOnly,[0,1]);const qv=7680;class Zv{constructor(n,s,c,p,g,_){this.test=n,this.ref=s,this.mask=c,this.fail=p,this.depthFail=g,this.pass=_}}Zv.disabled=new Zv({func:519,mask:0},0,0,qv,qv,qv);class va{constructor(n,s,c){this.blendFunction=n,this.blendColor=s,this.mask=c}}va.Replace=[1,0],va.disabled=new va(va.Replace,Zn.transparent,[!1,!1,!1,!1]),va.unblended=new va(va.Replace,Zn.transparent,[!0,!0,!0,!0]),va.alphaBlended=new va([1,771],Zn.transparent,[!0,!0,!0,!0]);const Xv=1029,Yv=2305;class Wo{constructor(n,s,c){this.enable=n,this.mode=s,this.frontFace=c}}Wo.disabled=new Wo(!1,Xv,Yv),Wo.backCCW=new Wo(!0,Xv,Yv),Wo.backCW=new Wo(!0,Xv,2304),Wo.frontCW=new Wo(!0,1028,2304),Wo.frontCCW=new Wo(!0,1028,Yv);class Kl extends Be{constructor(n,s,c){super(),this.id=n,this._onlySymbols=c,s.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),s.on("error",()=>{this._sourceErrored=!0}),this._source=s,this._tiles={},this._cache=new dk(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=s.minTileCacheSize,this._maxTileCacheSize=s.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new hk,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(n){this.map=n,this._minTileCacheSize=this._minTileCacheSize===void 0&&n?n._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&n?n._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const n in this._tiles){const s=this._tiles[n];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const n=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,n&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(n,s){return n.isSymbolTile=this._onlySymbols,this._source.loadTile(n,s)}_unloadTile(n){if(this._source.unloadTile)return this._source.unloadTile(n,()=>{})}_abortTile(n){if(this._source.abortTile)return this._source.abortTile(n,()=>{})}serialize(){return this._source.serialize()}prepare(n){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const s in this._tiles){const c=this._tiles[s];this._source.prepareTile(c)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,c.tileID),c.upload(n),c.prepare(this.map.style.imageManager)}else for(const s in this._tiles){const c=this._tiles[s];c.upload(n),c.prepare(this.map.style.imageManager)}}getIds(){return pe(this._tiles).map(n=>n.tileID).sort(Gw).map(n=>n.key)}getRenderableIds(n){const s=[];for(const c in this._tiles)this._isIdRenderable(+c,n)&&s.push(this._tiles[c]);return n?s.sort((c,p)=>{const g=c.tileID,_=p.tileID,x=new M(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),C=new M(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-_.overscaledZ||C.y-x.y||C.x-x.x}).map(c=>c.tileID.key):s.map(c=>c.tileID).sort(Gw).map(c=>c.key)}hasRenderableParent(n){const s=this.findLoadedParent(n,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(n,s){return this._tiles[n]&&this._tiles[n].hasData()&&!this._coveredTiles[n]&&(s||!this._tiles[n].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const n in this._tiles)this._tiles[n].state!=="errored"&&this._reloadTile(+n,"reloading")}}_reloadTile(n,s){const c=this._tiles[n];c&&(c.state!=="loading"&&(c.state=s),this._loadTile(c,this._tileLoaded.bind(this,c,n,s)))}_tileLoaded(n,s,c,p){if(p)if(n.state="errored",p.status!==404)this._source.fire(new K(p,{tile:n}));else if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const g=this.map.painter.terrain;this.update(this.transform,g.getScaledDemTileSize(),!0),g.resetTileLookupCache(this.id)}else this.update(this.transform);else n.timeAdded=wt.now(),c==="expired"&&(n.refreshedUponExpiration=!0),this._setTileReloadTimer(s,n),this._source.type==="raster-dem"&&n.dem&&this._backfillDEM(n),this._state.initializeTileState(n,this.map?this.map.painter:null),this._source.fire(new q("data",{dataType:"source",tile:n,coord:n.tileID,sourceCacheId:this.id}))}_backfillDEM(n){const s=this.getRenderableIds();for(let p=0;p<s.length;p++){const g=s[p];if(n.neighboringTiles&&n.neighboringTiles[g]){const _=this.getTileByID(g);c(n,_),c(_,n)}}function c(p,g){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let _=g.tileID.canonical.x-p.tileID.canonical.x;const x=g.tileID.canonical.y-p.tileID.canonical.y,C=Math.pow(2,p.tileID.canonical.z),S=g.tileID.key;_===0&&x===0||Math.abs(x)>1||(Math.abs(_)>1&&(Math.abs(_+C)===1?_+=C:Math.abs(_-C)===1&&(_-=C)),g.dem&&p.dem&&(p.dem.backfillBorder(g.dem,_,x),p.neighboringTiles&&p.neighboringTiles[S]&&(p.neighboringTiles[S].backfilled=!0)))}}getTile(n){return this.getTileByID(n.key)}getTileByID(n){return this._tiles[n]}_retainLoadedChildren(n,s,c,p){for(const g in this._tiles){let _=this._tiles[g];if(p[g]||!_.hasData()||_.tileID.overscaledZ<=s||_.tileID.overscaledZ>c)continue;let x=_.tileID;for(;_&&_.tileID.overscaledZ>s+1;){const S=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[S.key],_&&_.hasData()&&(x=S)}let C=x;for(;C.overscaledZ>s;)if(C=C.scaledTo(C.overscaledZ-1),n[C.key]){p[x.key]=x;break}}}findLoadedParent(n,s){if(n.key in this._loadedParentTiles){const c=this._loadedParentTiles[n.key];return c&&c.tileID.overscaledZ>=s?c:null}for(let c=n.overscaledZ-1;c>=s;c--){const p=n.scaledTo(c),g=this._getLoadedTile(p);if(g)return g}}_getLoadedTile(n){const s=this._tiles[n.key];return s&&s.hasData()?s:this._cache.getByKey(this._source.reparseOverscaled?n.wrapped().key:n.canonical.key)}updateCacheSize(n,s){s=s||this._source.tileSize;const c=Math.ceil(n.width/s)+1,p=Math.ceil(n.height/s)+1,g=Math.floor(c*p*5),_=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,g):g,x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(x)}handleWrapJump(n){const s=Math.round((n-(this._prevLng===void 0?n:this._prevLng))/360);if(this._prevLng=n,s){const c={};for(const p in this._tiles){const g=this._tiles[p];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+s),c[g.tileID.key]=g}this._tiles=c;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(n,s,c){if(this.transform=n,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;let p;this.updateCacheSize(n,s),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=n.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new _r(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(p=n.coveringTiles({tileSize:s||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(p=p.filter(x=>this._source.hasTile(x)))):p=[];const g=this._updateRetainedTiles(p);if(Hw(this._source.type)&&p.length!==0){const x={},C={},S=Object.keys(g);for(const B of S){const N=g[B],H=this._tiles[B];if(!H||H.fadeEndTime&&H.fadeEndTime<=wt.now())continue;const Z=this.findLoadedParent(N,Math.max(N.overscaledZ-Kl.maxOverzooming,this._source.minzoom));Z&&(this._addTile(Z.tileID),x[Z.tileID.key]=Z.tileID),C[B]=N}const R=p[p.length-1].overscaledZ;for(const B in this._tiles){const N=this._tiles[B];if(g[B]||!N.hasData())continue;let H=N.tileID;for(;H.overscaledZ>R;){H=H.scaledTo(H.overscaledZ-1);const Z=this._tiles[H.key];if(Z&&Z.hasData()&&C[H.key]){g[B]=N.tileID;break}}}for(const B in x)g[B]||(this._coveredTiles[B]=!0,g[B]=x[B])}for(const x in g)this._tiles[x].clearFadeHold();const _=function(x,C){const S=[];for(const R in x)R in C||S.push(R);return S}(this._tiles,g);for(const x of _){const C=this._tiles[x];C.hasSymbolBuckets&&!C.holdingForFade()?C.setHoldDuration(this.map._fadeDuration):C.hasSymbolBuckets&&!C.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const n in this._tiles)this._tiles[n].holdingForFade()&&this._removeTile(+n)}_updateRetainedTiles(n){const s={};if(n.length===0)return s;const c={},p=n.reduce((S,R)=>Math.min(S,R.overscaledZ),1/0),g=n[0].overscaledZ,_=Math.max(g-Kl.maxOverzooming,this._source.minzoom),x=Math.max(g+Kl.maxUnderzooming,this._source.minzoom),C={};for(const S of n){const R=this._addTile(S);s[S.key]=S,R.hasData()||p<this._source.maxzoom&&(C[S.key]=S)}this._retainLoadedChildren(C,p,x,s);for(const S of n){let R=this._tiles[S.key];if(R.hasData())continue;if(S.canonical.z>=this._source.maxzoom){const N=S.children(this._source.maxzoom)[0],H=this.getTile(N);if(H&&H.hasData()){s[N.key]=N;continue}}else{const N=S.children(this._source.maxzoom);if(s[N[0].key]&&s[N[1].key]&&s[N[2].key]&&s[N[3].key])continue}let B=R.wasRequested();for(let N=S.overscaledZ-1;N>=_;--N){const H=S.scaledTo(N);if(c[H.key]||(c[H.key]=!0,R=this.getTile(H),!R&&B&&(R=this._addTile(H)),R&&(s[H.key]=H,B=R.wasRequested(),R.hasData())))break}}return s}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const n in this._tiles){const s=[];let c,p=this._tiles[n].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){c=this._loadedParentTiles[p.key];break}s.push(p.key);const g=p.scaledTo(p.overscaledZ-1);if(c=this._getLoadedTile(g),c)break;p=g}for(const g of s)this._loadedParentTiles[g]=c}}_addTile(n){let s=this._tiles[n.key];if(s)return this._source.prepareTile&&this._source.prepareTile(s),s;s=this._cache.getAndRemove(n),s&&(this._setTileReloadTimer(n.key,s),s.tileID=n,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[n.key]&&(clearTimeout(this._cacheTimers[n.key]),delete this._cacheTimers[n.key],this._setTileReloadTimer(n.key,s)));const c=!!s;if(!c){const p=this.map?this.map.painter:null;s=new $v(n,this._source.tileSize*n.overscaleFactor(),this.transform.tileZoom,p,this._isRaster),this._source.prepareTile&&this._source.prepareTile(s)||this._loadTile(s,this._tileLoaded.bind(this,s,n.key,s.state))}return s?(s.uses++,this._tiles[n.key]=s,c||this._source.fire(new q("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s):null}_setTileReloadTimer(n,s){n in this._timers&&(clearTimeout(this._timers[n]),delete this._timers[n]);const c=s.getExpiryTimeout();c&&(this._timers[n]=setTimeout(()=>{this._reloadTile(n,"expired"),delete this._timers[n]},c))}_removeTile(n){const s=this._tiles[n];s&&(s.uses--,delete this._tiles[n],this._timers[n]&&(clearTimeout(this._timers[n]),delete this._timers[n]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const n in this._tiles)this._removeTile(+n);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(n,s,c){const p=[],g=this.transform;if(!g)return p;for(const _ in this._tiles){const x=this._tiles[_];if(c&&x.clearQueryDebugViz(),x.holdingForFade())continue;const C=n.containsTile(x,g,s);C&&p.push(C)}return p}getVisibleCoordinates(n){const s=this.getRenderableIds(n).map(c=>this._tiles[c].tileID);for(const c of s)c.projMatrix=this.transform.calculateProjMatrix(c.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(Hw(this._source.type))for(const n in this._tiles){const s=this._tiles[n];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=wt.now())return!0}return!1}setFeatureState(n,s,c){this._state.updateState(n=n||"_geojsonTileLayer",s,c)}removeFeatureState(n,s,c){this._state.removeFeatureState(n=n||"_geojsonTileLayer",s,c)}getFeatureState(n,s){return this._state.getState(n=n||"_geojsonTileLayer",s)}setDependencies(n,s,c){const p=this._tiles[n];p&&p.setDependencies(s,c)}reloadTilesForDependencies(n,s){for(const c in this._tiles)this._tiles[c].hasDependency(n,s)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(n,s))}_preloadTiles(n,s){const c=new Map,p=Array.isArray(n)?n:[n],g=this.map.painter.terrain,_=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(const x of p){const C=x.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const S of C)c.set(S.key,S);this.usedForTerrain&&x.updateElevation(!1)}se(Array.from(c.values()),(x,C)=>{const S=new $v(x,this._source.tileSize*x.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(S,R=>{this._source.type==="raster-dem"&&S.dem&&this._backfillDEM(S),C(R,S)})},s)}}function Gw(a,n){const s=Math.abs(2*a.wrap)-+(a.wrap<0),c=Math.abs(2*n.wrap)-+(n.wrap<0);return a.overscaledZ-n.overscaledZ||c-s||n.canonical.y-a.canonical.y||n.canonical.x-a.canonical.x}function Hw(a){return a==="raster"||a==="image"||a==="video"}Kl.maxOverzooming=10,Kl.maxUnderzooming=3;class Ng{constructor(n,s,c){this._demTile=n,this._dem=this._demTile.dem,this._scale=s,this._offset=c}static create(n,s,c){const p=c||n.findDEMTileFor(s);if(!p||!p.dem)return;const g=p.dem,_=p.tileID,x=1<<s.canonical.z-_.canonical.z;return new Ng(p,p.tileSize/In/x,[(s.canonical.x/x-_.canonical.x)*g.dim,(s.canonical.y/x-_.canonical.y)*g.dim])}tileCoordToPixel(n,s){const c=s*this._scale+this._offset[1],p=Math.floor(n*this._scale+this._offset[0]),g=Math.floor(c);return new M(p,g)}getElevationAt(n,s,c,p){const g=n*this._scale+this._offset[0],_=s*this._scale+this._offset[1],x=Math.floor(g),C=Math.floor(_),S=this._dem;return p=!!p,c?yn(yn(S.get(x,C,p),S.get(x,C+1,p),_-C),yn(S.get(x+1,C,p),S.get(x+1,C+1,p),_-C),g-x):S.get(x,C,p)}getElevationAtPixel(n,s,c){return this._dem.get(n,s,!!c)}getMeterToDEM(n){return(1<<this._demTile.tileID.canonical.z)*Gu(1,n)*this._dem.stride}}class Ww{constructor(n,s){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new ha(In,16,0),this.featureIndexArray=new xi,this.promoteId=s}insert(n,s,c,p,g,_=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,p,g,_);const C=this.grid;for(let S=0;S<s.length;S++){const R=s[S],B=[1/0,1/0,-1/0,-1/0];for(let N=0;N<R.length;N++){const H=R[N];B[0]=Math.min(B[0],H.x),B[1]=Math.min(B[1],H.y),B[2]=Math.max(B[2],H.x),B[3]=Math.max(B[3],H.y)}B[0]<In&&B[1]<In&&B[2]>=0&&B[3]>=0&&C.insert(x,B[0],B[1],B[2],B[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Yl.VectorTile(new Cp(this.rawTileData)).layers,this.sourceLayerCoder=new Dw(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const n in this.vtLayers)this.vtFeatures[n]=[]}return this.vtLayers}query(n,s,c,p){this.loadVTLayers();const g=n.params||{},_=la(g.filter),x=n.tileResult,C=n.transform,S=x.bufferedTilespaceBounds,R=this.grid.query(S.min.x,S.min.y,S.max.x,S.max.y,(Z,Q,le,ve)=>hb(x.bufferedTilespaceGeometry,Z,Q,le,ve));R.sort(pk);let B=null;C.elevation&&R.length>0&&(B=Ng.create(C.elevation,this.tileID));const N={};let H;for(let Z=0;Z<R.length;Z++){const Q=R[Z];if(Q===H)continue;H=Q;const le=this.featureIndexArray.get(Q);let ve=null;this.loadMatchingFeature(N,le,_,g.layers,g.availableImages,s,c,p,(Fe,je,Xe,Ye=0)=>(ve||(ve=Za(Fe,this.tileID.canonical,n.tileTransform)),je.queryIntersectsFeature(x,Fe,Xe,ve,this.z,n.transform,n.pixelPosMatrix,B,Ye)))}return N}loadMatchingFeature(n,s,c,p,g,_,x,C,S){const{featureIndex:R,bucketIndex:B,sourceLayerIndex:N,layoutVertexArrayOffset:H}=s,Z=this.bucketLayerIDs[B];if(p&&!function(Fe,je){for(let Xe=0;Xe<Fe.length;Xe++)if(je.indexOf(Fe[Xe])>=0)return!0;return!1}(p,Z))return;const Q=this.sourceLayerCoder.decode(N),le=this.vtLayers[Q].feature(R);if(c.needGeometry){const Fe=ql(le,!0);if(!c.filter(new ci(this.tileID.overscaledZ),Fe,this.tileID.canonical))return}else if(!c.filter(new ci(this.tileID.overscaledZ),le))return;const ve=this.getId(le,Q);for(let Fe=0;Fe<Z.length;Fe++){const je=Z[Fe];if(p&&p.indexOf(je)<0)continue;const Xe=_[je];if(!Xe)continue;let Ye={};ve!==void 0&&C&&(Ye=C.getState(Xe.sourceLayer||"_geojsonTileLayer",ve));const Je=me({},x[je]);Je.paint=jw(Je.paint,Xe.paint,le,Ye,g),Je.layout=jw(Je.layout,Xe.layout,le,Ye,g);const ut=!S||S(le,Xe,Ye,H);if(!ut)continue;const dt=new Pw(le,this.z,this.x,this.y,ve);dt.layer=Je;let xt=n[je];xt===void 0&&(xt=n[je]=[]),xt.push({featureIndex:R,feature:dt,intersectionZ:ut})}}lookupSymbolFeatures(n,s,c,p,g,_,x,C){const S={};this.loadVTLayers();const R=la(g);for(const B of n)this.loadMatchingFeature(S,{bucketIndex:c,sourceLayerIndex:p,featureIndex:B,layoutVertexArrayOffset:0},R,_,x,C,s);return S}loadFeature(n){const{featureIndex:s,sourceLayerIndex:c}=n;this.loadVTLayers();const p=this.sourceLayerCoder.decode(c),g=this.vtFeatures[p];if(g[s])return g[s];const _=this.vtLayers[p].feature(s);return g[s]=_,_}hasLayer(n){for(const s of this.bucketLayerIDs)for(const c of s)if(n===c)return!0;return!1}getId(n,s){let c=n.id;return this.promoteId&&(c=n.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[s]],typeof c=="boolean"&&(c=Number(c))),c}}function jw(a,n,s,c,p){return St(a,(g,_)=>{const x=n instanceof T?n.get(_):null;return x&&x.evaluate?x.evaluate(s,c,p):x})}function pk(a,n){return n-a}$t(Ww,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class $w{constructor(n){const s={},c=[];for(const x in n){const C=n[x],S=s[x]={};for(const R in C.glyphs){const B=C.glyphs[+R];if(!B||B.bitmap.width===0||B.bitmap.height===0)continue;const N=B.metrics.localGlyph?2:1,H={x:0,y:0,w:B.bitmap.width+2*N,h:B.bitmap.height+2*N};c.push(H),S[R]=H}}const{w:p,h:g}=Sv(c),_=new Xa({width:p||1,height:g||1});for(const x in n){const C=n[x];for(const S in C.glyphs){const R=C.glyphs[+S];if(!R||R.bitmap.width===0||R.bitmap.height===0)continue;const B=s[x][S],N=R.metrics.localGlyph?2:1;Xa.copy(R.bitmap,_,{x:0,y:0},{x:B.x+N,y:B.y+N},R.bitmap)}}this.image=_,this.positions=s}}$t($w,"GlyphAtlas");class fk{constructor(n){this.tileID=new _r(n.tileID.overscaledZ,n.tileID.wrap,n.tileID.canonical.z,n.tileID.canonical.x,n.tileID.canonical.y),this.tileZoom=n.tileZoom,this.uid=n.uid,this.zoom=n.zoom,this.canonical=n.tileID.canonical,this.pixelRatio=n.pixelRatio,this.tileSize=n.tileSize,this.source=n.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=n.showCollisionBoxes,this.collectResourceTiming=!!n.collectResourceTiming,this.returnDependencies=!!n.returnDependencies,this.promoteId=n.promoteId,this.enableTerrain=!!n.enableTerrain,this.isSymbolTile=n.isSymbolTile,this.tileTransform=Jl(n.tileID.canonical,n.projection),this.projection=n.projection}parse(n,s,c,p,g){this.status="parsing",this.data=n,this.collisionBoxArray=new Uo;const _=new Dw(Object.keys(n.layers).sort()),x=new Ww(this.tileID,this.promoteId);x.bucketLayerIDs=[];const C={},S=new Gv(256,256),R={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:S,availableImages:c},B=s.familiesBySource[this.source];for(const Ye in B){const Je=n.layers[Ye];if(!Je)continue;let ut=!1,dt=!1;for(const ot of B[Ye])ot[0].type==="symbol"?ut=!0:dt=!0;if(this.isSymbolTile===!0&&!ut||this.isSymbolTile===!1&&!dt)continue;Je.version===1&&xe(`Vector tile source "${this.source}" layer "${Ye}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const xt=_.encode(Ye),Et=[];for(let ot=0;ot<Je.length;ot++){const mt=Je.feature(ot),Dt=x.getId(mt,Ye);Et.push({feature:mt,id:Dt,index:ot,sourceLayerIndex:xt})}for(const ot of B[Ye]){const mt=ot[0];this.isSymbolTile!==void 0&&mt.type==="symbol"!==this.isSymbolTile||mt.minzoom&&this.zoom<Math.floor(mt.minzoom)||mt.maxzoom&&this.zoom>=mt.maxzoom||mt.visibility!=="none"&&(Jv(ot,this.zoom,c),(C[mt.id]=mt.createBucket({index:x.bucketLayerIDs.length,layers:ot,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:xt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.name,availableImages:c})).populate(Et,R,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(ot.map(Dt=>Dt.id)))}}let N,H,Z,Q;S.trim();const le={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ve=St(R.glyphDependencies,Ye=>Object.keys(Ye).map(Number));Object.keys(ve).length?p.send("getGlyphs",{uid:this.uid,stacks:ve},(Ye,Je)=>{N||(N=Ye,H=Je,Xe.call(this))},void 0,!1,le):H={};const Fe=Object.keys(R.iconDependencies);Fe.length?p.send("getImages",{icons:Fe,source:this.source,tileID:this.tileID,type:"icons"},(Ye,Je)=>{N||(N=Ye,Z=Je,Xe.call(this))},void 0,!1,le):Z={};const je=Object.keys(R.patternDependencies);function Xe(){if(N)return g(N);if(H&&Z&&Q){const Ye=new $w(H),Je=new Jb(Z,Q);for(const ut in C){const dt=C[ut];dt instanceof Gs?(Jv(dt.layers,this.zoom,c),Gz(dt,H,Ye.positions,Z,Je.iconPositions,this.showCollisionBoxes,c,this.tileID.canonical,this.tileZoom,this.projection)):dt.hasPattern&&(dt instanceof Cg||dt instanceof Tg||dt instanceof Mp)&&(Jv(dt.layers,this.zoom,c),dt.addFeatures(R,this.tileID.canonical,Je.patternPositions,c,this.tileTransform))}this.status="done",g(null,{buckets:pe(C).filter(ut=>!ut.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ye.image,lineAtlas:S,imageAtlas:Je,glyphMap:this.returnDependencies?H:null,iconMap:this.returnDependencies?Z:null,glyphPositions:this.returnDependencies?Ye.positions:null})}}je.length?p.send("getImages",{icons:je,source:this.source,tileID:this.tileID,type:"patterns"},(Ye,Je)=>{N||(N=Ye,Q=Je,Xe.call(this))},void 0,!1,le):Q={},Xe.call(this)}}function Jv(a,n,s){const c=new ci(n);for(const p of a)p.recalculate(c,s)}class qw{constructor(n){this.entries={},this.scheduler=n}request(n,s,c,p){const g=this.entries[n]=this.entries[n]||{callbacks:[]};if(g.result){const[_,x]=g.result;return this.scheduler?this.scheduler.add(()=>{p(_,x)},s):p(_,x),()=>{}}return g.callbacks.push(p),g.cancel||(g.cancel=c((_,x)=>{g.result=[_,x];for(const C of g.callbacks)this.scheduler?this.scheduler.add(()=>{C(_,x)},s):C(_,x);setTimeout(()=>delete this.entries[n],3e3)})),()=>{g.result||(g.callbacks=g.callbacks.filter(_=>_!==p),g.callbacks.length||(g.cancel(),delete this.entries[n]))}}}function Zw(a,n,s){const c=JSON.stringify(a.request);return a.data&&(this.deduped.entries[c]={result:[null,a.data]}),this.deduped.request(c,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},p=>{const g=Re(a.request,(_,x,C,S)=>{_?p(_):x&&p(null,{vectorTile:s?void 0:new Yl.VectorTile(new Cp(x)),rawData:x,cacheControl:C,expires:S})});return()=>{g.cancel(),p()}},n)}const mk=ma(new Float32Array(16));class $s{constructor(n){this.name=n.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(n,s){return{x:0,y:0,z:0}}unproject(n,s){return new ti(0,0)}projectTilePoint(n,s,c){return{x:n,y:s,z:0}}locationPoint(n,s){return n._coordinatePoint(n.locationCoordinate(s),!1)}pixelsPerMeter(n,s){return Gu(1,n)*s}farthestPixelDistance(n){return function(s,c){const p=s.fovAboveCenter,g=s.elevation?s.elevation.getMinElevationBelowMSL()*c:0,_=(s._camera.position[2]*s.worldSize-g)/Math.cos(s._pitch),x=Math.sin(p)*_/Math.sin(Math.max(Math.PI/2-s._pitch-p,.01)),C=Math.sin(s._pitch)*x+_;return Math.min(1.01*C,_*(1/s._horizonShift))}(n,n.pixelsPerMeter)}pointCoordinate(n,s,c,p){const g=n.horizonLineFromTop(!1),_=new M(s,Math.max(g,c));return n.rayIntersectionCoordinate(n.pointRayIntersection(_,p))}createInversionMatrix(n,s){return mk}createTileMatrix(n,s,c){let p,g,_;const x=c.canonical,C=ma(new Float64Array(16));if(this.isReprojectedInTileSpace){const S=Jl(x,this);p=1,g=S.x+c.wrap*S.scale,_=S.y,Ns(C,C,[p/S.scale,p/S.scale,n.pixelsPerMeter/s])}else p=s/n.zoomScale(x.z),g=(x.x+Math.pow(2,x.z)*c.wrap)*p,_=x.y*p;return Zl(C,C,[g,_,0]),Ns(C,C,[p/In,p/In,1]),C}upVector(n,s,c){return[0,0,1]}upVectorScale(n,s,c){return{metersToTile:1,metersToLabelSpace:1}}}class gk extends $s{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(n,s){return{x:hp(n),y:Vu(s),z:0}}unproject(n,s){const c=To(n),p=rr(s);return new ti(c,p)}}class yk extends $s{constructor(n){super(n),this.range=[4,7],this.center=n.center||[-96,37.5];const[s,c]=this.parallels=n.parallels||[29.5,45.5],p=Math.sin(F(s));this.n=(p+Math.sin(F(c)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(n,s){const{n:c,c:p,r0:g}=this,_=F(n-this.center[0]),x=F(s),C=Math.sqrt(p-2*c*Math.sin(x))/c;return{x:C*Math.sin(_*c),y:C*Math.cos(_*c)-g,z:0}}unproject(n,s){const{n:c,c:p,r0:g}=this,_=g+s;let x=Math.atan2(n,Math.abs(_))*Math.sign(_);_*c<0&&(x-=Math.PI*Math.sign(n)*Math.sign(_));const C=F(this.center[0])*c;x=ie(x,-Math.PI-C,Math.PI-C);const S=G(x/c)+this.center[0],R=Math.asin(te((p-(n*n+_*_)*c*c)/(2*c),-1,1)),B=te(G(R),-85.051129,fa);return new ti(S,B)}}const Rp=1.340264,zp=-.081106,kp=893e-6,Bp=.003796,Ug=Math.sqrt(3)/2;class _k extends $s{project(n,s){s=s/180*Math.PI,n=n/180*Math.PI;const c=Math.asin(Ug*Math.sin(s)),p=c*c,g=p*p*p;return{x:.5*(n*Math.cos(c)/(Ug*(Rp+3*zp*p+g*(7*kp+9*Bp*p)))/Math.PI+.5),y:1-.5*(c*(Rp+zp*p+g*(kp+Bp*p))/Math.PI+1),z:0}}unproject(n,s){n=(2*n-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,p=c*c,g=p*p*p;for(let R,B,N,H=0;H<12&&(B=c*(Rp+zp*p+g*(kp+Bp*p))-s,N=Rp+3*zp*p+g*(7*kp+9*Bp*p),R=B/N,c=te(c-R,-Math.PI/3,Math.PI/3),p=c*c,g=p*p*p,!(Math.abs(R)<1e-12));++H);const _=Ug*n*(Rp+3*zp*p+g*(7*kp+9*Bp*p))/Math.cos(c),x=Math.asin(Math.sin(c)/Ug),C=te(180*_/Math.PI,-180,180),S=te(180*x/Math.PI,-85.051129,fa);return new ti(C,S)}}class vk extends $s{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0}project(n,s){return{x:.5+n/360,y:.5-s/360,z:0}}unproject(n,s){const c=360*(n-.5),p=te(360*(.5-s),-85.051129,fa);return new ti(c,p)}}const ih=Math.PI/2;function Vg(a){return Math.tan((ih+a)/2)}class xk extends $s{constructor(n){super(n),this.center=n.center||[0,30];const[s,c]=this.parallels=n.parallels||[30,30],p=F(s),g=F(c),_=Math.cos(p);this.n=p===g?Math.sin(p):Math.log(_/Math.cos(g))/Math.log(Vg(g)/Vg(p)),this.f=_*Math.pow(Vg(p),this.n)/this.n}project(n,s){s=F(s),n=F(n-this.center[0]);const c=1e-6,{n:p,f:g}=this;g>0?s<-ih+c&&(s=-ih+c):s>ih-c&&(s=ih-c);const _=g/Math.pow(Vg(s),p),x=_*Math.sin(p*n),C=g-_*Math.cos(p*n);return{x:.5*(x/Math.PI+.5),y:1-.5*(C/Math.PI+.5),z:0}}unproject(n,s){n=(2*n-.5)*Math.PI,s=(2*(1-s)-.5)*Math.PI;const{n:c,f:p}=this,g=p-s,_=Math.sign(g),x=Math.sign(c)*Math.sqrt(n*n+g*g);let C=Math.atan2(n,Math.abs(g))*_;g*c<0&&(C-=Math.PI*Math.sign(n)*_);const S=te(G(C/c)+this.center[0],-180,180),R=te(G(2*Math.atan(Math.pow(p/x,1/c))-ih),-85.051129,fa);return new ti(S,R)}}const Xw=F(fa);class bk extends $s{project(n,s){const c=(s=F(s))*s,p=c*c;return{x:.5*((n=F(n))*(.8707-.131979*c+p*(p*(.003971*c-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(s*(1.007226+c*(.015085+p*(.028874*c-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(n,s){n=(2*n-.5)*Math.PI;let c=s=(2*(1-s)-1)*Math.PI,p=25,g=0,_=c*c;do{_=c*c;const S=_*_;g=(c*(1.007226+_*(.015085+S*(.028874*_-.044475-.005916*S)))-s)/(1.007226+_*(.045255+S*(.259866*_-.311325-.06507600000000001*S))),c=te(c-g,-Xw,Xw)}while(Math.abs(g)>1e-6&&--p>0);_=c*c;const x=te(G(n/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),C=G(c);return new ti(x,C)}}const Yw=F(fa);class wk extends $s{project(n,s){s=F(s),n=F(n);const c=Math.cos(s),p=2/Math.PI,g=Math.acos(c*Math.cos(n/2)),_=Math.sin(g)/g,x=.5*(n*p+2*c*Math.sin(n/2)/_)||0,C=.5*(s+Math.sin(s)/_)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(C/Math.PI+1),z:0}}unproject(n,s){let c=n=(2*n-.5)*Math.PI,p=s=(2*(1-s)-1)*Math.PI,g=25;const _=1e-6;let x=0,C=0;do{const S=Math.cos(p),R=Math.sin(p),B=2*R*S,N=R*R,H=S*S,Z=Math.cos(c/2),Q=Math.sin(c/2),le=2*Z*Q,ve=Q*Q,Fe=1-H*Z*Z,je=Fe?1/Fe:0,Xe=Fe?Math.acos(S*Z)*Math.sqrt(1/Fe):0,Ye=.5*(2*Xe*S*Q+2*c/Math.PI)-n,Je=.5*(Xe*R+p)-s,ut=.5*je*(H*ve+Xe*S*Z*N)+1/Math.PI,dt=je*(le*B/4-Xe*R*Q),xt=.125*je*(B*Q-Xe*R*H*le),Et=.5*je*(N*Z+Xe*ve*S)+.5,ot=dt*xt-Et*ut;x=(Je*dt-Ye*Et)/ot,C=(Ye*xt-Je*ut)/ot,c=te(c-x,-Math.PI,Math.PI),p=te(p-C,-Yw,Yw)}while((Math.abs(x)>_||Math.abs(C)>_)&&--g>0);return new ti(G(c),G(p))}}class Jw extends $s{constructor(n){super(n),this.center=n.center||[0,0],this.parallels=n.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(F(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(n,s){const{scale:c,cosPhi:p}=this;return{x:F(n)*p*c+.5,y:-Math.sin(F(s))/p*c+.5,z:0}}unproject(n,s){const{scale:c,cosPhi:p}=this,g=-(s-.5)/c,_=te(G((n-.5)/c)/p,-180,180),x=Math.asin(te(g*p,-1,1)),C=te(G(x),-85.051129,fa);return new ti(_,C)}}r.ARRAY_TYPE=Zr,r.AUTH_ERR_MSG=wn,r.Aabb=go,r.Actor=class{constructor(a,n,s){this.target=a,this.parent=n,this.mapId=s,this.callbacks={},this.cancelCallbacks={},At(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=ze()?a:L,this.scheduler=new nk}send(a,n,s,c,p=!1,g){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=g,this.callbacks[_]=s);const x=Ke(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:a,hasCallback:!!s,targetMapId:c,mustQueue:p,sourceMapId:this.mapId,data:Ol(n,x)},x),{cancel:()=>{s&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:c,sourceMapId:this.mapId})}}}receive(a){const n=a.data,s=n.id;if(s&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){const c=this.cancelCallbacks[s];delete this.cancelCallbacks[s],c&&c.cancel()}else if(n.mustQueue||ze()){const c=this.callbacks[s];this.cancelCallbacks[s]=this.scheduler.add(()=>this.processTask(s,n),c&&c.metadata||{type:"message"})}else this.processTask(s,n)}processTask(a,n){if(n.type==="<response>"){const s=this.callbacks[a];delete this.callbacks[a],s&&(n.error?s(Ls(n.error)):s(null,Ls(n.data)))}else{const s=Ke(this.globalScope)?void 0:[],c=n.hasCallback?(g,_)=>{delete this.cancelCallbacks[a],this.target.postMessage({id:a,type:"<response>",sourceMapId:this.mapId,error:g?Ol(g):null,data:Ol(_,s)},s)}:g=>{},p=Ls(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,p,c);else if(this.parent.getWorkerSource){const g=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,g[0],p.source)[g[1]](p,c)}else c(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},r.CanonicalTileID=Bg,r.Color=Zn,r.ColorMode=va,r.CullFaceMode=Wo,r.DEMData=Og,r.DataConstantProperty=A,r.DedupedRequest=qw,r.DepthMode=nh,r.EXTENT=In,r.Elevation=class{isDataAvailableAtPoint(a){const n=this._source();if(!n||a.y<0||a.y>1)return!1;const s=n.getSource().maxzoom,c=1<<s,p=Math.floor(a.x),g=Math.floor((a.x-p)*c),_=Math.floor(a.y*c),x=this.findDEMTileFor(new _r(s,p,s,g,_));return!(!x||!x.dem)}getAtPointOrZero(a,n=0){return this.getAtPoint(a,n)||0}getAtPoint(a,n,s=!0){n==null&&(n=null);const c=this._source();if(!c||a.y<0||a.y>1)return n;const p=c.getSource().maxzoom,g=1<<p,_=Math.floor(a.x),x=a.x-_,C=new _r(p,_,p,Math.floor(x*g),Math.floor(a.y*g)),S=this.findDEMTileFor(C);if(!S||!S.dem)return n;const R=S.dem,B=1<<S.tileID.canonical.z,N=(x*B-S.tileID.canonical.x)*R.dim,H=(a.y*B-S.tileID.canonical.y)*R.dim,Z=Math.floor(N),Q=Math.floor(H);return(s?this.exaggeration():1)*yn(yn(R.get(Z,Q),R.get(Z,Q+1),H-Q),yn(R.get(Z+1,Q),R.get(Z+1,Q+1),H-Q),N-Z)}getAtTileOffset(a,n,s){const c=1<<a.canonical.z;return this.getAtPointOrZero(new mg(a.wrap+(a.canonical.x+n/In)/c,(a.canonical.y+s/In)/c))}getAtTileOffsetFunc(a,n,s,c){return p=>{const g=this.getAtTileOffset(a,p.x,p.y),_=c.upVector(a.canonical,p.x,p.y);return pp(_,_,g*c.upVectorScale(a.canonical,n,s).metersToTile),_}}getForTilePoints(a,n,s,c){const p=Ng.create(this,a,c);return!!p&&(n.forEach(g=>{g[2]=this.exaggeration()*p.getElevationAt(g[0],g[1],s)}),!0)}getMinMaxForTile(a){const n=this.findDEMTileFor(a);if(!n||!n.dem)return null;const s=n.dem.tree,c=n.tileID,p=1<<a.canonical.z-c.canonical.z;let g=a.canonical.x/p-c.canonical.x,_=a.canonical.y/p-c.canonical.y,x=0;for(let C=0;C<a.canonical.z-c.canonical.z&&!s.leaves[x];C++){g*=2,_*=2;const S=2*Math.floor(_)+Math.floor(g);x=s.childOffsets[x]+S,g%=1,_%=1}return{min:this.exaggeration()*s.minimums[x],max:this.exaggeration()*s.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,n,s){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},r.ErrorEvent=K,r.EvaluationParameters=ci,r.Event=q,r.Evented=Be,r.FillExtrusionBucket=Mp,r.Frustum=yv,r.GLOBE_RADIUS=th,r.GlobeSharedBuffers=class{constructor(a){this._createGrid(a),this._createPoles(a),this._createAtmosphere(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();this._gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this._wireframeIndexBuffer&&(this._wireframeIndexBuffer.destroy(),this._wireframeSegments.destroy())}_createGrid(a){const n=new Ae,s=new qt,c=65;for(let p=0;p<c;p++)for(let g=0;g<c;g++)n.emplaceBack(g,p);for(let p=0;p<64;p++)for(let g=0;g<64;g++){const _=p*c+g;s.emplaceBack(_+1,_,_+c),s.emplaceBack(_+c,_+c+1,_+1)}this._gridBuffer=a.createVertexBuffer(n,Pp.members),this._gridIndexBuffer=a.createIndexBuffer(s,!0),this._gridSegments=Ei.simpleSegment(0,0,4225,8192)}_createPoles(a){const n=new qt;for(let p=0;p<=64;p++)n.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=a.createIndexBuffer(n,!0);const s=new xn,c=new xn;this._poleSegments=[];for(let p=0,g=0;p<5;p++){const _=1<<p,x=512*_/Math.PI/2,C=360/_;s.emplaceBack(0,-x,0,0,0,.5,0),c.emplaceBack(0,-x,0,0,0,.5,1);for(let S=0;S<=64;S++){const R=S/64,B=yn(0,C,R),[N,H,Z]=bw(lk,ck,B,x);s.emplaceBack(N,H,Z,0,0,R,0),c.emplaceBack(N,H,Z,0,0,R,1)}this._poleSegments.push(Ei.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(s,vw,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(c,vw,!1)}_createAtmosphere(a){const n=new kn;n.emplaceBack(-1,1,1,0,0),n.emplaceBack(1,1,1,1,0),n.emplaceBack(1,-1,1,1,1),n.emplaceBack(-1,-1,1,0,1);const s=new qt;s.emplaceBack(0,1,2),s.emplaceBack(2,3,0),this.atmosphereVertexBuffer=a.createVertexBuffer(n,rk.members),this.atmosphereIndexBuffer=a.createIndexBuffer(s),this.atmosphereSegments=Ei.simpleSegment(0,0,4,2)}getGridBuffers(){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments]}getPoleBuffers(a){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}getWirefameBuffers(a){if(!this._wireframeSegments){const n=new Mn,s=64,c=s+1;for(let p=0;p<s;p++)for(let g=0;g<s;g++){const _=p*c+g;n.emplaceBack(_,_+1),n.emplaceBack(_,_+c),n.emplaceBack(_,_+c+1)}this._wireframeIndexBuffer=a.createIndexBuffer(n),this._wireframeSegments=Ei.simpleSegment(0,0,s*s,n.length)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments]}},r.GlyphManager=Qu,r.ImagePosition=Dv,r.LineAtlas=Gv,r.LngLat=ti,r.LngLatBounds=Os,r.LocalGlyphMode=Rv,r.MAX_MERCATOR_LATITUDE=fa,r.MercatorCoordinate=mg,r.ONE_EM=or,r.OverscaledTileID=_r,r.Properties=j,r.RGBAImage=Xr,r.Ray=class{constructor(a,n){this.pos=a,this.dir=n}intersectsPlane(a,n,s){const c=mp(n,this.dir);if(Math.abs(c)<1e-6)return!1;const p=((a[0]-this.pos[0])*n[0]+(a[1]-this.pos[1])*n[1]+(a[2]-this.pos[2])*n[2])/c;return s[0]=this.pos[0]+this.dir[0]*p,s[1]=this.pos[1]+this.dir[1]*p,s[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(a,n,s){if(function(N,H){var Z=N[0],Q=N[1],le=N[2],ve=H[0],Fe=H[1],je=H[2];return Math.abs(Z-ve)<=cv*Math.max(1,Math.abs(Z),Math.abs(ve))&&Math.abs(Q-Fe)<=cv*Math.max(1,Math.abs(Q),Math.abs(Fe))&&Math.abs(le-je)<=cv*Math.max(1,Math.abs(le),Math.abs(je))}(this.pos,a)||n===0)return s[0]=s[1]=s[2]=0,!1;const[c,p,g]=this.dir,_=this.pos[0]-a[0],x=this.pos[1]-a[1],C=this.pos[2]-a[2],S=c*c+p*p+g*g,R=2*(_*c+x*p+C*g),B=R*R-4*S*(_*_+x*x+C*C-n*n);if(B<0){const N=Math.max(-R/2,0),H=_+c*N,Z=x+p*N,Q=C+g*N,le=Math.hypot(H,Z,Q);return s[0]=H*n/le,s[1]=Z*n/le,s[2]=Q*n/le,!1}{const N=(-R-Math.sqrt(B))/(2*S);if(N<0){const H=Math.hypot(_,x,C);return s[0]=_*n/H,s[1]=x*n/H,s[2]=C*n/H,!1}return s[0]=_+c*N,s[1]=x+p*N,s[2]=C+g*N,!0}}},r.RequestManager=class{constructor(a,n,s){this._transformRequestFn=a,this._customAccessToken=n,this._silenceAuthErrors=!!s,this._createSkuToken()}_createSkuToken(){const a=function(){let n="";for(let s=0;s<10;s++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",pn,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=a.token,this._skuTokenExpiresAt=a.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(a,n){return this._transformRequestFn&&this._transformRequestFn(a,n)||{url:a}}normalizeStyleURL(a,n){if(!cn(a))return a;const s=Zt(a);return s.path=`/styles/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||n)}normalizeGlyphsURL(a,n){if(!cn(a))return a;const s=Zt(a);return s.path=`/fonts/v1${s.path}`,this._makeAPIURL(s,this._customAccessToken||n)}normalizeSourceURL(a,n){if(!cn(a))return a;const s=Zt(a);return s.path=`/v4/${s.authority}.json`,s.params.push("secure"),this._makeAPIURL(s,this._customAccessToken||n)}normalizeSpriteURL(a,n,s,c){const p=Zt(a);return cn(a)?(p.path=`/styles/v1${p.path}/sprite${n}${s}`,this._makeAPIURL(p,this._customAccessToken||c)):(p.path+=`${n}${s}`,Ze(p))}normalizeTileURL(a,n,s){if(this._isSkuTokenExpired()&&this._createSkuToken(),a&&!cn(a))return a;const c=Zt(a);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||s&&c.authority!=="raster"&&s===512?"@2x":""}${we.supported?".webp":"$1"}`),c.authority==="raster"?c.path=`/${de.RASTER_URL_PREFIX}${c.path}`:(c.path=c.path.replace(/^.+\/v4\//,"/"),c.path=`/${de.TILE_URL_VERSION}${c.path}`);const p=this._customAccessToken||function(g){for(const _ of g){const x=_.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(c.params)||de.ACCESS_TOKEN;return de.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&c.params.push(`sku=${this._skuToken}`),this._makeAPIURL(c,p)}canonicalizeTileURL(a,n){const s=Zt(a);if(!s.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!s.path.match(/\.[\w]+$/))return a;let c="mapbox://";s.path.match(/^\/raster\/v1\//)?c+=`raster/${s.path.replace(`/${de.RASTER_URL_PREFIX}/`,"")}`:c+=`tiles/${s.path.replace(`/${de.TILE_URL_VERSION}/`,"")}`;let p=s.params;return n&&(p=p.filter(g=>!g.match(/^access_token=/))),p.length&&(c+=`?${p.join("&")}`),c}canonicalizeTileset(a,n){const s=!!n&&cn(n),c=[];for(const p of a.tiles||[])Ht(p)?c.push(this.canonicalizeTileURL(p,s)):c.push(p);return c}_makeAPIURL(a,n){const s="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",c=Zt(de.API_URL);if(a.protocol=c.protocol,a.authority=c.authority,a.protocol==="http"){const p=a.params.indexOf("secure");p>=0&&a.params.splice(p,1)}if(c.path!=="/"&&(a.path=`${c.path}${a.path}`),!de.REQUIRE_ACCESS_TOKEN)return Ze(a);if(n=n||de.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${s}`);if(n[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${s}`)}return a.params=a.params.filter(p=>p.indexOf("access_token")===-1),a.params.push(`access_token=${n||""}`),Ze(a)}},r.ResourceType=be,r.SegmentVector=Ei,r.SourceCache=Kl,r.StencilMode=Zv,r.StructArrayLayout1ui2=$n,r.StructArrayLayout2f1f2i16=Kt,r.StructArrayLayout2i4=Ae,r.StructArrayLayout2ui4=Mn,r.StructArrayLayout3f12=zt,r.StructArrayLayout3ui6=qt,r.StructArrayLayout4i8=ke,r.Texture=Dp,r.Tile=$v,r.Transitionable=m,r.Uniform1f=pg,r.Uniform1i=class extends $a{constructor(a,n){super(a,n),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},r.Uniform2f=class extends $a{constructor(a,n){super(a,n),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},r.Uniform3f=class extends $a{constructor(a,n){super(a,n),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},r.Uniform4f=tb,r.UniformColor=nb,r.UniformMatrix2f=class extends $a{constructor(a,n){super(a,n),this.current=rR}set(a){for(let n=0;n<4;n++)if(a[n]!==this.current[n]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}},r.UniformMatrix3f=class extends $a{constructor(a,n){super(a,n),this.current=iR}set(a){for(let n=0;n<9;n++)if(a[n]!==this.current[n]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}},r.UniformMatrix4f=class extends $a{constructor(a,n){super(a,n),this.current=nR}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let n=1;n<16;n++)if(a[n]!==this.current[n]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},r.UnwrappedTileID=Sw,r.ValidationError=Wt,r.VectorTileWorkerSource=class extends Be{constructor(a,n,s,c,p){super(),this.actor=a,this.layerIndex=n,this.availableImages=s,this.loadVectorData=p||Zw,this.loading={},this.loaded={},this.deduped=new qw(a.scheduler),this.isSpriteLoaded=c,this.scheduler=a.scheduler}loadTile(a,n){const s=a.uid,c=a&&a.request,p=c&&c.collectResourceTiming,g=this.loading[s]=new fk(a);g.abort=this.loadVectorData(a,(_,x)=>{const C=!this.loading[s];if(delete this.loading[s],C||_||!x)return g.status="done",C||(this.loaded[s]=g),n(_);const S=x.rawData,R={};x.expires&&(R.expires=x.expires),x.cacheControl&&(R.cacheControl=x.cacheControl),g.vectorTile=x.vectorTile||new Yl.VectorTile(new Cp(S));const B=()=>{g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,(N,H)=>{if(N||!H)return n(N);const Z={};if(p){const Q=_w(c);Q.length>0&&(Z.resourceTiming=JSON.parse(JSON.stringify(Q)))}n(null,me({rawTileData:S.slice(0)},H,R,Z))})};this.isSpriteLoaded?B():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(B,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom}):B()}),this.loaded=this.loaded||{},this.loaded[s]=g})}reloadTile(a,n){const s=this.loaded,c=a.uid,p=this;if(s&&s[c]){const g=s[c];g.showCollisionBoxes=a.showCollisionBoxes,g.enableTerrain=!!a.enableTerrain,g.projection=a.projection,g.tileTransform=Jl(a.tileID.canonical,a.projection);const _=(x,C)=>{const S=g.reloadCallback;S&&(delete g.reloadCallback,g.parse(g.vectorTile,p.layerIndex,this.availableImages,p.actor,S)),n(x,C)};g.status==="parsing"?g.reloadCallback=_:g.status==="done"&&(g.vectorTile?g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,_):_())}}abortTile(a,n){const s=a.uid,c=this.loading[s];c&&(c.abort&&c.abort(),delete this.loading[s]),n()}removeTile(a,n){const s=this.loaded,c=a.uid;s&&s[c]&&delete s[c],n()}},r.WritingMode=yo,r.ZoomHistory=Jd,r.add=yb,r.addDynamicAttributes=Fv,r.adjoint=function(a,n){var s=n[0],c=n[1],p=n[2],g=n[3],_=n[4],x=n[5],C=n[6],S=n[7],R=n[8];return a[0]=_*R-x*S,a[1]=p*S-c*R,a[2]=c*x-p*_,a[3]=x*C-g*R,a[4]=s*R-p*C,a[5]=p*g-s*x,a[6]=g*S-_*C,a[7]=c*C-s*S,a[8]=s*_-c*g,a},r.asyncAll=se,r.bezier=ue,r.bindAll=At,r.boundsAttributes=Iw,r.bufferConvexPolygon=function(a,n){const s=[];for(let c=0;c<a.length;c++){const p=ie(c-1,-1,a.length-1),g=ie(c+1,-1,a.length-1),_=a[c],x=a[g],C=a[p].sub(_).unit(),S=x.sub(_).unit(),R=S.angleWithSep(C.x,C.y),B=C.add(S).unit().mult(-1*n/Math.sin(R/2));s.push(_.add(B))}return s},r.cacheEntryPossiblyAdded=function(a){Cr++,Cr>Hr&&(a.getActor().send("enforceCacheSizeLimit",_i),Cr=0)},r.calculateGlobeLabelMatrix=function(a,n){const{lng:s,lat:c}=a._center,p=Tw(0,0,a.worldSize/a._projectionScaler,s,c);return uv(p,p,function(g){const _=ma(new Float64Array(16)),x=1/jv(g);return Zl(_,_,g.min),Ns(_,_,[x,x,x]),_}(Lp(n)))},r.calculateGlobeMatrix=Ew,r.calculateGlobeMercatorMatrix=function(a){const n=a.worldSize,s=a.point,c=Gu(1,a.center.lat)*n,p=a.pixelsPerMeter,g=n/(c/a.pixelsPerMeter),_=ma(new Float64Array(16));return Zl(_,_,[s.x,s.y,0]),Ns(_,_,[g,g,p]),Float32Array.from(_)},r.circumferenceAtLatitude=iv,r.clamp=te,r.clearTileCache=function(a){const n=L.caches.delete(Si);a&&n.catch(a).then(()=>a())},r.clipLine=cw,r.clone=function(a){var n=new Zr(16);return n[0]=a[0],n[1]=a[1],n[2]=a[2],n[3]=a[3],n[4]=a[4],n[5]=a[5],n[6]=a[6],n[7]=a[7],n[8]=a[8],n[9]=a[9],n[10]=a[10],n[11]=a[11],n[12]=a[12],n[13]=a[13],n[14]=a[14],n[15]=a[15],n},r.clone$1=Nt,r.collisionCircleLayout=fz,r.config=de,r.conjugate=function(a,n){return a[0]=-n[0],a[1]=-n[1],a[2]=-n[2],a[3]=n[3],a},r.create=function(){var a=new Zr(16);return Zr!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},r.create$1=fb,r.createExpression=Pl,r.createLayout=Pe,r.createStyleLayer=function(a){return a.type==="custom"?new Jz(a):new Qz[a.type](a)},r.cross=xb,r.degToRad=F,r.div=function(a,n,s){return a[0]=n[0]/s[0],a[1]=n[1]/s[1],a[2]=n[2]/s[2],a},r.dot=mp,r.earthRadius=nv,r.ease=$,r.easeCubicInOut=re,r.emitValidationErrors=Zm,r.endsWith=yt,r.enforceCacheSizeLimit=function(a){ki(),ei&&ei.then(n=>{n.keys().then(s=>{for(let c=0;c<s.length-a;c++)n.delete(s[c])})})},r.evaluateSizeForFeature=Ag,r.evaluateSizeForZoom=Xu,r.evaluateVariableOffset=fw,r.evented=sp,r.exactEquals=function(a,n){return a[0]===n[0]&&a[1]===n[1]&&a[2]===n[2]&&a[3]===n[3]},r.exactEquals$1=function(a,n){return a[0]===n[0]&&a[1]===n[1]&&a[2]===n[2]},r.exported=wt,r.exported$1=we,r.extend=me,r.extend$1=Tt,r.filterObject=It,r.fromMat4=function(a,n){return a[0]=n[0],a[1]=n[1],a[2]=n[2],a[3]=n[4],a[4]=n[5],a[5]=n[6],a[6]=n[8],a[7]=n[9],a[8]=n[10],a},r.fromQuat=function(a,n){var s=n[0],c=n[1],p=n[2],g=n[3],_=s+s,x=c+c,C=p+p,S=s*_,R=c*_,B=c*x,N=p*_,H=p*x,Z=p*C,Q=g*_,le=g*x,ve=g*C;return a[0]=1-B-Z,a[1]=R+ve,a[2]=N-le,a[3]=0,a[4]=R-ve,a[5]=1-S-Z,a[6]=H+Q,a[7]=0,a[8]=N+le,a[9]=H-Q,a[10]=1-S-B,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},r.fromRotation=function(a,n){var s=Math.sin(n),c=Math.cos(n);return a[0]=c,a[1]=s,a[2]=0,a[3]=-s,a[4]=c,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},r.fromScaling=function(a,n){return a[0]=n[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=n[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=n[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},r.furthestTileCorner=function(a){const n=Math.round((a+45+360)%360/90)%4;return X[n]},r.getAABBPointSquareDist=function(a,n,s){let c=0;for(let p=0;p<2;++p){const g=s?s[p]:0;a[p]>g&&(c+=(a[p]-g)*(a[p]-g)),n[p]<g&&(c+=(g-n[p])*(g-n[p]))}return c},r.getAnchorAlignment=Iv,r.getAnchorJustification=kv,r.getBounds=function(a){let n=1/0,s=1/0,c=-1/0,p=-1/0;for(const g of a)n=Math.min(n,g.x),s=Math.min(s,g.y),c=Math.max(c,g.x),p=Math.max(p,g.y);return{min:new M(n,s),max:new M(c,p)}},r.getColumn=function(a,n){return[a[4*n],a[4*n+1],a[4*n+2],a[4*n+3]]},r.getGridMatrix=function(a,n){const[s,c]=n,p=.015625;return[0,(c[1]-s[1])*p,1<<a.z,(c[0]-s[0])*p,0,a.y,s[0],s[1],p]},r.getImage=Vt,r.getJSON=function(a,n){return ge(me(a,{type:"json"}),n)},r.getMapSessionAPI=Wi,r.getPerformanceMeasurement=_w,r.getProjection=function(a){const n=a.parallels,s=!!n&&Math.abs(n[0]+n[1])<.01;switch(a.name){case"mercator":return new gk(a);case"equirectangular":return new vk(a);case"naturalEarth":return new bk(a);case"equalEarth":return new _k(a);case"winkelTripel":return new wk(a);case"albers":return s?new Jw(a):new yk(a);case"lambertConformalConic":return s?new Jw(a):new xk(a)}throw new Error(`Invalid projection name: ${a.name}`)},r.getRTLTextPluginStatus=Nu,r.getReferrer=Y,r.getTilePoint=function(a,{x:n,y:s},c=0){return new M(((n-c)*a.scale-a.x)*In,(s*a.scale-a.y)*In)},r.getTileVec3=function(a,n,s=0){return dp(((n.x-s)*a.scale-a.x)*In,(n.y*a.scale-a.y)*In,ob(n.z,n.y))},r.getVideo=function(a,n){const s=L.document.createElement("video");s.muted=!0,s.onloadstart=function(){n(null,s)};for(let c=0;c<a.length;c++){const p=L.document.createElement("source");et(a[c])||(s.crossOrigin="Anonymous"),p.src=a[c],s.appendChild(p)}return{cancel:()=>{}}},r.globeECEFOrigin=function(a,n){const s=[0,0,0];return Xl(s,s,Mw(Lp(n.canonical))),Xl(s,s,a),s},r.globePixelsToTileUnits=function(a,n){return In/(512*Math.pow(2,a))*jv(Lp(n))},r.globePoleMatrixForTile=function(a,n,s){const c=ma(new Float64Array(16)),p=1<<a,g=360*(n/p-.5),_=s.point,x=s.worldSize/(s.tileSize*p);return Zl(c,c,[_.x,_.y,-s.worldSize/Math.PI/2]),Ns(c,c,[x,x,x]),hv(c,c,F(-s._center.lat)),dv(c,c,F(-s._center.lng+g)),Float32Array.from(c)},r.globeTileLatLngCorners=Wv,r.globeToMercatorTransition=function(a){return oe(5,6,a)},r.identity=ma,r.identity$1=Mb,r.invert=function(a,n){var s=n[0],c=n[1],p=n[2],g=n[3],_=n[4],x=n[5],C=n[6],S=n[7],R=n[8],B=n[9],N=n[10],H=n[11],Z=n[12],Q=n[13],le=n[14],ve=n[15],Fe=s*x-c*_,je=s*C-p*_,Xe=s*S-g*_,Ye=c*C-p*x,Je=c*S-g*x,ut=p*S-g*C,dt=R*Q-B*Z,xt=R*le-N*Z,Et=R*ve-H*Z,ot=B*le-N*Q,mt=B*ve-H*Q,Dt=N*ve-H*le,Ft=Fe*Dt-je*mt+Xe*ot+Ye*Et-Je*xt+ut*dt;return Ft?(a[0]=(x*Dt-C*mt+S*ot)*(Ft=1/Ft),a[1]=(p*mt-c*Dt-g*ot)*Ft,a[2]=(Q*ut-le*Je+ve*Ye)*Ft,a[3]=(N*Je-B*ut-H*Ye)*Ft,a[4]=(C*Et-_*Dt-S*xt)*Ft,a[5]=(s*Dt-p*Et+g*xt)*Ft,a[6]=(le*Xe-Z*ut-ve*je)*Ft,a[7]=(R*ut-N*Xe+H*je)*Ft,a[8]=(_*mt-x*Et+S*dt)*Ft,a[9]=(c*Et-s*mt-g*dt)*Ft,a[10]=(Z*Je-Q*Xe+ve*Fe)*Ft,a[11]=(B*Xe-R*Je-H*Fe)*Ft,a[12]=(x*xt-_*ot-C*dt)*Ft,a[13]=(s*ot-c*xt+p*dt)*Ft,a[14]=(Q*je-Z*Ye-le*Fe)*Ft,a[15]=(R*Ye-B*je+N*Fe)*Ft,a):null},r.isMapAuthenticated=function(a){return Nn.has(a)},r.isMapboxURL=cn,r.isSafariWithAntialiasingBug=function(a){const n=a.navigator?a.navigator.userAgent:null;return!!Ke(a)&&n&&(n.match("Version/15.4")||n.match("Version/15.5")||n.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},r.latFromMercatorY=rr,r.len=bR,r.length=gb,r.length$1=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},r.loadVectorTile=Zw,r.makeRequest=ge,r.mercatorXfromLng=hp,r.mercatorYfromLat=Vu,r.mercatorZfromAltitude=Gu,r.mul=vR,r.mul$1=xR,r.multiply=function(a,n,s){var c=n[0],p=n[1],g=n[2],_=n[3],x=n[4],C=n[5],S=n[6],R=n[7],B=n[8],N=s[0],H=s[1],Z=s[2],Q=s[3],le=s[4],ve=s[5],Fe=s[6],je=s[7],Xe=s[8];return a[0]=N*c+H*_+Z*S,a[1]=N*p+H*x+Z*R,a[2]=N*g+H*C+Z*B,a[3]=Q*c+le*_+ve*S,a[4]=Q*p+le*x+ve*R,a[5]=Q*g+le*C+ve*B,a[6]=Fe*c+je*_+Xe*S,a[7]=Fe*p+je*x+Xe*R,a[8]=Fe*g+je*C+Xe*B,a},r.multiply$1=uv,r.multiply$2=vb,r.nextPowerOfTwo=$e,r.normalize=fp,r.normalize$1=function(a,n){var s=n[0],c=n[1],p=n[2],g=n[3],_=s*s+c*c+p*p+g*g;return _>0&&(_=1/Math.sqrt(_)),a[0]=s*_,a[1]=c*_,a[2]=p*_,a[3]=g*_,a},r.number=yn,r.ortho=function(a,n,s,c,p,g,_){var x=1/(n-s),C=1/(c-p),S=1/(g-_);return a[0]=-2*x,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*C,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*S,a[11]=0,a[12]=(n+s)*x,a[13]=(p+c)*C,a[14]=(_+g)*S,a[15]=1,a},r.pbf=Cp,r.perspective=function(a,n,s,c,p){var g,_=1/Math.tan(n/2);return a[0]=_/s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=_,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,p!=null&&p!==1/0?(a[10]=(p+c)*(g=1/(c-p)),a[14]=2*p*c*g):(a[10]=-1,a[14]=-2*c),a},r.pick=function(a,n){const s={};for(let c=0;c<n.length;c++){const p=n[c];p in a&&(s[p]=a[p])}return s},r.plugin=$r,r.pointGeometry=M,r.polygonIntersectsBox=hb,r.polygonIntersectsPolygon=sb,r.polygonizeBounds=function(a,n,s=0,c=!0){const p=new M(s,s),g=a.sub(p),_=n.add(p),x=[g,new M(_.x,g.y),_,new M(g.x,_.y)];return c&&x.push(g),x},r.posAttributes=Pp,r.postMapLoadEvent=Gn,r.postTurnstileEvent=fn,r.potpack=Sv,r.prevPowerOfTwo=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},r.radToDeg=G,r.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],r.registerForPluginStateChange=function(a){return a({pluginStatus:yr,pluginURL:Ir}),sp.on("pluginStateChange",a),a},r.removeAuthState=function(a){Nn.delete(a)},r.renderColorRamp=vv,r.rotateX=hv,r.rotateX$1=Tb,r.rotateY=dv,r.rotateZ=function(a,n,s){var c=Math.sin(s),p=Math.cos(s),g=n[0],_=n[1],x=n[2],C=n[3],S=n[4],R=n[5],B=n[6],N=n[7];return n!==a&&(a[8]=n[8],a[9]=n[9],a[10]=n[10],a[11]=n[11],a[12]=n[12],a[13]=n[13],a[14]=n[14],a[15]=n[15]),a[0]=g*p+S*c,a[1]=_*p+R*c,a[2]=x*p+B*c,a[3]=C*p+N*c,a[4]=S*p-g*c,a[5]=R*p-_*c,a[6]=B*p-x*c,a[7]=N*p-C*c,a},r.rotateZ$1=function(a,n,s){s*=.5;var c=n[0],p=n[1],g=n[2],_=n[3],x=Math.sin(s),C=Math.cos(s);return a[0]=c*C+p*x,a[1]=p*C-c*x,a[2]=g*C+_*x,a[3]=_*C-g*x,a},r.scale=Ns,r.scale$1=function(a,n,s){return a[0]=n[0]*s,a[1]=n[1]*s,a[2]=n[2]*s,a[3]=n[3]*s,a},r.scale$2=pp,r.scaleAndAdd=gv,r.setCacheLimits=function(a,n){_i=a,Hr=n},r.setColumn=function(a,n,s){a[4*n+0]=s[0],a[4*n+1]=s[1],a[4*n+2]=s[2],a[4*n+3]=s[3]},r.setRTLTextPlugin=function(a,n,s=!1){if(yr===rp||yr===Gl||yr===op)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ir=wt.resolveURL(a),yr=rp,ap=n,Wa(),s||Rs()},r.smoothstep=oe,r.spec=Me,r.storeAuthState=function(a,n){n?Nn.add(a):Nn.delete(a)},r.sub=ju,r.subtract=_b,r.symbolSize=mz,r.tileAABB=function(a,n,s,c,p,g,_,x,C){if(C.name==="globe")return sk(a,n,new Bg(s,c,p));const S=Jl({z:s,x:c,y:p},C);return new go([(g+S.x/S.scale)*n,n*(S.y/S.scale),_],[(g+S.x2/S.scale)*n,n*(S.y2/S.scale),x])},r.tileTransform=Jl,r.transformMat3=function(a,n,s){var c=n[0],p=n[1],g=n[2];return a[0]=c*s[0]+p*s[3]+g*s[6],a[1]=c*s[1]+p*s[4]+g*s[7],a[2]=c*s[2]+p*s[5]+g*s[8],a},r.transformMat4=Xl,r.transformMat4$1=$u,r.transformQuat=bb,r.translate=Zl,r.transpose=function(a,n){if(a===n){var s=n[1],c=n[2],p=n[5];a[1]=n[3],a[2]=n[6],a[3]=s,a[5]=n[7],a[6]=c,a[7]=p}else a[0]=n[0],a[1]=n[3],a[2]=n[6],a[3]=n[1],a[4]=n[4],a[5]=n[7],a[6]=n[2],a[7]=n[5],a[8]=n[8];return a},r.triggerPluginCompletionEvent=Hl,r.uniqueId=Ue,r.validateCustomStyleLayer=function(a){const n=[],s=a.id;return s===void 0&&n.push({message:`layers.${s}: missing required property "id"`}),a.render===void 0&&n.push({message:`layers.${s}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&n.push({message:`layers.${s}: property "renderingMode" must be either "2d" or "3d"`}),n},r.validateFilter=a=>No(ua(a)),r.validateFog=a=>No(qm(a)),r.validateLayer=a=>No(Gm(a)),r.validateLight=a=>No(jm(a)),r.validateSource=a=>No(Wm(a)),r.validateStyle=Fl,r.validateTerrain=a=>No($m(a)),r.values=pe,r.vectorTile=Yl,r.version=v,r.warnOnce=xe,r.window=L,r.wrap=ie}),h(["./shared"],function(r){function v(be){if(typeof be=="number"||typeof be=="boolean"||typeof be=="string"||be==null)return JSON.stringify(be);if(Array.isArray(be)){let Y="[";for(const ge of be)Y+=`${v(ge)},`;return`${Y}]`}let W="{";for(const Y of Object.keys(be).sort())W+=`${Y}:${v(be[Y])},`;return`${W}}`}function b(be){let W="";for(const Y of r.refProperties)W+=`/${v(be[Y])}`;return W}class E{constructor(W){this.keyCache={},W&&this.replace(W)}replace(W){this._layerConfigs={},this._layers={},this.update(W,[])}update(W,Y){for(const Re of W)this._layerConfigs[Re.id]=Re,(this._layers[Re.id]=r.createStyleLayer(Re)).compileFilter(),this.keyCache[Re.id]&&delete this.keyCache[Re.id];for(const Re of Y)delete this.keyCache[Re],delete this._layerConfigs[Re],delete this._layers[Re];this.familiesBySource={};const ge=function(Re,We){const Qe={};for(let qe=0;qe<Re.length;qe++){const it=We&&We[Re[qe].id]||b(Re[qe]);We&&(We[Re[qe].id]=it);let vt=Qe[it];vt||(vt=Qe[it]=[]),vt.push(Re[qe])}const et=[];for(const qe in Qe)et.push(Qe[qe]);return et}(r.values(this._layerConfigs),this.keyCache);for(const Re of ge){const We=Re.map(Vt=>this._layers[Vt.id]),Qe=We[0];if(Qe.visibility==="none")continue;const et=Qe.source||"";let qe=this.familiesBySource[et];qe||(qe=this.familiesBySource[et]={});const it=Qe.sourceLayer||"_geojsonTileLayer";let vt=qe[it];vt||(vt=qe[it]=[]),vt.push(We)}}}class M{loadTile(W,Y){const{uid:ge,encoding:Re,rawImageData:We,padding:Qe,buildQuadTree:et}=W,qe=r.window.ImageBitmap&&We instanceof r.window.ImageBitmap?this.getImageData(We,Qe):We;Y(null,new r.DEMData(ge,qe,Re,Qe<1,et))}getImageData(W,Y){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(W.width,W.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=W.width,this.offscreenCanvas.height=W.height,this.offscreenCanvasContext.drawImage(W,0,0,W.width,W.height);const ge=this.offscreenCanvasContext.getImageData(-Y,-Y,W.width+2*Y,W.height+2*Y);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ge}}var D=function be(W,Y){var ge,Re=W&&W.type;if(Re==="FeatureCollection")for(ge=0;ge<W.features.length;ge++)be(W.features[ge],Y);else if(Re==="GeometryCollection")for(ge=0;ge<W.geometries.length;ge++)be(W.geometries[ge],Y);else if(Re==="Feature")be(W.geometry,Y);else if(Re==="Polygon")L(W.coordinates,Y);else if(Re==="MultiPolygon")for(ge=0;ge<W.coordinates.length;ge++)L(W.coordinates[ge],Y);return W};function L(be,W){if(be.length!==0){z(be[0],W);for(var Y=1;Y<be.length;Y++)z(be[Y],!W)}}function z(be,W){for(var Y=0,ge=0,Re=0,We=be.length,Qe=We-1;Re<We;Qe=Re++){var et=(be[Re][0]-be[Qe][0])*(be[Qe][1]+be[Re][1]),qe=Y+et;ge+=Math.abs(Y)>=Math.abs(et)?Y-qe+et:et-qe+Y,Y=qe}Y+ge>=0!=!!W&&be.reverse()}const k=r.vectorTile.VectorTileFeature.prototype.toGeoJSON;class F{constructor(W){this._feature=W,this.extent=r.EXTENT,this.type=W.type,this.properties=W.tags,"id"in W&&!isNaN(W.id)&&(this.id=parseInt(W.id,10))}loadGeometry(){if(this._feature.type===1){const W=[];for(const Y of this._feature.geometry)W.push([new r.pointGeometry(Y[0],Y[1])]);return W}{const W=[];for(const Y of this._feature.geometry){const ge=[];for(const Re of Y)ge.push(new r.pointGeometry(Re[0],Re[1]));W.push(ge)}return W}}toGeoJSON(W,Y,ge){return k.call(this,W,Y,ge)}}class G{constructor(W){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=r.EXTENT,this.length=W.length,this._features=W}feature(W){return new F(this._features[W])}}var X=r.vectorTile.VectorTileFeature,re=ue;function ue(be,W){this.options=W||{},this.features=be,this.length=be.length}function $(be,W){this.id=typeof be.id=="number"?be.id:void 0,this.type=be.type,this.rawGeometry=be.type===1?[be.geometry]:be.geometry,this.properties=be.tags,this.extent=W||4096}ue.prototype.feature=function(be){return new $(this.features[be],this.options.extent)},$.prototype.loadGeometry=function(){var be=this.rawGeometry;this.geometry=[];for(var W=0;W<be.length;W++){for(var Y=be[W],ge=[],Re=0;Re<Y.length;Re++)ge.push(new r.pointGeometry(Y[Re][0],Y[Re][1]));this.geometry.push(ge)}return this.geometry},$.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var be=this.geometry,W=1/0,Y=-1/0,ge=1/0,Re=-1/0,We=0;We<be.length;We++)for(var Qe=be[We],et=0;et<Qe.length;et++){var qe=Qe[et];W=Math.min(W,qe.x),Y=Math.max(Y,qe.x),ge=Math.min(ge,qe.y),Re=Math.max(Re,qe.y)}return[W,ge,Y,Re]},$.prototype.toGeoJSON=X.prototype.toGeoJSON;var te=ie,oe=re;function ie(be){var W=new r.pbf;return function(Y,ge){for(var Re in Y.layers)ge.writeMessage(3,se,Y.layers[Re])}(be,W),W.finish()}function se(be,W){var Y;W.writeVarintField(15,be.version||1),W.writeStringField(1,be.name||""),W.writeVarintField(5,be.extent||4096);var ge={keys:[],values:[],keycache:{},valuecache:{}};for(Y=0;Y<be.length;Y++)ge.feature=be.feature(Y),W.writeMessage(2,pe,ge);var Re=ge.keys;for(Y=0;Y<Re.length;Y++)W.writeStringField(3,Re[Y]);var We=ge.values;for(Y=0;Y<We.length;Y++)W.writeMessage(4,$e,We[Y])}function pe(be,W){var Y=be.feature;Y.id!==void 0&&W.writeVarintField(1,Y.id),W.writeMessage(2,me,be),W.writeVarintField(3,Y.type),W.writeMessage(4,Ve,Y)}function me(be,W){var Y=be.feature,ge=be.keys,Re=be.values,We=be.keycache,Qe=be.valuecache;for(var et in Y.properties){var qe=Y.properties[et],it=We[et];if(qe!==null){it===void 0&&(ge.push(et),We[et]=it=ge.length-1),W.writeVarint(it);var vt=typeof qe;vt!=="string"&&vt!=="boolean"&&vt!=="number"&&(qe=JSON.stringify(qe));var Vt=vt+":"+qe,Ct=Qe[Vt];Ct===void 0&&(Re.push(qe),Qe[Vt]=Ct=Re.length-1),W.writeVarint(Ct)}}}function he(be,W){return(W<<3)+(7&be)}function Ue(be){return be<<1^be>>31}function Ve(be,W){for(var Y=be.loadGeometry(),ge=be.type,Re=0,We=0,Qe=Y.length,et=0;et<Qe;et++){var qe=Y[et],it=1;ge===1&&(it=qe.length),W.writeVarint(he(1,it));for(var vt=ge===3?qe.length-1:qe.length,Vt=0;Vt<vt;Vt++){Vt===1&&ge!==1&&W.writeVarint(he(2,vt-1));var Ct=qe[Vt].x-Re,_n=qe[Vt].y-We;W.writeVarint(Ue(Ct)),W.writeVarint(Ue(_n)),Re+=Ct,We+=_n}ge===3&&W.writeVarint(he(7,1))}}function $e(be,W){var Y=typeof be;Y==="string"?W.writeStringField(1,be):Y==="boolean"?W.writeBooleanField(7,be):Y==="number"&&(be%1!=0?W.writeDoubleField(3,be):be<0?W.writeSVarintField(6,be):W.writeVarintField(5,be))}function ct(be,W,Y,ge,Re,We){if(Re-ge<=Y)return;const Qe=ge+Re>>1;At(be,W,Qe,ge,Re,We%2),ct(be,W,Y,ge,Qe-1,We+1),ct(be,W,Y,Qe+1,Re,We+1)}function At(be,W,Y,ge,Re,We){for(;Re>ge;){if(Re-ge>600){const it=Re-ge+1,vt=Y-ge+1,Vt=Math.log(it),Ct=.5*Math.exp(2*Vt/3),_n=.5*Math.sqrt(Vt*Ct*(it-Ct)/it)*(vt-it/2<0?-1:1);At(be,W,Y,Math.max(ge,Math.floor(Y-vt*Ct/it+_n)),Math.min(Re,Math.floor(Y+(it-vt)*Ct/it+_n)),We)}const Qe=W[2*Y+We];let et=ge,qe=Re;for(yt(be,W,ge,Y),W[2*Re+We]>Qe&&yt(be,W,ge,Re);et<qe;){for(yt(be,W,et,qe),et++,qe--;W[2*et+We]<Qe;)et++;for(;W[2*qe+We]>Qe;)qe--}W[2*ge+We]===Qe?yt(be,W,ge,qe):(qe++,yt(be,W,qe,Re)),qe<=Y&&(ge=qe+1),Y<=qe&&(Re=qe-1)}}function yt(be,W,Y,ge){St(be,Y,ge),St(W,2*Y,2*ge),St(W,2*Y+1,2*ge+1)}function St(be,W,Y){const ge=be[W];be[W]=be[Y],be[Y]=ge}function It(be,W,Y,ge){const Re=be-Y,We=W-ge;return Re*Re+We*We}te.fromVectorTileJs=ie,te.fromGeojsonVt=function(be,W){W=W||{};var Y={};for(var ge in be)Y[ge]=new re(be[ge].features,W),Y[ge].name=ge,Y[ge].version=W.version,Y[ge].extent=W.extent;return ie({layers:Y})},te.GeoJSONWrapper=oe;const Nt=be=>be[0],Ie=be=>be[1];class xe{constructor(W,Y=Nt,ge=Ie,Re=64,We=Float64Array){this.nodeSize=Re,this.points=W;const Qe=W.length<65536?Uint16Array:Uint32Array,et=this.ids=new Qe(W.length),qe=this.coords=new We(2*W.length);for(let it=0;it<W.length;it++)et[it]=it,qe[2*it]=Y(W[it]),qe[2*it+1]=ge(W[it]);ct(et,qe,Re,0,et.length-1,0)}range(W,Y,ge,Re){return function(We,Qe,et,qe,it,vt,Vt){const Ct=[0,We.length-1,0],_n=[];let q,K;for(;Ct.length;){const Be=Ct.pop(),Me=Ct.pop(),Tt=Ct.pop();if(Me-Tt<=Vt){for(let rn=Tt;rn<=Me;rn++)q=Qe[2*rn],K=Qe[2*rn+1],q>=et&&q<=it&&K>=qe&&K<=vt&&_n.push(We[rn]);continue}const _t=Math.floor((Tt+Me)/2);q=Qe[2*_t],K=Qe[2*_t+1],q>=et&&q<=it&&K>=qe&&K<=vt&&_n.push(We[_t]);const Ot=(Be+1)%2;(Be===0?et<=q:qe<=K)&&(Ct.push(Tt),Ct.push(_t-1),Ct.push(Ot)),(Be===0?it>=q:vt>=K)&&(Ct.push(_t+1),Ct.push(Me),Ct.push(Ot))}return _n}(this.ids,this.coords,W,Y,ge,Re,this.nodeSize)}within(W,Y,ge){return function(Re,We,Qe,et,qe,it){const vt=[0,Re.length-1,0],Vt=[],Ct=qe*qe;for(;vt.length;){const _n=vt.pop(),q=vt.pop(),K=vt.pop();if(q-K<=it){for(let Ot=K;Ot<=q;Ot++)It(We[2*Ot],We[2*Ot+1],Qe,et)<=Ct&&Vt.push(Re[Ot]);continue}const Be=Math.floor((K+q)/2),Me=We[2*Be],Tt=We[2*Be+1];It(Me,Tt,Qe,et)<=Ct&&Vt.push(Re[Be]);const _t=(_n+1)%2;(_n===0?Qe-qe<=Me:et-qe<=Tt)&&(vt.push(K),vt.push(Be-1),vt.push(_t)),(_n===0?Qe+qe>=Me:et+qe>=Tt)&&(vt.push(Be+1),vt.push(q),vt.push(_t))}return Vt}(this.ids,this.coords,W,Y,ge,this.nodeSize)}}const He={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:be=>be},Ge=Math.fround||(ze=new Float32Array(1),be=>(ze[0]=+be,ze[0]));var ze;class rt{constructor(W){this.options=wt(Object.create(He),W),this.trees=new Array(this.options.maxZoom+1)}load(W){const{log:Y,minZoom:ge,maxZoom:Re,nodeSize:We}=this.options;Y&&console.time("total time");const Qe=`prepare ${W.length} points`;Y&&console.time(Qe),this.points=W;let et=[];for(let qe=0;qe<W.length;qe++)W[qe].geometry&&et.push(Ee(W[qe],qe));this.trees[Re+1]=new xe(et,Gt,de,We,Float32Array),Y&&console.timeEnd(Qe);for(let qe=Re;qe>=ge;qe--){const it=+Date.now();et=this._cluster(et,qe),this.trees[qe]=new xe(et,Gt,de,We,Float32Array),Y&&console.log("z%d: %d clusters in %dms",qe,et.length,+Date.now()-it)}return Y&&console.timeEnd("total time"),this}getClusters(W,Y){let ge=((W[0]+180)%360+360)%360-180;const Re=Math.max(-90,Math.min(90,W[1]));let We=W[2]===180?180:((W[2]+180)%360+360)%360-180;const Qe=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)ge=-180,We=180;else if(ge>We){const vt=this.getClusters([ge,Re,180,Qe],Y),Vt=this.getClusters([-180,Re,We,Qe],Y);return vt.concat(Vt)}const et=this.trees[this._limitZoom(Y)],qe=et.range(Oe(ge),Ke(Qe),Oe(We),Ke(Re)),it=[];for(const vt of qe){const Vt=et.points[vt];it.push(Vt.numPoints?Ce(Vt):this.points[Vt.index])}return it}getChildren(W){const Y=this._getOriginId(W),ge=this._getOriginZoom(W),Re="No cluster with the specified id.",We=this.trees[ge];if(!We)throw new Error(Re);const Qe=We.points[Y];if(!Qe)throw new Error(Re);const et=this.options.radius/(this.options.extent*Math.pow(2,ge-1)),qe=We.within(Qe.x,Qe.y,et),it=[];for(const vt of qe){const Vt=We.points[vt];Vt.parentId===W&&it.push(Vt.numPoints?Ce(Vt):this.points[Vt.index])}if(it.length===0)throw new Error(Re);return it}getLeaves(W,Y,ge){const Re=[];return this._appendLeaves(Re,W,Y=Y||10,ge=ge||0,0),Re}getTile(W,Y,ge){const Re=this.trees[this._limitZoom(W)],We=Math.pow(2,W),{extent:Qe,radius:et}=this.options,qe=et/Qe,it=(ge-qe)/We,vt=(ge+1+qe)/We,Vt={features:[]};return this._addTileFeatures(Re.range((Y-qe)/We,it,(Y+1+qe)/We,vt),Re.points,Y,ge,We,Vt),Y===0&&this._addTileFeatures(Re.range(1-qe/We,it,1,vt),Re.points,We,ge,We,Vt),Y===We-1&&this._addTileFeatures(Re.range(0,it,qe/We,vt),Re.points,-1,ge,We,Vt),Vt.features.length?Vt:null}getClusterExpansionZoom(W){let Y=this._getOriginZoom(W)-1;for(;Y<=this.options.maxZoom;){const ge=this.getChildren(W);if(Y++,ge.length!==1)break;W=ge[0].properties.cluster_id}return Y}_appendLeaves(W,Y,ge,Re,We){const Qe=this.getChildren(Y);for(const et of Qe){const qe=et.properties;if(qe&&qe.cluster?We+qe.point_count<=Re?We+=qe.point_count:We=this._appendLeaves(W,qe.cluster_id,ge,Re,We):We<Re?We++:W.push(et),W.length===ge)break}return We}_addTileFeatures(W,Y,ge,Re,We,Qe){for(const et of W){const qe=Y[et],it=qe.numPoints;let vt,Vt,Ct;if(it)vt=ye(qe),Vt=qe.x,Ct=qe.y;else{const K=this.points[qe.index];vt=K.properties,Vt=Oe(K.geometry.coordinates[0]),Ct=Ke(K.geometry.coordinates[1])}const _n={type:1,geometry:[[Math.round(this.options.extent*(Vt*We-ge)),Math.round(this.options.extent*(Ct*We-Re))]],tags:vt};let q;it?q=qe.id:this.options.generateId?q=qe.index:this.points[qe.index].id&&(q=this.points[qe.index].id),q!==void 0&&(_n.id=q),Qe.features.push(_n)}}_limitZoom(W){return Math.max(this.options.minZoom,Math.min(+W,this.options.maxZoom+1))}_cluster(W,Y){const ge=[],{radius:Re,extent:We,reduce:Qe,minPoints:et}=this.options,qe=Re/(We*Math.pow(2,Y));for(let it=0;it<W.length;it++){const vt=W[it];if(vt.zoom<=Y)continue;vt.zoom=Y;const Vt=this.trees[Y+1],Ct=Vt.within(vt.x,vt.y,qe),_n=vt.numPoints||1;let q=_n;for(const K of Ct){const Be=Vt.points[K];Be.zoom>Y&&(q+=Be.numPoints||1)}if(q>_n&&q>=et){let K=vt.x*_n,Be=vt.y*_n,Me=Qe&&_n>1?this._map(vt,!0):null;const Tt=(it<<5)+(Y+1)+this.points.length;for(const _t of Ct){const Ot=Vt.points[_t];if(Ot.zoom<=Y)continue;Ot.zoom=Y;const rn=Ot.numPoints||1;K+=Ot.x*rn,Be+=Ot.y*rn,Ot.parentId=Tt,Qe&&(Me||(Me=this._map(vt,!0)),Qe(Me,this._map(Ot)))}vt.parentId=Tt,ge.push(fe(K/q,Be/q,Tt,q,Me))}else if(ge.push(vt),q>1)for(const K of Ct){const Be=Vt.points[K];Be.zoom<=Y||(Be.zoom=Y,ge.push(Be))}}return ge}_getOriginId(W){return W-this.points.length>>5}_getOriginZoom(W){return(W-this.points.length)%32}_map(W,Y){if(W.numPoints)return Y?wt({},W.properties):W.properties;const ge=this.points[W.index].properties,Re=this.options.map(ge);return Y&&Re===ge?wt({},Re):Re}}function fe(be,W,Y,ge,Re){return{x:Ge(be),y:Ge(W),zoom:1/0,id:Y,parentId:-1,numPoints:ge,properties:Re}}function Ee(be,W){const[Y,ge]=be.geometry.coordinates;return{x:Ge(Oe(Y)),y:Ge(Ke(ge)),zoom:1/0,index:W,parentId:-1}}function Ce(be){return{type:"Feature",id:be.id,properties:ye(be),geometry:{type:"Point",coordinates:[(W=be.x,360*(W-.5)),st(be.y)]}};var W}function ye(be){const W=be.numPoints,Y=W>=1e4?`${Math.round(W/1e3)}k`:W>=1e3?Math.round(W/100)/10+"k":W;return wt(wt({},be.properties),{cluster:!0,cluster_id:be.id,point_count:W,point_count_abbreviated:Y})}function Oe(be){return be/360+.5}function Ke(be){const W=Math.sin(be*Math.PI/180),Y=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return Y<0?0:Y>1?1:Y}function st(be){const W=(180-360*be)*Math.PI/180;return 360*Math.atan(Math.exp(W))/Math.PI-90}function wt(be,W){for(const Y in W)be[Y]=W[Y];return be}function Gt(be){return be.x}function de(be){return be.y}function we(be,W,Y,ge){for(var Re,We=ge,Qe=Y-W>>1,et=Y-W,qe=be[W],it=be[W+1],vt=be[Y],Vt=be[Y+1],Ct=W+3;Ct<Y;Ct+=3){var _n=bt(be[Ct],be[Ct+1],qe,it,vt,Vt);if(_n>We)Re=Ct,We=_n;else if(_n===We){var q=Math.abs(Ct-Qe);q<et&&(Re=Ct,et=q)}}We>ge&&(Re-W>3&&we(be,W,Re,ge),be[Re+2]=We,Y-Re>3&&we(be,Re,Y,ge))}function bt(be,W,Y,ge,Re,We){var Qe=Re-Y,et=We-ge;if(Qe!==0||et!==0){var qe=((be-Y)*Qe+(W-ge)*et)/(Qe*Qe+et*et);qe>1?(Y=Re,ge=We):qe>0&&(Y+=Qe*qe,ge+=et*qe)}return(Qe=be-Y)*Qe+(et=W-ge)*et}function gt(be,W,Y,ge){var Re={id:be===void 0?null:be,type:W,geometry:Y,tags:ge,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(We){var Qe=We.geometry,et=We.type;if(et==="Point"||et==="MultiPoint"||et==="LineString")bn(We,Qe);else if(et==="Polygon"||et==="MultiLineString")for(var qe=0;qe<Qe.length;qe++)bn(We,Qe[qe]);else if(et==="MultiPolygon")for(qe=0;qe<Qe.length;qe++)for(var it=0;it<Qe[qe].length;it++)bn(We,Qe[qe][it])}(Re),Re}function bn(be,W){for(var Y=0;Y<W.length;Y+=3)be.minX=Math.min(be.minX,W[Y]),be.minY=Math.min(be.minY,W[Y+1]),be.maxX=Math.max(be.maxX,W[Y]),be.maxY=Math.max(be.maxY,W[Y+1])}function hn(be,W,Y,ge){if(W.geometry){var Re=W.geometry.coordinates,We=W.geometry.type,Qe=Math.pow(Y.tolerance/((1<<Y.maxZoom)*Y.extent),2),et=[],qe=W.id;if(Y.promoteId?qe=W.properties[Y.promoteId]:Y.generateId&&(qe=ge||0),We==="Point")nn(Re,et);else if(We==="MultiPoint")for(var it=0;it<Re.length;it++)nn(Re[it],et);else if(We==="LineString")pn(Re,et,Qe,!1);else if(We==="MultiLineString"){if(Y.lineMetrics){for(it=0;it<Re.length;it++)pn(Re[it],et=[],Qe,!1),be.push(gt(qe,"LineString",et,W.properties));return}wn(Re,et,Qe,!1)}else if(We==="Polygon")wn(Re,et,Qe,!0);else{if(We!=="MultiPolygon"){if(We==="GeometryCollection"){for(it=0;it<W.geometry.geometries.length;it++)hn(be,{id:qe,geometry:W.geometry.geometries[it],properties:W.properties},Y,ge);return}throw new Error("Input data is not a valid GeoJSON object.")}for(it=0;it<Re.length;it++){var vt=[];wn(Re[it],vt,Qe,!0),et.push(vt)}}be.push(gt(qe,We,et,W.properties))}}function nn(be,W){W.push(cn(be[0])),W.push(Ht(be[1])),W.push(0)}function pn(be,W,Y,ge){for(var Re,We,Qe=0,et=0;et<be.length;et++){var qe=cn(be[et][0]),it=Ht(be[et][1]);W.push(qe),W.push(it),W.push(0),et>0&&(Qe+=ge?(Re*it-qe*We)/2:Math.sqrt(Math.pow(qe-Re,2)+Math.pow(it-We,2))),Re=qe,We=it}var vt=W.length-3;W[2]=1,we(W,0,vt,Y),W[vt+2]=1,W.size=Math.abs(Qe),W.start=0,W.end=W.size}function wn(be,W,Y,ge){for(var Re=0;Re<be.length;Re++){var We=[];pn(be[Re],We,Y,ge),W.push(We)}}function cn(be){return be/360+.5}function Ht(be){var W=Math.sin(be*Math.PI/180),Y=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return Y<0?0:Y>1?1:Y}function sn(be,W,Y,ge,Re,We,Qe,et){if(ge/=W,We>=(Y/=W)&&Qe<ge)return be;if(Qe<Y||We>=ge)return null;for(var qe=[],it=0;it<be.length;it++){var vt=be[it],Vt=vt.geometry,Ct=vt.type,_n=Re===0?vt.minX:vt.minY,q=Re===0?vt.maxX:vt.maxY;if(_n>=Y&&q<ge)qe.push(vt);else if(!(q<Y||_n>=ge)){var K=[];if(Ct==="Point"||Ct==="MultiPoint")Zt(Vt,K,Y,ge,Re);else if(Ct==="LineString")Ze(Vt,K,Y,ge,Re,!1,et.lineMetrics);else if(Ct==="MultiLineString")en(Vt,K,Y,ge,Re,!1);else if(Ct==="Polygon")en(Vt,K,Y,ge,Re,!0);else if(Ct==="MultiPolygon")for(var Be=0;Be<Vt.length;Be++){var Me=[];en(Vt[Be],Me,Y,ge,Re,!0),Me.length&&K.push(Me)}if(K.length){if(et.lineMetrics&&Ct==="LineString"){for(Be=0;Be<K.length;Be++)qe.push(gt(vt.id,Ct,K[Be],vt.tags));continue}Ct!=="LineString"&&Ct!=="MultiLineString"||(K.length===1?(Ct="LineString",K=K[0]):Ct="MultiLineString"),Ct!=="Point"&&Ct!=="MultiPoint"||(Ct=K.length===3?"Point":"MultiPoint"),qe.push(gt(vt.id,Ct,K,vt.tags))}}}return qe.length?qe:null}function Zt(be,W,Y,ge,Re){for(var We=0;We<be.length;We+=3){var Qe=be[We+Re];Qe>=Y&&Qe<=ge&&(W.push(be[We]),W.push(be[We+1]),W.push(be[We+2]))}}function Ze(be,W,Y,ge,Re,We,Qe){for(var et,qe,it=Ut(be),vt=Re===0?fn:On,Vt=be.start,Ct=0;Ct<be.length-3;Ct+=3){var _n=be[Ct],q=be[Ct+1],K=be[Ct+2],Be=be[Ct+3],Me=be[Ct+4],Tt=Re===0?_n:q,_t=Re===0?Be:Me,Ot=!1;Qe&&(et=Math.sqrt(Math.pow(_n-Be,2)+Math.pow(q-Me,2))),Tt<Y?_t>Y&&(qe=vt(it,_n,q,Be,Me,Y),Qe&&(it.start=Vt+et*qe)):Tt>ge?_t<ge&&(qe=vt(it,_n,q,Be,Me,ge),Qe&&(it.start=Vt+et*qe)):Dn(it,_n,q,K),_t<Y&&Tt>=Y&&(qe=vt(it,_n,q,Be,Me,Y),Ot=!0),_t>ge&&Tt<=ge&&(qe=vt(it,_n,q,Be,Me,ge),Ot=!0),!We&&Ot&&(Qe&&(it.end=Vt+et*qe),W.push(it),it=Ut(be)),Qe&&(Vt+=et)}var rn=be.length-3;_n=be[rn],q=be[rn+1],K=be[rn+2],(Tt=Re===0?_n:q)>=Y&&Tt<=ge&&Dn(it,_n,q,K),rn=it.length-3,We&&rn>=3&&(it[rn]!==it[0]||it[rn+1]!==it[1])&&Dn(it,it[0],it[1],it[2]),it.length&&W.push(it)}function Ut(be){var W=[];return W.size=be.size,W.start=be.start,W.end=be.end,W}function en(be,W,Y,ge,Re,We){for(var Qe=0;Qe<be.length;Qe++)Ze(be[Qe],W,Y,ge,Re,We,!1)}function Dn(be,W,Y,ge){be.push(W),be.push(Y),be.push(ge)}function fn(be,W,Y,ge,Re,We){var Qe=(We-W)/(ge-W);return be.push(We),be.push(Y+(Re-Y)*Qe),be.push(1),Qe}function On(be,W,Y,ge,Re,We){var Qe=(We-Y)/(Re-Y);return be.push(W+(ge-W)*Qe),be.push(We),be.push(1),Qe}function Gn(be,W){for(var Y=[],ge=0;ge<be.length;ge++){var Re,We=be[ge],Qe=We.type;if(Qe==="Point"||Qe==="MultiPoint"||Qe==="LineString")Re=qn(We.geometry,W);else if(Qe==="MultiLineString"||Qe==="Polygon"){Re=[];for(var et=0;et<We.geometry.length;et++)Re.push(qn(We.geometry[et],W))}else if(Qe==="MultiPolygon")for(Re=[],et=0;et<We.geometry.length;et++){for(var qe=[],it=0;it<We.geometry[et].length;it++)qe.push(qn(We.geometry[et][it],W));Re.push(qe)}Y.push(gt(We.id,Qe,Re,We.tags))}return Y}function qn(be,W){var Y=[];Y.size=be.size,be.start!==void 0&&(Y.start=be.start,Y.end=be.end);for(var ge=0;ge<be.length;ge+=3)Y.push(be[ge]+W,be[ge+1],be[ge+2]);return Y}function Wi(be,W){if(be.transformed)return be;var Y,ge,Re,We=1<<be.z,Qe=be.x,et=be.y;for(Y=0;Y<be.features.length;Y++){var qe=be.features[Y],it=qe.geometry,vt=qe.type;if(qe.geometry=[],vt===1)for(ge=0;ge<it.length;ge+=2)qe.geometry.push(Nn(it[ge],it[ge+1],W,We,Qe,et));else for(ge=0;ge<it.length;ge++){var Vt=[];for(Re=0;Re<it[ge].length;Re+=2)Vt.push(Nn(it[ge][Re],it[ge][Re+1],W,We,Qe,et));qe.geometry.push(Vt)}}return be.transformed=!0,be}function Nn(be,W,Y,ge,Re,We){return[Math.round(Y*(be*ge-Re)),Math.round(Y*(W*ge-We))]}function Si(be,W,Y,ge,Re){for(var We=W===Re.maxZoom?0:Re.tolerance/((1<<W)*Re.extent),Qe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Y,y:ge,z:W,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},et=0;et<be.length;et++){Qe.numFeatures++,ei(Qe,be[et],We,Re);var qe=be[et].minX,it=be[et].minY,vt=be[et].maxX,Vt=be[et].maxY;qe<Qe.minX&&(Qe.minX=qe),it<Qe.minY&&(Qe.minY=it),vt>Qe.maxX&&(Qe.maxX=vt),Vt>Qe.maxY&&(Qe.maxY=Vt)}return Qe}function ei(be,W,Y,ge){var Re=W.geometry,We=W.type,Qe=[];if(We==="Point"||We==="MultiPoint")for(var et=0;et<Re.length;et+=3)Qe.push(Re[et]),Qe.push(Re[et+1]),be.numPoints++,be.numSimplified++;else if(We==="LineString")Ki(Qe,Re,be,Y,!1,!1);else if(We==="MultiLineString"||We==="Polygon")for(et=0;et<Re.length;et++)Ki(Qe,Re[et],be,Y,We==="Polygon",et===0);else if(We==="MultiPolygon")for(var qe=0;qe<Re.length;qe++){var it=Re[qe];for(et=0;et<it.length;et++)Ki(Qe,it[et],be,Y,!0,et===0)}if(Qe.length){var vt=W.tags||null;if(We==="LineString"&&ge.lineMetrics){for(var Vt in vt={},W.tags)vt[Vt]=W.tags[Vt];vt.mapbox_clip_start=Re.start/Re.size,vt.mapbox_clip_end=Re.end/Re.size}var Ct={geometry:Qe,type:We==="Polygon"||We==="MultiPolygon"?3:We==="LineString"||We==="MultiLineString"?2:1,tags:vt};W.id!==null&&(Ct.id=W.id),be.features.push(Ct)}}function Ki(be,W,Y,ge,Re,We){var Qe=ge*ge;if(ge>0&&W.size<(Re?Qe:ge))Y.numPoints+=W.length/3;else{for(var et=[],qe=0;qe<W.length;qe+=3)(ge===0||W[qe+2]>Qe)&&(Y.numSimplified++,et.push(W[qe]),et.push(W[qe+1])),Y.numPoints++;Re&&function(it,vt){for(var Vt=0,Ct=0,_n=it.length,q=_n-2;Ct<_n;q=Ct,Ct+=2)Vt+=(it[Ct]-it[q])*(it[Ct+1]+it[q+1]);if(Vt>0===vt)for(Ct=0,_n=it.length;Ct<_n/2;Ct+=2){var K=it[Ct],Be=it[Ct+1];it[Ct]=it[_n-2-Ct],it[Ct+1]=it[_n-1-Ct],it[_n-2-Ct]=K,it[_n-1-Ct]=Be}}(et,We),be.push(et)}}function _i(be,W){var Y=(W=this.options=function(Re,We){for(var Qe in We)Re[Qe]=We[Qe];return Re}(Object.create(this.options),W)).debug;if(Y&&console.time("preprocess data"),W.maxZoom<0||W.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(W.promoteId&&W.generateId)throw new Error("promoteId and generateId cannot be used together.");var ge=function(Re,We){var Qe=[];if(Re.type==="FeatureCollection")for(var et=0;et<Re.features.length;et++)hn(Qe,Re.features[et],We,et);else hn(Qe,Re.type==="Feature"?Re:{geometry:Re},We);return Qe}(be,W);this.tiles={},this.tileCoords=[],Y&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",W.indexMaxZoom,W.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ge=function(Re,We){var Qe=We.buffer/We.extent,et=Re,qe=sn(Re,1,-1-Qe,Qe,0,-1,2,We),it=sn(Re,1,1-Qe,2+Qe,0,-1,2,We);return(qe||it)&&(et=sn(Re,1,-Qe,1+Qe,0,-1,2,We)||[],qe&&(et=Gn(qe,1).concat(et)),it&&(et=et.concat(Gn(it,-1)))),et}(ge,W)).length&&this.splitTile(ge,0,0,0),Y&&(ge.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Hr(be,W,Y){return 32*((1<<be)*Y+W)+be}function ki(be,W){const Y=be.tileID.canonical;if(!this._geoJSONIndex)return W(null,null);const ge=this._geoJSONIndex.getTile(Y.z,Y.x,Y.y);if(!ge)return W(null,null);const Re=new G(ge.features);let We=te(Re);We.byteOffset===0&&We.byteLength===We.buffer.byteLength||(We=new Uint8Array(We)),W(null,{vectorTile:Re,rawData:We.buffer})}_i.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},_i.prototype.splitTile=function(be,W,Y,ge,Re,We,Qe){for(var et=[be,W,Y,ge],qe=this.options,it=qe.debug;et.length;){ge=et.pop(),Y=et.pop(),W=et.pop(),be=et.pop();var vt=1<<W,Vt=Hr(W,Y,ge),Ct=this.tiles[Vt];if(!Ct&&(it>1&&console.time("creation"),Ct=this.tiles[Vt]=Si(be,W,Y,ge,qe),this.tileCoords.push({z:W,x:Y,y:ge}),it)){it>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",W,Y,ge,Ct.numFeatures,Ct.numPoints,Ct.numSimplified),console.timeEnd("creation"));var _n="z"+W;this.stats[_n]=(this.stats[_n]||0)+1,this.total++}if(Ct.source=be,Re){if(W===qe.maxZoom||W===Re)continue;var q=1<<Re-W;if(Y!==Math.floor(We/q)||ge!==Math.floor(Qe/q))continue}else if(W===qe.indexMaxZoom||Ct.numPoints<=qe.indexMaxPoints)continue;if(Ct.source=null,be.length!==0){it>1&&console.time("clipping");var K,Be,Me,Tt,_t,Ot,rn=.5*qe.buffer/qe.extent,Pn=.5-rn,Ln=.5+rn,Mt=1+rn;K=Be=Me=Tt=null,_t=sn(be,vt,Y-rn,Y+Ln,0,Ct.minX,Ct.maxX,qe),Ot=sn(be,vt,Y+Pn,Y+Mt,0,Ct.minX,Ct.maxX,qe),be=null,_t&&(K=sn(_t,vt,ge-rn,ge+Ln,1,Ct.minY,Ct.maxY,qe),Be=sn(_t,vt,ge+Pn,ge+Mt,1,Ct.minY,Ct.maxY,qe),_t=null),Ot&&(Me=sn(Ot,vt,ge-rn,ge+Ln,1,Ct.minY,Ct.maxY,qe),Tt=sn(Ot,vt,ge+Pn,ge+Mt,1,Ct.minY,Ct.maxY,qe),Ot=null),it>1&&console.timeEnd("clipping"),et.push(K||[],W+1,2*Y,2*ge),et.push(Be||[],W+1,2*Y,2*ge+1),et.push(Me||[],W+1,2*Y+1,2*ge),et.push(Tt||[],W+1,2*Y+1,2*ge+1)}}},_i.prototype.getTile=function(be,W,Y){var ge=this.options,Re=ge.extent,We=ge.debug;if(be<0||be>24)return null;var Qe=1<<be,et=Hr(be,W=(W%Qe+Qe)%Qe,Y);if(this.tiles[et])return Wi(this.tiles[et],Re);We>1&&console.log("drilling down to z%d-%d-%d",be,W,Y);for(var qe,it=be,vt=W,Vt=Y;!qe&&it>0;)it--,vt=Math.floor(vt/2),Vt=Math.floor(Vt/2),qe=this.tiles[Hr(it,vt,Vt)];return qe&&qe.source?(We>1&&console.log("found parent tile z%d-%d-%d",it,vt,Vt),We>1&&console.time("drilling down"),this.splitTile(qe.source,it,vt,Vt,be,W,Y),We>1&&console.timeEnd("drilling down"),this.tiles[et]?Wi(this.tiles[et],Re):null):null};class Wr extends r.VectorTileWorkerSource{constructor(W,Y,ge,Re,We){super(W,Y,ge,Re,ki),We&&(this.loadGeoJSON=We)}loadData(W,Y){const ge=W&&W.request,Re=ge&&ge.collectResourceTiming;this.loadGeoJSON(W,(We,Qe)=>{if(We||!Qe)return Y(We);if(typeof Qe!="object")return Y(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`));{D(Qe,!0);try{if(W.filter){const qe=r.createExpression(W.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(qe.result==="error")throw new Error(qe.value.map(vt=>`${vt.key}: ${vt.message}`).join(", "));Qe={type:"FeatureCollection",features:Qe.features.filter(vt=>qe.value.evaluate({zoom:0},vt))}}this._geoJSONIndex=W.cluster?new rt(function({superclusterOptions:qe,clusterProperties:it}){if(!it||!qe)return qe;const vt={},Vt={},Ct={accumulated:null,zoom:0},_n={properties:null},q=Object.keys(it);for(const K of q){const[Be,Me]=it[K],Tt=r.createExpression(Me),_t=r.createExpression(typeof Be=="string"?[Be,["accumulated"],["get",K]]:Be);vt[K]=Tt.value,Vt[K]=_t.value}return qe.map=K=>{_n.properties=K;const Be={};for(const Me of q)Be[Me]=vt[Me].evaluate(Ct,_n);return Be},qe.reduce=(K,Be)=>{_n.properties=Be;for(const Me of q)Ct.accumulated=K[Me],K[Me]=Vt[Me].evaluate(Ct,_n)},qe}(W)).load(Qe.features):function(qe,it){return new _i(qe,it)}(Qe,W.geojsonVtOptions)}catch(qe){return Y(qe)}this.loaded={};const et={};if(Re){const qe=r.getPerformanceMeasurement(ge);qe&&(et.resourceTiming={},et.resourceTiming[W.source]=JSON.parse(JSON.stringify(qe)))}Y(null,et)}})}reloadTile(W,Y){const ge=this.loaded;return ge&&ge[W.uid]?super.reloadTile(W,Y):this.loadTile(W,Y)}loadGeoJSON(W,Y){if(W.request)r.getJSON(W.request,Y);else{if(typeof W.data!="string")return Y(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`));try{return Y(null,JSON.parse(W.data))}catch(ge){return Y(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(W,Y){try{Y(null,this._geoJSONIndex.getClusterExpansionZoom(W.clusterId))}catch(ge){Y(ge)}}getClusterChildren(W,Y){try{Y(null,this._geoJSONIndex.getChildren(W.clusterId))}catch(ge){Y(ge)}}getClusterLeaves(W,Y){try{Y(null,this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset))}catch(ge){Y(ge)}}}class Cr{constructor(W){this.self=W,this.actor=new r.Actor(W,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=r.getProjection({name:"mercator"}),this.workerSourceTypes={vector:r.VectorTileWorkerSource,geojson:Wr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Y,ge)=>{if(this.workerSourceTypes[Y])throw new Error(`Worker source with name "${Y}" already registered.`);this.workerSourceTypes[Y]=ge},this.self.registerRTLTextPlugin=Y=>{if(r.plugin.isParsed())throw new Error("RTL text plugin already registered.");r.plugin.applyArabicShaping=Y.applyArabicShaping,r.plugin.processBidirectionalText=Y.processBidirectionalText,r.plugin.processStyledBidirectionalText=Y.processStyledBidirectionalText}}clearCaches(W,Y,ge){delete this.layerIndexes[W],delete this.availableImages[W],delete this.workerSources[W],delete this.demWorkerSources[W],ge()}checkIfReady(W,Y,ge){ge()}setReferrer(W,Y){this.referrer=Y}spriteLoaded(W,Y){this.isSpriteLoaded[W]=Y;for(const ge in this.workerSources[W]){const Re=this.workerSources[W][ge];for(const We in Re)Re[We]instanceof r.VectorTileWorkerSource&&(Re[We].isSpriteLoaded=Y,Re[We].fire(new r.Event("isSpriteLoaded")))}}setImages(W,Y,ge){this.availableImages[W]=Y;for(const Re in this.workerSources[W]){const We=this.workerSources[W][Re];for(const Qe in We)We[Qe].availableImages=Y}ge()}enableTerrain(W,Y,ge){this.terrain=Y,ge()}setProjection(W,Y){this.projections[W]=r.getProjection(Y)}setLayers(W,Y,ge){this.getLayerIndex(W).replace(Y),ge()}updateLayers(W,Y,ge){this.getLayerIndex(W).update(Y.layers,Y.removedIds),ge()}loadTile(W,Y,ge){const Re=this.enableTerrain?r.extend({enableTerrain:this.terrain},Y):Y;Re.projection=this.projections[W]||this.defaultProjection,this.getWorkerSource(W,Y.type,Y.source).loadTile(Re,ge)}loadDEMTile(W,Y,ge){const Re=this.enableTerrain?r.extend({buildQuadTree:this.terrain},Y):Y;this.getDEMWorkerSource(W,Y.source).loadTile(Re,ge)}reloadTile(W,Y,ge){const Re=this.enableTerrain?r.extend({enableTerrain:this.terrain},Y):Y;Re.projection=this.projections[W]||this.defaultProjection,this.getWorkerSource(W,Y.type,Y.source).reloadTile(Re,ge)}abortTile(W,Y,ge){this.getWorkerSource(W,Y.type,Y.source).abortTile(Y,ge)}removeTile(W,Y,ge){this.getWorkerSource(W,Y.type,Y.source).removeTile(Y,ge)}removeSource(W,Y,ge){if(!this.workerSources[W]||!this.workerSources[W][Y.type]||!this.workerSources[W][Y.type][Y.source])return;const Re=this.workerSources[W][Y.type][Y.source];delete this.workerSources[W][Y.type][Y.source],Re.removeSource!==void 0?Re.removeSource(Y,ge):ge()}loadWorkerSource(W,Y,ge){try{this.self.importScripts(Y.url),ge()}catch(Re){ge(Re.toString())}}syncRTLPluginState(W,Y,ge){try{r.plugin.setState(Y);const Re=r.plugin.getPluginURL();if(r.plugin.isLoaded()&&!r.plugin.isParsed()&&Re!=null){this.self.importScripts(Re);const We=r.plugin.isParsed();ge(We?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Re}`),We)}}catch(Re){ge(Re.toString())}}getAvailableImages(W){let Y=this.availableImages[W];return Y||(Y=[]),Y}getLayerIndex(W){let Y=this.layerIndexes[W];return Y||(Y=this.layerIndexes[W]=new E),Y}getWorkerSource(W,Y,ge){return this.workerSources[W]||(this.workerSources[W]={}),this.workerSources[W][Y]||(this.workerSources[W][Y]={}),this.workerSources[W][Y][ge]||(this.workerSources[W][Y][ge]=new this.workerSourceTypes[Y]({send:(Re,We,Qe,et,qe,it)=>{this.actor.send(Re,We,Qe,W,qe,it)},scheduler:this.actor.scheduler},this.getLayerIndex(W),this.getAvailableImages(W),this.isSpriteLoaded[W])),this.workerSources[W][Y][ge]}getDEMWorkerSource(W,Y){return this.demWorkerSources[W]||(this.demWorkerSources[W]={}),this.demWorkerSources[W][Y]||(this.demWorkerSources[W][Y]=new M),this.demWorkerSources[W][Y]}enforceCacheSizeLimit(W,Y){r.enforceCacheSizeLimit(Y)}getWorkerPerformanceMetrics(W,Y,ge){ge(void 0,void 0)}}return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Cr(self)),Cr}),h(["./shared"],function(r){var v=b;function b(m){return!function(o){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,w,T=new Blob([""],{type:"text/javascript"}),A=URL.createObjectURL(T);try{w=new Worker(A),y=!0}catch(I){y=!1}return w&&w.terminate(),URL.revokeObjectURL(A),y}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var y=document.createElement("canvas");y.width=y.height=1;var w=y.getContext("2d");if(!w)return!1;var T=w.getImageData(0,0,1,1);return T&&T.width===y.width}()?(E[d=o&&o.failIfMajorPerformanceCaveat]===void 0&&(E[d]=function(y){var w,T=function(A){var I=document.createElement("canvas"),O=Object.create(b.webGLContextAttributes);return O.failIfMajorPerformanceCaveat=A,I.getContext("webgl2",O)||I.getContext("experimental-webgl",O)}(y);if(!T)return!1;try{w=T.createShader(T.VERTEX_SHADER)}catch(A){return!1}return!(!w||T.isContextLost())&&(T.shaderSource(w,"void main() {}"),T.compileShader(w),T.getShaderParameter(w,T.COMPILE_STATUS)===!0)}(d)),E[d]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var d}(m)}var E={};function M(m,o){if(Array.isArray(m)){if(!Array.isArray(o)||m.length!==o.length)return!1;for(let d=0;d<m.length;d++)if(!M(m[d],o[d]))return!1;return!0}if(typeof m=="object"&&m!==null&&o!==null){if(typeof o!="object"||Object.keys(m).length!==Object.keys(o).length)return!1;for(const d in m)if(!M(m[d],o[d]))return!1;return!0}return m===o}function D(m,o,d){const y=r.window.document.createElement(m);return o!==void 0&&(y.className=o),d&&d.appendChild(y),y}function L(m,o,d){const y=r.window.document.createElementNS("http://www.w3.org/2000/svg",m);for(const w of Object.keys(o))y.setAttributeNS(null,w,o[w]);return d&&d.appendChild(y),y}b.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const z=r.window.document&&r.window.document.documentElement.style,k=z&&z.userSelect!==void 0?"userSelect":"WebkitUserSelect";let F;function G(){z&&k&&(F=z[k],z[k]="none")}function X(){z&&k&&(z[k]=F)}function re(m){m.preventDefault(),m.stopPropagation(),r.window.removeEventListener("click",re,!0)}function ue(){r.window.addEventListener("click",re,!0),r.window.setTimeout(()=>{r.window.removeEventListener("click",re,!0)},0)}function $(m,o){const d=m.getBoundingClientRect();return ie(m,d,o)}function te(m,o){const d=m.getBoundingClientRect(),y=[];for(let w=0;w<o.length;w++)y.push(ie(m,d,o[w]));return y}function oe(m){return r.window.InstallTrigger!==void 0&&m.button===2&&m.ctrlKey&&r.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:m.button}function ie(m,o,d){const y=m.offsetWidth===o.width?1:m.offsetWidth/o.width;return new r.pointGeometry((d.clientX-o.left)*y,(d.clientY-o.top)*y)}function se(m,o){var d=o[0],y=o[1],w=o[2],T=o[3],A=d*T-w*y;return A?(m[0]=T*(A=1/A),m[1]=-y*A,m[2]=-w*A,m[3]=d*A,m):null}function pe(m){const{userImage:o}=m;return!!(o&&o.render&&o.render())&&(m.data.replace(new Uint8Array(o.data.buffer)),!0)}class me extends r.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new r.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:d,callback:y}of this.requestors)this._notify(d,y);this.requestors=[]}}hasImage(o){return!!this.getImage(o)}getImage(o){return this.images[o]}addImage(o,d){this._validate(o,d)&&(this.images[o]=d)}_validate(o,d){let y=!0;return this._validateStretch(d.stretchX,d.data&&d.data.width)||(this.fire(new r.ErrorEvent(new Error(`Image "${o}" has invalid "stretchX" value`))),y=!1),this._validateStretch(d.stretchY,d.data&&d.data.height)||(this.fire(new r.ErrorEvent(new Error(`Image "${o}" has invalid "stretchY" value`))),y=!1),this._validateContent(d.content,d)||(this.fire(new r.ErrorEvent(new Error(`Image "${o}" has invalid "content" value`))),y=!1),y}_validateStretch(o,d){if(!o)return!0;let y=0;for(const w of o){if(w[0]<y||w[1]<w[0]||d<w[1])return!1;y=w[1]}return!0}_validateContent(o,d){return!(o&&(o.length!==4||o[0]<0||d.data.width<o[0]||o[1]<0||d.data.height<o[1]||o[2]<0||d.data.width<o[2]||o[3]<0||d.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))}updateImage(o,d){d.version=this.images[o].version+1,this.images[o]=d,this.updatedImages[o]=!0}removeImage(o){const d=this.images[o];delete this.images[o],delete this.patterns[o],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o,d){let y=!0;if(!this.isLoaded())for(const w of o)this.images[w]||(y=!1);this.isLoaded()||y?this._notify(o,d):this.requestors.push({ids:o,callback:d})}_notify(o,d){const y={};for(const w of o){this.images[w]||this.fire(new r.Event("styleimagemissing",{id:w}));const T=this.images[w];T?y[w]={data:T.data.clone(),pixelRatio:T.pixelRatio,sdf:T.sdf,version:T.version,stretchX:T.stretchX,stretchY:T.stretchY,content:T.content,hasRenderCallback:!!(T.userImage&&T.userImage.render)}:r.warnOnce(`Image "${w}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}d(null,y)}getPixelSize(){const{width:o,height:d}=this.atlasImage;return{width:o,height:d}}getPattern(o){const d=this.patterns[o],y=this.getImage(o);if(!y)return null;if(d&&d.position.version===y.version)return d.position;if(d)d.position.version=y.version;else{const w={w:y.data.width+2,h:y.data.height+2,x:0,y:0},T=new r.ImagePosition(w,y);this.patterns[o]={bin:w,position:T}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const d=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new r.Texture(o,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const T in this.patterns)o.push(this.patterns[T].bin);const{w:d,h:y}=r.potpack(o),w=this.atlasImage;w.resize({width:d||1,height:y||1});for(const T in this.patterns){const{bin:A}=this.patterns[T],I=A.x+1,O=A.y+1,U=this.images[T].data,V=U.width,j=U.height;r.RGBAImage.copy(U,w,{x:0,y:0},{x:I,y:O},{width:V,height:j}),r.RGBAImage.copy(U,w,{x:0,y:j-1},{x:I,y:O-1},{width:V,height:1}),r.RGBAImage.copy(U,w,{x:0,y:0},{x:I,y:O+j},{width:V,height:1}),r.RGBAImage.copy(U,w,{x:V-1,y:0},{x:I-1,y:O},{width:1,height:j}),r.RGBAImage.copy(U,w,{x:0,y:0},{x:I+V,y:O},{width:1,height:j})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const d of o){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const y=this.images[d];pe(y)&&this.updateImage(d,y)}}}const he=new r.Properties({anchor:new r.DataConstantProperty(r.spec.light.anchor),position:new class{constructor(){this.specification=r.spec.light.position}possiblyEvaluate(m,o){return function([d,y,w]){const T=r.degToRad(y+90),A=r.degToRad(w);return{x:d*Math.cos(T)*Math.sin(A),y:d*Math.sin(T)*Math.sin(A),z:d*Math.cos(A),azimuthal:y,polar:w}}(m.expression.evaluate(o))}interpolate(m,o,d){return{x:r.number(m.x,o.x,d),y:r.number(m.y,o.y,d),z:r.number(m.z,o.z,d),azimuthal:r.number(m.azimuthal,o.azimuthal,d),polar:r.number(m.polar,o.polar,d)}}},color:new r.DataConstantProperty(r.spec.light.color),intensity:new r.DataConstantProperty(r.spec.light.intensity)}),Ue="-transition";class Ve extends r.Evented{constructor(o){super(),this._transitionable=new r.Transitionable(he),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,d={}){if(!this._validate(r.validateLight,o,d))for(const y in o){const w=o[y];r.endsWith(y,Ue)?this._transitionable.setTransition(y.slice(0,-Ue.length),w):this._transitionable.setValue(y,w)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,d,y){return(!y||y.validate!==!1)&&r.emitValidationErrors(this,o.call(r.validateStyle,r.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:r.spec})))}}const $e=new r.Properties({source:new r.DataConstantProperty(r.spec.terrain.source),exaggeration:new r.DataConstantProperty(r.spec.terrain.exaggeration)}),ct="-transition";class At extends r.Evented{constructor(o,d){super(),this._transitionable=new r.Transitionable($e),this.set(o),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=d}get(){return this._transitionable.serialize()}set(o){for(const d in o){const y=o[d];r.endsWith(d,ct)?this._transitionable.setTransition(d.slice(0,-ct.length),y):this._transitionable.setValue(d,y)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}}function yt(m,o,d,y){const w=r.smoothstep(45,65,d),[T,A]=St(m,y),I=r.length(o);let O=1-Math.min(1,Math.exp((I-T)/(A-T)*-6));return O*=O*O,O=Math.min(1,1.00747*O),O*w*m.alpha}function St(m,o){const d=.5/Math.tan(.5*o);return[m.range[0]+d,m.range[1]+d]}const It=new r.Properties({range:new r.DataConstantProperty(r.spec.fog.range),color:new r.DataConstantProperty(r.spec.fog.color),"horizon-blend":new r.DataConstantProperty(r.spec.fog["horizon-blend"])}),Nt="-transition";class Ie extends r.Evented{constructor(o,d){super(),this._transitionable=new r.Transitionable(It),this.set(o),this._transitioning=this._transitionable.untransitioned(),this._transform=d}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(o,d={}){if(!this._validate(r.validateFog,o,d))for(const y in o){const w=o[y];r.endsWith(y,Nt)?this._transitionable.setTransition(y.slice(0,-Nt.length),w):this._transitionable.setValue(y,w)}}getOpacity(o){if(!this._transform.projection.supportsFog)return 0;const d=this.properties&&this.properties.get("color")||1;return r.smoothstep(45,65,o)*d.a}getOpacityAtLatLng(o,d){return this._transform.projection.supportsFog?function(y,w,T){const A=r.MercatorCoordinate.fromLngLat(w),I=T.elevation?T.elevation.getAtPointOrZero(A):0,O=[A.x,A.y,I];return r.transformMat4(O,O,T.mercatorFogMatrix),yt(y,O,T.pitch,T._fov)}(this.state,o,d):0}getFovAdjustedRange(o){return this._transform.projection.supportsFog?St(this.state,o):[0,1]}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,d,y){return(!y||y.validate!==!1)&&r.emitValidationErrors(this,o.call(r.validateStyle,r.extend({value:d,style:{glyphs:!0,sprite:!0},styleSpec:r.spec})))}}class xe{constructor(o,d){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=r.uniqueId();const y=this.workerPool.acquire(this.id);for(let w=0;w<y.length;w++){const T=new xe.Actor(y[w],d,this.id);T.name=`Worker ${w}`,this.actors.push(T)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(o,d,y){r.asyncAll(this.actors,(w,T)=>{w.send(o,d,T)},y=y||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(o=>{o.remove()}),this.actors=[],this.workerPool.release(this.id)}}function He(m,o,d){return o*(r.EXTENT/(m.tileSize*Math.pow(2,d-m.tileID.overscaledZ)))}xe.Actor=r.Actor;class Ge{constructor(o,d,y,w){this.screenBounds=o,this.cameraPoint=d,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=y,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(T=>w.pointCoordinate3D(T)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(o,d){let y,w;if(o instanceof r.pointGeometry||typeof o[0]=="number"){const T=r.pointGeometry.convert(o);y=[r.pointGeometry.convert(o)],w=d.isPointAboveHorizon(T)}else{const T=r.pointGeometry.convert(o[0]),A=r.pointGeometry.convert(o[1]);y=[T,A],w=r.polygonizeBounds(T,A).every(I=>d.isPointAboveHorizon(I))}return new Ge(y,d.getCameraPoint(),w,d)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(o){return r.polygonizeBounds(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],o)}bufferedCameraGeometry(o){const d=this.screenBounds[0],y=this.screenBounds.length===1?this.screenBounds[0].add(new r.pointGeometry(1,1)):this.screenBounds[1],w=r.polygonizeBounds(d,y,0,!1);return this.cameraPoint.y>y.y&&(this.cameraPoint.x>d.x&&this.cameraPoint.x<y.x?w.splice(3,0,this.cameraPoint):this.cameraPoint.x>=y.x?w[2]=this.cameraPoint:this.cameraPoint.x<=d.x&&(w[3]=this.cameraPoint)),r.bufferConvexPolygon(w,o)}containsTile(o,d,y){const w=o.queryPadding+1,T=o.tileID.wrap,A=y?this._bufferedCameraMercator(w,d).map(ae=>r.getTilePoint(o.tileTransform,ae,T)):this._bufferedScreenMercator(w,d).map(ae=>r.getTilePoint(o.tileTransform,ae,T)),I=this.screenGeometryMercator.map(ae=>r.getTileVec3(o.tileTransform,ae,T)),O=I.map(ae=>new r.pointGeometry(ae[0],ae[1])),U=d.getFreeCameraOptions().position||new r.MercatorCoordinate(0,0,0),V=r.getTileVec3(o.tileTransform,U,T),j=I.map(ae=>{const J=r.sub(ae,ae,V);return r.normalize(J,J),new r.Ray(V,J)}),ee=He(o,1,d.zoom);if(r.polygonIntersectsBox(A,0,0,r.EXTENT,r.EXTENT))return{queryGeometry:this,tilespaceGeometry:O,tilespaceRays:j,bufferedTilespaceGeometry:A,bufferedTilespaceBounds:(ce=r.getBounds(A),ce.min.x=r.clamp(ce.min.x,0,r.EXTENT),ce.min.y=r.clamp(ce.min.y,0,r.EXTENT),ce.max.x=r.clamp(ce.max.x,0,r.EXTENT),ce.max.y=r.clamp(ce.max.y,0,r.EXTENT),ce),tile:o,tileID:o.tileID,pixelToTileUnitsFactor:ee};var ce}_bufferedScreenMercator(o,d){const y=ze(o);if(this._screenRaycastCache[y])return this._screenRaycastCache[y];{const w=this.bufferedScreenGeometry(o).map(T=>d.pointCoordinate3D(T));return this._screenRaycastCache[y]=w,w}}_bufferedCameraMercator(o,d){const y=ze(o);if(this._cameraRaycastCache[y])return this._cameraRaycastCache[y];{const w=this.bufferedCameraGeometry(o).map(T=>d.pointCoordinate3D(T));return this._cameraRaycastCache[y]=w,w}}}function ze(m){return 100*m|0}function rt(m,o,d){const y=function(w,T){if(w)return d(w);if(T){const A=r.pick(r.extend(T,m),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);T.vector_layers&&(A.vectorLayers=T.vector_layers,A.vectorLayerIds=A.vectorLayers.map(I=>I.id)),A.tiles=o.canonicalizeTileset(A,m.url),d(null,A)}};return m.url?r.getJSON(o.transformRequest(o.normalizeSourceURL(m.url),r.ResourceType.Source),y):r.exported.frame(()=>y(null,m))}class fe{constructor(o,d,y){this.bounds=r.LngLatBounds.convert(this.validateBounds(o)),this.minzoom=d||0,this.maxzoom=y||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const d=Math.pow(2,o.z),y=Math.floor(r.mercatorXfromLng(this.bounds.getWest())*d),w=Math.floor(r.mercatorYfromLat(this.bounds.getNorth())*d),T=Math.ceil(r.mercatorXfromLng(this.bounds.getEast())*d),A=Math.ceil(r.mercatorYfromLat(this.bounds.getSouth())*d);return o.x>=y&&o.x<T&&o.y>=w&&o.y<A}}class Ee{constructor(o,d,y){this.context=o;const w=o.gl;this.buffer=w.createBuffer(),this.dynamicDraw=!!y,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||d.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const d=this.context.gl;this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ce={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class ye{constructor(o,d,y,w){this.length=d.length,this.attributes=y,this.itemSize=d.bytesPerElement,this.dynamicDraw=w,this.context=o;const T=o.gl;this.buffer=T.createBuffer(),o.bindVertexBuffer.set(this.buffer),T.bufferData(T.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||d.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,d){for(let y=0;y<this.attributes.length;y++){const w=d.attributes[this.attributes[y].name];w!==void 0&&o.enableVertexAttribArray(w)}}setVertexAttribPointers(o,d,y){for(let w=0;w<this.attributes.length;w++){const T=this.attributes[w],A=d.attributes[T.name];A!==void 0&&o.vertexAttribPointer(A,T.components,o[Ce[T.type]],!1,this.itemSize,T.offset+this.itemSize*(y||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Oe{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Ke extends Oe{getDefault(){return r.Color.transparent}set(o){const d=this.current;(o.r!==d.r||o.g!==d.g||o.b!==d.b||o.a!==d.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class st extends Oe{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class wt extends Oe{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class Gt extends Oe{getDefault(){return[!0,!0,!0,!0]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class de extends Oe{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class we extends Oe{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class bt extends Oe{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const d=this.current;(o.func!==d.func||o.ref!==d.ref||o.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class gt extends Oe{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class bn extends Oe{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=o,this.dirty=!1}}class hn extends Oe{getDefault(){return[0,1]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class nn extends Oe{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=o,this.dirty=!1}}class pn extends Oe{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class wn extends Oe{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.BLEND):d.disable(d.BLEND),this.current=o,this.dirty=!1}}class cn extends Oe{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class Ht extends Oe{getDefault(){return r.Color.transparent}set(o){const d=this.current;(o.r!==d.r||o.g!==d.g||o.b!==d.b||o.a!==d.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class sn extends Oe{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class Zt extends Oe{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;o?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=o,this.dirty=!1}}class Ze extends Oe{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class Ut extends Oe{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class en extends Oe{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class Dn extends Oe{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class fn extends Oe{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const d=this.current;(o[0]!==d[0]||o[1]!==d[1]||o[2]!==d[2]||o[3]!==d[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class On extends Oe{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class Gn extends Oe{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class qn extends Oe{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class Wi extends Oe{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Nn extends Oe{getDefault(){return null}set(o){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Si extends Oe{constructor(o){super(o),this.vao=o.extVertexArrayObject}getDefault(){return null}set(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)}}class ei extends Oe{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class Ki extends Oe{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class _i extends Oe{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class Hr extends Oe{constructor(o,d){super(o),this.context=o,this.parent=d}getDefault(){return null}}class ki extends Hr{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Wr extends Hr{attachment(){return this.gl.DEPTH_ATTACHMENT}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,this.attachment(),d.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Cr extends Wr{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class be{constructor(o,d,y,w){this.context=o,this.width=d,this.height=y;const T=this.framebuffer=o.gl.createFramebuffer();this.colorAttachment=new ki(o,T),w&&(this.depthAttachment=new Wr(o,T))}destroy(){const o=this.context.gl,d=this.colorAttachment.get();if(d&&o.deleteTexture(d),this.depthAttachment){const y=this.depthAttachment.get();y&&o.deleteRenderbuffer(y)}o.deleteFramebuffer(this.framebuffer)}}class W{constructor(o){this.gl=o,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Ke(this),this.clearDepth=new st(this),this.clearStencil=new wt(this),this.colorMask=new Gt(this),this.depthMask=new de(this),this.stencilMask=new we(this),this.stencilFunc=new bt(this),this.stencilOp=new gt(this),this.stencilTest=new bn(this),this.depthRange=new hn(this),this.depthTest=new nn(this),this.depthFunc=new pn(this),this.blend=new wn(this),this.blendFunc=new cn(this),this.blendColor=new Ht(this),this.blendEquation=new sn(this),this.cullFace=new Zt(this),this.cullFaceSide=new Ze(this),this.frontFace=new Ut(this),this.program=new en(this),this.activeTexture=new Dn(this),this.viewport=new fn(this),this.bindFramebuffer=new On(this),this.bindRenderbuffer=new Gn(this),this.bindTexture=new qn(this),this.bindVertexBuffer=new Wi(this),this.bindElementBuffer=new Nn(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Si(this),this.pixelStoreUnpack=new ei(this),this.pixelStoreUnpackPremultiplyAlpha=new Ki(this),this.pixelStoreUnpackFlipY=new _i(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=o.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(o.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=o.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=o.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,d){return new Ee(this,o,d)}createVertexBuffer(o,d,y){return new ye(this,o,d,y)}createRenderbuffer(o,d,y){const w=this.gl,T=w.createRenderbuffer();return this.bindRenderbuffer.set(T),w.renderbufferStorage(w.RENDERBUFFER,o,d,y),this.bindRenderbuffer.set(null),T}createFramebuffer(o,d,y){return new be(this,o,d,y)}clear({color:o,depth:d,stencil:y}){const w=this.gl;let T=0;o&&(T|=w.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),d!==void 0&&(T|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),y!==void 0&&(T|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),w.clear(T)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){M(o.blendFunction,r.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Y extends r.Evented{constructor(o,d,y,w){super(),this.id=o,this.dispatcher=y,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=r.extend({type:"raster"},d),r.extend(this,r.pick(d,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new r.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=rt(this._options,this.map._requestManager,(o,d)=>{this._tileJSONRequest=null,this._loaded=!0,o?this.fire(new r.ErrorEvent(o)):d&&(r.extend(this,d),d.bounds&&(this.tileBounds=new fe(d.bounds,this.minzoom,this.maxzoom)),r.postTurnstileEvent(d.tiles),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return r.extend({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o,d){const y=r.exported.devicePixelRatio>=2,w=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),y,this.tileSize);o.request=r.getImage(this.map._requestManager.transformRequest(w,r.ResourceType.Tile),(T,A,I,O)=>(delete o.request,o.aborted?(o.state="unloaded",d(null)):T?(o.state="errored",d(T)):A?(this.map._refreshExpiredTiles&&o.setExpiryData({cacheControl:I,expires:O}),o.setTexture(A,this.map.painter),o.state="loaded",r.cacheEntryPossiblyAdded(this.dispatcher),void d(null)):d(null)))}static loadTileData(o,d,y){o.setTexture(d,y)}static unloadTileData(o,d){o.texture&&d.saveTileTexture(o.texture)}abortTile(o,d){o.request&&(o.request.cancel(),delete o.request),d()}unloadTile(o,d){o.texture&&this.map.painter.saveTileTexture(o.texture),d()}hasTransition(){return!1}}let ge;function Re(m,o,d,y,w,T,A,I){const O=[m,d,w,o,y,T,1,1,1],U=[A,I,1],V=r.adjoint([],O),[j,ee,ce]=r.transformMat3(U,U,r.transpose(V,V));return r.multiply(O,[j,0,0,0,ee,0,0,0,ce],O)}class We extends r.Evented{constructor(o,d,y,w){super(),this.id=o,this.dispatcher=y,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=d}load(o){this._loaded=!1,this.fire(new r.Event("dataloading",{dataType:"source"})),this.url=this.options.url,r.getImage(this.map._requestManager.transformRequest(this.url,r.ResourceType.Image),(d,y)=>{if(this._loaded=!0,d)this.fire(new r.ErrorEvent(d));else if(y){const{HTMLImageElement:w}=r.window;this.image=y instanceof w?r.exported.getImageData(y):y,this.width=this.image.width,this.height=this.image.height,o&&(this.coordinates=o),this._finishLoading()}})}loaded(){return this._loaded}updateImage(o){return this.image&&o.url?(this.options.url=o.url,this.load(o.coordinates),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(o){this.coordinates=o,this._boundsArray=void 0;const d=o.map(r.MercatorCoordinate.fromLngLat);return this.tileID=function(y){let w=1/0,T=1/0,A=-1/0,I=-1/0;for(const j of y)w=Math.min(w,j.x),T=Math.min(T,j.y),A=Math.max(A,j.x),I=Math.max(I,j.y);const O=Math.max(A-w,I-T),U=Math.max(0,Math.floor(-Math.log(O)/Math.LN2)),V=Math.pow(2,U);return new r.CanonicalTileID(U,Math.floor((w+A)/2*V),Math.floor((T+I)/2*V))}(d),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new r.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(o){for(const O in this.tiles){const U=this.tiles[O];U.state!=="loaded"&&(U.state="loaded",U.texture=this.texture)}if(this._boundsArray)return;const d=r.tileTransform(this.tileID,this.map.transform.projection),[y,w,T,A]=this.coordinates.map(O=>{const U=d.projection.project(O[0],O[1]);return r.getTilePoint(d,U)._round()});this.perspectiveTransform=function(O,U,V,j,ee,ce,ae,J,Pe,_e){const Ae=Re(0,0,O,0,0,U,O,U),De=Re(V,j,ee,ce,ae,J,Pe,_e);return r.multiply(De,r.adjoint(Ae,Ae),De),[De[6]/De[8]*O/r.EXTENT,De[7]/De[8]*U/r.EXTENT]}(this.width,this.height,y.x,y.y,w.x,w.y,A.x,A.y,T.x,T.y);const I=this._boundsArray=new r.StructArrayLayout4i8;I.emplaceBack(y.x,y.y,0,0),I.emplaceBack(w.x,w.y,r.EXTENT,0),I.emplaceBack(A.x,A.y,0,r.EXTENT),I.emplaceBack(T.x,T.y,r.EXTENT,r.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=o.createVertexBuffer(I,r.boundsAttributes.members),this.boundsSegments=r.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const o=this.map.painter.context,d=o.gl;this.texture?this.texture.update(this.image):(this.texture=new r.Texture(o,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE)),this._prepareData(o)}loadTile(o,d){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},d(null)):(o.state="errored",d(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Qe={vector:class extends r.Evented{constructor(m,o,d,y){if(super(),this.id=m,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,r.extend(this,r.pick(o,["url","scheme","tileSize","promoteId"])),this._options=r.extend({type:"vector"},o),this._collectResourceTiming=o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new r.DedupedRequest}load(){this._loaded=!1,this.fire(new r.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=rt(this._options,this.map._requestManager,(m,o)=>{this._tileJSONRequest=null,this._loaded=!0,m?this.fire(new r.ErrorEvent(m)):o&&(r.extend(this,o),o.bounds&&(this.tileBounds=new fe(o.bounds,this.minzoom,this.maxzoom)),r.postTurnstileEvent(o.tiles,this.map._requestManager._customAccessToken),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(m){return!this.tileBounds||this.tileBounds.contains(m.canonical)}onAdd(m){this.map=m,this.load()}setSourceProperty(m){this._tileJSONRequest&&this._tileJSONRequest.cancel(),m();const o=this.map.style._getSourceCaches(this.id);for(const d of o)d.clearTiles();this.load()}setTiles(m){return this.setSourceProperty(()=>{this._options.tiles=m}),this}setUrl(m){return this.setSourceProperty(()=>{this.url=m,this._options.url=m}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return r.extend({},this._options)}loadTile(m,o){const d=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme)),y={request:this.map._requestManager.transformRequest(d,r.ResourceType.Tile),data:void 0,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,tileSize:this.tileSize*m.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:r.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:m.isSymbolTile};if(y.request.collectResourceTiming=this._collectResourceTiming,m.actor&&m.state!=="expired")m.state==="loading"?m.reloadCallback=o:m.request=m.actor.send("reloadTile",y,w.bind(this));else if(m.actor=this._tileWorkers[d]=this._tileWorkers[d]||this.dispatcher.getActor(),this.dispatcher.ready)m.request=m.actor.send("loadTile",y,w.bind(this),void 0,!0);else{const T=r.loadVectorTile.call({deduped:this._deduped},y,(A,I)=>{A||!I?w.call(this,A):(y.data={cacheControl:I.cacheControl,expires:I.expires,rawData:I.rawData.slice(0)},m.actor&&m.actor.send("loadTile",y,w.bind(this),void 0,!0))},!0);m.request={cancel:T}}function w(T,A){return delete m.request,m.aborted?o(null):T&&T.status!==404?o(T):(A&&A.resourceTiming&&(m.resourceTiming=A.resourceTiming),this.map._refreshExpiredTiles&&A&&m.setExpiryData(A),m.loadVectorData(A,this.map.painter),r.cacheEntryPossiblyAdded(this.dispatcher),o(null),void(m.reloadCallback&&(this.loadTile(m,m.reloadCallback),m.reloadCallback=null)))}}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.actor&&m.actor.send("abortTile",{uid:m.uid,type:this.type,source:this.id})}unloadTile(m){m.unloadVectorData(),m.actor&&m.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:Y,"raster-dem":class extends Y{constructor(m,o,d,y){super(m,o,d,y),this.type="raster-dem",this.maxzoom=22,this._options=r.extend({type:"raster-dem"},o),this.encoding=o.encoding||"mapbox"}loadTile(m,o){const d=this.map._requestManager.normalizeTileURL(m.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function y(w,T){w&&(m.state="errored",o(w)),T&&(m.dem=T,m.dem.onDeserialize(),m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0,m.state="loaded",o(null))}m.request=r.getImage(this.map._requestManager.transformRequest(d,r.ResourceType.Tile),function(w,T,A,I){if(delete m.request,m.aborted)m.state="unloaded",o(null);else if(w)m.state="errored",o(w);else if(T){this.map._refreshExpiredTiles&&m.setExpiryData({cacheControl:A,expires:I});const O=r.window.ImageBitmap&&T instanceof r.window.ImageBitmap&&(ge==null&&(ge=r.window.OffscreenCanvas&&new r.window.OffscreenCanvas(1,1).getContext("2d")&&typeof r.window.createImageBitmap=="function"),ge),U=1-(T.width-r.prevPowerOfTwo(T.width))/2;U<1||m.neighboringTiles||(m.neighboringTiles=this._getNeighboringTiles(m.tileID));const V=O?T:r.exported.getImageData(T,U),j={uid:m.uid,coord:m.tileID,source:this.id,rawImageData:V,encoding:this.encoding,padding:U};m.actor&&m.state!=="expired"||(m.actor=this.dispatcher.getActor(),m.actor.send("loadDEMTile",j,y.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(m){const o=m.canonical,d=Math.pow(2,o.z),y=(o.x-1+d)%d,w=o.x===0?m.wrap-1:m.wrap,T=(o.x+1+d)%d,A=o.x+1===d?m.wrap+1:m.wrap,I={};return I[new r.OverscaledTileID(m.overscaledZ,w,o.z,y,o.y).key]={backfilled:!1},I[new r.OverscaledTileID(m.overscaledZ,A,o.z,T,o.y).key]={backfilled:!1},o.y>0&&(I[new r.OverscaledTileID(m.overscaledZ,w,o.z,y,o.y-1).key]={backfilled:!1},I[new r.OverscaledTileID(m.overscaledZ,m.wrap,o.z,o.x,o.y-1).key]={backfilled:!1},I[new r.OverscaledTileID(m.overscaledZ,A,o.z,T,o.y-1).key]={backfilled:!1}),o.y+1<d&&(I[new r.OverscaledTileID(m.overscaledZ,w,o.z,y,o.y+1).key]={backfilled:!1},I[new r.OverscaledTileID(m.overscaledZ,m.wrap,o.z,o.x,o.y+1).key]={backfilled:!1},I[new r.OverscaledTileID(m.overscaledZ,A,o.z,T,o.y+1).key]={backfilled:!1}),I}unloadTile(m){m.demTexture&&this.map.painter.saveTileTexture(m.demTexture),m.fbo&&(m.fbo.destroy(),delete m.fbo),m.dem&&delete m.dem,delete m.neighboringTiles,m.state="unloaded"}},geojson:class extends r.Evented{constructor(m,o,d,y){super(),this.id=m,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=d.getActor(),this.setEventedParent(y),this._data=o.data,this._options=r.extend({},o),this._collectResourceTiming=o.collectResourceTiming,o.maxzoom!==void 0&&(this.maxzoom=o.maxzoom),o.type&&(this.type=o.type),o.attribution&&(this.attribution=o.attribution),this.promoteId=o.promoteId;const w=r.EXTENT/this.tileSize;this.workerOptions=r.extend({source:this.id,cluster:o.cluster||!1,geojsonVtOptions:{buffer:(o.buffer!==void 0?o.buffer:128)*w,tolerance:(o.tolerance!==void 0?o.tolerance:.375)*w,extent:r.EXTENT,maxZoom:this.maxzoom,lineMetrics:o.lineMetrics||!1,generateId:o.generateId||!1},superclusterOptions:{maxZoom:o.clusterMaxZoom!==void 0?o.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,o.clusterMinPoints||2),extent:r.EXTENT,radius:(o.clusterRadius!==void 0?o.clusterRadius:50)*w,log:!1,generateId:o.generateId||!1},clusterProperties:o.clusterProperties,filter:o.filter},o.workerOptions)}onAdd(m){this.map=m,this.setData(this._data)}setData(m){return this._data=m,this._updateWorkerData(),this}getClusterExpansionZoom(m,o){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:m,source:this.id},o),this}getClusterChildren(m,o){return this.actor.send("geojson.getClusterChildren",{clusterId:m,source:this.id},o),this}getClusterLeaves(m,o,d,y){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:m,limit:o,offset:d},y),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new r.Event("dataloading",{dataType:"source"})),this._loaded=!1;const m=r.extend({},this.workerOptions),o=this._data;typeof o=="string"?(m.request=this.map._requestManager.transformRequest(r.exported.resolveURL(o),r.ResourceType.Source),m.request.collectResourceTiming=this._collectResourceTiming):m.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,m,(d,y)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new r.ErrorEvent(d));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&y&&y.resourceTiming&&y.resourceTiming[this.id]&&(w.resourceTiming=y.resourceTiming[this.id]),this.fire(new r.Event("data",w)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(m,o){const d=m.actor?"reloadTile":"loadTile";m.actor=this.actor,m.request=this.actor.send(d,{type:this.type,uid:m.uid,tileID:m.tileID,tileZoom:m.tileZoom,zoom:m.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:r.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(y,w)=>(delete m.request,m.unloadVectorData(),m.aborted?o(null):y?o(y):(m.loadVectorData(w,this.map.painter,d==="reloadTile"),o(null))),void 0,d==="loadTile")}abortTile(m){m.request&&(m.request.cancel(),delete m.request),m.aborted=!0}unloadTile(m){m.unloadVectorData(),this.actor.send("removeTile",{uid:m.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return r.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends We{constructor(m,o,d,y){super(m,o,d,y),this.roundZoom=!0,this.type="video",this.options=o}load(){this._loaded=!1;const m=this.options;this.urls=[];for(const o of m.urls)this.urls.push(this.map._requestManager.transformRequest(o,r.ResourceType.Source).url);r.getVideo(this.urls,(o,d)=>{this._loaded=!0,o?this.fire(new r.ErrorEvent(o)):d&&(this.video=d,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(m){if(this.video){const o=this.video.seekable;m<o.start(0)||m>o.end(0)?this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${o.start(0)} and ${o.end(0)}-second mark.`))):this.video.currentTime=m}}getVideo(){return this.video}onAdd(m){this.map||(this.map=m,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const m=this.map.painter.context,o=m.gl;this.texture?this.video.paused||(this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),o.texSubImage2D(o.TEXTURE_2D,0,0,0,o.RGBA,o.UNSIGNED_BYTE,this.video)):(this.texture=new r.Texture(m,this.video,o.RGBA),this.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(m)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:We,canvas:class extends We{constructor(m,o,d,y){super(m,o,d,y),o.coordinates?Array.isArray(o.coordinates)&&o.coordinates.length===4&&!o.coordinates.some(w=>!Array.isArray(w)||w.length!==2||w.some(T=>typeof T!="number"))||this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${m}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${m}`,null,'missing required property "coordinates"'))),o.animate&&typeof o.animate!="boolean"&&this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${m}`,null,'optional "animate" property must be a boolean value'))),o.canvas?typeof o.canvas=="string"||o.canvas instanceof r.window.HTMLCanvasElement||this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${m}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new r.ErrorEvent(new r.ValidationError(`sources.${m}`,null,'missing required property "canvas"'))),this.options=o,this.animate=o.animate===void 0||o.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof r.window.HTMLCanvasElement?this.options.canvas:r.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new r.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(m){this.map=m,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let m=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,m=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,m=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const o=this.map.painter.context;this.texture?(m||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new r.Texture(o,this.canvas,o.gl.RGBA,{premultiply:!0}),this._prepareData(o)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const m of[this.canvas.width,this.canvas.height])if(isNaN(m)||m<=0)return!0;return!1}},custom:class extends r.Evented{constructor(m,o,d,y){super(),this.id=m,this.type="custom",this._dataType="raster",this._dispatcher=d,this._implementation=o,this.setEventedParent(y),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new r.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new r.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new fe(this._implementation.bounds,this.minzoom,this.maxzoom)),o.update=this._update.bind(this),o.coveringTiles=this._coveringTiles.bind(this),r.extend(this,r.pick(o,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return r.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new r.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new r.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(m){this._map=m,this._loaded=!1,this.fire(new r.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(m),this.load()}onRemove(m){this._implementation.onRemove&&this._implementation.onRemove(m)}hasTile(m){if(this._implementation.hasTile){const{x:o,y:d,z:y}=m.canonical;return this._implementation.hasTile({x:o,y:d,z:y})}return!this.tileBounds||this.tileBounds.contains(m.canonical)}loadTile(m,o){const{x:d,y,z:w}=m.tileID.canonical,T=new r.window.AbortController,A=this._implementation.loadTile({x:d,y,z:w},{signal:T.signal});if(!A)return this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",o(null);A.cancel=()=>T.abort(),m.request=A.then(function(I){return delete m.request,m.aborted?(m.state="unloaded",o(null)):I?function(O){return O instanceof r.window.ImageData||O instanceof r.window.ImageBitmap||O instanceof r.window.HTMLCanvasElement}(I)?(this.loadTileData(m,I),m.state="loaded",void o(null)):(m.state="errored",o(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(m,{width:this.tileSize,height:this.tileSize,data:null}),m.state="loaded",o(null))}.bind(this)).catch(I=>{I.code!==20&&(m.state="errored",o(I))})}loadTileData(m,o){Y.loadTileData(m,o,this._map.painter)}unloadTileData(m){Y.unloadTileData(m,this._map.painter)}prepareTile(m){if(!this._implementation.prepareTile)return null;const{x:o,y:d,z:y}=m.tileID.canonical,w=this._implementation.prepareTile({x:o,y:d,z:y});return w?(this.loadTileData(m,w),m.state="loaded",w):null}unloadTile(m,o){if(this.unloadTileData(m),this._implementation.unloadTile){const{x:d,y,z:w}=m.tileID.canonical;this._implementation.unloadTile({x:d,y,z:w})}o()}abortTile(m,o){m.request&&m.request.cancel&&(m.request.cancel(),delete m.request),o()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(m=>({x:m.canonical.x,y:m.canonical.y,z:m.canonical.z}))}_update(){this.fire(new r.Event("data",{dataType:"source",sourceDataType:"content"}))}}},et=function(m,o,d,y){const w=new Qe[o.type](m,o,d,y);if(w.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${w.id}`);return r.bindAll(["load","abort","unload","serialize","prepare"],w),w};function qe(m,o){const d=r.identity([]);return r.scale(d,d,[.5*m.width,.5*-m.height,1]),r.translate(d,d,[1,-1,0]),r.multiply$1(d,d,m.calculateProjMatrix(o.toUnwrapped())),Float32Array.from(d)}function it(m,o,d,y,w,T,A,I=!1){const O=m.tilesIn(y,A,I);O.sort(Vt);const U=[];for(const j of O)U.push({wrappedTileID:j.tile.tileID.wrapped().key,queryResults:j.tile.queryRenderedFeatures(o,d,m._state,j,w,T,qe(m.transform,j.tile.tileID),I)});const V=function(j){const ee={},ce={};for(const ae of j){const J=ae.queryResults,Pe=ae.wrappedTileID,_e=ce[Pe]=ce[Pe]||{};for(const Ae in J){const De=J[Ae],ke=_e[Ae]=_e[Ae]||{},Te=ee[Ae]=ee[Ae]||[];for(const Ne of De)ke[Ne.featureIndex]||(ke[Ne.featureIndex]=!0,Te.push(Ne))}}return ee}(U);for(const j in V)V[j].forEach(ee=>{const ce=ee.feature,ae=ce.layer;ae&&ae.type!=="background"&&ae.type!=="sky"&&(ce.source=ae.source,ae["source-layer"]&&(ce.sourceLayer=ae["source-layer"]),ce.state=ce.id!==void 0?m.getFeatureState(ae["source-layer"],ce.id):{})});return V}function vt(m,o){const d=m.getRenderableIds().map(T=>m.getTileByID(T)),y=[],w={};for(let T=0;T<d.length;T++){const A=d[T],I=A.tileID.canonical.key;w[I]||(w[I]=!0,A.querySourceFeatures(y,o))}return y}function Vt(m,o){const d=m.tileID,y=o.tileID;return d.overscaledZ-y.overscaledZ||d.canonical.y-y.canonical.y||d.wrap-y.wrap||d.canonical.x-y.canonical.x}function Ct(){return zs.workerClass!=null?new zs.workerClass:new r.window.Worker(zs.workerUrl)}const _n="mapboxgl_preloaded_worker_pool";class q{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<q.workerCount;)this.workers.push(new Ct);return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[_n]}numActive(){return Object.keys(this.active).length}}let K;function Be(){return K||(K=new q),K}function Me(m,o){const d={};for(const y in m)y!=="ref"&&(d[y]=m[y]);return r.refProperties.forEach(y=>{y in o&&(d[y]=o[y])}),d}function Tt(m){m=m.slice();const o=Object.create(null);for(let d=0;d<m.length;d++)o[m[d].id]=m[d];for(let d=0;d<m.length;d++)"ref"in m[d]&&(m[d]=Me(m[d],o[m[d].ref]));return m}q.workerCount=2;const _t={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Ot(m,o,d){d.push({command:_t.addSource,args:[m,o[m]]})}function rn(m,o,d){o.push({command:_t.removeSource,args:[m]}),d[m]=!0}function Pn(m,o,d,y){rn(m,d,y),Ot(m,o,d)}function Ln(m,o,d){let y;for(y in m[d])if(m[d].hasOwnProperty(y)&&y!=="data"&&!M(m[d][y],o[d][y]))return!1;for(y in o[d])if(o[d].hasOwnProperty(y)&&y!=="data"&&!M(m[d][y],o[d][y]))return!1;return!0}function Mt(m,o,d,y,w,T){let A;for(A in o=o||{},m=m||{})m.hasOwnProperty(A)&&(M(m[A],o[A])||d.push({command:T,args:[y,A,o[A],w]}));for(A in o)o.hasOwnProperty(A)&&!m.hasOwnProperty(A)&&(M(m[A],o[A])||d.push({command:T,args:[y,A,o[A],w]}))}function un(m){return m.id}function Jt(m,o){return m[o.id]=o,m}class mn{constructor(o,d){this.reset(o,d)}reset(o,d){this.points=o||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=r.clamp(o,0,1);let d=1,y=this._distances[d];const w=o*this.paddedLength+this.padding;for(;y<w&&d<this._distances.length;)y=this._distances[++d];const T=d-1,A=this._distances[T],I=y-A,O=I>0?(w-A)/I:0;return this.points[T].mult(1-O).add(this.points[d].mult(O))}}class Tn{constructor(o,d,y){const w=this.boxCells=[],T=this.circleCells=[];this.xCellCount=Math.ceil(o/y),this.yCellCount=Math.ceil(d/y);for(let A=0;A<this.xCellCount*this.yCellCount;A++)w.push([]),T.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=d,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,d,y,w,T){this._forEachCell(d,y,w,T,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(d),this.bboxes.push(y),this.bboxes.push(w),this.bboxes.push(T)}insertCircle(o,d,y,w){this._forEachCell(d-w,y-w,d+w,y+w,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(d),this.circles.push(y),this.circles.push(w)}_insertBoxCell(o,d,y,w,T,A){this.boxCells[T].push(A)}_insertCircleCell(o,d,y,w,T,A){this.circleCells[T].push(A)}_query(o,d,y,w,T,A){if(y<0||o>this.width||w<0||d>this.height)return!T&&[];const I=[];if(o<=0&&d<=0&&this.width<=y&&this.height<=w){if(T)return!0;for(let O=0;O<this.boxKeys.length;O++)I.push({key:this.boxKeys[O],x1:this.bboxes[4*O],y1:this.bboxes[4*O+1],x2:this.bboxes[4*O+2],y2:this.bboxes[4*O+3]});for(let O=0;O<this.circleKeys.length;O++){const U=this.circles[3*O],V=this.circles[3*O+1],j=this.circles[3*O+2];I.push({key:this.circleKeys[O],x1:U-j,y1:V-j,x2:U+j,y2:V+j})}return A?I.filter(A):I}return this._forEachCell(o,d,y,w,this._queryCell,I,{hitTest:T,seenUids:{box:{},circle:{}}},A),T?I.length>0:I}_queryCircle(o,d,y,w,T){const A=o-y,I=o+y,O=d-y,U=d+y;if(I<0||A>this.width||U<0||O>this.height)return!w&&[];const V=[];return this._forEachCell(A,O,I,U,this._queryCellCircle,V,{hitTest:w,circle:{x:o,y:d,radius:y},seenUids:{box:{},circle:{}}},T),w?V.length>0:V}query(o,d,y,w,T){return this._query(o,d,y,w,!1,T)}hitTest(o,d,y,w,T){return this._query(o,d,y,w,!0,T)}hitTestCircle(o,d,y,w){return this._queryCircle(o,d,y,!0,w)}_queryCell(o,d,y,w,T,A,I,O){const U=I.seenUids,V=this.boxCells[T];if(V!==null){const ee=this.bboxes;for(const ce of V)if(!U.box[ce]){U.box[ce]=!0;const ae=4*ce;if(o<=ee[ae+2]&&d<=ee[ae+3]&&y>=ee[ae+0]&&w>=ee[ae+1]&&(!O||O(this.boxKeys[ce]))){if(I.hitTest)return A.push(!0),!0;A.push({key:this.boxKeys[ce],x1:ee[ae],y1:ee[ae+1],x2:ee[ae+2],y2:ee[ae+3]})}}}const j=this.circleCells[T];if(j!==null){const ee=this.circles;for(const ce of j)if(!U.circle[ce]){U.circle[ce]=!0;const ae=3*ce;if(this._circleAndRectCollide(ee[ae],ee[ae+1],ee[ae+2],o,d,y,w)&&(!O||O(this.circleKeys[ce]))){if(I.hitTest)return A.push(!0),!0;{const J=ee[ae],Pe=ee[ae+1],_e=ee[ae+2];A.push({key:this.circleKeys[ce],x1:J-_e,y1:Pe-_e,x2:J+_e,y2:Pe+_e})}}}}}_queryCellCircle(o,d,y,w,T,A,I,O){const U=I.circle,V=I.seenUids,j=this.boxCells[T];if(j!==null){const ce=this.bboxes;for(const ae of j)if(!V.box[ae]){V.box[ae]=!0;const J=4*ae;if(this._circleAndRectCollide(U.x,U.y,U.radius,ce[J+0],ce[J+1],ce[J+2],ce[J+3])&&(!O||O(this.boxKeys[ae])))return A.push(!0),!0}}const ee=this.circleCells[T];if(ee!==null){const ce=this.circles;for(const ae of ee)if(!V.circle[ae]){V.circle[ae]=!0;const J=3*ae;if(this._circlesCollide(ce[J],ce[J+1],ce[J+2],U.x,U.y,U.radius)&&(!O||O(this.circleKeys[ae])))return A.push(!0),!0}}}_forEachCell(o,d,y,w,T,A,I,O){const U=this._convertToXCellCoord(o),V=this._convertToYCellCoord(d),j=this._convertToXCellCoord(y),ee=this._convertToYCellCoord(w);for(let ce=U;ce<=j;ce++)for(let ae=V;ae<=ee;ae++)if(T.call(this,o,d,y,w,this.xCellCount*ae+ce,A,I,O))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,d,y,w,T,A){const I=w-o,O=T-d,U=y+A;return U*U>I*I+O*O}_circleAndRectCollide(o,d,y,w,T,A,I){const O=(A-w)/2,U=Math.abs(o-(w+O));if(U>O+y)return!1;const V=(I-T)/2,j=Math.abs(d-(T+V));if(j>V+y)return!1;if(U<=O||j<=V)return!0;const ee=U-O,ce=j-V;return ee*ee+ce*ce<=y*y}}const Cn=Math.tan(85*Math.PI/180);function di(m,o,d,y,w,T){const A=r.create();if(d){if(w.projection.name==="globe")r.multiply$1(A,A,r.calculateGlobeLabelMatrix(w,o));else{const I=se([],T);A[0]=I[0],A[1]=I[1],A[4]=I[2],A[5]=I[3]}y||r.rotateZ(A,A,w.angle)}else r.multiply$1(A,w.labelPlaneMatrix,m);return A}function Ar(m,o,d,y,w,T){if(d){if(w.projection.name==="globe"){const A=di(m,o,d,y,w,T);return r.invert(A,A),r.multiply$1(A,m,A),A}{const A=r.clone(m),I=r.identity([]);return I[0]=T[0],I[1]=T[1],I[4]=T[2],I[5]=T[3],r.multiply$1(A,A,I),y||r.rotateZ(A,A,-w.angle),A}}return w.glCoordMatrix}function oi(m,o,d=0){const y=[m.x,m.y,d,1];d?r.transformMat4$1(y,y,o):Sr(y,y,o);const w=y[3];return{point:new r.pointGeometry(y[0]/w,y[1]/w),signedDistanceFromCamera:w}}function li(m,o){const d=[m[0],m[1],m[2],1];r.transformMat4$1(d,d,o);const y=d[3];return{point:new r.pointGeometry(d[0]/y,d[1]/y),signedDistanceFromCamera:y}}function ai(m,o){return Math.min(.5+m/o*.5,1.5)}function xs(m,o){const d=m[0]/m[3],y=m[1]/m[3];return d>=-o[0]&&d<=o[0]&&y>=-o[1]&&y<=o[1]}function zo(m,o,d,y,w,T,A,I,O,U){const V=d.transform,j=y?m.textSizeData:m.iconSizeData,ee=r.evaluateSizeForZoom(j,d.transform.zoom),ce=[256/d.width*2+1,256/d.height*2+1],ae=y?m.text.dynamicLayoutVertexArray:m.icon.dynamicLayoutVertexArray;ae.clear();const J=m.lineVertexArray,Pe=y?m.text.placedSymbolArray:m.icon.placedSymbolArray,_e=d.transform.width/d.transform.height;let Ae=!1;for(let De=0;De<Pe.length;De++){const ke=Pe.get(De);if(ke.writingMode!==r.WritingMode.vertical||Ae||De!==0&&Pe.get(De-1).writingMode===r.WritingMode.horizontal||(Ae=!0),(ke.hidden||ke.writingMode===r.WritingMode.vertical)&&!Ae){Bi(ke.numGlyphs,ae);continue}Ae=!1;const Te=new r.pointGeometry(ke.tileAnchorX,ke.tileAnchorY),Ne=O?O(Te):[0,0,0],tt=V.projection.projectTilePoint(Te.x,Te.y,U.canonical),at=[tt.x+Ne[0],tt.y+Ne[1],tt.z+Ne[2]],pt=[...at,1];if(r.transformMat4$1(pt,pt,o),!xs(pt,ce)){Bi(ke.numGlyphs,ae);continue}const ht=ai(d.transform.cameraToCenterDistance,pt[3]),zt=r.evaluateSizeForFeature(j,ee,ke),nt=A?zt/ht:zt*ht,kt=oi(new r.pointGeometry(at[0],at[1]),w,at[2]);if(kt.signedDistanceFromCamera<=0){Bi(ke.numGlyphs,ae);continue}let Pt={};const Kt=A?null:O,ft=lu(ke,nt,!1,I,o,w,T,m.glyphOffsetArray,J,ae,kt.point,Te,Pt,_e,Kt,V.projection,U);Ae=ft.useVertical,Kt&&ft.needsFlipping&&(Pt={}),(ft.notEnoughRoom||Ae||ft.needsFlipping&&lu(ke,nt,!0,I,o,w,T,m.glyphOffsetArray,J,ae,kt.point,Te,Pt,_e,Kt,V.projection,U).notEnoughRoom)&&Bi(ke.numGlyphs,ae)}y?m.text.dynamicLayoutVertexBuffer.updateData(ae):m.icon.dynamicLayoutVertexBuffer.updateData(ae)}function su(m,o,d,y,w,T,A,I,O,U,V,j,ee,ce,ae){const J=I.glyphStartIndex+I.numGlyphs,Pe=I.lineStartIndex,_e=I.lineStartIndex+I.lineLength,Ae=o.getoffsetX(I.glyphStartIndex),De=o.getoffsetX(J-1),ke=ws(m*Ae,d,y,w,T,A,I.segment,Pe,_e,O,U,V,j,ee,!0,ce,ae);if(!ke)return null;const Te=ws(m*De,d,y,w,T,A,I.segment,Pe,_e,O,U,V,j,ee,!0,ce,ae);return Te?{first:ke,last:Te}:null}function bs(m,o,d,y){return m.writingMode===r.WritingMode.horizontal&&Math.abs(d.y-o.y)>Math.abs(d.x-o.x)*y?{useVertical:!0}:m.writingMode===r.WritingMode.vertical?o.y<d.y?{needsFlipping:!0}:null:m.flipState!==0&&function(w,T,A){const I=(T.x-w.x)*A;return I===0||Math.abs((T.y-w.y)/I)>Cn}(o,d,y)?m.flipState===1?{needsFlipping:!0}:null:o.x>d.x?{needsFlipping:!0}:null}function lu(m,o,d,y,w,T,A,I,O,U,V,j,ee,ce,ae,J,Pe){const _e=o/24,Ae=m.lineOffsetX*_e,De=m.lineOffsetY*_e;let ke;if(m.numGlyphs>1){const Te=m.glyphStartIndex+m.numGlyphs,Ne=m.lineStartIndex,tt=m.lineStartIndex+m.lineLength,at=su(_e,I,Ae,De,d,V,j,m,O,T,ee,ae,!1,J,Pe);if(!at)return{notEnoughRoom:!0};const pt=oi(at.first.point,A).point,ht=oi(at.last.point,A).point;if(y&&!d){const zt=bs(m,pt,ht,ce);if(m.flipState=zt&&zt.needsFlipping?1:2,zt)return zt}ke=[at.first];for(let zt=m.glyphStartIndex+1;zt<Te-1;zt++)ke.push(ws(_e*I.getoffsetX(zt),Ae,De,d,V,j,m.segment,Ne,tt,O,T,ee,ae,!1,!1,J,Pe));ke.push(at.last)}else{if(y&&!d){const Ne=oi(j,w).point,tt=m.lineStartIndex+m.segment+1,at=new r.pointGeometry(O.getx(tt),O.gety(tt)),pt=oi(at,w),ht=bs(m,Ne,pt.signedDistanceFromCamera>0?pt.point:Zn(j,at,Ne,1,w,void 0,J,Pe.canonical),ce);if(m.flipState=ht&&ht.needsFlipping?1:2,ht)return ht}const Te=ws(_e*I.getoffsetX(m.glyphStartIndex),Ae,De,d,V,j,m.segment,m.lineStartIndex,m.lineStartIndex+m.lineLength,O,T,ee,ae,!1,!1,J,Pe);if(!Te)return{notEnoughRoom:!0};ke=[Te]}for(const Te of ke)r.addDynamicAttributes(U,Te.point,Te.angle);return{}}function Md(m,o,d,y,w){const T=y.projectTilePoint(m.x,m.y,o);if(!w)return oi(T,d,T.z);const A=w(m);return oi(new r.pointGeometry(T.x+A[0],T.y+A[1]),d,T.z+A[2])}function Zn(m,o,d,y,w,T,A,I){const O=Md(m.add(m.sub(o)._unit()),I,w,A,T).point,U=d.sub(O);return d.add(U._mult(y/U.mag()))}function ws(m,o,d,y,w,T,A,I,O,U,V,j,ee,ce,ae,J,Pe){const _e=y?m-o:m+o;let Ae=_e>0?1:-1,De=0;y&&(Ae*=-1,De=Math.PI),Ae<0&&(De+=Math.PI);let ke=Ae>0?I+A:I+A+1,Te=w,Ne=w,tt=0,at=0;const pt=Math.abs(_e),ht=[],zt=[];let nt=T;const kt=()=>{const Xt=ke-Ae;return tt===0?T:new r.pointGeometry(U.getx(Xt),U.gety(Xt))},Pt=()=>Zn(kt(),nt,Ne,pt-tt+1,V,ee,J,Pe.canonical);for(;tt+at<=pt;){if(ke+=Ae,ke<I||ke>=O)return null;if(Ne=Te,ht.push(Te),ce&&zt.push(nt||kt()),Te=j[ke],Te===void 0){nt=new r.pointGeometry(U.getx(ke),U.gety(ke));const Xt=Md(nt,Pe.canonical,V,J,ee);Te=Xt.signedDistanceFromCamera>0?j[ke]=Xt.point:Pt()}else nt=null;tt+=at,at=Ne.dist(Te)}ae&&ee&&(nt=nt||new r.pointGeometry(U.getx(ke),U.gety(ke)),j[ke]=Te=j[ke]===void 0?Te:Pt(),at=Ne.dist(Te));const Kt=(pt-tt)/at,ft=Te.sub(Ne),qt=ft.mult(Kt)._add(Ne);d&&qt._add(ft._unit()._perp()._mult(d*Ae));const gn=De+Math.atan2(Te.y-Ne.y,Te.x-Ne.x);return ht.push(qt),ce&&(nt=nt||new r.pointGeometry(U.getx(ke),U.gety(ke)),zt.push(function(Xt,Yt,xn){const kn=1-xn;return new r.pointGeometry(Xt.x*kn+Yt.x*xn,Xt.y*kn+Yt.y*xn)}(zt.length>0?zt[zt.length-1]:nt,nt,Kt))),{point:qt,angle:gn,path:ht,tilePath:zt}}const Td=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Bi(m,o){for(let d=0;d<m;d++){const y=o.length;o.resize(y+4),o.float32.set(Td,3*y)}}function Sr(m,o,d){const y=o[0],w=o[1];return m[0]=d[0]*y+d[4]*w+d[12],m[1]=d[1]*y+d[5]*w+d[13],m[3]=d[3]*y+d[7]*w+d[15],m}const ho=100;class cu{constructor(o,d,y=new Tn(o.width+200,o.height+200,25),w=new Tn(o.width+200,o.height+200,25)){this.transform=o,this.grid=y,this.ignoredGrid=w,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+ho,this.screenBottomBoundary=o.height+ho,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.fogState=d}placeCollisionBox(o,d,y,w,T,A,I){let O=d.projectedAnchorX,U=d.projectedAnchorY,V=d.projectedAnchorZ;const j=d.elevation,ee=d.tileID;if(j&&ee){const ke=this.transform.projection.upVector(ee.canonical,d.tileAnchorX,d.tileAnchorY),Te=this.transform.projection.upVectorScale(ee.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;O+=ke[0]*j*Te,U+=ke[1]*j*Te,V+=ke[2]*j*Te}const ce=this.projectAndGetPerspectiveRatio(A,[O,U,V],d.tileID,this.transform.projection.name==="globe"||!!j||this.transform.pitch>0),ae=T*ce.perspectiveRatio,J=(d.x1*o+y.x-d.padding)*ae+ce.point.x,Pe=(d.y1*o+y.y-d.padding)*ae+ce.point.y,_e=(d.x2*o+y.x+d.padding)*ae+ce.point.x,Ae=(d.y2*o+y.y+d.padding)*ae+ce.point.y,De=ce.perspectiveRatio<=.55||ce.occluded;return!this.isInsideGrid(J,Pe,_e,Ae)||!w&&this.grid.hitTest(J,Pe,_e,Ae,I)||De?{box:[],offscreen:!1,occluded:ce.occluded}:{box:[J,Pe,_e,Ae],offscreen:this.isOffscreen(J,Pe,_e,Ae),occluded:!1}}placeCollisionCircles(o,d,y,w,T,A,I,O,U,V,j,ee,ce,ae){const J=[],Pe=this.transform.elevation,_e=Pe?Pe.getAtTileOffsetFunc(ae,this.transform.center.lat,this.transform.worldSize,this.transform.projection):Pt=>[0,0,0],Ae=new r.pointGeometry(d.tileAnchorX,d.tileAnchorY),De=this.transform.projection.projectTilePoint(d.tileAnchorX,d.tileAnchorY,ae.canonical),ke=_e(Ae),Te=[De.x+ke[0],De.y+ke[1],De.z+ke[2]],Ne=this.projectAndGetPerspectiveRatio(A,[Te[0],Te[1],Te[2]],ae,this.transform.projection.name==="globe"||!!Pe||this.transform.pitch>0),{perspectiveRatio:tt}=Ne,at=(V?T/tt:T*tt)/r.ONE_EM,pt=oi(new r.pointGeometry(Te[0],Te[1]),I,Te[2]).point,ht=Ne.signedDistanceFromCamera>0?su(at,w,d.lineOffsetX*at,d.lineOffsetY*at,!1,pt,Ae,d,y,I,{},Pe&&!V?_e:null,V&&!!Pe,this.transform.projection,ae):null;let zt=!1,nt=!1,kt=!0;if(ht&&!Ne.occluded){const Pt=.5*ee*tt+ce,Kt=new r.pointGeometry(-100,-100),ft=new r.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),qt=new mn,gn=ht.first,Xt=ht.last;let Yt=[];for(let dn=gn.path.length-1;dn>=1;dn--)Yt.push(gn.path[dn]);for(let dn=1;dn<Xt.path.length;dn++)Yt.push(Xt.path[dn]);const xn=2.5*Pt;if(O){const dn=Yt.map(Pe?(Mn,$n)=>{const vi=_e($n<gn.path.length-1?gn.tilePath[gn.path.length-1-$n]:Xt.tilePath[$n-gn.path.length+2]);return oi(Mn,O,vi[2])}:Mn=>oi(Mn,O));Yt=dn.some(Mn=>Mn.signedDistanceFromCamera<=0)?[]:dn.map(Mn=>Mn.point)}let kn=[];if(Yt.length>0){const dn=Yt[0].clone(),Mn=Yt[0].clone();for(let $n=1;$n<Yt.length;$n++)dn.x=Math.min(dn.x,Yt[$n].x),dn.y=Math.min(dn.y,Yt[$n].y),Mn.x=Math.max(Mn.x,Yt[$n].x),Mn.y=Math.max(Mn.y,Yt[$n].y);kn=dn.x>=Kt.x&&Mn.x<=ft.x&&dn.y>=Kt.y&&Mn.y<=ft.y?[Yt]:Mn.x<Kt.x||dn.x>ft.x||Mn.y<Kt.y||dn.y>ft.y?[]:r.clipLine([Yt],Kt.x,Kt.y,ft.x,ft.y)}for(const dn of kn){qt.reset(dn,.25*Pt);let Mn=0;Mn=qt.length<=.5*Pt?1:Math.ceil(qt.paddedLength/xn)+1;for(let $n=0;$n<Mn;$n++){const vi=$n/Math.max(Mn-1,1),nr=qt.lerp(vi),ir=nr.x+ho,Rr=nr.y+ho;J.push(ir,Rr,Pt,0);const mo=ir-Pt,Uo=Rr-Pt,da=ir+Pt,Vo=Rr+Pt;if(kt=kt&&this.isOffscreen(mo,Uo,da,Vo),nt=nt||this.isInsideGrid(mo,Uo,da,Vo),!o&&this.grid.hitTestCircle(ir,Rr,Pt,j)&&(zt=!0,!U))return{circles:[],offscreen:!1,collisionDetected:zt,occluded:!1}}}}return{circles:!U&&zt||!nt?[]:J,offscreen:kt,collisionDetected:zt,occluded:Ne.occluded}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let y=1/0,w=1/0,T=-1/0,A=-1/0;for(const V of o){const j=new r.pointGeometry(V.x+ho,V.y+ho);y=Math.min(y,j.x),w=Math.min(w,j.y),T=Math.max(T,j.x),A=Math.max(A,j.y),d.push(j)}const I=this.grid.query(y,w,T,A).concat(this.ignoredGrid.query(y,w,T,A)),O={},U={};for(const V of I){const j=V.key;if(O[j.bucketInstanceId]===void 0&&(O[j.bucketInstanceId]={}),O[j.bucketInstanceId][j.featureIndex])continue;const ee=[new r.pointGeometry(V.x1,V.y1),new r.pointGeometry(V.x2,V.y1),new r.pointGeometry(V.x2,V.y2),new r.pointGeometry(V.x1,V.y2)];r.polygonIntersectsPolygon(d,ee)&&(O[j.bucketInstanceId][j.featureIndex]=!0,U[j.bucketInstanceId]===void 0&&(U[j.bucketInstanceId]=[]),U[j.bucketInstanceId].push(j.featureIndex))}return U}insertCollisionBox(o,d,y,w,T){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:w,collisionGroupID:T},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,d,y,w,T){const A=d?this.ignoredGrid:this.grid,I={bucketInstanceId:y,featureIndex:w,collisionGroupID:T};for(let O=0;O<o.length;O+=4)A.insertCircle(I,o[O],o[O+1],o[O+2])}projectAndGetPerspectiveRatio(o,d,y,w){const T=[d[0],d[1],d[2],1];let A=!1;return d[2]||this.transform.pitch>0?(r.transformMat4$1(T,T,o),this.fogState&&y&&(A=function(I,O,U,V,j,ee){const ce=ee.calculateFogTileMatrix(j),ae=[O,U,V];return r.transformMat4(ae,ae,ce),yt(I,ae,ee.pitch,ee._fov)}(this.fogState,d[0],d[1],d[2],y.toUnwrapped(),this.transform)>.9)):Sr(T,T,o),{point:new r.pointGeometry((T[0]/T[3]+1)/2*this.transform.width+ho,(-T[1]/T[3]+1)/2*this.transform.height+ho),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/T[3]*.5,1.5),signedDistanceFromCamera:T[3],occluded:w&&T[2]>T[3]||A}}isOffscreen(o,d,y,w){return y<ho||o>=this.screenRightBoundary||w<ho||d>this.screenBottomBoundary}isInsideGrid(o,d,y,w){return y>=0&&o<this.gridRightBoundary&&w>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const o=r.identity([]);return r.translate(o,o,[-100,-100,0]),o}}class Di{constructor(o,d,y,w){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?d:-d))):w&&y?1:0,this.placed=y}isHidden(){return this.opacity===0&&!this.placed}}class ko{constructor(o,d,y,w,T,A=!1){this.text=new Di(o?o.text:null,d,y,T),this.icon=new Di(o?o.icon:null,d,w,T),this.clipped=A}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Bo{constructor(o,d,y,w=!1){this.text=o,this.icon=d,this.skipFade=y,this.clipped=w}}class Qi{constructor(){this.invProjMatrix=r.create(),this.viewportMatrix=r.create(),this.circles=[]}}class Ed{constructor(o,d,y,w,T){this.bucketInstanceId=o,this.featureIndex=d,this.sourceLayerIndex=y,this.bucketIndex=w,this.tileID=T}}class po{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const d=++this.maxGroupID;this.collisionGroups[o]={ID:d,predicate:y=>y.collisionGroupID===d}}return this.collisionGroups[o]}}function Ms(m,o,d,y,w){const{horizontalAlign:T,verticalAlign:A}=r.getAnchorAlignment(m),I=-(T-.5)*o,O=-(A-.5)*d,U=r.evaluateVariableOffset(m,y);return new r.pointGeometry(I+U[0]*w,O+U[1]*w)}function Ts(m,o,d,y,w){const T=new r.pointGeometry(m,o);return d&&T._rotate(y?w:-w),T}class k_{constructor(o,d,y,w,T){this.transform=o.clone(),this.collisionIndex=new cu(this.transform,T),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new po(y),this.collisionCircleArrays={},this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,d,y,w){const T=y.getBucket(d),A=y.latestFeatureIndex;if(!T||!A||d.id!==T.layerIds[0])return;const I=T.layers[0].layout,O=y.collisionBoxArray,U=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),V=y.tileSize/r.EXTENT,j=y.tileID.toUnwrapped(),ee=this.transform.calculateProjMatrix(j),ce=I.get("text-pitch-alignment")==="map",ae=I.get("text-rotation-alignment")==="map";d.compileFilter();const J=d.dynamicFilter(),Pe=d.dynamicFilterNeedsFeature(),_e=this.transform.calculatePixelsToTileUnitsMatrix(y),Ae=di(ee,y.tileID.canonical,ce,ae,this.transform,_e);let De=null;if(ce){const Ne=Ar(ee,y.tileID.canonical,ce,ae,this.transform,_e);De=r.multiply$1([],this.transform.labelPlaneMatrix,Ne)}let ke=null;J&&y.latestFeatureIndex&&(ke={unwrappedTileID:j,dynamicFilter:J,dynamicFilterNeedsFeature:Pe,featureIndex:y.latestFeatureIndex}),this.retainedQueryData[T.bucketInstanceId]=new Ed(T.bucketInstanceId,A,T.sourceLayerIndex,T.index,y.tileID);const Te={bucket:T,layout:I,posMatrix:ee,textLabelPlaneMatrix:Ae,labelToScreenMatrix:De,clippingData:ke,scale:U,textPixelRatio:V,holdingForFade:y.holdingForFade(),collisionBoxArray:O,partiallyEvaluatedTextSize:r.evaluateSizeForZoom(T.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:r.evaluateSizeForZoom(T.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(T.sourceID)};if(w)for(const Ne of T.sortKeyRanges){const{sortKey:tt,symbolInstanceStart:at,symbolInstanceEnd:pt}=Ne;o.push({sortKey:tt,symbolInstanceStart:at,symbolInstanceEnd:pt,parameters:Te})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:T.symbolInstances.length,parameters:Te})}attemptAnchorPlacement(o,d,y,w,T,A,I,O,U,V,j,ee,ce,ae,J,Pe,_e,Ae){const De=[ee.textOffset0,ee.textOffset1],ke=Ms(o,y,w,De,T),Te=this.collisionIndex.placeCollisionBox(T,d,Ts(ke.x,ke.y,A,I,this.transform.angle),j,O,U,V.predicate);if((!Pe||this.collisionIndex.placeCollisionBox(ae.getSymbolInstanceIconSize(Ae,this.transform.zoom,ce),Pe,Ts(ke.x,ke.y,A,I,this.transform.angle),j,O,U,V.predicate).box.length!==0)&&Te.box.length>0){let Ne;return this.prevPlacement&&this.prevPlacement.variableOffsets[ee.crossTileID]&&this.prevPlacement.placements[ee.crossTileID]&&this.prevPlacement.placements[ee.crossTileID].text&&(Ne=this.prevPlacement.variableOffsets[ee.crossTileID].anchor),this.variableOffsets[ee.crossTileID]={textOffset:De,width:y,height:w,anchor:o,textScale:T,prevAnchor:Ne},this.markUsedJustification(ae,o,ee,J),ae.allowVerticalPlacement&&(this.markUsedOrientation(ae,J,ee),this.placedOrientations[ee.crossTileID]=J),{shift:ke,placedGlyphBoxes:Te}}}placeLayerBucketPart(o,d,y,w){const{bucket:T,layout:A,posMatrix:I,textLabelPlaneMatrix:O,labelToScreenMatrix:U,clippingData:V,textPixelRatio:j,holdingForFade:ee,collisionBoxArray:ce,partiallyEvaluatedTextSize:ae,partiallyEvaluatedIconSize:J,collisionGroup:Pe}=o.parameters,_e=A.get("text-optional"),Ae=A.get("icon-optional"),De=A.get("text-allow-overlap"),ke=A.get("icon-allow-overlap"),Te=A.get("text-rotation-alignment")==="map",Ne=A.get("text-pitch-alignment")==="map",tt=A.get("icon-text-fit")!=="none",at=A.get("symbol-z-order")==="viewport-y";let pt=De&&(ke||!T.hasIconData()||Ae),ht=ke&&(De||!T.hasTextData()||_e);!T.collisionArrays&&ce&&T.deserializeCollisionBoxes(ce),y&&w&&T.updateCollisionDebugBuffers(this.transform.zoom,ce);const zt=(nt,kt,Pt)=>{if(V){const bi={zoom:this.transform.zoom,pitch:this.transform.pitch};let Ti=null;if(V.dynamicFilterNeedsFeature){const Yn=this.retainedQueryData[T.bucketInstanceId];Ti=V.featureIndex.loadFeature({featureIndex:nt.featureIndex,bucketIndex:Yn.bucketIndex,sourceLayerIndex:Yn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,V.dynamicFilter)(bi,Ti,this.retainedQueryData[T.bucketInstanceId].tileID.canonical,new r.pointGeometry(nt.tileAnchorX,nt.tileAnchorY),this.transform.calculateDistanceTileData(V.unwrappedTileID)))return this.placements[nt.crossTileID]=new Bo(!1,!1,!1,!0),void(d[nt.crossTileID]=!0)}if(d[nt.crossTileID])return;if(ee)return void(this.placements[nt.crossTileID]=new Bo(!1,!1,!1));let Kt=!1,ft=!1,qt=!0,gn=!1,Xt=!1,Yt=null,xn={box:null,offscreen:null,occluded:null},kn={box:null,offscreen:null,occluded:null},dn=null,Mn=null,$n=null,vi=0,nr=0,ir=0;Pt.textFeatureIndex?vi=Pt.textFeatureIndex:nt.useRuntimeCollisionCircles&&(vi=nt.featureIndex),Pt.verticalTextFeatureIndex&&(nr=Pt.verticalTextFeatureIndex);const Rr=bi=>{bi.tileID=this.retainedQueryData[T.bucketInstanceId].tileID,(this.transform.elevation||bi.elevation)&&(bi.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[T.bucketInstanceId].tileID,bi.tileAnchorX,bi.tileAnchorY):0)},mo=Pt.textBox;if(mo){Rr(mo);const bi=Yn=>{let Pi=r.WritingMode.horizontal;if(T.allowVerticalPlacement&&!Yn&&this.prevPlacement){const zr=this.prevPlacement.placedOrientations[nt.crossTileID];zr&&(this.placedOrientations[nt.crossTileID]=zr,Pi=zr,this.markUsedOrientation(T,Pi,nt))}return Pi},Ti=(Yn,Pi)=>{if(T.allowVerticalPlacement&&nt.numVerticalGlyphVertices>0&&Pt.verticalTextBox){for(const zr of T.writingModes)if(zr===r.WritingMode.vertical?(xn=Pi(),kn=xn):xn=Yn(),xn&&xn.box&&xn.box.length)break}else xn=Yn()};if(A.get("text-variable-anchor")){let Yn=A.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[nt.crossTileID]){const xi=this.prevPlacement.variableOffsets[nt.crossTileID];Yn.indexOf(xi.anchor)>0&&(Yn=Yn.filter(qr=>qr!==xi.anchor),Yn.unshift(xi.anchor))}const Pi=(xi,qr,jl)=>{const kr=T.getSymbolInstanceTextSize(ae,nt,this.transform.zoom,kt),ja=(xi.x2-xi.x1)*kr+2*xi.padding,ug=(xi.y2-xi.y1)*kr+2*xi.padding,lp=tt&&!ke?qr:null;lp&&Rr(lp);let ks={box:[],offscreen:!1,occluded:!1};const Q_=De?2*Yn.length:Yn.length;for(let pa=0;pa<Q_;++pa){const cp=this.attemptAnchorPlacement(Yn[pa%Yn.length],xi,ja,ug,kr,Te,Ne,j,I,Pe,pa>=Yn.length,nt,kt,T,jl,lp,ae,J);if(cp&&(ks=cp.placedGlyphBoxes,ks&&ks.box&&ks.box.length)){Kt=!0,Yt=cp.shift;break}}return ks};Ti(()=>Pi(mo,Pt.iconBox,r.WritingMode.horizontal),()=>{const xi=Pt.verticalTextBox;return xi&&Rr(xi),T.allowVerticalPlacement&&!(xn&&xn.box&&xn.box.length)&&nt.numVerticalGlyphVertices>0&&xi?Pi(xi,Pt.verticalIconBox,r.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),xn&&(Kt=xn.box,qt=xn.offscreen,gn=xn.occluded);const zr=bi(xn&&xn.box);if(!Kt&&this.prevPlacement){const xi=this.prevPlacement.variableOffsets[nt.crossTileID];xi&&(this.variableOffsets[nt.crossTileID]=xi,this.markUsedJustification(T,xi.anchor,nt,zr))}}else{const Yn=(Pi,zr)=>{const xi=T.getSymbolInstanceTextSize(ae,nt,this.transform.zoom,kt),qr=this.collisionIndex.placeCollisionBox(xi,Pi,new r.pointGeometry(0,0),De,j,I,Pe.predicate);return qr&&qr.box&&qr.box.length&&(this.markUsedOrientation(T,zr,nt),this.placedOrientations[nt.crossTileID]=zr),qr};Ti(()=>Yn(mo,r.WritingMode.horizontal),()=>{const Pi=Pt.verticalTextBox;return T.allowVerticalPlacement&&nt.numVerticalGlyphVertices>0&&Pi?(Rr(Pi),Yn(Pi,r.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),bi(xn&&xn.box&&xn.box.length)}}if(dn=xn,Kt=dn&&dn.box&&dn.box.length>0,qt=dn&&dn.offscreen,gn=dn&&dn.occluded,nt.useRuntimeCollisionCircles){const bi=T.text.placedSymbolArray.get(nt.centerJustifiedTextSymbolIndex>=0?nt.centerJustifiedTextSymbolIndex:nt.verticalPlacedTextSymbolIndex),Ti=r.evaluateSizeForFeature(T.textSizeData,ae,bi),Yn=A.get("text-padding");Mn=this.collisionIndex.placeCollisionCircles(De,bi,T.lineVertexArray,T.glyphOffsetArray,Ti,I,O,U,y,Ne,Pe.predicate,nt.collisionCircleDiameter*Ti/r.ONE_EM,Yn,this.retainedQueryData[T.bucketInstanceId].tileID),Kt=De||Mn.circles.length>0&&!Mn.collisionDetected,qt=qt&&Mn.offscreen,gn=Mn.occluded}if(Pt.iconFeatureIndex&&(ir=Pt.iconFeatureIndex),Pt.iconBox){const bi=Ti=>{Rr(Ti);const Yn=tt&&Yt?Ts(Yt.x,Yt.y,Te,Ne,this.transform.angle):new r.pointGeometry(0,0),Pi=T.getSymbolInstanceIconSize(J,this.transform.zoom,kt);return this.collisionIndex.placeCollisionBox(Pi,Ti,Yn,ke,j,I,Pe.predicate)};kn&&kn.box&&kn.box.length&&Pt.verticalIconBox?($n=bi(Pt.verticalIconBox),ft=$n.box.length>0):($n=bi(Pt.iconBox),ft=$n.box.length>0),qt=qt&&$n.offscreen,Xt=$n.occluded}const Uo=_e||nt.numHorizontalGlyphVertices===0&&nt.numVerticalGlyphVertices===0,da=Ae||nt.numIconVertices===0;if(Uo||da?da?Uo||(ft=ft&&Kt):Kt=ft&&Kt:ft=Kt=ft&&Kt,Kt&&dn&&dn.box&&this.collisionIndex.insertCollisionBox(dn.box,A.get("text-ignore-placement"),T.bucketInstanceId,kn&&kn.box&&nr?nr:vi,Pe.ID),ft&&$n&&this.collisionIndex.insertCollisionBox($n.box,A.get("icon-ignore-placement"),T.bucketInstanceId,ir,Pe.ID),Mn&&(Kt&&this.collisionIndex.insertCollisionCircles(Mn.circles,A.get("text-ignore-placement"),T.bucketInstanceId,vi,Pe.ID),y)){const bi=T.bucketInstanceId;let Ti=this.collisionCircleArrays[bi];Ti===void 0&&(Ti=this.collisionCircleArrays[bi]=new Qi);for(let Yn=0;Yn<Mn.circles.length;Yn+=4)Ti.circles.push(Mn.circles[Yn+0]),Ti.circles.push(Mn.circles[Yn+1]),Ti.circles.push(Mn.circles[Yn+2]),Ti.circles.push(Mn.collisionDetected?1:0)}const Vo=this.transform.projection.name!=="globe";pt=pt&&(Vo||!gn),ht=ht&&(Vo||!Xt),this.placements[nt.crossTileID]=new Bo(Kt||pt,ft||ht,qt||T.justReloaded),d[nt.crossTileID]=!0};if(at){const nt=T.getSortedSymbolIndexes(this.transform.angle);for(let kt=nt.length-1;kt>=0;--kt){const Pt=nt[kt];zt(T.symbolInstances.get(Pt),Pt,T.collisionArrays[Pt])}}else for(let nt=o.symbolInstanceStart;nt<o.symbolInstanceEnd;nt++)zt(T.symbolInstances.get(nt),nt,T.collisionArrays[nt]);if(y&&T.bucketInstanceId in this.collisionCircleArrays){const nt=this.collisionCircleArrays[T.bucketInstanceId];r.invert(nt.invProjMatrix,I),nt.viewportMatrix=this.collisionIndex.getViewportMatrix()}T.justReloaded=!1}markUsedJustification(o,d,y,w){let T;T=w===r.WritingMode.vertical?y.verticalPlacedTextSymbolIndex:{left:y.leftJustifiedTextSymbolIndex,center:y.centerJustifiedTextSymbolIndex,right:y.rightJustifiedTextSymbolIndex}[r.getAnchorJustification(d)];const A=[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex,y.verticalPlacedTextSymbolIndex];for(const I of A)I>=0&&(o.text.placedSymbolArray.get(I).crossTileID=T>=0&&I!==T?0:y.crossTileID)}markUsedOrientation(o,d,y){const w=d===r.WritingMode.horizontal||d===r.WritingMode.horizontalOnly?d:0,T=d===r.WritingMode.vertical?d:0,A=[y.leftJustifiedTextSymbolIndex,y.centerJustifiedTextSymbolIndex,y.rightJustifiedTextSymbolIndex];for(const I of A)o.text.placedSymbolArray.get(I).placedOrientation=w;y.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(y.verticalPlacedTextSymbolIndex).placedOrientation=T)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let y=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const w=d?d.symbolFadeChange(o):1,T=d?d.opacities:{},A=d?d.variableOffsets:{},I=d?d.placedOrientations:{};for(const O in this.placements){const U=this.placements[O],V=T[O];V?(this.opacities[O]=new ko(V,w,U.text,U.icon,null,U.clipped),y=y||U.text!==V.text.placed||U.icon!==V.icon.placed):(this.opacities[O]=new ko(null,w,U.text,U.icon,U.skipFade,U.clipped),y=y||U.text||U.icon)}for(const O in T){const U=T[O];if(!this.opacities[O]){const V=new ko(U,w,!1,!1);V.isHidden()||(this.opacities[O]=V,y=y||U.text.placed||U.icon.placed)}}for(const O in A)this.variableOffsets[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.variableOffsets[O]=A[O]);for(const O in I)this.placedOrientations[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.placedOrientations[O]=I[O]);y?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:o)}updateLayerOpacities(o,d){const y={};for(const w of d){const T=w.getBucket(o);T&&w.latestFeatureIndex&&o.id===T.layerIds[0]&&this.updateBucketOpacities(T,y,w.collisionBoxArray)}}updateBucketOpacities(o,d,y){o.hasTextData()&&o.text.opacityVertexArray.clear(),o.hasIconData()&&o.icon.opacityVertexArray.clear(),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const w=o.layers[0].layout,T=!!o.layers[0].dynamicFilter(),A=new ko(null,0,!1,!1,!0),I=w.get("text-allow-overlap"),O=w.get("icon-allow-overlap"),U=w.get("text-variable-anchor"),V=w.get("text-rotation-alignment")==="map",j=w.get("text-pitch-alignment")==="map",ee=w.get("icon-text-fit")!=="none",ce=new ko(null,0,I&&(O||!o.hasIconData()||w.get("icon-optional")),O&&(I||!o.hasTextData()||w.get("text-optional")),!0);!o.collisionArrays&&y&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(y);const ae=(Pe,_e,Ae)=>{for(let De=0;De<_e/4;De++)Pe.opacityVertexArray.emplaceBack(Ae)};let J=0;for(let Pe=0;Pe<o.symbolInstances.length;Pe++){const _e=o.symbolInstances.get(Pe),{numHorizontalGlyphVertices:Ae,numVerticalGlyphVertices:De,crossTileID:ke}=_e;let Te=this.opacities[ke];d[ke]?Te=A:Te||(Te=ce,this.opacities[ke]=Te),d[ke]=!0;const Ne=Ae>0||De>0,tt=_e.numIconVertices>0,at=this.placedOrientations[_e.crossTileID],pt=at===r.WritingMode.vertical,ht=at===r.WritingMode.horizontal||at===r.WritingMode.horizontalOnly;if(!Ne&&!tt||Te.isHidden()||J++,Ne){const zt=xm(Te.text);ae(o.text,Ae,pt?du:zt),ae(o.text,De,ht?du:zt);const nt=Te.text.isHidden();[_e.rightJustifiedTextSymbolIndex,_e.centerJustifiedTextSymbolIndex,_e.leftJustifiedTextSymbolIndex].forEach(Kt=>{Kt>=0&&(o.text.placedSymbolArray.get(Kt).hidden=nt||pt?1:0)}),_e.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(_e.verticalPlacedTextSymbolIndex).hidden=nt||ht?1:0);const kt=this.variableOffsets[_e.crossTileID];kt&&this.markUsedJustification(o,kt.anchor,_e,at);const Pt=this.placedOrientations[_e.crossTileID];Pt&&(this.markUsedJustification(o,"left",_e,Pt),this.markUsedOrientation(o,Pt,_e))}if(tt){const zt=xm(Te.icon);_e.placedIconSymbolIndex>=0&&(ae(o.icon,_e.numIconVertices,pt?du:zt),o.icon.placedSymbolArray.get(_e.placedIconSymbolIndex).hidden=Te.icon.isHidden()),_e.verticalPlacedIconSymbolIndex>=0&&(ae(o.icon,_e.numVerticalIconVertices,ht?du:zt),o.icon.placedSymbolArray.get(_e.verticalPlacedIconSymbolIndex).hidden=Te.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const zt=o.collisionArrays[Pe];if(zt){let nt=new r.pointGeometry(0,0),kt=!0;if(zt.textBox||zt.verticalTextBox){if(U){const Kt=this.variableOffsets[ke];Kt?(nt=Ms(Kt.anchor,Kt.width,Kt.height,Kt.textOffset,Kt.textScale),V&&nt._rotate(j?this.transform.angle:-this.transform.angle)):kt=!1}T&&(kt=!Te.clipped),zt.textBox&&fo(o.textCollisionBox.collisionVertexArray,Te.text.placed,!kt||pt,nt.x,nt.y),zt.verticalTextBox&&fo(o.textCollisionBox.collisionVertexArray,Te.text.placed,!kt||ht,nt.x,nt.y)}const Pt=kt&&!!(!ht&&zt.verticalIconBox);zt.iconBox&&fo(o.iconCollisionBox.collisionVertexArray,Te.icon.placed,Pt,ee?nt.x:0,ee?nt.y:0),zt.verticalIconBox&&fo(o.iconCollisionBox.collisionVertexArray,Te.icon.placed,!Pt,ee?nt.x:0,ee?nt.y:0)}}}if(o.fullyClipped=J===0,o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.bucketInstanceId in this.collisionCircleArrays){const Pe=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=Pe.invProjMatrix,o.placementViewportMatrix=Pe.viewportMatrix,o.collisionCircleArray=Pe.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,d){const y=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*y>o}setStale(){this.stale=!0}}function fo(m,o,d,y,w){m.emplaceBack(o?1:0,d?1:0,y||0,w||0),m.emplaceBack(o?1:0,d?1:0,y||0,w||0),m.emplaceBack(o?1:0,d?1:0,y||0,w||0),m.emplaceBack(o?1:0,d?1:0,y||0,w||0)}const B_=Math.pow(2,25),vm=Math.pow(2,24),Dr=Math.pow(2,17),uu=Math.pow(2,16),ia=Math.pow(2,9),Cd=Math.pow(2,8),hu=Math.pow(2,1);function xm(m){if(m.opacity===0&&!m.placed)return 0;if(m.opacity===1&&m.placed)return 4294967295;const o=m.placed?1:0,d=Math.floor(127*m.opacity);return d*B_+o*vm+d*Dr+o*uu+d*ia+o*Cd+d*hu+o}const du=0;class Ad{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&o.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,d,y,w,T){const A=this._bucketParts;for(;this._currentTileIndex<o.length;)if(d.getBucketParts(A,w,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,T())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort((I,O)=>I.sortKey-O.sortKey));this._currentPartIndex<A.length;){const I=A[this._currentPartIndex];if(d.placeLayerBucketPart(I,this._seenCrossTileIDs,y,I.symbolInstanceStart===0),this._currentPartIndex++,T())return!0}return!1}}class F_{constructor(o,d,y,w,T,A,I,O){this.placement=new k_(o,T,A,I,O),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(o,d,y){const w=r.exported.now(),T=()=>{const A=r.exported.now()-w;return!this._forceFullPlacement&&A>2};for(;this._currentPlacementIndex>=0;){const A=d[o[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=I)&&(!A.maxzoom||A.maxzoom>I)){if(this._inProgressLayer||(this._inProgressLayer=new Ad(A)),this._inProgressLayer.continuePlacement(y[A.source],this.placement,this._showCollisionBoxes,A,T))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const bm=512/r.EXTENT/2;class O_{constructor(o,d,y){this.tileID=o,this.indexedSymbolInstances={},this.bucketInstanceId=y;for(let w=0;w<d.length;w++){const T=d.get(w),A=T.key;this.indexedSymbolInstances[A]||(this.indexedSymbolInstances[A]=[]),this.indexedSymbolInstances[A].push({crossTileID:T.crossTileID,coord:this.getScaledCoordinates(T,o)})}}getScaledCoordinates(o,d){const y=bm/Math.pow(2,d.canonical.z-this.tileID.canonical.z);return{x:Math.floor((d.canonical.x*r.EXTENT+o.tileAnchorX)*y),y:Math.floor((d.canonical.y*r.EXTENT+o.tileAnchorY)*y)}}findMatches(o,d,y){const w=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let T=0;T<o.length;T++){const A=o.get(T);if(A.crossTileID)continue;const I=this.indexedSymbolInstances[A.key];if(!I)continue;const O=this.getScaledCoordinates(A,d);for(const U of I)if(Math.abs(U.coord.x-O.x)<=w&&Math.abs(U.coord.y-O.y)<=w&&!y[U.crossTileID]){y[U.crossTileID]=!0,A.crossTileID=U.crossTileID;break}}}}class wm{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class N_{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const d=Math.round((o-this.lng)/360);if(d!==0)for(const y in this.indexes){const w=this.indexes[y],T={};for(const A in w){const I=w[A];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+d),T[I.tileID.key]=I}this.indexes[y]=T}this.lng=o}addBucket(o,d,y){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let T=0;T<d.symbolInstances.length;T++)d.symbolInstances.get(T).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const w=this.usedCrossTileIDs[o.overscaledZ];for(const T in this.indexes){const A=this.indexes[T];if(Number(T)>o.overscaledZ)for(const I in A){const O=A[I];O.tileID.isChildOf(o)&&O.findMatches(d.symbolInstances,o,w)}else{const I=A[o.scaledTo(Number(T)).key];I&&I.findMatches(d.symbolInstances,o,w)}}for(let T=0;T<d.symbolInstances.length;T++){const A=d.symbolInstances.get(T);A.crossTileID||(A.crossTileID=y.generate(),w[A.crossTileID]=!0)}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new O_(o,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(o,d){for(const y in d.indexedSymbolInstances)for(const w of d.indexedSymbolInstances[y])delete this.usedCrossTileIDs[o][w.crossTileID]}removeStaleBuckets(o){let d=!1;for(const y in this.indexes){const w=this.indexes[y];for(const T in w)o[w[T].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,w[T]),delete w[T],d=!0)}return d}}class pu{constructor(){this.layerIndexes={},this.crossTileIDs=new wm,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,d,y,w){let T=this.layerIndexes[o.id];T===void 0&&(T=this.layerIndexes[o.id]=new N_);let A=!1;const I={};w.name!=="globe"&&T.handleWrapJump(y);for(const O of d){const U=O.getBucket(o);U&&o.id===U.layerIds[0]&&(U.bucketInstanceId||(U.bucketInstanceId=++this.maxBucketInstanceId),T.addBucket(O.tileID,U,this.crossTileIDs)&&(A=!0),I[U.bucketInstanceId]=!0)}return T.removeStaleBuckets(I)&&(A=!0),A}pruneUnusedLayers(o){const d={};o.forEach(y=>{d[y]=!0});for(const y in this.layerIndexes)d[y]||delete this.layerIndexes[y]}}const xl=(m,o)=>r.emitValidationErrors(m,o&&o.filter(d=>d.identifier!=="source.canvas")),Mm=r.pick(_t,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Tm=r.pick(_t,["setCenter","setZoom","setBearing","setPitch"]),Em={version:8,layers:[],sources:{}},Na={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class gr extends r.Evented{constructor(o,d={}){super(),this.map=o,this.dispatcher=new xe(Be(),this),this.imageManager=new me,this.imageManager.setEventedParent(this),this.glyphManager=new r.GlyphManager(o._requestManager,d.localFontFamily?r.LocalGlyphMode.all:d.localIdeographFontFamily?r.LocalGlyphMode.ideographs:r.LocalGlyphMode.none,d.localFontFamily||d.localIdeographFontFamily),this.lineAtlas=new r.LineAtlas(256,512),this.crossTileSymbolIndex=new pu,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new r.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",r.getReferrer());const y=this;this._rtlTextPluginCallback=gr.registerForPluginStateChange(w=>{y.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:w.pluginStatus,pluginURL:w.pluginURL},(T,A)=>{if(r.triggerPluginCompletionEvent(T),A&&A.every(I=>I))for(const I in y._sourceCaches){const O=y._sourceCaches[I],U=O.getSource().type;U!=="vector"&&U!=="geojson"||O.reload()}})}),this.on("data",w=>{if(w.dataType!=="source"||w.sourceDataType!=="metadata")return;const T=this.getSource(w.sourceId);if(T&&T.vectorLayerIds)for(const A in this._layers){const I=this._layers[A];I.source===T.id&&this._validateLayer(I)}})}loadURL(o,d={}){this.fire(new r.Event("dataloading",{dataType:"style"}));const y=typeof d.validate=="boolean"?d.validate:!r.isMapboxURL(o);o=this.map._requestManager.normalizeStyleURL(o,d.accessToken);const w=this.map._requestManager.transformRequest(o,r.ResourceType.Style);this._request=r.getJSON(w,(T,A)=>{this._request=null,T?this.fire(new r.ErrorEvent(T)):A&&this._load(A,y)})}loadJSON(o,d={}){this.fire(new r.Event("dataloading",{dataType:"style"})),this._request=r.exported.frame(()=>{this._request=null,this._load(o,d.validate!==!1)})}loadEmpty(){this.fire(new r.Event("dataloading",{dataType:"style"})),this._load(Em,!1)}_updateLayerCount(o,d){const y=d?1:-1;o.is3D()&&(this._num3DLayers+=y),o.type==="circle"&&(this._numCircleLayers+=y),o.type==="symbol"&&(this._numSymbolLayers+=y)}_load(o,d){if(d&&xl(this,r.validateStyle(o)))return;this._loaded=!0,this.stylesheet=o,this._updateMapProjection();for(const w in o.sources)this.addSource(w,o.sources[w],{validate:!1});this._changed=!1,o.sprite?this._loadSprite(o.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(o.glyphs);const y=Tt(this.stylesheet.layers);this._order=y.map(w=>w.id),this._layers={},this._serializedLayers={};for(let w of y)w=r.createStyleLayer(w),w.setEventedParent(this,{layer:{id:w.id}}),this._layers[w.id]=w,this._serializedLayers[w.id]=w.serialize(),this._updateLayerCount(w,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ve(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new r.Event("data",{dataType:"style"})),this.fire(new r.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}setProjection(o){o?this.stylesheet.projection=o:delete this.stylesheet.projection,this.map._explicitProjection||this.map._updateProjection()}_updateMapProjection(){this.map._explicitProjection?this.applyProjectionUpdate():this.map._updateProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_loadSprite(o){this._spriteRequest=function(d,y,w){let T,A,I;const O=r.exported.devicePixelRatio>1?"@2x":"";let U=r.getJSON(y.transformRequest(y.normalizeSpriteURL(d,O,".json"),r.ResourceType.SpriteJSON),(ee,ce)=>{U=null,I||(I=ee,T=ce,j())}),V=r.getImage(y.transformRequest(y.normalizeSpriteURL(d,O,".png"),r.ResourceType.SpriteImage),(ee,ce)=>{V=null,I||(I=ee,A=ce,j())});function j(){if(I)w(I);else if(T&&A){const ee=r.exported.getImageData(A),ce={};for(const ae in T){const{width:J,height:Pe,x:_e,y:Ae,sdf:De,pixelRatio:ke,stretchX:Te,stretchY:Ne,content:tt}=T[ae],at=new r.RGBAImage({width:J,height:Pe});r.RGBAImage.copy(ee,at,{x:_e,y:Ae},{x:0,y:0},{width:J,height:Pe}),ce[ae]={data:at,pixelRatio:ke,sdf:De,stretchX:Te,stretchY:Ne,content:tt}}w(null,ce)}}return{cancel(){U&&(U.cancel(),U=null),V&&(V.cancel(),V=null)}}}(o,this.map._requestManager,(d,y)=>{if(this._spriteRequest=null,d)this.fire(new r.ErrorEvent(d));else if(y)for(const w in y)this.imageManager.addImage(w,y[w]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new r.Event("data",{dataType:"style"}))})}_validateLayer(o){const d=this.getSource(o.source);if(!d)return;const y=o.sourceLayer;y&&(d.type==="geojson"||d.vectorLayerIds&&d.vectorLayerIds.indexOf(y)===-1)&&this.fire(new r.ErrorEvent(new Error(`Source layer "${y}" does not exist on source "${d.id}" as specified by style layer "${o.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this._sourceCaches)if(!this._sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(o){const d=[];for(const y of o){const w=this._layers[y];w.type!=="custom"&&d.push(w.serialize())}return d}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const o in this._sourceCaches)if(this._sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(o){return!!this.terrain&&Na[o.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(o){if(!this._loaded)return;const d=this._changed;if(this._changed){const w=Object.keys(this._updatedLayers),T=Object.keys(this._removedLayers);(w.length||T.length)&&this._updateWorkerLayers(w,T);for(const A in this._updatedSources){const I=this._updatedSources[A];I==="reload"?this._reloadSource(A):I==="clear"&&this._clearSource(A)}this._updateTilesForChangedImages();for(const A in this._updatedPaintProps)this._layers[A].updateTransitions(o);this.light.updateTransitions(o),this.fog&&this.fog.updateTransitions(o),this._resetUpdates()}const y={};for(const w in this._sourceCaches){const T=this._sourceCaches[w];y[w]=T.used,T.used=!1}for(const w of this._order){const T=this._layers[w];if(T.recalculate(o,this._availableImages),!T.isHidden(o.zoom)){const I=this._getLayerSourceCache(T);I&&(I.used=!0)}const A=this.map.painter;if(A){const I=T.getProgramIds();if(!I)continue;const O=T.getProgramConfiguration(o.zoom);for(const U of I)A.useProgram(U,O)}}for(const w in y){const T=this._sourceCaches[w];y[w]!==T.used&&T.getSource().fire(new r.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:T.getSource().id}))}this.light.recalculate(o),this.terrain&&this.terrain.recalculate(o),this.fog&&this.fog.recalculate(o),this.z=o.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),d&&this.fire(new r.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const d in this._sourceCaches)this._sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateWorkerLayers(o,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(o){if(this._checkLoaded(),xl(this,r.validateStyle(o)))return!1;(o=r.clone$1(o)).layers=Tt(o.layers);const d=function(w,T){if(!w)return[{command:_t.setStyle,args:[T]}];let A=[];try{if(!M(w.version,T.version))return[{command:_t.setStyle,args:[T]}];M(w.center,T.center)||A.push({command:_t.setCenter,args:[T.center]}),M(w.zoom,T.zoom)||A.push({command:_t.setZoom,args:[T.zoom]}),M(w.bearing,T.bearing)||A.push({command:_t.setBearing,args:[T.bearing]}),M(w.pitch,T.pitch)||A.push({command:_t.setPitch,args:[T.pitch]}),M(w.sprite,T.sprite)||A.push({command:_t.setSprite,args:[T.sprite]}),M(w.glyphs,T.glyphs)||A.push({command:_t.setGlyphs,args:[T.glyphs]}),M(w.transition,T.transition)||A.push({command:_t.setTransition,args:[T.transition]}),M(w.light,T.light)||A.push({command:_t.setLight,args:[T.light]}),M(w.fog,T.fog)||A.push({command:_t.setFog,args:[T.fog]}),M(w.projection,T.projection)||A.push({command:_t.setProjection,args:[T.projection]});const I={},O=[];(function(j,ee,ce,ae){let J;for(J in ee=ee||{},j=j||{})j.hasOwnProperty(J)&&(ee.hasOwnProperty(J)||rn(J,ce,ae));for(J in ee)ee.hasOwnProperty(J)&&(j.hasOwnProperty(J)?M(j[J],ee[J])||(j[J].type==="geojson"&&ee[J].type==="geojson"&&Ln(j,ee,J)?ce.push({command:_t.setGeoJSONSourceData,args:[J,ee[J].data]}):Pn(J,ee,ce,ae)):Ot(J,ee,ce))})(w.sources,T.sources,O,I);const U=[];w.layers&&w.layers.forEach(j=>{j.source&&I[j.source]?A.push({command:_t.removeLayer,args:[j.id]}):U.push(j)});let V=w.terrain;V&&I[V.source]&&(A.push({command:_t.setTerrain,args:[void 0]}),V=void 0),A=A.concat(O),M(V,T.terrain)||A.push({command:_t.setTerrain,args:[T.terrain]}),function(j,ee,ce){ee=ee||[];const ae=(j=j||[]).map(un),J=ee.map(un),Pe=j.reduce(Jt,{}),_e=ee.reduce(Jt,{}),Ae=ae.slice(),De=Object.create(null);let ke,Te,Ne,tt,at,pt,ht;for(ke=0,Te=0;ke<ae.length;ke++)Ne=ae[ke],_e.hasOwnProperty(Ne)?Te++:(ce.push({command:_t.removeLayer,args:[Ne]}),Ae.splice(Ae.indexOf(Ne,Te),1));for(ke=0,Te=0;ke<J.length;ke++)Ne=J[J.length-1-ke],Ae[Ae.length-1-ke]!==Ne&&(Pe.hasOwnProperty(Ne)?(ce.push({command:_t.removeLayer,args:[Ne]}),Ae.splice(Ae.lastIndexOf(Ne,Ae.length-Te),1)):Te++,pt=Ae[Ae.length-ke],ce.push({command:_t.addLayer,args:[_e[Ne],pt]}),Ae.splice(Ae.length-ke,0,Ne),De[Ne]=!0);for(ke=0;ke<J.length;ke++)if(Ne=J[ke],tt=Pe[Ne],at=_e[Ne],!De[Ne]&&!M(tt,at))if(M(tt.source,at.source)&&M(tt["source-layer"],at["source-layer"])&&M(tt.type,at.type)){for(ht in Mt(tt.layout,at.layout,ce,Ne,null,_t.setLayoutProperty),Mt(tt.paint,at.paint,ce,Ne,null,_t.setPaintProperty),M(tt.filter,at.filter)||ce.push({command:_t.setFilter,args:[Ne,at.filter]}),M(tt.minzoom,at.minzoom)&&M(tt.maxzoom,at.maxzoom)||ce.push({command:_t.setLayerZoomRange,args:[Ne,at.minzoom,at.maxzoom]}),tt)tt.hasOwnProperty(ht)&&ht!=="layout"&&ht!=="paint"&&ht!=="filter"&&ht!=="metadata"&&ht!=="minzoom"&&ht!=="maxzoom"&&(ht.indexOf("paint.")===0?Mt(tt[ht],at[ht],ce,Ne,ht.slice(6),_t.setPaintProperty):M(tt[ht],at[ht])||ce.push({command:_t.setLayerProperty,args:[Ne,ht,at[ht]]}));for(ht in at)at.hasOwnProperty(ht)&&!tt.hasOwnProperty(ht)&&ht!=="layout"&&ht!=="paint"&&ht!=="filter"&&ht!=="metadata"&&ht!=="minzoom"&&ht!=="maxzoom"&&(ht.indexOf("paint.")===0?Mt(tt[ht],at[ht],ce,Ne,ht.slice(6),_t.setPaintProperty):M(tt[ht],at[ht])||ce.push({command:_t.setLayerProperty,args:[Ne,ht,at[ht]]}))}else ce.push({command:_t.removeLayer,args:[Ne]}),pt=Ae[Ae.lastIndexOf(Ne)+1],ce.push({command:_t.addLayer,args:[at,pt]})}(U,T.layers,A)}catch(I){console.warn("Unable to compute style diff:",I),A=[{command:_t.setStyle,args:[T]}]}return A}(this.serialize(),o).filter(w=>!(w.command in Tm));if(d.length===0)return!1;const y=d.filter(w=>!(w.command in Mm));if(y.length>0)throw new Error(`Unimplemented: ${y.map(w=>w.command).join(", ")}.`);return d.forEach(w=>{w.command!=="setTransition"&&this[w.command].apply(this,w.args)}),this.stylesheet=o,this._updateMapProjection(),!0}addImage(o,d){return this.getImage(o)?this.fire(new r.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(o,d),this._afterImageUpdated(o),this)}updateImage(o,d){this.imageManager.updateImage(o,d)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){return this.getImage(o)?(this.imageManager.removeImage(o),this._afterImageUpdated(o),this):this.fire(new r.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new r.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(o,d,y={}){if(this._checkLoaded(),this.getSource(o)!==void 0)throw new Error("There is already a source with this ID");if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(r.validateSource,`sources.${o}`,d,null,y))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const w=et(o,d,this.dispatcher,this);w.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(o),source:w.serialize(),sourceId:o}));const T=A=>{const I=(A?"symbol:":"other:")+o,O=this._sourceCaches[I]=new r.SourceCache(I,w,A);(A?this._symbolSourceCaches:this._otherSourceCaches)[o]=O,O.style=this,O.onAdd(this.map)};T(!1),d.type!=="vector"&&d.type!=="geojson"||T(!0),w.onAdd&&w.onAdd(this.map),this._changed=!0}removeSource(o){this._checkLoaded();const d=this.getSource(o);if(!d)throw new Error("There is no source with this ID");for(const w in this._layers)if(this._layers[w].source===o)return this.fire(new r.ErrorEvent(new Error(`Source "${o}" cannot be removed while layer "${w}" is using it.`)));if(this.terrain&&this.terrain.get().source===o)return this.fire(new r.ErrorEvent(new Error(`Source "${o}" cannot be removed while terrain is using it.`)));const y=this._getSourceCaches(o);for(const w of y)delete this._sourceCaches[w.id],delete this._updatedSources[w.id],w.fire(new r.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:w.getSource().id})),w.setEventedParent(null),w.clearTiles();return delete this._otherSourceCaches[o],delete this._symbolSourceCaches[o],d.setEventedParent(null),d.onRemove&&d.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(o,d){this._checkLoaded(),this.getSource(o).setData(d),this._changed=!0}getSource(o){const d=this._getSourceCache(o);return d&&d.getSource()}addLayer(o,d,y={}){this._checkLoaded();const w=o.id;if(this.getLayer(w))return void this.fire(new r.ErrorEvent(new Error(`Layer with id "${w}" already exists on this map`)));let T;if(o.type==="custom"){if(xl(this,r.validateCustomStyleLayer(o)))return;T=r.createStyleLayer(o)}else{if(typeof o.source=="object"&&(this.addSource(w,o.source),o=r.clone$1(o),o=r.extend(o,{source:w})),this._validate(r.validateLayer,`layers.${w}`,o,{arrayIndex:-1},y))return;T=r.createStyleLayer(o),this._validateLayer(T),T.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[T.id]=T.serialize(),this._updateLayerCount(T,!0)}const A=d?this._order.indexOf(d):this._order.length;if(d&&A===-1)return void this.fire(new r.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`)));this._order.splice(A,0,w),this._layerOrderChanged=!0,this._layers[w]=T;const I=this._getLayerSourceCache(T);if(this._removedLayers[w]&&T.source&&I&&T.type!=="custom"){const O=this._removedLayers[w];delete this._removedLayers[w],O.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",I.pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(o,d){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new r.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===d)return;const y=this._order.indexOf(o);this._order.splice(y,1);const w=d?this._order.indexOf(d):this._order.length;d&&w===-1?this.fire(new r.ErrorEvent(new Error(`Layer with id "${d}" does not exist on this map.`))):(this._order.splice(w,0,o),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(o){this._checkLoaded();const d=this._layers[o];if(!d)return void this.fire(new r.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be removed.`)));d.setEventedParent(null),this._updateLayerCount(d,!1);const y=this._order.indexOf(o);this._order.splice(y,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=d,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],d.onRemove&&d.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(o){return this._layers[o]}hasLayer(o){return o in this._layers}hasLayerType(o){for(const d in this._layers)if(this._layers[d].type===o)return!0;return!1}setLayerZoomRange(o,d,y){this._checkLoaded();const w=this.getLayer(o);w?w.minzoom===d&&w.maxzoom===y||(d!=null&&(w.minzoom=d),y!=null&&(w.maxzoom=y),this._updateLayer(w)):this.fire(new r.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(o,d,y={}){this._checkLoaded();const w=this.getLayer(o);if(w){if(!M(w.filter,d))return d==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(r.validateFilter,`layers.${w.id}.filter`,d,{layerType:w.type},y)||(w.filter=r.clone$1(d),this._updateLayer(w)))}else this.fire(new r.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be filtered.`)))}getFilter(o){const d=this.getLayer(o);return d&&r.clone$1(d.filter)}setLayoutProperty(o,d,y,w={}){this._checkLoaded();const T=this.getLayer(o);T?M(T.getLayoutProperty(d),y)||(T.setLayoutProperty(d,y,w),this._updateLayer(T)):this.fire(new r.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(o,d){const y=this.getLayer(o);if(y)return y.getLayoutProperty(d);this.fire(new r.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style.`)))}setPaintProperty(o,d,y,w={}){this._checkLoaded();const T=this.getLayer(o);T?M(T.getPaintProperty(d),y)||(T.setPaintProperty(d,y,w)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new r.ErrorEvent(new Error(`The layer '${o}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(o,d){const y=this.getLayer(o);return y&&y.getPaintProperty(d)}setFeatureState(o,d){this._checkLoaded();const y=o.source,w=o.sourceLayer,T=this.getSource(y);if(!T)return void this.fire(new r.ErrorEvent(new Error(`The source '${y}' does not exist in the map's style.`)));const A=T.type;if(A==="geojson"&&w)return void this.fire(new r.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(A==="vector"&&!w)return void this.fire(new r.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));o.id===void 0&&this.fire(new r.ErrorEvent(new Error("The feature id parameter must be provided.")));const I=this._getSourceCaches(y);for(const O of I)O.setFeatureState(w,o.id,d)}removeFeatureState(o,d){this._checkLoaded();const y=o.source,w=this.getSource(y);if(!w)return void this.fire(new r.ErrorEvent(new Error(`The source '${y}' does not exist in the map's style.`)));const T=w.type,A=T==="vector"?o.sourceLayer:void 0;if(T==="vector"&&!A)return void this.fire(new r.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(d&&typeof o.id!="string"&&typeof o.id!="number")return void this.fire(new r.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const I=this._getSourceCaches(y);for(const O of I)O.removeFeatureState(A,o.id,d)}getFeatureState(o){this._checkLoaded();const d=o.source,y=o.sourceLayer,w=this.getSource(d);if(w){if(w.type!=="vector"||y)return o.id===void 0&&this.fire(new r.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(d)[0].getFeatureState(y,o.id);this.fire(new r.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new r.ErrorEvent(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return r.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const o={};for(const d in this._sourceCaches){const y=this._sourceCaches[d].getSource();o[y.id]||(o[y.id]=y.serialize())}return r.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:o,layers:this._serializeLayers(this._order)},d=>d!==void 0)}_updateLayer(o){this._updatedLayers[o.id]=!0;const d=this._getLayerSourceCache(o);o.source&&!this._updatedSources[o.source]&&d&&d.getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",d.pause()),this._changed=!0,o.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(o){const d=A=>this._layers[A].type==="fill-extrusion",y={},w=[];for(let A=this._order.length-1;A>=0;A--){const I=this._order[A];if(d(I)){y[I]=A;for(const O of o){const U=O[I];if(U)for(const V of U)w.push(V)}}}w.sort((A,I)=>I.intersectionZ-A.intersectionZ);const T=[];for(let A=this._order.length-1;A>=0;A--){const I=this._order[A];if(d(I))for(let O=w.length-1;O>=0;O--){const U=w[O].feature;if(y[U.layer.id]<A)break;T.push(U),w.pop()}else for(const O of o){const U=O[I];if(U)for(const V of U)T.push(V.feature)}}return T}queryRenderedFeatures(o,d,y){d&&d.filter&&this._validate(r.validateFilter,"queryRenderedFeatures.filter",d.filter,null,d);const w={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new r.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const O of d.layers){const U=this._layers[O];if(!U)return this.fire(new r.ErrorEvent(new Error(`The layer '${O}' does not exist in the map's style and cannot be queried for features.`))),[];w[U.source]=!0}}const T=[];d.availableImages=this._availableImages;const A=d&&d.layers?d.layers.some(O=>{const U=this.getLayer(O);return U&&U.is3D()}):this.has3DLayers(),I=Ge.createFromScreenPoints(o,y);for(const O in this._sourceCaches){const U=this._sourceCaches[O].getSource().id;d.layers&&!w[U]||T.push(it(this._sourceCaches[O],this._layers,this._serializedLayers,I,d,y,A,!!this.map._showQueryGeometry))}return this.placement&&T.push(function(O,U,V,j,ee,ce,ae){const J={},Pe=ce.queryRenderedSymbols(j),_e=[];for(const Ae of Object.keys(Pe).map(Number))_e.push(ae[Ae]);_e.sort(Vt);for(const Ae of _e){const De=Ae.featureIndex.lookupSymbolFeatures(Pe[Ae.bucketInstanceId],U,Ae.bucketIndex,Ae.sourceLayerIndex,ee.filter,ee.layers,ee.availableImages,O);for(const ke in De){const Te=J[ke]=J[ke]||[],Ne=De[ke];Ne.sort((tt,at)=>{const pt=Ae.featureSortOrder;if(pt){const ht=pt.indexOf(tt.featureIndex);return pt.indexOf(at.featureIndex)-ht}return at.featureIndex-tt.featureIndex});for(const tt of Ne)Te.push(tt)}}for(const Ae in J)J[Ae].forEach(De=>{const ke=De.feature,Te=V(O[Ae]).getFeatureState(ke.layer["source-layer"],ke.id);ke.source=ke.layer.source,ke.layer["source-layer"]&&(ke.sourceLayer=ke.layer["source-layer"]),ke.state=Te});return J}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),I.screenGeometry,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(T)}querySourceFeatures(o,d){d&&d.filter&&this._validate(r.validateFilter,"querySourceFeatures.filter",d.filter,null,d);const y=this._getSourceCaches(o);let w=[];for(const T of y)w=w.concat(vt(T,d));return w}addSourceType(o,d,y){return gr.getSourceType(o)?y(new Error(`A source type called "${o}" already exists.`)):(gr.setSourceType(o,d),d.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:d.workerSourceURL},y):y(null,null))}getLight(){return this.light.getLight()}setLight(o,d={}){this._checkLoaded();const y=this.light.getLight();let w=!1;for(const A in o)if(!M(o[A],y[A])){w=!0;break}if(!w)return;const T={now:r.exported.now(),transition:r.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,d),this.light.updateTransitions(T)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(o,d=1){if(this._checkLoaded(),!o)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(d===1){if(typeof o.source=="object"){const y="terrain-dem-src";this.addSource(y,o.source),o=r.clone$1(o),o=r.extend(o,{source:y})}if(this._validate(r.validateTerrain,"terrain",o))return}if(!this.terrain||this.terrain&&d!==this.terrain.drapeRenderMode)this._createTerrain(o,d);else{const y=this.terrain,w=y.get();for(const T in o)if(!M(o[T],w[T])){y.set(o),this.stylesheet.terrain=o;const A={now:r.exported.now(),transition:r.extend({duration:0},this.stylesheet.transition)};y.updateTransitions(A);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(o){const d=this.fog=new Ie(o,this.map.transform);this.stylesheet.fog=o;const y={now:r.exported.now(),transition:r.extend({duration:0},this.stylesheet.transition)};d.updateTransitions(y)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const o of this.map._markers)o._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(o){if(this._checkLoaded(),!o)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const d=this.fog,y=d.get();for(const w in o)if(!M(o[w],y[w])){d.set(o),this.stylesheet.fog=o;const T={now:r.exported.now(),transition:r.extend({duration:0},this.stylesheet.transition)};d.updateTransitions(T);break}}else this._createFog(o);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const o=this._order.filter(y=>this.isLayerDraped(this._layers[y])),d=this._order.filter(y=>!this.isLayerDraped(this._layers[y]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...o),this._drapedFirstOrder.push(...d)}_createTerrain(o,d){const y=this.terrain=new At(o,d);this.stylesheet.terrain=o,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const w={now:r.exported.now(),transition:r.extend({duration:0},this.stylesheet.transition)};y.updateTransitions(w)}_force3DLayerUpdate(){for(const o in this._layers){const d=this._layers[o];d.type==="fill-extrusion"&&this._updateLayer(d)}}_forceSymbolLayerUpdate(){for(const o in this._layers){const d=this._layers[o];d.type==="symbol"&&this._updateLayer(d)}}_validate(o,d,y,w,T={}){return(!T||T.validate!==!1)&&xl(this,o.call(r.validateStyle,r.extend({key:d,style:this.serialize(),value:y,styleSpec:r.spec},w)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),r.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const o in this._layers)this._layers[o].setEventedParent(null);for(const o in this._sourceCaches)this._sourceCaches[o].clearTiles(),this._sourceCaches[o].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(o){const d=this._getSourceCaches(o);for(const y of d)y.clearTiles()}_reloadSource(o){const d=this._getSourceCaches(o);for(const y of d)y.resume(),y.reload()}_updateSources(o){for(const d in this._sourceCaches)this._sourceCaches[d].update(o)}_generateCollisionBoxes(){for(const o in this._sourceCaches){const d=this._sourceCaches[o];d.resume(),d.reload()}}_updatePlacement(o,d,y,w,T=!1){let A=!1,I=!1;const O={};for(const U of this._order){const V=this._layers[U];if(V.type!=="symbol")continue;if(!O[V.source]){const ee=this._getLayerSourceCache(V);if(!ee)continue;O[V.source]=ee.getRenderableIds(!0).map(ce=>ee.getTileByID(ce)).sort((ce,ae)=>ae.tileID.overscaledZ-ce.tileID.overscaledZ||(ce.tileID.isLessThan(ae.tileID)?-1:1))}const j=this.crossTileSymbolIndex.addLayer(V,O[V.source],o.center.lng,o.projection);A=A||j}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),T=T||this._layerOrderChanged||y===0,this._layerOrderChanged&&this.fire(new r.Event("neworder")),(T||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(r.exported.now(),o.zoom))&&(this.pauseablePlacement=new F_(o,this._order,T,d,y,w,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,O),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(r.exported.now()),I=!0),A&&this.pauseablePlacement.placement.setStale()),I||A)for(const U of this._order){const V=this._layers[U];V.type==="symbol"&&this.placement.updateLayerOpacities(V,O[V.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(r.exported.now())}_releaseSymbolFadeTiles(){for(const o in this._sourceCaches)this._sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,d,y){this.imageManager.getImages(d.icons,y),this._updateTilesForChangedImages();const w=T=>{T&&T.setDependencies(d.tileID.key,d.type,d.icons)};w(this._otherSourceCaches[d.source]),w(this._symbolSourceCaches[d.source])}getGlyphs(o,d,y){this.glyphManager.getGlyphs(d.stacks,y)}getResource(o,d,y){return r.makeRequest(d,y)}_getSourceCache(o){return this._otherSourceCaches[o]}_getLayerSourceCache(o){return o.type==="symbol"?this._symbolSourceCaches[o.source]:this._otherSourceCaches[o.source]}_getSourceCaches(o){const d=[];return this._otherSourceCaches[o]&&d.push(this._otherSourceCaches[o]),this._symbolSourceCaches[o]&&d.push(this._symbolSourceCaches[o]),d}_isSourceCacheLoaded(o){const d=this._getSourceCaches(o);return d.length===0?(this.fire(new r.ErrorEvent(new Error(`There is no source with ID '${o}'`))),!1):d.every(y=>y.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}gr.getSourceType=function(m){return Qe[m]},gr.setSourceType=function(m,o){Qe[m]=o},gr.registerForPluginStateChange=r.registerForPluginStateChange;var bl=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#define EXTENT 8192.0
#define HALF_PI PI/2.0
#define QUARTER_PI PI/4.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}
#endif`,wl="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Ua={},ra={};Ua=yn("",`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
#ifdef TERRAIN_DEM_FLOAT_FORMAT
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;
#else
uniform sampler2D u_dem;uniform sampler2D u_dem_prev;
#endif
uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));
#ifdef TERRAIN_DEM_NEAREST_FILTER
return u_exaggeration*tl;
#endif
float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {return currentElevation(apos);}
#endif
float unpack_depth(vec4 rgba_depth)
{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
float tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;
#else
vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);
#endif
return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,!0),ra=yn(`#ifdef FOG
uniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,`#ifdef FOG
uniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,!0);const fu=yn(`
highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef TERRAIN
highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#endif`,`
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered.`),Ml=bl;var Tl={background:yn(`uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:yn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:yn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
gl_FragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
vec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);
#else 
mat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)
view_scale*=a_scale;
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;
#else
vec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:yn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:yn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);
#ifdef PROJECTION_GLOBE_VIEW
extrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
vec3 pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:yn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:yn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:yn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}",`attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:yn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}",`attribute vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;
#endif
varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:yn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:yn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:yn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:yn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:yn(`varying vec4 v_color;void main() {vec4 color=v_color;
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);
#else
vec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionPattern:yn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
gl_FragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
attribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);
#else
vec3 p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),hillshadePrepare:yn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
return texture2D(u_image,coord).a/4.0;
#else
vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;
#endif
}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:yn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef FOG
gl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:yn(`uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
#ifdef RENDER_LINE_GRADIENT
vec4 out_color=texture2D(u_gradient_image,v_uv);
#else
vec4 out_color=color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef RENDER_LINE_ALPHA_DISCARD
if (alpha < u_alpha_discard_threshold) {discard;}
#endif
gl_FragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define EXTRUDE_SCALE 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;
#ifdef RENDER_LINE_GRADIENT
attribute vec3 a_packed;
#else
attribute float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;varying highp vec2 v_uv;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash_from
#pragma mapbox: define lowp vec4 dash_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash_from
#pragma mapbox: initialize lowp vec4 dash_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_GRADIENT
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);
#endif
#ifdef RENDER_LINE_DASH
float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:yn(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:yn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef FOG
out_color=fog_dither(fog_apply(out_color,v_fog_pos));
#endif
gl_FragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),symbolIcon:yn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);
#else
vec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);
#endif
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}`),symbolSDF:yn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);
#else
vec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);
#endif
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}`),symbolTextAndIcon:yn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
vec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);
#else
vec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);
#endif
#ifdef PROJECTED_POS_ON_VIEWPORT
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);
#else
vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}`),terrainRaster:yn(`uniform sampler2D u_image0;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
void main() {vec4 color=texture2D(u_image0,v_pos0);
#ifdef FOG
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
gl_FragColor=color;
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;
#ifdef FOG
varying float v_fog_opacity;
#endif
const float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;
#ifdef TERRAIN_WIREFRAME
elevation+=u_skirt_height*u_skirt_height*wireframeOffset;
#endif
vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
}`),terrainDepth:yn(`#ifdef GL_ES
precision highp float;
#endif
varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:yn(`
varying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,wl),skyboxGradient:yn(`varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,wl),skyboxCapture:yn(`
varying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;
#ifdef GL_ES
precision highp float;
#endif
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}`,"attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:yn(`uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);
#ifdef TERRAIN_WIREFRAME
gl_FragColor=vec4(1.0,0.0,0.0,0.8);
#endif
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;
#ifdef GLOBE_POLES
attribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;
#else
attribute vec2 a_pos;
#endif
varying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 merc_pos=a_merc_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;uv=uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);
#ifdef TERRAIN_WIREFRAME
height+=wireframeOffset;
#endif
vec4 globe=u_globe_matrix*vec4(globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}`),globeAtmosphere:yn(`uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;varying highp vec3 v_ray_dir;void main() {highp vec3 dir=normalize(v_ray_dir);highp vec3 closest_point=abs(dot(u_globe_pos,dir))*dir;float norm_dist_from_center=length(closest_point-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 1.0)
discard;float t=clamp(1.0-sqrt(norm_dist_from_center-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}`,"attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;varying highp vec3 v_ray_dir;void main() {v_ray_dir=mix(mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);gl_Position=vec4(a_pos,1.0);}")};function yn(m,o,d){const y=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,w=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,T=o.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),A=m.match(w),I=o.match(w),O=bl.match(w);let U=I?I.concat(A):A;d||(Ua.staticUniforms&&(U=Ua.staticUniforms.concat(U)),ra.staticUniforms&&(U=ra.staticUniforms.concat(U))),U&&(U=U.concat(O));const V={};return{fragmentSource:m=m.replace(y,(j,ee,ce,ae,J)=>(V[J]=!0,ee==="define"?`
#ifndef HAS_UNIFORM_u_${J}
varying ${ce} ${ae} ${J};
#else
uniform ${ce} ${ae} u_${J};
#endif
`:`
#ifdef HAS_UNIFORM_u_${J}
    ${ce} ${ae} ${J} = u_${J};
#endif
`)),vertexSource:o=o.replace(y,(j,ee,ce,ae,J)=>{const Pe=ae==="float"?"vec2":"vec4",_e=J.match(/color/)?"color":Pe;return V[J]?ee==="define"?`
#ifndef HAS_UNIFORM_u_${J}
uniform lowp float u_${J}_t;
attribute ${ce} ${Pe} a_${J};
varying ${ce} ${ae} ${J};
#else
uniform ${ce} ${ae} u_${J};
#endif
`:_e==="vec4"?`
#ifndef HAS_UNIFORM_u_${J}
    ${J} = a_${J};
#else
    ${ce} ${ae} ${J} = u_${J};
#endif
`:`
#ifndef HAS_UNIFORM_u_${J}
    ${J} = unpack_mix_${_e}(a_${J}, u_${J}_t);
#else
    ${ce} ${ae} ${J} = u_${J};
#endif
`:ee==="define"?`
#ifndef HAS_UNIFORM_u_${J}
uniform lowp float u_${J}_t;
attribute ${ce} ${Pe} a_${J};
#else
uniform ${ce} ${ae} u_${J};
#endif
`:_e==="vec4"?`
#ifndef HAS_UNIFORM_u_${J}
    ${ce} ${ae} ${J} = a_${J};
#else
    ${ce} ${ae} ${J} = u_${J};
#endif
`:`
#ifndef HAS_UNIFORM_u_${J}
    ${ce} ${ae} ${J} = unpack_mix_${_e}(a_${J}, u_${J}_t);
#else
    ${ce} ${ae} ${J} = u_${J};
#endif
`}),staticAttributes:T,staticUniforms:U}}class mu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,d,y,w,T,A,I,O){this.context=o;let U=this.boundPaintVertexBuffers.length!==w.length;for(let V=0;!U&&V<w.length;V++)this.boundPaintVertexBuffers[V]!==w[V]&&(U=!0);o.extVertexArrayObject&&this.vao&&this.boundProgram===d&&this.boundLayoutVertexBuffer===y&&!U&&this.boundIndexBuffer===T&&this.boundVertexOffset===A&&this.boundDynamicVertexBuffer===I&&this.boundDynamicVertexBuffer2===O?(o.bindVertexArrayOES.set(this.vao),I&&I.bind(),T&&T.dynamicDraw&&T.bind(),O&&O.bind()):this.freshBind(d,y,w,T,A,I,O)}freshBind(o,d,y,w,T,A,I){let O;const U=o.numAttributes,V=this.context,j=V.gl;if(V.extVertexArrayObject)this.vao&&this.destroy(),this.vao=V.extVertexArrayObject.createVertexArrayOES(),V.bindVertexArrayOES.set(this.vao),O=0,this.boundProgram=o,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=w,this.boundVertexOffset=T,this.boundDynamicVertexBuffer=A,this.boundDynamicVertexBuffer2=I;else{O=V.currentNumAttributes||0;for(let ee=U;ee<O;ee++)j.disableVertexAttribArray(ee)}d.enableAttributes(j,o);for(const ee of y)ee.enableAttributes(j,o);A&&A.enableAttributes(j,o),I&&I.enableAttributes(j,o),d.bind(),d.setVertexAttribPointers(j,o,T);for(const ee of y)ee.bind(),ee.setVertexAttribPointers(j,o,T);A&&(A.bind(),A.setVertexAttribPointers(j,o,T)),w&&w.bind(),I&&(I.bind(),I.setVertexAttribPointers(j,o,T)),V.currentNumAttributes=U}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Cm(m,o){const d=Math.pow(2,o.canonical.z),y=o.canonical.y;return[new r.MercatorCoordinate(0,y/d).toLngLat().lat,new r.MercatorCoordinate(0,(y+1)/d).toLngLat().lat]}function Am(m,o,d,y,w,T,A){const I=m.context,O=I.gl,U=d.fbo;if(!U)return;m.prepareDrawTile();const V=m.useProgram("hillshade");I.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,U.colorAttachment.get());const j=((J,Pe,_e,Ae)=>{const De=_e.paint.get("hillshade-shadow-color"),ke=_e.paint.get("hillshade-highlight-color"),Te=_e.paint.get("hillshade-accent-color");let Ne=_e.paint.get("hillshade-illumination-direction")*(Math.PI/180);_e.paint.get("hillshade-illumination-anchor")==="viewport"&&(Ne-=J.transform.angle);const tt=!J.options.moving;return{u_matrix:Ae||J.transform.calculateProjMatrix(Pe.tileID.toUnwrapped(),tt),u_image:0,u_latrange:Cm(0,Pe.tileID),u_light:[_e.paint.get("hillshade-exaggeration"),Ne],u_shadow:De,u_highlight:ke,u_accent:Te}})(m,d,y,m.terrain?o.projMatrix:null);m.prepareDrawProgram(I,V,o.toUnwrapped());const{tileBoundsBuffer:ee,tileBoundsIndexBuffer:ce,tileBoundsSegments:ae}=m.getTileBoundsBuffers(d);V.draw(I,O.TRIANGLES,w,T,A,r.CullFaceMode.disabled,j,y.id,ee,ce,ae)}function Sd(m,o,d){if(!o.needsDEMTextureUpload)return;const y=m.context,w=y.gl;y.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||m.getTileTexture(d.stride);const T=d.getPixels();o.demTexture?o.demTexture.update(T,{premultiply:!1}):o.demTexture=new r.Texture(y,T,w.RGBA,{premultiply:!1}),o.needsDEMTextureUpload=!1}function Dd(m,o,d,y,w,T){const A=m.context,I=A.gl;if(!o.dem)return;const O=o.dem;if(A.activeTexture.set(I.TEXTURE1),Sd(m,o,O),!o.demTexture)return;o.demTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE);const U=O.dim;A.activeTexture.set(I.TEXTURE0);let V=o.fbo;if(!V){const ae=new r.Texture(A,{width:U,height:U,data:null},I.RGBA);ae.bind(I.LINEAR,I.CLAMP_TO_EDGE),V=o.fbo=A.createFramebuffer(U,U,!0),V.colorAttachment.set(ae.texture)}A.bindFramebuffer.set(V.framebuffer),A.viewport.set([0,0,U,U]);const{tileBoundsBuffer:j,tileBoundsIndexBuffer:ee,tileBoundsSegments:ce}=m.getMercatorTileBoundsBuffers();m.useProgram("hillshadePrepare").draw(A,I.TRIANGLES,y,w,T,r.CullFaceMode.disabled,((ae,J)=>{const Pe=J.stride,_e=r.create();return r.ortho(_e,0,r.EXTENT,-r.EXTENT,0,0,1),r.translate(_e,_e,[0,-r.EXTENT,0]),{u_matrix:_e,u_image:1,u_dimension:[Pe,Pe],u_zoom:ae.overscaledZ,u_unpack:J.unpackVector}})(o.tileID,O),d.id,j,ee,ce),o.needsHillshadePrepare=!1}const Pd=(m,o)=>({u_matrix:new r.UniformMatrix4f(m,o.u_matrix),u_image0:new r.Uniform1i(m,o.u_image0),u_skirt_height:new r.Uniform1f(m,o.u_skirt_height)}),Sm=(m,o)=>({u_matrix:m,u_image0:0,u_skirt_height:o}),Dm=(m,o,d,y,w,T)=>({u_proj_matrix:Float32Array.from(m),u_globe_matrix:o,u_merc_matrix:d,u_zoom_transition:y,u_merc_center:w,u_image0:0,u_grid_matrix:T?Float32Array.from(T):new Float32Array(9)});function gu(m,o){return m!=null&&o!=null&&!(!m.hasData()||!o.hasData())&&m.demTexture!=null&&o.demTexture!=null&&m.tileID.key!==o.tileID.key}const oa=new class{constructor(){this.operations={}}newMorphing(m,o,d,y,w){if(m in this.operations){const T=this.operations[m];T.to.tileID.key!==d.tileID.key&&(T.queued=d)}else this.operations[m]={startTime:y,phase:0,duration:w,from:o,to:d,queued:null}}getMorphValuesForProxy(m){if(!(m in this.operations))return null;const o=this.operations[m];return{from:o.from,to:o.to,phase:o.phase}}update(m){for(const o in this.operations){const d=this.operations[o];for(d.phase=(m-d.startTime)/d.duration;d.phase>=1||!this._validOp(d);)if(!this._nextOp(d,m)){delete this.operations[o];break}}}_nextOp(m,o){return!!m.queued&&(m.from=m.to,m.to=m.queued,m.queued=null,m.phase=0,m.startTime=o,!0)}_validOp(m){return m.from.hasData()&&m.to.hasData()}},Es={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Ld(m,o){const d=1<<m.z;return!o&&(m.x===0||m.x===d-1)||m.y===0||m.y===d-1}const yu=m=>({u_matrix:m});function Id(m,o,d,y,w){if(w>0){const T=r.exported.now(),A=(T-m.timeAdded)/w,I=o?(T-o.timeAdded)/w:-1,O=d.getSource(),U=y.coveringZoomLevel({tileSize:O.tileSize,roundZoom:O.roundZoom}),V=!o||Math.abs(o.tileID.overscaledZ-U)>Math.abs(m.tileID.overscaledZ-U),j=V&&m.refreshedUponExpiration?1:r.clamp(V?A:1-I,0,1);return m.refreshedUponExpiration&&A>=1&&(m.refreshedUponExpiration=!1),o?{opacity:1,mix:1-j}:{opacity:j,mix:0}}return{opacity:1,mix:0}}const U_=2*r.mercatorZfromAltitude(1,0)*r.GLOBE_RADIUS*Math.PI;class El extends r.SourceCache{constructor(o){const d={type:"raster-dem",maxzoom:o.transform.maxZoom},y=new xe(Be(),null),w=et("mock-dem",d,y,o.style);super("mock-dem",w,!1),w.setEventedParent(this),this._sourceLoaded=!0}_loadTile(o,d){o.state="loaded",d(null)}}class Cl extends r.SourceCache{constructor(o){const d=et("proxy",{type:"geojson",maxzoom:o.transform.maxZoom},new xe(Be(),null),o.style);super("proxy",d,!1),d.setEventedParent(this),this.map=this.getSource().map=o,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(o,d,y){if(o.freezeTileCoverage)return;this.transform=o;const w=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((T,A)=>{if(T[A.key]="",!this._tiles[A.key]){const I=new r.Tile(A,this._source.tileSize*A.overscaleFactor(),o.tileZoom);I.state="loaded",this._tiles[A.key]=I}return T},{});for(const T in this._tiles)T in w||(this.freeFBO(T),this._tiles[T].unloadVectorData(),delete this._tiles[T])}freeFBO(o){const d=this.proxyCachedFBO[o];if(d!==void 0){const y=Object.values(d);this.renderCachePool.push(...y),delete this.proxyCachedFBO[o]}}deallocRenderCache(){this.renderCache.forEach(o=>o.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Rd extends r.OverscaledTileID{constructor(o,d,y){super(o.overscaledZ,o.wrap,o.canonical.z,o.canonical.x,o.canonical.y),this.proxyTileKey=d,this.projMatrix=y}}class Pr extends r.Elevation{constructor(o,d){super(),this.painter=o,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[y,w,T]=function(O){const U=new r.StructArrayLayout4i8,V=new r.StructArrayLayout3ui6,j=131;U.reserve(17161),V.reserve(33800);const ee=r.EXTENT/128,ce=r.EXTENT+ee/2,ae=ce+ee;for(let Pe=-ee;Pe<ae;Pe+=ee)for(let _e=-ee;_e<ae;_e+=ee){const Ae=_e<0||_e>ce||Pe<0||Pe>ce?24575:0,De=r.clamp(Math.round(_e),0,r.EXTENT),ke=r.clamp(Math.round(Pe),0,r.EXTENT);U.emplaceBack(De+Ae,ke,De,ke)}const J=(Pe,_e)=>{const Ae=_e*j+Pe;V.emplaceBack(Ae+1,Ae,Ae+j),V.emplaceBack(Ae+j,Ae+j+1,Ae+1)};for(let Pe=1;Pe<129;Pe++)for(let _e=1;_e<129;_e++)J(_e,Pe);return[0,129].forEach(Pe=>{for(let _e=0;_e<130;_e++)J(_e,Pe),J(Pe,_e)}),[U,V,32768]}(),A=o.context;this.gridBuffer=A.createVertexBuffer(y,r.boundsAttributes.members),this.gridIndexBuffer=A.createIndexBuffer(w),this.gridSegments=r.SegmentVector.simpleSegment(0,0,y.length,w.length),this.gridNoSkirtSegments=r.SegmentVector.simpleSegment(0,0,y.length,T),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Cl(d.map),this.orthoMatrix=r.create(),r.ortho(this.orthoMatrix,0,r.EXTENT,0,r.EXTENT,0,1);const I=A.gl;this._overlapStencilMode=new r.StencilMode({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=o.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=d,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new El(d.map)}set style(o){o.on("data",this._onStyleDataEvent.bind(this)),o.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=o,this._checkRenderCacheEfficiency()}update(o,d,y){if(o&&o.terrain){this._style!==o&&(this.style=o),this.enabled=!0;const w=o.terrain.properties;this.sourceCache=o.terrain.drapeRenderMode===0?this._mockSourceCache:o._getSourceCache(w.get("source")),this._exaggeration=w.get("exaggeration");const T=()=>{this.sourceCache.used&&r.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const A=this.getScaledDemTileSize();this.sourceCache.update(d,A,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,T(),this._initializing=!0),T(),d.updateElevation(!y),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(d),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(o){this._findCoveringTileCache[o]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const o=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||o.efficiency!==100&&r.warnOnce(`Terrain render cache efficiency is not optimal (${o.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${o.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(o){o.coord&&o.dataType==="source"?this._clearRenderCacheForTile(o.sourceCacheId,o.coord):o.dataType==="style"&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const o in this._style._sourceCaches)this._style._sourceCaches[o].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(o=>o.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const o=2*this.proxySourceCache.getSource().tileSize;return[o,o]}set useVertexMorphing(o){this._useVertexMorphing=o}updateTileBinding(o){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const d=this.proxySourceCache,y=this.painter.transform;this._initializing&&(this._initializing=y._centerAltitude===0&&this.getAtPointOrZero(r.MercatorCoordinate.fromLngLat(y.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const w=this.proxyCoords=d.getIds().map(O=>{const U=d.getTileByID(O).tileID;return U.projMatrix=y.calculateProjMatrix(U.toUnwrapped()),U});(function(O,U){const V=U.transform.pointCoordinate(U.transform.getCameraPoint()),j=new r.pointGeometry(V.x,V.y);O.sort((ee,ce)=>{if(ce.overscaledZ-ee.overscaledZ)return ce.overscaledZ-ee.overscaledZ;const ae=new r.pointGeometry(ee.canonical.x+(1<<ee.canonical.z)*ee.wrap,ee.canonical.y),J=new r.pointGeometry(ce.canonical.x+(1<<ce.canonical.z)*ce.wrap,ce.canonical.y),Pe=j.mult(1<<ee.canonical.z);return Pe.x-=.5,Pe.y-=.5,Pe.distSqr(ae)-Pe.distSqr(J)})})(w,this.painter),this._previousZoom=y.zoom;const T=this.proxyToSource||{};this.proxyToSource={},w.forEach(O=>{this.proxyToSource[O.key]={}}),this.terrainTileForTile={};const A=this._style._sourceCaches;for(const O in A){const U=A[O];if(!U.used||(U!==this.sourceCache&&this.resetTileLookupCache(U.id),this._setupProxiedCoordsForOrtho(U,o[O],T),U.usedForTerrain))continue;const V=o[O];U.getSource().reparseOverscaled&&this._assignTerrainTiles(V)}this.proxiedCoords[d.id]=w.map(O=>new Rd(O,O.key,this.orthoMatrix)),this._assignTerrainTiles(w),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(T),this.renderingToTexture=!1,this._updateTimestamp=r.exported.now();const I={};this._visibleDemTiles=[];for(const O of this.proxyCoords){const U=this.terrainTileForTile[O.key];if(!U)continue;const V=U.tileID.key;V in I||(this._visibleDemTiles.push(U),I[V]=V)}}_assignTerrainTiles(o){this._initializing||o.forEach(d=>{if(this.terrainTileForTile[d.key])return;const y=this._findTileCoveringTileID(d,this.sourceCache);y&&(this.terrainTileForTile[d.key]=y)})}_prepareDEMTextures(){const o=this.painter.context,d=o.gl;for(const y in this.terrainTileForTile){const w=this.terrainTileForTile[y],T=w.dem;!T||w.demTexture&&!w.needsDEMTextureUpload||(o.activeTexture.set(d.TEXTURE1),Sd(this.painter,w,T))}}_prepareDemTileUniforms(o,d,y,w){if(!d||d.demTexture==null)return!1;const T=o.tileID.canonical,A=Math.pow(2,d.tileID.canonical.z-T.z),I=w||"";return y[`u_dem_tl${I}`]=[T.x*A%1,T.y*A%1],y[`u_dem_scale${I}`]=A,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const o=this.painter.context,d=o.gl;if(!this._emptyDepthBufferTexture){const y=new r.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new r.Texture(o,y,d.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let o=0;const d=this._visibleDemTiles.reduce((y,w)=>{if(!w.dem)return y;const T=w.dem.tree.minimums[0];return T>0&&o++,y+T},0);return o?d/o:0}_updateEmptyDEMTexture(){const o=this.painter.context,d=o.gl;o.activeTexture.set(d.TEXTURE2);const y=this._getLoadedAreaMinimum(),w=new r.RGBAImage({width:1,height:1},new Uint8Array(r.DEMData.pack(y,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let T=this._emptyDEMTexture;return T?T.update(w,{premultiply:!1}):T=this._emptyDEMTexture=new r.Texture(o,w,d.RGBA,{premultiply:!1}),T}setupElevationDraw(o,d,y){const w=this.painter.context,T=w.gl,A=(I=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:r.DEMData.getUnpackVector(I),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var I;A.u_dem_size=this.sourceCache.getSource().tileSize,A.u_exaggeration=this.exaggeration();const O=this.painter.transform,U=O.projection,V=o.tileID.canonical;A.u_tile_tl_up=U.upVector(V,0,0),A.u_tile_tr_up=U.upVector(V,r.EXTENT,0),A.u_tile_br_up=U.upVector(V,r.EXTENT,r.EXTENT),A.u_tile_bl_up=U.upVector(V,0,r.EXTENT),A.u_tile_up_scale=y&&y.useDenormalizedUpVectorScale?U_:U.upVectorScale(V,O.center.lat,O.worldSize).metersToTile;let j=null,ee=null,ce=1;if(y&&y.morphing&&this._useVertexMorphing){const ae=y.morphing.srcDemTile,J=y.morphing.dstDemTile;ce=y.morphing.phase,ae&&J&&(this._prepareDemTileUniforms(o,ae,A,"_prev")&&(ee=ae),this._prepareDemTileUniforms(o,J,A)&&(j=J))}if(ee&&j?(w.activeTexture.set(T.TEXTURE2),j.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE,T.NEAREST),w.activeTexture.set(T.TEXTURE4),ee.demTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE,T.NEAREST),A.u_dem_lerp=ce):(j=this.terrainTileForTile[o.tileID.key],w.activeTexture.set(T.TEXTURE2),(this._prepareDemTileUniforms(o,j,A)?j.demTexture:this.emptyDEMTexture).bind(T.NEAREST,T.CLAMP_TO_EDGE)),w.activeTexture.set(T.TEXTURE3),y&&y.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),this._depthFBO&&(A.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(T.NEAREST,T.CLAMP_TO_EDGE),A.u_depth_size_inv=[1,1]),y&&y.useMeterToDem&&j){const ae=(1<<j.tileID.canonical.z)*r.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;A.u_meter_to_dem=ae}y&&y.labelPlaneMatrixInv&&(A.u_label_plane_matrix_inv=y.labelPlaneMatrixInv),d.setTerrainUniformValues(w,A)}renderToBackBuffer(o){const d=this.painter,y=this.painter.context;o.length!==0&&(y.bindFramebuffer.set(null),y.viewport.set([0,0,d.width,d.height]),this.renderingToTexture=!1,function(w,T,A,I,O){if(w.transform.projection.name==="globe")(function(U,V,j,ee,ce){const ae=U.context,J=ae.gl;let Pe,_e;const Ae=U.options.showTerrainWireframe?2:0,De=(ht,zt)=>{if(_e===ht)return;const nt=[Es[ht],"PROJECTION_GLOBE_VIEW"];zt&&nt.push(Es[Ae]),Pe=U.useProgram("globeRaster",null,nt),_e=ht},ke=U.colorModeForRenderPass(),Te=new r.DepthMode(J.LEQUAL,r.DepthMode.ReadWrite,U.depthRangeFor3D);oa.update(ce);const Ne=U.transform,tt=r.calculateGlobeMercatorMatrix(Ne),at=[r.mercatorXfromLng(Ne.center.lng),r.mercatorYfromLat(Ne.center.lat)],pt=U.globeSharedBuffers;if((Ae?[!1,!0]:[!1]).forEach(ht=>{_e=-1;const zt=ht?J.LINES:J.TRIANGLES;for(const nt of ee){const kt=j.getTile(nt),Pt=r.StencilMode.disabled,Kt=V.prevTerrainTileForTile[nt.key],ft=V.terrainTileForTile[nt.key];gu(Kt,ft)&&oa.newMorphing(nt.key,Kt,ft,ce,250),ae.activeTexture.set(J.TEXTURE0),kt.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);const qt=oa.getMorphValuesForProxy(nt.key),gn=qt?1:0,Xt={useDenormalizedUpVectorScale:!0};qt&&r.extend$1(Xt,{morphing:{srcDemTile:qt.from,dstDemTile:qt.to,phase:r.easeCubicInOut(qt.phase)}});const Yt=Float32Array.from(Ne.globeMatrix),xn=r.globeTileLatLngCorners(nt.canonical),kn=r.getGridMatrix(nt.canonical,xn),dn=Dm(Ne.projMatrix,Yt,tt,r.globeToMercatorTransition(Ne.zoom),at,kn);if(De(gn,ht),V.setupElevationDraw(kt,Pe,Xt),U.prepareDrawProgram(ae,Pe,nt.toUnwrapped()),pt){const[Mn,$n,vi]=ht?pt.getWirefameBuffers(U.context):pt.getGridBuffers();Pe.draw(ae,zt,Te,Pt,ke,r.CullFaceMode.backCCW,dn,"globe_raster",Mn,$n,vi)}}}),pt){Pe=U.useProgram("globeRaster",null,["GLOBE_POLES","PROJECTION_GLOBE_VIEW"]);for(const ht of ee){const{x:zt,y:nt,z:kt}=ht.canonical,Pt=nt===0,Kt=nt===(1<<kt)-1,[ft,qt,gn,Xt]=pt.getPoleBuffers(kt);if(Xt&&(Pt||Kt)){const Yt=j.getTile(ht);ae.activeTexture.set(J.TEXTURE0),Yt.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);let xn=r.globePoleMatrixForTile(kt,zt,Ne);const kn=(dn,Mn)=>dn.draw(ae,J.TRIANGLES,Te,r.StencilMode.disabled,ke,r.CullFaceMode.disabled,Dm(Ne.projMatrix,xn,xn,0,at),"globe_pole_raster",Mn,gn,Xt);V.setupElevationDraw(Yt,Pe,{}),U.prepareDrawProgram(ae,Pe,ht.toUnwrapped()),Pt&&kn(Pe,ft),Kt&&(xn=r.scale(r.create(),xn,[1,-1,1]),kn(Pe,qt))}}}})(w,T,A,I,O);else{const U=w.context,V=U.gl;let j,ee;const ce=w.options.showTerrainWireframe?2:0,ae=(De,ke)=>{if(ee===De)return;const Te=[Es[De]];ke&&Te.push(Es[ce]),j=w.useProgram("terrainRaster",null,Te),ee=De},J=w.colorModeForRenderPass(),Pe=new r.DepthMode(V.LEQUAL,r.DepthMode.ReadWrite,w.depthRangeFor3D);oa.update(O);const _e=w.transform,Ae=6*Math.pow(1.5,22-_e.zoom)*T.exaggeration();(ce?[!1,!0]:[!1]).forEach(De=>{ee=-1;const ke=De?V.LINES:V.TRIANGLES,[Te,Ne]=De?T.getWirefameBuffer():[T.gridIndexBuffer,T.gridSegments];for(const tt of I){const at=A.getTile(tt),pt=r.StencilMode.disabled,ht=T.prevTerrainTileForTile[tt.key],zt=T.terrainTileForTile[tt.key];gu(ht,zt)&&oa.newMorphing(tt.key,ht,zt,O,250),U.activeTexture.set(V.TEXTURE0),at.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE,V.LINEAR_MIPMAP_NEAREST);const nt=oa.getMorphValuesForProxy(tt.key),kt=nt?1:0;let Pt;nt&&(Pt={morphing:{srcDemTile:nt.from,dstDemTile:nt.to,phase:r.easeCubicInOut(nt.phase)}});const Kt=Sm(tt.projMatrix,Ld(tt.canonical,_e.renderWorldCopies)?Ae/10:Ae);ae(kt,De),T.setupElevationDraw(at,j,Pt),w.prepareDrawProgram(U,j,tt.toUnwrapped()),j.draw(U,ke,Pe,pt,J,r.CullFaceMode.backCCW,Kt,"terrain_raster",T.gridBuffer,Te,Ne)}})}}(d,this,this.proxySourceCache,o,this._updateTimestamp),this.renderingToTexture=!0,o.splice(0,o.length))}renderBatch(o){if(this._drapedRenderBatches.length===0)return o+1;this.renderingToTexture=!0;const d=this.painter,y=this.painter.context,w=this.proxySourceCache,T=this.proxiedCoords[w.id],A=this._drapedRenderBatches.shift(),I=[],O=d.style.order;let U=0;for(const V of T){const j=w.getTileByID(V.proxyTileKey),ee=w.proxyCachedFBO[V.key]?w.proxyCachedFBO[V.key][o]:void 0,ce=ee!==void 0?w.renderCache[ee]:this.pool[U++],ae=ee!==void 0;if(j.texture=ce.tex,ae&&!ce.dirty){I.push(j.tileID);continue}let J;y.bindFramebuffer.set(ce.fb.framebuffer),this.renderedToTile=!1,ce.dirty&&(y.clear({color:r.Color.transparent,stencil:0}),ce.dirty=!1);for(let Pe=A.start;Pe<=A.end;++Pe){const _e=d.style._layers[O[Pe]];if(_e.isHidden(d.transform.zoom))continue;const Ae=d.style._getLayerSourceCache(_e),De=Ae?this.proxyToSource[V.key][Ae.id]:[V];if(!De)continue;const ke=De;y.viewport.set([0,0,ce.fb.width,ce.fb.height]),J!==(Ae?Ae.id:null)&&(this._setupStencil(ce,De,_e,Ae),J=Ae?Ae.id:null),d.renderLayer(d,Ae,_e,ke)}this.renderedToTile?(ce.dirty=!0,I.push(j.tileID)):ae||--U,U===5&&(U=0,this.renderToBackBuffer(I))}return this.renderToBackBuffer(I),this.renderingToTexture=!1,y.bindFramebuffer.set(null),y.viewport.set([0,0,d.width,d.height]),A.end+1}postRender(){}renderCacheEfficiency(o){const d=o.order.length;if(d===0)return{efficiency:100};let y,w=0,T=0,A=!1;for(let I=0;I<d;++I){const O=o._layers[o.order[I]];this._style.isLayerDraped(O)?(A&&++w,++T):A||(A=!0,y=O.id)}return T===0?{efficiency:100}:{efficiency:100*(1-w/T),firstUndrapedLayer:y}}getMinElevationBelowMSL(){let o=0;return this._visibleDemTiles.filter(d=>d.dem).forEach(d=>{o=Math.min(o,d.dem.tree.minimums[0])}),o===0?o:(o-30)*this._exaggeration}raycast(o,d,y){if(!this._visibleDemTiles)return null;const w=this._visibleDemTiles.filter(T=>T.dem).map(T=>{const A=T.tileID,I=Math.pow(2,A.overscaledZ),{x:O,y:U}=A.canonical,V=O/I,j=(O+1)/I,ee=U/I,ce=(U+1)/I;return{minx:V,miny:ee,maxx:j,maxy:ce,t:T.dem.tree.raycastRoot(V,ee,j,ce,o,d,y),tile:T}});w.sort((T,A)=>(T.t!==null?T.t:Number.MAX_VALUE)-(A.t!==null?A.t:Number.MAX_VALUE));for(const T of w){if(T.t==null)return null;const A=T.tile.dem.tree.raycast(T.minx,T.miny,T.maxx,T.maxy,o,d,y);if(A!=null)return A}return null}_createFBO(){const o=this.painter.context,d=o.gl,y=this.drapeBufferSize;o.activeTexture.set(d.TEXTURE0);const w=new r.Texture(o,{width:y[0],height:y[1],data:null},d.RGBA);w.bind(d.LINEAR,d.CLAMP_TO_EDGE);const T=o.createFramebuffer(y[0],y[1],!1);return T.colorAttachment.set(w.texture),T.depthAttachment=new Cr(o,T.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=o.createRenderbuffer(o.gl.DEPTH_STENCIL,y[0],y[1]),this._stencilRef=0,T.depthAttachment.set(this._sharedDepthStencil),o.clear({stencil:0})):T.depthAttachment.set(this._sharedDepthStencil),o.extTextureFilterAnisotropic&&!o.extTextureFilterAnisotropicForceOff&&d.texParameterf(d.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax),{fb:T,tex:w,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const o in this._style._sourceCaches)if(this._style._sourceCaches[o].hasTransition())return!0;return this._style.order.some(o=>{const d=this._style._layers[o],y=d.isHidden(this.painter.transform.zoom),w=d.getCrossfadeParameters(),T=!!w&&w.t!==1,A=d.hasTransition();return d.type!=="custom"&&!y&&(T||A)})}_clearRasterFadeFromRenderCache(){let o=!1;for(const d in this._style._sourceCaches)if(this._style._sourceCaches[d]._source instanceof Y){o=!0;break}if(o)for(let d=0;d<this._style.order.length;++d){const y=this._style._layers[this._style.order[d]],w=y.isHidden(this.painter.transform.zoom),T=this._style._getLayerSourceCache(y);if(y.type!=="raster"||w||!T)continue;const A=y.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const O=this.proxyToSource[I.key][T.id];if(O)for(const U of O){const V=Id(T.getTile(U),T.findLoadedParent(U,0),T,this.painter.transform,A);(V.opacity!==1||V.mix!==0)&&this._clearRenderCacheForTile(T.id,U)}}}}_setupDrapedRenderBatches(){const o=this._style.order,d=o.length;if(d===0)return;const y=[];let w,T=0,A=this._style._layers[o[T]];for(;!this._style.isLayerDraped(A)&&A.isHidden(this.painter.transform.zoom)&&++T<d;)A=this._style._layers[o[T]];for(;T<d;++T){const I=this._style._layers[o[T]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?w===void 0&&(w=T):w!==void 0&&(y.push({start:w,end:T-1}),w=void 0))}w!==void 0&&y.push({start:w,end:T-1}),this._drapedRenderBatches=y}_setupRenderCache(o){const d=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,d.renderCache.length>d.renderCachePool.length){const A=Object.values(d.proxyCachedFBO);d.proxyCachedFBO={};for(let I=0;I<A.length;++I){const O=Object.values(A[I]);d.renderCachePool.push(...O)}}return}this._clearRasterFadeFromRenderCache();const y=this.proxyCoords,w=this._tilesDirty;for(let A=y.length-1;A>=0;A--){const I=y[A];if(d.getTileByID(I.key),d.proxyCachedFBO[I.key]!==void 0){const O=o[I.key],U=this.proxyToSource[I.key];let V=0;for(const j in U){const ee=U[j],ce=O[j];if(!ce||ce.length!==ee.length||ee.some((ae,J)=>ae!==ce[J]||w[j]&&w[j].hasOwnProperty(ae.key))){V=-1;break}++V}for(const j in d.proxyCachedFBO[I.key])d.renderCache[d.proxyCachedFBO[I.key][j]].dirty=V<0||V!==Object.values(O).length}}const T=[...this._drapedRenderBatches];T.sort((A,I)=>I.end-I.start-(A.end-A.start));for(const A of T)for(const I of y){if(d.proxyCachedFBO[I.key])continue;let O=d.renderCachePool.pop();O===void 0&&d.renderCache.length<50&&(O=d.renderCache.length,d.renderCache.push(this._createFBO())),O!==void 0&&(d.proxyCachedFBO[I.key]={},d.proxyCachedFBO[I.key][A.start]=O,d.renderCache[O].dirty=!0)}this._tilesDirty={}}_setupStencil(o,d,y,w){if(!w||!this._sourceTilesOverlap[w.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const T=this.painter.context,A=T.gl;if(d.length<=1)return void(this._overlapStencilType=!1);let I;if(y.isTileClipped())I=d.length,this._overlapStencilMode.test={func:A.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(d[0].overscaledZ>d[d.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:A.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(T.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,y.isTileClipped()&&this._renderTileClippingMasks(d,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(o){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs.get(o.key)||0),this._overlapStencilMode):r.StencilMode.disabled}_renderTileClippingMasks(o,d){const y=this.painter,w=this.painter.context,T=w.gl;y._tileClippingMaskIDs.clear(),w.setColorMode(r.ColorMode.disabled),w.setDepthMode(r.DepthMode.disabled);const A=y.useProgram("clippingMask");for(const I of o){const O=--d;y._tileClippingMaskIDs.set(I.key,O),A.draw(w,T.TRIANGLES,r.DepthMode.disabled,new r.StencilMode({func:T.ALWAYS,mask:0},O,255,T.KEEP,T.KEEP,T.REPLACE),r.ColorMode.disabled,r.CullFaceMode.disabled,yu(I.projMatrix),"$clipping",y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}}pointCoordinate(o){const d=this.painter.transform;if(o.x<0||o.x>d.width||o.y<0||o.y>d.height)return null;const y=[o.x,o.y,1,1];r.transformMat4$1(y,y,d.pixelMatrixInverse),r.scale$1(y,y,1/y[3]),y[0]/=d.worldSize,y[1]/=d.worldSize;const w=d._camera.position,T=r.mercatorZfromAltitude(1,d.center.lat),A=[w[0],w[1],w[2]/T,0],I=r.subtract([],y.slice(0,3),A);r.normalize(I,I);const O=this.raycast(A,I,this._exaggeration);return O!==null&&O?(r.scaleAndAdd(A,A,I,O),A[3]=A[2],A[2]*=T,A):null}drawDepth(){const o=this.painter,d=o.context,y=this.proxySourceCache,w=Math.ceil(o.width),T=Math.ceil(o.height);if(!this._depthFBO||this._depthFBO.width===w&&this._depthFBO.height===T||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const A=d.gl,I=d.createFramebuffer(w,T,!0);d.activeTexture.set(A.TEXTURE0);const O=new r.Texture(d,{width:w,height:T,data:null},A.RGBA);O.bind(A.NEAREST,A.CLAMP_TO_EDGE),I.colorAttachment.set(O.texture);const U=d.createRenderbuffer(d.gl.DEPTH_COMPONENT16,w,T);I.depthAttachment.set(U),this._depthFBO=I,this._depthTexture=O}d.bindFramebuffer.set(this._depthFBO.framebuffer),d.viewport.set([0,0,w,T]),function(A,I,O,U){if(A.transform.projection.name==="globe")return;const V=A.context,j=V.gl;V.clear({depth:1});const ee=A.useProgram("terrainDepth"),ce=new r.DepthMode(j.LESS,r.DepthMode.ReadWrite,A.depthRangeFor3D);for(const ae of U){const J=O.getTile(ae),Pe=Sm(ae.projMatrix,0);I.setupElevationDraw(J,ee),ee.draw(V,j.TRIANGLES,ce,r.StencilMode.disabled,r.ColorMode.unblended,r.CullFaceMode.backCCW,Pe,"terrain_depth",I.gridBuffer,I.gridIndexBuffer,I.gridNoSkirtSegments)}}(o,this,y,this.proxyCoords)}_setupProxiedCoordsForOrtho(o,d,y){if(o.getSource()instanceof We)return this._setupProxiedCoordsForImageSource(o,d,y);this._findCoveringTileCache[o.id]=this._findCoveringTileCache[o.id]||{};const w=this.proxiedCoords[o.id]=[],T=this.proxyCoords;for(let I=0;I<T.length;I++){const O=T[I],U=this._findTileCoveringTileID(O,o);if(U){const V=this._createProxiedId(O,U,y[O.key]&&y[O.key][o.id]);w.push(V),this.proxyToSource[O.key][o.id]=[V]}}let A=!1;for(let I=0;I<d.length;I++){const O=o.getTile(d[I]);if(!O||!O.hasData())continue;const U=this._findTileCoveringTileID(O.tileID,this.proxySourceCache);if(U&&U.tileID.canonical.z!==O.tileID.canonical.z){const V=this.proxyToSource[U.tileID.key][o.id],j=this._createProxiedId(U.tileID,O,y[U.tileID.key]&&y[U.tileID.key][o.id]);V?V.splice(V.length-1,0,j):this.proxyToSource[U.tileID.key][o.id]=[j],w.push(j),A=!0}}this._sourceTilesOverlap[o.id]=A}_setupProxiedCoordsForImageSource(o,d,y){if(!o.getSource().loaded())return;const w=this.proxiedCoords[o.id]=[],T=this.proxyCoords,A=o.getSource(),I=new r.pointGeometry(A.tileID.x,A.tileID.y)._div(1<<A.tileID.z),O=A.coordinates.map(r.MercatorCoordinate.fromLngLat).reduce((V,j)=>(V.min.x=Math.min(V.min.x,j.x-I.x),V.min.y=Math.min(V.min.y,j.y-I.y),V.max.x=Math.max(V.max.x,j.x-I.x),V.max.y=Math.max(V.max.y,j.y-I.y),V),{min:new r.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new r.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),U=(V,j)=>{const ee=V.wrap+V.canonical.x/(1<<V.canonical.z),ce=V.canonical.y/(1<<V.canonical.z),ae=r.EXTENT/(1<<V.canonical.z),J=j.wrap+j.canonical.x/(1<<j.canonical.z),Pe=j.canonical.y/(1<<j.canonical.z);return ee+ae<J+O.min.x||ee>J+O.max.x||ce+ae<Pe+O.min.y||ce>Pe+O.max.y};for(let V=0;V<T.length;V++){const j=T[V];for(let ee=0;ee<d.length;ee++){const ce=o.getTile(d[ee]);if(!ce||!ce.hasData()||U(j,ce.tileID))continue;const ae=this._createProxiedId(j,ce,y[j.key]&&y[j.key][o.id]),J=this.proxyToSource[j.key][o.id];J?J.push(ae):this.proxyToSource[j.key][o.id]=[ae],w.push(ae)}}}_createProxiedId(o,d,y){let w=this.orthoMatrix;if(y){const T=y.find(A=>A.key===d.tileID.key);if(T)return T}if(d.tileID.key!==o.key){const T=o.canonical.z-d.tileID.canonical.z;let A,I,O;w=r.create();const U=d.tileID.wrap-o.wrap<<o.overscaledZ;T>0?(A=r.EXTENT>>T,I=A*((d.tileID.canonical.x<<T)-o.canonical.x+U),O=A*((d.tileID.canonical.y<<T)-o.canonical.y)):(A=r.EXTENT<<-T,I=r.EXTENT*(d.tileID.canonical.x-(o.canonical.x+U<<-T)),O=r.EXTENT*(d.tileID.canonical.y-(o.canonical.y<<-T))),r.ortho(w,0,A,0,A,0,1),r.translate(w,w,[I,O,0])}return new Rd(d.tileID,o.key,w)}_findTileCoveringTileID(o,d){let y=d.getTile(o);if(y&&y.hasData())return y;const w=this._findCoveringTileCache[d.id],T=w[o.key];if(y=T?d.getTileByID(T):null,y&&y.hasData()||T===null)return y;let A=y?y.tileID:o,I=A.overscaledZ;const O=d.getSource().minzoom,U=[];if(!T){const j=d.getSource().maxzoom;if(o.canonical.z>=j){const ee=o.canonical.z-j;d.getSource().reparseOverscaled?(I=Math.max(o.canonical.z+2,d.transform.tileZoom),A=new r.OverscaledTileID(I,o.wrap,j,o.canonical.x>>ee,o.canonical.y>>ee)):ee!==0&&(I=j,A=new r.OverscaledTileID(I,o.wrap,j,o.canonical.x>>ee,o.canonical.y>>ee))}A.key!==o.key&&(U.push(A.key),y=d.getTile(A))}const V=j=>{U.forEach(ee=>{w[ee]=j}),U.length=0};for(I-=1;I>=O&&(!y||!y.hasData());I--){y&&V(y.tileID.key);const j=A.calculateScaledKey(I);if(y=d.getTileByID(j),y&&y.hasData())break;const ee=w[j];if(ee===null)break;ee===void 0?U.push(j):y=d.getTileByID(ee)}return V(y?y.tileID.key:null),y&&y.hasData()?y:null}findDEMTileFor(o){return this.enabled?this._findTileCoveringTileID(o,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(o,d){let y=this._tilesDirty[o];y||(y=this._tilesDirty[o]={}),y[d.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const o=function(d){let y=0;const w=new r.StructArrayLayout2ui4,T=131;for(let A=1;A<129;A++){for(let I=1;I<129;I++)y=A*T+I,w.emplaceBack(y,y+1),w.emplaceBack(y,y+T),w.emplaceBack(y+1,y+T),A===128&&w.emplaceBack(y+T,y+T+1);w.emplaceBack(y+1,y+1+T)}return w}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(o),this.wireframeSegments=r.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,o.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function _u(m){const o=[];for(let d=0;d<m.length;d++){if(m[d]===null)continue;const y=m[d].split(" ");o.push(y.pop())}return o}class Al{static cacheKey(o,d,y){let w=`${o}${y?y.cacheKey:""}`;for(const T of d)w+=`/${T}`;return w}constructor(o,d,y,w,T,A){const I=o.gl;this.program=I.createProgram();const O=_u(y.staticAttributes),U=w?w.getBinderAttributes():[],V=O.concat(U),j=y.staticUniforms?_u(y.staticUniforms):[],ee=w?w.getBinderUniforms():[],ce=j.concat(ee),ae=[];for(const Te of ce)ae.indexOf(Te)<0&&ae.push(Te);let J=w?w.defines():[];J=J.concat(A.map(Te=>`#define ${Te}`));const Pe=J.concat(`
#ifdef GL_ES
precision mediump float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Ml,fu.fragmentSource,ra.fragmentSource,y.fragmentSource).join(`
`),_e=J.concat(`
#ifdef GL_ES
precision highp float;
#else

#if !defined(lowp)
#define lowp
#endif

#if !defined(mediump)
#define mediump
#endif

#if !defined(highp)
#define highp
#endif

#endif`,Ml,fu.vertexSource,ra.vertexSource,Ua.vertexSource,y.vertexSource).join(`
`),Ae=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(Ae,Pe),I.compileShader(Ae),I.attachShader(this.program,Ae);const De=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(De,_e),I.compileShader(De),I.attachShader(this.program,De),this.attributes={};const ke={};this.numAttributes=V.length;for(let Te=0;Te<this.numAttributes;Te++)V[Te]&&(I.bindAttribLocation(this.program,Te,V[Te]),this.attributes[V[Te]]=Te);I.linkProgram(this.program),I.deleteShader(De),I.deleteShader(Ae);for(let Te=0;Te<ae.length;Te++){const Ne=ae[Te];if(Ne&&!ke[Ne]){const tt=I.getUniformLocation(this.program,Ne);tt&&(ke[Ne]=tt)}}this.fixedUniforms=T(o,ke),this.binderUniforms=w?w.getUniforms(o,ke):[],A.indexOf("TERRAIN")!==-1&&(this.terrainUniforms=((Te,Ne)=>({u_dem:new r.Uniform1i(Te,Ne.u_dem),u_dem_prev:new r.Uniform1i(Te,Ne.u_dem_prev),u_dem_unpack:new r.Uniform4f(Te,Ne.u_dem_unpack),u_dem_tl:new r.Uniform2f(Te,Ne.u_dem_tl),u_dem_scale:new r.Uniform1f(Te,Ne.u_dem_scale),u_dem_tl_prev:new r.Uniform2f(Te,Ne.u_dem_tl_prev),u_dem_scale_prev:new r.Uniform1f(Te,Ne.u_dem_scale_prev),u_dem_size:new r.Uniform1f(Te,Ne.u_dem_size),u_dem_lerp:new r.Uniform1f(Te,Ne.u_dem_lerp),u_exaggeration:new r.Uniform1f(Te,Ne.u_exaggeration),u_depth:new r.Uniform1i(Te,Ne.u_depth),u_depth_size_inv:new r.Uniform2f(Te,Ne.u_depth_size_inv),u_meter_to_dem:new r.Uniform1f(Te,Ne.u_meter_to_dem),u_label_plane_matrix_inv:new r.UniformMatrix4f(Te,Ne.u_label_plane_matrix_inv),u_tile_tl_up:new r.Uniform3f(Te,Ne.u_tile_tl_up),u_tile_tr_up:new r.Uniform3f(Te,Ne.u_tile_tr_up),u_tile_br_up:new r.Uniform3f(Te,Ne.u_tile_br_up),u_tile_bl_up:new r.Uniform3f(Te,Ne.u_tile_bl_up),u_tile_up_scale:new r.Uniform1f(Te,Ne.u_tile_up_scale)}))(o,ke)),A.indexOf("FOG")!==-1&&(this.fogUniforms=((Te,Ne)=>({u_fog_matrix:new r.UniformMatrix4f(Te,Ne.u_fog_matrix),u_fog_range:new r.Uniform2f(Te,Ne.u_fog_range),u_fog_color:new r.Uniform4f(Te,Ne.u_fog_color),u_fog_horizon_blend:new r.Uniform1f(Te,Ne.u_fog_horizon_blend),u_fog_temporal_offset:new r.Uniform1f(Te,Ne.u_fog_temporal_offset)}))(o,ke))}setTerrainUniformValues(o,d){if(!this.terrainUniforms)return;const y=this.terrainUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const w in d)y[w].set(d[w])}}setFogUniformValues(o,d){if(!this.fogUniforms)return;const y=this.fogUniforms;if(!this.failedToCreate){o.program.set(this.program);for(const w in d)y[w].location&&y[w].set(d[w])}}draw(o,d,y,w,T,A,I,O,U,V,j,ee,ce,ae,J,Pe){const _e=o.gl;if(this.failedToCreate)return;o.program.set(this.program),o.setDepthMode(y),o.setStencilMode(w),o.setColorMode(T),o.setCullFace(A);for(const De of Object.keys(this.fixedUniforms))this.fixedUniforms[De].set(I[De]);ae&&ae.setUniforms(o,this.binderUniforms,ee,{zoom:ce});const Ae={[_e.LINES]:2,[_e.TRIANGLES]:3,[_e.LINE_STRIP]:1}[d];for(const De of j.get()){const ke=De.vaos||(De.vaos={});(ke[O]||(ke[O]=new mu)).bind(o,this,U,ae?ae.getPaintVertexBuffers():[],V,De.vertexOffset,J,Pe),_e.drawElements(d,De.primitiveLength*Ae,_e.UNSIGNED_SHORT,De.primitiveOffset*Ae*2)}}}function Sl(m,o,d){const y=1/He(d,1,o.transform.tileZoom),w=Math.pow(2,d.tileID.overscaledZ),T=d.tileSize*Math.pow(2,o.transform.tileZoom)/w,A=T*(d.tileID.canonical.x+d.tileID.wrap*w),I=T*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[y,m.fromScale,m.toScale],u_fade:m.t,u_pixel_coord_upper:[A>>16,I>>16],u_pixel_coord_lower:[65535&A,65535&I]}}const zd=r.create(),vu=(m,o,d,y,w,T,A,I,O)=>{const U=o.style.light,V=U.properties.get("position"),j=[V.x,V.y,V.z],ee=r.create$1();U.properties.get("anchor")==="viewport"&&(r.fromRotation(ee,-o.transform.angle),r.transformMat3(j,j,ee));const ce=U.properties.get("color"),ae=o.transform,J={u_matrix:m,u_lightpos:j,u_lightintensity:U.properties.get("intensity"),u_lightcolor:[ce.r,ce.g,ce.b],u_vertical_gradient:+d,u_opacity:y,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:zd,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0};return ae.projection.name==="globe"&&(J.u_tile_id=[w.canonical.x,w.canonical.y,1<<w.canonical.z],J.u_zoom_transition=A,J.u_inv_rot_matrix=O,J.u_merc_center=I,J.u_up_dir=ae.projection.upVector(new r.CanonicalTileID(0,0,0),I[0]*r.EXTENT,I[1]*r.EXTENT),J.u_height_lift=T),J},xu=(m,o,d,y,w,T,A,I,O,U,V)=>{const j=vu(m,o,d,y,w,I,O,U,V),ee={u_height_factor:-Math.pow(2,w.overscaledZ)/A.tileSize/8};return r.extend(j,Sl(T,o,A),ee)},bu=m=>({u_matrix:m}),wu=(m,o,d,y)=>r.extend(bu(m),Sl(d,o,y)),Mu=(m,o)=>({u_matrix:m,u_world:o}),Pm=(m,o,d,y,w)=>r.extend(wu(m,o,d,y),{u_world:w}),Lm=r.create(),Cs=(m,o,d,y,w,T)=>{const A=m.transform,I=A.projection.name==="globe";let O;if(T.paint.get("circle-pitch-alignment")==="map")if(I){const V=r.globePixelsToTileUnits(A.zoom,o.canonical);O=Float32Array.from([V,0,0,V])}else O=A.calculatePixelsToTileUnitsMatrix(d);else O=new Float32Array([A.pixelsToGLUnits[0],0,0,A.pixelsToGLUnits[1]]);const U={u_camera_to_center_distance:A.cameraToCenterDistance,u_matrix:m.translatePosMatrix(o.projMatrix,d,T.paint.get("circle-translate"),T.paint.get("circle-translate-anchor")),u_device_pixel_ratio:r.exported.devicePixelRatio,u_extrude_scale:O,u_inv_rot_matrix:Lm,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return I&&(U.u_inv_rot_matrix=y,U.u_merc_center=w,U.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],U.u_zoom_transition=r.globeToMercatorTransition(A.zoom),U.u_up_dir=A.projection.upVector(o.canonical,w[0],w[1])),U},V_=m=>{const o=[];return m.paint.get("circle-pitch-alignment")==="map"&&o.push("PITCH_WITH_MAP"),m.paint.get("circle-pitch-scale")==="map"&&o.push("SCALE_WITH_MAP"),o},G_=(m,o,d)=>{const y=r.EXTENT/d.tileSize;return{u_matrix:m,u_camera_to_center_distance:o.cameraToCenterDistance,u_extrude_scale:[o.pixelsToGLUnits[0]/y,o.pixelsToGLUnits[1]/y]}},Im=(m,o,d=1)=>({u_matrix:m,u_color:o,u_overlay:0,u_overlay_scale:d}),H_=r.create(),W_=(m,o,d,y,w,T,A)=>{const I=m.transform,O=I.projection.name==="globe",U=O?r.globePixelsToTileUnits(I.zoom,o.canonical):He(d,1,T),V={u_matrix:o.projMatrix,u_extrude_scale:U,u_intensity:A,u_inv_rot_matrix:H_,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return O&&(V.u_inv_rot_matrix=y,V.u_merc_center=w,V.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],V.u_zoom_transition=r.globeToMercatorTransition(I.zoom),V.u_up_dir=I.projection.upVector(o.canonical,w[0],w[1])),V},j_=(m,o,d,y,w,T,A)=>{const I=m.transform,O=I.calculatePixelsToTileUnitsMatrix(o),U={u_matrix:Va(m,o,d,w),u_pixels_to_tile_units:O,u_device_pixel_ratio:A,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:T,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(Bd(d)){const V=Tu(o,m.transform);U.u_texsize=o.lineAtlasTexture.size,U.u_scale=[V,y.fromScale,y.toScale],U.u_mix=y.t}return U},kd=(m,o,d,y,w,T)=>{const A=m.transform,I=Tu(o,A);return{u_matrix:Va(m,o,d,w),u_texsize:o.imageAtlasTexture.size,u_pixels_to_tile_units:A.calculatePixelsToTileUnitsMatrix(o),u_device_pixel_ratio:T,u_image:0,u_scale:[I,y.fromScale,y.toScale],u_fade:y.t,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Tu(m,o){return 1/He(m,1,o.tileZoom)}function Va(m,o,d,y){return m.translatePosMatrix(y||o.tileID.projMatrix,o,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}function Bd(m){const o=m.paint.get("line-dasharray").value;return o.value||o.kind!=="constant"}const Rm=(m,o,d,y,w,T)=>{return{u_matrix:m,u_tl_parent:o,u_scale_parent:d,u_fade_t:y.mix,u_opacity:y.opacity*w.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:w.paint.get("raster-brightness-min"),u_brightness_high:w.paint.get("raster-brightness-max"),u_saturation_factor:(I=w.paint.get("raster-saturation"),I>0?1-1/(1.001-I):-I),u_contrast_factor:(A=w.paint.get("raster-contrast"),A>0?1/(1-A):1+A),u_spin_weights:Fd(w.paint.get("raster-hue-rotate")),u_perspective_transform:T};var A,I};function Fd(m){m*=Math.PI/180;const o=Math.sin(m),d=Math.cos(m);return[(2*d+1)/3,(-Math.sqrt(3)*o-d+1)/3,(Math.sqrt(3)*o-d+1)/3]}const aa=r.create(),Od=(m,o,d,y,w,T,A,I,O,U,V,j,ee,ce)=>{const ae=w.transform,J={u_is_size_zoom_constant:+(m==="constant"||m==="source"),u_is_size_feature_constant:+(m==="constant"||m==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:ae.cameraToCenterDistance,u_rotate_symbol:+d,u_aspect_ratio:ae.width/ae.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:T,u_label_plane_matrix:A,u_coord_matrix:I,u_is_text:+O,u_pitch_with_map:+y,u_texsize:U,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:aa,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:aa};return ae.projection.name==="globe"&&(J.u_tile_id=[V.canonical.x,V.canonical.y,1<<V.canonical.z],J.u_zoom_transition=j,J.u_inv_rot_matrix=ce,J.u_merc_center=ee,J.u_camera_forward=ae._camera.forward(),J.u_ecef_origin=r.globeECEFOrigin(ae.globeMatrix,V.toUnwrapped()),J.u_tile_matrix=Float32Array.from(ae.globeMatrix)),J},Ga=(m,o,d,y,w,T,A,I,O,U,V,j,ee,ce,ae)=>{const{cameraToCenterDistance:J,_pitch:Pe}=w.transform;return r.extend(Od(m,o,d,y,w,T,A,I,O,U,j,ee,ce,ae),{u_gamma_scale:y?J*Math.cos(w.terrain?0:Pe):1,u_device_pixel_ratio:r.exported.devicePixelRatio,u_is_halo:+V})},As=(m,o,d,y,w,T,A,I,O,U,V,j,ee,ce)=>r.extend(Ga(m,o,d,y,w,T,A,I,!0,O,!0,V,j,ee,ce),{u_texsize_icon:U,u_texture_icon:1}),zm=(m,o,d)=>({u_matrix:m,u_opacity:o,u_color:d}),Nd=(m,o,d,y,w,T)=>r.extend(function(A,I,O,U){const V=O.imageManager.getPattern(A.from.toString()),j=O.imageManager.getPattern(A.to.toString()),{width:ee,height:ce}=O.imageManager.getPixelSize(),ae=Math.pow(2,U.tileID.overscaledZ),J=U.tileSize*Math.pow(2,O.transform.tileZoom)/ae,Pe=J*(U.tileID.canonical.x+U.tileID.wrap*ae),_e=J*U.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:V.tl,u_pattern_br_a:V.br,u_pattern_tl_b:j.tl,u_pattern_br_b:j.br,u_texsize:[ee,ce],u_mix:I.t,u_pattern_size_a:V.displaySize,u_pattern_size_b:j.displaySize,u_scale_a:I.fromScale,u_scale_b:I.toScale,u_tile_units_to_pixels:1/He(U,1,O.transform.tileZoom),u_pixel_coord_upper:[Pe>>16,_e>>16],u_pixel_coord_lower:[65535&Pe,65535&_e]}}(y,T,d,w),{u_matrix:m,u_opacity:o}),Qn={fillExtrusion:(m,o)=>({u_matrix:new r.UniformMatrix4f(m,o.u_matrix),u_lightpos:new r.Uniform3f(m,o.u_lightpos),u_lightintensity:new r.Uniform1f(m,o.u_lightintensity),u_lightcolor:new r.Uniform3f(m,o.u_lightcolor),u_vertical_gradient:new r.Uniform1f(m,o.u_vertical_gradient),u_opacity:new r.Uniform1f(m,o.u_opacity),u_tile_id:new r.Uniform3f(m,o.u_tile_id),u_zoom_transition:new r.Uniform1f(m,o.u_zoom_transition),u_inv_rot_matrix:new r.UniformMatrix4f(m,o.u_inv_rot_matrix),u_merc_center:new r.Uniform2f(m,o.u_merc_center),u_up_dir:new r.Uniform3f(m,o.u_up_dir),u_height_lift:new r.Uniform1f(m,o.u_height_lift)}),fillExtrusionPattern:(m,o)=>({u_matrix:new r.UniformMatrix4f(m,o.u_matrix),u_lightpos:new r.Uniform3f(m,o.u_lightpos),u_lightintensity:new r.Uniform1f(m,o.u_lightintensity),u_lightcolor:new r.Uniform3f(m,o.u_lightcolor),u_vertical_gradient:new r.Uniform1f(m,o.u_vertical_gradient),u_height_factor:new r.Uniform1f(m,o.u_height_factor),u_tile_id:new r.Uniform3f(m,o.u_tile_id),u_zoom_transition:new r.Uniform1f(m,o.u_zoom_transition),u_inv_rot_matrix:new r.UniformMatrix4f(m,o.u_inv_rot_matrix),u_merc_center:new r.Uniform2f(m,o.u_merc_center),u_up_dir:new r.Uniform3f(m,o.u_up_dir),u_height_lift:new r.Uniform1f(m,o.u_height_lift),u_image:new r.Uniform1i(m,o.u_image),u_texsize:new r.Uniform2f(m,o.u_texsize),u_pixel_coord_upper:new r.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new r.Uniform2f(m,o.u_pixel_coord_lower),u_scale:new r.Uniform3f(m,o.u_scale),u_fade:new r.Uniform1f(m,o.u_fade),u_opacity:new r.Uniform1f(m,o.u_opacity)}),fill:(m,o)=>({u_matrix:new r.UniformMatrix4f(m,o.u_matrix)}),fillPattern:(m,o)=>({u_matrix:new r.UniformMatrix4f(m,o.u_matrix),u_image:new r.Uniform1i(m,o.u_image),u_texsize:new r.Uniform2f(m,o.u_texsize),u_pixel_coord_upper:new r.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new r.Uniform2f(m,o.u_pixel_coord_lower),u_scale:new r.Uniform3f(m,o.u_scale),u_fade:new r.Uniform1f(m,o.u_fade)}),fillOutline:(m,o)=>({u_matrix:new r.UniformMatrix4f(m,o.u_matrix),u_world:new r.Uniform2f(m,o.u_world)}),fillOutlinePattern:(m,o)=>({u_matrix:new r.UniformMatrix4f(m,o.u_matrix),u_world:new r.Uniform2f(m,o.u_world),u_image:new r.Uniform1i(m,o.u_image),u_texsize:new r.Uniform2f(m,o.u_texsize),u_pixel_coord_upper:new r.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new r.Uniform2f(m,o.u_pixel_coord_lower),u_scale:new r.Uniform3f(m,o.u_scale),u_fade:new r.Uniform1f(m,o.u_fade)}),circle:(m,o)=>({u_camera_to_center_distance:new r.Uniform1f(m,o.u_camera_to_center_distance),u_extrude_scale:new r.UniformMatrix2f(m,o.u_extrude_scale),u_device_pixel_ratio:new r.Uniform1f(m,o.u_device_pixel_ratio),u_matrix:new r.UniformMatrix4f(m,o.u_matrix),u_inv_rot_matrix:new r.UniformMatrix4f(m,o.u_inv_rot_matrix),u_merc_center:new r.Uniform2f(m,o.u_merc_center),u_tile_id:new r.Uniform3f(m,o.u_tile_id),u_zoom_transition:new r.Uniform1f(m,o.u_zoom_transition),u_up_dir:new r.Uniform3f(m,o.u_up_dir)}),collisionBox:(m,o)=>({u_matrix:new r.UniformMatrix4f(m,o.u_matrix),u_camera_to_center_distance:new r.Uniform1f(m,o.u_camera_to_center_distance),u_extrude_scale:new r.Uniform2f(m,o.u_extrude_scale)}),collisionCircle:(m,o)=>({u_matrix:new r.UniformMatrix4f(m,o.u_matrix),u_inv_matrix:new r.UniformMatrix4f(m,o.u_inv_matrix),u_camera_to_center_distance:new r.Uniform1f(m,o.u_camera_to_center_distance),u_viewport_size:new r.Uniform2f(m,o.u_viewport_size)}),debug:(m,o)=>({u_color:new r.UniformColor(m,o.u_color),u_matrix:new r.UniformMatrix4f(m,o.u_matrix),u_overlay:new r.Uniform1i(m,o.u_overlay),u_overlay_scale:new r.Uniform1f(m,o.u_overlay_scale)}),clippingMask:(m,o)=>({u_matrix:new r.UniformMatrix4f(m,o.u_matrix)}),heatmap:(m,o)=>({u_extrude_scale:new r.Uniform1f(m,o.u_extrude_scale),u_intensity:new r.Uniform1f(m,o.u_intensity),u_matrix:new r.UniformMatrix4f(m,o.u_matrix),u_inv_rot_matrix:new r.UniformMatrix4f(m,o.u_inv_rot_matrix),u_merc_center:new r.Uniform2f(m,o.u_merc_center),u_tile_id:new r.Uniform3f(m,o.u_tile_id),u_zoom_transition:new r.Uniform1f(m,o.u_zoom_transition),u_up_dir:new r.Uniform3f(m,o.u_up_dir)}),heatmapTexture:(m,o)=>({u_image:new r.Uniform1i(m,o.u_image),u_color_ramp:new r.Uniform1i(m,o.u_color_ramp),u_opacity:new r.Uniform1f(m,o.u_opacity)}),hillshade:(m,o)=>({u_matrix:new r.UniformMatrix4f(m,o.u_matrix),u_image:new r.Uniform1i(m,o.u_image),u_latrange:new r.Uniform2f(m,o.u_latrange),u_light:new r.Uniform2f(m,o.u_light),u_shadow:new r.UniformColor(m,o.u_shadow),u_highlight:new r.UniformColor(m,o.u_highlight),u_accent:new r.UniformColor(m,o.u_accent)}),hillshadePrepare:(m,o)=>({u_matrix:new r.UniformMatrix4f(m,o.u_matrix),u_image:new r.Uniform1i(m,o.u_image),u_dimension:new r.Uniform2f(m,o.u_dimension),u_zoom:new r.Uniform1f(m,o.u_zoom),u_unpack:new r.Uniform4f(m,o.u_unpack)}),line:(m,o)=>({u_matrix:new r.UniformMatrix4f(m,o.u_matrix),u_pixels_to_tile_units:new r.UniformMatrix2f(m,o.u_pixels_to_tile_units),u_device_pixel_ratio:new r.Uniform1f(m,o.u_device_pixel_ratio),u_units_to_pixels:new r.Uniform2f(m,o.u_units_to_pixels),u_dash_image:new r.Uniform1i(m,o.u_dash_image),u_gradient_image:new r.Uniform1i(m,o.u_gradient_image),u_image_height:new r.Uniform1f(m,o.u_image_height),u_texsize:new r.Uniform2f(m,o.u_texsize),u_scale:new r.Uniform3f(m,o.u_scale),u_mix:new r.Uniform1f(m,o.u_mix),u_alpha_discard_threshold:new r.Uniform1f(m,o.u_alpha_discard_threshold)}),linePattern:(m,o)=>({u_matrix:new r.UniformMatrix4f(m,o.u_matrix),u_texsize:new r.Uniform2f(m,o.u_texsize),u_pixels_to_tile_units:new r.UniformMatrix2f(m,o.u_pixels_to_tile_units),u_device_pixel_ratio:new r.Uniform1f(m,o.u_device_pixel_ratio),u_image:new r.Uniform1i(m,o.u_image),u_units_to_pixels:new r.Uniform2f(m,o.u_units_to_pixels),u_scale:new r.Uniform3f(m,o.u_scale),u_fade:new r.Uniform1f(m,o.u_fade),u_alpha_discard_threshold:new r.Uniform1f(m,o.u_alpha_discard_threshold)}),raster:(m,o)=>({u_matrix:new r.UniformMatrix4f(m,o.u_matrix),u_tl_parent:new r.Uniform2f(m,o.u_tl_parent),u_scale_parent:new r.Uniform1f(m,o.u_scale_parent),u_fade_t:new r.Uniform1f(m,o.u_fade_t),u_opacity:new r.Uniform1f(m,o.u_opacity),u_image0:new r.Uniform1i(m,o.u_image0),u_image1:new r.Uniform1i(m,o.u_image1),u_brightness_low:new r.Uniform1f(m,o.u_brightness_low),u_brightness_high:new r.Uniform1f(m,o.u_brightness_high),u_saturation_factor:new r.Uniform1f(m,o.u_saturation_factor),u_contrast_factor:new r.Uniform1f(m,o.u_contrast_factor),u_spin_weights:new r.Uniform3f(m,o.u_spin_weights),u_perspective_transform:new r.Uniform2f(m,o.u_perspective_transform)}),symbolIcon:(m,o)=>({u_is_size_zoom_constant:new r.Uniform1i(m,o.u_is_size_zoom_constant),u_is_size_feature_constant:new r.Uniform1i(m,o.u_is_size_feature_constant),u_size_t:new r.Uniform1f(m,o.u_size_t),u_size:new r.Uniform1f(m,o.u_size),u_camera_to_center_distance:new r.Uniform1f(m,o.u_camera_to_center_distance),u_rotate_symbol:new r.Uniform1i(m,o.u_rotate_symbol),u_aspect_ratio:new r.Uniform1f(m,o.u_aspect_ratio),u_fade_change:new r.Uniform1f(m,o.u_fade_change),u_matrix:new r.UniformMatrix4f(m,o.u_matrix),u_label_plane_matrix:new r.UniformMatrix4f(m,o.u_label_plane_matrix),u_coord_matrix:new r.UniformMatrix4f(m,o.u_coord_matrix),u_is_text:new r.Uniform1i(m,o.u_is_text),u_pitch_with_map:new r.Uniform1i(m,o.u_pitch_with_map),u_texsize:new r.Uniform2f(m,o.u_texsize),u_tile_id:new r.Uniform3f(m,o.u_tile_id),u_zoom_transition:new r.Uniform1f(m,o.u_zoom_transition),u_inv_rot_matrix:new r.UniformMatrix4f(m,o.u_inv_rot_matrix),u_merc_center:new r.Uniform2f(m,o.u_merc_center),u_camera_forward:new r.Uniform3f(m,o.u_camera_forward),u_tile_matrix:new r.UniformMatrix4f(m,o.u_tile_matrix),u_ecef_origin:new r.Uniform3f(m,o.u_ecef_origin),u_texture:new r.Uniform1i(m,o.u_texture)}),symbolSDF:(m,o)=>({u_is_size_zoom_constant:new r.Uniform1i(m,o.u_is_size_zoom_constant),u_is_size_feature_constant:new r.Uniform1i(m,o.u_is_size_feature_constant),u_size_t:new r.Uniform1f(m,o.u_size_t),u_size:new r.Uniform1f(m,o.u_size),u_camera_to_center_distance:new r.Uniform1f(m,o.u_camera_to_center_distance),u_rotate_symbol:new r.Uniform1i(m,o.u_rotate_symbol),u_aspect_ratio:new r.Uniform1f(m,o.u_aspect_ratio),u_fade_change:new r.Uniform1f(m,o.u_fade_change),u_matrix:new r.UniformMatrix4f(m,o.u_matrix),u_label_plane_matrix:new r.UniformMatrix4f(m,o.u_label_plane_matrix),u_coord_matrix:new r.UniformMatrix4f(m,o.u_coord_matrix),u_is_text:new r.Uniform1i(m,o.u_is_text),u_pitch_with_map:new r.Uniform1i(m,o.u_pitch_with_map),u_texsize:new r.Uniform2f(m,o.u_texsize),u_texture:new r.Uniform1i(m,o.u_texture),u_gamma_scale:new r.Uniform1f(m,o.u_gamma_scale),u_device_pixel_ratio:new r.Uniform1f(m,o.u_device_pixel_ratio),u_tile_id:new r.Uniform3f(m,o.u_tile_id),u_zoom_transition:new r.Uniform1f(m,o.u_zoom_transition),u_inv_rot_matrix:new r.UniformMatrix4f(m,o.u_inv_rot_matrix),u_merc_center:new r.Uniform2f(m,o.u_merc_center),u_camera_forward:new r.Uniform3f(m,o.u_camera_forward),u_tile_matrix:new r.UniformMatrix4f(m,o.u_tile_matrix),u_ecef_origin:new r.Uniform3f(m,o.u_ecef_origin),u_is_halo:new r.Uniform1i(m,o.u_is_halo)}),symbolTextAndIcon:(m,o)=>({u_is_size_zoom_constant:new r.Uniform1i(m,o.u_is_size_zoom_constant),u_is_size_feature_constant:new r.Uniform1i(m,o.u_is_size_feature_constant),u_size_t:new r.Uniform1f(m,o.u_size_t),u_size:new r.Uniform1f(m,o.u_size),u_camera_to_center_distance:new r.Uniform1f(m,o.u_camera_to_center_distance),u_rotate_symbol:new r.Uniform1i(m,o.u_rotate_symbol),u_aspect_ratio:new r.Uniform1f(m,o.u_aspect_ratio),u_fade_change:new r.Uniform1f(m,o.u_fade_change),u_matrix:new r.UniformMatrix4f(m,o.u_matrix),u_label_plane_matrix:new r.UniformMatrix4f(m,o.u_label_plane_matrix),u_coord_matrix:new r.UniformMatrix4f(m,o.u_coord_matrix),u_is_text:new r.Uniform1i(m,o.u_is_text),u_pitch_with_map:new r.Uniform1i(m,o.u_pitch_with_map),u_texsize:new r.Uniform2f(m,o.u_texsize),u_texsize_icon:new r.Uniform2f(m,o.u_texsize_icon),u_texture:new r.Uniform1i(m,o.u_texture),u_texture_icon:new r.Uniform1i(m,o.u_texture_icon),u_gamma_scale:new r.Uniform1f(m,o.u_gamma_scale),u_device_pixel_ratio:new r.Uniform1f(m,o.u_device_pixel_ratio),u_is_halo:new r.Uniform1i(m,o.u_is_halo)}),background:(m,o)=>({u_matrix:new r.UniformMatrix4f(m,o.u_matrix),u_opacity:new r.Uniform1f(m,o.u_opacity),u_color:new r.UniformColor(m,o.u_color)}),backgroundPattern:(m,o)=>({u_matrix:new r.UniformMatrix4f(m,o.u_matrix),u_opacity:new r.Uniform1f(m,o.u_opacity),u_image:new r.Uniform1i(m,o.u_image),u_pattern_tl_a:new r.Uniform2f(m,o.u_pattern_tl_a),u_pattern_br_a:new r.Uniform2f(m,o.u_pattern_br_a),u_pattern_tl_b:new r.Uniform2f(m,o.u_pattern_tl_b),u_pattern_br_b:new r.Uniform2f(m,o.u_pattern_br_b),u_texsize:new r.Uniform2f(m,o.u_texsize),u_mix:new r.Uniform1f(m,o.u_mix),u_pattern_size_a:new r.Uniform2f(m,o.u_pattern_size_a),u_pattern_size_b:new r.Uniform2f(m,o.u_pattern_size_b),u_scale_a:new r.Uniform1f(m,o.u_scale_a),u_scale_b:new r.Uniform1f(m,o.u_scale_b),u_pixel_coord_upper:new r.Uniform2f(m,o.u_pixel_coord_upper),u_pixel_coord_lower:new r.Uniform2f(m,o.u_pixel_coord_lower),u_tile_units_to_pixels:new r.Uniform1f(m,o.u_tile_units_to_pixels)}),terrainRaster:Pd,terrainDepth:Pd,skybox:(m,o)=>({u_matrix:new r.UniformMatrix4f(m,o.u_matrix),u_sun_direction:new r.Uniform3f(m,o.u_sun_direction),u_cubemap:new r.Uniform1i(m,o.u_cubemap),u_opacity:new r.Uniform1f(m,o.u_opacity),u_temporal_offset:new r.Uniform1f(m,o.u_temporal_offset)}),skyboxGradient:(m,o)=>({u_matrix:new r.UniformMatrix4f(m,o.u_matrix),u_color_ramp:new r.Uniform1i(m,o.u_color_ramp),u_center_direction:new r.Uniform3f(m,o.u_center_direction),u_radius:new r.Uniform1f(m,o.u_radius),u_opacity:new r.Uniform1f(m,o.u_opacity),u_temporal_offset:new r.Uniform1f(m,o.u_temporal_offset)}),skyboxCapture:(m,o)=>({u_matrix_3f:new r.UniformMatrix3f(m,o.u_matrix_3f),u_sun_direction:new r.Uniform3f(m,o.u_sun_direction),u_sun_intensity:new r.Uniform1f(m,o.u_sun_intensity),u_color_tint_r:new r.Uniform4f(m,o.u_color_tint_r),u_color_tint_m:new r.Uniform4f(m,o.u_color_tint_m),u_luminance:new r.Uniform1f(m,o.u_luminance)}),globeRaster:(m,o)=>({u_proj_matrix:new r.UniformMatrix4f(m,o.u_proj_matrix),u_globe_matrix:new r.UniformMatrix4f(m,o.u_globe_matrix),u_merc_matrix:new r.UniformMatrix4f(m,o.u_merc_matrix),u_zoom_transition:new r.Uniform1f(m,o.u_zoom_transition),u_merc_center:new r.Uniform2f(m,o.u_merc_center),u_image0:new r.Uniform1i(m,o.u_image0),u_grid_matrix:new r.UniformMatrix3f(m,o.u_grid_matrix)}),globeAtmosphere:(m,o)=>({u_frustum_tl:new r.Uniform3f(m,o.u_frustum_tl),u_frustum_tr:new r.Uniform3f(m,o.u_frustum_tr),u_frustum_br:new r.Uniform3f(m,o.u_frustum_br),u_frustum_bl:new r.Uniform3f(m,o.u_frustum_bl),u_globe_pos:new r.Uniform3f(m,o.u_globe_pos),u_globe_radius:new r.Uniform1f(m,o.u_globe_radius),u_opacity:new r.Uniform1f(m,o.u_opacity),u_fadeout_range:new r.Uniform1f(m,o.u_fadeout_range),u_start_color:new r.Uniform3f(m,o.u_start_color),u_end_color:new r.Uniform3f(m,o.u_end_color)})};let Ha;function km(m,o,d,y,w,T,A){const I=m.context,O=I.gl,U=m.useProgram("collisionBox"),V=[];let j=0,ee=0;for(let De=0;De<y.length;De++){const ke=y[De],Te=o.getTile(ke),Ne=Te.getBucket(d);if(!Ne)continue;let tt=ke.projMatrix;w[0]===0&&w[1]===0||(tt=m.translatePosMatrix(ke.projMatrix,Te,w,T));const at=A?Ne.textCollisionBox:Ne.iconCollisionBox,pt=Ne.collisionCircleArray;if(pt.length>0){const ht=r.create(),zt=tt;r.mul(ht,Ne.placementInvProjMatrix,m.transform.glCoordMatrix),r.mul(ht,ht,Ne.placementViewportMatrix),V.push({circleArray:pt,circleOffset:ee,transform:zt,invTransform:ht}),j+=pt.length/4,ee=j}at&&(m.terrain&&m.terrain.setupElevationDraw(Te,U),U.draw(I,O.LINES,r.DepthMode.disabled,r.StencilMode.disabled,m.colorModeForRenderPass(),r.CullFaceMode.disabled,G_(tt,m.transform,Te),d.id,at.layoutVertexBuffer,at.indexBuffer,at.segments,null,m.transform.zoom,null,at.collisionVertexBuffer,at.collisionVertexBufferExt))}if(!A||!V.length)return;const ce=m.useProgram("collisionCircle"),ae=new r.StructArrayLayout2f1f2i16;ae.resize(4*j),ae._trim();let J=0;for(const De of V)for(let ke=0;ke<De.circleArray.length/4;ke++){const Te=4*ke,Ne=De.circleArray[Te+0],tt=De.circleArray[Te+1],at=De.circleArray[Te+2],pt=De.circleArray[Te+3];ae.emplace(J++,Ne,tt,at,pt,0),ae.emplace(J++,Ne,tt,at,pt,1),ae.emplace(J++,Ne,tt,at,pt,2),ae.emplace(J++,Ne,tt,at,pt,3)}(!Ha||Ha.length<2*j)&&(Ha=function(De){const ke=2*De,Te=new r.StructArrayLayout3ui6;Te.resize(ke),Te._trim();for(let Ne=0;Ne<ke;Ne++){const tt=6*Ne;Te.uint16[tt+0]=4*Ne+0,Te.uint16[tt+1]=4*Ne+1,Te.uint16[tt+2]=4*Ne+2,Te.uint16[tt+3]=4*Ne+2,Te.uint16[tt+4]=4*Ne+3,Te.uint16[tt+5]=4*Ne+0}return Te}(j));const Pe=I.createIndexBuffer(Ha,!0),_e=I.createVertexBuffer(ae,r.collisionCircleLayout.members,!0);for(const De of V){const ke={u_matrix:De.transform,u_inv_matrix:De.invTransform,u_camera_to_center_distance:(Ae=m.transform).cameraToCenterDistance,u_viewport_size:[Ae.width,Ae.height]};ce.draw(I,O.TRIANGLES,r.DepthMode.disabled,r.StencilMode.disabled,m.colorModeForRenderPass(),r.CullFaceMode.disabled,ke,d.id,_e,Pe,r.SegmentVector.simpleSegment(0,2*De.circleOffset,De.circleArray.length,De.circleArray.length/2),null,m.transform.zoom,null,null,null)}var Ae;_e.destroy(),Pe.destroy()}const Ud=r.create();function Dl(m,o,d,y,w,T){const{horizontalAlign:A,verticalAlign:I}=r.getAnchorAlignment(m),O=-(A-.5)*o,U=-(I-.5)*d,V=r.evaluateVariableOffset(m,y);return new r.pointGeometry((O/w+V[0])*T,(U/w+V[1])*T)}function $_(m,o,d,y,w,T,A,I,O,U,V,j){const ee=m.text.placedSymbolArray,ce=m.text.dynamicLayoutVertexArray,ae=m.icon.dynamicLayoutVertexArray,J={},Pe=I.projMatrix,_e=T.elevation,Ae=j.upVectorScale(I.canonical,T.center.lat,T.worldSize);ce.clear();for(let De=0;De<ee.length;De++){const ke=ee.get(De),Te=m.allowVerticalPlacement&&!ke.placedOrientation,Ne=ke.hidden||!ke.crossTileID||Te?null:y[ke.crossTileID];if(Ne){const tt=new r.pointGeometry(ke.tileAnchorX,ke.tileAnchorY),at=j.upVector(I.canonical,tt.x,tt.y),pt=_e?_e.getAtTileOffset(I,tt.x,tt.y):0,ht=li([ke.projectedAnchorX+pt*at[0]*Ae.metersToTile,ke.projectedAnchorY+pt*at[1]*Ae.metersToTile,ke.projectedAnchorZ+pt*at[2]*Ae.metersToTile],d?Pe:A),zt=ai(T.cameraToCenterDistance,ht.signedDistanceFromCamera);let nt=w.evaluateSizeForFeature(m.textSizeData,U,ke)*zt/r.ONE_EM;d&&(nt*=m.tilePixelRatio/O);const{width:kt,height:Pt,anchor:Kt,textOffset:ft,textScale:qt}=Ne,gn=Dl(Kt,kt,Pt,ft,qt,nt),Xt=d?oi(tt.add(gn),A,pt*Ae.metersToLabelSpace).point:ht.point.add(o?gn.rotate(-T.angle):gn),Yt=m.allowVerticalPlacement&&ke.placedOrientation===r.WritingMode.vertical?Math.PI/2:0;for(let xn=0;xn<ke.numGlyphs;xn++)r.addDynamicAttributes(ce,Xt,Yt);V&&ke.associatedIconIndex>=0&&(J[ke.associatedIconIndex]={shiftedAnchor:Xt,angle:Yt})}else Bi(ke.numGlyphs,ce)}if(V){ae.clear();const De=m.icon.placedSymbolArray;for(let ke=0;ke<De.length;ke++){const Te=De.get(ke);if(Te.hidden)Bi(Te.numGlyphs,ae);else{const Ne=J[ke];if(Ne)for(let tt=0;tt<Te.numGlyphs;tt++)r.addDynamicAttributes(ae,Ne.shiftedAnchor,Ne.angle);else Bi(Te.numGlyphs,ae)}}m.icon.dynamicLayoutVertexBuffer.updateData(ae)}m.text.dynamicLayoutVertexBuffer.updateData(ce)}function q_(m,o,d){return d.iconsInText&&o?"symbolTextAndIcon":m?"symbolSDF":"symbolIcon"}function Vd(m,o,d,y,w,T,A,I,O,U,V,j){const ee=m.context,ce=ee.gl,ae=m.transform,J=I==="map",Pe=O==="map",_e=J&&d.layout.get("symbol-placement")!=="point",Ae=J&&!Pe&&!_e,De=d.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ke=!1;const Te=m.depthModeForSublayer(0,r.DepthMode.ReadOnly),Ne=[r.mercatorXfromLng(ae.center.lng),r.mercatorYfromLat(ae.center.lat)],tt=d.layout.get("text-variable-anchor"),at=ae.projection.name==="globe",pt=at?r.globeToMercatorTransition(ae.zoom):0,ht=[],zt=[];m.terrain&&Pe&&zt.push("PITCH_WITH_MAP_TERRAIN"),at&&zt.push("PROJECTION_GLOBE_VIEW");for(const nt of y){const kt=o.getTile(nt),Pt=kt.getBucket(d);if(!Pt||Pt.projection!==ae.projection.name)continue;const Kt=w?Pt.text:Pt.icon;if(!Kt||Pt.fullyClipped||!Kt.segments.get().length)continue;const ft=Kt.programConfigurations.get(d.id),qt=w||Pt.sdfIcons,gn=w?Pt.textSizeData:Pt.iconSizeData,Xt=Pe||ae.pitch!==0,Yt=r.evaluateSizeForZoom(gn,ae.zoom);let xn,kn,dn,Mn,$n=[0,0],vi=null;if(w){if(kn=kt.glyphAtlasTexture,dn=ce.LINEAR,xn=kt.glyphAtlasTexture.size,Pt.iconsInText){$n=kt.imageAtlasTexture.size,vi=kt.imageAtlasTexture;const kr=gn.kind==="composite"||gn.kind==="camera";Mn=Xt||m.options.rotating||m.options.zooming||kr?ce.LINEAR:ce.NEAREST}}else{const kr=d.layout.get("icon-size").constantOr(0)!==1||Pt.iconsNeedLinear;kn=kt.imageAtlasTexture,dn=qt||m.options.rotating||m.options.zooming||kr||Xt?ce.LINEAR:ce.NEAREST,xn=kt.imageAtlasTexture.size}const nr=m.transform.calculatePixelsToTileUnitsMatrix(kt),ir=di(nt.projMatrix,kt.tileID.canonical,Pe,J,m.transform,nr),Rr=m.terrain&&Pe&&_e?r.invert(r.create(),ir):Ud,mo=Ar(nt.projMatrix,kt.tileID.canonical,Pe,J,m.transform,nr),Uo=tt&&Pt.hasTextData(),da=d.layout.get("icon-text-fit")!=="none"&&Uo&&Pt.hasIconData();if(_e){const kr=ae.elevation,ja=kr?kr.getAtTileOffsetFunc(nt,ae.center.lat,ae.worldSize,ae.projection):ug=>[0,0,0];zo(Pt,nt.projMatrix,m,w,ir,mo,Pe,U,ja,nt)}const Vo=_e||w&&tt||da,bi=m.translatePosMatrix(nt.projMatrix,kt,T,A),Ti=Vo?Ud:ir,Yn=m.translatePosMatrix(mo,kt,T,A,!0),Pi=ae.projection.createInversionMatrix(ae,nt.canonical),zr=Vo?zt.concat(["PROJECTED_POS_ON_VIEWPORT"]):zt,xi=qt&&d.paint.get(w?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let qr;qr=qt?Pt.iconsInText?As(gn.kind,Yt,Ae,Pe,m,bi,Ti,Yn,xn,$n,nt,pt,Ne,Pi):Ga(gn.kind,Yt,Ae,Pe,m,bi,Ti,Yn,w,xn,!0,nt,pt,Ne,Pi):Od(gn.kind,Yt,Ae,Pe,m,bi,Ti,Yn,w,xn,nt,pt,Ne,Pi);const jl={program:m.useProgram(q_(qt,w,Pt),ft,zr),buffers:Kt,uniformValues:qr,atlasTexture:kn,atlasTextureIcon:vi,atlasInterpolation:dn,atlasInterpolationIcon:Mn,isSDF:qt,hasHalo:xi,tile:kt,labelPlaneMatrixInv:Rr};if(De&&Pt.canOverlap){ke=!0;const kr=Kt.segments.get();for(const ja of kr)ht.push({segments:new r.SegmentVector([ja]),sortKey:ja.sortKey,state:jl})}else ht.push({segments:Kt.segments,sortKey:0,state:jl})}ke&&ht.sort((nt,kt)=>nt.sortKey-kt.sortKey);for(const nt of ht){const kt=nt.state;if(m.terrain&&m.terrain.setupElevationDraw(kt.tile,kt.program,{useDepthForOcclusion:!at,labelPlaneMatrixInv:kt.labelPlaneMatrixInv}),ee.activeTexture.set(ce.TEXTURE0),kt.atlasTexture.bind(kt.atlasInterpolation,ce.CLAMP_TO_EDGE),kt.atlasTextureIcon&&(ee.activeTexture.set(ce.TEXTURE1),kt.atlasTextureIcon&&kt.atlasTextureIcon.bind(kt.atlasInterpolationIcon,ce.CLAMP_TO_EDGE)),kt.isSDF){const Pt=kt.uniformValues;kt.hasHalo&&(Pt.u_is_halo=1,Bm(kt.buffers,nt.segments,d,m,kt.program,Te,V,j,Pt)),Pt.u_is_halo=0}Bm(kt.buffers,nt.segments,d,m,kt.program,Te,V,j,kt.uniformValues)}}function Bm(m,o,d,y,w,T,A,I,O){const U=y.context;w.draw(U,U.gl.TRIANGLES,T,A,I,r.CullFaceMode.disabled,O,d.id,m.layoutVertexBuffer,m.indexBuffer,o,d.paint,y.transform.zoom,m.programConfigurations.get(d.id),m.dynamicLayoutVertexBuffer,m.opacityVertexBuffer)}function Eu(m,o,d,y,w,T,A){const I=m.context.gl,O=d.paint.get("fill-pattern"),U=O&&O.constantOr(1),V=d.getCrossfadeParameters();let j,ee,ce,ae,J;A?(ee=U&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",j=I.LINES):(ee=U?"fillPattern":"fill",j=I.TRIANGLES);for(const Pe of y){const _e=o.getTile(Pe);if(U&&!_e.patternsLoaded())continue;const Ae=_e.getBucket(d);if(!Ae)continue;m.prepareDrawTile();const De=Ae.programConfigurations.get(d.id),ke=m.useProgram(ee,De);U&&(m.context.activeTexture.set(I.TEXTURE0),_e.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),De.updatePaintBuffers(V));const Te=O.constantOr(null);if(Te&&_e.imageAtlas){const tt=_e.imageAtlas,at=tt.patternPositions[Te.to.toString()],pt=tt.patternPositions[Te.from.toString()];at&&pt&&De.setConstantPatternPositions(at,pt)}const Ne=m.translatePosMatrix(Pe.projMatrix,_e,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(A){ae=Ae.indexBuffer2,J=Ae.segments2;const tt=m.terrain&&m.terrain.renderingToTexture?m.terrain.drapeBufferSize:[I.drawingBufferWidth,I.drawingBufferHeight];ce=ee==="fillOutlinePattern"&&U?Pm(Ne,m,V,_e,tt):Mu(Ne,tt)}else ae=Ae.indexBuffer,J=Ae.segments,ce=U?wu(Ne,m,V,_e):bu(Ne);m.prepareDrawProgram(m.context,ke,Pe.toUnwrapped()),ke.draw(m.context,j,w,m.stencilModeForClipping(Pe),T,r.CullFaceMode.disabled,ce,d.id,Ae.layoutVertexBuffer,ae,J,d.paint,m.transform.zoom,De)}}function Ss(m,o,d,y,w,T,A){const I=m.context,O=I.gl,U=m.transform,V=d.paint.get("fill-extrusion-pattern"),j=V.constantOr(1),ee=d.getCrossfadeParameters(),ce=d.paint.get("fill-extrusion-opacity"),ae=function(De){if(De.projection.name!=="globe")return 0;const ke=Math.PI/32,Te=Math.tan(ke),Ne=r.earthRadius;return Ne*Math.sqrt(1+2*Te*Te)-Ne}(U),J=U.projection.name==="globe",Pe=J?r.globeToMercatorTransition(U.zoom):0,_e=[r.mercatorXfromLng(U.center.lng),r.mercatorYfromLat(U.center.lat)],Ae=[];J&&Ae.push("PROJECTION_GLOBE_VIEW");for(const De of y){const ke=o.getTile(De),Te=ke.getBucket(d);if(!Te||Te.projection!==U.projection.name)continue;const Ne=Te.programConfigurations.get(d.id),tt=m.useProgram(j?"fillExtrusionPattern":"fillExtrusion",Ne,Ae);if(m.terrain){const kt=m.terrain;if(m.style.terrainSetForDrapingOnly())kt.setupElevationDraw(ke,tt,{useMeterToDem:!0});else{if(!Te.enableTerrain)continue;if(kt.setupElevationDraw(ke,tt,{useMeterToDem:!0}),Pl(I,o,De,Te,d,kt),!Te.centroidVertexBuffer){const Pt=tt.attributes.a_centroid_pos;Pt!==void 0&&O.vertexAttrib2f(Pt,0,0)}}}j&&(m.context.activeTexture.set(O.TEXTURE0),ke.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),Ne.updatePaintBuffers(ee));const at=V.constantOr(null);if(at&&ke.imageAtlas){const kt=ke.imageAtlas,Pt=kt.patternPositions[at.to.toString()],Kt=kt.patternPositions[at.from.toString()];Pt&&Kt&&Ne.setConstantPatternPositions(Pt,Kt)}const pt=m.translatePosMatrix(De.projMatrix,ke,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),ht=U.projection.createInversionMatrix(U,De.canonical),zt=d.paint.get("fill-extrusion-vertical-gradient"),nt=j?xu(pt,m,zt,ce,De,ee,ke,ae,Pe,_e,ht):vu(pt,m,zt,ce,De,ae,Pe,_e,ht);m.prepareDrawProgram(I,tt,De.toUnwrapped()),tt.draw(I,I.gl.TRIANGLES,w,T,A,r.CullFaceMode.backCCW,nt,d.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,d.paint,m.transform.zoom,Ne,m.terrain?Te.centroidVertexBuffer:null,J?Te.layoutVertexExtBuffer:null)}}function Pl(m,o,d,y,w,T){const A=[_e=>{let Ae=_e.canonical.x-1,De=_e.wrap;return Ae<0&&(Ae=(1<<_e.canonical.z)-1,De--),new r.OverscaledTileID(_e.overscaledZ,De,_e.canonical.z,Ae,_e.canonical.y)},_e=>{let Ae=_e.canonical.x+1,De=_e.wrap;return Ae===1<<_e.canonical.z&&(Ae=0,De++),new r.OverscaledTileID(_e.overscaledZ,De,_e.canonical.z,Ae,_e.canonical.y)},_e=>new r.OverscaledTileID(_e.overscaledZ,_e.wrap,_e.canonical.z,_e.canonical.x,(_e.canonical.y===0?1<<_e.canonical.z:_e.canonical.y)-1),_e=>new r.OverscaledTileID(_e.overscaledZ,_e.wrap,_e.canonical.z,_e.canonical.x,_e.canonical.y===(1<<_e.canonical.z)-1?0:_e.canonical.y+1)],I=_e=>{const Ae=o.getSource().minzoom,De=Te=>{const Ne=o.getTileByID(Te);if(Ne&&Ne.hasData())return Ne.getBucket(w)},ke=[0,-1,1];for(const Te of ke){if(_e.overscaledZ+Te<Ae)continue;const Ne=De(_e.calculateScaledKey(_e.overscaledZ+Te));if(Ne)return Ne}},O=[0,0,0],U=(_e,Ae)=>(O[0]=Math.min(_e.min.y,Ae.min.y),O[1]=Math.max(_e.max.y,Ae.max.y),O[2]=r.EXTENT-Ae.min.x>_e.max.x?Ae.min.x-r.EXTENT:_e.max.x,O),V=(_e,Ae)=>(O[0]=Math.min(_e.min.x,Ae.min.x),O[1]=Math.max(_e.max.x,Ae.max.x),O[2]=r.EXTENT-Ae.min.y>_e.max.y?Ae.min.y-r.EXTENT:_e.max.y,O),j=[(_e,Ae)=>U(_e,Ae),(_e,Ae)=>U(Ae,_e),(_e,Ae)=>V(_e,Ae),(_e,Ae)=>V(Ae,_e)],ee=new r.pointGeometry(0,0);let ce,ae,J;const Pe=(_e,Ae,De,ke,Te)=>{const Ne=[[ke?De:_e,ke?_e:De,0],[ke?De:Ae,ke?Ae:De,0]],tt=Te<0?r.EXTENT+Te:Te,at=[ke?tt:(_e+Ae)/2,ke?(_e+Ae)/2:tt,0];return De===0&&Te<0||De!==0&&Te>0?T.getForTilePoints(J,[at],!0,ae):Ne.push(at),T.getForTilePoints(d,Ne,!0,ce),Math.max(Ne[0][2],Ne[1][2],at[2])/T.exaggeration()};for(let _e=0;_e<4;_e++){const Ae=(_e<2?1:5)-_e,De=y.borders[_e];if(De.length===0)continue;const ke=J=A[_e](d),Te=I(ke);if(!(Te&&Te instanceof r.FillExtrusionBucket&&Te.enableTerrain)||y.borderDoneWithNeighborZ[_e]===Te.canonical.z&&Te.borderDoneWithNeighborZ[Ae]===y.canonical.z||(ae=T.findDEMTileFor(ke),!ae||!ae.dem))continue;if(!ce){const pt=T.findDEMTileFor(d);if(!pt||!pt.dem)return;ce=pt}const Ne=Te.borders[Ae];let tt=0;const at=Te.borderDoneWithNeighborZ[Ae]!==y.canonical.z;if(y.canonical.z===Te.canonical.z){for(let pt=0;pt<De.length;pt++){const ht=y.featuresOnBorder[De[pt]],zt=ht.borders[_e];let nt;for(;tt<Ne.length&&(nt=Te.featuresOnBorder[Ne[tt]],!(nt.borders[Ae][1]>zt[0]+3));)at&&Te.encodeCentroid(void 0,nt,!1),tt++;if(nt&&tt<Ne.length){const kt=tt;let Pt=0;for(;!(nt.borders[Ae][0]>zt[1]-3)&&(Pt++,++tt!==Ne.length);)nt=Te.featuresOnBorder[Ne[tt]];if(nt=Te.featuresOnBorder[Ne[kt]],ht.intersectsCount()>1||nt.intersectsCount()>1||Pt!==1){Pt!==1&&(tt=kt),y.encodeCentroid(void 0,ht,!1),at&&Te.encodeCentroid(void 0,nt,!1);continue}const Kt=j[_e](ht,nt),ft=_e%2?r.EXTENT-1:0;ee.x=Pe(Kt[0],Math.min(r.EXTENT-1,Kt[1]),ft,_e<2,Kt[2]),ee.y=0,y.encodeCentroid(ee,ht,!1),at&&Te.encodeCentroid(ee,nt,!1)}else y.encodeCentroid(void 0,ht,!1)}y.borderDoneWithNeighborZ[_e]=Te.canonical.z,y.needsCentroidUpdate=!0,at&&(Te.borderDoneWithNeighborZ[Ae]=y.canonical.z,Te.needsCentroidUpdate=!0)}else{for(const pt of De)y.encodeCentroid(void 0,y.featuresOnBorder[pt],!1);if(at){for(const pt of Ne)Te.encodeCentroid(void 0,Te.featuresOnBorder[pt],!1);Te.borderDoneWithNeighborZ[Ae]=y.canonical.z,Te.needsCentroidUpdate=!0}y.borderDoneWithNeighborZ[_e]=Te.canonical.z,y.needsCentroidUpdate=!0}}(y.needsCentroidUpdate||!y.centroidVertexBuffer&&y.centroidVertexArray.length!==0)&&y.uploadCentroid(m)}const Gd=new r.Color(1,0,0,1),Hd=new r.Color(0,1,0,1),Fm=new r.Color(0,0,1,1),Cu=new r.Color(1,0,1,1),Au=new r.Color(0,1,1,1);function Wt(m,o,d,y){Ll(m,0,o+d/2,m.transform.width,d,y)}function jr(m,o,d,y){Ll(m,o-d/2,0,d,m.transform.height,y)}function Ll(m,o,d,y,w,T){const A=m.context,I=A.gl;I.enable(I.SCISSOR_TEST),I.scissor(o*r.exported.devicePixelRatio,d*r.exported.devicePixelRatio,y*r.exported.devicePixelRatio,w*r.exported.devicePixelRatio),A.clear({color:T}),I.disable(I.SCISSOR_TEST)}function Om(m,o,d){const y=m.context,w=y.gl,T=m.transform.projection.name==="globe",A=d.projMatrix,I=m.useProgram("debug",null,T?["PROJECTION_GLOBE_VIEW"]:null),O=o.getTileByID(d.key);m.terrain&&m.terrain.setupElevationDraw(O,I);const U=r.DepthMode.disabled,V=r.StencilMode.disabled,j=m.colorModeForRenderPass(),ee="$debug";y.activeTexture.set(w.TEXTURE0),m.emptyTexture.bind(w.LINEAR,w.CLAMP_TO_EDGE),T?O._makeGlobeTileDebugBuffers(m.context,m.transform.projection):O._makeDebugTileBoundsBuffers(m.context,m.transform.projection);const ce=O._tileDebugBuffer||m.debugBuffer,ae=O._tileDebugIndexBuffer||m.debugIndexBuffer,J=O._tileDebugSegments||m.debugSegments;I.draw(y,w.LINE_STRIP,U,V,j,r.CullFaceMode.disabled,Im(A,r.Color.red),ee,ce,ae,J,null,null,null,O._globeTileDebugBorderBuffer);const Pe=O.latestRawTileData,_e=Math.floor((Pe&&Pe.byteLength||0)/1024),Ae=o.getTile(d).tileSize,De=512/Math.min(Ae,512)*(d.overscaledZ/m.transform.zoom)*.5;let ke=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(ke+=` => ${d.overscaledZ}`),function(at,pt){at.initDebugOverlayCanvas();const ht=at.debugOverlayCanvas,zt=at.context.gl,nt=at.debugOverlayCanvas.getContext("2d");nt.clearRect(0,0,ht.width,ht.height),nt.shadowColor="white",nt.shadowBlur=2,nt.lineWidth=1.5,nt.strokeStyle="white",nt.textBaseline="top",nt.font="bold 36px Open Sans, sans-serif",nt.fillText(pt,5,5),nt.strokeText(pt,5,5),at.debugOverlayTexture.update(ht),at.debugOverlayTexture.bind(zt.LINEAR,zt.CLAMP_TO_EDGE)}(m,`${ke} ${_e}kb`);const Te=O._tileDebugTextBuffer||m.debugBuffer,Ne=O._tileDebugTextIndexBuffer||m.quadTriangleIndexBuffer,tt=O._tileDebugTextSegments||m.debugSegments;I.draw(y,w.TRIANGLES,U,V,r.ColorMode.alphaBlended,r.CullFaceMode.disabled,Im(A,r.Color.transparent,De),ee,Te,Ne,tt,null,null,null,O._globeTileDebugTextBuffer)}const Nm=r.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ds}=Nm;function Fo(m,o,d,y){m.emplaceBack(o,d,y)}class Il{constructor(o){this.vertexArray=new r.StructArrayLayout3f12,this.indices=new r.StructArrayLayout3ui6,Fo(this.vertexArray,-1,-1,1),Fo(this.vertexArray,1,-1,1),Fo(this.vertexArray,-1,1,1),Fo(this.vertexArray,1,1,1),Fo(this.vertexArray,-1,-1,-1),Fo(this.vertexArray,1,-1,-1),Fo(this.vertexArray,-1,1,-1),Fo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=o.createVertexBuffer(this.vertexArray,Ds),this.indexBuffer=o.createIndexBuffer(this.indices),this.segment=r.SegmentVector.simpleSegment(0,0,36,12)}}function sa(m,o,d,y,w,T){const A=m.gl,I=o.paint.get("sky-atmosphere-color"),O=o.paint.get("sky-atmosphere-halo-color"),U=o.paint.get("sky-atmosphere-sun-intensity"),V=((j,ee,ce,ae,J)=>({u_matrix_3f:j,u_sun_direction:ee,u_sun_intensity:ce,u_color_tint_r:[ae.r,ae.g,ae.b,ae.a],u_color_tint_m:[J.r,J.g,J.b,J.a],u_luminance:5e-5}))(r.fromMat4(r.create$1(),y),w,U,I,O);A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_CUBE_MAP_POSITIVE_X+T,o.skyboxTexture,0),d.draw(m,A.TRIANGLES,r.DepthMode.disabled,r.StencilMode.disabled,r.ColorMode.unblended,r.CullFaceMode.frontCW,V,"skyboxCapture",o.skyboxGeometry.vertexBuffer,o.skyboxGeometry.indexBuffer,o.skyboxGeometry.segment)}function la(m,o){return r.transformMat4(m,m,o)}const Wd={symbol:function(m,o,d,y,w){if(m.renderPass!=="translucent")return;const T=r.StencilMode.disabled,A=m.colorModeForRenderPass();d.layout.get("text-variable-anchor")&&function(I,O,U,V,j,ee,ce){const ae=O.transform,J=j==="map",Pe=ee==="map";for(const _e of I){const Ae=V.getTile(_e),De=Ae.getBucket(U);if(!De||De.projection!==ae.projection.name||!De.text||!De.text.segments.get().length)continue;const ke=r.evaluateSizeForZoom(De.textSizeData,ae.zoom),Te=O.transform.calculatePixelsToTileUnitsMatrix(Ae),Ne=di(_e.projMatrix,Ae.tileID.canonical,Pe,J,O.transform,Te),tt=U.layout.get("icon-text-fit")!=="none"&&De.hasIconData();if(ke){const at=Math.pow(2,ae.zoom-Ae.tileID.overscaledZ);$_(De,J,Pe,ce,r.symbolSize,ae,Ne,_e,at,ke,tt,ae.projection)}}}(y,m,d,o,d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),w),d.paint.get("icon-opacity").constantOr(1)!==0&&Vd(m,o,d,y,!1,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),d.layout.get("icon-rotation-alignment"),d.layout.get("icon-pitch-alignment"),d.layout.get("icon-keep-upright"),T,A),d.paint.get("text-opacity").constantOr(1)!==0&&Vd(m,o,d,y,!0,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),d.layout.get("text-rotation-alignment"),d.layout.get("text-pitch-alignment"),d.layout.get("text-keep-upright"),T,A),o.map.showCollisionBoxes&&(km(m,o,d,y,d.paint.get("text-translate"),d.paint.get("text-translate-anchor"),!0),km(m,o,d,y,d.paint.get("icon-translate"),d.paint.get("icon-translate-anchor"),!1))},circle:function(m,o,d,y){if(m.renderPass!=="translucent")return;const w=d.paint.get("circle-opacity"),T=d.paint.get("circle-stroke-width"),A=d.paint.get("circle-stroke-opacity"),I=d.layout.get("circle-sort-key").constantOr(1)!==void 0;if(w.constantOr(1)===0&&(T.constantOr(1)===0||A.constantOr(1)===0))return;const O=m.context,U=O.gl,V=m.transform,j=m.depthModeForSublayer(0,r.DepthMode.ReadOnly),ee=r.StencilMode.disabled,ce=m.colorModeForRenderPass(),ae=V.projection.name==="globe",J=[r.mercatorXfromLng(V.center.lng),r.mercatorYfromLat(V.center.lat)],Pe=[];for(let Ae=0;Ae<y.length;Ae++){const De=y[Ae],ke=o.getTile(De),Te=ke.getBucket(d);if(!Te)continue;const Ne=Te.programConfigurations.get(d.id),tt=V_(d);ae&&tt.push("PROJECTION_GLOBE_VIEW");const at=m.useProgram("circle",Ne,tt),pt=Te.layoutVertexBuffer,ht=Te.globeExtVertexBuffer,zt=Te.indexBuffer,nt=V.projection.createInversionMatrix(V,De.canonical),kt={programConfiguration:Ne,program:at,layoutVertexBuffer:pt,globeExtVertexBuffer:ht,indexBuffer:zt,uniformValues:Cs(m,De,ke,nt,J,d),tile:ke};if(I){const Pt=Te.segments.get();for(const Kt of Pt)Pe.push({segments:new r.SegmentVector([Kt]),sortKey:Kt.sortKey,state:kt})}else Pe.push({segments:Te.segments,sortKey:0,state:kt})}I&&Pe.sort((Ae,De)=>Ae.sortKey-De.sortKey);const _e={useDepthForOcclusion:!ae};for(const Ae of Pe){const{programConfiguration:De,program:ke,layoutVertexBuffer:Te,globeExtVertexBuffer:Ne,indexBuffer:tt,uniformValues:at,tile:pt}=Ae.state,ht=Ae.segments;m.terrain&&m.terrain.setupElevationDraw(pt,ke,_e),m.prepareDrawProgram(O,ke,pt.tileID.toUnwrapped()),ke.draw(O,U.TRIANGLES,j,ee,ce,r.CullFaceMode.disabled,at,d.id,Te,tt,ht,d.paint,V.zoom,De,ae?Ne:null)}},heatmap:function(m,o,d,y){if(d.paint.get("heatmap-opacity")!==0)if(m.renderPass==="offscreen"){const w=m.context,T=w.gl,A=r.StencilMode.disabled,I=new r.ColorMode([T.ONE,T.ONE],r.Color.transparent,[!0,!0,!0,!0]);(function(ee,ce,ae){const J=ee.gl;ee.activeTexture.set(J.TEXTURE1),ee.viewport.set([0,0,ce.width/4,ce.height/4]);let Pe=ae.heatmapFbo;if(Pe)J.bindTexture(J.TEXTURE_2D,Pe.colorAttachment.get()),ee.bindFramebuffer.set(Pe.framebuffer);else{const _e=J.createTexture();J.bindTexture(J.TEXTURE_2D,_e),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_2D,J.TEXTURE_MAG_FILTER,J.LINEAR),Pe=ae.heatmapFbo=ee.createFramebuffer(ce.width/4,ce.height/4,!1),function(Ae,De,ke,Te){const Ne=Ae.gl;Ne.texImage2D(Ne.TEXTURE_2D,0,Ne.RGBA,De.width/4,De.height/4,0,Ne.RGBA,Ae.extRenderToTextureHalfFloat?Ae.extTextureHalfFloat.HALF_FLOAT_OES:Ne.UNSIGNED_BYTE,null),Te.colorAttachment.set(ke)}(ee,ce,_e,Pe)}})(w,m,d),w.clear({color:r.Color.transparent});const O=m.transform,U=O.projection.name==="globe",V=U?["PROJECTION_GLOBE_VIEW"]:null,j=[r.mercatorXfromLng(O.center.lng),r.mercatorYfromLat(O.center.lat)];for(let ee=0;ee<y.length;ee++){const ce=y[ee];if(o.hasRenderableParent(ce))continue;const ae=o.getTile(ce),J=ae.getBucket(d);if(!J)continue;const Pe=J.programConfigurations.get(d.id),_e=m.useProgram("heatmap",Pe,V),{zoom:Ae}=m.transform;m.terrain&&m.terrain.setupElevationDraw(ae,_e),m.prepareDrawProgram(w,_e,ce.toUnwrapped());const De=O.projection.createInversionMatrix(O,ce.canonical);_e.draw(w,T.TRIANGLES,r.DepthMode.disabled,A,I,r.CullFaceMode.disabled,W_(m,ce,ae,De,j,Ae,d.paint.get("heatmap-intensity")),d.id,J.layoutVertexBuffer,J.indexBuffer,J.segments,d.paint,m.transform.zoom,Pe,U?J.globeExtVertexBuffer:null)}w.viewport.set([0,0,m.width,m.height])}else m.renderPass==="translucent"&&(m.context.setColorMode(m.colorModeForRenderPass()),function(w,T){const A=w.context,I=A.gl,O=T.heatmapFbo;if(!O)return;A.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,O.colorAttachment.get()),A.activeTexture.set(I.TEXTURE1);let U=T.colorRampTexture;U||(U=T.colorRampTexture=new r.Texture(A,T.colorRamp,I.RGBA)),U.bind(I.LINEAR,I.CLAMP_TO_EDGE),w.useProgram("heatmapTexture").draw(A,I.TRIANGLES,r.DepthMode.disabled,r.StencilMode.disabled,w.colorModeForRenderPass(),r.CullFaceMode.disabled,((V,j,ee,ce)=>({u_image:0,u_color_ramp:1,u_opacity:j.paint.get("heatmap-opacity")}))(0,T),T.id,w.viewportBuffer,w.quadTriangleIndexBuffer,w.viewportSegments,T.paint,w.transform.zoom)}(m,d))},line:function(m,o,d,y){if(m.renderPass!=="translucent")return;const w=d.paint.get("line-opacity"),T=d.paint.get("line-width");if(w.constantOr(1)===0||T.constantOr(1)===0)return;const A=m.depthModeForSublayer(0,r.DepthMode.ReadOnly),I=m.colorModeForRenderPass(),O=m.terrain&&m.terrain.renderingToTexture?1:r.exported.devicePixelRatio,U=d.paint.get("line-dasharray"),V=U.constantOr(1),j=d.layout.get("line-cap"),ee=d.paint.get("line-pattern"),ce=ee.constantOr(1),ae=d.paint.get("line-gradient"),J=d.getCrossfadeParameters(),Pe=ce?"linePattern":"line",_e=m.context,Ae=_e.gl,De=(Te=>{const Ne=[];Bd(Te)&&Ne.push("RENDER_LINE_DASH"),Te.paint.get("line-gradient")&&Ne.push("RENDER_LINE_GRADIENT");const tt=Te.paint.get("line-pattern").constantOr(1),at=Te.paint.get("line-opacity").constantOr(1)!==1;return!tt&&at&&Ne.push("RENDER_LINE_ALPHA_DISCARD"),Ne})(d);let ke=De.includes("RENDER_LINE_ALPHA_DISCARD");m.terrain&&m.terrain.clipOrMaskOverlapStencilType()&&(ke=!1);for(const Te of y){const Ne=o.getTile(Te);if(ce&&!Ne.patternsLoaded())continue;const tt=Ne.getBucket(d);if(!tt)continue;m.prepareDrawTile();const at=tt.programConfigurations.get(d.id),pt=m.useProgram(Pe,at,De),ht=ee.constantOr(null);if(ht&&Ne.imageAtlas){const ft=Ne.imageAtlas,qt=ft.patternPositions[ht.to.toString()],gn=ft.patternPositions[ht.from.toString()];qt&&gn&&at.setConstantPatternPositions(qt,gn)}const zt=U.constantOr(null),nt=j.constantOr(null);if(!ce&&zt&&nt&&Ne.lineAtlas){const ft=Ne.lineAtlas,qt=ft.getDash(zt.to,nt),gn=ft.getDash(zt.from,nt);qt&&gn&&at.setConstantPatternPositions(qt,gn)}const kt=m.terrain?Te.projMatrix:null,Pt=ce?kd(m,Ne,d,J,kt,O):j_(m,Ne,d,J,kt,tt.lineClipsArray.length,O);if(ae){const ft=tt.gradients[d.id];let qt=ft.texture;if(d.gradientVersion!==ft.version){let gn=256;if(d.stepInterpolant){const Xt=o.getSource().maxzoom,Yt=Te.canonical.z===Xt?Math.ceil(1<<m.transform.maxZoom-Te.canonical.z):1;gn=r.clamp(r.nextPowerOfTwo(tt.maxLineLength/r.EXTENT*1024*Yt),256,_e.maxTextureSize)}ft.gradient=r.renderColorRamp({expression:d.gradientExpression(),evaluationKey:"lineProgress",resolution:gn,image:ft.gradient||void 0,clips:tt.lineClipsArray}),ft.texture?ft.texture.update(ft.gradient):ft.texture=new r.Texture(_e,ft.gradient,Ae.RGBA),ft.version=d.gradientVersion,qt=ft.texture}_e.activeTexture.set(Ae.TEXTURE1),qt.bind(d.stepInterpolant?Ae.NEAREST:Ae.LINEAR,Ae.CLAMP_TO_EDGE)}V&&(_e.activeTexture.set(Ae.TEXTURE0),Ne.lineAtlasTexture.bind(Ae.LINEAR,Ae.REPEAT),at.updatePaintBuffers(J)),ce&&(_e.activeTexture.set(Ae.TEXTURE0),Ne.imageAtlasTexture.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),at.updatePaintBuffers(J)),m.prepareDrawProgram(_e,pt,Te.toUnwrapped());const Kt=ft=>{pt.draw(_e,Ae.TRIANGLES,A,ft,I,r.CullFaceMode.disabled,Pt,d.id,tt.layoutVertexBuffer,tt.indexBuffer,tt.segments,d.paint,m.transform.zoom,at,tt.layoutVertexBuffer2)};if(ke){const ft=m.stencilModeForClipping(Te).ref;ft===0&&m.terrain&&_e.clear({stencil:0});const qt={func:Ae.EQUAL,mask:255};Pt.u_alpha_discard_threshold=.8,Kt(new r.StencilMode(qt,ft,255,Ae.KEEP,Ae.KEEP,Ae.INVERT)),Pt.u_alpha_discard_threshold=0,Kt(new r.StencilMode(qt,ft,255,Ae.KEEP,Ae.KEEP,Ae.KEEP))}else Kt(m.stencilModeForClipping(Te))}ke&&(m.resetStencilClippingMasks(),m.terrain&&_e.clear({stencil:0}))},fill:function(m,o,d,y){const w=d.paint.get("fill-color"),T=d.paint.get("fill-opacity");if(T.constantOr(1)===0)return;const A=m.colorModeForRenderPass(),I=d.paint.get("fill-pattern"),O=m.opaquePassEnabledForLayer()&&!I.constantOr(1)&&w.constantOr(r.Color.transparent).a===1&&T.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===O){const U=m.depthModeForSublayer(1,m.renderPass==="opaque"?r.DepthMode.ReadWrite:r.DepthMode.ReadOnly);Eu(m,o,d,y,U,A,!1)}if(m.renderPass==="translucent"&&d.paint.get("fill-antialias")){const U=m.depthModeForSublayer(d.getPaintProperty("fill-outline-color")?2:0,r.DepthMode.ReadOnly);Eu(m,o,d,y,U,A,!0)}},"fill-extrusion":function(m,o,d,y){const w=d.paint.get("fill-extrusion-opacity");if(w!==0&&m.renderPass==="translucent"){const T=new r.DepthMode(m.context.gl.LEQUAL,r.DepthMode.ReadWrite,m.depthRangeFor3D);if(w!==1||d.paint.get("fill-extrusion-pattern").constantOr(1))Ss(m,o,d,y,T,r.StencilMode.disabled,r.ColorMode.disabled),Ss(m,o,d,y,T,m.stencilModeFor3D(),m.colorModeForRenderPass()),m.resetStencilClippingMasks();else{const A=m.colorModeForRenderPass();Ss(m,o,d,y,T,r.StencilMode.disabled,A)}}},hillshade:function(m,o,d,y){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;const w=m.context,T=m.depthModeForSublayer(0,r.DepthMode.ReadOnly),A=m.colorModeForRenderPass(),I=m.terrain&&m.terrain.renderingToTexture,[O,U]=m.renderPass!=="translucent"||I?[{},y]:m.stencilConfigForOverlap(y);for(const V of U){const j=o.getTile(V);if(j.needsHillshadePrepare&&m.renderPass==="offscreen")Dd(m,j,d,T,r.StencilMode.disabled,A);else if(m.renderPass==="translucent"){const ee=I&&m.terrain?m.terrain.stencilModeForRTTOverlap(V):O[V.overscaledZ];Am(m,V,j,d,T,ee,A)}}w.viewport.set([0,0,m.width,m.height]),m.resetStencilClippingMasks()},raster:function(m,o,d,y,w,T){if(m.renderPass!=="translucent"||d.paint.get("raster-opacity")===0||!y.length)return;const A=m.context,I=A.gl,O=o.getSource(),U=m.useProgram("raster"),V=m.colorModeForRenderPass(),j=m.terrain&&m.terrain.renderingToTexture,[ee,ce]=O instanceof We||j?[{},y]:m.stencilConfigForOverlap(y),ae=ce[ce.length-1].overscaledZ,J=!m.options.moving;for(const Pe of ce){const _e=j?r.DepthMode.disabled:m.depthModeForSublayer(Pe.overscaledZ-ae,d.paint.get("raster-opacity")===1?r.DepthMode.ReadWrite:r.DepthMode.ReadOnly,I.LESS),Ae=Pe.toUnwrapped(),De=o.getTile(Pe);if(j&&(!De||!De.hasData()))continue;const ke=j?Pe.projMatrix:m.transform.calculateProjMatrix(Ae,J),Te=m.terrain&&j?m.terrain.stencilModeForRTTOverlap(Pe):ee[Pe.overscaledZ],Ne=T?0:d.paint.get("raster-fade-duration");De.registerFadeDuration(Ne);const tt=o.findLoadedParent(Pe,0),at=Id(De,tt,o,m.transform,Ne);let pt,ht;m.terrain&&m.terrain.prepareDrawTile();const zt=d.paint.get("raster-resampling")==="nearest"?I.NEAREST:I.LINEAR;A.activeTexture.set(I.TEXTURE0),De.texture.bind(zt,I.CLAMP_TO_EDGE),A.activeTexture.set(I.TEXTURE1),tt?(tt.texture.bind(zt,I.CLAMP_TO_EDGE),pt=Math.pow(2,tt.tileID.overscaledZ-De.tileID.overscaledZ),ht=[De.tileID.canonical.x*pt%1,De.tileID.canonical.y*pt%1]):De.texture.bind(zt,I.CLAMP_TO_EDGE);const nt=Rm(ke,ht||[0,0],pt||1,at,d,O instanceof We?O.perspectiveTransform:[0,0]);if(m.prepareDrawProgram(A,U,Ae),O instanceof We)O.boundsBuffer&&O.boundsSegments&&U.draw(A,I.TRIANGLES,_e,r.StencilMode.disabled,V,r.CullFaceMode.disabled,nt,d.id,O.boundsBuffer,m.quadTriangleIndexBuffer,O.boundsSegments);else{const{tileBoundsBuffer:kt,tileBoundsIndexBuffer:Pt,tileBoundsSegments:Kt}=m.getTileBoundsBuffers(De);U.draw(A,I.TRIANGLES,_e,Te,V,r.CullFaceMode.disabled,nt,d.id,kt,Pt,Kt)}}m.resetStencilClippingMasks()},background:function(m,o,d,y){const w=d.paint.get("background-color"),T=d.paint.get("background-opacity");if(T===0)return;const A=m.context,I=A.gl,O=m.transform,U=O.tileSize,V=d.paint.get("background-pattern");if(m.isPatternMissing(V))return;const j=!V&&w.a===1&&T===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==j)return;const ee=r.StencilMode.disabled,ce=m.depthModeForSublayer(0,j==="opaque"?r.DepthMode.ReadWrite:r.DepthMode.ReadOnly),ae=m.colorModeForRenderPass(),J=m.useProgram(V?"backgroundPattern":"background");let Pe,_e=y;_e||(Pe=m.getBackgroundTiles(),_e=Object.values(Pe).map(De=>De.tileID)),V&&(A.activeTexture.set(I.TEXTURE0),m.imageManager.bind(m.context));const Ae=d.getCrossfadeParameters();for(const De of _e){const ke=De.toUnwrapped(),Te=y?De.projMatrix:m.transform.calculateProjMatrix(ke);m.prepareDrawTile();const Ne=o?o.getTile(De):Pe?Pe[De.key]:new r.Tile(De,U,O.zoom,m),tt=V?Nd(Te,T,m,V,{tileID:De,tileSize:U},Ae):zm(Te,T,w);m.prepareDrawProgram(A,J,ke);const{tileBoundsBuffer:at,tileBoundsIndexBuffer:pt,tileBoundsSegments:ht}=m.getTileBoundsBuffers(Ne);J.draw(A,I.TRIANGLES,ce,ee,ae,r.CullFaceMode.disabled,tt,d.id,at,pt,ht)}},sky:function(m,o,d){const y=m.transform,w=y.projection.name==="mercator"||y.projection.name==="globe"?1:r.smoothstep(7,8,y.zoom),T=d.paint.get("sky-opacity")*w;if(T===0)return;const A=m.context,I=d.paint.get("sky-type"),O=new r.DepthMode(A.gl.LEQUAL,r.DepthMode.ReadOnly,[0,1]),U=m.frameCounter/1e3%1;I==="atmosphere"?m.renderPass==="offscreen"?d.needsSkyboxCapture(m)&&(function(V,j,ee,ce){const ae=V.context,J=ae.gl;let Pe=j.skyboxFbo;if(!Pe){Pe=j.skyboxFbo=ae.createFramebuffer(32,32,!1),j.skyboxGeometry=new Il(ae),j.skyboxTexture=ae.gl.createTexture(),J.bindTexture(J.TEXTURE_CUBE_MAP,j.skyboxTexture),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_S,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_WRAP_T,J.CLAMP_TO_EDGE),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MIN_FILTER,J.LINEAR),J.texParameteri(J.TEXTURE_CUBE_MAP,J.TEXTURE_MAG_FILTER,J.LINEAR);for(let ke=0;ke<6;++ke)J.texImage2D(J.TEXTURE_CUBE_MAP_POSITIVE_X+ke,0,J.RGBA,32,32,0,J.RGBA,J.UNSIGNED_BYTE,null)}ae.bindFramebuffer.set(Pe.framebuffer),ae.viewport.set([0,0,32,32]);const _e=j.getCenter(V,!0),Ae=V.useProgram("skyboxCapture"),De=new Float64Array(16);r.identity(De),r.rotateY(De,De,.5*-Math.PI),sa(ae,j,Ae,De,_e,0),r.identity(De),r.rotateY(De,De,.5*Math.PI),sa(ae,j,Ae,De,_e,1),r.identity(De),r.rotateX(De,De,.5*-Math.PI),sa(ae,j,Ae,De,_e,2),r.identity(De),r.rotateX(De,De,.5*Math.PI),sa(ae,j,Ae,De,_e,3),r.identity(De),sa(ae,j,Ae,De,_e,4),r.identity(De),r.rotateY(De,De,Math.PI),sa(ae,j,Ae,De,_e,5),ae.viewport.set([0,0,V.width,V.height])}(m,d),d.markSkyboxValid(m)):m.renderPass==="sky"&&function(V,j,ee,ce,ae){const J=V.context,Pe=J.gl,_e=V.transform,Ae=V.useProgram("skybox");J.activeTexture.set(Pe.TEXTURE0),Pe.bindTexture(Pe.TEXTURE_CUBE_MAP,j.skyboxTexture);const De=((ke,Te,Ne,tt,at)=>({u_matrix:ke,u_sun_direction:Te,u_cubemap:0,u_opacity:tt,u_temporal_offset:at}))(_e.skyboxMatrix,j.getCenter(V,!1),0,ce,ae);V.prepareDrawProgram(J,Ae),Ae.draw(J,Pe.TRIANGLES,ee,r.StencilMode.disabled,V.colorModeForRenderPass(),r.CullFaceMode.backCW,De,"skybox",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(m,d,O,T,U):I==="gradient"&&m.renderPass==="sky"&&function(V,j,ee,ce,ae){const J=V.context,Pe=J.gl,_e=V.transform,Ae=V.useProgram("skyboxGradient");j.skyboxGeometry||(j.skyboxGeometry=new Il(J)),J.activeTexture.set(Pe.TEXTURE0);let De=j.colorRampTexture;De||(De=j.colorRampTexture=new r.Texture(J,j.colorRamp,Pe.RGBA)),De.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE);const ke=((Te,Ne,tt,at,pt)=>({u_matrix:Te,u_color_ramp:0,u_center_direction:Ne,u_radius:r.degToRad(tt),u_opacity:at,u_temporal_offset:pt}))(_e.skyboxMatrix,j.getCenter(V,!1),j.paint.get("sky-gradient-radius"),ce,ae);V.prepareDrawProgram(J,Ae),Ae.draw(J,Pe.TRIANGLES,ee,r.StencilMode.disabled,V.colorModeForRenderPass(),r.CullFaceMode.backCW,ke,"skyboxGradient",j.skyboxGeometry.vertexBuffer,j.skyboxGeometry.indexBuffer,j.skyboxGeometry.segment)}(m,d,O,T,U)},debug:function(m,o,d){for(let y=0;y<d.length;y++)Om(m,o,d[y])},custom:function(m,o,d){const y=m.context,w=d.implementation;if(m.transform.projection.unsupportedLayers&&m.transform.projection.unsupportedLayers.includes("custom"))r.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if(m.renderPass==="offscreen"){const T=w.prerender;T&&(m.setCustomLayerDefaults(),y.setColorMode(m.colorModeForRenderPass()),T.call(w,y.gl,m.transform.customLayerMatrix()),y.setDirty(),m.setBaseState())}else if(m.renderPass==="translucent"){m.setCustomLayerDefaults(),y.setColorMode(m.colorModeForRenderPass()),y.setStencilMode(r.StencilMode.disabled);const T=w.renderingMode==="3d"?new r.DepthMode(m.context.gl.LEQUAL,r.DepthMode.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,r.DepthMode.ReadOnly);y.setDepthMode(T),w.render(y.gl,m.transform.customLayerMatrix()),y.setDirty(),m.setBaseState(),y.bindFramebuffer.set(null)}}};class Um{constructor(o,d){this.context=new W(o),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=r.SourceCache.maxUnderzooming+r.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new pu,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this._tileClippingMaskIDs=new Map,this._skippedStencilTileIDs=new Set}updateTerrain(o,d){const y=!!o&&!!o.terrain&&this.transform.projection.supportsTerrain;if(!(y||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Pr(this,o));const w=this._terrain;this.transform.elevation=y?w:null,w.update(o,this.transform,d)}_updateFog(o){const d=o.fog;if(!d||d.getOpacity(this.transform.pitch)<1||d.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[y,w]=d.getFovAdjustedRange(this.transform._fov);if(y>w)return void(this.transform.fogCullDistSq=null);const T=y+.78*(w-y);this.transform.fogCullDistSq=T*T}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(o,d){if(this.width=o*r.exported.devicePixelRatio,this.height=d*r.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style.order)this.style._layers[y].resize()}setup(){const o=this.context,d=new r.StructArrayLayout2i4;d.emplaceBack(0,0),d.emplaceBack(r.EXTENT,0),d.emplaceBack(0,r.EXTENT),d.emplaceBack(r.EXTENT,r.EXTENT),this.tileExtentBuffer=o.createVertexBuffer(d,r.posAttributes.members),this.tileExtentSegments=r.SegmentVector.simpleSegment(0,0,4,2);const y=new r.StructArrayLayout2i4;y.emplaceBack(0,0),y.emplaceBack(r.EXTENT,0),y.emplaceBack(0,r.EXTENT),y.emplaceBack(r.EXTENT,r.EXTENT),this.debugBuffer=o.createVertexBuffer(y,r.posAttributes.members),this.debugSegments=r.SegmentVector.simpleSegment(0,0,4,5);const w=new r.StructArrayLayout2i4;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(-1,1),w.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(w,r.posAttributes.members),this.viewportSegments=r.SegmentVector.simpleSegment(0,0,4,2);const T=new r.StructArrayLayout4i8;T.emplaceBack(0,0,0,0),T.emplaceBack(r.EXTENT,0,r.EXTENT,0),T.emplaceBack(0,r.EXTENT,0,r.EXTENT),T.emplaceBack(r.EXTENT,r.EXTENT,r.EXTENT,r.EXTENT),this.mercatorBoundsBuffer=o.createVertexBuffer(T,r.boundsAttributes.members),this.mercatorBoundsSegments=r.SegmentVector.simpleSegment(0,0,4,2);const A=new r.StructArrayLayout3ui6;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(A);const I=new r.StructArrayLayout1ui2;for(const U of[0,1,3,2,0])I.emplaceBack(U);this.debugIndexBuffer=o.createIndexBuffer(I),this.emptyTexture=new r.Texture(o,new r.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),o.gl.RGBA),this.identityMat=r.create();const O=this.context.gl;this.stencilClearMode=new r.StencilMode({func:O.ALWAYS,mask:0},0,255,O.ZERO,O.ZERO,O.ZERO),this.loadTimeStamps.push(r.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(o){return o._makeTileBoundsBuffers(this.context,this.transform.projection),o._tileBoundsBuffer?{tileBoundsBuffer:o._tileBoundsBuffer,tileBoundsIndexBuffer:o._tileBoundsIndexBuffer,tileBoundsSegments:o._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const o=this.context,d=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear(),this.useProgram("clippingMask").draw(o,d.TRIANGLES,r.DepthMode.disabled,this.stencilClearMode,r.ColorMode.disabled,r.CullFaceMode.disabled,yu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear())}_renderTileClippingMasks(o,d,y){if(!d||this.currentStencilSource===d.id||!o.isTileClipped()||!y||y.length===0)return;const w=[];let T=!1;if(this._tileClippingMaskIDs&&!this.terrain){for(const V of y)if(this._tileClippingMaskIDs.has(V.key)||(T=!0),this._skippedStencilTileIDs.has(V.key)){if(!d.getTile(V).getBucket(o))continue;this._skippedStencilTileIDs.delete(V.key),w.push(V)}if(!T&&w.length===0)return}const A=this.context,I=A.gl;A.setColorMode(r.ColorMode.disabled),A.setDepthMode(r.DepthMode.disabled);const O=this.useProgram("clippingMask"),U=V=>{const j=d.getTile(V),{tileBoundsBuffer:ee,tileBoundsIndexBuffer:ce,tileBoundsSegments:ae}=this.getTileBoundsBuffers(j);O.draw(A,I.TRIANGLES,r.DepthMode.disabled,new r.StencilMode({func:I.GREATER,mask:255},this._tileClippingMaskIDs.get(V.key)||0,255,I.KEEP,I.KEEP,I.REPLACE),r.ColorMode.disabled,r.CullFaceMode.disabled,yu(V.projMatrix),"$clipping",ee,ce,ae)};if(!T&&w.length>0)for(const V of w)U(V);else{(this._tileClippingMaskIDs.size===0||this.nextStencilID+y.length>256)&&this.clearStencil(),this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear();for(const V of y)this._tileClippingMaskIDs.set(V.key,this.nextStencilID++),d.getTile(V).getBucket(o)?U(V):this._skippedStencilTileIDs.add(V.key)}this._skippedStencilTileIDs.size===0&&(this.currentStencilSource=d.id)}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,d=this.context.gl;return new r.StencilMode({func:d.NOTEQUAL,mask:255},o,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(o){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(o);const d=this.context.gl;return new r.StencilMode({func:d.EQUAL,mask:255},this._tileClippingMaskIDs.get(o.key)||0,0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(o){const d=this.context.gl,y=o.sort((A,I)=>I.overscaledZ-A.overscaledZ),w=y[y.length-1].overscaledZ,T=y[0].overscaledZ-w+1;if(T>1){this.currentStencilSource=void 0,this.nextStencilID+T>256&&this.clearStencil();const A={};for(let I=0;I<T;I++)A[I+w]=new r.StencilMode({func:d.GEQUAL,mask:255},I+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=T,[A,y]}return[{[w]:r.StencilMode.disabled},y]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new r.ColorMode([o.CONSTANT_COLOR,o.ONE],new r.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?r.ColorMode.unblended:r.ColorMode.alphaBlended}depthModeForSublayer(o,d,y){if(!this.opaquePassEnabledForLayer())return r.DepthMode.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new r.DepthMode(y||this.context.gl.LEQUAL,d,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,d){this.style=o,this.options=d,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(r.exported.now()),this.imageManager.beginFrame();const y=this.style.order,w=this.style._sourceCaches;for(const U in w){const V=w[U];V.used&&V.prepare(this.context)}const T={},A={},I={};for(const U in w){const V=w[U];T[U]=V.getVisibleCoordinates(),A[U]=T[U].slice().reverse(),I[U]=V.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let U=0;U<y.length;U++)if(this.style._layers[y[U]].is3D()){this.opaquePassCutoff=U;break}if(this.terrain&&(this.terrain.updateTileBinding(I),this.opaquePassCutoff=0),this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new r.GlobeSharedBuffers(this.context)),!r.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const U of y){const V=this.style._layers[U],j=o._getLayerSourceCache(V);if(!V.hasOffscreenPass()||V.isHidden(this.transform.zoom))continue;const ee=j?A[j.id]:void 0;(V.type==="custom"||V.isSky()||ee&&ee.length)&&this.renderLayer(this,j,V,ee)}this.depthRangeFor3D=[0,1-(o.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let O=r.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(O=this.style.fog.properties.get("color")),this.context.clear({color:d.showOverdrawInspector?r.Color.black:O,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=y.length-1;this.currentLayer>=0;this.currentLayer--){const U=this.style._layers[y[this.currentLayer]],V=o._getLayerSourceCache(U);if(U.isSky())continue;const j=V?A[V.id]:void 0;this._renderTileClippingMasks(U,V,j),this.renderLayer(this,V,U,j)}if(this.renderPass="sky",(r.globeToMercatorTransition(this.transform.zoom)>0||this.transform.projection.name!=="globe")&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<y.length;this.currentLayer++){const U=this.style._layers[y[this.currentLayer]],V=o._getLayerSourceCache(U);U.isSky()&&this.renderLayer(this,V,U,V?A[V.id]:void 0)}for(this.transform.projection.name==="globe"&&function(U){const V=U.context,j=V.gl,ee=U.transform,ce=new r.DepthMode(j.LEQUAL,r.DepthMode.ReadOnly,[0,1]),ae=U.useProgram("globeAtmosphere"),J=ee.centerOffset,Pe=ee._camera.getCameraToClipPerspective(ee._fov,ee.width/ee.height,ee._nearZ,ee._farZ);Pe[8]=2*-J.x/ee.width,Pe[9]=2*J.y/ee.height;const _e=r.invert([],Pe),Ae=r.mul([],_e,ee.projMatrix),De={u_frustum_tl:la([-1,1,1],_e),u_frustum_tr:la([1,1,1],_e),u_frustum_br:la([1,-1,1],_e),u_frustum_bl:la([-1,-1,1],_e),u_globe_pos:la([ee.globeMatrix[12],ee.globeMatrix[13],ee.globeMatrix[14]],Ae),u_globe_radius:ee.worldSize/2/Math.PI-1,u_opacity:1-r.globeToMercatorTransition(ee.zoom),u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};U.prepareDrawProgram(V,ae);const ke=U.globeSharedBuffers;ke&&ae.draw(V,j.TRIANGLES,ce,r.StencilMode.disabled,r.ColorMode.alphaBlended,r.CullFaceMode.backCW,De,"skybox",ke.atmosphereVertexBuffer,ke.atmosphereIndexBuffer,ke.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<y.length;){const U=this.style._layers[y[this.currentLayer]],V=o._getLayerSourceCache(U);if(U.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(U)){if(U.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const j=V?(U.type==="symbol"?I:A)[V.id]:void 0;this._renderTileClippingMasks(U,V,V?T[V.id]:void 0),this.renderLayer(this,V,U,j),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let U=null;r.values(this.style._layers).forEach(V=>{const j=o._getLayerSourceCache(V);j&&!V.isHidden(this.transform.zoom)&&(!U||U.getSource().maxzoom<j.getSource().maxzoom)&&(U=j)}),U&&this.options.showTileBoundaries&&Wd.debug(this,U,U.getVisibleCoordinates())}this.options.showPadding&&function(U){const V=U.transform.padding;Wt(U,U.transform.height-(V.top||0),3,Gd),Wt(U,V.bottom||0,3,Hd),jr(U,V.left||0,3,Fm),jr(U,U.transform.width-(V.right||0),3,Cu);const j=U.transform.centerPoint;(function(ee,ce,ae,J){Ll(ee,ce-1,ae-10,2,20,J),Ll(ee,ce-10,ae-1,20,2,J)})(U,j.x,U.transform.height-j.y,Au)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(r.window.performance.now()),this.saveCanvasCopy())}renderLayer(o,d,y,w){y.isHidden(this.transform.zoom)||(y.type==="background"||y.type==="sky"||y.type==="custom"||w&&w.length)&&(this.id=y.id,this.gpuTimingStart(y),o.transform.projection.unsupportedLayers&&o.transform.projection.unsupportedLayers.includes(y.type)||Wd[y.type](o,d,y,w,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(o){if(!this.options.gpuTiming)return;const d=this.context.extTimerQuery;let y=this.gpuTimers[o.id];y||(y=this.gpuTimers[o.id]={calls:0,cpuTime:0,query:d.createQueryEXT()}),y.calls++,d.beginQueryEXT(d.TIME_ELAPSED_EXT,y.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery;o.endQueryEXT(o.TIME_ELAPSED_EXT)}collectGpuTimers(){const o=this.gpuTimers;return this.gpuTimers={},o}queryGpuTimers(o){const d={};for(const y in o){const w=o[y],T=this.context.extTimerQuery,A=T.getQueryObjectEXT(w.query,T.QUERY_RESULT_EXT)/1e6;T.deleteQueryEXT(w.query),d[y]=A}return d}translatePosMatrix(o,d,y,w,T){if(!y[0]&&!y[1])return o;const A=T?w==="map"?this.transform.angle:0:w==="viewport"?-this.transform.angle:0;if(A){const U=Math.sin(A),V=Math.cos(A);y=[y[0]*V-y[1]*U,y[0]*U+y[1]*V]}const I=[T?y[0]:He(d,y[0],this.transform.zoom),T?y[1]:He(d,y[1],this.transform.zoom),0],O=new Float32Array(16);return r.translate(O,o,I),O}saveTileTexture(o){const d=this._tileTextures[o.size[0]];d?d.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const d=this._tileTextures[o];return d&&d.length>0?d.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const d=this.imageManager.getPattern(o.from.toString()),y=this.imageManager.getPattern(o.to.toString());return!d||!y}currentGlobalDefines(){const o=this.terrain&&this.terrain.renderingToTexture,d=this.style&&this.style.fog,y=[];return this.terrain&&!this.terrain.renderingToTexture&&y.push("TERRAIN"),d&&!o&&d.getOpacity(this.transform.pitch)!==0&&y.push("FOG"),o&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}useProgram(o,d,y){this.cache=this.cache||{};const w=y||[],T=this.currentGlobalDefines().concat(w),A=Al.cacheKey(o,T,d);return this.cache[A]||(this.cache[A]=new Al(this.context,o,Tl[o],d,Qn[o],T)),this.cache[A]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=r.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new r.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(o,d,y){if(this.terrain&&this.terrain.renderingToTexture)return;const w=this.style.fog;if(w){const T=w.getOpacity(this.transform.pitch);T!==0&&d.setFogUniformValues(o,((A,I,O,U)=>{const V=I.properties.get("color"),j=A.frameCounter/1e3%1,ee=[V.r/V.a,V.g/V.a,V.b/V.a,U];return{u_fog_matrix:O?A.transform.calculateFogTileMatrix(O):A.identityMat,u_fog_range:I.getFovAdjustedRange(A.transform._fov),u_fog_color:ee,u_fog_horizon_blend:I.properties.get("horizon-blend"),u_fog_temporal_offset:j}})(this,w,y,T))}}setTileLoadedFlag(o){this.tileLoaded=o}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const o=this.context.gl,d=o.createTexture();return o.bindTexture(o.TEXTURE_2D,d),o.copyTexImage2D(o.TEXTURE_2D,0,o.RGBA,0,0,o.drawingBufferWidth,o.drawingBufferHeight,0),d}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const o=this.style&&this.style.fog;return!!o&&o.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const o=this._backgroundTiles,d=this._backgroundTiles={},y=this.transform.coveringTiles({tileSize:512});for(const w of y)d[w.key]=o[w.key]||new r.Tile(w,512,this.transform.tileZoom,this);return d}clearBackgroundTiles(){this._backgroundTiles={}}}class ca{constructor(o=0,d=0,y=0,w=0){if(isNaN(o)||o<0||isNaN(d)||d<0||isNaN(y)||y<0||isNaN(w)||w<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=d,this.left=y,this.right=w}interpolate(o,d,y){return d.top!=null&&o.top!=null&&(this.top=r.number(o.top,d.top,y)),d.bottom!=null&&o.bottom!=null&&(this.bottom=r.number(o.bottom,d.bottom,y)),d.left!=null&&o.left!=null&&(this.left=r.number(o.left,d.left,y)),d.right!=null&&o.right!=null&&(this.right=r.number(o.right,d.right,y)),this}getCenter(o,d){const y=r.clamp((this.left+o-this.right)/2,0,o),w=r.clamp((this.top+d-this.bottom)/2,0,d);return new r.pointGeometry(y,w)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new ca(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Vm(m,o){const d=r.getColumn(m,3);r.fromQuat(m,o),r.setColumn(m,3,d)}function jd(m,o){const d=r.identity$1([]);return r.rotateZ$1(d,d,-o),r.rotateX$1(d,d,-m),d}function Su(m,o){const d=[m[0],m[1],0],y=[o[0],o[1],0];if(r.length(d)>=1e-15){const A=r.normalize([],d);r.scale$2(y,A,r.dot(y,A)),o[0]=y[0],o[1]=y[1]}const w=r.cross([],o,m);if(r.len(w)<1e-15)return null;const T=Math.atan2(-w[1],w[0]);return jd(Math.atan2(Math.sqrt(m[0]*m[0]+m[1]*m[1]),-m[2]),T)}class Rl{constructor(o,d){this.position=o,this.orientation=d}get position(){return this._position}set position(o){if(o){const d=o instanceof r.MercatorCoordinate?o:new r.MercatorCoordinate(o[0],o[1],o[2]);this._renderWorldCopies&&(d.x=r.wrap(d.x,0,1)),this._position=d}else this._position=null}lookAtPoint(o,d){if(this.orientation=null,!this.position)return;const y=this._elevation?this._elevation.getAtPointOrZero(r.MercatorCoordinate.fromLngLat(o)):0,w=this.position,T=r.MercatorCoordinate.fromLngLat(o,y),A=[T.x-w.x,T.y-w.y,T.z-w.z];d||(d=[0,0,1]),d[2]=Math.abs(d[2]),this.orientation=Su(A,d)}setPitchBearing(o,d){this.orientation=jd(r.degToRad(o),r.degToRad(-d))}}class zl{constructor(o,d){this._transform=r.identity([]),this.orientation=d,this.position=o}get mercatorPosition(){const o=this.position;return new r.MercatorCoordinate(o[0],o[1],o[2])}get position(){const o=r.getColumn(this._transform,3);return[o[0],o[1],o[2]]}set position(o){var d;o&&r.setColumn(this._transform,3,[(d=o)[0],d[1],d[2],1])}get orientation(){return this._orientation}set orientation(o){this._orientation=o||r.identity$1([]),o&&Vm(this._transform,this._orientation)}getPitchBearing(){const o=this.forward(),d=this.right();return{bearing:Math.atan2(-d[1],d[0]),pitch:Math.atan2(Math.sqrt(o[0]*o[0]+o[1]*o[1]),-o[2])}}setPitchBearing(o,d){this._orientation=jd(o,d),Vm(this._transform,this._orientation)}forward(){const o=r.getColumn(this._transform,2);return[-o[0],-o[1],-o[2]]}up(){const o=r.getColumn(this._transform,1);return[-o[0],-o[1],-o[2]]}right(){const o=r.getColumn(this._transform,0);return[o[0],o[1],o[2]]}getCameraToWorld(o,d){const y=new Float64Array(16);return r.invert(y,this.getWorldToCamera(o,d)),y}getWorldToCameraPosition(o,d,y){const w=this.position;r.scale$2(w,w,-o);const T=new Float64Array(16);return r.fromScaling(T,[y,y,y]),r.translate(T,T,w),T[10]*=d,T}getWorldToCamera(o,d){const y=new Float64Array(16),w=new Float64Array(4),T=this.position;return r.conjugate(w,this._orientation),r.scale$2(T,T,-o),r.fromQuat(y,w),r.translate(y,y,T),y[1]*=-1,y[5]*=-1,y[9]*=-1,y[13]*=-1,y[8]*=d,y[9]*=d,y[10]*=d,y[11]*=d,y}getCameraToClipPerspective(o,d,y,w){const T=new Float64Array(16);return r.perspective(T,o,d,y,w),T}getDistanceToElevation(o){const d=o===0?0:r.mercatorZfromAltitude(o,this.position[1]),y=this.forward();return(d-this.position[2])/y[2]}clone(){return new zl([...this.position],[...this.orientation])}}function $d(m,o){const d=kl(m),y=function(T,A,I,O,U){const V=new r.LngLat(I.lng-180*ua,I.lat),j=new r.LngLat(I.lng+180*ua,I.lat),ee=T.project(V.lng,V.lat),ce=T.project(j.lng,j.lat),ae=-Math.atan2(ce.y-ee.y,ce.x-ee.x),J=r.MercatorCoordinate.fromLngLat(I);J.y=r.clamp(J.y,-.999975,.999975);const Pe=J.toLngLat(),_e=T.project(Pe.lng,Pe.lat),Ae=r.MercatorCoordinate.fromLngLat(Pe);Ae.x+=ua;const De=Ae.toLngLat(),ke=T.project(De.lng,De.lat),Te=Xd(ke.x-_e.x,ke.y-_e.y,ae),Ne=r.MercatorCoordinate.fromLngLat(Pe);Ne.y+=ua;const tt=Ne.toLngLat(),at=T.project(tt.lng,tt.lat),pt=Xd(at.x-_e.x,at.y-_e.y,ae),ht=Math.abs(Te.x)/Math.abs(pt.y),zt=r.identity([]);r.rotateZ(zt,zt,-ae*(1-(U?0:O)));const nt=r.identity([]);return r.scale(nt,nt,[1,1-(1-ht)*O,1]),nt[4]=-pt.x/pt.y*O,r.rotateZ(nt,nt,ae),r.multiply$1(nt,zt,nt),nt}(m.projection,0,m.center,d,o),w=qd(m);return r.scale(y,y,[w,w,1]),y}function qd(m){const o=m.projection,d=kl(m),y=Zd(o,m.center),w=Zd(o,r.LngLat.convert(o.center));return Math.pow(2,y*d+(1-d)*w)}function kl(m){const o=m.projection.range;if(!o)return 0;const d=Math.max(m.width,m.height),y=Math.log(d/1024)/Math.LN2;return r.smoothstep(o[0]+y,o[1]+y,m.zoom)}const ua=1/4e4;function Zd(m,o){const d=r.clamp(o.lat,-r.MAX_MERCATOR_LATITUDE,r.MAX_MERCATOR_LATITUDE),y=new r.LngLat(o.lng-180*ua,d),w=new r.LngLat(o.lng+180*ua,d),T=m.project(y.lng,d),A=m.project(w.lng,d),I=r.MercatorCoordinate.fromLngLat(y),O=r.MercatorCoordinate.fromLngLat(w),U=A.x-T.x,V=A.y-T.y,j=O.x-I.x,ee=O.y-I.y,ce=Math.sqrt((j*j+ee*ee)/(U*U+V*V));return Math.log(ce)/Math.LN2}function Xd(m,o,d){const y=Math.cos(d),w=Math.sin(d);return{x:m*y-o*w,y:m*w+o*y}}class Du{constructor(o,d,y,w,T,A,I){this.tileSize=512,this._renderWorldCopies=T===void 0||T,this._minZoom=o||0,this._maxZoom=d||22,this._minPitch=y==null?0:y,this._maxPitch=w==null?60:w,this.setProjection(A),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new r.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ca,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new zl,this._centerAltitude=0,this._centerAltitudeValidForExaggeration=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const o=new Du(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return o._elevation=this._elevation,o._centerAltitude=this._centerAltitude,o._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,o.tileSize=this.tileSize,o.width=this.width,o.height=this.height,o.cameraElevationReference=this.cameraElevationReference,o._center=this._center,o._setZoom(this.zoom),o._seaLevelZoom=this._seaLevelZoom,o.angle=this.angle,o._fov=this._fov,o._pitch=this._pitch,o._nearZ=this._nearZ,o._farZ=this._farZ,o._averageElevation=this._averageElevation,o._unmodified=this._unmodified,o._edgeInsets=this._edgeInsets.clone(),o._camera=this._camera.clone(),o._calcMatrices(),o.freezeTileCoverage=this.freezeTileCoverage,o}get elevation(){return this._elevation}set elevation(o){this._elevation!==o&&(this._elevation=o,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(o){const d=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||d)&&this._updateCameraOnTerrain(),(o||d)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return r.pick(this.projection,["name","center","parallels"])}setProjection(o){o==null&&(o={name:"mercator"}),this.projectionOptions=o;const d=this.projection?this.getProjection():void 0;this.projection=r.getProjection(o);const y=this.getProjection();return M(d,y)?null:(this._calcMatrices(),y)}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const o=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(o))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new r.pointGeometry(this.width,this.height)}get bearing(){return r.wrap(this.rotation,-180,180)}set bearing(o){this.rotation=o}get rotation(){return-this.angle/Math.PI*180}set rotation(o){const d=-o*Math.PI/180;var y;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=(y=new r.ARRAY_TYPE(4),r.ARRAY_TYPE!=Float32Array&&(y[1]=0,y[2]=0),y[0]=1,y[3]=1,y),function(w,T,A){var I=T[0],O=T[1],U=T[2],V=T[3],j=Math.sin(A),ee=Math.cos(A);w[0]=I*ee+U*j,w[1]=O*ee+V*j,w[2]=I*-j+U*ee,w[3]=O*-j+V*ee}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const d=r.clamp(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(o){this._averageElevation=o,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(o){const d=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._setZoom(d),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(o){this._zoom=o,this.scale=this.zoomScale(o),this.tileZoom=Math.floor(o),this.zoomFraction=o-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=0);const o=this._elevation;this._centerAltitude=o.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=o.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const o=this._elevation,d=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],y=this.horizonLineFromTop();let w=0,T=0;for(let A=0;A<d.length;A++){const I=new r.pointGeometry(d[A][0]*this.width,y+d[A][1]*(this.height-y)),O=o.pointCoordinate(I);if(!O)continue;const U=1/Math.hypot(O[0]-this._camera.position[0],O[1]-this._camera.position[1]);w+=O[3]*U,T+=U}return T===0?NaN:w/T}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const o=this._seaLevelZoom,d=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),y=this.pixelsPerMeter/this.worldSize*d,w=this._mercatorZfromZoom(o),T=this._mercatorZfromZoom(this._maxZoom),A=Math.max(w-y,T);this._setZoom(this._zoomFromMercatorZ(A))}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}computeZoomRelativeTo(o){const d=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,o.toAltitude()));let y;y=o.z<this._camera.position[2]?[d.x,d.y,d.z]:[o.x,o.y,o.z];const w=r.length(r.sub([],this._camera.position,y));return r.clamp(this._zoomFromMercatorZ(w),this._minZoom,this._maxZoom)}setFreeCameraOptions(o){if(!this.height||!o.position&&!o.orientation)return;this._updateCameraState();let d=!1;if(o.orientation&&!r.exactEquals(o.orientation,this._camera.orientation)&&(d=this._setCameraOrientation(o.orientation)),o.position){const y=[o.position.x,o.position.y,o.position.z];r.exactEquals$1(y,this._camera.position)||(this._setCameraPosition(y),d=!0)}d&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const o=this._camera.position,d=new Rl;return d.position=new r.MercatorCoordinate(o[0],o[1],o[2]),d.orientation=this._camera.orientation,d._elevation=this.elevation,d._renderWorldCopies=this.renderWorldCopies,d}_setCameraOrientation(o){if(!r.length$1(o))return!1;r.normalize$1(o,o);const d=r.transformQuat([],[0,0,-1],o),y=r.transformQuat([],[0,-1,0],o);if(y[2]<0)return!1;const w=Su(d,y);return!!w&&(this._camera.orientation=w,!0)}_setCameraPosition(o){const d=this.zoomScale(this.minZoom)*this.tileSize,y=this.zoomScale(this.maxZoom)*this.tileSize,w=this.cameraToCenterDistance;o[2]=r.clamp(o[2],w/y,w/d),this._camera.position=o}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,d,y){this._unmodified=!1,this._edgeInsets.interpolate(o,d,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const d=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(o){const d=[new r.UnwrappedTileID(0,o)];if(this.renderWorldCopies){const y=this.pointCoordinate(new r.pointGeometry(0,0)),w=this.pointCoordinate(new r.pointGeometry(this.width,0)),T=this.pointCoordinate(new r.pointGeometry(this.width,this.height)),A=this.pointCoordinate(new r.pointGeometry(0,this.height)),I=Math.floor(Math.min(y.x,w.x,T.x,A.x)),O=Math.floor(Math.max(y.x,w.x,T.x,A.x)),U=1;for(let V=I-U;V<=O+U;V++)V!==0&&d.push(new r.UnwrappedTileID(V,o))}return d}coveringTiles(o){let d=this.coveringZoomLevel(o);const y=d,w=this.elevation&&!o.isTerrainDEM,T=this.projection.name==="mercator";if(o.minzoom!==void 0&&d<o.minzoom)return[];o.maxzoom!==void 0&&d>o.maxzoom&&(d=o.maxzoom);const A=this.locationCoordinate(this.center),I=this.center.lat,O=1<<d,U=[O*A.x,O*A.y,0],V=this.projection.name==="globe",j=!V,ee=r.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,d,j),ce=V?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),ae=O*r.mercatorZfromAltitude(1,this.center.lat),J=this._camera.position[2]/r.mercatorZfromAltitude(1,this.center.lat),Pe=[O*ce.x,O*ce.y,J*(j?1:ae)],_e=this.cameraToCenterDistance/o.tileSize*(o.roundZoom?1:.502),Ae=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?d:0,De=o.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ke=o.isTerrainDEM?-De:this._elevation?this._elevation.getMinElevationBelowMSL():0,Te=this.projection.isReprojectedInTileSpace?qd(this):1,Ne=ft=>{const gn=new r.MercatorCoordinate(ft.x+25e-6,ft.y,ft.z),Xt=new r.MercatorCoordinate(ft.x,ft.y+25e-6,ft.z),Yt=ft.toLngLat(),xn=gn.toLngLat(),kn=Xt.toLngLat(),dn=this.locationCoordinate(Yt),Mn=this.locationCoordinate(xn),$n=this.locationCoordinate(kn),vi=Math.hypot(Mn.x-dn.x,Mn.y-dn.y),nr=Math.hypot($n.x-dn.x,$n.y-dn.y);return Math.sqrt(vi*nr)*Te/25e-6},tt=ft=>{const qt=De,gn=ke;return{aabb:r.tileAABB(this,O,0,0,0,ft,gn,qt,this.projection),zoom:0,x:0,y:0,minZ:gn,maxZ:qt,wrap:ft,fullyVisible:!1}},at=[];let pt=[];const ht=d,zt=o.reparseOverscaled?y:d,nt=ft=>ft*ft,kt=nt((J-this._centerAltitude)*ae),Pt=ft=>{if(!this._elevation||!ft.tileID||!T)return;const qt=this._elevation.getMinMaxForTile(ft.tileID),gn=ft.aabb;qt?(gn.min[2]=qt.min,gn.max[2]=qt.max,gn.center[2]=(gn.min[2]+gn.max[2])/2):(ft.shouldSplit=Kt(ft),ft.shouldSplit||(gn.min[2]=gn.max[2]=gn.center[2]=this._centerAltitude))},Kt=ft=>{if(ft.zoom<Ae)return!0;if(ft.zoom===ht)return!1;if(ft.shouldSplit!=null)return ft.shouldSplit;const qt=ft.aabb.distanceX(Pe),gn=ft.aabb.distanceY(Pe);let Xt=kt,Yt=1;if(V){Xt=nt(ft.aabb.distanceZ(Pe));const kn=Math.pow(2,ft.zoom),dn=r.latFromMercatorY((ft.y+1)/kn),Mn=r.latFromMercatorY(ft.y/kn),$n=Math.min(Math.max(I,dn),Mn),vi=r.circumferenceAtLatitude($n)/r.circumferenceAtLatitude(I);Yt=Math.min(vi,1)}else if(w&&(Xt=nt(ft.aabb.distanceZ(Pe)*ae)),this.projection.isReprojectedInTileSpace&&y<=5){const kn=Math.pow(2,ft.zoom),dn=Ne(new r.MercatorCoordinate((ft.x+.5)/kn,(ft.y+.5)/kn));Yt=dn>.85?1:dn}const xn=qt*qt+gn*gn+Xt;return xn<nt((1<<ht-ft.zoom)*_e*Yt*((kn,dn)=>{if(dn*nt(.707)<kn)return 1;const Mn=Math.sqrt(dn/kn);return Mn/(1.4144271570014144+(Math.pow(1.1,Mn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Xt,kt),xn))};if(this.renderWorldCopies)for(let ft=1;ft<=3;ft++)at.push(tt(-ft)),at.push(tt(ft));for(at.push(tt(0));at.length>0;){const ft=at.pop(),qt=ft.x,gn=ft.y;let Xt=ft.fullyVisible;if(!Xt){const Yt=ft.aabb.intersects(ee);if(Yt===0)continue;Xt=Yt===2}if(ft.zoom!==ht&&Kt(ft))for(let Yt=0;Yt<4;Yt++){const xn=(qt<<1)+Yt%2,kn=(gn<<1)+(Yt>>1),dn={aabb:T?ft.aabb.quadrant(Yt):r.tileAABB(this,O,ft.zoom+1,xn,kn,ft.wrap,ft.minZ,ft.maxZ,this.projection),zoom:ft.zoom+1,x:xn,y:kn,wrap:ft.wrap,fullyVisible:Xt,tileID:void 0,shouldSplit:void 0,minZ:ft.minZ,maxZ:ft.maxZ};w&&!V&&(dn.tileID=new r.OverscaledTileID(ft.zoom+1===ht?zt:ft.zoom+1,ft.wrap,ft.zoom+1,xn,kn),Pt(dn)),at.push(dn)}else{const Yt=ft.zoom===ht?zt:ft.zoom;if(o.minzoom&&o.minzoom>Yt)continue;const xn=U[0]-(.5+qt+(ft.wrap<<ft.zoom))*(1<<d-ft.zoom),kn=U[1]-.5-gn,dn=ft.tileID?ft.tileID:new r.OverscaledTileID(Yt,ft.wrap,ft.zoom,qt,gn);pt.push({tileID:dn,distanceSq:xn*xn+kn*kn})}}if(this.fogCullDistSq){const ft=this.fogCullDistSq,qt=this.horizonLineFromTop();pt=pt.filter(gn=>{const Xt=[0,0,0,1],Yt=[r.EXTENT,r.EXTENT,0,1],xn=this.calculateFogTileMatrix(gn.tileID.toUnwrapped());r.transformMat4$1(Xt,Xt,xn),r.transformMat4$1(Yt,Yt,xn);const kn=r.getAABBPointSquareDist(Xt,Yt);if(kn===0)return!0;let dn=!1;const Mn=this._elevation;if(Mn&&kn>ft&&qt!==0){const $n=this.calculateProjMatrix(gn.tileID.toUnwrapped());let vi;o.isTerrainDEM||(vi=Mn.getMinMaxForTile(gn.tileID)),vi||(vi={min:ke,max:De});const nr=r.furthestTileCorner(this.rotation),ir=[nr[0]*r.EXTENT,nr[1]*r.EXTENT,vi.max];r.transformMat4(ir,ir,$n),dn=(1-ir[1])*this.height*.5<qt}return kn<ft||dn})}return pt.sort((ft,qt)=>ft.distanceSq-qt.distanceSq).map(ft=>ft.tileID)}resize(o,d){this.width=o,this.height=d,this.pixelsToGLUnits=[2/o,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const d=r.clamp(o.lat,-r.MAX_MERCATOR_LATITUDE,r.MAX_MERCATOR_LATITUDE),y=this.projection.project(o.lng,d);return new r.pointGeometry(y.x*this.worldSize,y.y*this.worldSize)}unproject(o){return this.projection.unproject(o.x/this.worldSize,o.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(o,d){let y,w;const T=this.centerPoint;if(this.projection.name==="globe"){const I=this.worldSize;y=(d.x-T.x)/I,w=(d.y-T.y)/I}else{const I=this.pointCoordinate(d),O=this.pointCoordinate(T);y=I.x-O.x,w=I.y-O.y}const A=this.locationCoordinate(o);this.setLocation(new r.MercatorCoordinate(A.x-y,A.y-w))}setLocation(o){this.center=this.coordinateLocation(o),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(o){return this.projection.locationPoint(this,o)}locationPoint3D(o){return this._coordinatePoint(this.locationCoordinate(o),!0)}pointLocation(o){return this.coordinateLocation(this.pointCoordinate(o))}pointLocation3D(o){return this.coordinateLocation(this.pointCoordinate3D(o))}locationCoordinate(o,d){const y=d?r.mercatorZfromAltitude(d,o.lat):void 0,w=this.projection.project(o.lng,o.lat);return new r.MercatorCoordinate(w.x,w.y,y)}coordinateLocation(o){return this.projection.unproject(o.x,o.y)}pointRayIntersection(o,d){const y=d!=null?d:this._centerAltitude,w=[o.x,o.y,0,1],T=[o.x,o.y,1,1];r.transformMat4$1(w,w,this.pixelMatrixInverse),r.transformMat4$1(T,T,this.pixelMatrixInverse);const A=T[3];r.scale$1(w,w,1/w[3]),r.scale$1(T,T,1/A);const I=w[2],O=T[2];return{p0:w,p1:T,t:I===O?0:(y-I)/(O-I)}}screenPointToMercatorRay(o){const d=[o.x,o.y,0,1],y=[o.x,o.y,1,1];return r.transformMat4$1(d,d,this.pixelMatrixInverse),r.transformMat4$1(y,y,this.pixelMatrixInverse),r.scale$1(d,d,1/d[3]),r.scale$1(y,y,1/y[3]),d[2]=r.mercatorZfromAltitude(d[2],this._center.lat)*this.worldSize,y[2]=r.mercatorZfromAltitude(y[2],this._center.lat)*this.worldSize,r.scale$1(d,d,1/this.worldSize),r.scale$1(y,y,1/this.worldSize),new r.Ray([d[0],d[1],d[2]],r.normalize([],r.sub([],y,d)))}rayIntersectionCoordinate(o){const{p0:d,p1:y,t:w}=o,T=r.mercatorZfromAltitude(d[2],this._center.lat),A=r.mercatorZfromAltitude(y[2],this._center.lat);return new r.MercatorCoordinate(r.number(d[0],y[0],w)/this.worldSize,r.number(d[1],y[1],w)/this.worldSize,r.number(T,A,w))}pointCoordinate(o,d=this._centerAltitude){return this.projection.pointCoordinate(this,o.x,o.y,d)}pointCoordinate3D(o){if(!this.elevation)return this.pointCoordinate(o);const d=this.elevation;let y=this.elevation.pointCoordinate(o);if(y)return new r.MercatorCoordinate(y[0],y[1],y[2]);let w=0,T=this.horizonLineFromTop();if(o.y>T)return this.pointCoordinate(o);const A=.02*T,I=o.clone();for(let O=0;O<10&&T-w>A;O++){I.y=r.number(w,T,.66);const U=d.pointCoordinate(I);U?(T=I.y,y=U):w=I.y}return y?new r.MercatorCoordinate(y[0],y[1],y[2]):this.pointCoordinate(o)}isPointAboveHorizon(o){if(this.elevation)return!this.elevation.pointCoordinate(o);{const d=this.horizonLineFromTop();return o.y<d}}_coordinatePoint(o,d){const y=d&&this.elevation?this.elevation.getAtPointOrZero(o,this._centerAltitude):this._centerAltitude,w=[o.x*this.worldSize,o.y*this.worldSize,y+o.toAltitude(),1];return r.transformMat4$1(w,w,this.pixelMatrix),w[3]>0?new r.pointGeometry(w[0]/w[3],w[1]/w[3]):new r.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(o,d){const y=new r.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),w=new r.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),T=new r.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),A=new r.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let I=this.pointCoordinate(y,o),O=this.pointCoordinate(w,o);const U=this.pointCoordinate(T,d),V=this.pointCoordinate(A,d),j=(ee,ce)=>(ce.y-ee.y)/(ce.x-ee.x);return I.y>1&&O.y>=0?I=new r.MercatorCoordinate((1-V.y)/j(V,I)+V.x,1):I.y<0&&O.y<=1&&(I=new r.MercatorCoordinate(-V.y/j(V,I)+V.x,0)),O.y>1&&I.y>=0?O=new r.MercatorCoordinate((1-U.y)/j(U,O)+U.x,1):O.y<0&&I.y<=1&&(O=new r.MercatorCoordinate(-U.y/j(U,O)+U.x,0)),new r.LngLatBounds().extend(this.coordinateLocation(I)).extend(this.coordinateLocation(O)).extend(this.coordinateLocation(V)).extend(this.coordinateLocation(U))}_getBounds3D(){const o=this.elevation;if(!o.visibleDemTiles.length)return this._getBounds(0,0);const d=o.visibleDemTiles.reduce((y,w)=>{if(w.dem){const T=w.dem.tree;y.min=Math.min(y.min,T.minimums[0]),y.max=Math.max(y.max,T.maximums[0])}return y},{min:Number.MAX_VALUE,max:0});return this._getBounds(d.min*o.exaggeration(),d.max*o.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(o=!0){const d=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,y=this.height/2-d*(1-this._horizonShift);return o?Math.max(0,y):y}getMaxBounds(){return this.maxBounds}setMaxBounds(o){this.maxBounds=o,this.minLat=-r.MAX_MERCATOR_LATITUDE,this.maxLat=r.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,o&&(this.minLat=o.getSouth(),this.maxLat=o.getNorth(),this.minLng=o.getWest(),this.maxLng=o.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=r.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=r.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=r.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=r.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(o,d){return this.projection.createTileMatrix(this,d,o)}calculateDistanceTileData(o){const d=o.key,y=this._distanceTileDataCache;if(y[d])return y[d];const w=o.canonical,T=1/this.height,A=this.cameraWorldSize/this.zoomScale(w.z),I=(w.x+Math.pow(2,w.z)*o.wrap)*A,O=w.y*A,U=this.point,V=this.angle,j=Math.sin(-V),ee=-Math.cos(-V);return y[d]={bearing:[j,ee],center:[(U.x-I)*T,(U.y-O)*T],scale:A/r.EXTENT*T},y[d]}calculateFogTileMatrix(o){const d=o.key,y=this._fogTileMatrixCache;if(y[d])return y[d];const w=this.calculatePosMatrix(o,this.cameraWorldSize);return r.multiply$1(w,this.worldToFogMatrix,w),y[d]=new Float32Array(w),y[d]}calculateProjMatrix(o,d=!1){const y=o.key,w=d?this._alignedProjMatrixCache:this._projMatrixCache;if(w[y])return w[y];const T=this.calculatePosMatrix(o,this.worldSize);return r.multiply$1(T,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.alignedProjMatrix:this.projMatrix,T),w[y]=new Float32Array(T),w[y]}calculatePixelsToTileUnitsMatrix(o){const d=o.tileID.key,y=this._pixelsToTileUnitsCache;if(y[d])return y[d];const w=function(T,A){const{scale:I}=T.tileTransform,O=I*r.EXTENT/(T.tileSize*Math.pow(2,A.zoom-T.tileID.overscaledZ+T.tileID.canonical.z));return U=new Float32Array(4),ee=(V=A.inverseAdjustmentMatrix)[1],ce=V[2],ae=V[3],Pe=(j=[O,O])[1],U[0]=V[0]*(J=j[0]),U[1]=ee*J,U[2]=ce*Pe,U[3]=ae*Pe,U;var U,V,j,ee,ce,ae,J,Pe}(o,this);return y[d]=w,y[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const o=this._elevation;this._updateCameraState();const d=r.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(d),w=this._camera.forward(),T=r.mercatorZfromAltitude(1,this._center.lat);y[2]/=T,w[2]/=T,r.normalize(w,w);const A=o.raycast(y,w,o.exaggeration());if(A){const I=r.scaleAndAdd([],y,w,A),O=new r.MercatorCoordinate(I[0],I[1],r.mercatorZfromAltitude(I[2],r.latFromMercatorY(I[1]))),U=(O.z+r.length([O.x-y[0],O.y-y[1],O.z-y[2]*T]))*this._projectionScaler;this._seaLevelZoom=this._zoomFromMercatorZ(U),this._centerAltitude=O.toAltitude(),this._center=this.coordinateLocation(O),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const o=this._elevation;this._updateCameraState();const d=r.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(d),w=o.getAtPointOrZero(new r.MercatorCoordinate(...y)),T=this._minimumHeightOverTerrain()*Math.cos(r.degToRad(this._maxPitch)),A=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*w;if(A<T){const I=this.locationCoordinate(this._center,this._centerAltitude),O=[I.x-y[0],I.y-y[1],I.z-y[2]],U=r.length(O);O[2]-=(T-A)/this._projectionScaler;const V=r.length(O);if(V===0)return;r.scale$2(O,O,U/V*this._projectionScaler),this._camera.position=[I.x-O[0],I.y-O[1],I.z*this._projectionScaler-O[2]],this._camera.orientation=Su(O,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const j=this.center;return j.lat=r.clamp(j.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(j.lng=r.clamp(j.lng,this.minLng,this.maxLng)),this.center=j,void(this._constraining=!1)}const o=this._unmodified,{x:d,y}=this.point;let w=0,T=d,A=y;const I=this.width/2,O=this.height/2,U=this.worldMinY*this.scale,V=this.worldMaxY*this.scale;if(y-O<U&&(A=U+O),y+O>V&&(A=V-O),V-U<this.height&&(w=Math.max(w,this.height/(V-U)),A=(V+U)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const j=this.worldMinX*this.scale,ee=this.worldMaxX*this.scale,ce=this.worldSize/2-(j+ee)/2;T=(d+ce+this.worldSize)%this.worldSize-ce,T-I<j&&(T=j+I),T+I>ee&&(T=ee-I),ee-j<this.width&&(w=Math.max(w,this.width/(ee-j)),T=(ee+j)/2)}T===d&&A===y||(this.center=this.unproject(new r.pointGeometry(T,A))),w&&(this.zoom+=this.scaleZoom(w)),this._constrainCameraAltitude(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let o=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(o=Math.max(o,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),o}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const o=this._fov/2,d=this.centerOffset,y=this.pixelsPerMeter;this._projectionScaler=y/(r.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(o)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?y:1),T=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);T[8]=2*-d.x/this.width,T[9]=2*d.y/this.height;let A=r.mul([],T,w);if(this.projection.isReprojectedInTileSpace){const ke=this.locationCoordinate(this.center),Te=r.identity([]);r.translate(Te,Te,[ke.x*this.worldSize,ke.y*this.worldSize,0]),r.multiply$1(Te,Te,$d(this)),r.translate(Te,Te,[-ke.x*this.worldSize,-ke.y*this.worldSize,0]),r.multiply$1(A,A,Te),this.inverseAdjustmentMatrix=function(Ne){const tt=$d(Ne,!0);return se([],[tt[0],tt[1],tt[4],tt[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=r.scale([],A,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=A,this.invProjMatrix=r.invert(new Float64Array(16),this.projMatrix);const I=new Float32Array(16);r.identity(I),r.scale(I,I,[1,-1,1]),r.rotateX(I,I,this._pitch),r.rotateZ(I,I,this.angle);const O=r.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),U=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;O[8]=2*-d.x/this.width,O[9]=2*(d.y+U)/this.height,this.skyboxMatrix=r.multiply$1(I,O,I);const V=this.point,j=V.x,ee=V.y,ce=this.width%2/2,ae=this.height%2/2,J=Math.cos(this.angle),Pe=Math.sin(this.angle),_e=j-Math.round(j)+J*ce+Pe*ae,Ae=ee-Math.round(ee)+J*ae+Pe*ce,De=new Float64Array(A);if(r.translate(De,De,[_e>.5?_e-1:_e,Ae>.5?Ae-1:Ae,0]),this.alignedProjMatrix=De,A=r.create(),r.scale(A,A,[this.width/2,-this.height/2,1]),r.translate(A,A,[1,-1,0]),this.labelPlaneMatrix=A,A=r.create(),r.scale(A,A,[1,-1,1]),r.translate(A,A,[-1,-1,0]),r.scale(A,A,[2/this.width,2/this.height,1]),this.glCoordMatrix=A,this.pixelMatrix=r.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},A=r.invert(new Float64Array(16),this.pixelMatrix),!A)throw new Error("failed to invert matrix");this.pixelMatrixInverse=A,this.globeMatrix=this.projection.name==="globe"?r.calculateGlobeMatrix(this):A,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const o=this.cameraWorldSize,d=this.cameraPixelsPerMeter,y=this._camera.position,w=1/this.height,T=[o,o,d];r.scale$2(T,T,w),r.scale$2(y,y,-1),r.multiply$2(y,y,T);const A=r.create();r.translate(A,A,y),r.scale(A,A,T),this.mercatorFogMatrix=A,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(o,d,w)}_computeCameraPosition(o){const d=(o=o||this.pixelsPerMeter)/this.pixelsPerMeter,y=this._camera.forward(),w=this.point,T=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*d-o/this.worldSize*this._centerAltitude;return[w.x/this.worldSize-y[0]*T,w.y/this.worldSize-y[1]*T,o/this.worldSize*this._centerAltitude-y[2]*T]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(o){const d=this._maxCameraBoundsDistance()*Math.cos(this._pitch),y=o[2];let w=1;y>0&&(w=Math.min((d-this._camera.position[2])/y,1)),this._camera.position=r.scaleAndAdd([],this._camera.position,o,w),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const o=this._camera.position,d=this._camera.forward(),{pitch:y,bearing:w}=this._camera.getPitchBearing(),T=r.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,A=this._mercatorZfromZoom(this._maxZoom)*Math.cos(r.degToRad(this._maxPitch)),I=Math.max((o[2]-T)/Math.cos(y),A),O=this._zoomFromMercatorZ(I);r.scaleAndAdd(o,o,d,I),this._pitch=r.clamp(y,r.degToRad(this.minPitch),r.degToRad(this.maxPitch)),this.angle=r.wrap(w,-Math.PI,Math.PI),this._setZoom(r.clamp(O,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new r.MercatorCoordinate(o[0],o[1],o[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(o){return Math.pow(2,o)*this.tileSize}_mercatorZfromZoom(o){return this.cameraToCenterDistance/this._worldSizeFromZoom(o)}_minimumHeightOverTerrain(){const o=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(o)}_zoomFromMercatorZ(o){return this.scaleZoom(this.cameraToCenterDistance/(o*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(r.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(o,d){const y=Math.min(o.x,d.x),w=Math.max(o.x,d.x),T=Math.min(o.y,d.y),A=Math.max(o.y,d.y);if(T<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const I=[new r.pointGeometry(y,T),new r.pointGeometry(w,A),new r.pointGeometry(y,A),new r.pointGeometry(w,T)],O=this.renderWorldCopies?-3:0,U=this.renderWorldCopies?4:1;for(const V of I){const j=this.pointRayIntersection(V);if(j.t<0)return!0;const ee=this.rayIntersectionCoordinate(j);if(ee.x<O||ee.y<0||ee.x>U||ee.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+r.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new r.pointGeometry(0,0),new r.pointGeometry(this.width,this.height))}zoomDeltaToMovement(o,d){const y=r.length(r.sub([],this._camera.position,o)),w=this._zoomFromMercatorZ(y)+d;return y-this._mercatorZfromZoom(w)}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new r.pointGeometry(0,o))}}function Yd(m,o){let d=!1,y=null;const w=()=>{y=null,d&&(m(),y=setTimeout(w,o),d=!1)};return()=>(d=!0,y||w(),y)}class Gm{constructor(o){this._hashName=o&&encodeURIComponent(o),r.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Yd(this._updateHashUnthrottled.bind(this),300)}addTo(o){return this._map=o,r.window.addEventListener("hashchange",this._onHashChange,!1),o.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),r.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(o){const d=this._map;if(!d)return"";const y=d.getCenter(),w=Math.round(100*d.getZoom())/100,T=Math.ceil((w*Math.LN2+Math.log(512/360/.5))/Math.LN10),A=Math.pow(10,T),I=Math.round(y.lng*A)/A,O=Math.round(y.lat*A)/A,U=d.getBearing(),V=d.getPitch();let j="";if(j+=o?`/${I}/${O}/${w}`:`${w}/${O}/${I}`,(U||V)&&(j+="/"+Math.round(10*U)/10),V&&(j+=`/${Math.round(V)}`),this._hashName){const ee=this._hashName;let ce=!1;const ae=r.window.location.hash.slice(1).split("&").map(J=>{const Pe=J.split("=")[0];return Pe===ee?(ce=!0,`${Pe}=${j}`):J}).filter(J=>J);return ce||ae.push(`${ee}=${j}`),`#${ae.join("&")}`}return`#${j}`}_getCurrentHash(){const o=r.window.location.hash.replace("#","");if(this._hashName){let d;return o.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(d=y)}),(d&&d[1]||"").split("/")}return o.split("/")}_onHashChange(){const o=this._map;if(!o)return!1;const d=this._getCurrentHash();if(d.length>=3&&!d.some(y=>isNaN(y))){const y=o.dragRotate.isEnabled()&&o.touchZoomRotate.isEnabled()?+(d[3]||0):o.getBearing();return o.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:y,pitch:+(d[4]||0)}),!0}return!1}_updateHashUnthrottled(){const o=r.window.location.href.replace(/(#.+)?$/,this.getHashString());r.window.history.replaceState(r.window.history.state,null,o)}}const Oo={linearity:.3,easing:r.bezier(0,0,.3,1)},Hm=r.extend({deceleration:2500,maxSpeed:1400},Oo),Wm=r.extend({deceleration:20,maxSpeed:1400},Oo),jm=r.extend({deceleration:1e3,maxSpeed:360},Oo),$m=r.extend({deceleration:1e3,maxSpeed:90},Oo);class qm{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:r.exported.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,d=r.exported.now();for(;o.length>0&&d-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new r.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:T}of this._inertiaBuffer)d.zoom+=T.zoomDelta||0,d.bearing+=T.bearingDelta||0,d.pitch+=T.pitchDelta||0,T.panDelta&&d.pan._add(T.panDelta),T.around&&(d.around=T.around),T.pinchAround&&(d.pinchAround=T.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,w={};if(d.pan.mag()){const T=ji(d.pan.mag(),y,r.extend({},Hm,o||{}));w.offset=d.pan.mult(T.amount/d.pan.mag()),w.center=this._map.transform.center,Bl(w,T)}if(d.zoom){const T=ji(d.zoom,y,Wm);w.zoom=this._map.transform.zoom+T.amount,Bl(w,T)}if(d.bearing){const T=ji(d.bearing,y,jm);w.bearing=this._map.transform.bearing+r.clamp(T.amount,-179,179),Bl(w,T)}if(d.pitch){const T=ji(d.pitch,y,$m);w.pitch=this._map.transform.pitch+T.amount,Bl(w,T)}if(w.zoom||w.bearing){const T=d.pinchAround===void 0?d.around:d.pinchAround;w.around=T?this._map.unproject(T):this._map.getCenter()}return this.clear(),w.noMoveStart=!0,w}}function Bl(m,o){(!m.duration||m.duration<o.duration)&&(m.duration=o.duration,m.easing=o.easing)}function ji(m,o,d){const{maxSpeed:y,linearity:w,deceleration:T}=d,A=r.clamp(m*w/(o/1e3),-y,y),I=Math.abs(A)/(T*w);return{easing:d.easing,duration:1e3*I,amount:A*(I/2)}}class Lr extends r.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,y,w={}){const T=$(d.getCanvasContainer(),y),A=d.unproject(T);super(o,r.extend({point:T,lngLat:A,originalEvent:y},w)),this._defaultPrevented=!1,this.target=d}}class Fl extends r.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,y){const w=o==="touchend"?y.changedTouches:y.touches,T=te(d.getCanvasContainer(),w),A=T.map(O=>d.unproject(O)),I=T.reduce((O,U,V,j)=>O.add(U.div(j.length)),new r.pointGeometry(0,0));super(o,{points:T,point:I,lngLats:A,lngLat:d.unproject(I),originalEvent:y}),this._defaultPrevented=!1}}class Z_ extends r.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,d,y){super(o,{originalEvent:y}),this._defaultPrevented=!1}}class X_{constructor(o,d){this._map=o,this._clickTolerance=d.clickTolerance}reset(){this._mousedownPos=void 0}wheel(o){return this._firePreventable(new Z_(o.type,this._map,o))}mousedown(o,d){return this._mousedownPos=d,this._firePreventable(new Lr(o.type,this._map,o))}mouseup(o){this._map.fire(new Lr(o.type,this._map,o))}preclick(o){const d=r.extend({},o);d.type="preclick",this._map.fire(new Lr(d.type,this._map,d))}click(o,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||(this.preclick(o),this._map.fire(new Lr(o.type,this._map,o)))}dblclick(o){return this._firePreventable(new Lr(o.type,this._map,o))}mouseover(o){this._map.fire(new Lr(o.type,this._map,o))}mouseout(o){this._map.fire(new Lr(o.type,this._map,o))}touchstart(o){return this._firePreventable(new Fl(o.type,this._map,o))}touchmove(o){this._map.fire(new Fl(o.type,this._map,o))}touchend(o){this._map.fire(new Fl(o.type,this._map,o))}touchcancel(o){this._map.fire(new Fl(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class No{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(o){this._map.fire(new Lr(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Lr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._map.fire(new Lr(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Zm{constructor(o,d){this._map=o,this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,d){this.isEnabled()&&o.shiftKey&&o.button===0&&(G(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(o,d){if(!this._active)return;const y=d;if(this._lastPos.equals(y)||!this._box&&y.dist(this._startPos)<this._clickTolerance)return;const w=this._startPos;this._lastPos=y,this._box||(this._box=D("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",o));const T=Math.min(w.x,y.x),A=Math.max(w.x,y.x),I=Math.min(w.y,y.y),O=Math.max(w.y,y.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${T}px,${I}px)`,this._box.style.width=A-T+"px",this._box.style.height=O-I+"px")})}mouseupWindow(o,d){if(!this._active||o.button!==0)return;const y=this._startPos,w=d;if(this.reset(),ue(),y.x!==w.x||y.y!==w.y)return this._map.fire(new r.Event("boxzoomend",{originalEvent:o})),{cameraAnimation:T=>T.fitScreenCoordinates(y,w,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),X(),delete this._startPos,delete this._lastPos}_fireEvent(o,d){return this._map.fire(new r.Event(o,{originalEvent:d}))}}function ha(m,o){const d={};for(let y=0;y<m.length;y++)d[m[y].identifier]=o[y];return d}class Mo{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(o,d,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=o.timeStamp),y.length===this.numTouches&&(this.centroid=function(w){const T=new r.pointGeometry(0,0);for(const A of w)T._add(A);return T.div(w.length)}(d),this.touches=ha(y,d)))}touchmove(o,d,y){if(this.aborted||!this.centroid)return;const w=ha(y,d);for(const T in this.touches){const A=this.touches[T],I=w[T];(!I||I.dist(A)>30)&&(this.aborted=!0)}}touchend(o,d,y){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),y.length===0){const w=!this.aborted&&this.centroid;if(this.reset(),w)return w}}}class Ps{constructor(o){this.singleTap=new Mo(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(o,d,y){this.singleTap.touchstart(o,d,y)}touchmove(o,d,y){this.singleTap.touchmove(o,d,y)}touchend(o,d,y){const w=this.singleTap.touchend(o,d,y);if(w){const T=o.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(w)<30;if(T&&A||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=w,this.count===this.numTaps)return this.reset(),w}}}class $t{constructor(){this._zoomIn=new Ps({numTouches:1,numTaps:2}),this._zoomOut=new Ps({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,d,y){this._zoomIn.touchstart(o,d,y),this._zoomOut.touchstart(o,d,y)}touchmove(o,d,y){this._zoomIn.touchmove(o,d,y),this._zoomOut.touchmove(o,d,y)}touchend(o,d,y){const w=this._zoomIn.touchend(o,d,y),T=this._zoomOut.touchend(o,d,y);return w?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()+1,around:A.unproject(w)},{originalEvent:o})}):T?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()-1,around:A.unproject(T)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Xm={0:1,2:2,1:4};class Pu{constructor(o){this.reset(),this._clickTolerance=o.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(o,d){return!1}_move(o,d){return{}}mousedown(o,d){if(this._lastPoint)return;const y=oe(o);this._correctButton(o,y)&&(this._lastPoint=d,this._eventButton=y)}mousemoveWindow(o,d){const y=this._lastPoint;if(y){if(o.preventDefault(),this._eventButton!=null&&function(w,T){const A=Xm[T];return w.buttons===void 0||(w.buttons&A)!==A}(o,this._eventButton))this.reset();else if(this._moved||!(d.dist(y)<this._clickTolerance))return this._moved=!0,this._lastPoint=d,this._move(y,d)}}mouseupWindow(o){this._lastPoint&&oe(o)===this._eventButton&&(this._moved&&ue(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ol extends Pu{useMiddle(o){let d=this._middle;return this._middle=o,d}mousedown(o,d){super.mousedown(o,d),this._lastPoint&&(this._active=!0)}_correctButton(o,d){return this._middle?d===1&&!o.ctrlKey:d===0&&!o.ctrlKey}_move(o,d){return{around:d,panDelta:d.sub(o)}}}class Ls extends Pu{_correctButton(o,d){return d===0&&o.ctrlKey||d===2}_move(o,d){const y=.8*(d.x-o.x);if(y)return this._active=!0,{bearingDelta:y}}contextmenu(o){o.preventDefault()}}class Jd extends Pu{_correctButton(o,d){return d===0&&o.ctrlKey||d===2}_move(o,d){const y=-.5*(d.y-o.y);if(y)return this._active=!0,{pitchDelta:y}}contextmenu(o){o.preventDefault()}}class Ym{constructor(o,d){this._map=o,this._el=o.getCanvasContainer(),this._minTouches=1,this._clickTolerance=d.clickTolerance||1,this.reset(),r.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new r.pointGeometry(0,0)}touchstart(o,d,y){return this._calculateTransform(o,d,y)}touchmove(o,d,y){if(this._active&&!(y.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(y.length===1)return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return o.preventDefault(),this._calculateTransform(o,d,y)}}touchend(o,d,y){this._calculateTransform(o,d,y),this._active&&y.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,d,y){y.length>0&&(this._active=!0);const w=ha(y,d),T=new r.pointGeometry(0,0),A=new r.pointGeometry(0,0);let I=0;for(const U in w){const V=w[U],j=this._touches[U];j&&(T._add(V),A._add(V.sub(j)),I++,w[U]=V)}if(this._touches=w,I<this._minTouches||!A.mag())return;const O=A.div(I);return this._sum._add(O),this._sum.mag()<this._clickTolerance?void 0:{around:T.div(I),panDelta:O}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=D("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class Lu{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(o){}_move(o,d,y){return{}}touchstart(o,d,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([d[0],d[1]]))}touchmove(o,d,y){const w=this._firstTwoTouches;if(!w)return;o.preventDefault();const[T,A]=w,I=Nl(y,d,T),O=Nl(y,d,A);if(!I||!O)return;const U=this._aroundCenter?null:I.add(O).div(2);return this._move([I,O],U,o)}touchend(o,d,y){if(!this._firstTwoTouches)return;const[w,T]=this._firstTwoTouches,A=Nl(y,d,w),I=Nl(y,d,T);A&&I||(this._active&&ue(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Nl(m,o,d){for(let y=0;y<m.length;y++)if(m[y].identifier===d)return o[y]}function Kd(m,o){return Math.log(m/o)/Math.LN2}class Jm extends Lu{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,d){const y=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(Kd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Kd(this._distance,y),pinchAround:d}}}function Qd(m,o){return 180*m.angleWith(o)/Math.PI}class Iu extends Lu{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,d){const y=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Qd(this._vector,y),pinchAround:d}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const d=25/(Math.PI*this._minDiameter)*360,y=Qd(o,this._startVector);return Math.abs(y)<d}}function Ul(m){return Math.abs(m.y)>Math.abs(m.x)}class Ru extends Lu{constructor(o){super(),this._map=o}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(o){this._lastPoints=o,Ul(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,d,y){const w=this._lastPoints;if(!w)return;const T=o[0].sub(w[0]),A=o[1].sub(w[1]);return this._map._cooperativeGestures&&y.touches.length<3||(this._valid=this.gestureBeginsVertically(T,A,y.timeStamp),!this._valid)?void 0:(this._lastPoints=o,this._active=!0,{pitchDelta:(T.y+A.y)/2*-.5})}gestureBeginsVertically(o,d,y){if(this._valid!==void 0)return this._valid;const w=o.mag()>=2,T=d.mag()>=2;if(!w&&!T)return;if(!w||!T)return this._firstMove==null&&(this._firstMove=y),y-this._firstMove<100&&void 0;const A=o.y>0==d.y>0;return Ul(o)&&Ul(d)&&A}}const Km={panStep:100,bearingStep:15,pitchStep:10};class Qm{constructor(){const o=Km;this._panStep=o.panStep,this._bearingStep=o.bearingStep,this._pitchStep=o.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let d=0,y=0,w=0,T=0,A=0;switch(o.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:o.shiftKey?y=-1:(o.preventDefault(),T=-1);break;case 39:o.shiftKey?y=1:(o.preventDefault(),T=1);break;case 38:o.shiftKey?w=1:(o.preventDefault(),A=-1);break;case 40:o.shiftKey?w=-1:(o.preventDefault(),A=1);break;default:return}return this._rotationDisabled&&(y=0,w=0),{cameraAnimation:I=>{const O=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:eg,zoom:d?Math.round(O)+d*(o.shiftKey?2:1):O,bearing:I.getBearing()+y*this._bearingStep,pitch:I.getPitch()+w*this._pitchStep,offset:[-T*this._panStep,-A*this._panStep],center:I.getCenter()},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function eg(m){return m*(2-m)}const ep=4.000244140625;class tg{constructor(o,d){this._map=o,this._el=o.getCanvasContainer(),this._handler=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,r.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(o){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(o.ctrlKey||o.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let d=o.deltaMode===r.window.WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const y=r.exported.now(),w=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,d!==0&&d%ep==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":w>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(w*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),o.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=o,this._delta-=d,this._active||this._start(o)),o.preventDefault()}_onTimeout(o){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(o)}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=$(this._el,o);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:d,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._map.transform,d=()=>o._terrainEnabled()&&this._aroundCoord?o.computeZoomRelativeTo(this._aroundCoord):o.zoom;if(this._delta!==0){const O=this._type==="wheel"&&Math.abs(this._delta)>ep?this._wheelZoomRate:this._defaultZoomRate;let U=2/(1+Math.exp(-Math.abs(this._delta*O)));this._delta<0&&U!==0&&(U=1/U);const V=d(),j=Math.pow(2,V),ee=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):j;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(ee*U))),this._type==="wheel"&&(this._startZoom=d(),this._easing=this._smoothOutEasing(200)),this._delta=0}const y=typeof this._targetZoom=="number"?this._targetZoom:d(),w=this._startZoom,T=this._easing;let A,I=!1;if(this._type==="wheel"&&w&&T){const O=Math.min((r.exported.now()-this._lastWheelEventTime)/200,1),U=T(O);A=r.number(w,y,U),O<1?this._frameId||(this._frameId=!0):I=!0}else A=y,I=!0;return this._active=!0,I&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!I,zoomDelta:A-d(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let d=r.ease;if(this._prevEase){const y=this._prevEase,w=(r.exported.now()-y.start)/y.duration,T=y.easing(w+.01)-y.easing(w),A=.27/Math.sqrt(T*T+1e-4)*.01,I=Math.sqrt(.0729-A*A);d=r.bezier(A,I,.25,1)}return this._prevEase={start:r.exported.now(),duration:o,easing:d},d}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=D("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(r.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!r.window.document.fullscreenElement||!!r.window.document.webkitFullscreenElement}_showBlockerAlert(){this._alertContainer.style.visibility==="hidden"&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class ng{constructor(o,d){this._clickZoom=o,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ig{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(o,d){return o.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:y.getZoom()+(o.shiftKey?-1:1),around:y.unproject(d)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class tp{constructor(){this._tap=new Ps({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(o,d,y){this._swipePoint||(this._tapTime&&o.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?y.length>0&&(this._swipePoint=d[0],this._swipeTouch=y[0].identifier):this._tap.touchstart(o,d,y))}touchmove(o,d,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const w=d[0],T=w.y-this._swipePoint.y;return this._swipePoint=w,o.preventDefault(),this._active=!0,{zoomDelta:T/128}}}else this._tap.touchmove(o,d,y)}touchend(o,d,y){this._tapTime?this._swipePoint&&y.length===0&&this.reset():this._tap.touchend(o,d,y)&&(this._tapTime=o.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class rg{constructor(o,d,y){this._el=o,this._mousePan=d,this._touchPan=y}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}useMouseMiddle(o){return this._mousePan.useMiddle(o)}}class og{constructor(o,d,y){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=d,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ag{constructor(o,d,y,w){this._el=o,this._touchZoom=d,this._touchRotate=y,this._tapDragZoom=w,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Vl=m=>m.zoom||m.drag||m.pitch||m.rotate;class np extends r.Event{}class sg{constructor(){this.constants=[1,1,.01],this.radius=0}setup(o,d){const y=r.sub([],d,o);this.radius=r.length(y[2]<0?r.div([],y,this.constants):[y[0],y[1],0])}projectRay(o){r.div(o,o,this.constants),r.normalize(o,o),r.mul$1(o,o,this.constants);const d=r.scale$2([],o,this.radius);if(d[2]>0){const y=r.scale$2([],[0,0,1],r.dot(d,[0,0,1])),w=r.scale$2([],r.normalize([],[d[0],d[1],0]),this.radius),T=r.add([],d,r.scale$2([],r.sub([],r.add([],w,y),d),2));d[0]=T[0],d[1]=T[1]}return d}}function Is(m){return m.panDelta&&m.panDelta.mag()||m.zoomDelta||m.bearingDelta||m.pitchDelta}class lg{constructor(o,d){this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new qm(o),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new sg,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(d),r.bindAll(["handleEvent","handleWindowEvent"],this);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[r.window.document,"mousemove",{capture:!0}],[r.window.document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[r.window,"blur",void 0]];for(const[w,T,A]of this._listeners)w.addEventListener(T,w===r.window.document?this.handleWindowEvent:this.handleEvent,A)}destroy(){for(const[o,d,y]of this._listeners)o.removeEventListener(d,o===r.window.document?this.handleWindowEvent:this.handleEvent,y)}_addDefaultHandlers(o){const d=this._map,y=d.getCanvasContainer();this._add("mapEvent",new X_(d,o));const w=d.boxZoom=new Zm(d,o);this._add("boxZoom",w);const T=new $t,A=new ig;d.doubleClickZoom=new ng(A,T),this._add("tapZoom",T),this._add("clickZoom",A);const I=new tp;this._add("tapDragZoom",I);const O=d.touchPitch=new Ru(d);this._add("touchPitch",O);const U=new Ls(o),V=new Jd(o);d.dragRotate=new og(o,U,V),this._add("mouseRotate",U,["mousePitch"]),this._add("mousePitch",V,["mouseRotate"]);const j=new Ol(o),ee=new Ym(d,o);d.dragPan=new rg(y,j,ee),this._add("mousePan",j),this._add("touchPan",ee,["touchZoom","touchRotate"]);const ce=new Iu,ae=new Jm;d.touchZoomRotate=new ag(y,ae,ce,I),this._add("touchRotate",ce,["touchPan","touchZoom"]),this._add("touchZoom",ae,["touchPan","touchRotate"]),this._add("blockableMapEvent",new No(d));const J=d.scrollZoom=new tg(d,this);this._add("scrollZoom",J,["mousePan"]);const Pe=d.keyboard=new Qm;this._add("keyboard",Pe);for(const _e of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])o.interactive&&o[_e]&&d[_e].enable(o[_e])}_add(o,d,y){this._handlers.push({handlerName:o,handler:d,allowed:y}),this._handlersById[o]=d}stop(o){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Vl(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,d,y){for(const w in o)if(w!==y&&(!d||d.indexOf(w)<0))return!0;return!1}handleWindowEvent(o){this.handleEvent(o,`${o.type}Window`)}_getMapTouches(o){const d=[];for(const y of o)this._el.contains(y.target)&&d.push(y);return d}handleEvent(o,d){this._updatingCamera=!0;const y=o.type==="renderFrame",w=y?void 0:o,T={needsRenderFrame:!1},A={},I={},O=o.touches?this._getMapTouches(o.touches):void 0,U=O?te(this._el,O):y?void 0:$(this._el,o);for(const{handlerName:ee,handler:ce,allowed:ae}of this._handlers){if(!ce.isEnabled())continue;let J;this._blockedByActive(I,ae,ee)?ce.reset():ce[d||o.type]&&(J=ce[d||o.type](o,U,O),this.mergeHandlerResult(T,A,J,ee,w),J&&J.needsRenderFrame&&this._triggerRenderFrame()),(J||ce.isActive())&&(I[ee]=ce)}const V={};for(const ee in this._previousActiveHandlers)I[ee]||(V[ee]=w);this._previousActiveHandlers=I,(Object.keys(V).length||Is(T))&&(this._changes.push([T,A,V]),this._triggerRenderFrame()),(Object.keys(I).length||Is(T))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:j}=T;j&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],j(this._map))}mergeHandlerResult(o,d,y,w,T){if(!y)return;r.extend(o,y);const A={handlerName:w,originalEvent:y.originalEvent||T};y.zoomDelta!==void 0&&(d.zoom=A),y.panDelta!==void 0&&(d.drag=A),y.pitchDelta!==void 0&&(d.pitch=A),y.bearingDelta!==void 0&&(d.rotate=A)}_applyChanges(){const o={},d={},y={};for(const[w,T,A]of this._changes)w.panDelta&&(o.panDelta=(o.panDelta||new r.pointGeometry(0,0))._add(w.panDelta)),w.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+w.zoomDelta),w.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+w.bearingDelta),w.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+w.pitchDelta),w.around!==void 0&&(o.around=w.around),w.aroundCoord!==void 0&&(o.aroundCoord=w.aroundCoord),w.pinchAround!==void 0&&(o.pinchAround=w.pinchAround),w.noInertia&&(o.noInertia=w.noInertia),r.extend(d,T),r.extend(y,A);this._updateMapTransform(o,d,y),this._changes=[]}_updateMapTransform(o,d,y){const w=this._map,T=w.transform,A=Ae=>[Ae.x,Ae.y,Ae.z];if((Ae=>{const De=this._eventsInProgress.drag;return De&&!this._handlersById[De.handlerName].isActive()})()&&!Is(o)){const Ae=T.zoom;T.cameraElevationReference="sea",T.recenterOnTerrain(),T.cameraElevationReference="ground",Ae!==T.zoom&&this._map._update(!0)}if(!Is(o))return void this._fireEvents(d,y,!0);let{panDelta:I,zoomDelta:O,bearingDelta:U,pitchDelta:V,around:j,aroundCoord:ee,pinchAround:ce}=o;ce!==void 0&&(j=ce),(Ae=>d.drag&&!this._eventsInProgress.drag)()&&j&&(this._dragOrigin=A(T.pointCoordinate3D(j)),this._trackingEllipsoid.setup(T._camera.position,this._dragOrigin)),T.cameraElevationReference="sea",w._stop(!0),j=j||w.transform.centerPoint,U&&(T.bearing+=U),V&&(T.pitch+=V),T._updateCameraState();const ae=[0,0,0];if(I){const Ae=T.pointCoordinate(j);if(T.projection.name==="globe"){const De=r.latFromMercatorY(Ae.y),ke=T.center.lat,Te=Math.min(r.mercatorZfromAltitude(1,De)/r.mercatorZfromAltitude(1,ke),2);I=I.rotate(-T.angle),ae[0]=-I.x/T.worldSize*Te,ae[1]=-I.y/T.worldSize*Te}else{const De=T.pointCoordinate(j.sub(I));Ae&&De&&(ae[0]=De.x-Ae.x,ae[1]=De.y-Ae.y)}}const J=T.zoom,Pe=[0,0,0];if(O){const Ae=A(ee||T.pointCoordinate3D(j)),De={dir:r.normalize([],r.sub([],Ae,T._camera.position))};if(De.dir[2]<0){const ke=T.zoomDeltaToMovement(Ae,O);r.scale$2(Pe,De.dir,ke)}}const _e=r.add(ae,ae,Pe);T._translateCameraConstrained(_e),O&&Math.abs(T.zoom-J)>1e-4&&T.recenterOnTerrain(),T.cameraElevationReference="ground",this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(d,y,!0)}_fireEvents(o,d,y){const w=Vl(this._eventsInProgress),T=Vl(o),A={};for(const V in o){const{originalEvent:j}=o[V];this._eventsInProgress[V]||(A[`${V}start`]=j),this._eventsInProgress[V]=o[V]}!w&&T&&this._fireEvent("movestart",T.originalEvent);for(const V in A)this._fireEvent(V,A[V]);T&&this._fireEvent("move",T.originalEvent);for(const V in o){const{originalEvent:j}=o[V];this._fireEvent(V,j)}const I={};let O;for(const V in this._eventsInProgress){const{handlerName:j,originalEvent:ee}=this._eventsInProgress[V];this._handlersById[j].isActive()||(delete this._eventsInProgress[V],O=d[j]||ee,I[`${V}end`]=O)}for(const V in I)this._fireEvent(V,I[V]);const U=Vl(this._eventsInProgress);if(y&&(w||T)&&!U){this._updatingCamera=!0;const V=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),j=ee=>ee!==0&&-this._bearingSnap<ee&&ee<this._bearingSnap;V?(j(V.bearing||this._map.getBearing())&&(V.bearing=0),this._map.easeTo(V,{originalEvent:O})):(this._map.fire(new r.Event("moveend",{originalEvent:O})),j(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(o,d){this._map.fire(new r.Event(o,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{this._frameId=void 0,this.handleEvent(new np("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const zu="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ip extends r.Evented{constructor(o,d){super(),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=d.bearingSnap,r.bindAll(["_renderFrameCallback"],this)}getCenter(){return new r.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(o,d){return this.jumpTo({center:o},d)}panBy(o,d,y){return o=r.pointGeometry.convert(o).mult(-1),this.panTo(this.transform.center,r.extend({offset:o},d),y)}panTo(o,d,y){return this.easeTo(r.extend({center:o},d),y)}getZoom(){return this.transform.zoom}setZoom(o,d){return this.jumpTo({zoom:o},d),this}zoomTo(o,d,y){return this.easeTo(r.extend({zoom:o},d),y)}zoomIn(o,d){return this.zoomTo(this.getZoom()+1,o,d),this}zoomOut(o,d){return this.zoomTo(this.getZoom()-1,o,d),this}getBearing(){return this.transform.bearing}setBearing(o,d){return this.jumpTo({bearing:o},d),this}getPadding(){return this.transform.padding}setPadding(o,d){return this.jumpTo({padding:o},d),this}rotateTo(o,d,y){return this.easeTo(r.extend({bearing:o},d),y)}resetNorth(o,d){return this.rotateTo(0,r.extend({duration:1e3},o),d),this}resetNorthPitch(o,d){return this.easeTo(r.extend({bearing:0,pitch:0,duration:1e3},o),d),this}snapToNorth(o,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,d):this}getPitch(){return this.transform.pitch}setPitch(o,d){return this.jumpTo({pitch:o},d),this}cameraForBounds(o,d){o=r.LngLatBounds.convert(o);const y=d&&d.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),y,d)}_extendCameraOptions(o){const d={top:0,bottom:0,right:0,left:0};if(typeof(o=r.extend({padding:d,offset:[0,0],maxZoom:this.transform.maxZoom},o)).padding=="number"){const y=o.padding;o.padding={top:y,bottom:y,right:y,left:y}}return o.padding=r.extend(d,o.padding),o}_cameraForBoxAndBearing(o,d,y,w){const T=this._extendCameraOptions(w),A=this.transform,I=A.padding,O=A.project(r.LngLat.convert(o)),U=A.project(r.LngLat.convert(d)),V=new r.pointGeometry(O.x,U.y),j=new r.pointGeometry(U.x,O.y),ee=-r.degToRad(y),ce=O.rotate(ee),ae=U.rotate(ee),J=V.rotate(ee),Pe=j.rotate(ee),_e=new r.pointGeometry(Math.max(ce.x,ae.x,J.x,Pe.x),Math.max(ce.y,ae.y,J.y,Pe.y)),Ae=new r.pointGeometry(Math.min(ce.x,ae.x,J.x,Pe.x),Math.min(ce.y,ae.y,J.y,Pe.y)),De=_e.sub(Ae),ke=(A.width-((I.left||0)+(I.right||0)+T.padding.left+T.padding.right))/De.x,Te=(A.height-((I.top||0)+(I.bottom||0)+T.padding.top+T.padding.bottom))/De.y;if(Te<0||ke<0)return void r.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Ne=Math.min(A.scaleZoom(A.scale*Math.min(ke,Te)),T.maxZoom),tt=typeof T.offset.x=="number"&&typeof T.offset.y=="number"?new r.pointGeometry(T.offset.x,T.offset.y):r.pointGeometry.convert(T.offset),at=new r.pointGeometry((T.padding.left-T.padding.right)/2,(T.padding.top-T.padding.bottom)/2).rotate(y*Math.PI/180),pt=tt.add(at).mult(A.scale/A.zoomScale(Ne));return{center:A.unproject(O.add(U).div(2).sub(pt)),zoom:Ne,bearing:y}}_cameraForBox(o,d,y,w,T){const A=this._extendCameraOptions(T);y=y||0,w=w||0,o=r.LngLat.convert(o),d=r.LngLat.convert(d);const I=this.transform.clone();I.padding=A.padding;const O=this.getFreeCameraOptions(),U=new r.LngLat(.5*(o.lng+d.lng),.5*(o.lat+d.lat)),V=.5*(y+w);if(I._camera.position[2]<r.mercatorZfromAltitude(V,U.lat))return void r.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");O.lookAtPoint(U),I.setFreeCameraOptions(O);const j=r.MercatorCoordinate.fromLngLat(o),ee=r.MercatorCoordinate.fromLngLat(d),ce=I.pointRayIntersection(I.centerPoint,V),ae=[(J=I.rayIntersectionCoordinate(ce)).x,J.y,J.z];var J;const Pe=I.screenPointToMercatorRay(I.centerPoint),_e=I.projection.name!=="globe";let Ae,De=0;do{const ke=Math.floor(I.zoom),Te=1<<ke,Ne=Math.min(Te*j.x,Te*ee.x),tt=Math.min(Te*j.y,Te*ee.y),at=Math.max(Te*j.x,Te*ee.x),pt=Math.max(Te*j.y,Te*ee.y),ht=new r.Aabb([Ne,tt,y],[at,pt,w]),zt=r.Frustum.fromInvProjectionMatrix(I.invProjMatrix,I.worldSize,ke,_e);if(ht.intersects(zt)!==2){Ae&&(I._camera.position=r.scaleAndAdd([],I._camera.position,Pe.dir,-Ae),I._updateStateFromCamera());break}const nt=r.sub([],I._camera.position,ae);Ae=.5*r.length(nt),I._camera.position=r.scaleAndAdd([],I._camera.position,Pe.dir,Ae);try{I._updateStateFromCamera()}catch(kt){return void r.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++De<10);return{center:I.center,zoom:I.zoom,bearing:I.bearing,pitch:I.pitch}}fitBounds(o,d,y){return this._fitInternal(this.cameraForBounds(o,d),d,y)}_raycastElevationBox(o,d){const y=this.transform.elevation;if(!y)return;const w=new r.pointGeometry(o.x,d.y),T=new r.pointGeometry(d.x,o.y),A=y.pointCoordinate(o);if(!A)return;const I=y.pointCoordinate(d);if(!I)return;const O=y.pointCoordinate(w);if(!O)return;const U=y.pointCoordinate(T);if(!U)return;const V=new r.MercatorCoordinate(A[0],A[1]).toLngLat(),j=new r.MercatorCoordinate(I[0],I[1]).toLngLat(),ee=new r.MercatorCoordinate(O[0],O[1]).toLngLat(),ce=new r.MercatorCoordinate(U[0],U[1]).toLngLat(),ae=Math.min(V.lng,Math.min(j.lng,Math.min(ee.lng,ce.lng))),J=Math.min(V.lat,Math.min(j.lat,Math.min(ee.lat,ce.lat))),Pe=Math.max(V.lng,Math.max(j.lng,Math.max(ee.lng,ce.lng))),_e=Math.max(V.lat,Math.max(j.lat,Math.max(ee.lat,ce.lat))),Ae=Math.min(A[3],Math.min(I[3],Math.min(O[3],U[3]))),De=Math.max(A[3],Math.max(I[3],Math.max(O[3],U[3])));return{minLngLat:new r.LngLat(ae,J),maxLngLat:new r.LngLat(Pe,_e),minAltitude:Ae,maxAltitude:De}}fitScreenCoordinates(o,d,y,w,T){let A,I,O,U;const V=r.pointGeometry.convert(o),j=r.pointGeometry.convert(d),ee=this._raycastElevationBox(V,j);if(ee)A=ee.minLngLat,I=ee.maxLngLat,O=ee.minAltitude,U=ee.maxAltitude;else{if(this.transform.anyCornerOffEdge(V,j))return this;A=this.transform.pointLocation(V),I=this.transform.pointLocation(j)}return this._fitInternal(this.transform.pitch===0?this._cameraForBoxAndBearing(this.transform.pointLocation(r.pointGeometry.convert(o)),this.transform.pointLocation(r.pointGeometry.convert(d)),y,w):this._cameraForBox(A,I,O,U,w),w,T)}_fitInternal(o,d,y){return o?(delete(d=r.extend(o,d)).padding,d.linear?this.easeTo(d,y):this.flyTo(d,y)):this}jumpTo(o,d){this.stop();const y=o.preloadOnly?this.transform.clone():this.transform;let w=!1,T=!1,A=!1;return"zoom"in o&&y.zoom!==+o.zoom&&(w=!0,y.zoom=+o.zoom),o.center!==void 0&&(y.center=r.LngLat.convert(o.center)),"bearing"in o&&y.bearing!==+o.bearing&&(T=!0,y.bearing=+o.bearing),"pitch"in o&&y.pitch!==+o.pitch&&(A=!0,y.pitch=+o.pitch),o.padding==null||y.isPaddingEqual(o.padding)||(y.padding=o.padding),o.preloadOnly?(this._preloadTiles(y),this):(this.fire(new r.Event("movestart",d)).fire(new r.Event("move",d)),w&&this.fire(new r.Event("zoomstart",d)).fire(new r.Event("zoom",d)).fire(new r.Event("zoomend",d)),T&&this.fire(new r.Event("rotatestart",d)).fire(new r.Event("rotate",d)).fire(new r.Event("rotateend",d)),A&&this.fire(new r.Event("pitchstart",d)).fire(new r.Event("pitch",d)).fire(new r.Event("pitchend",d)),this.fire(new r.Event("moveend",d)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||r.warnOnce(zu),this.transform.getFreeCameraOptions()}setFreeCameraOptions(o,d){const y=this.transform;if(!y.projection.supportsFreeCamera)return r.warnOnce(zu),this;this.stop();const w=y.zoom,T=y.pitch,A=y.bearing;y.setFreeCameraOptions(o);const I=w!==y.zoom,O=T!==y.pitch,U=A!==y.bearing;return this.fire(new r.Event("movestart",d)).fire(new r.Event("move",d)),I&&this.fire(new r.Event("zoomstart",d)).fire(new r.Event("zoom",d)).fire(new r.Event("zoomend",d)),U&&this.fire(new r.Event("rotatestart",d)).fire(new r.Event("rotate",d)).fire(new r.Event("rotateend",d)),O&&this.fire(new r.Event("pitchstart",d)).fire(new r.Event("pitch",d)).fire(new r.Event("pitchend",d)),this.fire(new r.Event("moveend",d)),this}easeTo(o,d){this._stop(!1,o.easeId),((o=r.extend({offset:[0,0],duration:500,easing:r.ease},o)).animate===!1||!o.essential&&r.exported.prefersReducedMotion)&&(o.duration=0);const y=this.transform,w=this.getZoom(),T=this.getBearing(),A=this.getPitch(),I=this.getPadding(),O="zoom"in o?+o.zoom:w,U="bearing"in o?this._normalizeBearing(o.bearing,T):T,V="pitch"in o?+o.pitch:A,j="padding"in o?o.padding:y.padding,ee=r.pointGeometry.convert(o.offset);let ce,ae,J;if(y.projection.name==="globe"){const pt=r.MercatorCoordinate.fromLngLat(y.center),ht=ee.rotate(-y.angle);pt.x+=ht.x/y.worldSize,pt.y+=ht.y/y.worldSize;const zt=pt.toLngLat(),nt=r.LngLat.convert(o.center||zt);this._normalizeCenter(nt),ce=y.centerPoint.add(ht),ae=new r.pointGeometry(pt.x,pt.y).mult(y.worldSize),J=new r.pointGeometry(r.mercatorXfromLng(nt.lng),r.mercatorYfromLat(nt.lat)).mult(y.worldSize).sub(ae)}else{ce=y.centerPoint.add(ee);const pt=y.pointLocation(ce),ht=r.LngLat.convert(o.center||pt);this._normalizeCenter(ht),ae=y.project(pt),J=y.project(ht).sub(ae)}const Pe=y.zoomScale(O-w);let _e,Ae;o.around&&(_e=r.LngLat.convert(o.around),Ae=y.locationPoint(_e));const De=this._zooming||O!==w,ke=this._rotating||T!==U,Te=this._pitching||V!==A,Ne=!y.isPaddingEqual(j),tt=pt=>ht=>{if(De&&(pt.zoom=r.number(w,O,ht)),ke&&(pt.bearing=r.number(T,U,ht)),Te&&(pt.pitch=r.number(A,V,ht)),Ne&&(pt.interpolatePadding(I,j,ht),ce=pt.centerPoint.add(ee)),_e)pt.setLocationAtPoint(_e,Ae);else{const zt=pt.zoomScale(pt.zoom-w),nt=O>w?Math.min(2,Pe):Math.max(.5,Pe),kt=Math.pow(nt,1-ht),Pt=pt.unproject(ae.add(J.mult(ht*kt)).mult(zt));pt.setLocationAtPoint(pt.renderWorldCopies?Pt.wrap():Pt,ce)}return o.preloadOnly||this._fireMoveEvents(d),pt};if(o.preloadOnly){const pt=this._emulate(tt,o.duration,y);return this._preloadTiles(pt),this}const at={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=De,this._rotating=ke,this._pitching=Te,this._padding=Ne,this._easeId=o.easeId,this._prepareEase(d,o.noMoveStart,at),this._ease(tt(y),pt=>{y.recenterOnTerrain(),this._afterEase(d,pt)},o),this}_prepareEase(o,d,y={}){this._moving=!0,this.transform.cameraElevationReference="sea",d||y.moving||this.fire(new r.Event("movestart",o)),this._zooming&&!y.zooming&&this.fire(new r.Event("zoomstart",o)),this._rotating&&!y.rotating&&this.fire(new r.Event("rotatestart",o)),this._pitching&&!y.pitching&&this.fire(new r.Event("pitchstart",o))}_fireMoveEvents(o){this.fire(new r.Event("move",o)),this._zooming&&this.fire(new r.Event("zoom",o)),this._rotating&&this.fire(new r.Event("rotate",o)),this._pitching&&this.fire(new r.Event("pitch",o))}_afterEase(o,d){if(this._easeId&&d&&this._easeId===d)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const y=this._zooming,w=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new r.Event("zoomend",o)),w&&this.fire(new r.Event("rotateend",o)),T&&this.fire(new r.Event("pitchend",o)),this.fire(new r.Event("moveend",o))}flyTo(o,d){if(!o.essential&&r.exported.prefersReducedMotion){const Xt=r.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Xt,d)}this.stop(),o=r.extend({offset:[0,0],speed:1.2,curve:1.42,easing:r.ease},o);const y=this.transform,w=this.getZoom(),T=this.getBearing(),A=this.getPitch(),I=this.getPadding(),O="zoom"in o?r.clamp(+o.zoom,y.minZoom,y.maxZoom):w,U="bearing"in o?this._normalizeBearing(o.bearing,T):T,V="pitch"in o?+o.pitch:A,j="padding"in o?o.padding:y.padding,ee=y.zoomScale(O-w),ce=r.pointGeometry.convert(o.offset);let ae=y.centerPoint.add(ce);const J=y.pointLocation(ae),Pe=r.LngLat.convert(o.center||J);this._normalizeCenter(Pe);const _e=y.project(J),Ae=y.project(Pe).sub(_e);let De=o.curve;const ke=Math.max(y.width,y.height),Te=ke/ee,Ne=Ae.mag();if("minZoom"in o){const Xt=r.clamp(Math.min(o.minZoom,w,O),y.minZoom,y.maxZoom),Yt=ke/y.zoomScale(Xt-w);De=Math.sqrt(Yt/Ne*2)}const tt=De*De;function at(Xt){const Yt=(Te*Te-ke*ke+(Xt?-1:1)*tt*tt*Ne*Ne)/(2*(Xt?Te:ke)*tt*Ne);return Math.log(Math.sqrt(Yt*Yt+1)-Yt)}function pt(Xt){return(Math.exp(Xt)-Math.exp(-Xt))/2}function ht(Xt){return(Math.exp(Xt)+Math.exp(-Xt))/2}const zt=at(0);let nt=function(Xt){return ht(zt)/ht(zt+De*Xt)},kt=function(Xt){return ke*((ht(zt)*(pt(Yt=zt+De*Xt)/ht(Yt))-pt(zt))/tt)/Ne;var Yt},Pt=(at(1)-zt)/De;if(Math.abs(Ne)<1e-6||!isFinite(Pt)){if(Math.abs(ke-Te)<1e-6)return this.easeTo(o,d);const Xt=Te<ke?-1:1;Pt=Math.abs(Math.log(Te/ke))/De,kt=function(){return 0},nt=function(Yt){return Math.exp(Xt*De*Yt)}}o.duration="duration"in o?+o.duration:1e3*Pt/("screenSpeed"in o?+o.screenSpeed/De:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0);const Kt=T!==U,ft=V!==A,qt=!y.isPaddingEqual(j),gn=Xt=>Yt=>{const xn=Yt*Pt,kn=1/nt(xn);Xt.zoom=Yt===1?O:w+Xt.scaleZoom(kn),Kt&&(Xt.bearing=r.number(T,U,Yt)),ft&&(Xt.pitch=r.number(A,V,Yt)),qt&&(Xt.interpolatePadding(I,j,Yt),ae=Xt.centerPoint.add(ce));const dn=Yt===1?Pe:Xt.unproject(_e.add(Ae.mult(kt(xn))).mult(kn));return Xt.setLocationAtPoint(Xt.renderWorldCopies?dn.wrap():dn,ae),Xt._updateCameraOnTerrain(),o.preloadOnly||this._fireMoveEvents(d),Xt};if(o.preloadOnly){const Xt=this._emulate(gn,o.duration,y);return this._preloadTiles(Xt),this}return this._zooming=!0,this._rotating=Kt,this._pitching=ft,this._padding=qt,this._prepareEase(d,!1),this._ease(gn(y),()=>this._afterEase(d),o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const y=this._onEaseEnd;this._onEaseEnd=void 0,y.call(this,d)}if(!o){const y=this.handlers;y&&y.stop(!1)}return this}_ease(o,d,y){y.animate===!1||y.duration===0?(o(1),d()):(this._easeStart=r.exported.now(),this._easeOptions=y,this._onEaseFrame=o,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const o=Math.min((r.exported.now()-this._easeStart)/this._easeOptions.duration,1),d=this._onEaseFrame;d&&d(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(o,d){o=r.wrap(o,-180,180);const y=Math.abs(o-d);return Math.abs(o-360-d)<y&&(o-=360),Math.abs(o+360-d)<y&&(o+=360),o}_normalizeCenter(o){const d=this.transform;if(!d.renderWorldCopies||d.maxBounds)return;const y=o.lng-d.center.lng;o.lng+=y>180?-360:y<-180?360:0}_emulate(o,d,y){const w=Math.ceil(15*d/1e3),T=[],A=o(y.clone());for(let I=0;I<=w;I++){const O=A(I/w);T.push(O.clone())}return T}}class ku{constructor(o={}){this.options=o,r.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(o){const d=this.options&&this.options.compact;return this._map=o,this._container=D("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=D("button","mapboxgl-ctrl-attrib-button",this._container),D("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=D("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),d&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),d===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(o,d){const y=this._map._getUIString(`AttributionControl.${d}`);o.setAttribute("aria-label",y),o.removeAttribute("title"),o.firstElementChild&&o.firstElementChild.setAttribute("title",y)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let o=this._editLink;o||(o=this._editLink=this._container.querySelector(".mapbox-improve-map"));const d=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||r.config.ACCESS_TOKEN}];if(o){const y=d.reduce((w,T,A)=>(T.value&&(w+=`${T.key}=${T.value}${A<d.length-1?"&":""}`),w),"?");o.href=`${r.config.FEEDBACK_URL}/${y}${this._map._hash?this._map._hash.getHashString(!0):""}`,o.rel="noopener nofollow",this._setElementTitle(o,"MapFeedback")}}_updateData(o){!o||o.sourceDataType!=="metadata"&&o.sourceDataType!=="visibility"&&o.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let o=[];if(this._map.style.stylesheet){const w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}const d=this._map.style._sourceCaches;for(const w in d){const T=d[w];if(T.used){const A=T.getSource();A.attribution&&o.indexOf(A.attribution)<0&&o.push(A.attribution)}}o.sort((w,T)=>w.length-T.length),o=o.filter((w,T)=>{for(let A=T+1;A<o.length;A++)if(o[A].indexOf(w)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=[...this.options.customAttribution,...o]:o.unshift(this.options.customAttribution));const y=o.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,o.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Y_{constructor(){r.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(o){this._map=o,this._container=D("div","mapboxgl-ctrl");const d=D("a","mapboxgl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://www.mapbox.com/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(o){o&&o.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const o=this._map.style._sourceCaches;if(Object.entries(o).length===0)return!0;for(const d in o){const y=o[d].getSource();if(y.hasOwnProperty("mapbox_logo")&&!y.mapbox_logo)return!1}return!0}_updateCompact(){const o=this._container.children;if(o.length){const d=o[0];this._map.getCanvasContainer().offsetWidth<250?d.classList.add("mapboxgl-compact"):d.classList.remove("mapboxgl-compact")}}}class cg{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const d=++this._id;return this._queue.push({callback:o,id:d,cancelled:!1}),d}remove(o){const d=this._currentlyRunning,y=d?this._queue.concat(d):this._queue;for(const w of y)if(w.id===o)return void(w.cancelled=!0)}run(o=0){const d=this._currentlyRunning=this._queue;this._queue=[];for(const y of d)if(!y.cancelled&&(y.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Bu(m,o,d){if(m=new r.LngLat(m.lng,m.lat),o){const y=new r.LngLat(m.lng-360,m.lat),w=new r.LngLat(m.lng+360,m.lat),T=360*Math.ceil(Math.abs(m.lng-d.center.lng)/360),A=d.locationPoint(m).distSqr(o),I=o.x<0||o.y<0||o.x>d.width||o.y>d.height;d.locationPoint(y).distSqr(o)<A&&(I||Math.abs(y.lng-d.center.lng)<T)?m=y:d.locationPoint(w).distSqr(o)<A&&(I||Math.abs(w.lng-d.center.lng)<T)&&(m=w)}for(;Math.abs(m.lng-d.center.lng)>180;){const y=d.locationPoint(m);if(y.x>=0&&y.y>=0&&y.x<=d.width&&y.y<=d.height)break;m.lng>d.center.lng?m.lng-=360:m.lng+=360}return m}const Fu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ou extends r.Evented{constructor(o,d){if(super(),(o instanceof r.window.HTMLElement||d)&&(o=r.extend({element:o},d)),r.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),o&&o.element)this._element=o.element,this._offset=r.pointGeometry.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=D("div");const w=41,T=27,A=L("svg",{display:"block",height:w*this._scale+"px",width:T*this._scale+"px",viewBox:`0 0 ${T} ${w}`},this._element),I=L("radialGradient",{id:"shadowGradient"},L("defs",{},A));L("stop",{offset:"10%","stop-opacity":.4},I),L("stop",{offset:"100%","stop-opacity":.05},I),L("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},A),L("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},A),L("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},A),L("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},A),this._offset=r.pointGeometry.convert(o&&o.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",w=>{w.preventDefault()}),this._element.addEventListener("mousedown",w=>{w.preventDefault()});const y=this._element.classList;for(const w in Fu)y.remove(`mapboxgl-marker-anchor-${w}`);y.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(o){return o===this._map||(this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._updateMoving),o.on("moveend",this._update),o.on("remove",this._clearFadeTimer),o._addMarker(this),this.setDraggable(this._draggable),this._update(),o.on("click",this._onMapClick)),this}remove(){const o=this._map;return o&&(o.off("click",this._onMapClick),o.off("move",this._updateMoving),o.off("moveend",this._update),o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler),o.off("mouseup",this._onUp),o.off("touchend",this._onUp),o.off("mousemove",this._onMove),o.off("touchmove",this._onMove),o.off("remove",this._clearFadeTimer),o._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=r.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const w=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[w,-1*(24.6+w)],"bottom-right":[-w,-1*(24.6+w)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(o){const d=o.code,y=o.charCode||o.keyCode;d!=="Space"&&d!=="Enter"&&y!==32&&y!==13||this.togglePopup()}_onMapClick(o){const d=o.originalEvent.target,y=this._element;this._popup&&(d===y||y.contains(d))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const o=this._popup;return o?(o.isOpen()?(o.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(o.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const o=this._map;if(!o)return;const d=this._pos;if(!d||d.x<0||d.x>o.transform.width||d.y<0||d.y>o.transform.height)return void this._clearFadeTimer();const y=o.unproject(d);let w=!1;if(o.transform._terrainEnabled()&&o.getTerrain()){const A=o.getFreeCameraOptions();if(A.position){const I=A.position.toLngLat();w=I.distanceTo(y)<.9*I.distanceTo(this._lngLat)}}const T=(1-o._queryFogOpacity(y))*(w?.2:1);this._element.style.opacity=`${T}`,this._popup&&this._popup._setOpacity(`${T}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const o=this._pos;if(!o)return;const d=this._offset.mult(this._scale),y=this._calculatePitch(),w=this._calculateRotation();this._element.style.transform=`
            translate(${o.x}px, ${o.y}px) ${Fu[this._anchor]}
            rotateX(${y}deg) rotateZ(${w}deg)
            translate(${d.x}px, ${d.y}px)
        `}_calculatePitch(){return this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?0:this._map&&this._pitchAlignment==="map"?this._map.getPitch():0}_calculateRotation(){return this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?this._rotation:this._map&&this._rotationAlignment==="map"?this._rotation-this._map.getBearing():0}_update(o){r.window.cancelAnimationFrame(this._updateFrameId);const d=this._map;d&&(d.transform.renderWorldCopies&&(this._lngLat=Bu(this._lngLat,this._pos,d.transform)),this._pos=d.project(this._lngLat),o===!0?this._updateFrameId=r.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),d._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!d.getTerrain()&&!d.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(o){return this._offset=r.pointGeometry.convert(o),this._update(),this}_onMove(o){const d=this._map;if(d){if(!this._isDragging){const y=this._clickTolerance||d._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=y}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=d.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new r.Event("dragstart"))),this.fire(new r.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const o=this._map;o&&(o.off("mousemove",this._onMove),o.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new r.Event("dragend")),this._state="inactive"}_addDragHandler(o){const d=this._map;d&&this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos),this._pointerdownPos=o.point,this._state="pending",d.on("mousemove",this._onMove),d.on("touchmove",this._onMove),d.once("mouseup",this._onUp),d.once("touchend",this._onUp))}setDraggable(o){this._draggable=!!o;const d=this._map;return d&&(o?(d.on("mousedown",this._addDragHandler),d.on("touchstart",this._addDragHandler)):(d.off("mousedown",this._addDragHandler),d.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class J_{constructor(o){this.jumpTo(o)}getValue(o){if(o<=this._startTime)return this._start;if(o>=this._endTime)return this._end;const d=r.easeCubicInOut((o-this._startTime)/(this._endTime-this._startTime));return this._start*(1-d)+this._end*d}isEasing(o){return o>=this._startTime&&o<=this._endTime}jumpTo(o){this._startTime=-1/0,this._endTime=-1/0,this._start=o,this._end=o}easeTo(o,d,y){this._start=this.getValue(d),this._end=o,this._startTime=d,this._endTime=d+y}}const K_={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},rp={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Gl(m){m.parentNode&&m.parentNode.removeChild(m)}const op={showCompass:!0,showZoom:!0,visualizePitch:!1};class ap{constructor(o,d,y=!1){this._clickTolerance=10,this.element=d,this.mouseRotate=new Ls({clickTolerance:o.dragRotate._mouseRotate._clickTolerance}),this.map=o,y&&(this.mousePitch=new Jd({clickTolerance:o.dragRotate._mousePitch._clickTolerance})),r.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),d.addEventListener("mousedown",this.mousedown),d.addEventListener("touchstart",this.touchstart,{passive:!1}),d.addEventListener("touchmove",this.touchmove),d.addEventListener("touchend",this.touchend),d.addEventListener("touchcancel",this.reset)}down(o,d){this.mouseRotate.mousedown(o,d),this.mousePitch&&this.mousePitch.mousedown(o,d),G()}move(o,d){const y=this.map,w=this.mouseRotate.mousemoveWindow(o,d),T=w&&w.bearingDelta;if(T&&y.setBearing(y.getBearing()+T),this.mousePitch){const A=this.mousePitch.mousemoveWindow(o,d),I=A&&A.pitchDelta;I&&y.setPitch(y.getPitch()+I)}}off(){const o=this.element;o.removeEventListener("mousedown",this.mousedown),o.removeEventListener("touchstart",this.touchstart,{passive:!1}),o.removeEventListener("touchmove",this.touchmove),o.removeEventListener("touchend",this.touchend),o.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){X(),r.window.removeEventListener("mousemove",this.mousemove),r.window.removeEventListener("mouseup",this.mouseup)}mousedown(o){this.down(r.extend({},o,{ctrlKey:!0,preventDefault:()=>o.preventDefault()}),$(this.element,o)),r.window.addEventListener("mousemove",this.mousemove),r.window.addEventListener("mouseup",this.mouseup)}mousemove(o){this.move(o,$(this.element,o))}mouseup(o){this.mouseRotate.mouseupWindow(o),this.mousePitch&&this.mousePitch.mouseupWindow(o),this.offTemp()}touchstart(o){o.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=te(this.element,o.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>o.preventDefault()},this._startPos))}touchmove(o){o.targetTouches.length!==1?this.reset():(this._lastPos=te(this.element,o.targetTouches)[0],this.move({preventDefault:()=>o.preventDefault()},this._lastPos))}touchend(o){o.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const yr={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let Ir,Hl=0,Wa=!1;const sp={maxWidth:100,unit:"metric"};function Nu(m,o,d){const y=d&&d.maxWidth||100,w=m._containerHeight/2,T=m._containerWidth/2-y/2,A=m.unproject([T,w]),I=m.unproject([T+y,w]),O=A.distanceTo(I);if(d&&d.unit==="imperial"){const U=3.2808*O;U>5280?Rs(o,y,U/5280,m._getUIString("ScaleControl.Miles"),m):Rs(o,y,U,m._getUIString("ScaleControl.Feet"),m)}else d&&d.unit==="nautical"?Rs(o,y,O/1852,m._getUIString("ScaleControl.NauticalMiles"),m):O>=1e3?Rs(o,y,O/1e3,m._getUIString("ScaleControl.Kilometers"),m):Rs(o,y,O,m._getUIString("ScaleControl.Meters"),m)}function Rs(m,o,d,y,w){const T=function(I){const O=Math.pow(10,`${Math.floor(I)}`.length-1);let U=I/O;return U=U>=10?10:U>=5?5:U>=3?3:U>=2?2:U>=1?1:function(V){const j=Math.pow(10,Math.ceil(-Math.log(V)/Math.LN10));return Math.round(V*j)/j}(U),O*U}(d),A=T/d;w._requestDomTask(()=>{m.style.width=o*A+"px",m.innerHTML=`${T}&nbsp;${y}`})}const $r={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ci=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Wl(m=new r.pointGeometry(0,0),o="bottom"){if(typeof m=="number"){const d=Math.round(Math.sqrt(.5*Math.pow(m,2)));switch(o){case"top":return new r.pointGeometry(0,m);case"top-left":return new r.pointGeometry(d,d);case"top-right":return new r.pointGeometry(-d,d);case"bottom":return new r.pointGeometry(0,-m);case"bottom-left":return new r.pointGeometry(d,-d);case"bottom-right":return new r.pointGeometry(-d,-d);case"left":return new r.pointGeometry(m,0);case"right":return new r.pointGeometry(-m,0)}return new r.pointGeometry(0,0)}return m instanceof r.pointGeometry||Array.isArray(m)?r.pointGeometry.convert(m):r.pointGeometry.convert(m[o]||[0,0])}const zs={version:r.version,supported:v,setRTLTextPlugin:r.setRTLTextPlugin,getRTLTextPluginStatus:r.getRTLTextPluginStatus,Map:class extends ip{constructor(m){if((m=r.extend({},rp,m)).minZoom!=null&&m.maxZoom!=null&&m.minZoom>m.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(m.minPitch!=null&&m.maxPitch!=null&&m.minPitch>m.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(m.minPitch!=null&&m.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(m.maxPitch!=null&&m.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(m.antialias&&r.isSafariWithAntialiasingBug(r.window)&&(m.antialias=!1,r.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Du(m.minZoom,m.maxZoom,m.minPitch,m.maxPitch,m.renderWorldCopies),m),this._interactive=m.interactive,this._minTileCacheSize=m.minTileCacheSize,this._maxTileCacheSize=m.maxTileCacheSize,this._failIfMajorPerformanceCaveat=m.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=m.preserveDrawingBuffer,this._antialias=m.antialias,this._trackResize=m.trackResize,this._bearingSnap=m.bearingSnap,this._refreshExpiredTiles=m.refreshExpiredTiles,this._fadeDuration=m.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=m.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=m.collectResourceTiming,this._optimizeForTerrain=m.optimizeForTerrain,this._renderTaskQueue=new cg,this._domRenderTaskQueue=new cg,this._controls=[],this._markers=[],this._mapId=r.uniqueId(),this._locale=r.extend({},K_,m.locale),this._clickTolerance=m.clickTolerance,this._cooperativeGestures=m.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new J_(0),this._explicitProjection=null,this._requestManager=new r.RequestManager(m.transformRequest,m.accessToken,m.testMode),this._silenceAuthErrors=!!m.testMode,typeof m.container=="string"){if(this._container=r.window.document.getElementById(m.container),!this._container)throw new Error(`Container '${m.container}' not found.`)}else{if(!(m.container instanceof r.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=m.container}if(this._container.childNodes.length>0&&r.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),m.maxBounds&&this.setMaxBounds(m.maxBounds),r.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),r.window!==void 0&&(r.window.addEventListener("online",this._onWindowOnline,!1),r.window.addEventListener("resize",this._onWindowResize,!1),r.window.addEventListener("orientationchange",this._onWindowResize,!1),r.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new lg(this,m),this._localFontFamily=m.localFontFamily,this._localIdeographFontFamily=m.localIdeographFontFamily,m.style&&this.setStyle(m.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),m.projection&&this.setProjection(m.projection),this._hash=m.hash&&new Gm(typeof m.hash=="string"&&m.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch}),m.bounds&&(this.resize(),this.fitBounds(m.bounds,r.extend({},m.fitBoundsOptions,{duration:0})))),this.resize(),m.attributionControl&&this.addControl(new ku({customAttribution:m.customAttribution})),this._logoControl=new Y_,this.addControl(this._logoControl,m.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new r.Event(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new r.Event(`${o.dataType}dataloading`,o))})}_getMapId(){return this._mapId}addControl(m,o){if(o===void 0&&(o=m.getDefaultPosition?m.getDefaultPosition():"top-right"),!m||!m.onAdd)return this.fire(new r.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=m.onAdd(this);this._controls.push(m);const y=this._controlPositions[o];return o.indexOf("bottom")!==-1?y.insertBefore(d,y.firstChild):y.appendChild(d),this}removeControl(m){if(!m||!m.onRemove)return this.fire(new r.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(m);return o>-1&&this._controls.splice(o,1),m.onRemove(this),this}hasControl(m){return this._controls.indexOf(m)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(m){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const o=!this._moving;return o&&this.fire(new r.Event("movestart",m)).fire(new r.Event("move",m)),this.fire(new r.Event("resize",m)),o&&this.fire(new r.Event("moveend",m)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(m){return this.transform.setMaxBounds(r.LngLatBounds.convert(m)),this._update()}setMinZoom(m){if((m=m==null?-2:m)>=-2&&m<=this.transform.maxZoom)return this.transform.minZoom=m,this._update(),this.getZoom()<m?this.setZoom(m):this.fire(new r.Event("zoomstart")).fire(new r.Event("zoom")).fire(new r.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(m){if((m=m==null?22:m)>=this.transform.minZoom)return this.transform.maxZoom=m,this._update(),this.getZoom()>m?this.setZoom(m):this.fire(new r.Event("zoomstart")).fire(new r.Event("zoom")).fire(new r.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(m){if((m=m==null?0:m)<0)throw new Error("minPitch must be greater than or equal to 0");if(m>=0&&m<=this.transform.maxPitch)return this.transform.minPitch=m,this._update(),this.getPitch()<m?this.setPitch(m):this.fire(new r.Event("pitchstart")).fire(new r.Event("pitch")).fire(new r.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(m){if((m=m==null?85:m)>85)throw new Error("maxPitch must be less than or equal to 85");if(m>=this.transform.minPitch)return this.transform.maxPitch=m,this._update(),this.getPitch()>m?this.setPitch(m):this.fire(new r.Event("pitchstart")).fire(new r.Event("pitch")).fire(new r.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(m){return this.transform.renderWorldCopies=m,this._update()}getProjection(){return this._explicitProjection?this._explicitProjection:this.style&&this.style.stylesheet&&this.style.stylesheet.projection?this.style.stylesheet.projection:{name:"mercator",center:[0,0]}}setProjection(m){return this._lazyInitEmptyStyle(),m?typeof m=="string"&&(m={name:m}):m=null,this._updateProjection(m)}_updateProjection(m){m===null&&(this._explicitProjection=null);const o=m||this.getProjection(),d=this.transform.setProjection(o);if(m&&(this._explicitProjection=this.transform.getProjection()),d){this.painter.clearBackgroundTiles();for(const y in this.style._sourceCaches)this.style._sourceCaches[y].clearTiles();this.style.applyProjectionUpdate(),this._update(!0)}return this}project(m){return this.transform.locationPoint3D(r.LngLat.convert(m))}unproject(m){return this.transform.pointLocation3D(r.pointGeometry.convert(m))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(m,o,d){if(m==="mouseenter"||m==="mouseover"){let y=!1;const w=A=>{const I=o.filter(U=>this.getLayer(U)),O=I.length?this.queryRenderedFeatures(A.point,{layers:I}):[];O.length?y||(y=!0,d.call(this,new Lr(m,this,A.originalEvent,{features:O}))):y=!1},T=()=>{y=!1};return{layers:new Set(o),listener:d,delegates:{mousemove:w,mouseout:T}}}if(m==="mouseleave"||m==="mouseout"){let y=!1;const w=A=>{const I=o.filter(O=>this.getLayer(O));(I.length?this.queryRenderedFeatures(A.point,{layers:I}):[]).length?y=!0:y&&(y=!1,d.call(this,new Lr(m,this,A.originalEvent)))},T=A=>{y&&(y=!1,d.call(this,new Lr(m,this,A.originalEvent)))};return{layers:new Set(o),listener:d,delegates:{mousemove:w,mouseout:T}}}{const y=w=>{const T=o.filter(I=>this.getLayer(I)),A=T.length?this.queryRenderedFeatures(w.point,{layers:T}):[];A.length&&(w.features=A,d.call(this,w),delete w.features)};return{layers:new Set(o),listener:d,delegates:{[m]:y}}}}on(m,o,d){if(d===void 0)return super.on(m,o);Array.isArray(o)||(o=[o]);const y=this._createDelegatedListener(m,o,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[m]=this._delegatedListeners[m]||[],this._delegatedListeners[m].push(y);for(const w in y.delegates)this.on(w,y.delegates[w]);return this}once(m,o,d){if(d===void 0)return super.once(m,o);Array.isArray(o)||(o=[o]);const y=this._createDelegatedListener(m,o,d);for(const w in y.delegates)this.once(w,y.delegates[w]);return this}off(m,o,d){if(d===void 0)return super.off(m,o);o=new Set(Array.isArray(o)?o:[o]);const y=(T,A)=>{if(T.size!==A.size)return!1;for(const I of T)if(!A.has(I))return!1;return!0},w=this._delegatedListeners?this._delegatedListeners[m]:void 0;return w&&(T=>{for(let A=0;A<T.length;A++){const I=T[A];if(I.listener===d&&y(I.layers,o)){for(const O in I.delegates)this.off(O,I.delegates[O]);return T.splice(A,1),this}}})(w),this}queryRenderedFeatures(m,o){return this.style?(o!==void 0||m===void 0||m instanceof r.pointGeometry||Array.isArray(m)||(o=m,m=void 0),this.style.queryRenderedFeatures(m=m||[[0,0],[this.transform.width,this.transform.height]],o=o||{},this.transform)):[]}querySourceFeatures(m,o){return this.style.querySourceFeatures(m,o)}queryTerrainElevation(m,o){const d=this.transform.elevation;return d?(o=r.extend({},{exaggerated:!0},o),d.getAtPoint(r.MercatorCoordinate.fromLngLat(m),null,o.exaggerated)):null}setStyle(m,o){return(o=r.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&o.localFontFamily===this._localFontFamily&&this.style&&m?(this._diffStyle(m,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._localFontFamily=o.localFontFamily,this._updateStyle(m,o))}_getUIString(m){const o=this._locale[m];if(o==null)throw new Error(`Missing UI string '${m}'`);return o}_updateStyle(m,o){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),m&&(this.style=new gr(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof m=="string"?this.style.loadURL(m):this.style.loadJSON(m)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new gr(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(m,o){if(typeof m=="string"){const d=this._requestManager.normalizeStyleURL(m),y=this._requestManager.transformRequest(d,r.ResourceType.Style);r.getJSON(y,(w,T)=>{w?this.fire(new r.ErrorEvent(w)):T&&this._updateDiff(T,o)})}else typeof m=="object"&&this._updateDiff(m,o)}_updateDiff(m,o){try{this.style.setState(m)&&this._update(!0)}catch(d){r.warnOnce(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(m,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(r.warnOnce("There is no style added to the map."),!1)}addSource(m,o){return this._lazyInitEmptyStyle(),this.style.addSource(m,o),this._update(!0)}isSourceLoaded(m){return!!this.style&&this.style._isSourceCacheLoaded(m)}areTilesLoaded(){const m=this.style&&this.style._sourceCaches;for(const o in m){const d=m[o]._tiles;for(const y in d){const w=d[y];if(w.state!=="loaded"&&w.state!=="errored")return!1}}return!0}addSourceType(m,o,d){this._lazyInitEmptyStyle(),this.style.addSourceType(m,o,d)}removeSource(m){return this.style.removeSource(m),this._updateTerrain(),this._update(!0)}getSource(m){return this.style.getSource(m)}addImage(m,o,{pixelRatio:d=1,sdf:y=!1,stretchX:w,stretchY:T,content:A}={}){if(this._lazyInitEmptyStyle(),o instanceof r.window.HTMLImageElement||r.window.ImageBitmap&&o instanceof r.window.ImageBitmap){const{width:I,height:O,data:U}=r.exported.getImageData(o);this.style.addImage(m,{data:new r.RGBAImage({width:I,height:O},U),pixelRatio:d,stretchX:w,stretchY:T,content:A,sdf:y,version:0})}else if(o.width===void 0||o.height===void 0)this.fire(new r.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:I,height:O}=o,U=o;this.style.addImage(m,{data:new r.RGBAImage({width:I,height:O},new Uint8Array(U.data)),pixelRatio:d,stretchX:w,stretchY:T,content:A,sdf:y,version:0,userImage:U}),U.onAdd&&U.onAdd(this,m)}}updateImage(m,o){const d=this.style.getImage(m);if(!d)return void this.fire(new r.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=o instanceof r.window.HTMLImageElement||r.window.ImageBitmap&&o instanceof r.window.ImageBitmap?r.exported.getImageData(o):o,{width:w,height:T}=y;w!==void 0&&T!==void 0?w===d.data.width&&T===d.data.height?(d.data.replace(y.data,!(o instanceof r.window.HTMLImageElement||r.window.ImageBitmap&&o instanceof r.window.ImageBitmap)),this.style.updateImage(m,d)):this.fire(new r.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):this.fire(new r.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(m){return m?!!this.style.getImage(m):(this.fire(new r.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(m){this.style.removeImage(m)}loadImage(m,o){r.getImage(this._requestManager.transformRequest(m,r.ResourceType.Image),(d,y)=>{o(d,y instanceof r.window.HTMLImageElement?r.exported.getImageData(y):y)})}listImages(){return this.style.listImages()}addLayer(m,o){return this._lazyInitEmptyStyle(),this.style.addLayer(m,o),this._update(!0)}moveLayer(m,o){return this.style.moveLayer(m,o),this._update(!0)}removeLayer(m){return this.style.removeLayer(m),this._update(!0)}getLayer(m){return this.style.getLayer(m)}setLayerZoomRange(m,o,d){return this.style.setLayerZoomRange(m,o,d),this._update(!0)}setFilter(m,o,d={}){return this.style.setFilter(m,o,d),this._update(!0)}getFilter(m){return this.style.getFilter(m)}setPaintProperty(m,o,d,y={}){return this.style.setPaintProperty(m,o,d,y),this._update(!0)}getPaintProperty(m,o){return this.style.getPaintProperty(m,o)}setLayoutProperty(m,o,d,y={}){return this.style.setLayoutProperty(m,o,d,y),this._update(!0)}getLayoutProperty(m,o){return this.style.getLayoutProperty(m,o)}setLight(m,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(m,o),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(m){return this._lazyInitEmptyStyle(),!m&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(m),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(m){return this._lazyInitEmptyStyle(),this.style.setFog(m),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(m){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(r.LngLat.convert(m),this.transform):0}setFeatureState(m,o){return this.style.setFeatureState(m,o),this._update()}removeFeatureState(m,o){return this.style.removeFeatureState(m,o),this._update()}getFeatureState(m){return this.style.getFeatureState(m)}_updateContainerDimensions(){if(!this._container)return;const m=this._container.getBoundingClientRect().width||400,o=this._container.getBoundingClientRect().height||300;let d,y,w,T=this._container;for(;T&&(!y||!w);){const A=r.window.getComputedStyle(T).transform;A&&A!=="none"&&(d=A.match(/matrix.*\((.+)\)/)[1].split(", "),d[0]&&d[0]!=="0"&&d[0]!=="1"&&(y=d[0]),d[3]&&d[3]!=="0"&&d[3]!=="1"&&(w=d[3])),T=T.parentElement}this._containerWidth=y?Math.abs(m/y):m,this._containerHeight=w?Math.abs(o/w):o}_detectMissingCSS(){r.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&r.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const m=this._container;m.classList.add("mapboxgl-map"),(this._missingCSSCanary=D("div","mapboxgl-canary",m)).style.visibility="hidden",this._detectMissingCSS();const o=this._canvasContainer=D("div","mapboxgl-canvas-container",m);this._interactive&&o.classList.add("mapboxgl-interactive"),this._canvas=D("canvas","mapboxgl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._canvas.setAttribute("id","mxcanvas"),console.log("mapbox use webgl2"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const d=this._controlContainer=D("div","mapboxgl-control-container",m),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{y[w]=D("div",`mapboxgl-ctrl-${w}`,d)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(m,o){const d=r.exported.devicePixelRatio||1;this._canvas.width=d*Math.ceil(m),this._canvas.height=d*Math.ceil(o),this._canvas.style.width=`${m}px`,this._canvas.style.height=`${o}px`}_addMarker(m){this._markers.push(m)}_removeMarker(m){const o=this._markers.indexOf(m);o!==-1&&this._markers.splice(o,1)}_setupPainter(){const m=r.extend({},v.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),o=this._canvas.getContext("webgl2",m)||this._canvas.getContext("experimental-webgl",m);o?(r.storeAuthState(o,!0),this.painter=new Um(o,this.transform),this.on("data",d=>{d.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),r.exported$1.testSupport(o)):this.fire(new r.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(m){m.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new r.Event("webglcontextlost",{originalEvent:m}))}_contextRestored(m){this._setupPainter(),this.resize(),this._update(),this.fire(new r.Event("webglcontextrestored",{originalEvent:m}))}_onMapScroll(m){if(m.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(m){return this.style?(this._styleDirty=this._styleDirty||m,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(m){return this._update(),this._renderTaskQueue.add(m)}_cancelRenderFrame(m){this._renderTaskQueue.remove(m)}_requestDomTask(m){!this.loaded()||this.loaded()&&!this.isMoving()?m():this._domRenderTaskQueue.add(m)}_render(m){let o;const d=this.painter.context.extTimerQuery,y=r.exported.now();if(this.listens("gpu-timing-frame")&&(o=d.createQueryEXT(),d.beginQueryEXT(d.TIME_ELAPSED_EXT,o)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(m),this._domRenderTaskQueue.run(m),this._removed)return;let w=!1;const T=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const O=this.transform.zoom,U=this.transform.pitch,V=r.exported.now();this.style.zoomHistory.update(O,V);const j=new r.EvaluationParameters(O,{now:V,fadeDuration:T,pitch:U,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ee=j.crossFadingFactor();ee===1&&ee===this._crossFadingFactor||(w=!0,this._crossFadingFactor=ee),this.style.update(j)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let A=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),A=this._updateAverageElevation(y),this.style._updateSources(this.transform),this._forceMarkerUpdate()):A=this._updateAverageElevation(y),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,T,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:T,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new r.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new r.Event("load"))),this.style&&(this.style.hasTransitions()||w)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const O=r.exported.now()-y;d.endQueryEXT(d.TIME_ELAPSED_EXT,o),setTimeout(()=>{const U=d.getQueryObjectEXT(o,d.QUERY_RESULT_EXT)/1e6;d.deleteQueryEXT(o),this.fire(new r.Event("gpu-timing-frame",{cpuTime:O,gpuTime:U}))},50)}if(this.listens("gpu-timing-layer")){const O=this.painter.collectGpuTimers();setTimeout(()=>{const U=this.painter.queryGpuTimers(O);this.fire(new r.Event("gpu-timing-layer",{layerTimes:U}))},50)}const I=this._sourcesDirty||this._styleDirty||this._placementDirty||A;if(I||this._repaint)this.triggerRepaint();else{const O=!this.isMoving()&&this.loaded();if(O&&(A=this._updateAverageElevation(y,!0)),A)this.triggerRepaint();else if(this._triggerFrame(!1),O&&(this.fire(new r.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const U=this._calculateSpeedIndex();this.fire(new r.Event("speedindexcompleted",{speedIndex:U})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||I||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const m of this._markers)m._update()}_updateAverageElevation(m,o=!1){const d=y=>(this.transform.averageElevation=y,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&d(0);if((o||m-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(m)){const y=this.transform.averageElevation;let w=this.transform.sampleAverageElevation(),T=!1;this.transform.elevation&&(T=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=m;const A=Math.abs(y-w);if(A>1){if(this._isInitialLoad||T)return this._averageElevation.jumpTo(w),d(w);this._averageElevation.easeTo(w,m,300)}else if(A>1e-4)return this._averageElevation.jumpTo(w),d(w)}return!!this._averageElevation.isEasing(m)&&d(this._averageElevation.getValue(m))}_authenticate(){r.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,m=>{}),r.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const m=this.painter.canvasCopy(),o=this.painter.getCanvasCopiesAndTimestamps();o.timeStamps.push(performance.now());const d=this.painter.context.gl,y=d.createFramebuffer();function w(T){d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,T,0);const A=new Uint8Array(d.drawingBufferWidth*d.drawingBufferHeight*4);return d.readPixels(0,0,d.drawingBufferWidth,d.drawingBufferHeight,d.RGBA,d.UNSIGNED_BYTE,A),A}return d.bindFramebuffer(d.FRAMEBUFFER,y),this._canvasPixelComparison(w(m),o.canvasCopies.map(w),o.timeStamps)}_canvasPixelComparison(m,o,d){let y=d[1]-d[0];const w=m.length/4;for(let T=0;T<o.length;T++){const A=o[T];let I=0;for(let O=0;O<A.length;O+=4)A[O]===m[O]&&A[O+1]===m[O+1]&&A[O+2]===m[O+2]&&A[O+3]===m[O+3]&&(I+=1);y+=(d[T+2]-d[T+1])*(1-I/w)}return y}remove(){this._hash&&this._hash.remove();for(const o of this._controls)o.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),r.window!==void 0&&(r.window.removeEventListener("resize",this._onWindowResize,!1),r.window.removeEventListener("orientationchange",this._onWindowResize,!1),r.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),r.window.removeEventListener("online",this._onWindowOnline,!1));const m=this.painter.context.gl.getExtension("WEBGL_lose_context");m&&m.loseContext(),Gl(this._canvasContainer),Gl(this._controlContainer),Gl(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),r.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new r.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(m){this._renderNextFrame=this._renderNextFrame||m,this.style&&!this._frame&&(this._frame=r.exported.frame(o=>{const d=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,d&&this._render(o)}))}_preloadTiles(m){const o=this.style?Object.values(this.style._sourceCaches):[];return r.asyncAll(o,(d,y)=>d._preloadTiles(m,y),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(m){this._trackResize&&this.resize({originalEvent:m})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(m){this._showTileBoundaries!==m&&(this._showTileBoundaries=m,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(m){this._showTerrainWireframe!==m&&(this._showTerrainWireframe=m,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(m){this._speedIndexTiming!==m&&(this._speedIndexTiming=m,this._update())}get showPadding(){return!!this._showPadding}set showPadding(m){this._showPadding!==m&&(this._showPadding=m,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(m){this._showCollisionBoxes!==m&&(this._showCollisionBoxes=m,m?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(m){this._showOverdrawInspector!==m&&(this._showOverdrawInspector=m,this._update())}get repaint(){return!!this._repaint}set repaint(m){this._repaint!==m&&(this._repaint=m,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(m){this._vertices=m,this._update()}_setCacheLimits(m,o){r.setCacheLimits(m,o)}get version(){return r.version}},NavigationControl:class{constructor(m){this.options=r.extend({},op,m),this._container=D("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(r.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",o=>{this._map&&this._map.zoomIn({},{originalEvent:o})}),D("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",o=>{this._map&&this._map.zoomOut({},{originalEvent:o})}),D("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(r.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",o=>{const d=this._map;d&&(this.options.visualizePitch?d.resetNorthPitch({},{originalEvent:o}):d.resetNorth({},{originalEvent:o}))}),this._compassIcon=D("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const m=this._map;if(!m)return;const o=m.getZoom(),d=o===m.getMaxZoom(),y=o===m.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())}_rotateCompassArrow(){const m=this._map;if(!m)return;const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(m.transform.pitch*(Math.PI/180)),.5)}) rotateX(${m.transform.pitch}deg) rotateZ(${m.transform.angle*(180/Math.PI)}deg)`:`rotate(${m.transform.angle*(180/Math.PI)}deg)`;m._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=o)})}onAdd(m){return this._map=m,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),m.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&m.on("pitch",this._rotateCompassArrow),m.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ap(m,this._compass,this.options.visualizePitch)),this._container}onRemove(){const m=this._map;m&&(this._container.remove(),this.options.showZoom&&m.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&m.off("pitch",this._rotateCompassArrow),m.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(m,o){const d=D("button",m,this._container);return d.type="button",d.addEventListener("click",o),d}_setButtonTitle(m,o){if(!this._map)return;const d=this._map._getUIString(`NavigationControl.${o}`);m.setAttribute("aria-label",d),m.firstElementChild&&m.firstElementChild.setAttribute("title",d)}},GeolocateControl:class extends r.Evented{constructor(m){super(),this.options=r.extend({},yr,m),r.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Yd(this._updateMarkerRotation,20)}onAdd(m){var o;return this._map=m,this._container=D("div","mapboxgl-ctrl mapboxgl-ctrl-group"),o=this._setupUI,Ir!==void 0?o(Ir):r.window.navigator.permissions!==void 0?r.window.navigator.permissions.query({name:"geolocation"}).then(d=>{Ir=d.state!=="denied",o(Ir)}):(Ir=!!r.window.navigator.geolocation,o(Ir)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(r.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,Hl=0,Wa=!1}_isOutOfMapMaxBounds(m){const o=this._map.getMaxBounds(),d=m.coords;return!!o&&(d.longitude<o.getWest()||d.longitude>o.getEast()||d.latitude<o.getSouth()||d.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(m){if(this._map){if(this._isOutOfMapMaxBounds(m))return this._setErrorState(),this.fire(new r.Event("outofmaxbounds",m)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=m,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(m),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(m),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new r.Event("geolocate",m)),this._finish()}}_updateCamera(m){const o=new r.LngLat(m.coords.longitude,m.coords.latitude),d=m.coords.accuracy,y=this._map.getBearing(),w=r.extend({bearing:y},this.options.fitBoundsOptions);this._map.fitBounds(o.toBounds(d),w,{geolocateSource:!0})}_updateMarker(m){if(m){const o=new r.LngLat(m.coords.longitude,m.coords.latitude);this._accuracyCircleMarker.setLngLat(o).addTo(this._map),this._userLocationDotMarker.setLngLat(o).addTo(this._map),this._accuracy=m.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const m=this._map._containerHeight/2,o=this._map.unproject([0,m]),d=this._map.unproject([100,m]),y=o.distanceTo(d)/100,w=Math.ceil(2*this._accuracy/y);this._circleElement.style.width=`${w}px`,this._circleElement.style.height=`${w}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(m){if(this._map){if(this.options.trackUserLocation)if(m.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(m.code===3&&Wa)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new r.Event("error",m)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(m){if(this._container.addEventListener("contextmenu",o=>o.preventDefault()),this._geolocateButton=D("button","mapboxgl-ctrl-geolocate",this._container),D("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",m===!1){r.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const o=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}else{const o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",o),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=D("div","mapboxgl-user-location"),this._dotElement.appendChild(D("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(D("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ou({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=D("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ou({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",o=>{o.geolocateSource||this._watchState!=="ACTIVE_LOCK"||o.originalEvent&&o.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new r.Event("trackuserlocationend")))})}_onDeviceOrientation(m){this._userLocationDotMarker&&(m.webkitCompassHeading?this._heading=m.webkitCompassHeading:m.absolute===!0&&(this._heading=-1*m.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return r.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new r.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Hl--,Wa=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new r.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new r.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let m;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Hl++,Hl>1?(m={maximumAge:6e5,timeout:0},Wa=!0):(m=this.options.positionOptions,Wa=!1),this._geolocationWatchID=r.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,m),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else r.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const m=()=>{r.window.addEventListener("ondeviceorientationabsolute"in r.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};r.window.DeviceMotionEvent!==void 0&&typeof r.window.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(o=>{o==="granted"&&m()}).catch(console.error):m()}_clearWatch(){r.window.navigator.geolocation.clearWatch(this._geolocationWatchID),r.window.removeEventListener("deviceorientation",this._onDeviceOrientation),r.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ku,ScaleControl:class{constructor(m){this.options=r.extend({},sp,m),r.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Nu(this._map,this._container,this.options)}onAdd(m){return this._map=m,this._container=D("div","mapboxgl-ctrl mapboxgl-ctrl-scale",m.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(m){this.options.unit=m,Nu(this._map,this._container,this.options)}},FullscreenControl:class{constructor(m){this._fullscreen=!1,m&&m.container&&(m.container instanceof r.window.HTMLElement?this._container=m.container:r.warnOnce("Full screen control 'container' must be a DOM element.")),r.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in r.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in r.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(m){return this._map=m,this._container||(this._container=this._map.getContainer()),this._controlContainer=D("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",r.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,r.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!r.window.document.fullscreenEnabled&&!r.window.document.webkitFullscreenEnabled)}_setupUI(){const m=this._fullscreenButton=D("button","mapboxgl-ctrl-fullscreen",this._controlContainer);D("span","mapboxgl-ctrl-icon",m).setAttribute("aria-hidden","true"),m.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),r.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const m=this._getTitle();this._fullscreenButton.setAttribute("aria-label",m),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",m)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(r.window.document.fullscreenElement||r.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?r.window.document.exitFullscreen?r.window.document.exitFullscreen():r.window.document.webkitCancelFullScreen&&r.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends r.Evented{constructor(m){super(),this.options=r.extend(Object.create($r),m),r.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(m&&m.className?m.className.trim().split(/\s+/):[])}addTo(m){return this._map&&this.remove(),this._map=m,this.options.closeOnClick&&m.on("preclick",this._onClose),this.options.closeOnMove&&m.on("move",this._onClose),m.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(m.on("mousemove",this._onMouseEvent),m.on("mouseup",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")):m.on("move",this._update),this.fire(new r.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const m=this._map;return m&&(m.off("move",this._update),m.off("move",this._onClose),m.off("preclick",this._onClose),m.off("click",this._onClose),m.off("remove",this.remove),m.off("mousemove",this._onMouseEvent),m.off("mouseup",this._onMouseEvent),m.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new r.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(m){this._lngLat=r.LngLat.convert(m),this._pos=null,this._trackPointer=!1,this._update();const o=this._map;return o&&(o.on("move",this._update),o.off("mousemove",this._onMouseEvent),o._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const m=this._map;return m&&(m.off("move",this._update),m.on("mousemove",this._onMouseEvent),m.on("drag",this._onMouseEvent),m._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(m){return this.setDOMContent(r.window.document.createTextNode(m))}setHTML(m){const o=r.window.document.createDocumentFragment(),d=r.window.document.createElement("body");let y;for(d.innerHTML=m;y=d.firstChild,y;)o.appendChild(y);return this.setDOMContent(o)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(m){return this.options.maxWidth=m,this._update(),this}setDOMContent(m){let o=this._content;if(o)for(;o.hasChildNodes();)o.firstChild&&o.removeChild(o.firstChild);else o=this._content=D("div","mapboxgl-popup-content",this._container||void 0);if(o.appendChild(m),this.options.closeButton){const d=this._closeButton=D("button","mapboxgl-popup-close-button",o);d.type="button",d.setAttribute("aria-label","Close popup"),d.setAttribute("aria-hidden","true"),d.innerHTML="&#215;",d.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(m){return this._classList.add(m),this._updateClassList(),this}removeClassName(m){return this._classList.delete(m),this._updateClassList(),this}setOffset(m){return this.options.offset=m,this._update(),this}toggleClassName(m){let o;return this._classList.delete(m)?o=!1:(this._classList.add(m),o=!0),this._updateClassList(),o}_onMouseEvent(m){this._update(m.point)}_getAnchor(m){if(this.options.anchor)return this.options.anchor;const o=this._map,d=this._container,y=this._pos;if(!o||!d||!y)return"bottom";const w=d.offsetWidth,T=d.offsetHeight,A=y.x<w/2,I=y.x>o.transform.width-w/2;if(y.y+m<T)return A?"top-left":I?"top-right":"top";if(y.y>o.transform.height-T){if(A)return"bottom-left";if(I)return"bottom-right"}return A?"left":I?"right":"bottom"}_updateClassList(){const m=this._container;if(!m)return;const o=[...this._classList];o.push("mapboxgl-popup"),this._anchor&&o.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&o.push("mapboxgl-popup-track-pointer"),m.className=o.join(" ")}_update(m){const o=this._map,d=this._content;if(!o||!this._lngLat&&!this._trackPointer||!d)return;let y=this._container;if(y||(y=this._container=D("div","mapboxgl-popup",o.getContainer()),this._tip=D("div","mapboxgl-popup-tip",y),y.appendChild(d)),this.options.maxWidth&&y.style.maxWidth!==this.options.maxWidth&&(y.style.maxWidth=this.options.maxWidth),o.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Bu(this._lngLat,this._pos,o.transform)),!this._trackPointer||m){const w=this._pos=this._trackPointer&&m?m:o.project(this._lngLat),T=Wl(this.options.offset),A=this._anchor=this._getAnchor(T.y),I=Wl(this.options.offset,A),O=w.add(I).round();o._requestDomTask(()=>{this._container&&A&&(this._container.style.transform=`${Fu[A]} translate(${O.x}px,${O.y}px)`)})}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const m=this._container.querySelector(ci);m&&m.focus()}_onClose(){this.remove()}_setOpacity(m){this._content&&(this._content.style.opacity=m),this._tip&&(this._tip.style.opacity=m)}},Marker:Ou,Style:gr,LngLat:r.LngLat,LngLatBounds:r.LngLatBounds,Point:r.pointGeometry,MercatorCoordinate:r.MercatorCoordinate,FreeCameraOptions:Rl,Evented:r.Evented,config:r.config,prewarm:function(){Be().acquire(_n)},clearPrewarmedResources:function(){const m=K;m&&(m.isPreloaded()&&m.numActive()===1?(m.release(_n),K=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return r.config.ACCESS_TOKEN},set accessToken(m){r.config.ACCESS_TOKEN=m},get baseApiUrl(){return r.config.API_URL},set baseApiUrl(m){r.config.API_URL=m},get workerCount(){return q.workerCount},set workerCount(m){q.workerCount=m},get maxParallelImageRequests(){return r.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(m){r.config.MAX_PARALLEL_IMAGE_REQUESTS=m},clearStorage(m){r.clearTileCache(m)},workerUrl:"",workerClass:null,setNow:r.exported.setNow,restoreNow:r.exported.restoreNow};return zs});var f=u;return f})})(q1);var xI=q1.exports;const bI=O1(xI),ou={tdtsl(){return{layers:[["tdtsl","TianDiTu.Normal.Map"],["tdtslzj","TianDiTu.Normal.Annotion"]],key:"fb258b4c0bbf60ff7a0205b519ad9a96"}},tdtyx(){return{layers:[["tdtyx","TianDiTu.Satellite.Map"],["tdtyxzj","TianDiTu.Satellite.Annotion"]],key:"fb258b4c0bbf60ff7a0205b519ad9a96"}},tdtdx(){return{layers:[["tdtdx","TianDiTu.Terrain.Map"],["tdtdxzj","TianDiTu.Terrain.Annotion"]],key:"fb258b4c0bbf60ff7a0205b519ad9a96"}},gdsl(){return{layers:[["gdsl","GaoDe.Normal.Map"]]}},gdslwzj(){return{layers:[["gdslwzj","GaoDe.Normal_NoTag.Map"]]}},gdyx(){return{layers:[["gdyx","GaoDe.Satellite.Map"],["gdyxzj","GaoDe.Satellite.Annotion"]]}},bdsl(){return{layers:[["bdsl","Baidu.Normal.Map"]]}},bdyx(){return{layers:[["bdyx","Baidu.Satellite.Map"],["bdyxzj","Baidu.Satellite.Annotion"]]}},osm(){return{layers:[["osm","OSM.Normal.Map"]]}},geoq(){return{layers:[["geoq","Geoq.Normal.Map"]]}},geoqPurplishBlue(){return{layers:[["geoqPurplishBlue","Geoq.Normal.PurplishBlue"]]}},geoqGray(){return{layers:[["geoqGray","Geoq.Normal.Gray"]]}},geoqWarm(){return{layers:[["geoqWarm","Geoq.Normal.Warm"]]}},geoqCold(){return{layers:[["geoqCold","Geoq.Normal.Cold"]]}}};function wI(e){const t="./gis/radar.tiff";console.log(t);let i=(114.06825863001939-104.18084906665138)*.005,l=(32.396413467808586-22.54283198132819)*.005,u=114.07867152431874,h=22.563727343812303;e.addSource("radar",{type:"image",url:t,coordinates:[[u-i*.5,h+l*.5],[u+i*.5,h+l*.5],[u+i*.5,h-l*.5],[u-i*.5,h-l*.5]]}),e.addLayer({id:"radar-layer",type:"raster",source:"radar",paint:{"raster-fade-duration":0}})}function MI(e){var t="http://192.168.5.19:8080/geoserver/gwc/service/wmts?layer=mytest%3Amxcadtest2&style=&tilematrixset=EPSG:900913&Service=WMTS&Request=GetTile&Version=1.0.0&Format=image/png&TileMatrix=EPSG:900913:{z}&TileCol={x}&TileRow={y}";e.addSource("wmts-source",{type:"raster",tiles:[t],tileSize:256}),e.addLayer({id:"wmts-layer",type:"raster",source:"wmts-source",paint:{"raster-opacity":.95}})}function TI(){return{TianDiTu:{Normal:{Map:"http://t{s}.tianditu.com/DataServer?T=vec_w&X={x}&Y={y}&L={z}&tk={key}",Annotion:"http://t{s}.tianditu.com/DataServer?T=cva_w&X={x}&Y={y}&L={z}&tk={key}",minzoom:0,maxzoom:18},Satellite:{Map:"http://t{s}.tianditu.com/DataServer?T=img_w&X={x}&Y={y}&L={z}&tk={key}",Annotion:"http://t{s}.tianditu.com/DataServer?T=cia_w&X={x}&Y={y}&L={z}&tk={key}",minzoom:0,maxzoom:18},Terrain:{Map:"http://t{s}.tianditu.com/DataServer?T=ter_w&X={x}&Y={y}&L={z}&tk={key}",Annotion:"http://t{s}.tianditu.com/DataServer?T=cta_w&X={x}&Y={y}&L={z}&tk={key}",minzoom:0,maxzoom:14},Subdomains:["0","1","2","3","4","5","6","7"],key:""},GaoDe:{Normal:{Map:"http://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}",minzoom:0,maxzoom:18},Normal_NoTag:{Map:"https://wprd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&style=7&scl=1&ltype=11&x={x}&y={y}&z={z}",minzoom:3,maxzoom:18},Satellite:{Map:"http://webst0{s}.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}",Annotion:"http://webst0{s}.is.autonavi.com/appmaptile?style=8&x={x}&y={y}&z={z}",minzoom:3,maxzoom:18},Subdomains:["1","2","3","4"]},Baidu:{Normal:{Map:"http://online{s}.map.bdimg.com/onlinelabel/?qt=tile&x={x}&y={y}&z={z}&styles=pl&scaler=1&p=1"},Satellite:{Map:"http://shangetu{s}.map.bdimg.com/it/u=x={x};y={y};z={z};v=009;type=sate&fm=46",Annotion:"http://online{s}.map.bdimg.com/tile/?qt=tile&x={x}&y={y}&z={z}&styles=sl&v=020"},Subdomains:"0123456789",tileType:"bd09"},Geoq:{Normal:{Map:"http://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineCommunity/MapServer/tile/{z}/{y}/{x}",PurplishBlue:"http://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetPurplishBlue/MapServer/tile/{z}/{y}/{x}",Gray:"http://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetGray/MapServer/tile/{z}/{y}/{x}",Warm:"http://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetWarm/MapServer/tile/{z}/{y}/{x}",minzoom:3,maxzoom:16},Subdomains:[]},OSM:{Normal:{Map:"http://{s}.tile.osm.org/{z}/{x}/{y}.png",minzoom:0,maxzoom:18},Subdomains:["a","b","c"]}}}function EI(){return["https://0pn.cn/maps/vt?lyrs=s&x={x}&y={y}&z={z}","https://0pn.cn/maps/vt?lyrs=s,m&gl=CN&x={x}&y={y}&z={z}"]}let vd,Ro;function CI(e){vd.on("click",function(t){return lt(this,null,function*(){let{lng:i,lat:l}=t.lngLat;if(e){let f=P.mx_gcj02_To_gps84(i,l);i=f.lng,l=f.lat}console.log("经纬度坐标:",JSON.stringify([i,l]));let u=bI.MercatorCoordinate.fromLngLat([i,l],0);console.log("墨卡托坐标:",JSON.stringify(Ro.map_lnglat_to_meters(i,l)));let h=Ro.mercatorCoord2CAD(u.x,u.y);console.log("CAD坐标:",JSON.stringify(h))})})}let xd=!1,_m=!0;_m=!1,_m&&(xd=!1);function AI(){let e=new P.MxCADPluginMapDefaultData;e.cadOrigin=[116275.977014,19273.279085],e.mapOrigin=[114.06825863001939,22.54283198132819],e.meterInCADUnits=1,e.openFile="./demo/road.dwg.mxweb";let t=Le.MxFun.getQueryString("maptype");if(!_m)if(t=="google"){let i=P.mx_gps84_To_gcj02(e.mapOrigin[0],e.mapOrigin[1]);e.mapOrigin=[i.lng,i.lat],xd=!0,e.viewColor={red:0,green:0,blue:0}}else{let i=ou.gdslwzj();t=="gdslwzj"?i=ou.gdslwzj():t=="gdyx"?i=ou.gdyx():t=="tdtsl"?i=ou.tdtsl():t=="bdsl"?i=ou.bdsl():t=="geoq"&&(i=ou.geoq()),e.rasterTileLayerList=i.layers,i.key&&(e.rasterTileKey=i.key),e.providers=TI()}return e}function SI(e){Ro=e,vd=e.getMapbox(),xd&&P.MxMapAddGoogleCnLayer(vd,["Image","Lable"],EI()),CI(xd),_m?MI(vd):wI(vd)}function DI(){return lt(this,null,function*(){let e=new P.MxCADUiPrPoint;e.setMessage(`
指定下载范围第一点:`);let t=yield e.go();if(!t)return;e.setMessage(`
指定下载范围第二点:`),e.setUserDraw((b,E)=>{E.setColor(16711680);let M=new P.McDbPolyline;M.addVertexAt(t),M.addVertexAt(new P.McGePoint3d(t.x,b.y)),M.addVertexAt(b),M.addVertexAt(new P.McGePoint3d(b.x,t.y)),M.constantWidth=Le.MxFun.screenCoordLong2Doc(2),M.isClosed=!0,E.drawMcDbEntity(M);let D=[];D.push(t.toVector3()),D.push(new THREE.Vector3(t.x,b.y)),D.push(b.toVector3()),D.push(new THREE.Vector3(b.x,t.y)),E.setColor(12868),E.drawSolid(D,.5)}),e.setDisableOsnap(!0),e.setDisableOrthoTrace(!0),e.setDynamicInputType(Le.DynamicInputType.kXYCoordInput);let i=yield e.go();if(!i)return;let l=Ro.cadTolnglat(t.toVector3()),u=Ro.cadTolnglat(i.toVector3()),h=Ro.map_lnglat_to_meters(l[0],l[1]),f=Ro.map_lnglat_to_meters(u[0],u[1]);if(xd&&!(Ro.outOfChina(l[0],l[1])&&Ro.outOfChina(u[0],u[1]))){let b=P.mx_gcj02_To_gps84(l[0],l[1]),E=P.mx_gcj02_To_gps84(u[0],u[1]);h=Ro.map_lnglat_to_meters(b.lng,b.lat),f=Ro.map_lnglat_to_meters(E.lng,E.lat)}let r={url:"https://0pn.cn/maps/vt?lyrs=s&x={x}&y={y}&z={z}",polygon:[h[0],h[1],f[0],f[1]],zoom:18,auto_close:!1,no_repeated_download:!0,download_dir:"",thread_count:32};Le.MxFun.acutPrintf(`
 使用教程:https://help.mxdraw.com/?pid=111`),Le.MxFun.acutPrintf(`
 复制下面的范围,到下载器下载地图,下载范围:`);let v=`
`+JSON.stringify([h[0],h[1],f[0],f[1]]);Le.MxFun.acutPrintf(v),Le.MxFun.acutPrintf(`
`),Up({method:"post",url:"http://localhost:1337/users/mxgis/download",data:r}).then(b=>{console.log(b.data),alert(JSON.stringify(b.data))}).catch(b=>{console.log("网络错误")})})}window._iconfont_svg_string_4337873='<svg><symbol id="icon-zidian" viewBox="0 0 1024 1024"><path d="M893.080181 585.210149h-86.234525v-37.615932h79.557697a57.552376 57.552376 0 0 0 1.786757-115.104753l-20.500683-0.658279 2.445035-20.312603a153.473004 153.473004 0 0 0 1.034439-17.679488A148.300813 148.300813 0 0 0 723.056167 245.72636a151.310088 151.310088 0 0 0-39.966928 5.64239l-20.782803 5.64239-3.009274-21.347042A225.695594 225.695594 0 0 0 209.222531 266.415123v18.807966l-16.739089 1.880797a130.715365 130.715365 0 0 0 14.952333 260.490331v37.615932a168.331297 168.331297 0 0 1-35.547056-332.806961 263.311526 263.311526 0 0 1 521.074702-41.753685 181.120714 181.120714 0 0 1 29.998706-2.539075 185.916746 185.916746 0 0 1 185.822706 185.728666v3.573513a95.168309 95.168309 0 0 1-15.704652 187.515423z" fill="#282D33" ></path><path d="M399.371069 341.646988H329.875634a74.573586 74.573586 0 0 0-74.291466 73.257028v478.944858-18.807966 14.576174a74.573586 74.573586 0 0 1 74.573586-74.479546h431.454744V341.646988H399.371069z" fill="#FFFFFF" ></path><path d="M255.584168 908.519088h-18.807966V414.715936A94.039831 94.039831 0 0 1 329.875634 322.839021h69.495435v37.615933H329.875634a56.423898 56.423898 0 0 0-55.4835 54.825221v399.481201a93.381552 93.381552 0 0 1 55.76562-18.807966h412.646778V360.454954H506.012238v-37.615933h274.408226v511.106481H329.875634a55.85966 55.85966 0 0 0-55.4835 52.568265v7.523187h-0.940398a18.807966 18.807966 0 0 1-17.867568 14.482134z" fill="#282D33" ></path><path d="M369.654483 392.804655H710.736949v371.363292H369.654483z" fill="#F8C44F" ></path><path d="M761.612498 815.137536H329.875634a74.573586 74.573586 0 1 0 0 149.053132h431.736864z" fill="#FFFFFF" ></path><path d="M780.420464 982.998634H329.875634a93.381552 93.381552 0 1 1 0-186.669064h450.54483zM329.875634 833.945502a55.76562 55.76562 0 1 0 0 111.437199h412.928898V833.945502z" fill="#282D33" ></path><path d="M475.073133 1024l-54.072903-34.230498-54.072902 34.230498v-127.89417h108.145805v127.89417z" fill="#34CA9D" ></path><path d="M324.327284 893.942914z" fill="#FFFFFF" ></path><path d="M324.327284 875.134948h437.285214v37.615932h-437.285214z" fill="#282D33" ></path><path d="M324.327284 810.529584z" fill="#FFFFFF" ></path><path d="M305.519318 349.076134h37.615933v461.45345h-37.615933zM520.494371 257.857498L453.067813 190.524979l-67.332519 67.332519-26.613272-26.613272L453.067813 137.392475l94.039831 93.851751-26.613273 26.613272z" fill="#282D33" ></path><path d="M436.422763 189.302462h37.615932v248.829392h-37.615932zM559.803021 694.390393l-94.039831-93.851751 26.613272-26.613272 67.426559 67.332519 67.426558-67.332519 26.519233 26.613272-93.945791 93.851751z" fill="#282D33" ></path><path d="M538.832138 393.556974h37.615933v248.829393h-37.615933z" fill="#282D33" ></path></symbol></svg>',function(e){var i=(i=document.getElementsByTagName("script"))[i.length-1],t=i.getAttribute("data-injectcss"),i=i.getAttribute("data-disable-injectsvg");if(!i){var l,u,h,f,r,v=function(M,D){D.parentNode.insertBefore(M,D)};if(t&&!e.__iconfont__svg__cssinject__){e.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(M){console&&console.log(M)}}l=function(){var M,D=document.createElement("div");D.innerHTML=e._iconfont_svg_string_4337873,(D=D.getElementsByTagName("svg")[0])&&(D.setAttribute("aria-hidden","true"),D.style.position="absolute",D.style.width=0,D.style.height=0,D.style.overflow="hidden",D=D,(M=document.body).firstChild?v(D,M.firstChild):M.appendChild(D))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(l,0):(u=function(){document.removeEventListener("DOMContentLoaded",u,!1),l()},document.addEventListener("DOMContentLoaded",u,!1)):document.attachEvent&&(h=l,f=e.document,r=!1,E(),f.onreadystatechange=function(){f.readyState=="complete"&&(f.onreadystatechange=null,b())})}function b(){r||(r=!0,h())}function E(){try{f.documentElement.doScroll("left")}catch(M){return void setTimeout(E,50)}b()}}(window);var PI=function(){function e(Ie){ri.call(this,Ie),this.dracoLoader=null,this.ddsLoader=null}e.prototype=Object.assign(Object.create(ri.prototype),{constructor:e,load:function(Ie,xe,He,Ge){var ze=this,rt;this.resourcePath!==""?rt=this.resourcePath:this.path!==""?rt=this.path:rt=dl.extractUrlBase(Ie),ze.manager.itemStart(Ie);var fe=function(Ce){Ge?Ge(Ce):console.error(Ce),ze.manager.itemError(Ie),ze.manager.itemEnd(Ie)},Ee=new xo(ze.manager);Ee.setPath(this.path),Ee.setResponseType("arraybuffer"),ze.crossOrigin==="use-credentials"&&Ee.setWithCredentials(!0),Ee.load(Ie,function(Ce){try{ze.parse(Ce,rt,function(ye){xe(ye),ze.manager.itemEnd(Ie)},fe)}catch(ye){fe(ye)}},He,fe)},setDRACOLoader:function(Ie){return this.dracoLoader=Ie,this},setDDSLoader:function(Ie){return this.ddsLoader=Ie,this},parse:function(Ie,xe,He,Ge){var ze,rt={};if(typeof Ie=="string")ze=Ie;else{var fe=dl.decodeText(new Uint8Array(Ie,0,4));if(fe===f){try{rt[i.KHR_BINARY_GLTF]=new b(Ie)}catch(st){Ge&&Ge(st);return}ze=rt[i.KHR_BINARY_GLTF].content}else ze=dl.decodeText(new Uint8Array(Ie))}var Ee=JSON.parse(ze);if(Ee.asset===void 0||Ee.asset.version[0]<2){Ge&&Ge(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}if(Ee.extensionsUsed)for(var Ce=0;Ce<Ee.extensionsUsed.length;++Ce){var ye=Ee.extensionsUsed[Ce],Oe=Ee.extensionsRequired||[];switch(ye){case i.KHR_LIGHTS_PUNCTUAL:rt[ye]=new u(Ee);break;case i.KHR_MATERIALS_UNLIT:rt[ye]=new h;break;case i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:rt[ye]=new L;break;case i.KHR_DRACO_MESH_COMPRESSION:rt[ye]=new E(Ee,this.dracoLoader);break;case i.MSFT_TEXTURE_DDS:rt[ye]=new l(this.ddsLoader);break;case i.KHR_TEXTURE_TRANSFORM:rt[ye]=new M;break;case i.KHR_MESH_QUANTIZATION:rt[ye]=new z;break;default:Oe.indexOf(ye)>=0&&console.warn('THREE.GLTFLoader: Unknown extension "'+ye+'".')}}var Ke=new yt(Ee,rt,{path:xe||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager});Ke.parse(He,Ge)}});function t(){var Ie={};return{get:function(xe){return Ie[xe]},add:function(xe,He){Ie[xe]=He},remove:function(xe){delete Ie[xe]},removeAll:function(){Ie={}}}}var i={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function l(Ie){if(!Ie)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=i.MSFT_TEXTURE_DDS,this.ddsLoader=Ie}function u(Ie){this.name=i.KHR_LIGHTS_PUNCTUAL;var xe=Ie.extensions&&Ie.extensions[i.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=xe.lights||[]}u.prototype.loadLight=function(Ie){var xe=this.lightDefs[Ie],He,Ge=new tn(16777215);xe.color!==void 0&&Ge.fromArray(xe.color);var ze=xe.range!==void 0?xe.range:0;switch(xe.type){case"directional":He=new tm(Ge),He.target.position.set(0,0,-1),He.add(He.target);break;case"point":He=new em(Ge),He.distance=ze;break;case"spot":He=new Qf(Ge),He.distance=ze,xe.spot=xe.spot||{},xe.spot.innerConeAngle=xe.spot.innerConeAngle!==void 0?xe.spot.innerConeAngle:0,xe.spot.outerConeAngle=xe.spot.outerConeAngle!==void 0?xe.spot.outerConeAngle:Math.PI/4,He.angle=xe.spot.outerConeAngle,He.penumbra=1-xe.spot.innerConeAngle/xe.spot.outerConeAngle,He.target.position.set(0,0,-1),He.add(He.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+xe.type+'".')}return He.position.set(0,0,0),He.decay=2,xe.intensity!==void 0&&(He.intensity=xe.intensity),He.name=xe.name||"light_"+Ie,Promise.resolve(He)};function h(){this.name=i.KHR_MATERIALS_UNLIT}h.prototype.getMaterialType=function(){return lr},h.prototype.extendParams=function(Ie,xe,He){var Ge=[];Ie.color=new tn(1,1,1),Ie.opacity=1;var ze=xe.pbrMetallicRoughness;if(ze){if(Array.isArray(ze.baseColorFactor)){var rt=ze.baseColorFactor;Ie.color.fromArray(rt),Ie.opacity=rt[3]}ze.baseColorTexture!==void 0&&Ge.push(He.assignTexture(Ie,"map",ze.baseColorTexture))}return Promise.all(Ge)};var f="glTF",r=12,v={JSON:1313821514,BIN:5130562};function b(Ie){this.name=i.KHR_BINARY_GLTF,this.content=null,this.body=null;var xe=new DataView(Ie,0,r);if(this.header={magic:dl.decodeText(new Uint8Array(Ie.slice(0,4))),version:xe.getUint32(4,!0),length:xe.getUint32(8,!0)},this.header.magic!==f)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var He=new DataView(Ie,r),Ge=0;Ge<He.byteLength;){var ze=He.getUint32(Ge,!0);Ge+=4;var rt=He.getUint32(Ge,!0);if(Ge+=4,rt===v.JSON){var fe=new Uint8Array(Ie,r+Ge,ze);this.content=dl.decodeText(fe)}else if(rt===v.BIN){var Ee=r+Ge;this.body=Ie.slice(Ee,Ee+ze)}Ge+=ze}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}function E(Ie,xe){if(!xe)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=i.KHR_DRACO_MESH_COMPRESSION,this.json=Ie,this.dracoLoader=xe,this.dracoLoader.preload()}E.prototype.decodePrimitive=function(Ie,xe){var He=this.json,Ge=this.dracoLoader,ze=Ie.extensions[this.name].bufferView,rt=Ie.extensions[this.name].attributes,fe={},Ee={},Ce={};for(var ye in rt){var Oe=$[ye]||ye.toLowerCase();fe[Oe]=rt[ye]}for(ye in Ie.attributes){var Oe=$[ye]||ye.toLowerCase();if(rt[ye]!==void 0){var Ke=He.accessors[Ie.attributes[ye]],st=G[Ke.componentType];Ce[Oe]=st,Ee[Oe]=Ke.normalized===!0}}return xe.getDependency("bufferView",ze).then(function(wt){return new Promise(function(Gt){Ge.decodeDracoFile(wt,function(de){for(var we in de.attributes){var bt=de.attributes[we],gt=Ee[we];gt!==void 0&&(bt.normalized=gt)}Gt(de)},fe,Ce)})})};function M(){this.name=i.KHR_TEXTURE_TRANSFORM}M.prototype.extendTexture=function(Ie,xe){return Ie=Ie.clone(),xe.offset!==void 0&&Ie.offset.fromArray(xe.offset),xe.rotation!==void 0&&(Ie.rotation=xe.rotation),xe.scale!==void 0&&Ie.repeat.fromArray(xe.scale),xe.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),Ie.needsUpdate=!0,Ie};function D(Ie){Ur.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var xe=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),He=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),Ge=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	texelSpecular = sRGBToLinear( texelSpecular );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),ze=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),rt=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor.rgb;"].join(`
`),fe={specular:{value:new tn().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=fe,this.onBeforeCompile=function(Ee){for(var Ce in fe)Ee.uniforms[Ce]=fe[Ce];Ee.fragmentShader=Ee.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;"),Ee.fragmentShader=Ee.fragmentShader.replace("uniform float metalness;","uniform float glossiness;"),Ee.fragmentShader=Ee.fragmentShader.replace("#include <roughnessmap_pars_fragment>",xe),Ee.fragmentShader=Ee.fragmentShader.replace("#include <metalnessmap_pars_fragment>",He),Ee.fragmentShader=Ee.fragmentShader.replace("#include <roughnessmap_fragment>",Ge),Ee.fragmentShader=Ee.fragmentShader.replace("#include <metalnessmap_fragment>",ze),Ee.fragmentShader=Ee.fragmentShader.replace("#include <lights_physical_fragment>",rt)},Object.defineProperties(this,{specular:{get:function(){return fe.specular.value},set:function(Ee){fe.specular.value=Ee}},specularMap:{get:function(){return fe.specularMap.value},set:function(Ee){fe.specularMap.value=Ee}},glossiness:{get:function(){return fe.glossiness.value},set:function(Ee){fe.glossiness.value=Ee}},glossinessMap:{get:function(){return fe.glossinessMap.value},set:function(Ee){fe.glossinessMap.value=Ee,Ee?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_ROUGHNESSMAP=""):(delete this.defines.USE_ROUGHNESSMAP,delete this.defines.USE_GLOSSINESSMAP)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(Ie)}D.prototype=Object.create(Ur.prototype),D.prototype.constructor=D,D.prototype.copy=function(Ie){return Ur.prototype.copy.call(this,Ie),this.specularMap=Ie.specularMap,this.specular.copy(Ie.specular),this.glossinessMap=Ie.glossinessMap,this.glossiness=Ie.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this};function L(){return{name:i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return D},extendParams:function(Ie,xe,He){var Ge=xe.extensions[this.name];Ie.color=new tn(1,1,1),Ie.opacity=1;var ze=[];if(Array.isArray(Ge.diffuseFactor)){var rt=Ge.diffuseFactor;Ie.color.fromArray(rt),Ie.opacity=rt[3]}if(Ge.diffuseTexture!==void 0&&ze.push(He.assignTexture(Ie,"map",Ge.diffuseTexture)),Ie.emissive=new tn(0,0,0),Ie.glossiness=Ge.glossinessFactor!==void 0?Ge.glossinessFactor:1,Ie.specular=new tn(1,1,1),Array.isArray(Ge.specularFactor)&&Ie.specular.fromArray(Ge.specularFactor),Ge.specularGlossinessTexture!==void 0){var fe=Ge.specularGlossinessTexture;ze.push(He.assignTexture(Ie,"glossinessMap",fe)),ze.push(He.assignTexture(Ie,"specularMap",fe))}return Promise.all(ze)},createMaterial:function(Ie){var xe=new D(Ie);return xe.fog=!0,xe.color=Ie.color,xe.map=Ie.map===void 0?null:Ie.map,xe.lightMap=null,xe.lightMapIntensity=1,xe.aoMap=Ie.aoMap===void 0?null:Ie.aoMap,xe.aoMapIntensity=1,xe.emissive=Ie.emissive,xe.emissiveIntensity=1,xe.emissiveMap=Ie.emissiveMap===void 0?null:Ie.emissiveMap,xe.bumpMap=Ie.bumpMap===void 0?null:Ie.bumpMap,xe.bumpScale=1,xe.normalMap=Ie.normalMap===void 0?null:Ie.normalMap,xe.normalMapType=Ys,Ie.normalScale&&(xe.normalScale=Ie.normalScale),xe.displacementMap=null,xe.displacementScale=1,xe.displacementBias=0,xe.specularMap=Ie.specularMap===void 0?null:Ie.specularMap,xe.specular=Ie.specular,xe.glossinessMap=Ie.glossinessMap===void 0?null:Ie.glossinessMap,xe.glossiness=Ie.glossiness,xe.alphaMap=null,xe.envMap=Ie.envMap===void 0?null:Ie.envMap,xe.envMapIntensity=1,xe.refractionRatio=.98,xe}}}function z(){this.name=i.KHR_MESH_QUANTIZATION}function k(Ie,xe,He,Ge){Vr.call(this,Ie,xe,He,Ge)}k.prototype=Object.create(Vr.prototype),k.prototype.constructor=k,k.prototype.copySampleValue_=function(Ie){for(var xe=this.resultBuffer,He=this.sampleValues,Ge=this.valueSize,ze=Ie*Ge*3+Ge,rt=0;rt!==Ge;rt++)xe[rt]=He[ze+rt];return xe},k.prototype.beforeStart_=k.prototype.copySampleValue_,k.prototype.afterEnd_=k.prototype.copySampleValue_,k.prototype.interpolate_=function(Ie,xe,He,Ge){for(var ze=this.resultBuffer,rt=this.sampleValues,fe=this.valueSize,Ee=fe*2,Ce=fe*3,ye=Ge-xe,Oe=(He-xe)/ye,Ke=Oe*Oe,st=Ke*Oe,wt=Ie*Ce,Gt=wt-Ce,de=-2*st+3*Ke,we=st-Ke,bt=1-de,gt=we-Ke+Oe,bn=0;bn!==fe;bn++){var hn=rt[Gt+bn+fe],nn=rt[Gt+bn+Ee]*ye,pn=rt[wt+bn+fe],wn=rt[wt+bn]*ye;ze[bn]=bt*hn+gt*nn+de*pn+we*wn}return ze};var F={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},G={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},X={9728:Ui,9729:$i,9984:jp,9985:Kg,9986:$p,9987:rc},re={33071:wr,33648:hh,10497:Xs},ue={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},$={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},te={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},oe={CUBICSPLINE:void 0,LINEAR:ac,STEP:fh},ie={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"},se={"image/png":Ao,"image/jpeg":Ma};function pe(Ie,xe){return typeof Ie!="string"||Ie===""?"":(/^https?:\/\//i.test(xe)&&/^\//.test(Ie)&&(xe=xe.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(Ie)||/^data:.*,.*$/i.test(Ie)||/^blob:.*$/i.test(Ie)?Ie:xe+Ie)}function me(Ie){return Ie.DefaultMaterial===void 0&&(Ie.DefaultMaterial=new Ur({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:tc})),Ie.DefaultMaterial}function he(Ie,xe,He){for(var Ge in He.extensions)Ie[Ge]===void 0&&(xe.userData.gltfExtensions=xe.userData.gltfExtensions||{},xe.userData.gltfExtensions[Ge]=He.extensions[Ge])}function Ue(Ie,xe){xe.extras!==void 0&&(typeof xe.extras=="object"?Object.assign(Ie.userData,xe.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+xe.extras))}function Ve(Ie,xe,He){for(var Ge=!1,ze=!1,rt=0,fe=xe.length;rt<fe;rt++){var Ee=xe[rt];if(Ee.POSITION!==void 0&&(Ge=!0),Ee.NORMAL!==void 0&&(ze=!0),Ge&&ze)break}if(!Ge&&!ze)return Promise.resolve(Ie);for(var Ce=[],ye=[],rt=0,fe=xe.length;rt<fe;rt++){var Ee=xe[rt];if(Ge){var Oe=Ee.POSITION!==void 0?He.getDependency("accessor",Ee.POSITION):Ie.attributes.position;Ce.push(Oe)}if(ze){var Oe=Ee.NORMAL!==void 0?He.getDependency("accessor",Ee.NORMAL):Ie.attributes.normal;ye.push(Oe)}}return Promise.all([Promise.all(Ce),Promise.all(ye)]).then(function(Ke){var st=Ke[0],wt=Ke[1];return Ge&&(Ie.morphAttributes.position=st),ze&&(Ie.morphAttributes.normal=wt),Ie.morphTargetsRelative=!0,Ie})}function $e(Ie,xe){if(Ie.updateMorphTargets(),xe.weights!==void 0)for(var He=0,Ge=xe.weights.length;He<Ge;He++)Ie.morphTargetInfluences[He]=xe.weights[He];if(xe.extras&&Array.isArray(xe.extras.targetNames)){var ze=xe.extras.targetNames;if(Ie.morphTargetInfluences.length===ze.length){Ie.morphTargetDictionary={};for(var He=0,Ge=ze.length;He<Ge;He++)Ie.morphTargetDictionary[ze[He]]=He}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ct(Ie){var xe=Ie.extensions&&Ie.extensions[i.KHR_DRACO_MESH_COMPRESSION],He;return xe?He="draco:"+xe.bufferView+":"+xe.indices+":"+At(xe.attributes):He=Ie.indices+":"+At(Ie.attributes)+":"+Ie.mode,He}function At(Ie){for(var xe="",He=Object.keys(Ie).sort(),Ge=0,ze=He.length;Ge<ze;Ge++)xe+=He[Ge]+":"+Ie[He[Ge]]+";";return xe}function yt(Ie,xe,He){this.json=Ie||{},this.extensions=xe||{},this.options=He||{},this.cache=new t,this.primitiveCache={},this.textureLoader=new ed(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new xo(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}yt.prototype.parse=function(Ie,xe){var He=this,Ge=this.json,ze=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then(function(rt){var fe={scene:rt[0][Ge.scene||0],scenes:rt[0],animations:rt[1],cameras:rt[2],asset:Ge.asset,parser:He,userData:{}};he(ze,fe,Ge),Ue(fe,Ge),Ie(fe)}).catch(xe)},yt.prototype.markDefs=function(){for(var Ie=this.json.nodes||[],xe=this.json.skins||[],He=this.json.meshes||[],Ge={},ze={},rt=0,fe=xe.length;rt<fe;rt++)for(var Ee=xe[rt].joints,Ce=0,ye=Ee.length;Ce<ye;Ce++)Ie[Ee[Ce]].isBone=!0;for(var Oe=0,Ke=Ie.length;Oe<Ke;Oe++){var st=Ie[Oe];st.mesh!==void 0&&(Ge[st.mesh]===void 0&&(Ge[st.mesh]=ze[st.mesh]=0),Ge[st.mesh]++,st.skin!==void 0&&(He[st.mesh].isSkinnedMesh=!0))}this.json.meshReferences=Ge,this.json.meshUses=ze},yt.prototype.getDependency=function(Ie,xe){var He=Ie+":"+xe,Ge=this.cache.get(He);if(!Ge){switch(Ie){case"scene":Ge=this.loadScene(xe);break;case"node":Ge=this.loadNode(xe);break;case"mesh":Ge=this.loadMesh(xe);break;case"accessor":Ge=this.loadAccessor(xe);break;case"bufferView":Ge=this.loadBufferView(xe);break;case"buffer":Ge=this.loadBuffer(xe);break;case"material":Ge=this.loadMaterial(xe);break;case"texture":Ge=this.loadTexture(xe);break;case"skin":Ge=this.loadSkin(xe);break;case"animation":Ge=this.loadAnimation(xe);break;case"camera":Ge=this.loadCamera(xe);break;case"light":Ge=this.extensions[i.KHR_LIGHTS_PUNCTUAL].loadLight(xe);break;default:throw new Error("Unknown type: "+Ie)}this.cache.add(He,Ge)}return Ge},yt.prototype.getDependencies=function(Ie){var xe=this.cache.get(Ie);if(!xe){var He=this,Ge=this.json[Ie+(Ie==="mesh"?"es":"s")]||[];xe=Promise.all(Ge.map(function(ze,rt){return He.getDependency(Ie,rt)})),this.cache.add(Ie,xe)}return xe},yt.prototype.loadBuffer=function(Ie){var xe=this.json.buffers[Ie],He=this.fileLoader;if(xe.type&&xe.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+xe.type+" buffer type is not supported.");if(xe.uri===void 0&&Ie===0)return Promise.resolve(this.extensions[i.KHR_BINARY_GLTF].body);var Ge=this.options;return new Promise(function(ze,rt){He.load(pe(xe.uri,Ge.path),ze,void 0,function(){rt(new Error('THREE.GLTFLoader: Failed to load buffer "'+xe.uri+'".'))})})},yt.prototype.loadBufferView=function(Ie){var xe=this.json.bufferViews[Ie];return this.getDependency("buffer",xe.buffer).then(function(He){var Ge=xe.byteLength||0,ze=xe.byteOffset||0;return He.slice(ze,ze+Ge)})},yt.prototype.loadAccessor=function(Ie){var xe=this,He=this.json,Ge=this.json.accessors[Ie];if(Ge.bufferView===void 0&&Ge.sparse===void 0)return Promise.resolve(null);var ze=[];return Ge.bufferView!==void 0?ze.push(this.getDependency("bufferView",Ge.bufferView)):ze.push(null),Ge.sparse!==void 0&&(ze.push(this.getDependency("bufferView",Ge.sparse.indices.bufferView)),ze.push(this.getDependency("bufferView",Ge.sparse.values.bufferView))),Promise.all(ze).then(function(rt){var fe=rt[0],Ee=ue[Ge.type],Ce=G[Ge.componentType],ye=Ce.BYTES_PER_ELEMENT,Oe=ye*Ee,Ke=Ge.byteOffset||0,st=Ge.bufferView!==void 0?He.bufferViews[Ge.bufferView].byteStride:void 0,wt=Ge.normalized===!0,Gt,de;if(st&&st!==Oe){var we=Math.floor(Ke/st),bt="InterleavedBuffer:"+Ge.bufferView+":"+Ge.componentType+":"+we+":"+Ge.count,gt=xe.cache.get(bt);gt||(Gt=new Ce(fe,we*st,Ge.count*st/ye),gt=new za(Gt,st/ye),xe.cache.add(bt,gt)),de=new Lh(gt,Ee,Ke%st/ye,wt)}else fe===null?Gt=new Ce(Ge.count*Ee):Gt=new Ce(fe,Ke,Ge.count*Ee),de=new zn(Gt,Ee,wt);if(Ge.sparse!==void 0){var bn=ue.SCALAR,hn=G[Ge.sparse.indices.componentType],nn=Ge.sparse.indices.byteOffset||0,pn=Ge.sparse.values.byteOffset||0,wn=new hn(rt[1],nn,Ge.sparse.count*bn),cn=new Ce(rt[2],pn,Ge.sparse.count*Ee);fe!==null&&(de=new zn(de.array.slice(),de.itemSize,de.normalized));for(var Ht=0,sn=wn.length;Ht<sn;Ht++){var Zt=wn[Ht];if(de.setX(Zt,cn[Ht*Ee]),Ee>=2&&de.setY(Zt,cn[Ht*Ee+1]),Ee>=3&&de.setZ(Zt,cn[Ht*Ee+2]),Ee>=4&&de.setW(Zt,cn[Ht*Ee+3]),Ee>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return de})},yt.prototype.loadTexture=function(Ie){var xe=this,He=this.json,Ge=this.options,ze=this.textureLoader,rt=window.URL||window.webkitURL,fe=He.textures[Ie],Ee=fe.extensions||{},Ce;Ee[i.MSFT_TEXTURE_DDS]?Ce=He.images[Ee[i.MSFT_TEXTURE_DDS].source]:Ce=He.images[fe.source];var ye=Ce.uri,Oe=!1;return Ce.bufferView!==void 0&&(ye=xe.getDependency("bufferView",Ce.bufferView).then(function(Ke){Oe=!0;var st=new Blob([Ke],{type:Ce.mimeType});return ye=rt.createObjectURL(st),ye})),Promise.resolve(ye).then(function(Ke){var st=Ge.manager.getHandler(Ke);return st||(st=Ee[i.MSFT_TEXTURE_DDS]?xe.extensions[i.MSFT_TEXTURE_DDS].ddsLoader:ze),new Promise(function(wt,Gt){st.load(pe(Ke,Ge.path),wt,void 0,Gt)})}).then(function(Ke){Oe===!0&&rt.revokeObjectURL(ye),Ke.flipY=!1,fe.name!==void 0&&(Ke.name=fe.name),Ce.mimeType in se&&(Ke.format=se[Ce.mimeType]);var st=He.samplers||{},wt=st[fe.sampler]||{};return Ke.magFilter=X[wt.magFilter]||$i,Ke.minFilter=X[wt.minFilter]||rc,Ke.wrapS=re[wt.wrapS]||Xs,Ke.wrapT=re[wt.wrapT]||Xs,Ke})},yt.prototype.assignTexture=function(Ie,xe,He){var Ge=this;return this.getDependency("texture",He.index).then(function(ze){if(!ze.isCompressedTexture)switch(xe){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":ze.format=Ma;break}if(He.texCoord!==void 0&&He.texCoord!=0&&!(xe==="aoMap"&&He.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+He.texCoord+" for texture "+xe+" not yet supported."),Ge.extensions[i.KHR_TEXTURE_TRANSFORM]){var rt=He.extensions!==void 0?He.extensions[i.KHR_TEXTURE_TRANSFORM]:void 0;rt&&(ze=Ge.extensions[i.KHR_TEXTURE_TRANSFORM].extendTexture(ze,rt))}Ie[xe]=ze})},yt.prototype.assignFinalMaterial=function(Ie){var xe=Ie.geometry,He=Ie.material;this.extensions;var Ge=xe.attributes.tangent!==void 0,ze=xe.attributes.color!==void 0,rt=xe.attributes.normal===void 0,fe=Ie.isSkinnedMesh===!0,Ee=Object.keys(xe.morphAttributes).length>0,Ce=Ee&&xe.morphAttributes.normal!==void 0;if(Ie.isPoints){var ye="PointsMaterial:"+He.uuid,Oe=this.cache.get(ye);Oe||(Oe=new ss,Rn.prototype.copy.call(Oe,He),Oe.color.copy(He.color),Oe.map=He.map,Oe.sizeAttenuation=!1,this.cache.add(ye,Oe)),He=Oe}else if(Ie.isLine){var ye="LineBasicMaterial:"+He.uuid,Ke=this.cache.get(ye);Ke||(Ke=new Ri,Rn.prototype.copy.call(Ke,He),Ke.color.copy(He.color),this.cache.add(ye,Ke)),He=Ke}if(Ge||ze||rt||fe||Ee){var ye="ClonedMaterial:"+He.uuid+":";He.isGLTFSpecularGlossinessMaterial&&(ye+="specular-glossiness:"),fe&&(ye+="skinning:"),Ge&&(ye+="vertex-tangents:"),ze&&(ye+="vertex-colors:"),rt&&(ye+="flat-shading:"),Ee&&(ye+="morph-targets:"),Ce&&(ye+="morph-normals:");var st=this.cache.get(ye);st||(st=He.clone(),fe&&(st.skinning=!0),Ge&&(st.vertexTangents=!0),ze&&(st.vertexColors=nc),rt&&(st.flatShading=!0),Ee&&(st.morphTargets=!0),Ce&&(st.morphNormals=!0),this.cache.add(ye,st)),He=st}He.aoMap&&xe.attributes.uv2===void 0&&xe.attributes.uv!==void 0&&xe.setAttribute("uv2",new zn(xe.attributes.uv.array,2)),He.normalScale&&!Ge&&(He.normalScale.y=-He.normalScale.y),Ie.material=He},yt.prototype.loadMaterial=function(Ie){var xe=this,He=this.json,Ge=this.extensions,ze=He.materials[Ie],rt,fe={},Ee=ze.extensions||{},Ce=[];if(Ee[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var ye=Ge[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];rt=ye.getMaterialType(),Ce.push(ye.extendParams(fe,ze,xe))}else if(Ee[i.KHR_MATERIALS_UNLIT]){var Oe=Ge[i.KHR_MATERIALS_UNLIT];rt=Oe.getMaterialType(),Ce.push(Oe.extendParams(fe,ze,xe))}else{rt=Ur;var Ke=ze.pbrMetallicRoughness||{};if(fe.color=new tn(1,1,1),fe.opacity=1,Array.isArray(Ke.baseColorFactor)){var st=Ke.baseColorFactor;fe.color.fromArray(st),fe.opacity=st[3]}Ke.baseColorTexture!==void 0&&Ce.push(xe.assignTexture(fe,"map",Ke.baseColorTexture)),fe.metalness=Ke.metallicFactor!==void 0?Ke.metallicFactor:1,fe.roughness=Ke.roughnessFactor!==void 0?Ke.roughnessFactor:1,Ke.metallicRoughnessTexture!==void 0&&(Ce.push(xe.assignTexture(fe,"metalnessMap",Ke.metallicRoughnessTexture)),Ce.push(xe.assignTexture(fe,"roughnessMap",Ke.metallicRoughnessTexture)))}ze.doubleSided===!0&&(fe.side=lh);var wt=ze.alphaMode||ie.OPAQUE;return wt===ie.BLEND?fe.transparent=!0:(fe.transparent=!1,wt===ie.MASK&&(fe.alphaTest=ze.alphaCutoff!==void 0?ze.alphaCutoff:.5)),ze.normalTexture!==void 0&&rt!==lr&&(Ce.push(xe.assignTexture(fe,"normalMap",ze.normalTexture)),fe.normalScale=new Lt(1,1),ze.normalTexture.scale!==void 0&&fe.normalScale.set(ze.normalTexture.scale,ze.normalTexture.scale)),ze.occlusionTexture!==void 0&&rt!==lr&&(Ce.push(xe.assignTexture(fe,"aoMap",ze.occlusionTexture)),ze.occlusionTexture.strength!==void 0&&(fe.aoMapIntensity=ze.occlusionTexture.strength)),ze.emissiveFactor!==void 0&&rt!==lr&&(fe.emissive=new tn().fromArray(ze.emissiveFactor)),ze.emissiveTexture!==void 0&&rt!==lr&&Ce.push(xe.assignTexture(fe,"emissiveMap",ze.emissiveTexture)),Promise.all(Ce).then(function(){var Gt;return rt===D?Gt=Ge[i.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(fe):Gt=new rt(fe),ze.name!==void 0&&(Gt.name=ze.name),Gt.map&&(Gt.map.encoding=mh),Gt.emissiveMap&&(Gt.emissiveMap.encoding=mh),Ue(Gt,ze),ze.extensions&&he(Ge,Gt,ze),Gt})};function St(Ie,xe,He){var Ge=xe.attributes,ze=new Do;if(Ge.POSITION!==void 0){var rt=He.json.accessors[Ge.POSITION],fe=rt.min,Ee=rt.max;if(fe!==void 0&&Ee!==void 0)ze.set(new Se(fe[0],fe[1],fe[2]),new Se(Ee[0],Ee[1],Ee[2]));else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;var Ce=xe.targets;if(Ce!==void 0)for(var ye=new Se,Oe=0,Ke=Ce.length;Oe<Ke;Oe++){var st=Ce[Oe];if(st.POSITION!==void 0){var rt=He.json.accessors[st.POSITION],fe=rt.min,Ee=rt.max;fe!==void 0&&Ee!==void 0?(ye.setX(Math.max(Math.abs(fe[0]),Math.abs(Ee[0]))),ye.setY(Math.max(Math.abs(fe[1]),Math.abs(Ee[1]))),ye.setZ(Math.max(Math.abs(fe[2]),Math.abs(Ee[2]))),ze.expandByVector(ye)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}Ie.boundingBox=ze;var wt=new Sa;ze.getCenter(wt.center),wt.radius=ze.min.distanceTo(ze.max)/2,Ie.boundingSphere=wt}function It(Ie,xe,He){var Ge=xe.attributes,ze=[];function rt(ye,Oe){return He.getDependency("accessor",ye).then(function(Ke){Ie.setAttribute(Oe,Ke)})}for(var fe in Ge){var Ee=$[fe]||fe.toLowerCase();Ee in Ie.attributes||ze.push(rt(Ge[fe],Ee))}if(xe.indices!==void 0&&!Ie.index){var Ce=He.getDependency("accessor",xe.indices).then(function(ye){Ie.setIndex(ye)});ze.push(Ce)}return Ue(Ie,xe),St(Ie,xe,He),Promise.all(ze).then(function(){return xe.targets!==void 0?Ve(Ie,xe.targets,He):Ie})}function Nt(Ie,xe){var He=Ie.getIndex();if(He===null){var Ge=[],ze=Ie.getAttribute("position");if(ze!==void 0){for(var rt=0;rt<ze.count;rt++)Ge.push(rt);Ie.setIndex(Ge),He=Ie.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),Ie}var fe=He.count-2,Ee=[];if(xe===Sx)for(var rt=1;rt<=fe;rt++)Ee.push(He.getX(0)),Ee.push(He.getX(rt)),Ee.push(He.getX(rt+1));else for(var rt=0;rt<fe;rt++)rt%2===0?(Ee.push(He.getX(rt)),Ee.push(He.getX(rt+1)),Ee.push(He.getX(rt+2))):(Ee.push(He.getX(rt+2)),Ee.push(He.getX(rt+1)),Ee.push(He.getX(rt)));Ee.length/3!==fe&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var Ce=Ie.clone();return Ce.setIndex(Ee),Ce}return yt.prototype.loadGeometries=function(Ie){var xe=this,He=this.extensions,Ge=this.primitiveCache;function ze(st){return He[i.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(st,xe).then(function(wt){return It(wt,st,xe)})}for(var rt=[],fe=0,Ee=Ie.length;fe<Ee;fe++){var Ce=Ie[fe],ye=ct(Ce),Oe=Ge[ye];if(Oe)rt.push(Oe.promise);else{var Ke;Ce.extensions&&Ce.extensions[i.KHR_DRACO_MESH_COMPRESSION]?Ke=ze(Ce):Ke=It(new vn,Ce,xe),Ge[ye]={primitive:Ce,promise:Ke},rt.push(Ke)}}return Promise.all(rt)},yt.prototype.loadMesh=function(Ie){for(var xe=this,He=this.json,Ge=He.meshes[Ie],ze=Ge.primitives,rt=[],fe=0,Ee=ze.length;fe<Ee;fe++){var Ce=ze[fe].material===void 0?me(this.cache):this.getDependency("material",ze[fe].material);rt.push(Ce)}return rt.push(xe.loadGeometries(ze)),Promise.all(rt).then(function(ye){for(var Oe=ye.slice(0,ye.length-1),Ke=ye[ye.length-1],st=[],wt=0,Gt=Ke.length;wt<Gt;wt++){var de=Ke[wt],we=ze[wt],bt,gt=Oe[wt];if(we.mode===F.TRIANGLES||we.mode===F.TRIANGLE_STRIP||we.mode===F.TRIANGLE_FAN||we.mode===void 0)bt=Ge.isSkinnedMesh===!0?new kh(de,gt):new Ai(de,gt),bt.isSkinnedMesh===!0&&!bt.geometry.attributes.skinWeight.normalized&&bt.normalizeSkinWeights(),we.mode===F.TRIANGLE_STRIP?bt.geometry=Nt(bt.geometry,KT):we.mode===F.TRIANGLE_FAN&&(bt.geometry=Nt(bt.geometry,Sx));else if(we.mode===F.LINES)bt=new Vi(de,gt);else if(we.mode===F.LINE_STRIP)bt=new ao(de,gt);else if(we.mode===F.LINE_LOOP)bt=new Af(de,gt);else if(we.mode===F.POINTS)bt=new Pf(de,gt);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+we.mode);Object.keys(bt.geometry.morphAttributes).length>0&&$e(bt,Ge),bt.name=Ge.name||"mesh_"+Ie,Ke.length>1&&(bt.name+="_"+wt),Ue(bt,Ge),xe.assignFinalMaterial(bt),st.push(bt)}if(st.length===1)return st[0];for(var bn=new al,wt=0,Gt=st.length;wt<Gt;wt++)bn.add(st[wt]);return bn})},yt.prototype.loadCamera=function(Ie){var xe,He=this.json.cameras[Ie],Ge=He[He.type];if(!Ge){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return He.type==="perspective"?xe=new Zi(Wn.radToDeg(Ge.yfov),Ge.aspectRatio||1,Ge.znear||1,Ge.zfar||2e6):He.type==="orthographic"&&(xe=new eu(Ge.xmag/-2,Ge.xmag/2,Ge.ymag/2,Ge.ymag/-2,Ge.znear,Ge.zfar)),He.name!==void 0&&(xe.name=He.name),Ue(xe,He),Promise.resolve(xe)},yt.prototype.loadSkin=function(Ie){var xe=this.json.skins[Ie],He={joints:xe.joints};return xe.inverseBindMatrices===void 0?Promise.resolve(He):this.getDependency("accessor",xe.inverseBindMatrices).then(function(Ge){return He.inverseBindMatrices=Ge,He})},yt.prototype.loadAnimation=function(Ie){for(var xe=this.json,He=xe.animations[Ie],Ge=[],ze=[],rt=[],fe=[],Ee=[],Ce=0,ye=He.channels.length;Ce<ye;Ce++){var Oe=He.channels[Ce],Ke=He.samplers[Oe.sampler],st=Oe.target,wt=st.node!==void 0?st.node:st.id,Gt=He.parameters!==void 0?He.parameters[Ke.input]:Ke.input,de=He.parameters!==void 0?He.parameters[Ke.output]:Ke.output;Ge.push(this.getDependency("node",wt)),ze.push(this.getDependency("accessor",Gt)),rt.push(this.getDependency("accessor",de)),fe.push(Ke),Ee.push(st)}return Promise.all([Promise.all(Ge),Promise.all(ze),Promise.all(rt),Promise.all(fe),Promise.all(Ee)]).then(function(we){for(var bt=we[0],gt=we[1],bn=we[2],hn=we[3],nn=we[4],pn=[],wn=0,cn=bt.length;wn<cn;wn++){var Ht=bt[wn],sn=gt[wn],Zt=bn[wn],Ze=hn[wn],Ut=nn[wn];if(Ht!==void 0){Ht.updateMatrix(),Ht.matrixAutoUpdate=!0;var en;switch(te[Ut.path]){case te.weights:en=Jc;break;case te.rotation:en=Kh;break;case te.position:case te.scale:default:en=Kc;break}var Dn=Ht.name?Ht.name:Ht.uuid,fn=Ze.interpolation!==void 0?oe[Ze.interpolation]:ac,On=[];te[Ut.path]===te.weights?Ht.traverse(function(_i){_i.isMesh===!0&&_i.morphTargetInfluences&&On.push(_i.name?_i.name:_i.uuid)}):On.push(Dn);var Gn=Zt.array;if(Zt.normalized){var qn;if(Gn.constructor===Int8Array)qn=1/127;else if(Gn.constructor===Uint8Array)qn=1/255;else if(Gn.constructor==Int16Array)qn=1/32767;else if(Gn.constructor===Uint16Array)qn=1/65535;else throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");for(var Wi=new Float32Array(Gn.length),Nn=0,Si=Gn.length;Nn<Si;Nn++)Wi[Nn]=Gn[Nn]*qn;Gn=Wi}for(var Nn=0,Si=On.length;Nn<Si;Nn++){var ei=new en(On[Nn]+"."+te[Ut.path],sn.array,Gn,fn);Ze.interpolation==="CUBICSPLINE"&&(ei.createInterpolant=function(Wr){return new k(this.times,this.values,this.getValueSize()/3,Wr)},ei.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),pn.push(ei)}}}var Ki=He.name!==void 0?He.name:"animation_"+Ie;return new vo(Ki,void 0,pn)})},yt.prototype.loadNode=function(Ie){var xe=this.json,He=this.extensions,Ge=this,ze=xe.meshReferences,rt=xe.meshUses,fe=xe.nodes[Ie];return function(){var Ee=[];return fe.mesh!==void 0&&Ee.push(Ge.getDependency("mesh",fe.mesh).then(function(Ce){var ye;if(ze[fe.mesh]>1){var Oe=rt[fe.mesh]++;ye=Ce.clone(),ye.name+="_instance_"+Oe}else ye=Ce;return fe.weights!==void 0&&ye.traverse(function(Ke){if(Ke.isMesh)for(var st=0,wt=fe.weights.length;st<wt;st++)Ke.morphTargetInfluences[st]=fe.weights[st]}),ye})),fe.camera!==void 0&&Ee.push(Ge.getDependency("camera",fe.camera)),fe.extensions&&fe.extensions[i.KHR_LIGHTS_PUNCTUAL]&&fe.extensions[i.KHR_LIGHTS_PUNCTUAL].light!==void 0&&Ee.push(Ge.getDependency("light",fe.extensions[i.KHR_LIGHTS_PUNCTUAL].light)),Promise.all(Ee)}().then(function(Ee){var Ce;if(fe.isBone===!0?Ce=new By:Ee.length>1?Ce=new al:Ee.length===1?Ce=Ee[0]:Ce=new on,Ce!==Ee[0])for(var ye=0,Oe=Ee.length;ye<Oe;ye++)Ce.add(Ee[ye]);if(fe.name!==void 0&&(Ce.userData.name=fe.name,Ce.name=mr.sanitizeNodeName(fe.name)),Ue(Ce,fe),fe.extensions&&he(He,Ce,fe),fe.matrix!==void 0){var Ke=new jn;Ke.fromArray(fe.matrix),Ce.applyMatrix4(Ke)}else fe.translation!==void 0&&Ce.position.fromArray(fe.translation),fe.rotation!==void 0&&Ce.quaternion.fromArray(fe.rotation),fe.scale!==void 0&&Ce.scale.fromArray(fe.scale);return Ce})},yt.prototype.loadScene=function(){function Ie(xe,He,Ge,ze){var rt=Ge.nodes[xe];return ze.getDependency("node",xe).then(function(fe){if(rt.skin===void 0)return fe;var Ee;return ze.getDependency("skin",rt.skin).then(function(Ce){Ee=Ce;for(var ye=[],Oe=0,Ke=Ee.joints.length;Oe<Ke;Oe++)ye.push(ze.getDependency("node",Ee.joints[Oe]));return Promise.all(ye)}).then(function(Ce){return fe.traverse(function(ye){if(ye.isMesh){for(var Oe=[],Ke=[],st=0,wt=Ce.length;st<wt;st++){var Gt=Ce[st];if(Gt){Oe.push(Gt);var de=new jn;Ee.inverseBindMatrices!==void 0&&de.fromArray(Ee.inverseBindMatrices.array,st*16),Ke.push(de)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',Ee.joints[st])}ye.bind(new wf(Oe,Ke),ye.matrixWorld)}}),fe})}).then(function(fe){He.add(fe);var Ee=[];if(rt.children)for(var Ce=rt.children,ye=0,Oe=Ce.length;ye<Oe;ye++){var Ke=Ce[ye];Ee.push(Ie(Ke,fe,Ge,ze))}return Promise.all(Ee)})}return function(He){var Ge=this.json,ze=this.extensions,rt=this.json.scenes[He],fe=this,Ee=new Ca;rt.name!==void 0&&(Ee.name=rt.name),Ue(Ee,rt),rt.extensions&&he(ze,Ee,rt);for(var Ce=rt.nodes||[],ye=[],Oe=0,Ke=Ce.length;Oe<Ke;Oe++)ye.push(Ie(Ce[Oe],Ee,Ge,fe));return Promise.all(ye).then(function(){return Ee})}}(),e}();function LI(e){new PI().load("./gis/34M_17.gltf",i=>{i.scene.position.set(116577.28779765591,19632.646909285337,0),i.scene.rotateX(Math.PI/2),i.scene.scale.set(2,2,2),e.addObject(i.scene)})}class II extends P.MxCADPluginBase{constructor(){super(),this.map_default_data=AI()}}let bd;const{showModal:RI,hideModal:vl,showTools:zI}=Gg();function kI(){return lt(this,null,function*(){RI({title:"My Test Draw",text:"测试Modal",oncancel:()=>{vl()},onsubmit:()=>{vl()},ongetallentity:()=>{vl(),Le.MxFun.sendStringToExecute("TestGetAllEntity")},ondrawline:()=>{vl(),Le.MxFun.sendStringToExecute("Mx_Circle")},docommand:e=>{vl(),Le.MxFun.sendStringToExecute(e)}})})}function BI(){return lt(this,null,function*(){zI({title:"My Extension Tools",text:"扩展工具",oncancel:()=>{vl()},docommand:e=>{vl(),Le.MxFun.sendStringToExecute(e)}})})}const Z1=document.createElement("div");document.body.appendChild(Z1),ne.createApp(p2).mount(Z1),m2(),Le.MxFun.on("mxcadApplicationStart",e=>lt(this,null,function*(){bd=e,bd.init(new II)})),Le.MxFun.on("mxcadApplicationInitMap",()=>{SI(bd.mxmap)}),Le.MxFun.on("mxcadApplicationCreatedMxCADObject",e=>{P.MxCpp.App.addNetworkLoadingFont(["txt.shx","simplex.shx","aaa.shx","ltypeshp.shx","complex.shx"]),P.MxCpp.App.addNetworkLoadingBigFont(["hztxt.shx","gbcbig.shx"]),P.MxCpp.App.addNetworkLoadingTrueTypeFont(["simsun","syadobe"],["思原宋体","思原黑体"],["stadobe.otf","syadobe.otf"]),e.mxcad.on("selectChange",i=>{if(i.length==0)return;let l=i[0],u=l.getMxDbEntity();if(u!==null){console.log(u.getTypeName()),u instanceof Le.MxDbRectBoxLeadComment&&console.log(u.text);return}let h=l.getMcDbEntity();h!==null&&(console.log(h.objectName),h instanceof P.McDbText?console.log(h.textString):h instanceof P.McDbBlockReference&&h.getAllAttribute().forEach(v=>{let b=v.getMcDbEntity();console.log(b.textString),console.log(b.tag)}))}),P.MxCpp.PropertiesWindow.onEvent_getProperties(i=>{let l=i.getMcDbEntity();if(!l)return[];let u=l.getxDataDouble("DN"),h=l.getxDataDouble("LEN"),f=[];return u.ret&&f.push({sVarName:"DN",iVarType:P.MxPropertiesWindowCustomValueType.kDouble,val:u.val,isOnlyRead:!1}),h.ret&&f.push({sVarName:"LEN",iVarType:P.MxPropertiesWindowCustomValueType.kDouble,val:h.val,isOnlyRead:!1}),f}),P.MxCpp.PropertiesWindow.onEvent_setProperties((i,l)=>{let u=i.getMcDbEntity();u&&(l.sVarName=="DN"?u.setxDataDouble("DN",l.val):l.sVarName=="LEN"&&u.setxDataDouble("LEN",l.val))})});function wd(){return bd}function Er(e){return"x="+e.x+",y="+e.y+",z="+e.z}function FI(){window.open("https://demo.mxdraw3d.com:3562/MxCADCode.7z")}function OI(){window.open("https://demo.mxdraw3d.com:3562/MxDrawCloudServer1.0TryVersion.7z")}function au(e){var t=window.location.href;return t.indexOf("?")!=-1&&(t=t.replace(/(\?|#)[^'"]*/,"")),`${t}?map=true&maptype=${e}`}function NI(){window.open(au("gdslwzj"))}function UI(){window.open(au("google"))}function VI(){window.open(au("gdyx"))}function GI(){window.open(au("tdtsl"))}function HI(){window.open(au("bdsl"))}function WI(){window.open(au("geoq"))}function jI(){P.MxCpp.getCurrentMxCAD().setViewBackgroundColor(255,255,255),Le.MxFun.callEvent("updateBackgroundColor",new P.McCmColor(255,255,255))}function X1(){return lt(this,null,function*(){let e=new P.MxCADUiPrEntity;e.setMessage("选择要需要开启自定义属性的对象");let t=yield e.go();if(!t.isValid())return;let i=t.getMcDbEntity();P.MxCpp.PropertiesWindow.setEntitySupportCustom(t),i.setxDataDouble("DN",100),i.setxDataDouble("LEN",2e3)})}function $I(){P.MxCpp.getCurrentMxCAD().openWebFile("http://localhost:1337/mxcad/file/a9cbed3d3a351b79f24484e87bd78338.DWG.mxweb")}function qI(){return lt(this,null,function*(){})}function ZI(){return lt(this,null,function*(){let e=new P.MxCADUiPrEntity;e.setMessage("选择要隐藏的对象");let t=yield e.go();if(!t.isValid())return;let i=t.getMcDbEntity(),l=P.MxCpp.getCurrentMxCAD(),f=l.getDatabase().getLayerTable().get(i.layer).getMcDbLayerTableRecord();f!==null&&(f.isOff=!0,l.updateLayerDisplayStatus(),l.updateDisplay())})}function XI(){return window.location.origin+window.location.pathname}let z_;function YI(){return lt(this,null,function*(){const e=new P.MxCADUiPrPoint;e.setMessage(`
指定插入点:`);let t=yield e.go();if(!t)return;let i=P.MxCpp.getCurrentMxCAD(),l=XI()+"mxcad.jpg";i.loadImage(l,u=>{if(!u){console.log("loadImage failed");return}let h=i.mxdraw.viewCoordLong2Cad(100),f=u.height/u.width*h;z_=i.drawImage(t.x,t.y,h,f,0,l,!0),i.updateDisplay()})})}function JI(){if(!z_)return;let e=P.MxCpp.getCurrentMxCAD(),t="https://cdn.pixabay.com/photo/2022/11/15/12/23/winter-7593872_960_720.jpg";e.loadImage(t,i=>{if(!i){console.log("loadImage failed");return}let l=e.addImageDefine(t,"winter-7593872_960_720.jpg",!0),u=z_.getMcDbEntity();u&&u.setImageDefId(l),e.updateDisplay()})}function Y1(){return lt(this,null,function*(){let e=P.MxCpp.getCurrentMxCAD(),t=new P.MxCADUiPrPoint,i=yield t.go();if(i==null)return;t.setBasePt(i);let l=yield t.go();if(l==null)return;let u=e.drawLine(i.x,i.y,l.x,l.y);e.addCurrentSelect(u)})}let J1=0;function K1(){return lt(this,null,function*(){J1+=Math.PI*.5,P.MxCpp.getCurrentMxCAD().zoomAngle(J1)})}function Q1(){P.MxCpp.getCurrentMxCAD().zoomCenter(900,900)}function KI(){let e=P.MxCpp.getCurrentMxCAD();e.newFile();let t=new P.McDbPolyline;t.setType(P.McDb.PolylineType.k3dPolyline),t.addVertexAt(new P.McGePoint3d(100,100,100)),t.addVertexAt(new P.McGePoint3d(200,100,500)),t.addVertexAt(new P.McGePoint3d(300,400,200)),e.drawEntity(t),e.zoomAll(),e.updateDisplay()}function QI(){const e=new P.MxCADResbuf;e.AddMcDbEntityTypes("INSERT");let t=new P.MxCADSelectionSet;t.allSelect(e);let i=t.count();console.log(i)}function eR(){return lt(this,null,function*(){let e=P.MxCpp.getCurrentMxCAD();const t=new P.MxCADUiPrPoint;t.setMessage(`
指定第一点:`);let i=yield t.go();if(!i)return;t.setMessage(`
指定第二点:`),t.setBasePt(i);let l=yield t.go();if(!l)return;let u=l.sub(i);u.rotateBy(Math.PI*.5).normalize().mult(Le.MxFun.screenCoordLong2Doc(10));let h=i.clone().addvec(u),f=i.clone().subvec(u),r=l.clone().addvec(u),v=l.clone().subvec(u),b=new P.McGeBound([h,f,r,v]),E=b.minPoint,M=b.maxPoint,D=new P.MxCADSelectionSet;D.crossingSelect(E.x,E.y,M.x,M.y,new P.MxCADResbuf([P.DxfCode.kEntityType,"LINE,ARC,CIRCLE,LWPOLYLINE"]));let L=Le.MxFun.screenCoordLong2Doc(5),z=new P.McDbLine(i,l);D.forEach(k=>{let G=k.getMcDbEntity().IntersectWith(z,P.McDb.Intersect.kOnBothOperands);if(G.length()!=0){let X=G.at(0);e.drawCircle(X.x,X.y,L)}})})}Le.MxFun.on("mxcadApplicationStartCreatingMxCADObject",e=>{let t=e.mxdraw;t.setViewMovementMethod(!0),t.on("openFileComplete",()=>{console.log("MxTip:openFileComplete ")}),t.addControlsEvent("mousedown",i=>{let l=i.offsetX,u=i.offsetY,h=t.viewCoord2Cad(l,u,0);return console.log("mousedown:",h),0})}),Le.MxFun.on("mxcadApplicationCreatedMxCADObject",e=>{e.mxcad.on("selectChange",i=>{if(i.length==0)return;let l=i[0],u=l.getMxDbEntity();if(u!==null){console.log(u.getTypeName()),u instanceof Le.MxDbRectBoxLeadComment&&console.log(u.text);return}let h=l.getMcDbEntity();h!==null&&(console.log(h.objectName),h instanceof P.McDbText?console.log(h.textString):h instanceof P.McDbBlockReference&&h.getAllAttribute().forEach(v=>{let b=v.getMcDbEntity();console.log(b.textString),console.log(b.tag)}))}),P.MxCpp.PropertiesWindow.onEvent_getProperties(i=>{let l=i.getMcDbEntity();if(!l)return[];let u=l.getxDataDouble("DN"),h=l.getxDataDouble("LEN"),f=[];return u.ret&&f.push({sVarName:"DN",iVarType:P.MxPropertiesWindowCustomValueType.kDouble,val:u.val,isOnlyRead:!1}),h.ret&&f.push({sVarName:"LEN",iVarType:P.MxPropertiesWindowCustomValueType.kDouble,val:h.val,isOnlyRead:!1}),f}),P.MxCpp.PropertiesWindow.onEvent_setProperties((i,l)=>{let u=i.getMcDbEntity();u&&(l.sVarName=="DN"?u.setxDataDouble("DN",l.val):l.sVarName=="LEN"&&u.setxDataDouble("LEN",l.val))}),tR()});function tR(){Le.MxFun.addCommand("My_PluginTest",kI),Le.MxFun.addCommand("My_Extool",BI),Le.MxFun.addCommand("Mx_Open_DemoCode",FI),Le.MxFun.addCommand("Mx_Open_DevInstall",OI),Le.MxFun.addCommand("Mx_Open_Map_gdslwzj",NI),Le.MxFun.addCommand("Mx_Open_Map_gdyx",VI),Le.MxFun.addCommand("Mx_Open_Map_tdtsl",GI),Le.MxFun.addCommand("Mx_Open_Map_bdsl",HI),Le.MxFun.addCommand("Mx_Open_Map_geoq",WI),Le.MxFun.addCommand("Mx_Open_Map_googlecn",UI),Le.MxFun.addCommand("Mx_ViewBackgroundColor",jI),Le.MxFun.addCommand("Mx_TestExProp",X1),Le.MxFun.addCommand("Mx_Test_OpenFile",$I),Le.MxFun.addCommand("Mx_Test_GetFile",qI),Le.MxFun.addCommand("Mx_TestExProp",X1),Le.MxFun.addCommand("Mx_SelectEntitHideLayer",ZI),Le.MxFun.addCommand("MxTest_TestAddCurrentSelect",Y1),Le.MxFun.addCommand("MxTest_TestSetViewAngle",K1),Le.MxFun.addCommand("MxText_ZoomCenter",Q1),Le.MxFun.addCommand("MxTest_Map_Download",DI),Le.MxFun.addCommand("Mx_Test_DrawImage",YI),Le.MxFun.addCommand("Mx_Test_ModifyImage",JI),Le.MxFun.addCommand("Mx_Test_Draw3DPolyline",KI),Le.MxFun.addCommand("MxTemp_Test",QI),Le.MxFun.addCommand("Mx_Test_IntersectWith",eR),T2(),U2(),pP(),mP(),jP(),JP(),QP(),i3(),o3(),z3(),V3(),t3(),Z3(),pL(),RL(),qL(),eI(),vI(),bd.mxmap&&LI(Le.MxFun.getCurrentDraw())}return ba.McGePoint3dToString=Er,ba.MxTest_TestAddCurrentSelect=Y1,ba.MxTest_TestSetViewAngle=K1,ba.MxText_ZoomCenter=Q1,ba.getMxCADUi=wd,Object.defineProperty(ba,Symbol.toStringTag,{value:"Module"}),ba}({},Mx,mxcad,Vue,axios);
//# sourceMappingURL=test.js.map
